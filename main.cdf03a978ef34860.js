(self.webpackChunkfretboard_explorer=self.webpackChunkfretboard_explorer||[]).push([[792],{45:(Oe,An,nn)=>{var dn=nn(738).default;Oe.exports=function Dn(Bn,zn){if("object"!=dn(Bn)||!Bn)return Bn;var cs=Bn[Symbol.toPrimitive];if(void 0!==cs){var Zs=cs.call(Bn,zn||"default");if("object"!=dn(Zs))return Zs;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===zn?String:Number)(Bn)},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},79:Oe=>{Oe.exports=function An(nn,dn){(null==dn||dn>nn.length)&&(dn=nn.length);for(var Dn=0,Bn=Array(dn);Dn<dn;Dn++)Bn[Dn]=nn[Dn];return Bn},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},122:(Oe,An,nn)=>{var dn=nn(79);Oe.exports=function Dn(Bn,zn){if(Bn){if("string"==typeof Bn)return dn(Bn,zn);var cs={}.toString.call(Bn).slice(8,-1);return"Object"===cs&&Bn.constructor&&(cs=Bn.constructor.name),"Map"===cs||"Set"===cs?Array.from(Bn):"Arguments"===cs||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(cs)?dn(Bn,zn):void 0}},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},156:Oe=>{Oe.exports=function An(nn,dn){var Dn=null==nn?null:typeof Symbol<"u"&&nn[Symbol.iterator]||nn["@@iterator"];if(null!=Dn){var Bn,zn,cs,Zs,ti=[],zr=!0,Bo=!1;try{if(cs=(Dn=Dn.call(nn)).next,0===dn){if(Object(Dn)!==Dn)return;zr=!1}else for(;!(zr=(Bn=cs.call(Dn)).done)&&(ti.push(Bn.value),ti.length!==dn);zr=!0);}catch(ms){Bo=!0,zn=ms}finally{try{if(!zr&&null!=Dn.return&&(Zs=Dn.return(),Object(Zs)!==Zs))return}finally{if(Bo)throw zn}}return ti}},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},383:Oe=>{Oe.exports=function An(nn,dn){if(!(nn instanceof dn))throw new TypeError("Cannot call a class as a function")},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},579:(Oe,An,nn)=>{var dn=nn(736);function Dn(zn,cs){for(var Zs=0;Zs<cs.length;Zs++){var ti=cs[Zs];ti.enumerable=ti.enumerable||!1,ti.configurable=!0,"value"in ti&&(ti.writable=!0),Object.defineProperty(zn,dn(ti.key),ti)}}Oe.exports=function Bn(zn,cs,Zs){return cs&&Dn(zn.prototype,cs),Zs&&Dn(zn,Zs),Object.defineProperty(zn,"prototype",{writable:!1}),zn},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},582:function(Oe,An,nn){!function(dn,Dn,Bn,zn){"use strict";var cs=function(Le,Pe,Me){return{endTime:Pe,insertTime:Me,type:"exponentialRampToValue",value:Le}},Zs=function(Le,Pe,Me){return{endTime:Pe,insertTime:Me,type:"linearRampToValue",value:Le}},ti=function(Le,Pe){return{startTime:Pe,type:"setValue",value:Le}},zr=function(Le,Pe,Me){return{duration:Me,startTime:Pe,type:"setValueCurve",values:Le}},Bo=function(Le,Pe,Me){var an=Me.target;return an+(Pe-an)*Math.exp((Me.startTime-Le)/Me.timeConstant)},ms=function(Le){return"exponentialRampToValue"===Le.type},Mi=function(Le){return"linearRampToValue"===Le.type},di=function(Le){return ms(Le)||Mi(Le)},Mo=function(Le){return"setValue"===Le.type},Zn=function(Le){return"setValueCurve"===Le.type},vt=function(Le,Pe,Me,it){var an=Le[Pe];return void 0===an?it:di(an)||Mo(an)?an.value:Zn(an)?an.values[an.values.length-1]:Bo(Me,vt(Le,Pe-1,an.startTime,it),an)},Mn=function(Le,Pe,Me,it,an){return void 0===Me?[it.insertTime,an]:di(Me)?[Me.endTime,Me.value]:Mo(Me)?[Me.startTime,Me.value]:Zn(Me)?[Me.startTime+Me.duration,Me.values[Me.values.length-1]]:[Me.startTime,vt(Le,Pe-1,Me.startTime,an)]},Gl=function(Le){return"cancelAndHold"===Le.type},tl=function(Le){return"cancelScheduledValues"===Le.type},Ln=function(Le){return Gl(Le)||tl(Le)?Le.cancelTime:ms(Le)||Mi(Le)?Le.endTime:Le.startTime},nl=function(Le,Pe,Me,it){var He=it.value;return Me===He?He:0<Me&&0<He||Me<0&&He<0?Me*Math.pow(He/Me,(Le-Pe)/(it.endTime-Pe)):0},Ac=function(Le,Pe,Me,it){return Me+(Le-Pe)/(it.endTime-Pe)*(it.value-Me)},Hu=function(Le,Pe){var an=Pe.values;return function(Le,Pe){var Me=Math.floor(Pe),it=Math.ceil(Pe);return Me===it?Le[Me]:(1-(Pe-Me))*Le[Me]+(1-(it-Pe))*Le[it]}(an,(Le-Pe.startTime)/Pe.duration*(an.length-1))},sl=function(Le){return"setTarget"===Le.type};dn.AutomationEventList=function(){return zn(function Vn(Le){Bn(this,Vn),this._automationEvents=[],this._currenTime=0,this._defaultValue=Le},[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(Pe){var Me=Ln(Pe);if(Gl(Pe)||tl(Pe)){var it=this._automationEvents.findIndex(function(Ao){return tl(Pe)&&Zn(Ao)?Ao.startTime+Ao.duration>=Me:Ln(Ao)>=Me}),an=this._automationEvents[it];if(-1!==it&&(this._automationEvents=this._automationEvents.slice(0,it)),Gl(Pe)){var He=this._automationEvents[this._automationEvents.length-1];if(void 0!==an&&di(an)){if(void 0!==He&&sl(He))throw new Error("The internal list is malformed.");var ql=void 0===He?an.insertTime:Zn(He)?He.startTime+He.duration:Ln(He),ka=void 0===He?this._defaultValue:Zn(He)?He.values[He.values.length-1]:He.value,fo=ms(an)?nl(Me,ql,ka,an):Ac(Me,ql,ka,an),Po=ms(an)?cs(fo,Me,this._currenTime):Zs(fo,Me,this._currenTime);this._automationEvents.push(Po)}if(void 0!==He&&sl(He)&&this._automationEvents.push(ti(this.getValue(Me),Me)),void 0!==He&&Zn(He)&&He.startTime+He.duration>Me){var mr=Me-He.startTime,$l=(He.values.length-1)/He.duration,Pi=Math.max(2,1+Math.ceil(mr*$l)),rl=mr/(Pi-1)*$l,ol=He.values.slice(0,Pi);if(rl<1)for(var Ca=1;Ca<Pi;Ca+=1){var al=rl*Ca%1;ol[Ca]=He.values[Ca-1]*(1-al)+He.values[Ca]*al}this._automationEvents[this._automationEvents.length-1]=zr(ol,He.startTime,mr)}}}else{var jl=this._automationEvents.findIndex(function(Ao){return Ln(Ao)>Me}),Oc=-1===jl?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[jl-1];if(void 0!==Oc&&Zn(Oc)&&Ln(Oc)+Oc.duration>Me)return!1;var rd=ms(Pe)?cs(Pe.value,Pe.endTime,this._currenTime):Mi(Pe)?Zs(Pe.value,Me,this._currenTime):Pe;if(-1===jl)this._automationEvents.push(rd);else{if(Zn(Pe)&&Me+Pe.duration>Ln(this._automationEvents[jl]))return!1;this._automationEvents.splice(jl,0,rd)}}return!0}},{key:"flush",value:function(Pe){var Me=this._automationEvents.findIndex(function(He){return Ln(He)>Pe});if(Me>1){var it=this._automationEvents.slice(Me-1),an=it[0];sl(an)&&it.unshift(ti(vt(this._automationEvents,Me-2,an.startTime,this._defaultValue),an.startTime)),this._automationEvents=it}}},{key:"getValue",value:function(Pe){if(0===this._automationEvents.length)return this._defaultValue;var Me=this._automationEvents.findIndex(function(ol){return Ln(ol)>Pe}),it=this._automationEvents[Me],an=(-1===Me?this._automationEvents.length:Me)-1,He=this._automationEvents[an];if(void 0!==He&&sl(He)&&(void 0===it||!di(it)||it.insertTime>Pe))return Bo(Pe,vt(this._automationEvents,an-1,He.startTime,this._defaultValue),He);if(void 0!==He&&Mo(He)&&(void 0===it||!di(it)))return He.value;if(void 0!==He&&Zn(He)&&(void 0===it||!di(it)||He.startTime+He.duration>Pe))return Pe<He.startTime+He.duration?Hu(Pe,He):He.values[He.values.length-1];if(void 0!==He&&di(He)&&(void 0===it||!di(it)))return He.value;if(void 0!==it&&ms(it)){var ql=Mn(this._automationEvents,an,He,it,this._defaultValue),ka=Dn(ql,2);return nl(Pe,ka[0],ka[1],it)}if(void 0!==it&&Mi(it)){var mr=Mn(this._automationEvents,an,He,it,this._defaultValue),$l=Dn(mr,2);return Ac(Pe,$l[0],$l[1],it)}return this._defaultValue}}])}(),dn.createCancelAndHoldAutomationEvent=function(Le){return{cancelTime:Le,type:"cancelAndHold"}},dn.createCancelScheduledValuesAutomationEvent=function(Le){return{cancelTime:Le,type:"cancelScheduledValues"}},dn.createExponentialRampToValueAutomationEvent=function(Le,Pe){return{endTime:Pe,type:"exponentialRampToValue",value:Le}},dn.createLinearRampToValueAutomationEvent=function(Le,Pe){return{endTime:Pe,type:"linearRampToValue",value:Le}},dn.createSetTargetAutomationEvent=function(Le,Pe,Me){return{startTime:Pe,target:Le,timeConstant:Me,type:"setTarget"}},dn.createSetValueAutomationEvent=ti,dn.createSetValueCurveAutomationEvent=zr}(An,nn(715),nn(383),nn(579))},715:(Oe,An,nn)=>{var dn=nn(987),Dn=nn(156),Bn=nn(122),zn=nn(752);Oe.exports=function cs(Zs,ti){return dn(Zs)||Dn(Zs,ti)||Bn(Zs,ti)||zn()},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},736:(Oe,An,nn)=>{var dn=nn(738).default,Dn=nn(45);Oe.exports=function Bn(zn){var cs=Dn(zn,"string");return"symbol"==dn(cs)?cs:cs+""},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},738:Oe=>{function An(nn){return Oe.exports=An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(dn){return typeof dn}:function(dn){return dn&&"function"==typeof Symbol&&dn.constructor===Symbol&&dn!==Symbol.prototype?"symbol":typeof dn},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports,An(nn)}Oe.exports=An,Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},752:Oe=>{Oe.exports=function An(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports},815:(Oe,An,nn)=>{"use strict";let Dn;function Bn(){return Dn}function zn(s){const e=Dn;return Dn=s,e}nn(935);const Zs=Symbol("NotFound");function zr(s){return s===Zs||"\u0275NotFound"===s?.name}function Bo(s,e){return Object.is(s,e)}Error;let ms=null,Mi=!1,di=1;const Zn=Symbol("SIGNAL");function vt(s){const e=ms;return ms=s,e}const Ln={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function nl(s){if(Mi)throw new Error("");if(null===ms)return;ms.consumerOnSignalRead(s);const e=ms.producersTail;if(void 0!==e&&e.producer===s)return;let t;const n=ms.recomputing;if(n&&(t=void 0!==e?e.nextProducer:ms.producers,void 0!==t&&t.producer===s))return ms.producersTail=t,void(t.lastReadVersion=s.version);const i=s.consumersTail;if(void 0!==i&&i.consumer===ms&&(!n||function ql(s,e){const t=e.producersTail;if(void 0!==t){let n=e.producers;do{if(n===s)return!0;if(n===t)break;n=n.nextProducer}while(void 0!==n)}return!1}(i,ms)))return;const r=it(ms),o={producer:s,consumer:ms,nextProducer:t,prevConsumer:i,lastReadVersion:s.version,nextConsumer:void 0};ms.producersTail=o,void 0!==e?e.nextProducer=o:ms.producers=o,r&&Pe(s,o)}function Ul(s){if((!it(s)||s.dirty)&&(s.dirty||s.lastCleanEpoch!==di)){if(!s.producerMustRecompute(s)&&!Vn(s))return void il(s);s.producerRecomputeValue(s),il(s)}}function Hu(s){if(void 0===s.consumers)return;const e=Mi;Mi=!0;try{for(let t=s.consumers;void 0!==t;t=t.nextConsumer){const n=t.consumer;n.dirty||Rc(n)}}finally{Mi=e}}function sl(){return!1!==ms?.consumerAllowSignalWrites}function Rc(s){s.dirty=!0,Hu(s),s.consumerMarkedDirty?.(s)}function il(s){s.dirty=!1,s.lastCleanEpoch=di}function Ta(s){return s&&function Fc(s){s.producersTail=void 0,s.recomputing=!0}(s),vt(s)}function zl(s,e){vt(e),s&&function id(s){s.recomputing=!1;const e=s.producersTail;let t=void 0!==e?e.nextProducer:s.producers;if(void 0!==t){if(it(s))do{t=Me(t)}while(void 0!==t);void 0!==e?e.nextProducer=void 0:s.producers=void 0}}(s)}function Vn(s){for(let e=s.producers;void 0!==e;e=e.nextProducer){const t=e.producer,n=e.lastReadVersion;if(n!==t.version||(Ul(t),n!==t.version))return!0}return!1}function Le(s){if(it(s)){let e=s.producers;for(;void 0!==e;)e=Me(e)}s.producers=void 0,s.producersTail=void 0,s.consumers=void 0,s.consumersTail=void 0}function Pe(s,e){const t=s.consumersTail,n=it(s);if(void 0!==t?(e.nextConsumer=t.nextConsumer,t.nextConsumer=e):(e.nextConsumer=void 0,s.consumers=e),e.prevConsumer=t,s.consumersTail=e,!n)for(let i=s.producers;void 0!==i;i=i.nextProducer)Pe(i.producer,i)}function Me(s){const e=s.producer,t=s.nextProducer,n=s.nextConsumer,i=s.prevConsumer;if(s.nextConsumer=void 0,s.prevConsumer=void 0,void 0!==n?n.prevConsumer=i:e.consumersTail=i,void 0!==i)i.nextConsumer=n;else if(e.consumers=n,!it(e)){let r=e.producers;for(;void 0!==r;)r=Me(r)}return t}function it(s){return s.consumerIsAlwaysLive||void 0!==s.consumers}const fo=Symbol("UNSET"),Po=Symbol("COMPUTING"),mr=Symbol("ERRORED"),$l={...Ln,value:fo,dirty:!0,error:null,equal:Bo,kind:"computed",producerMustRecompute:s=>s.value===fo||s.value===Po,producerRecomputeValue(s){if(s.value===Po)throw new Error("");const e=s.value;s.value=Po;const t=Ta(s);let n,i=!1;try{n=s.computation(),vt(null),i=e!==fo&&e!==mr&&n!==mr&&s.equal(e,n)}catch(r){n=mr,s.error=r}finally{zl(s,t)}i?s.value=e:(s.value=n,s.version++)}};let rl=function Pi(){throw new Error};function ol(s){rl(s)}function jl(s,e){const t=Object.create(np);t.value=s,void 0!==e&&(t.equal=e);const n=()=>function rd(s){return nl(s),s.value}(t);return n[Zn]=t,[n,o=>Ao(t,o),o=>function Wu(s,e){sl()||ol(s),Ao(s,e(s.value))}(t,o)]}function Ao(s,e){sl()||ol(s),s.equal(s.value,e)||(s.value=e,function eS(s){s.version++,function Ac(){di++}(),Hu(s)}(s))}const np={...Ln,equal:Bo,value:void 0,kind:"signal"};function As(s){return"function"==typeof s}function od(s){const t=s(n=>{Error.call(n),n.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const ad=od(s=>function(t){s(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((n,i)=>`${i+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function Lc(s,e){if(s){const t=s.indexOf(e);0<=t&&s.splice(t,1)}}class rr{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const r of t)r.remove(this);else t.remove(this);const{initialTeardown:n}=this;if(As(n))try{n()}catch(r){e=r instanceof ad?r.errors:[r]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const r of i)try{$m(r)}catch(o){e=e??[],o instanceof ad?e=[...e,...o.errors]:e.push(o)}}if(e)throw new ad(e)}}add(e){var t;if(e&&e!==this)if(this.closed)$m(e);else{if(e instanceof rr){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Lc(t,e)}remove(e){const{_finalizers:t}=this;t&&Lc(t,e),e instanceof rr&&e._removeParent(this)}}rr.EMPTY=(()=>{const s=new rr;return s.closed=!0,s})();const zm=rr.EMPTY;function qm(s){return s instanceof rr||s&&"closed"in s&&As(s.remove)&&As(s.add)&&As(s.unsubscribe)}function $m(s){As(s)?s():s.unsubscribe()}const Yl={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ld={setTimeout(s,e,...t){const{delegate:n}=ld;return n?.setTimeout?n.setTimeout(s,e,...t):setTimeout(s,e,...t)},clearTimeout(s){const{delegate:e}=ld;return(e?.clearTimeout||clearTimeout)(s)},delegate:void 0};function jm(s){ld.setTimeout(()=>{const{onUnhandledError:e}=Yl;if(!e)throw s;e(s)})}function Uu(){}const P=I("C",void 0,void 0);function I(s,e,t){return{kind:s,value:e,error:t}}let Y=null;function ke(s){if(Yl.useDeprecatedSynchronousErrorHandling){const e=!Y;if(e&&(Y={errorThrown:!1,error:null}),s(),e){const{errorThrown:t,error:n}=Y;if(Y=null,t)throw n}}else s()}class rt extends rr{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,qm(e)&&e.add(this)):this.destination=or}static create(e,t,n){return new zt(e,t,n)}next(e){this.isStopped?Cs(function oe(s){return I("N",s,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Cs(function A(s){return I("E",void 0,s)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Cs(P,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Tt=Function.prototype.bind;function Yt(s,e){return Tt.call(s,e)}class ot{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(n){gn(n)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(n){gn(n)}else gn(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){gn(t)}}}class zt extends rt{constructor(e,t,n){let i;if(super(),As(e)||!e)i={next:e??void 0,error:t??void 0,complete:n??void 0};else{let r;this&&Yl.useDeprecatedNextContext?(r=Object.create(e),r.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&Yt(e.next,r),error:e.error&&Yt(e.error,r),complete:e.complete&&Yt(e.complete,r)}):i=e}this.destination=new ot(i)}}function gn(s){Yl.useDeprecatedSynchronousErrorHandling?function pt(s){Yl.useDeprecatedSynchronousErrorHandling&&Y&&(Y.errorThrown=!0,Y.error=s)}(s):jm(s)}function Cs(s,e){const{onStoppedNotification:t}=Yl;t&&ld.setTimeout(()=>t(s,e))}const or={closed:!0,next:Uu,error:function us(s){throw s},complete:Uu},Ai="function"==typeof Symbol&&Symbol.observable||"@@observable";function ys(s){return s}function Ue(s){return 0===s.length?ys:1===s.length?s[0]:function(t){return s.reduce((n,i)=>i(n),t)}}let Lt=(()=>{class s{constructor(t){t&&(this._subscribe=t)}lift(t){const n=new s;return n.source=this,n.operator=t,n}subscribe(t,n,i){const r=function Ds(s){return s&&s instanceof rt||function ni(s){return s&&As(s.next)&&As(s.error)&&As(s.complete)}(s)&&qm(s)}(t)?t:new zt(t,n,i);return ke(()=>{const{operator:o,source:a}=this;r.add(o?o.call(r,a):a?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(t){try{return this._subscribe(t)}catch(n){t.error(n)}}forEach(t,n){return new(n=is(n))((i,r)=>{const o=new zt({next:a=>{try{t(a)}catch(l){r(l),o.unsubscribe()}},error:r,complete:i});this.subscribe(o)})}_subscribe(t){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(t)}[Ai](){return this}pipe(...t){return Ue(t)(this)}toPromise(t){return new(t=is(t))((n,i)=>{let r;this.subscribe(o=>r=o,o=>i(o),()=>n(r))})}}return s.create=e=>new s(e),s})();function is(s){var e;return null!==(e=s??Yl.Promise)&&void 0!==e?e:Promise}const _t=od(s=>function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let xn=(()=>{class s extends Lt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const n=new mn(this,this);return n.operator=t,n}_throwIfClosed(){if(this.closed)throw new _t}next(t){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const n of this.currentObservers)n.next(t)}})}error(t){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:n}=this;for(;n.length;)n.shift().error(t)}})}complete(){ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:n,isStopped:i,observers:r}=this;return n||i?zm:(this.currentObservers=null,r.push(t),new rr(()=>{this.currentObservers=null,Lc(r,t)}))}_checkFinalizedStatuses(t){const{hasError:n,thrownError:i,isStopped:r}=this;n?t.error(i):r&&t.complete()}asObservable(){const t=new Lt;return t.source=this,t}}return s.create=(e,t)=>new mn(e,t),s})();class mn extends xn{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)}error(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:zm}}class lt extends xn{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}}class R extends Error{code;constructor(e,t){super(function E(s,e){return`${function ct(s){return`NG0${Math.abs(s)}`}(s)}${e?": "+e:""}`}(e,t)),this.code=e}}function Rt(s){for(let e in s)if(s[e]===Rt)return e;throw Error("")}function Rn(s,e){for(const t in e)e.hasOwnProperty(t)&&!s.hasOwnProperty(t)&&(s[t]=e[t])}function si(s){if("string"==typeof s)return s;if(Array.isArray(s))return`[${s.map(si).join(", ")}]`;if(null==s)return""+s;const e=s.overriddenName||s.name;if(e)return`${e}`;const t=s.toString();if(null==t)return""+t;const n=t.indexOf("\n");return n>=0?t.slice(0,n):t}function Ro(s,e){return s?e?`${s} ${e}`:s:e||""}globalThis;const Fo=Rt({__forward_ref__:Rt});function ae(s){return s.__forward_ref__=ae,s.toString=function(){return si(this())},s}function X(s){return U(s)?s():s}function U(s){return"function"==typeof s&&s.hasOwnProperty(Fo)&&s.__forward_ref__===ae}function ut(s){return{token:s.token,providedIn:s.providedIn||null,factory:s.factory,value:void 0}}function Ko(s){return{providers:s.providers||[],imports:s.imports||[]}}function xr(s){return function m5(s,e){return s.hasOwnProperty(e)&&s[e]||null}(s,Zm)}function Jm(s){return s&&s.hasOwnProperty(iS)?s[iS]:null}const Zm=Rt({\u0275prov:Rt}),iS=Rt({\u0275inj:Rt});class ve{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(e,t){this._desc=e,this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=ut({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function oS(s){return s&&!!s.\u0275providers}const aS=Rt({\u0275cmp:Rt}),v5=Rt({\u0275dir:Rt}),T5=Rt({\u0275pipe:Rt}),TN=Rt({\u0275mod:Rt}),qu=Rt({\u0275fac:Rt}),op=Rt({__NG_ELEMENT_ID__:Rt}),kN=Rt({__NG_ENV_ID__:Rt});function cn(s){return"string"==typeof s?s:null==s?"":String(s)}const lS=Rt({ngErrorCode:Rt}),CN=Rt({ngErrorMessage:Rt}),ap=Rt({ngTokenPath:Rt});function cS(s,e){return DN("",-200,e)}function uS(s,e){throw new R(-201,!1)}function DN(s,e,t){const n=new R(e,s);return n[lS]=e,n[CN]=s,t&&(n[ap]=t),n}let hS;function xN(){return hS}function po(s){const e=hS;return hS=s,e}function NN(s,e,t){const n=xr(s);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:8&t?null:void 0!==e?e:void uS()}const $u={};class E5{injector;constructor(e){this.injector=e}retrieve(e,t){const n=lp(t)||0;try{return this.injector.get(e,8&n?null:$u,n)}catch(i){if(zr(i))return i;throw i}}}function I5(s,e=0){const t=Bn();if(void 0===t)throw new R(-203,!1);if(null===t)return NN(s,void 0,e);{const n=function B5(s){return{optional:!!(8&s),host:!!(1&s),self:!!(2&s),skipSelf:!!(4&s)}}(e),i=t.retrieve(s,n);if(zr(i)){if(n.optional)return null;throw i}return i}}function Sn(s,e=0){return(xN()||I5)(X(s),e)}function le(s,e){return Sn(s,lp(e))}function lp(s){return typeof s>"u"||"number"==typeof s?s:0|(s.optional&&8)|(s.host&&1)|(s.self&&2)|(s.skipSelf&&4)}function fS(s){const e=[];for(let t=0;t<s.length;t++){const n=X(s[t]);if(Array.isArray(n)){if(0===n.length)throw new R(900,!1);let i,r=0;for(let o=0;o<n.length;o++){const a=n[o],l=M5(a);"number"==typeof l?-1===l?i=a.token:r|=l:i=a}e.push(Sn(i,r))}else e.push(Sn(n))}return e}function M5(s){return s.__NG_DI_FLAG__}function ju(s,e){return s.hasOwnProperty(qu)?s[qu]:null}function cd(s,e){s.forEach(t=>Array.isArray(t)?cd(t,e):e(t))}function IN(s,e,t){e>=s.length?s.push(t):s.splice(e,0,t)}function Km(s,e){return e>=s.length-1?s.pop():s.splice(e,1)[0]}function ty(s,e,t){let n=up(s,e);return n>=0?s[1|n]=t:(n=~n,function MN(s,e,t,n){let i=s.length;if(i==e)s.push(t,n);else if(1===i)s.push(n,s[0]),s[0]=t;else{for(i--,s.push(s[i-1],s[i]);i>e;)s[i]=s[i-2],i--;s[e]=t,s[e+1]=n}}(s,n,e,t)),n}function pS(s,e){const t=up(s,e);if(t>=0)return s[1|t]}function up(s,e){return function A5(s,e,t){let n=0,i=s.length>>t;for(;i!==n;){const r=n+(i-n>>1),o=s[r<<t];if(e===o)return r<<t;o>e?i=r:n=r+1}return~(i<<t)}(s,e,1)}const ul={},Ls=[],Wc=new ve(""),PN=new ve("",-1),gS=new ve("");class ny{get(e,t=$u){if(t===$u){const i=DN("",-201);throw i.name="\u0275NotFound",i}return t}}function hl(s){return s[TN]||null}function hs(s){return s[aS]||null}function qr(s){return s[v5]||null}function xa(s){return s[T5]||null}function sy(s){return{\u0275providers:s}}function F5(...s){return{\u0275providers:yS(0,s),\u0275fromNgModule:!0}}function yS(s,...e){const t=[],n=new Set;let i;const r=o=>{t.push(o)};return cd(e,o=>{const a=o;iy(a,r,[],n)&&(i||=[],i.push(a))}),void 0!==i&&AN(i,r),t}function AN(s,e){for(let t=0;t<s.length;t++){const{ngModule:n,providers:i}=s[t];_S(i,r=>{e(r,n)})}}function iy(s,e,t,n){if(!(s=X(s)))return!1;let i=null,r=Jm(s);const o=!r&&hs(s);if(r||o){if(o&&!o.standalone)return!1;i=s}else{const l=s.ngModule;if(r=Jm(l),!r)return!1;i=l}const a=n.has(i);if(o){if(a)return!1;if(n.add(i),o.dependencies){const l="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const c of l)iy(c,e,t,n)}}else{if(!r)return!1;{if(null!=r.imports&&!a){let c;n.add(i);try{cd(r.imports,u=>{iy(u,e,t,n)&&(c||=[],c.push(u))})}finally{}void 0!==c&&AN(c,e)}if(!a){const c=ju(i)||(()=>new i);e({provide:i,useFactory:c,deps:Ls},i),e({provide:gS,useValue:i,multi:!0},i),e({provide:Wc,useValue:()=>Sn(i),multi:!0},i)}const l=r.providers;if(null!=l&&!a){const c=s;_S(l,u=>{e(u,c)})}}}return i!==s&&void 0!==s.providers}function _S(s,e){for(let t of s)oS(t)&&(t=t.\u0275providers),Array.isArray(t)?_S(t,e):e(t)}const O5=Rt({provide:String,useValue:Rt});function bS(s){return null!==s&&"object"==typeof s&&O5 in s}function Xl(s){return"function"==typeof s}const wS=new ve(""),ry={},LN={};let SS;function vS(){return void 0===SS&&(SS=new ny),SS}class $r{}class Yu extends $r{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(e,t,n,i){super(),this.parent=t,this.source=n,this.scopes=i,kS(e,o=>this.processProvider(o)),this.records.set(PN,hd(void 0,this)),i.has("environment")&&this.records.set($r,hd(void 0,this));const r=this.records.get(wS);null!=r&&"string"==typeof r.value&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(gS,Ls,{self:!0}))}retrieve(e,t){const n=lp(t)||0;try{return this.get(e,$u,n)}catch(i){if(zr(i))return i;throw i}}destroy(){hp(this),this._destroyed=!0;const e=vt(null);try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const n of t)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),vt(e)}}onDestroy(e){return hp(this),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){hp(this);const t=zn(this),n=po(void 0);try{return e()}finally{zn(t),po(n)}}get(e,t=$u,n){if(hp(this),e.hasOwnProperty(kN))return e[kN](this);const i=lp(n),o=zn(this),a=po(void 0);try{if(!(4&i)){let c=this.records.get(e);if(void 0===c){const u=function G5(s){return"function"==typeof s||"object"==typeof s&&"InjectionToken"===s.ngMetadataName}(e)&&xr(e);c=u&&this.injectableDefInScope(u)?hd(TS(e),ry):null,this.records.set(e,c)}if(null!=c)return this.hydrate(e,c,i)}return(2&i?vS():this.parent).get(e,t=8&i&&t===$u?null:t)}catch(l){const c=function x5(s){return s[lS]}(l);throw-200===c||-201===c?new R(c,null):l}finally{po(a),zn(o)}}resolveInjectorInitializers(){const e=vt(null),t=zn(this),n=po(void 0);try{const r=this.get(Wc,Ls,{self:!0});for(const o of r)o()}finally{zn(t),po(n),vt(e)}}toString(){const e=[],t=this.records;for(const n of t.keys())e.push(si(n));return`R3Injector[${e.join(", ")}]`}processProvider(e){let t=Xl(e=X(e))?e:X(e&&e.provide);const n=function V5(s){return bS(s)?hd(void 0,s.useValue):hd(VN(s),ry)}(e);if(!Xl(e)&&!0===e.multi){let i=this.records.get(t);i||(i=hd(void 0,ry,!0),i.factory=()=>fS(i.multi),this.records.set(t,i)),t=e,i.multi.push(e)}this.records.set(t,n)}hydrate(e,t,n){const i=vt(null);try{if(t.value===LN)throw cS(si(e));return t.value===ry&&(t.value=LN,t.value=t.factory(void 0,n)),"object"==typeof t.value&&t.value&&function W5(s){return null!==s&&"object"==typeof s&&"function"==typeof s.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{vt(i)}}injectableDefInScope(e){if(!e.providedIn)return!1;const t=X(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){const t=this._onDestroyHooks.indexOf(e);-1!==t&&this._onDestroyHooks.splice(t,1)}}function TS(s){const e=xr(s),t=null!==e?e.factory:ju(s);if(null!==t)return t;if(s instanceof ve)throw new R(204,!1);if(s instanceof Function)return function L5(s){if(s.length>0)throw new R(204,!1);const t=function y5(s){return(s?.[Zm]??null)||null}(s);return null!==t?()=>t.factory(s):()=>new s}(s);throw new R(204,!1)}function VN(s,e,t){let n;if(Xl(s)){const i=X(s);return ju(i)||TS(i)}if(bS(s))n=()=>X(s.useValue);else if(function FN(s){return!(!s||!s.useFactory)}(s))n=()=>s.useFactory(...fS(s.deps||[]));else if(function RN(s){return!(!s||!s.useExisting)}(s))n=(i,r)=>Sn(X(s.useExisting),void 0!==r&&8&r?8:void 0);else{const i=X(s&&(s.useClass||s.provide));if(!function H5(s){return!!s.deps}(s))return ju(i)||TS(i);n=()=>new i(...fS(s.deps))}return n}function hp(s){if(s.destroyed)throw new R(205,!1)}function hd(s,e,t=!1){return{factory:s,value:e,multi:t?[]:void 0}}function kS(s,e){for(const t of s)Array.isArray(t)?kS(t,e):t&&oS(t)?kS(t.\u0275providers,e):e(t)}function na(s,e){let t;s instanceof Yu?(hp(s),t=s):t=new E5(s);const i=zn(t),r=po(void 0);try{return e()}finally{zn(i),po(r)}}function ii(s){return Array.isArray(s)&&"object"==typeof s[1]}function jr(s){return Array.isArray(s)&&!0===s[1]}function WN(s){return!!(4&s.flags)}function Ql(s){return s.componentOffset>-1}function md(s){return!(1&~s.flags)}function Lo(s){return!!s.template}function qc(s){return!!(512&s[2])}function Kl(s){return!(256&~s[2])}function cr(s){for(;Array.isArray(s);)s=s[0];return s}function yd(s,e){return cr(e[s])}function Fi(s,e){return cr(e[s.index])}function _d(s,e){return s.data[e]}function Qu(s,e){return s[e]}function Yr(s,e){const t=e[s];return ii(t)?t:t[0]}function ES(s){return!(128&~s[2])}function Er(s,e){return null==e?null:s[e]}function jN(s){s[17]=0}function YN(s){1024&s[2]||(s[2]|=1024,ES(s)&&bd(s))}function cy(s){return!!(9216&s[2]||s[24]?.dirty)}function IS(s){s[10].changeDetectionScheduler?.notify(8),64&s[2]&&(s[2]|=1024),cy(s)&&bd(s)}function bd(s){s[10].changeDetectionScheduler?.notify(0);let e=ec(s);for(;null!==e&&!(8192&e[2])&&(e[2]|=8192,ES(e));)e=ec(e)}function uy(s,e){if(Kl(s))throw new R(911,!1);null===s[21]&&(s[21]=[]),s[21].push(e)}function ec(s){const e=s[3];return jr(e)?e[3]:e}function JN(s){return s[7]??=[]}function ZN(s){return s.cleanup??=[]}const Zt={lFrame:dE(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let PS=!1;function AS(){return Zt.bindingsEnabled}function ee(){return Zt.lFrame.lView}function yn(){return Zt.lFrame.tView}function xt(s){return Zt.lFrame.contextLView=s,s[8]}function Nt(s){return Zt.lFrame.contextLView=null,s}function sn(){let s=nE();for(;null!==s&&64===s.type;)s=s.parent;return s}function nE(){return Zt.lFrame.currentTNode}function tc(s,e){const t=Zt.lFrame;t.currentTNode=s,t.isParent=e}function sE(){return Zt.lFrame.isParent}function aE(){return PS}function hy(s){const e=PS;return PS=s,e}function Xr(){const s=Zt.lFrame;let e=s.bindingRootIndex;return-1===e&&(e=s.bindingRootIndex=s.tView.bindingStartIndex),e}function go(){return Zt.lFrame.bindingIndex++}function sc(s){const e=Zt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+s,t}function t4(s,e){const t=Zt.lFrame;t.bindingIndex=t.bindingRootIndex=s,RS(e)}function RS(s){Zt.lFrame.currentDirectiveIndex=s}function OS(){return Zt.lFrame.currentQueryIndex}function dy(s){Zt.lFrame.currentQueryIndex=s}function s4(s){const e=s[1];return 2===e.type?e.declTNode:1===e.type?s[5]:null}function uE(s,e,t){if(4&t){let i=e,r=s;for(;!(i=i.parent,null!==i||1&t||(i=s4(r),null===i||(r=r[14],10&i.type))););if(null===i)return!1;e=i,s=r}const n=Zt.lFrame=hE();return n.currentTNode=e,n.lView=s,!0}function LS(s){const e=hE(),t=s[1];Zt.lFrame=e,e.currentTNode=t.firstChild,e.lView=s,e.tView=t,e.contextLView=s,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function hE(){const s=Zt.lFrame,e=null===s?null:s.child;return null===e?dE(s):e}function dE(s){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:s,child:null,inI18n:!1};return null!==s&&(s.child=e),e}function fE(){const s=Zt.lFrame;return Zt.lFrame=s.parent,s.currentTNode=null,s.lView=null,s}const pE=fE;function VS(){const s=fE();s.isParent=!0,s.tView=null,s.selectedIndex=-1,s.contextLView=null,s.elementDepthCount=0,s.currentDirectiveIndex=-1,s.currentNamespace=null,s.bindingRootIndex=-1,s.bindingIndex=-1,s.currentQueryIndex=0}function yr(){return Zt.lFrame.selectedIndex}function Ku(s){Zt.lFrame.selectedIndex=s}function dl(){const s=Zt.lFrame;return _d(s.tView,s.selectedIndex)}function Jr(){Zt.lFrame.currentNamespace="svg"}let gE=!0;function fy(){return gE}function gp(s){gE=s}function mE(s,e=null,t=null,n){const i=yE(s,e,t,n);return i.resolveInjectorInitializers(),i}function yE(s,e=null,t=null,n,i=new Set){const r=[t||Ls,F5(s)];return n=n||("object"==typeof s?void 0:si(s)),new Yu(r,e||vS(),n||null,i)}class Vo{static THROW_IF_NOT_FOUND=$u;static NULL=new ny;static create(e,t){if(Array.isArray(e))return mE({name:""},t,e,"");{const n=e.name??"";return mE({name:n},e.parent,e.providers,n)}}static \u0275prov=ut({token:Vo,providedIn:"any",factory:()=>Sn(PN)});static __NG_ELEMENT_ID__=-1}const Na=new ve("");let fl=(()=>class s{static __NG_ELEMENT_ID__=c4;static __NG_ENV_ID__=t=>t})();class _E extends fl{_lView;constructor(e){super(),this._lView=e}get destroyed(){return Kl(this._lView)}onDestroy(e){const t=this._lView;return uy(t,e),()=>function BS(s,e){if(null===s[21])return;const t=s[21].indexOf(e);-1!==t&&s[21].splice(t,1)}(t,e)}}function c4(){return new _E(ee())}class Sd{_console=console;handleError(e){this._console.error("ERROR",e)}}const Ea=new ve("",{providedIn:"root",factory:()=>{const s=le($r);let e;return t=>{s.destroyed&&!e?setTimeout(()=>{throw t}):(e??=s.get(Sd),e.handleError(t))}}}),bE={provide:Wc,useValue:()=>{le(Sd)},multi:!0};function ic(s,e){const[t,n,i]=jl(s,e?.equal),r=t;return r.set=n,r.update=i,r.asReadonly=HS.bind(r),r}function HS(){const s=this[Zn];if(void 0===s.readonlyFn){const e=()=>this();e[Zn]=s,s.readonlyFn=e}return s.readonlyFn}function SE(s){return function wE(s){return"function"==typeof s&&void 0!==s[Zn]}(s)&&"function"==typeof s.set}class eh{}const WS=new ve("",{providedIn:"root",factory:()=>!1}),vE=new ve(""),TE=new ve("");let GS=(()=>class s{view;node;constructor(t,n){this.view=t,this.node=n}static __NG_ELEMENT_ID__=h4})();function h4(){return new GS(ee(),sn())}let $c=(()=>{class s{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new lt(!1);get hasPendingTasks(){return!this.destroyed&&this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new Lt(t=>{t.next(!1),t.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}has(t){return this.pendingTasks.has(t)}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=ut({token:s,providedIn:"root",factory:()=>new s})}return s})();function mp(...s){}let CE=(()=>{class s{static \u0275prov=ut({token:s,providedIn:"root",factory:()=>new d4})}return s})();class d4{dirtyEffectCount=0;queues=new Map;add(e){this.enqueue(e),this.schedule(e)}schedule(e){e.dirty&&this.dirtyEffectCount++}remove(e){const n=this.queues.get(e.zone);n.has(e)&&(n.delete(e),e.dirty&&this.dirtyEffectCount--)}enqueue(e){const t=e.zone;this.queues.has(t)||this.queues.set(t,new Set);const n=this.queues.get(t);n.has(e)||n.add(e)}flush(){for(;this.dirtyEffectCount>0;){let e=!1;for(const[t,n]of this.queues)e||=null===t?this.flushQueue(n):t.run(()=>this.flushQueue(n));e||(this.dirtyEffectCount=0)}}flushQueue(e){let t=!1;for(const n of e)n.dirty&&(this.dirtyEffectCount--,t=!0,n.run());return t}}let DE=null;function jc(){return DE}class p4{}let xE=(()=>{class s{historyGo(t){throw new Error("")}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:()=>le(g4),providedIn:"platform"})}return s})(),g4=(()=>{class s extends xE{_location;_history;_doc=le(Na);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return jc().getBaseHref(this._doc)}onPopState(t){const n=jc().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",t,!1),()=>n.removeEventListener("popstate",t)}onHashChange(t){const n=jc().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",t,!1),()=>n.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,n,i){this._history.pushState(t,n,i)}replaceState(t,n,i){this._history.replaceState(t,n,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:()=>new s,providedIn:"platform"})}return s})();function NE(s,e){return s?e?s.endsWith("/")?e.startsWith("/")?s+e.slice(1):s+e:e.startsWith("/")?s+e:`${s}/${e}`:s:e}function EE(s){const e=s.search(/#|\?|$/);return"/"===s[e-1]?s.slice(0,e-1)+s.slice(e):s}function th(s){return s&&"?"!==s[0]?`?${s}`:s}let py=(()=>{class s{historyGo(t){throw new Error("")}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:()=>le(y4),providedIn:"root"})}return s})();const m4=new ve("");let y4=(()=>{class s extends py{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,n){super(),this._platformLocation=t,this._baseHref=n??this._platformLocation.getBaseHrefFromDOM()??le(Na).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return NE(this._baseHref,t)}path(t=!1){const n=this._platformLocation.pathname+th(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${n}${i}`:n}pushState(t,n,i,r){const o=this.prepareExternalUrl(i+th(r));this._platformLocation.pushState(t,n,o)}replaceState(t,n,i,r){const o=this.prepareExternalUrl(i+th(r));this._platformLocation.replaceState(t,n,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(n){return new(n||s)(Sn(xE),Sn(m4,8))};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),yp=(()=>{class s{_subject=new xn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;const n=this._locationStrategy.getBaseHref();this._basePath=function w4(s){if(new RegExp("^(https?:)?//").test(s)){const[,t]=s.split(/\/\/[^\/]+/);return t}return s}(EE(IE(n))),this._locationStrategy.onPopState(i=>{this._subject.next({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,n=""){return this.path()==this.normalize(t+th(n))}normalize(t){return s.stripTrailingSlash(function b4(s,e){if(!s||!e.startsWith(s))return e;const t=e.substring(s.length);return""===t||["/",";","?","#"].includes(t[0])?t:e}(this._basePath,IE(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,n="",i=null){this._locationStrategy.pushState(i,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+th(n)),i)}replaceState(t,n="",i=null){this._locationStrategy.replaceState(i,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+th(n)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)}),()=>{const n=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(n,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",n){this._urlChangeListeners.forEach(i=>i(t,n))}subscribe(t,n,i){return this._subject.subscribe({next:t,error:n??void 0,complete:i??void 0})}static normalizeQueryParams=th;static joinWithSlash=NE;static stripTrailingSlash=EE;static \u0275fac=function(n){return new(n||s)(Sn(py))};static \u0275prov=ut({token:s,factory:()=>function _4(){return new yp(Sn(py))}(),providedIn:"root"})}return s})();function IE(s){return s.replace(/\/index.html$/,"")}function GE(s,e,t,n,i,r,o){try{var a=s[r](o),l=a.value}catch(c){return void t(c)}a.done?e(l):Promise.resolve(l).then(n,i)}function Ae(s){return function(){var e=this,t=arguments;return new Promise(function(n,i){var r=s.apply(e,t);function o(l){GE(r,n,i,o,a,"next",l)}function a(l){GE(r,n,i,o,a,"throw",l)}o(void 0)})}}function UE(s){return As(s?.lift)}function Oi(s){return e=>{if(UE(e))return e.lift(function(t){try{return s(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function pi(s,e,t,n,i){return new Q4(s,e,t,n,i)}class Q4 extends rt{constructor(e,t,n,i,r,o){super(e),this.onFinalize=r,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=i?function(a){try{i(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function Kn(s,e){return Oi((t,n)=>{let i=0;t.subscribe(pi(n,r=>{n.next(s.call(e,r,i++))}))})}function rc(s){return{toString:s}.toString()}class hW{previousValue;currentValue;firstChange;constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function $E(s,e,t,n){null!==e?e.applyValueToInputSignal(e,n):s[t]=n}const ra=(()=>{const s=()=>jE;return s.ngInherit=!0,s})();function jE(s){return s.type.prototype.ngOnChanges&&(s.setInput=fW),dW}function dW(){const s=XE(this),e=s?.current;if(e){const t=s.previous;if(t===ul)s.previous=e;else for(let n in e)t[n]=e[n];s.current=null,this.ngOnChanges(e)}}function fW(s,e,t,n,i){const r=this.declaredInputs[n],o=XE(s)||function pW(s,e){return s[YE]=e}(s,{previous:ul,current:null}),a=o.current||(o.current={}),l=o.previous,c=l[r];a[r]=new hW(c&&c.currentValue,t,l===ul),$E(s,e,i,t)}const YE="__ngSimpleChanges__";function XE(s){return s[YE]||null}const nh=[],ds=function(s,e=null,t){for(let n=0;n<nh.length;n++)(0,nh[n])(s,e,t)};function JE(s,e){for(let t=e.directiveStart,n=e.directiveEnd;t<n;t++){const r=s.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=r;o&&(s.contentHooks??=[]).push(-t,o),a&&((s.contentHooks??=[]).push(t,a),(s.contentCheckHooks??=[]).push(t,a)),l&&(s.viewHooks??=[]).push(-t,l),c&&((s.viewHooks??=[]).push(t,c),(s.viewCheckHooks??=[]).push(t,c)),null!=u&&(s.destroyHooks??=[]).push(t,u)}}function by(s,e,t){ZE(s,e,3,t)}function wy(s,e,t,n){(3&s[2])===t&&ZE(s,e,t,n)}function YS(s,e){let t=s[2];(3&t)===e&&(t&=16383,t+=1,s[2]=t)}function ZE(s,e,t,n){const r=n??-1,o=e.length-1;let a=0;for(let l=void 0!==n?65535&s[17]:0;l<o;l++)if("number"==typeof e[l+1]){if(a=e[l],null!=n&&a>=n)break}else e[l]<0&&(s[17]+=65536),(a<r||-1==r)&&(bW(s,t,e,l),s[17]=(4294901760&s[17])+l+2),l++}function QE(s,e){ds(4,s,e);const t=vt(null);try{e.call(s)}finally{vt(t),ds(5,s,e)}}function bW(s,e,t,n){const i=t[n]<0,r=t[n+1],a=s[i?-t[n]:t[n]];i?s[2]>>14<s[17]>>16&&(3&s[2])===e&&(s[2]+=16384,QE(a,r)):QE(a,r)}class vp{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(e,t,n,i){this.factory=e,this.name=i,this.canSeeViewProviders=t,this.injectImpl=n}}function e1(s){return 3===s||4===s||6===s}function t1(s){return 64===s.charCodeAt(0)}function xd(s,e){if(null!==e&&0!==e.length)if(null===s||0===s.length)s=e.slice();else{let t=-1;for(let n=0;n<e.length;n++){const i=e[n];"number"==typeof i?t=i:0===t||n1(s,t,i,0,-1===t||2===t?e[++n]:null)}}return s}function n1(s,e,t,n,i){let r=0,o=s.length;if(-1===e)o=-1;else for(;r<s.length;){const a=s[r++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=r-1;break}}}for(;r<s.length;){const a=s[r];if("number"==typeof a)break;if(a===t)return void(null!==i&&(s[r+1]=i));r++,null!==i&&r++}-1!==o&&(s.splice(o,0,e),r=o+1),s.splice(r++,0,t),null!==i&&s.splice(r++,0,i)}function JS(s){return-1!==s}function Tp(s){return 32767&s}function kp(s,e){let t=function TW(s){return s>>16}(s),n=e;for(;t>0;)n=n[14],t--;return n}let ZS=!0;function Sy(s){const e=ZS;return ZS=s,e}let kW=0;const pl={};function vy(s,e){const t=r1(s,e);if(-1!==t)return t;const n=e[1];n.firstCreatePass&&(s.injectorIndex=e.length,QS(n.data,s),QS(e,null),QS(n.blueprint,null));const i=Ty(s,e),r=s.injectorIndex;if(JS(i)){const o=Tp(i),a=kp(i,e),l=a[1].data;for(let c=0;c<8;c++)e[r+c]=a[o+c]|l[o+c]}return e[r+8]=i,r}function QS(s,e){s.push(0,0,0,0,0,0,0,0,e)}function r1(s,e){return-1===s.injectorIndex||s.parent&&s.parent.injectorIndex===s.injectorIndex||null===e[s.injectorIndex+8]?-1:s.injectorIndex}function Ty(s,e){if(s.parent&&-1!==s.parent.injectorIndex)return s.parent.injectorIndex;let t=0,n=null,i=e;for(;null!==i;){if(n=d1(i),null===n)return-1;if(t++,i=i[14],-1!==n.injectorIndex)return n.injectorIndex|t<<16}return-1}function KS(s,e,t){!function CW(s,e,t){let n;"string"==typeof t?n=t.charCodeAt(0)||0:t.hasOwnProperty(op)&&(n=t[op]),null==n&&(n=t[op]=kW++);const i=255&n;e.data[s+(i>>5)]|=1<<i}(s,e,t)}function o1(s,e,t){if(8&t||void 0!==s)return s;uS()}function a1(s,e,t,n){if(8&t&&void 0===n&&(n=null),!(3&t)){const i=s[9],r=po(void 0);try{return i?i.get(e,n,8&t):NN(e,n,8&t)}finally{po(r)}}return o1(n,0,t)}function l1(s,e,t,n=0,i){if(null!==s){if(2048&e[2]&&!(2&n)){const o=function IW(s,e,t,n,i){let r=s,o=e;for(;null!==r&&null!==o&&2048&o[2]&&!qc(o);){const a=c1(r,o,t,2|n,pl);if(a!==pl)return a;let l=r.parent;if(!l){const c=o[20];if(c){const u=c.get(t,pl,n);if(u!==pl)return u}l=d1(o),o=o[14]}r=l}return i}(s,e,t,n,pl);if(o!==pl)return o}const r=c1(s,e,t,n,pl);if(r!==pl)return r}return a1(e,t,n,i)}function c1(s,e,t,n,i){const r=function NW(s){if("string"==typeof s)return s.charCodeAt(0)||0;const e=s.hasOwnProperty(op)?s[op]:void 0;return"number"==typeof e?e>=0?255&e:EW:e}(t);if("function"==typeof r){if(!uE(e,s,n))return 1&n?o1(i,0,n):a1(e,t,n,i);try{let o;if(o=r(n),null!=o||8&n)return o;uS()}finally{pE()}}else if("number"==typeof r){let o=null,a=r1(s,e),l=-1,c=1&n?e[15][5]:null;for((-1===a||4&n)&&(l=-1===a?Ty(s,e):e[a+8],-1!==l&&h1(n,!1)?(o=e[1],a=Tp(l),e=kp(l,e)):a=-1);-1!==a;){const u=e[1];if(u1(r,a,u.data)){const h=xW(a,e,t,o,n,c);if(h!==pl)return h}l=e[a+8],-1!==l&&h1(n,e[1].data[a+8]===c)&&u1(r,a,e)?(o=u,a=Tp(l),e=kp(l,e)):a=-1}}return i}function xW(s,e,t,n,i,r){const o=e[1],a=o.data[s+8],u=ky(a,o,t,null==n?Ql(a)&&ZS:n!=o&&!!(3&a.type),1&i&&r===a);return null!==u?Cp(e,o,u,a,i):pl}function ky(s,e,t,n,i){const r=s.providerIndexes,o=e.data,a=1048575&r,l=s.directiveStart,u=r>>20,d=i?a+u:s.directiveEnd;for(let p=n?a:a+u;p<d;p++){const g=o[p];if(p<l&&t===g||p>=l&&g.type===t)return p}if(i){const p=o[l];if(p&&Lo(p)&&p.type===t)return l}return null}function Cp(s,e,t,n,i){let r=s[t];const o=e.data;if(r instanceof vp){const a=r;if(a.resolving)throw function Hn(s){return"function"==typeof s?s.name||s.toString():"object"==typeof s&&null!=s&&"function"==typeof s.type?s.type.name||s.type.toString():cn(s)}(o[t]),cS();const l=Sy(a.canSeeViewProviders);a.resolving=!0;const h=a.injectImpl?po(a.injectImpl):null;uE(s,n,0);try{r=s[t]=a.factory(void 0,i,o,s,n),e.firstCreatePass&&t>=n.directiveStart&&function _W(s,e,t){const{ngOnChanges:n,ngOnInit:i,ngDoCheck:r}=e.type.prototype;if(n){const o=jE(e);(t.preOrderHooks??=[]).push(s,o),(t.preOrderCheckHooks??=[]).push(s,o)}i&&(t.preOrderHooks??=[]).push(0-s,i),r&&((t.preOrderHooks??=[]).push(s,r),(t.preOrderCheckHooks??=[]).push(s,r))}(t,o[t],e)}finally{null!==h&&po(h),Sy(l),a.resolving=!1,pE()}}return r}function u1(s,e,t){return!!(t[e+(s>>5)]&1<<s)}function h1(s,e){return!(2&s||1&s&&e)}class gi{_tNode;_lView;constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return l1(this._tNode,this._lView,e,lp(n),t)}}function EW(){return new gi(sn(),ee())}function ur(s){return rc(()=>{const e=s.prototype.constructor,t=e[qu]||ev(e),n=Object.prototype;let i=Object.getPrototypeOf(s.prototype).constructor;for(;i&&i!==n;){const r=i[qu]||ev(i);if(r&&r!==t)return r;i=Object.getPrototypeOf(i)}return r=>new r})}function ev(s){return U(s)?()=>{const e=ev(X(s));return e&&e()}:ju(s)}function d1(s){const e=s[1],t=e.type;return 2===t?e.declTNode:1===t?s[5]:null}function LW(){return Nd(sn(),ee())}function Nd(s,e){return new Ho(Fi(s,e))}let Ho=(()=>class s{nativeElement;constructor(t){this.nativeElement=t}static __NG_ELEMENT_ID__=LW})();function y1(s){return s instanceof Ho?s.nativeElement:s}function VW(){return this._results[Symbol.iterator]()}class HW{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new xn}constructor(e=!1){this._emitDistinctChangesOnly=e}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;const n=function ta(s){return s.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function P5(s,e,t){if(s.length!==e.length)return!1;for(let n=0;n<s.length;n++){let i=s[n],r=e[n];if(t&&(i=t(i),r=t(r)),r!==i)return!1}return!0}(this._results,n,t))&&(this._results=n,this.length=n.length,this.last=n[this.length-1],this.first=n[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=VW}function xp(s){return!(128&~s.flags)}var Dy=function(s){return s[s.OnPush=0]="OnPush",s[s.Default=1]="Default",s}(Dy||{});const xy=new Map;let UW=0;function sv(s){xy.delete(s[19])}const rv="__ngContext__";function yo(s,e){ii(e)?(s[rv]=e[19],function qW(s){xy.set(s[19],s)}(e)):s[rv]=e}function N1(s){return I1(s[12])}function E1(s){return I1(s[4])}function I1(s){for(;null!==s&&!jr(s);)s=s[4];return s}let ov;const Ep=new ve("",{providedIn:"root",factory:()=>f8}),f8="ng",O1=new ve(""),av=new ve("",{providedIn:"platform",factory:()=>"unknown"}),L1=new ve("",{providedIn:"root",factory:()=>function Xc(){if(void 0!==ov)return ov;if(typeof document<"u")return document;throw new R(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null}),S8=new ve("",{providedIn:"root",factory:()=>!1});function My(s){return!(32&~s.flags)}function cI(s,e){const t=s.contentQueries;if(null!==t){const n=vt(null);try{for(let i=0;i<t.length;i+=2){const o=t[i+1];if(-1!==o){const a=s.data[o];dy(t[i]),a.contentQueries(2,e[o],o)}}}finally{vt(n)}}}function kv(s,e,t){dy(0);const n=vt(null);try{e(s,t)}finally{vt(n)}}function Cv(s,e,t){if(WN(e)){const n=vt(null);try{const r=e.directiveEnd;for(let o=e.directiveStart;o<r;o++){const a=s.data[o];a.contentQueries&&a.contentQueries(1,t[o],o)}}finally{vt(n)}}}var oc=function(s){return s[s.Emulated=0]="Emulated",s[s.None=2]="None",s[s.ShadowDom=3]="ShadowDom",s}(oc||{});class pI{changingThisBreaksApplicationSecurity;constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss)`}}const S6=/^>|^->|<!--|-->|--!>|<!-$/g,v6=/(<|>)/g;function gl(s){return s instanceof Function?s():s}function R6(s,e,t){let n=s.length;for(;;){const i=s.indexOf(e,t);if(-1===i)return i;if(0===i||s.charCodeAt(i-1)<=32){const r=e.length;if(i+r===n||s.charCodeAt(i+r)<=32)return i}t=i+1}}const AI="ng-template";function F6(s,e,t,n){let i=0;if(n){for(;i<e.length&&"string"==typeof e[i];i+=2)if("class"===e[i]&&-1!==R6(e[i+1].toLowerCase(),t,0))return!0}else if(Pv(s))return!1;if(i=e.indexOf(1,i),i>-1){let r;for(;++i<e.length&&"string"==typeof(r=e[i]);)if(r.toLowerCase()===t)return!0}return!1}function Pv(s){return 4===s.type&&s.value!==AI}function O6(s,e,t){return e===(4!==s.type||t?s.value:AI)}function L6(s,e,t){let n=4;const i=s.attrs,r=null!==i?function W6(s){for(let e=0;e<s.length;e++)if(e1(s[e]))return e;return s.length}(i):0;let o=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!o)if(4&n){if(n=2|1&n,""!==l&&!O6(s,l,t)||""===l&&1===e.length){if(Ia(n))return!1;o=!0}}else if(8&n){if(null===i||!F6(s,i,l,t)){if(Ia(n))return!1;o=!0}}else{const c=e[++a],u=V6(l,i,Pv(s),t);if(-1===u){if(Ia(n))return!1;o=!0;continue}if(""!==c){let h;if(h=u>r?"":i[u+1].toLowerCase(),2&n&&c!==h){if(Ia(n))return!1;o=!0}}}}else{if(!o&&!Ia(n)&&!Ia(l))return!1;if(o&&Ia(l))continue;o=!1,n=l|1&n}}return Ia(n)||o}function Ia(s){return!(1&s)}function V6(s,e,t,n){if(null===e)return-1;let i=0;if(n||!t){let r=!1;for(;i<e.length;){const o=e[i];if(o===s)return i;if(3===o||6===o)r=!0;else{if(1===o||2===o){let a=e[++i];for(;"string"==typeof a;)a=e[++i];continue}if(4===o)break;if(0===o){i+=4;continue}}i+=r?1:2}return-1}return function G6(s,e){let t=s.indexOf(4);if(t>-1)for(t++;t<s.length;){const n=s[t];if("number"==typeof n)return-1;if(n===e)return t;t++}return-1}(e,s)}function RI(s,e,t=!1){for(let n=0;n<e.length;n++)if(L6(s,e[n],t))return!0;return!1}function FI(s,e){return s?":not("+e.trim()+")":e}function z6(s){let e=s[0],t=1,n=2,i="",r=!1;for(;t<s.length;){let o=s[t];if("string"==typeof o)if(2&n){const a=s[++t];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&n?i+="."+o:4&n&&(i+=" "+o);else""!==i&&!Ia(o)&&(e+=FI(r,i),i=""),n=o,r=r||!Ia(n);t++}return""!==i&&(e+=FI(r,i)),e}const _s={};function Rv(s,e){return s.createComment(function DI(s){return s.replace(S6,e=>e.replace(v6,"\u200b$1\u200b"))}(e))}function Gy(s,e,t){return s.createElement(e,t)}function ih(s,e,t,n,i){s.insertBefore(e,t,n,i)}function LI(s,e,t){s.appendChild(e,t)}function VI(s,e,t,n,i){null!==n?ih(s,e,t,n,i):LI(s,e,t)}function WI(s,e,t){const{mergedAttrs:n,classes:i,styles:r}=t;null!==n&&function vW(s,e,t){let n=0;for(;n<t.length;){const i=t[n];if("number"==typeof i){if(0!==i)break;n++;const r=t[n++],o=t[n++],a=t[n++];s.setAttribute(e,o,a,r)}else{const r=i,o=t[++n];t1(r)?s.setProperty(e,r,o):s.setAttribute(e,r,o),n++}}}(s,e,n),null!==i&&function Y6(s,e,t){""===t?s.removeAttribute(e,"class"):s.setAttribute(e,"class",t)}(s,e,i),null!==r&&function j6(s,e,t){s.setAttribute(e,"style",t)}(s,e,r)}function Fv(s,e,t,n,i,r,o,a,l,c,u){const h=27+n,d=h+i,p=function X6(s,e){const t=[];for(let n=0;n<e;n++)t.push(n<s?null:_s);return t}(h,d),g="function"==typeof c?c():c;return p[1]={type:s,blueprint:p,template:t,queries:null,viewQuery:a,declTNode:e,data:p.slice().fill(null,h),bindingStartIndex:h,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof r?r():r,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:g,incompleteFirstPass:!1,ssrId:u}}function Uy(s,e,t,n,i,r,o,a,l,c,u){const h=e.blueprint.slice();return h[0]=i,h[2]=1228|n,(null!==c||s&&2048&s[2])&&(h[2]|=2048),jN(h),h[3]=h[14]=s,h[8]=t,h[10]=o||s&&s[10],h[11]=a||s&&s[11],h[9]=l||s&&s[9]||null,h[5]=r,h[19]=function zW(){return UW++}(),h[6]=u,h[20]=c,h[15]=2==e.type?s[15]:h,h}function Ov(s){let e=16;return s.signals?e=4096:s.onPush&&(e=64),e}function Fp(s,e,t,n){if(0===t)return-1;const i=e.length;for(let r=0;r<t;r++)e.push(n),s.blueprint.push(n),s.data.push(null);return i}function Lv(s,e){return s[12]?s[13][4]=e:s[12]=e,s[13]=e,e}function Q(s=1){UI(yn(),ee(),yr()+s,!1)}function UI(s,e,t,n){if(!n)if(3&~e[2]){const r=s.preOrderHooks;null!==r&&wy(e,r,0,t)}else{const r=s.preOrderCheckHooks;null!==r&&by(e,r,t)}Ku(t)}var zy=function(s){return s[s.None=0]="None",s[s.SignalBased=1]="SignalBased",s[s.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",s}(zy||{});function Op(s,e,t,n){const i=vt(null);try{const[r,o,a]=s.inputs[t];let l=null;0!==(o&zy.SignalBased)&&(l=e[r][Zn]),null!==l&&void 0!==l.transformFn?n=l.transformFn(n):null!==a&&(n=a.call(e,n)),null!==s.setInput?s.setInput(e,l,n,t,r):$E(e,l,r,n)}finally{vt(i)}}var Qc=function(s){return s[s.Important=1]="Important",s[s.DashCase=2]="DashCase",s}(Qc||{});function Hv(s,e){return undefined(s,e)}const $y=new Set;function Od(s,e,t,n,i,r){if(null!=n){let o,a=!1;jr(n)?o=n:ii(n)&&(a=!0,n=n[0]);const l=cr(n);0===s&&null!==t?null==i?LI(e,t,l):ih(e,t,l,i||null,!0):1===s&&null!==t?ih(e,t,l,i||null,!0):2===s?XI(r,c=>{!function Rp(s,e,t,n){s.removeChild(null,e,t,n)}(e,l,a,c)}):3===s&&XI(r,()=>{e.destroyNode(l)}),null!=o&&function lG(s,e,t,n,i){const r=t[7];r!==cr(t)&&Od(e,s,n,r,i);for(let a=10;a<t.length;a++){const l=t[a];Yy(l[1],l,s,e,n,r)}}(e,s,o,t,i)}}function YI(s,e){e[10].changeDetectionScheduler?.notify(9),Yy(s,e,e[11],2,null,null)}function Wv(s,e){const t=s[9],n=t.indexOf(e);t.splice(n,1)}function Lp(s,e){if(Kl(e))return;const t=e[11];t.destroyNode&&Yy(s,e,t,3,null,null),function sG(s){let e=s[12];if(!e)return Gv(s[1],s);for(;e;){let t=null;if(ii(e))t=e[12];else{const n=e[10];n&&(t=n)}if(!t){for(;e&&!e[4]&&e!==s;)ii(e)&&Gv(e[1],e),e=e[3];null===e&&(e=s),ii(e)&&Gv(e[1],e),t=e&&e[4]}e=t}}(e)}function Gv(s,e){if(Kl(e))return;const t=vt(null);try{e[2]&=-129,e[2]|=256,e[24]&&Le(e[24]),function oG(s,e){let t;if(null!=s&&null!=(t=s.destroyHooks))for(let n=0;n<t.length;n+=2){const i=e[t[n]];if(!(i instanceof vp)){const r=t[n+1];if(Array.isArray(r))for(let o=0;o<r.length;o+=2){const a=i[r[o]],l=r[o+1];ds(4,a,l);try{l.call(a)}finally{ds(5,a,l)}}else{ds(4,i,r);try{r.call(i)}finally{ds(5,i,r)}}}}}(s,e),function rG(s,e){const t=s.cleanup,n=e[7];if(null!==t)for(let o=0;o<t.length-1;o+=2)if("string"==typeof t[o]){const a=t[o+3];a>=0?n[a]():n[-a].unsubscribe(),o+=2}else t[o].call(n[t[o+1]]);null!==n&&(e[7]=null);const i=e[21];if(null!==i){e[21]=null;for(let o=0;o<i.length;o++)(0,i[o])()}const r=e[23];if(null!==r){e[23]=null;for(const o of r)o.destroy()}}(s,e),1===e[1].type&&e[11].destroy();const n=e[16];if(null!==n&&jr(e[3])){n!==e[3]&&Wv(n,e);const i=e[18];null!==i&&i.detachView(s)}sv(e)}finally{vt(t)}}function XI(s,e){if(s&&s[26]&&s[26].leave)if(s[26].skipLeaveAnimations)s[26].skipLeaveAnimations=!1;else{const t=s[26].leave,n=[];for(let i=0;i<t.length;i++)n.push((0,t[i])());s[26].running=Promise.allSettled(n),s[26].leave=void 0}!function iG(s,e){s&&s[26]&&s[26].running?s[26].running.then(()=>{s[26]&&s[26].running&&(s[26].running=void 0),$y.delete(s),e(!0)}):e(!1)}(s,e)}function Uv(s,e,t){return function JI(s,e,t){let n=e;for(;null!==n&&168&n.type;)n=(e=n).parent;if(null===n)return t[0];if(Ql(n)){const{encapsulation:i}=s.data[n.directiveStart+n.componentOffset];if(i===oc.None||i===oc.Emulated)return null}return Fi(n,t)}(s,e.parent,t)}let KI=function QI(s,e,t){return 40&s.type?Fi(s,t):null};function qv(s,e,t,n){const i=Uv(s,n,e),r=e[11],a=function ZI(s,e,t){return KI(s,e,t)}(n.parent||e[5],n,e);if(null!=i)if(Array.isArray(t))for(let l=0;l<t.length;l++)VI(r,i,t[l],a,!1);else VI(r,i,t,a,!1)}function rh(s,e){if(null!==e){const t=e.type;if(3&t)return Fi(e,s);if(4&t)return jy(-1,s[e.index]);if(8&t){const n=e.child;if(null!==n)return rh(s,n);{const i=s[e.index];return jr(i)?jy(-1,i):cr(i)}}if(128&t)return rh(s,e.next);if(32&t)return Hv(e,s)()||cr(s[e.index]);{const n=tB(s,e);return null!==n?Array.isArray(n)?n[0]:rh(ec(s[15]),n):rh(s,e.next)}}return null}function tB(s,e){return null!==e?s[15][5].projection[e.projection]:null}function jy(s,e){const t=10+s+1;if(t<e.length){const n=e[t],i=n[1].firstChild;if(null!==i)return rh(n,i)}return e[7]}function $v(s,e,t,n,i,r,o){for(;null!=t;){if(128===t.type){t=t.next;continue}const a=n[t.index],l=t.type;if(o&&0===e&&(a&&yo(cr(a),n),t.flags|=2),!My(t))if(8&l)$v(s,e,t.child,n,i,r,!1),Od(e,s,i,a,r,n);else if(32&l){const c=Hv(t,n);let u;for(;u=c();)Od(e,s,i,u,r,n);Od(e,s,i,a,r,n)}else 16&l?nB(s,e,n,t,i,r):Od(e,s,i,a,r,n);t=o?t.projectionNext:t.next}}function Yy(s,e,t,n,i,r){$v(t,n,s.firstChild,e,i,r,!1)}function nB(s,e,t,n,i,r){const o=t[15],l=o[5].projection[n.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)Od(e,s,i,l[c],r,t);else{let c=l;const u=o[3];xp(n)&&(c.flags|=128),$v(s,e,c,u,i,r,!0)}}function sB(s,e,t,n,i){const r=yr(),o=2&n;try{Ku(-1),o&&e.length>27&&UI(s,e,27,!1),ds(o?2:0,i,t),t(n,i)}finally{Ku(r),ds(o?3:1,i,t)}}function Xy(s,e,t){(function pG(s,e,t){const n=t.directiveStart,i=t.directiveEnd;Ql(t)&&function J6(s,e,t){const n=Fi(e,s),i=function GI(s){const e=s.tView;return null===e||e.incompleteFirstPass?s.tView=Fv(1,null,s.template,s.decls,s.vars,s.directiveDefs,s.pipeDefs,s.viewQuery,s.schemas,s.consts,s.id):e}(t),r=s[10].rendererFactory,o=Lv(s,Uy(s,i,null,Ov(t),n,e,null,r.createRenderer(n,t),null,null,null));s[e.index]=o}(e,t,s.data[n+t.componentOffset]),s.firstCreatePass||vy(t,e);const r=t.initialInputs;for(let o=n;o<i;o++){const a=s.data[o],l=Cp(e,s,o,t);yo(l,e),null!==r&&_G(0,o-n,l,a,0,r),Lo(a)&&(Yr(t.index,e)[8]=Cp(e,s,o,t))}})(s,e,t),!(64&~t.flags)&&function gG(s,e,t){const n=t.directiveStart,i=t.directiveEnd,r=t.index,o=function n4(){return Zt.lFrame.currentDirectiveIndex}();try{Ku(r);for(let a=n;a<i;a++){const l=s.data[a],c=e[a];RS(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&mG(l,c)}}finally{Ku(-1),RS(o)}}(s,e,t)}function Ld(s,e,t=Fi){const n=e.localNames;if(null!==n){let i=e.index+1;for(let r=0;r<n.length;r+=2){const o=n[r+1],a=-1===o?t(e,s):s[o];s[i++]=a}}}let iB=()=>null;function jv(s,e,t,n,i,r){Ky(s,e[1],e,t,n)?Ql(s)&&function rB(s,e){const t=Yr(e,s);16&t[2]||(t[2]|=64)}(e,s.index):(3&s.type&&(t=function fG(s){return"class"===s?"className":"for"===s?"htmlFor":"formaction"===s?"formAction":"innerHtml"===s?"innerHTML":"readonly"===s?"readOnly":"tabindex"===s?"tabIndex":s}(t)),function Yv(s,e,t,n,i,r){if(3&s.type){const o=Fi(s,e);n=null!=r?r(n,s.value||"",t):n,i.setProperty(o,t,n)}}(s,e,t,n,i,r))}function mG(s,e){null!==s.hostBindings&&s.hostBindings(1,e)}function Xv(s,e){const t=s.directiveRegistry;let n=null;if(t)for(let i=0;i<t.length;i++){const r=t[i];RI(e,r.selectors,!1)&&(n??=[],Lo(r)?n.unshift(r):n.push(r))}return n}function _G(s,e,t,n,i,r){const o=r[e];if(null!==o)for(let a=0;a<o.length;a+=2)Op(n,t,o[a],o[a+1])}function Zy(s,e,t,n,i){const r=27+t,o=e[1],a=i(o,e,s,n,t);e[r]=a,tc(s,!0);const l=2===s.type;return l?(WI(e[11],a,s),(0===function J5(){return Zt.lFrame.elementDepthCount}()||md(s))&&yo(a,e),function Z5(){Zt.lFrame.elementDepthCount++}()):yo(a,e),fy()&&(!l||!My(s))&&qv(o,e,a,s),s}function Qy(s){let e=s;return sE()?function iE(){Zt.lFrame.isParent=!1}():(e=e.parent,tc(e,!1)),e}function Ky(s,e,t,n,i){const r=s.inputs?.[n],o=s.hostDirectiveInputs?.[n];let a=!1;if(o)for(let l=0;l<o.length;l+=2){const c=o[l];Op(e.data[c],t[c],o[l+1],i),a=!0}if(r)for(const l of r)Op(e.data[l],t[l],n,i),a=!0;return a}function wG(s,e){const t=Yr(e,s),n=t[1];!function SG(s,e){for(let t=e.length;t<s.blueprint.length;t++)e.push(s.blueprint[t])}(n,t);const i=t[0];null!==i&&null===t[6]&&(t[6]=null),ds(18),e_(n,t,t[8]),ds(19,t[8])}function e_(s,e,t){LS(e);try{const n=s.viewQuery;null!==n&&kv(1,n,t);const i=s.template;null!==i&&sB(s,e,i,1,t),s.firstCreatePass&&(s.firstCreatePass=!1),e[18]?.finishViewCreation(s),s.staticContentQueries&&cI(s,e),s.staticViewQueries&&kv(2,s.viewQuery,t);const r=s.components;null!==r&&function vG(s,e){for(let t=0;t<e.length;t++)wG(s,e[t])}(e,r)}catch(n){throw s.firstCreatePass&&(s.incompleteFirstPass=!0,s.firstCreatePass=!1),n}finally{e[2]&=-5,VS()}}function oh(s,e){return!e||null===e.firstChild||xp(s)}function Vp(s,e,t,n,i=!1){for(;null!==t;){if(128===t.type){t=i?t.projectionNext:t.next;continue}const r=e[t.index];null!==r&&n.push(cr(r)),jr(r)&&TG(r,n);const o=t.type;if(8&o)Vp(s,e,t.child,n);else if(32&o){const a=Hv(t,e);let l;for(;l=a();)n.push(l)}else if(16&o){const a=tB(e,t);if(Array.isArray(a))n.push(...a);else{const l=ec(e[15]);Vp(l[1],l,a,n,!0)}}t=i?t.projectionNext:t.next}return n}function TG(s,e){for(let t=10;t<s.length;t++){const n=s[t],i=n[1].firstChild;null!==i&&Vp(n[1],n,i,e)}s[7]!==s[0]&&e.push(s[7])}function lB(s){if(null!==s[25]){for(const e of s[25])e.impl.addSequence(e);s[25].length=0}}let cB=[];const xG={...Ln,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:s=>{bd(s.lView)},consumerOnSignalRead(){this.lView[24]=this}},EG={...Ln,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:s=>{let e=ec(s.lView);for(;e&&!uB(e[1]);)e=ec(e);e&&YN(e)},consumerOnSignalRead(){this.lView[24]=this}};function uB(s){return 2!==s.type}function hB(s){if(null===s[23])return;let e=!0;for(;e;){let t=!1;for(const n of s[23])n.dirty&&(t=!0,null===n.zone||Zone.current===n.zone?n.run():n.zone.run(()=>n.run()));e=t&&!!(8192&s[2])}}function t_(s,e=0){const n=s[10].rendererFactory;n.begin?.();try{!function BG(s,e){const t=aE();try{hy(!0),Zv(s,e);let n=0;for(;cy(s);){if(100===n)throw new R(103,!1);n++,Zv(s,1)}}finally{hy(t)}}(s,e)}finally{n.end?.()}}function dB(s,e,t,n){if(Kl(e))return;const i=e[2];LS(e);let a=!0,l=null,c=null;uB(s)?(c=function kG(s){return s[24]??function CG(s){const e=cB.pop()??Object.create(xG);return e.lView=s,e}(s)}(e),l=Ta(c)):null===function Mn(){return ms}()?(a=!1,c=function NG(s){const e=s[24]??Object.create(EG);return e.lView=s,e}(e),l=Ta(c)):e[24]&&(Le(e[24]),e[24]=null);try{jN(e),function lE(s){return Zt.lFrame.bindingIndex=s}(s.bindingStartIndex),null!==t&&sB(s,e,t,2,n),function MG(s){const e=s[26];if(e?.enter){for(const t of e.enter)t();e.enter=void 0}}(e);const u=!(3&~i);if(u){const p=s.preOrderCheckHooks;null!==p&&by(e,p,null)}else{const p=s.preOrderHooks;null!==p&&wy(e,p,0,null),YS(e,0)}if(function PG(s){for(let e=N1(s);null!==e;e=E1(e)){if(!(2&e[2]))continue;const t=e[9];for(let n=0;n<t.length;n++)YN(t[n])}}(e),hB(e),fB(e,0),null!==s.contentQueries&&cI(s,e),u){const p=s.contentCheckHooks;null!==p&&by(e,p)}else{const p=s.contentHooks;null!==p&&wy(e,p,1),YS(e,1)}!function RG(s,e){const t=s.hostBindingOpCodes;if(null!==t)try{for(let n=0;n<t.length;n++){const i=t[n];if(i<0)Ku(~i);else{const r=i,o=t[++n],a=t[++n];t4(o,r);const l=e[r];ds(24,l),a(2,l),ds(25,l)}}}finally{Ku(-1)}}(s,e);const h=s.components;null!==h&&gB(e,h,0);const d=s.viewQuery;if(null!==d&&kv(2,d,n),u){const p=s.viewCheckHooks;null!==p&&by(e,p)}else{const p=s.viewHooks;null!==p&&wy(e,p,2),YS(e,2)}if(!0===s.firstUpdatePass&&(s.firstUpdatePass=!1),e[22]){for(const p of e[22])p();e[22]=null}lB(e),e[2]&=-73}catch(u){throw bd(e),u}finally{null!==c&&(zl(c,l),a&&function DG(s){s.lView[24]!==s&&(s.lView=null,cB.push(s))}(c)),VS()}}function fB(s,e){for(let t=N1(s);null!==t;t=E1(t))for(let n=10;n<t.length;n++)pB(t[n],e)}function AG(s,e,t){ds(18);const n=Yr(e,s);pB(n,t),ds(19,n[8])}function pB(s,e){ES(s)&&Zv(s,e)}function Zv(s,e){const n=s[1],i=s[2],r=s[24];let o=!!(0===e&&16&i);if(o||=!!(64&i&&0===e),o||=!!(1024&i),o||=!(!r?.dirty||!Vn(r)),o||=!1,r&&(r.dirty=!1),s[2]&=-9217,o)dB(n,s,n.template,s[8]);else if(8192&i){const a=vt(null);try{hB(s),fB(s,1);const l=n.components;null!==l&&gB(s,l,1),lB(s)}finally{vt(a)}}}function gB(s,e,t){for(let n=0;n<e.length;n++)AG(s,e[n],t)}function Hd(s,e){const t=aE()?64:1088;for(s[10].changeDetectionScheduler?.notify(e);s;){s[2]|=t;const n=ec(s);if(qc(s)&&!n)return s;s=n}return null}function mB(s,e,t,n){return[s,!0,0,e,null,n,null,t,null,null]}function Hp(s,e){if(s.length<=10)return;const t=10+e,n=s[t];if(n){const i=n[16];null!==i&&i!==s&&Wv(i,n),e>0&&(s[t-1][4]=n[4]);const r=Km(s,10+e);!function jI(s,e){YI(s,e),e[0]=null,e[5]=null}(n[1],n);const o=r[18];null!==o&&o.detachView(r[1]),n[3]=null,n[4]=null,n[2]&=-129}return n}function _B(s,e){const t=s[9],n=e[3];(ii(n)||e[15]!==n[3][15])&&(s[2]|=2),null===t?s[9]=[e]:t.push(e)}class Wp{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){const e=this._lView,t=e[1];return Vp(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return Kl(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(jr(e)){const t=e[8],n=t?t.indexOf(this):-1;n>-1&&(Hp(e,n),Km(t,n))}this._attachedToViewContainer=!1}Lp(this._lView[1],this._lView)}onDestroy(e){uy(this._lView,e)}markForCheck(){Hd(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[2]&=-129}reattach(){IS(this._lView),this._lView[2]|=128}detectChanges(){this._lView[2]|=1024,t_(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new R(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const e=qc(this._lView),t=this._lView[16];null!==t&&!e&&Wv(t,this._lView),YI(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new R(902,!1);this._appRef=e;const t=qc(this._lView),n=this._lView[16];null!==n&&!t&&_B(n,this._lView),IS(this._lView)}}let lc=(()=>class s{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=OG;constructor(t,n,i){this._declarationLView=t,this._declarationTContainer=n,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n)}createEmbeddedViewImpl(t,n,i){const r=function Vd(s,e,t,n){const i=vt(null);try{const r=e.tView,l=Uy(s,r,t,4096&s[2]?4096:16,null,e,null,null,n?.injector??null,n?.embeddedViewInjector??null,n?.dehydratedView??null);l[16]=s[e.index];const u=s[18];return null!==u&&(l[18]=u.createEmbeddedView(r)),e_(r,l,t),l}finally{vt(i)}}(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:n,dehydratedView:i});return new Wp(r)}})();function OG(){return n_(sn(),ee())}function n_(s,e){return 4&s.type?new lc(e,s,Nd(s,e)):null}function ah(s,e,t,n,i){let r=s.data[e];if(null===r)r=function nT(s,e,t,n,i){const r=nE(),o=sE(),l=s.data[e]=function $G(s,e,t,n,i,r){let o=e?e.injectorIndex:-1,a=0;return function KN(){return null!==Zt.skipHydrationRootTNode}()&&(a|=128),{type:t,index:n,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:r,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?r:r&&r.parent,t,e,n,i);return function qG(s,e,t,n){null===s.firstChild&&(s.firstChild=e),null!==t&&(n?null==t.child&&null!==e.parent&&(t.child=e):null===t.next&&(t.next=e,e.prev=t))}(s,l,r,o),l}(s,e,t,n,i),function e4(){return Zt.lFrame.inI18n}()&&(r.flags|=32);else if(64&r.type){r.type=t,r.value=n,r.attrs=i;const o=function pp(){const s=Zt.lFrame,e=s.currentTNode;return s.isParent?e:e.parent}();r.injectorIndex=null===o?-1:o.injectorIndex}return tc(r,!0),r}let NU=class{},UB=class{};class EU{resolveComponentFactory(e){throw new R(917,!1)}}let u_=class{static NULL=new EU};class cT{}let cc=(()=>class s{destroyNode=null;static __NG_ELEMENT_ID__=()=>function IU(){const s=ee(),t=Yr(sn().index,s);return(ii(t)?t:s)[11]}()})(),BU=(()=>{class s{static \u0275prov=ut({token:s,providedIn:"root",factory:()=>null})}return s})();const hT={};class Ud{injector;parentInjector;constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,n){const i=this.injector.get(e,hT,n);return i!==hT||t===hT?i:this.parentInjector.get(e,t,n)}}function d_(s,e,t){let n=t?s.styles:null,i=t?s.classes:null,r=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?r=a:1==r?i=Ro(i,a):2==r&&(n=Ro(n,a+": "+e[++o]+";"))}t?s.styles=n:s.stylesWithoutHost=n,t?s.classes=i:s.classesWithoutHost=i}function ue(s,e=0){const t=ee();return null===t?Sn(s,e):l1(sn(),t,X(s),e)}function qB(s,e,t,n,i){const r=null===n?null:{"":-1},o=i(s,t);if(null!==o){let a=o,l=null,c=null;for(const u of o)if(null!==u.resolveHostDirectives){[a,l,c]=u.resolveHostDirectives(o);break}!function LU(s,e,t,n,i,r,o){const a=n.length;let l=!1;for(let d=0;d<a;d++){const p=n[d];!l&&Lo(p)&&(l=!0,OU(s,t,d)),KS(vy(t,e),s,p.type)}!function zU(s,e,t){s.flags|=1,s.directiveStart=e,s.directiveEnd=e+t,s.providerIndexes=e}(t,s.data.length,a);for(let d=0;d<a;d++){const p=n[d];p.providersResolver&&p.providersResolver(p)}let c=!1,u=!1,h=Fp(s,e,a,null);a>0&&(t.directiveToIndex=new Map);for(let d=0;d<a;d++){const p=n[d];if(t.mergedAttrs=xd(t.mergedAttrs,p.hostAttrs),HU(s,t,e,h,p),UU(h,p,i),null!==o&&o.has(p)){const[m,_]=o.get(p);t.directiveToIndex.set(p.type,[h,m+t.directiveStart,_+t.directiveStart])}else(null===r||!r.has(p))&&t.directiveToIndex.set(p.type,h);null!==p.contentQueries&&(t.flags|=4),(null!==p.hostBindings||null!==p.hostAttrs||0!==p.hostVars)&&(t.flags|=64);const g=p.type.prototype;!c&&(g.ngOnChanges||g.ngOnInit||g.ngDoCheck)&&((s.preOrderHooks??=[]).push(t.index),c=!0),!u&&(g.ngOnChanges||g.ngDoCheck)&&((s.preOrderCheckHooks??=[]).push(t.index),u=!0),h++}!function VU(s,e,t){for(let n=e.directiveStart;n<e.directiveEnd;n++){const i=s.data[n];if(null!==t&&t.has(i)){const r=t.get(i);jB(0,e,r,n),jB(1,e,r,n),XB(e,n,!0)}else $B(0,e,i,n),$B(1,e,i,n),XB(e,n,!1)}}(s,t,r)}(s,e,t,a,r,l,c)}null!==r&&null!==n&&function FU(s,e,t){const n=s.localNames=[];for(let i=0;i<e.length;i+=2){const r=t[e[i+1]];if(null==r)throw new R(-301,!1);n.push(e[i],r)}}(t,n,r)}function OU(s,e,t){e.componentOffset=t,(s.components??=[]).push(e.index)}function $B(s,e,t,n){const i=0===s?t.inputs:t.outputs;for(const r in i)if(i.hasOwnProperty(r)){let o;o=0===s?e.inputs??={}:e.outputs??={},o[r]??=[],o[r].push(n),YB(e,r)}}function jB(s,e,t,n){const i=0===s?t.inputs:t.outputs;for(const r in i)if(i.hasOwnProperty(r)){const o=i[r];let a;a=0===s?e.hostDirectiveInputs??={}:e.hostDirectiveOutputs??={},a[o]??=[],a[o].push(n,r),YB(e,o)}}function YB(s,e){"class"===e?s.flags|=8:"style"===e&&(s.flags|=16)}function XB(s,e,t){const{attrs:n,inputs:i,hostDirectiveInputs:r}=s;if(null===n||!t&&null===i||t&&null===r||Pv(s))return s.initialInputs??=[],void s.initialInputs.push(null);let o=null,a=0;for(;a<n.length;){const l=n[a];if(0!==l)if(5!==l){if("number"==typeof l)break;if(!t&&i.hasOwnProperty(l)){const c=i[l];for(const u of c)if(u===e){o??=[],o.push(l,n[a+1]);break}}else if(t&&r.hasOwnProperty(l)){const c=r[l];for(let u=0;u<c.length;u+=2)if(c[u]===e){o??=[],o.push(c[u+1],n[a+1]);break}}a+=2}else a+=2;else a+=4}s.initialInputs??=[],s.initialInputs.push(o)}function HU(s,e,t,n,i){s.data[n]=i;const r=i.factory||(i.factory=ju(i.type)),o=new vp(r,Lo(i),ue,null);s.blueprint[n]=o,t[n]=o,function WU(s,e,t,n,i){const r=i.hostBindings;if(r){let o=s.hostBindingOpCodes;null===o&&(o=s.hostBindingOpCodes=[]);const a=~e.index;(function GU(s){let e=s.length;for(;e>0;){const t=s[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,n,r)}}(s,e,n,Fp(s,t,i.hostVars,_s),i)}function UU(s,e,t){if(t){if(e.exportAs)for(let n=0;n<e.exportAs.length;n++)t[e.exportAs[n]]=s;Lo(e)&&(t[""]=s)}}function dT(s,e,t,n,i,r,o,a){const l=e[1],c=l.consts,h=ah(l,s,t,n,Er(c,o));return r&&qB(l,e,h,Er(c,a),i),h.mergedAttrs=xd(h.mergedAttrs,h.attrs),null!==h.attrs&&d_(h,h.attrs,!1),null!==h.mergedAttrs&&d_(h,h.mergedAttrs,!0),null!==l.queries&&l.queries.elementStart(l,h),h}function fT(s,e){JE(s,e),WN(e)&&s.queries.elementEnd(e)}function f_(s){return!!pT(s)&&(Array.isArray(s)||!(s instanceof Map)&&Symbol.iterator in s)}function pT(s){return null!==s&&("function"==typeof s||"object"==typeof s)}function ml(s,e,t){return s[e]=t}function js(s,e,t){return t!==_s&&(!Object.is(s[e],t)&&(s[e]=t,!0))}function Qp(s,e,t){return function n(i){Hd(Ql(s)?Yr(s.index,e):e,5);const o=e[8];let a=ZB(e,o,t,i),l=n.__ngNextListenerFn__;for(;l;)a=ZB(e,o,l,i)&&a,l=l.__ngNextListenerFn__;return a}}function ZB(s,e,t,n){const i=vt(null);try{return ds(6,e,t),!1!==t(n)}catch(r){return function Jv(s,e){const t=s[9];if(!t)return;let n;try{n=t.get(Ea,null)}catch{n=null}n?.(e)}(s,r),!1}finally{ds(7,e,t),vt(i)}}function KB(s,e,t,n,i,r,o){const a=e.firstCreatePass?ZN(e):null,l=JN(t),c=l.length;l.push(i,r),a&&a.push(n,s,c,(c+1)*(o?-1:1))}function g_(s,e,t,n,i,r){const a=e[1],h=e[t][a.data[t].outputs[n]].subscribe(r);KB(s.index,a,e,i,r,h,!0)}const eu=Symbol("BINDING");class eM extends u_{ngModule;constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=hs(e);return new gT(t,this.ngModule)}}class gT extends UB{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=function sz(s){return Object.keys(s).map(e=>{const[t,n,i]=s[e],r={propName:t,templateName:e,isSignal:0!==(n&zy.SignalBased)};return i&&(r.transform=i),r})}(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=function iz(s){return Object.keys(s).map(e=>({propName:s[e],templateName:e}))}(this.componentDef.outputs),this.cachedOutputs}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function q6(s){return s.map(z6).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors??[],this.isBoundToModule=!!t}create(e,t,n,i,r,o){ds(22);const a=vt(null);try{const l=this.componentDef,c=function cz(s,e,t,n){const i=s?["ng-version","20.3.2"]:function $6(s){const e=[],t=[];let n=1,i=2;for(;n<s.length;){let r=s[n];if("string"==typeof r)2===i?""!==r&&e.push(r,s[++n]):8===i&&t.push(r);else{if(!Ia(i))break;i=r}n++}return t.length&&e.push(1,...t),e}(e.selectors[0]);let r=null,o=null,a=0;if(t)for(const u of t)a+=u[eu].requiredVars,u.create&&(u.targetIdx=0,(r??=[]).push(u)),u.update&&(u.targetIdx=0,(o??=[]).push(u));if(n)for(let u=0;u<n.length;u++){const h=n[u];if("function"!=typeof h)for(const d of h.bindings){a+=d[eu].requiredVars;const p=u+1;d.create&&(d.targetIdx=p,(r??=[]).push(d)),d.update&&(d.targetIdx=p,(o??=[]).push(d))}}const l=[e];if(n)for(const u of n){const d=qr("function"==typeof u?u:u.type);l.push(d)}return Fv(0,null,function uz(s,e){return s||e?t=>{if(1&t&&s)for(const n of s)n.create();if(2&t&&e)for(const n of e)n.update()}:null}(r,o),1,a,l,null,null,null,[i],null)}(n,l,o,r),u=function rz(s,e,t){let n=e instanceof $r?e:e?.injector;return n&&null!==s.getStandaloneInjector&&(n=s.getStandaloneInjector(n)||n),n?new Ud(t,n):t}(l,i||this.ngModule,e),h=function oz(s){const e=s.get(cT,null);if(null===e)throw new R(407,!1);return{rendererFactory:e,sanitizer:s.get(BU,null),changeDetectionScheduler:s.get(eh,null),ngReflect:!1}}(u),d=h.rendererFactory.createRenderer(null,l),p=n?function uG(s,e,t,n){const r=n.get(S8,!1)||t===oc.ShadowDom,o=s.selectRootElement(e,r);return function hG(s){iB(s)}(o),o}(d,n,l.encapsulation,u):function az(s,e){const t=function lz(s){return(s.selectors[0][0]||"div").toLowerCase()}(s);return Gy(e,t,"svg"===t?"svg":"math"===t?"math":null)}(l,d),g=o?.some(tM)||r?.some(y=>"function"!=typeof y&&y.bindings.some(tM)),m=Uy(null,c,null,512|Ov(l),null,null,h,d,u,null,null);m[27]=p,LS(m);let _=null;try{const y=dT(27,m,2,"#host",()=>c.directiveRegistry,!0,0);WI(d,p,y),yo(p,m),Xy(c,m,y),Cv(c,y,m),fT(c,y),void 0!==t&&function dz(s,e,t){const n=s.projection=[];for(let i=0;i<e.length;i++){const r=t[i];n.push(null!=r&&r.length?Array.from(r):null)}}(y,this.ngContentSelectors,t),_=Yr(y.index,m),m[8]=_[8],e_(c,m,null)}catch(y){throw null!==_&&sv(_),sv(m),y}finally{ds(23),VS()}return new hz(this.componentType,m,!!g)}finally{vt(a)}}}function tM(s){const e=s[eu].kind;return"input"===e||"twoWay"===e}class hz extends NU{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(e,t,n){super(),this._rootLView=t,this._hasInputBindings=n,this._tNode=_d(t[1],27),this.location=Nd(this._tNode,t),this.instance=Yr(this._tNode.index,t)[8],this.hostView=this.changeDetectorRef=new Wp(t,void 0),this.componentType=e}setInput(e,t){const n=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;const i=this._rootLView;Ky(n,i[1],i,e,t),this.previousInputValues.set(e,t),Hd(Yr(n.index,i),1)}get injector(){return new gi(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}let Ba=(()=>class s{static __NG_ELEMENT_ID__=fz})();function fz(){return iM(sn(),ee())}const pz=Ba,nM=class extends pz{_lContainer;_hostTNode;_hostLView;constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return Nd(this._hostTNode,this._hostLView)}get injector(){return new gi(this._hostTNode,this._hostLView)}get parentInjector(){const e=Ty(this._hostTNode,this._hostLView);if(JS(e)){const t=kp(e,this._hostLView),n=Tp(e);return new gi(t[1].data[n+8],t)}return new gi(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=sM(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,n){let i,r;"number"==typeof n?i=n:null!=n&&(i=n.index,r=n.injector);const a=e.createEmbeddedViewImpl(t||{},r,null);return this.insertImpl(a,i,oh(this._hostTNode,null)),a}createComponent(e,t,n,i,r,o,a){const l=e&&!function Sp(s){return"function"==typeof s}(e);let c;if(l)c=t;else{const _=t||{};c=_.index,n=_.injector,i=_.projectableNodes,r=_.environmentInjector||_.ngModuleRef,o=_.directives,a=_.bindings}const u=l?e:new gT(hs(e)),h=n||this.parentInjector;if(!r&&null==u.ngModule){const y=(l?h:this.parentInjector).get($r,null);y&&(r=y)}hs(u.componentType??{});const m=u.create(h,i,null,r,o,a);return this.insertImpl(m.hostView,c,oh(this._hostTNode,null)),m}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,n){const i=e._lView;if(function Y5(s){return jr(s[3])}(i)){const a=this.indexOf(e);if(-1!==a)this.detach(a);else{const l=i[3],c=new nM(l,l[5],l[3]);c.detach(c.indexOf(e))}}const r=this._adjustIndex(t),o=this._lContainer;return function Wd(s,e,t,n=!0){const i=e[1];if(function FG(s,e,t,n){const i=10+n,r=t.length;n>0&&(t[i-1][4]=e),n<r-10?(e[4]=t[i],IN(t,10+n,e)):(t.push(e),e[4]=null),e[3]=t;const o=e[16];null!==o&&t!==o&&_B(o,e);const a=e[18];null!==a&&a.insertView(s),IS(e),e[2]|=128}(i,e,s,t),n){const o=jy(t,s),a=e[11],l=a.parentNode(s[7]);null!==l&&function nG(s,e,t,n,i,r){n[0]=i,n[5]=e,Yy(s,n,t,1,i,r)}(i,s[5],a,e,l,o)}const r=e[6];null!==r&&null!==r.firstChild&&(r.firstChild=null)}(o,i,r,n),e.attachToViewContainerRef(),IN(mT(o),r,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=sM(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),n=Hp(this._lContainer,t);n&&(Km(mT(this._lContainer),t),Lp(n[1],n))}detach(e){const t=this._adjustIndex(e,-1),n=Hp(this._lContainer,t);return n&&null!=Km(mT(this._lContainer),t)?new Wp(n):null}_adjustIndex(e,t=0){return e??this.length+t}};function sM(s){return s[8]}function mT(s){return s[8]||(s[8]=[])}function iM(s,e){let t;const n=e[s.index];return jr(n)?t=n:(t=mB(n,e,null,s),e[s.index]=t,Lv(e,t)),rM(t,e,s,n),new nM(t,s,e)}let rM=function aM(s,e,t,n){if(s[7])return;let i;i=8&t.type?cr(n):function gz(s,e){const t=s[11],n=t.createComment(""),i=Fi(e,s),r=t.parentNode(i);return ih(t,r,n,t.nextSibling(i),!1),n}(e,t),s[7]=i};class _T{queryList;matches=null;constructor(e){this.queryList=e}clone(){return new _T(this.queryList)}setDirty(){this.queryList.setDirty()}}class bT{queries;constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const n=null!==e.contentQueries?e.contentQueries[0]:t.length,i=[];for(let r=0;r<n;r++){const o=t.getByIndex(r);i.push(this.queries[o.indexInDeclarationView].clone())}return new bT(i)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==kT(e,t).matches&&this.queries[t].setDirty()}}class lM{flags;read;predicate;constructor(e,t,n=null){this.flags=t,this.read=n,this.predicate="string"==typeof e?function vz(s){return s.split(",").map(e=>e.trim())}(e):e}}class wT{queries;constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){const i=null!==t?t.length:0,r=this.getByIndex(n).embeddedTView(e,i);r&&(r.indexInDeclarationView=n,null!==t?t.push(r):t=[r])}return null!==t?new wT(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class ST{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(e,t=-1){this.metadata=e,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new ST(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1&~this.metadata.flags){const t=this._declarationNodeIndex;let n=e.parent;for(;null!==n&&8&n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const n=this.metadata.predicate;if(Array.isArray(n))for(let i=0;i<n.length;i++){const r=n[i];this.matchTNodeWithReadOption(e,t,_z(t,r)),this.matchTNodeWithReadOption(e,t,ky(t,e,r,!1,!1))}else n===lc?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,ky(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(null!==n){const i=this.metadata.read;if(null!==i)if(i===Ho||i===Ba||i===lc&&4&t.type)this.addMatch(t.index,-2);else{const r=ky(t,e,i,!1,!1);null!==r&&this.addMatch(t.index,r)}else this.addMatch(t.index,n)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function _z(s,e){const t=s.localNames;if(null!==t)for(let n=0;n<t.length;n+=2)if(t[n]===e)return t[n+1];return null}function wz(s,e,t,n){return-1===t?function bz(s,e){return 11&s.type?Nd(s,e):4&s.type?n_(s,e):null}(e,s):-2===t?function Sz(s,e,t){return t===Ho?Nd(e,s):t===lc?n_(e,s):t===Ba?iM(e,s):void 0}(s,e,n):Cp(s,s[1],t,e)}function cM(s,e,t,n){const i=e[18].queries[n];if(null===i.matches){const r=s.data,o=t.matches,a=[];for(let l=0;null!==o&&l<o.length;l+=2){const c=o[l];a.push(c<0?null:wz(e,r[c],o[l+1],t.metadata.read))}i.matches=a}return i.matches}function vT(s,e,t,n){const i=s.queries.getByIndex(t),r=i.matches;if(null!==r){const o=cM(s,e,i,t);for(let a=0;a<r.length;a+=2){const l=r[a];if(l>0)n.push(o[a/2]);else{const c=r[a+1],u=e[-l];for(let h=10;h<u.length;h++){const d=u[h];d[16]===d[3]&&vT(d[1],d,c,n)}if(null!==u[9]){const h=u[9];for(let d=0;d<h.length;d++){const p=h[d];vT(p[1],p,c,n)}}}}}return n}function hM(s,e,t){const n=yn();return n.firstCreatePass&&(function fM(s,e,t){null===s.queries&&(s.queries=new wT),s.queries.track(new ST(e,t))}(n,new lM(s,e,t),-1),!(2&~e)&&(n.staticViewQueries=!0)),function uM(s,e,t){const n=new HW(!(4&~t));return function X5(s,e,t,n){const i=JN(e);i.push(t),s.firstCreatePass&&ZN(s).push(n,i.length-1)}(s,e,n,n.destroy),(e[18]??=new bT).queries.push(new _T(n))-1}(n,ee(),e)}function kT(s,e){return s.queries.getByIndex(e)}function pM(s,e){const t=s[1],n=kT(t,e);return n.crossesNgTemplate?vT(t,s,e,[]):cM(t,s,n,e)}const bM=new Set;function Ir(s){bM.has(s)||(bM.add(s),performance?.mark?.("mark_feature_usage",{detail:{feature:s}}))}let hh=class{},wM=class{};class xT extends hh{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new eM(this);constructor(e,t,n,i=!0){super(),this.ngModuleType=e,this._parent=t;const r=hl(e);this._bootstrapComponents=gl(r.bootstrap),this._r3Injector=yE(e,t,[{provide:hh,useValue:this},{provide:u_,useValue:this.componentFactoryResolver},...n],si(e),new Set(["environment"])),i&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class SM extends wM{moduleType;constructor(e){super(),this.moduleType=e}create(e){return new xT(this.moduleType,e,[])}}class vM extends hh{injector;componentFactoryResolver=new eM(this);instance=null;constructor(e){super();const t=new Yu([...e.providers,{provide:hh,useValue:this},{provide:u_,useValue:this.componentFactoryResolver}],e.parent||vS(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function NT(s,e,t=null){return new vM({providers:s,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}let Rz=(()=>{class s{_injector;cachedInjectors=new Map;constructor(t){this._injector=t}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const n=yS(0,t.type),i=n.length>0?NT([n],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,i)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=ut({token:s,providedIn:"environment",factory:()=>new s(Sn($r))})}return s})();function eg(s){return rc(()=>{const e=kM(s),t={...e,decls:s.decls,vars:s.vars,template:s.template,consts:s.consts||null,ngContentSelectors:s.ngContentSelectors,onPush:s.changeDetection===Dy.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&s.dependencies||null,getStandaloneInjector:e.standalone?i=>i.get(Rz).getOrCreateStandaloneInjector(t):null,getExternalStyles:null,signals:s.signals??!1,data:s.data||{},encapsulation:s.encapsulation||oc.Emulated,styles:s.styles||Ls,_:null,schemas:s.schemas||null,tView:null,id:""};e.standalone&&Ir("NgStandalone"),CM(t);const n=s.dependencies;return t.directiveDefs=m_(n,TM),t.pipeDefs=m_(n,xa),t.id=function Vz(s){let e=0;const n=[s.selectors,s.ngContentSelectors,s.hostVars,s.hostAttrs,"function"==typeof s.consts?"":s.consts,s.vars,s.decls,s.encapsulation,s.standalone,s.signals,s.exportAs,JSON.stringify(s.inputs),JSON.stringify(s.outputs),Object.getOwnPropertyNames(s.type.prototype),!!s.contentQueries,!!s.viewQuery];for(const r of n.join("|"))e=Math.imul(31,e)+r.charCodeAt(0)|0;return e+=2147483648,"c"+e}(t),t})}function TM(s){return hs(s)||qr(s)}function tg(s){return rc(()=>({type:s.type,bootstrap:s.bootstrap||Ls,declarations:s.declarations||Ls,imports:s.imports||Ls,exports:s.exports||Ls,transitiveCompileScopes:null,schemas:s.schemas||null,id:s.id||null}))}function Fz(s,e){if(null==s)return ul;const t={};for(const n in s)if(s.hasOwnProperty(n)){const i=s[n];let r,o,a,l;Array.isArray(i)?(a=i[0],r=i[1],o=i[2]??r,l=i[3]||null):(r=i,o=i,a=zy.None,l=null),t[r]=[n,a,l],e[r]=o}return t}function Oz(s){if(null==s)return ul;const e={};for(const t in s)s.hasOwnProperty(t)&&(e[s[t]]=t);return e}function Qt(s){return rc(()=>{const e=kM(s);return CM(e),e})}function _o(s){return{type:s.type,name:s.name,factory:null,pure:!1!==s.pure,standalone:s.standalone??!0,onDestroy:s.type.prototype.ngOnDestroy||null}}function kM(s){const e={};return{type:s.type,providersResolver:null,factory:null,hostBindings:s.hostBindings||null,hostVars:s.hostVars||0,hostAttrs:s.hostAttrs||null,contentQueries:s.contentQueries||null,declaredInputs:e,inputConfig:s.inputs||ul,exportAs:s.exportAs||null,standalone:s.standalone??!0,signals:!0===s.signals,selectors:s.selectors||Ls,viewQuery:s.viewQuery||null,features:s.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:Fz(s.inputs,e),outputs:Oz(s.outputs),debugInfo:null}}function CM(s){s.features?.forEach(e=>e(s))}function m_(s,e){return s?()=>{const t="function"==typeof s?s():s,n=[];for(const i of t){const r=e(i);null!==r&&n.push(r)}return n}:null}function bs(s){let e=function DM(s){return Object.getPrototypeOf(s.prototype).constructor}(s.type),t=!0;const n=[s];for(;e;){let i;if(Lo(s))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new R(903,!1);i=e.\u0275dir}if(i){if(t){n.push(i);const o=s;o.inputs=ET(s.inputs),o.declaredInputs=ET(s.declaredInputs),o.outputs=ET(s.outputs);const a=i.hostBindings;a&&zz(s,a);const l=i.viewQuery,c=i.contentQueries;if(l&&Gz(s,l),c&&Uz(s,c),Hz(s,i),Rn(s.outputs,i.outputs),Lo(i)&&i.data.animation){const u=s.data;u.animation=(u.animation||[]).concat(i.data.animation)}}const r=i.features;if(r)for(let o=0;o<r.length;o++){const a=r[o];a&&a.ngInherit&&a(s),a===bs&&(t=!1)}}e=Object.getPrototypeOf(e)}!function Wz(s){let e=0,t=null;for(let n=s.length-1;n>=0;n--){const i=s[n];i.hostVars=e+=i.hostVars,i.hostAttrs=xd(i.hostAttrs,t=xd(t,i.hostAttrs))}}(n)}function Hz(s,e){for(const t in e.inputs){if(!e.inputs.hasOwnProperty(t)||s.inputs.hasOwnProperty(t))continue;const n=e.inputs[t];void 0!==n&&(s.inputs[t]=n,s.declaredInputs[t]=e.declaredInputs[t])}}function ET(s){return s===ul?{}:s===Ls?[]:s}function Gz(s,e){const t=s.viewQuery;s.viewQuery=t?(n,i)=>{e(n,i),t(n,i)}:e}function Uz(s,e){const t=s.contentQueries;s.contentQueries=t?(n,i,r)=>{e(n,i,r),t(n,i,r)}:e}function zz(s,e){const t=s.hostBindings;s.hostBindings=t?(n,i)=>{e(n,i),t(n,i)}:e}function qn(s,e,t,n,i,r,o,a){const l=ee(),c=yn();return function Zz(s,e,t,n,i,r,o,a,l,c,u){const h=t+27;let d;e.firstCreatePass?(d=ah(e,h,4,o||null,a||null),AS()&&qB(e,s,d,Er(e.consts,c),Xv),JE(e,d)):d=e.data[h],function BM(s,e,t,n,i,r,o,a){if(t.firstCreatePass){s.mergedAttrs=xd(s.mergedAttrs,s.attrs);const u=s.tView=Fv(2,s,i,r,o,t.directiveRegistry,t.pipeRegistry,null,t.schemas,t.consts,null);null!==t.queries&&(t.queries.template(t,s),u.queries=t.queries.embeddedTView(s))}a&&(s.flags|=a),tc(s,!1);const l=PM(t,e,s,n);fy()&&qv(t,e,l,s),yo(l,e);const c=mB(l,e,l,s);e[n+27]=c,Lv(e,c)}(d,s,e,t,n,i,r,l),md(d)&&Xy(e,s,d),null!=c&&Ld(s,d,u)}(l,c,s,e,t,n,i,Er(c.consts,r),void 0,o,a),qn}let PM=function AM(s,e,t,n){return gp(!0),e[11].createComment("")};var BT=function(s){return s[s.CHANGE_DETECTION=0]="CHANGE_DETECTION",s[s.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",s}(BT||{});const ig=new ve(""),VM=!1,Li=class sq extends xn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(e=!1){super(),this.__isAsync=e,function CS(){return void 0!==xN()||null!=Bn()}()&&(this.destroyRef=le(fl,{optional:!0})??void 0,this.pendingTasks=le($c,{optional:!0})??void 0)}emit(e){const t=vt(null);try{super.next(e)}finally{vt(t)}}subscribe(e,t,n){let i=e,r=t||(()=>null),o=n;if(e&&"object"==typeof e){const l=e;i=l.next?.bind(l),r=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(r=this.wrapInTimeout(r),i&&(i=this.wrapInTimeout(i)),o&&(o=this.wrapInTimeout(o)));const a=super.subscribe({next:i,error:r,complete:o});return e instanceof rr&&e.add(a),a}wrapInTimeout(e){return t=>{const n=this.pendingTasks?.add();setTimeout(()=>{try{e(t)}finally{void 0!==n&&this.pendingTasks?.remove(n)}})}}};function HM(s){let e,t;function n(){s=mp;try{void 0!==t&&"function"==typeof cancelAnimationFrame&&cancelAnimationFrame(t),void 0!==e&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{s(),n()}),"function"==typeof requestAnimationFrame&&(t=requestAnimationFrame(()=>{s(),n()})),()=>n()}function WM(s){return queueMicrotask(()=>s()),()=>{s=mp}}const MT="isAngularZone",w_=MT+"_ID";let iq=0;class Jn{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Li(!1);onMicrotaskEmpty=new Li(!1);onStable=new Li(!1);onError=new Li(!1);constructor(e){const{enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1,scheduleInRootZone:r=VM}=e;if(typeof Zone>"u")throw new R(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!i&&n,o.shouldCoalesceRunChangeDetection=i,o.callbackScheduled=!1,o.scheduleInRootZone=r,function aq(s){const e=()=>{!function oq(s){function e(){HM(()=>{s.callbackScheduled=!1,AT(s),s.isCheckStableRunning=!0,PT(s),s.isCheckStableRunning=!1})}s.isCheckStableRunning||s.callbackScheduled||(s.callbackScheduled=!0,s.scheduleInRootZone?Zone.root.run(()=>{e()}):s._outer.run(()=>{e()}),AT(s))}(s)},t=iq++;s._inner=s._inner.fork({name:"angular",properties:{[MT]:!0,[w_]:t,[w_+t]:!0},onInvokeTask:(n,i,r,o,a,l)=>{if(function lq(s){return zM(s,"__ignore_ng_zone__")}(l))return n.invokeTask(r,o,a,l);try{return GM(s),n.invokeTask(r,o,a,l)}finally{(s.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||s.shouldCoalesceRunChangeDetection)&&e(),UM(s)}},onInvoke:(n,i,r,o,a,l,c)=>{try{return GM(s),n.invoke(r,o,a,l,c)}finally{s.shouldCoalesceRunChangeDetection&&!s.callbackScheduled&&!function cq(s){return zM(s,"__scheduler_tick__")}(l)&&e(),UM(s)}},onHasTask:(n,i,r,o)=>{n.hasTask(r,o),i===r&&("microTask"==o.change?(s._hasPendingMicrotasks=o.microTask,AT(s),PT(s)):"macroTask"==o.change&&(s.hasPendingMacrotasks=o.macroTask))},onHandleError:(n,i,r,o)=>(n.handleError(r,o),s.runOutsideAngular(()=>s.onError.emit(o)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get(MT)}static assertInAngularZone(){if(!Jn.isInAngularZone())throw new R(909,!1)}static assertNotInAngularZone(){if(Jn.isInAngularZone())throw new R(909,!1)}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,i){const r=this._inner,o=r.scheduleEventTask("NgZoneEvent: "+i,e,rq,mp,mp);try{return r.runTask(o,t,n)}finally{r.cancelTask(o)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}const rq={};function PT(s){if(0==s._nesting&&!s.hasPendingMicrotasks&&!s.isStable)try{s._nesting++,s.onMicrotaskEmpty.emit(null)}finally{if(s._nesting--,!s.hasPendingMicrotasks)try{s.runOutsideAngular(()=>s.onStable.emit(null))}finally{s.isStable=!0}}}function AT(s){s.hasPendingMicrotasks=!!(s._hasPendingMicrotasks||(s.shouldCoalesceEventChangeDetection||s.shouldCoalesceRunChangeDetection)&&!0===s.callbackScheduled)}function GM(s){s._nesting++,s.isStable&&(s.isStable=!1,s.onUnstable.emit(null))}function UM(s){s._nesting--,PT(s)}class RT{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Li;onMicrotaskEmpty=new Li;onStable=new Li;onError=new Li;run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,i){return e.apply(t,n)}}function zM(s,e){return!(!Array.isArray(s)||1!==s.length)&&!0===s[0]?.data?.[e]}let qM=(()=>{class s{impl=null;execute(){this.impl?.execute()}static \u0275prov=ut({token:s,providedIn:"root",factory:()=>new s})}return s})();const $M=[0,1,2,3];let hq=(()=>{class s{ngZone=le(Jn);scheduler=le(eh);errorHandler=le(Sd,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){le(ig,{optional:!0})}execute(){const t=this.sequences.size>0;t&&ds(16),this.executing=!0;for(const n of $M)for(const i of this.sequences)if(!i.erroredOrDestroyed&&i.hooks[n])try{i.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>(0,i.hooks[n])(i.pipelinedValue),i.snapshot))}catch(r){i.erroredOrDestroyed=!0,this.errorHandler?.handleError(r)}this.executing=!1;for(const n of this.sequences)n.afterRun(),n.once&&(this.sequences.delete(n),n.destroy());for(const n of this.deferredRegistrations)this.sequences.add(n);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),t&&ds(17)}register(t){const{view:n}=t;void 0!==n?((n[25]??=[]).push(t),bd(n),n[2]|=8192):this.executing?this.deferredRegistrations.add(t):this.addSequence(t)}addSequence(t){this.sequences.add(t),this.scheduler.notify(7)}unregister(t){this.executing&&this.sequences.has(t)?(t.erroredOrDestroyed=!0,t.pipelinedValue=void 0,t.once=!0):(this.sequences.delete(t),this.deferredRegistrations.delete(t))}maybeTrace(t,n){return n?n.run(BT.AFTER_NEXT_RENDER,t):t()}static \u0275prov=ut({token:s,providedIn:"root",factory:()=>new s})}return s})();class jM{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(e,t,n,i,r,o=null){this.impl=e,this.hooks=t,this.view=n,this.once=i,this.snapshot=o,this.unregisterOnDestroy=r?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();const e=this.view?.[25];e&&(this.view[25]=e.filter(t=>t!==this))}}function YM(s,e){const t=e?.injector??le(Vo);return Ir("NgAfterNextRender"),function XM(s,e,t,n){const i=e.get(qM);i.impl??=e.get(hq);const r=e.get(ig,null,{optional:!0}),o=!0!==t?.manualCleanup?e.get(fl):null,a=e.get(GS,null,{optional:!0}),l=new jM(i.impl,function fq(s){return s instanceof Function?[void 0,void 0,s,void 0]:[s.earlyRead,s.write,s.mixedReadWrite,s.read]}(s),a?.view,n,o,r?.snapshot(null));return i.impl.register(l),l}(s,t,e,!0)}let iP=(()=>{class s{log(t){console.log(t)}warn(t){console.warn(t)}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"platform"})}return s})();const bP=new ve("");function ag(s){return!!s&&"function"==typeof s.then}function wP(s){return!!s&&"function"==typeof s.subscribe}const SP=new ve("");let vP=(()=>{class s{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((t,n)=>{this.resolve=t,this.reject=n});appInits=le(SP,{optional:!0})??[];injector=le(Vo);constructor(){}runInitializers(){if(this.initialized)return;const t=[];for(const i of this.appInits){const r=na(this.injector,i);if(ag(r))t.push(r);else if(wP(r)){const o=new Promise((a,l)=>{r.subscribe({complete:a,error:l})});t.push(o)}}const n=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{n()}).catch(i=>{this.reject(i)}),0===t.length&&n(),this.initialized=!0}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const TP=new ve("");let uc=(()=>{class s{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=le(Ea);afterRenderManager=le(qM);zonelessEnabled=le(WS);rootEffectScheduler=le(CE);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new xn;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=le($c);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(Kn(t=>!t))}constructor(){le(ig,{optional:!0})}whenStable(){let t;return new Promise(n=>{t=this.isStable.subscribe({next:i=>{i&&n()}})}).finally(()=>{t.unsubscribe()})}_injector=le($r);_rendererFactory=null;get injector(){return this._injector}bootstrap(t,n){return this.bootstrapImpl(t,n)}bootstrapImpl(t,n,i=Vo.NULL){return this._injector.get(Jn).run(()=>{ds(10);const o=t instanceof UB;if(!this._injector.get(vP).done)throw new R(405,"");let l;l=o?t:this._injector.get(u_).resolveComponentFactory(t),this.componentTypes.push(l.componentType);const c=function _7(s){return s.isBoundToModule}(l)?void 0:this._injector.get(hh),h=l.create(i,[],n||l.selector,c),d=h.location.nativeElement,p=h.injector.get(bP,null);return p?.registerApplication(d),h.onDestroy(()=>{this.detachView(h.hostView),D_(this.components,h),p?.unregisterApplication(d)}),this._loadComponent(h),ds(11,h),h})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){ds(12),null!==this.tracingSnapshot?this.tracingSnapshot.run(BT.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new R(101,!1);const t=vt(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,vt(t),this.afterTick.next(),ds(13)}};synchronize(){null===this._rendererFactory&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(cT,null,{optional:!0}));let t=0;for(;0!==this.dirtyFlags&&t++<10;)ds(14),this.synchronizeOnce(),ds(15)}synchronizeOnce(){16&this.dirtyFlags&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let t=!1;if(7&this.dirtyFlags){const n=!!(1&this.dirtyFlags);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:i}of this.allViews)(n||cy(i))&&(t_(i,n&&!this.zonelessEnabled?0:1),t=!0);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),23&this.dirtyFlags)return}t||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),8&this.dirtyFlags&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){this.allViews.some(({_lView:t})=>cy(t))?this.dirtyFlags|=2:this.dirtyFlags&=-8}attachView(t){const n=t;this._views.push(n),n.attachToAppRef(this)}detachView(t){const n=t;D_(this._views,n),n.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView);try{this.tick()}catch(i){this.internalErrorHandler(i)}this.components.push(t),this._injector.get(TP,[]).forEach(i=>i(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>D_(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new R(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function D_(s,e){const t=s.indexOf(e);t>-1&&s.splice(t,1)}function Fn(s,e,t,n){const i=ee();return js(i,go(),e)&&(yn(),function yG(s,e,t,n,i,r){const o=Fi(s,e);!function Jy(s,e,t,n,i,r,o){if(null==r)s.removeAttribute(e,i,t);else{const a=null==o?cn(r):o(r,n||"",i);s.setAttribute(e,i,a,t)}}(e[11],o,r,s.value,t,n,i)}(dl(),i,s,e,t,n)),Fn}function gt(s,e,t){const n=ee();return js(n,go(),e)&&(yn(),jv(dl(),n,s,e,n[11],t)),gt}function sk(s,e,t,n,i){Ky(e,s,t,i?"class":"style",n)}function K(s,e,t,n){const i=ee(),r=i[1],o=s+27,a=r.firstCreatePass?dT(o,i,2,e,Xv,AS(),t,n):r.data[o];if(Zy(a,i,s,e,ok),md(a)){const l=i[1];Xy(l,i,a),Cv(l,a,i)}return null!=n&&Ld(i,a),K}function J(){const s=yn(),t=Qy(sn());return s.firstCreatePass&&fT(s,t),function eE(s){return Zt.skipHydrationRootTNode===s}(t)&&function tE(){Zt.skipHydrationRootTNode=null}(),function QN(){Zt.lFrame.elementDepthCount--}(),null!=t.classesWithoutHost&&function wW(s){return!!(8&s.flags)}(t)&&sk(s,t,ee(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function SW(s){return!!(16&s.flags)}(t)&&sk(s,t,ee(),t.stylesWithoutHost,!1),J}function Xi(s,e,t,n){return K(s,e,t,n),J(),Xi}typeof document<"u"&&document;let ok=(s,e,t,n,i)=>(gp(!0),Gy(e[11],n,function l4(){return Zt.lFrame.currentNamespace}()));function _h(s,e,t){const n=ee(),i=n[1],r=s+27,o=i.firstCreatePass?dT(r,n,8,"ng-container",Xv,AS(),e,t):i.data[r];if(Zy(o,n,s,"ng-container",lk),md(o)){const a=n[1];Xy(a,n,o),Cv(a,o,n)}return null!=t&&Ld(n,o),_h}function iu(){const s=yn(),t=Qy(sn());return s.firstCreatePass&&fT(s,t),iu}let lk=(s,e,t,n,i)=>(gp(!0),Rv(e[11],""));function Ys(){return ee()}const A_="en-US";let ZP=A_;function ht(s,e,t){const n=ee(),i=yn(),r=sn();return hk(i,n,n[11],r,s,e,t),ht}function hk(s,e,t,n,i,r,o){let a=!0,l=null;if((3&n.type||o)&&(l??=Qp(n,e,r),function QB(s,e,t,n,i,r,o,a){const l=md(s);let c=!1,u=null;if(!n&&l&&(u=function XU(s,e,t,n){const i=s.cleanup;if(null!=i)for(let r=0;r<i.length-1;r+=2){const o=i[r];if(o===t&&i[r+1]===n){const a=e[7],l=i[r+2];return a&&a.length>l?a[l]:null}"string"==typeof o&&(r+=2)}return null}(e,t,r,s.index)),null!==u)(u.__ngLastListenerFn__||u).__ngNextListenerFn__=o,u.__ngLastListenerFn__=o,c=!0;else{const h=Fi(s,t),d=n?n(h):h,p=i.listen(d,r,a);(function YU(s){return s.startsWith("animation")||s.startsWith("transition")})(r)||KB(n?m=>n(cr(m[s.index])):s.index,e,t,r,a,p,!1)}return c}(n,s,e,o,t,i,r,l)&&(a=!1)),a){const c=n.outputs?.[i],u=n.hostDirectiveOutputs?.[i];if(u&&u.length)for(let h=0;h<u.length;h+=2){const d=u[h],p=u[h+1];l??=Qp(n,e,r),g_(n,e,d,p,i,l)}if(c&&c.length)for(const h of c)l??=Qp(n,e,r),g_(n,e,h,i,i,l)}}function _e(s=1){return function i4(s){return(Zt.lFrame.contextLView=function XN(s,e){for(;s>0;)e=e[14],s--;return e}(s,Zt.lFrame.contextLView))[8]}(s)}function bA(s){return Qu(function rE(){return Zt.lFrame.contextLView}(),27+s)}function L_(s,e){return s<<17|e<<2}function bh(s){return s>>17&32767}function pk(s){return 2|s}function ef(s){return(131068&s)>>2}function gk(s,e){return-131069&s|e<<2}function mk(s){return 1|s}function wA(s,e,t,n){const i=s[t+1],r=null===e;let o=n?bh(i):ef(i),a=!1;for(;0!==o&&(!1===a||r);){const c=s[o+1];Pj(s[o],e)&&(a=!0,s[o+1]=n?mk(c):pk(c)),o=n?bh(c):ef(c)}a&&(s[t+1]=n?pk(i):mk(i))}function Pj(s,e){return null===s||null==e||(Array.isArray(s)?s[1]:s)===e||!(!Array.isArray(s)||"string"!=typeof e)&&up(s,e)>=0}function yk(s,e,t){return xA(s,e,t,!1),yk}function br(s,e){return xA(s,e,null,!0),br}function xA(s,e,t,n){const i=ee(),r=yn(),o=sc(2);r.firstUpdatePass&&function IA(s,e,t,n){const i=s.data;if(null===i[t+1]){const r=i[yr()],o=function EA(s,e){return e>=s.expandoStartIndex}(s,t);(function AA(s,e){return!!(s.flags&(e?8:16))})(r,n)&&null===e&&!o&&(e=!1),e=function zj(s,e,t,n){const i=function FS(s){const e=Zt.lFrame.currentDirectiveIndex;return-1===e?null:s[e]}(s);let r=n?e.residualClasses:e.residualStyles;if(null===i)0===(n?e.classBindings:e.styleBindings)&&(t=pg(t=_k(null,s,e,t,n),e.attrs,n),r=null);else{const o=e.directiveStylingLast;if(-1===o||s[o]!==i)if(t=_k(i,s,e,t,n),null===r){let l=function qj(s,e,t){const n=t?e.classBindings:e.styleBindings;if(0!==ef(n))return s[bh(n)]}(s,e,n);void 0!==l&&Array.isArray(l)&&(l=_k(null,s,e,l[1],n),l=pg(l,e.attrs,n),function $j(s,e,t,n){s[bh(t?e.classBindings:e.styleBindings)]=n}(s,e,n,l))}else r=function jj(s,e,t){let n;const i=e.directiveEnd;for(let r=1+e.directiveStylingLast;r<i;r++)n=pg(n,s[r].hostAttrs,t);return pg(n,e.attrs,t)}(s,e,n)}return void 0!==r&&(n?e.residualClasses=r:e.residualStyles=r),t}(i,r,e,n),function Bj(s,e,t,n,i,r){let o=r?e.classBindings:e.styleBindings,a=bh(o),l=ef(o);s[n]=t;let u,c=!1;if(Array.isArray(t)?(u=t[1],(null===u||up(t,u)>0)&&(c=!0)):u=t,i)if(0!==l){const d=bh(s[a+1]);s[n+1]=L_(d,a),0!==d&&(s[d+1]=gk(s[d+1],n)),s[a+1]=function Ej(s,e){return 131071&s|e<<17}(s[a+1],n)}else s[n+1]=L_(a,0),0!==a&&(s[a+1]=gk(s[a+1],n)),a=n;else s[n+1]=L_(l,0),0===a?a=n:s[l+1]=gk(s[l+1],n),l=n;c&&(s[n+1]=pk(s[n+1])),wA(s,u,n,!0),wA(s,u,n,!1),function Mj(s,e,t,n,i){const r=i?s.residualClasses:s.residualStyles;null!=r&&"string"==typeof e&&up(r,e)>=0&&(t[n+1]=mk(t[n+1]))}(e,u,s,n,r),o=L_(a,l),r?e.classBindings=o:e.styleBindings=o}(i,r,e,t,o,n)}}(r,s,o,n),e!==_s&&js(i,o,e)&&function MA(s,e,t,n,i,r,o,a){if(!(3&e.type))return;const l=s.data,c=l[a+1],u=function Ij(s){return!(1&~s)}(c)?PA(l,e,t,i,ef(c),o):void 0;V_(u)||(V_(r)||function Nj(s){return!(2&~s)}(c)&&(r=PA(l,null,t,i,a,o)),function cG(s,e,t,n,i){if(e)i?s.addClass(t,n):s.removeClass(t,n);else{let r=-1===n.indexOf("-")?void 0:Qc.DashCase;null==i?s.removeStyle(t,n,r):("string"==typeof i&&i.endsWith("!important")&&(i=i.slice(0,-10),r|=Qc.Important),s.setStyle(t,n,i,r))}}(n,o,yd(yr(),t),i,r))}(r,r.data[yr()],i,i[11],s,i[o+1]=function Zj(s,e){return null==s||""===s||("string"==typeof e?s+=e:"object"==typeof s&&(s=si(function Zc(s){return s instanceof pI?s.changingThisBreaksApplicationSecurity:s}(s)))),s}(e,t),n,o)}function _k(s,e,t,n,i){let r=null;const o=t.directiveEnd;let a=t.directiveStylingLast;for(-1===a?a=t.directiveStart:a++;a<o&&(r=e[a],n=pg(n,r.hostAttrs,i),r!==s);)a++;return null!==s&&(t.directiveStylingLast=a),n}function pg(s,e,t){const n=t?1:2;let i=-1;if(null!==e)for(let r=0;r<e.length;r++){const o=e[r];"number"==typeof o?i=o:i===n&&(Array.isArray(s)||(s=void 0===s?[]:["",s]),ty(s,o,!!t||e[++r]))}return void 0===s?null:s}function PA(s,e,t,n,i,r){const o=null===e;let a;for(;i>0;){const l=s[i],c=Array.isArray(l),u=c?l[1]:l,h=null===u;let d=t[i+1];d===_s&&(d=h?Ls:void 0);let p=h?pS(d,n):u===n?d:void 0;if(c&&!V_(p)&&(p=pS(l,n)),V_(p)&&(a=p,o))return a;const g=s[i+1];i=o?bh(g):ef(g)}if(null!==e){let l=r?e.residualClasses:e.residualStyles;null!=l&&(a=pS(l,n))}return a}function V_(s){return void 0!==s}function we(s,e=""){const t=ee(),n=yn(),i=s+27,r=n.firstCreatePass?ah(n,i,1,e,null):n.data[i],o=RA(n,t,r,e,s);t[i]=o,fy()&&qv(n,t,o,r),tc(r,!1)}let RA=(s,e,t,n,i)=>(gp(!0),function Av(s,e){return s.createText(e)}(e[11],n));function LA(s,e,t,n,i,r=""){const a=function uh(s,e,t,n){const i=js(s,e,t);return js(s,e+1,n)||i}(s,function nc(){return Zt.lFrame.bindingIndex}(),t,i);return sc(2),a?e+cn(t)+n+cn(i)+r:_s}function vo(s){return hr("",s),vo}function hr(s,e,t){const n=ee(),i=function OA(s,e,t,n=""){return js(s,go(),t)?e+cn(t)+n:_s}(n,s,e,t);return i!==_s&&hc(n,yr(),i),hr}function H_(s,e,t,n,i){const r=ee(),o=LA(r,s,e,t,n,i);return o!==_s&&hc(r,yr(),o),H_}function hc(s,e,t){const n=yd(e,s);!function OI(s,e,t){s.setValue(e,t)}(s[11],n,t)}function Wo(s,e,t){SE(e)&&(e=e());const n=ee();return js(n,go(),e)&&(yn(),jv(dl(),n,s,e,n[11],t)),Wo}function aa(s,e){const t=SE(s);return t&&s.set(e),t}function Go(s,e){const t=ee(),n=yn(),i=sn();return hk(n,t,t[11],i,s,e),Go}function bk(s,e,t,n,i){if(s=X(s),Array.isArray(s))for(let r=0;r<s.length;r++)bk(s[r],e,t,n,i);else{const r=yn(),o=ee(),a=sn();let l=Xl(s)?s:X(s.provide);const c=VN(s),u=1048575&a.providerIndexes,h=a.directiveStart,d=a.providerIndexes>>20;if(Xl(s)||!s.multi){const p=new vp(c,i,ue,null),g=Sk(l,e,i?u:u+d,h);-1===g?(KS(vy(a,o),r,l),wk(r,s,e.length),e.push(l),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),t.push(p),o.push(p)):(t[g]=p,o[g]=p)}else{const p=Sk(l,e,u+d,h),g=Sk(l,e,u,u+d),_=g>=0&&t[g];if(i&&!_||!i&&!(p>=0&&t[p])){KS(vy(a,o),r,l);const y=function g9(s,e,t,n,i){const o=new vp(s,t,ue,null);return o.multi=[],o.index=e,o.componentProviders=0,eR(o,i,n&&!t),o}(i?p9:f9,t.length,i,n,c);!i&&_&&(t[g].providerFactory=y),wk(r,s,e.length,0),e.push(l),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),t.push(y),o.push(y)}else wk(r,s,p>-1?p:g,eR(t[i?g:p],c,!i&&n));!i&&n&&_&&t[g].componentProviders++}}}function wk(s,e,t,n){const i=Xl(e),r=function ON(s){return!!s.useClass}(e);if(i||r){const l=(r?X(e.useClass):e).prototype.ngOnDestroy;if(l){const c=s.destroyHooks||(s.destroyHooks=[]);if(!i&&e.multi){const u=c.indexOf(t);-1===u?c.push(t,[n,l]):c[u+1].push(n,l)}else c.push(t,l)}}}function eR(s,e,t){return t&&s.componentProviders++,s.multi.push(e)-1}function Sk(s,e,t,n){for(let i=t;i<n;i++)if(e[i]===s)return i;return-1}function f9(s,e,t,n,i){return vk(this.multi,[])}function p9(s,e,t,n,i){const r=this.multi;let o;if(this.providerFactory){const a=this.providerFactory.componentProviders,l=Cp(n,n[1],this.providerFactory.index,i);o=l.slice(0,a),vk(r,o);for(let c=a;c<l.length;c++)o.push(l[c])}else o=[],vk(r,o);return o}function vk(s,e){for(let t=0;t<s.length;t++)e.push((0,s[t])());return e}function Qs(s,e=[]){return t=>{t.providersResolver=(n,i)=>function d9(s,e,t){const n=yn();if(n.firstCreatePass){const i=Lo(s);bk(t,n.data,n.blueprint,i,!0),bk(e,n.data,n.blueprint,i,!1)}}(n,i?i(s):s,e)}}function nf(s,e,t){const n=Xr()+s,i=ee();return i[n]===_s?ml(i,n,t?e.call(t):e()):function Zp(s,e){return s[e]}(i,n)}function nR(s,e,t,n,i,r){const o=e+t;return js(s,o,i)?ml(s,o+1,r?n.call(r,i):n(i)):function gg(s,e){const t=s[e];return t===_s?void 0:t}(s,o+1)}function Tk(s,e){const t=yn();let n;const i=s+27;t.firstCreatePass?(n=function N9(s,e){if(e)for(let t=e.length-1;t>=0;t--){const n=e[t];if(s===n.name)return n}}(e,t.pipeRegistry),t.data[i]=n,n.onDestroy&&(t.destroyHooks??=[]).push(i,n.onDestroy)):n=t.data[i];const r=n.factory||(n.factory=ju(n.type)),a=po(ue);try{const l=Sy(!1),c=r();return Sy(l),function NS(s,e,t,n){t>=s.data.length&&(s.data[t]=null,s.blueprint[t]=null),e[t]=n}(t,ee(),i,c),c}finally{po(a)}}function kk(s,e,t){const n=s+27,i=ee(),r=Qu(i,n);return function mg(s,e){return s[1].data[e].pure}(i,n)?nR(i,Xr(),e,r.transform,t,r):r.transform(t)}class aY{ngModuleFactory;componentFactories;constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let lY=(()=>{class s{compileModuleSync(t){return new SM(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const n=this.compileModuleSync(t),r=gl(hl(t).declarations).reduce((o,a)=>{const l=hs(a);return l&&o.push(new gT(l)),o},[]);return new aY(n,r)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),uY=(()=>{class s{zone=le(Jn);changeDetectionScheduler=le(eh);applicationRef=le(uc);applicationErrorHandler=le(Ea);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(t){this.applicationErrorHandler(t)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const hY=new ve("",{factory:()=>!1});function Ek({ngZoneFactory:s,ignoreChangesOutsideZone:e,scheduleInRootZone:t}){return s??=()=>new Jn({...Ik(),scheduleInRootZone:t}),[{provide:Jn,useFactory:s},{provide:Wc,multi:!0,useFactory:()=>{const n=le(uY,{optional:!0});return()=>n.initialize()}},{provide:Wc,multi:!0,useFactory:()=>{const n=le(fY);return()=>{n.initialize()}}},!0===e?{provide:vE,useValue:!0}:[],{provide:TE,useValue:t??VM},{provide:Ea,useFactory:()=>{const n=le(Jn),i=le($r);let r;return o=>{n.runOutsideAngular(()=>{i.destroyed&&!r?setTimeout(()=>{throw o}):(r??=i.get(Sd),r.handleError(o))})}}}]}function Ik(s){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:s?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:s?.runCoalescing??!1}}let fY=(()=>{class s{subscription=new rr;initialized=!1;zone=le(Jn);pendingTasks=le($c);initialize(){if(this.initialized)return;this.initialized=!0;let t=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(t=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Jn.assertNotInAngularZone(),queueMicrotask(()=>{null!==t&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(t),t=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Jn.assertInAngularZone(),t??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),Mk=(()=>{class s{applicationErrorHandler=le(Ea);appRef=le(uc);taskService=le($c);ngZone=le(Jn);zonelessEnabled=le(WS);tracing=le(ig,{optional:!0});disableScheduling=le(vE,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new rr;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(w_):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(le(TE,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof RT||!this.zoneIsDefined)}notify(t){if(!this.zonelessEnabled&&5===t)return;let n=!1;switch(t){case 0:this.appRef.dirtyFlags|=2;break;case 3:case 2:case 4:case 5:case 1:this.appRef.dirtyFlags|=4;break;case 6:case 13:this.appRef.dirtyFlags|=2,n=!0;break;case 12:this.appRef.dirtyFlags|=16,n=!0;break;case 11:n=!0;break;default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(n))return;const i=this.useMicrotaskScheduler?WM:HM;this.pendingRenderTaskId=this.taskService.add(),this.cancelScheduledCallback=this.scheduleInRootZone?Zone.root.run(()=>i(()=>this.tick())):this.ngZone.runOutsideAngular(()=>i(()=>this.tick()))}shouldScheduleTick(t){return!(this.disableScheduling&&!t||this.appRef.destroyed||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(w_+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(0===this.appRef.dirtyFlags)return void this.cleanup();!this.zonelessEnabled&&7&this.appRef.dirtyFlags&&(this.appRef.dirtyFlags|=1);const t=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(n){this.taskService.remove(t),this.applicationErrorHandler(n)}finally{this.cleanup()}this.useMicrotaskScheduler=!0,WM(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(t)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const t=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(t)}}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const ou=new ve("",{providedIn:"root",factory:()=>le(ou,{optional:!0,skipSelf:!0})||function pY(){return typeof $localize<"u"&&$localize.locale||A_}()}),$_=Symbol("InputSignalNode#UNSET"),ER={...np,transformFn:void 0,applyValueToInputSignal(s,e){Ao(s,e)}};function IR(s,e){const t=Object.create(ER);function n(){if(nl(t),t.value===$_)throw new R(-950,null);return t.value}return t.value=s,t.transformFn=e?.transform,n[Zn]=t,n}function BR(s,e){return IR(s,e)}new ve("").__NG_ELEMENT_ID__=s=>{const e=sn();if(null===e)throw new R(204,!1);if(2&e.type)return e.value;if(8&s)return null;throw new R(204,!1)};const CY=(BR.required=function kY(s){return IR($_,s)},BR),j_=new ve(""),IY=new ve("");function _g(s){return!s.moduleRef}let OR,af=null;let lf=(()=>class s{static __NG_ELEMENT_ID__=FY})();function FY(s){return function OY(s,e,t){if(Ql(s)&&!t){const n=Yr(s.index,e);return new Wp(n,n)}return 175&s.type?new Wp(e[15],e):null}(sn(),ee(),!(16&~s))}class UR{constructor(){}supports(e){return f_(e)}create(e){return new VY(e)}}const LY=(s,e)=>e;class VY{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(e){this._trackByFn=e||LY}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,i=0,r=null;for(;t||n;){const o=!n||t&&t.currentIndex<qR(n,i,r)?t:n,a=qR(o,i,r),l=o.currentIndex;if(o===n)i--,n=n._nextRemoved;else if(t=t._next,null==o.previousIndex)i++;else{r||(r=[]);const c=a-i,u=l-i;if(c!=u){for(let d=0;d<c;d++){const p=d<r.length?r[d]:r[d]=0,g=p+d;u<=g&&g<c&&(r[d]=p+1)}r[o.previousIndex]=u-c}}a!==l&&e(o,a,l)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!f_(e))throw new R(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let i,r,o,t=this._itHead,n=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)r=e[a],o=this._trackByFn(a,r),null!==t&&Object.is(t.trackById,o)?(n&&(t=this._verifyReinsertion(t,r,o,a)),Object.is(t.item,r)||this._addIdentityChange(t,r)):(t=this._mismatch(t,r,o,a),n=!0),t=t._next}else i=0,function $U(s,e){if(Array.isArray(s))for(let t=0;t<s.length;t++)e(s[t]);else{const t=s[Symbol.iterator]();let n;for(;!(n=t.next()).done;)e(n.value)}}(e,a=>{o=this._trackByFn(i,a),null!==t&&Object.is(t.trackById,o)?(n&&(t=this._verifyReinsertion(t,a,o,i)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,o,i),n=!0),t=t._next,i++}),this.length=i;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,i){let r;return null===e?r=this._itTail:(r=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,r,i)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,i))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,r,i)):e=this._addAfter(new HY(t,n),r,i),e}_verifyReinsertion(e,t,n,i){let r=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==r?e=this._reinsertAfter(r,e._prev,i):e.currentIndex!=i&&(e.currentIndex=i,this._addToMoves(e,i)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const i=e._prevRemoved,r=e._nextRemoved;return null===i?this._removalsHead=r:i._nextRemoved=r,null===r?this._removalsTail=i:r._prevRemoved=i,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const i=null===t?this._itHead:t._next;return e._next=i,e._prev=t,null===i?this._itTail=e:i._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new zR),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new zR),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class HY{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(e,t){this.item=e,this.trackById=t}}class WY{_head=null;_tail=null;add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class zR{map=new Map;put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new WY,this.map.set(t,n)),n.add(e)}get(e,t){const i=this.map.get(e);return i?i.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function qR(s,e,t){const n=s.previousIndex;if(null===n)return n;let i=0;return t&&n<t.length&&(i=t[n]),n+e+i}class $R{constructor(){}supports(e){return e instanceof Map||pT(e)}create(){return new GY}}class GY{_records=new Map;_mapHead=null;_appendAfter=null;_previousMapHead=null;_changesHead=null;_changesTail=null;_additionsHead=null;_additionsTail=null;_removalsHead=null;_removalsTail=null;get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||pT(e)))throw new R(900,!1)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(n,i)=>{if(t&&t.key===i)this._maybeAddToChanges(t,n),this._appendAfter=t,t=t._next;else{const r=this._getOrCreateRecordForKey(i,n);t=this._insertBeforeOrAppend(t,r)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let n=t;null!==n;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const i=this._records.get(e);this._maybeAddToChanges(i,t);const r=i._prev,o=i._next;return r&&(r._next=o),o&&(o._prev=r),i._next=null,i._prev=null,i}const n=new UY(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}}class UY{key;previousValue=null;currentValue=null;_nextPrevious=null;_next=null;_prev=null;_nextAdded=null;_nextRemoved=null;_nextChanged=null;constructor(e){this.key=e}}function jR(){return new Fk([new UR])}let Fk=(()=>{class s{factories;static \u0275prov=ut({token:s,providedIn:"root",factory:jR});constructor(t){this.factories=t}static create(t,n){if(null!=n){const i=n.factories.slice();t=t.concat(i)}return new s(t)}static extend(t){return{provide:s,useFactory:()=>{const n=le(s,{optional:!0,skipSelf:!0});return s.create(t,n||jR())}}}find(t){const n=this.factories.find(i=>i.supports(t));if(null!=n)return n;throw new R(901,!1)}}return s})();function YR(){return new X_([new $R])}let X_=(()=>{class s{static \u0275prov=ut({token:s,providedIn:"root",factory:YR});factories;constructor(t){this.factories=t}static create(t,n){if(n){const i=n.factories.slice();t=t.concat(i)}return new s(t)}static extend(t){return{provide:s,useFactory:()=>{const n=le(s,{optional:!0,skipSelf:!0});return s.create(t,n||YR())}}}find(t){const n=this.factories.find(i=>i.supports(t));if(n)return n;throw new R(901,!1)}}return s})();function $Y(s){const{rootComponent:e,appProviders:t,platformProviders:n,platformRef:i}=s;ds(8);try{const r=i?.injector??function RY(s=[]){if(af)return af;const e=function HR(s=[],e){return Vo.create({name:e,providers:[{provide:wS,useValue:"platform"},{provide:j_,useValue:new Set([()=>af=null])},...s]})}(s);return af=e,function y7(){!function Ca(s){rl=s}(()=>{throw new R(600,"")})}(),function WR(s){const e=s.get(O1,null);na(s,()=>{e?.forEach(t=>t())})}(e),e}(n),o=[Ek({}),{provide:eh,useExisting:Mk},bE,...t||[]];return function FR(s){const e=_g(s)?s.r3Injector:s.moduleRef.injector,t=e.get(Jn);return t.run(()=>{_g(s)?s.r3Injector.resolveInjectorInitializers():s.moduleRef.resolveInjectorInitializers();const n=e.get(Ea);let i;if(t.runOutsideAngular(()=>{i=t.onError.subscribe({next:n})}),_g(s)){const r=()=>e.destroy(),o=s.platformInjector.get(j_);o.add(r),e.onDestroy(()=>{i.unsubscribe(),o.delete(r)})}else{const r=()=>s.moduleRef.destroy(),o=s.platformInjector.get(j_);o.add(r),s.moduleRef.onDestroy(()=>{D_(s.allPlatformModules,s.moduleRef),i.unsubscribe(),o.delete(r)})}return function MY(s,e,t){try{const n=t();return ag(n)?n.catch(i=>{throw e.runOutsideAngular(()=>s(i)),i}):n}catch(n){throw e.runOutsideAngular(()=>s(n)),n}}(n,t,()=>{const r=e.get($c),o=r.add(),a=e.get(vP);return a.runInitializers(),a.donePromise.then(()=>{if(function L$(s){"string"==typeof s&&(ZP=s.toLowerCase().replace(/_/g,"-"))}(e.get(ou,A_)||A_),!e.get(IY,!0))return _g(s)?e.get(uc):(s.allPlatformModules.push(s.moduleRef),s.moduleRef);if(_g(s)){const u=e.get(uc);return void 0!==s.rootComponent&&u.bootstrap(s.rootComponent),u}return OR?.(s.moduleRef,s.allPlatformModules),s.moduleRef}).finally(()=>{r.remove(o)})})})}({r3Injector:new vM({providers:o,parent:r,debugName:"",runEnvironmentInitializers:!1}).injector,platformInjector:r,rootComponent:e})}catch(r){return Promise.reject(r)}finally{ds(9)}}const Vk=new ve("");let cF=(()=>{class s{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,n){this._zone=n,t.forEach(i=>{i.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,n,i,r){return this._findPluginFor(n).addEventListener(t,n,i,r)}getZone(){return this._zone}_findPluginFor(t){let n=this._eventNameToPlugin.get(t);if(n)return n;if(n=this._plugins.find(r=>r.supports(t)),!n)throw new R(5101,!1);return this._eventNameToPlugin.set(t,n),n}static \u0275fac=function(n){return new(n||s)(Sn(Vk),Sn(Jn))};static \u0275prov=ut({token:s,factory:s.\u0275fac})}return s})();class uF{_doc;constructor(e){this._doc=e}manager}const Hk="ng-app-id";function hF(s){for(const e of s)e.remove()}function dF(s,e){const t=e.createElement("style");return t.textContent=s,t}function Wk(s,e){const t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",s),t}let fF=(()=>{class s{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(t,n,i,r={}){this.doc=t,this.appId=n,this.nonce=i,function bX(s,e,t,n){const i=s.head?.querySelectorAll(`style[${Hk}="${e}"],link[${Hk}="${e}"]`);if(i)for(const r of i)r.removeAttribute(Hk),r instanceof HTMLLinkElement?n.set(r.href.slice(r.href.lastIndexOf("/")+1),{usage:0,elements:[r]}):r.textContent&&t.set(r.textContent,{usage:0,elements:[r]})}(t,n,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,n){for(const i of t)this.addUsage(i,this.inline,dF);n?.forEach(i=>this.addUsage(i,this.external,Wk))}removeStyles(t,n){for(const i of t)this.removeUsage(i,this.inline);n?.forEach(i=>this.removeUsage(i,this.external))}addUsage(t,n,i){const r=n.get(t);r?r.usage++:n.set(t,{usage:1,elements:[...this.hosts].map(o=>this.addElement(o,i(t,this.doc)))})}removeUsage(t,n){const i=n.get(t);i&&(i.usage--,i.usage<=0&&(hF(i.elements),n.delete(t)))}ngOnDestroy(){for(const[,{elements:t}]of[...this.inline,...this.external])hF(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(const[n,{elements:i}]of this.inline)i.push(this.addElement(t,dF(n,this.doc)));for(const[n,{elements:i}]of this.external)i.push(this.addElement(t,Wk(n,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,n){return this.nonce&&n.setAttribute("nonce",this.nonce),t.appendChild(n)}static \u0275fac=function(n){return new(n||s)(Sn(Na),Sn(Ep),Sn(L1,8),Sn(av))};static \u0275prov=ut({token:s,factory:s.\u0275fac})}return s})();const Gk={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Uk=/%COMP%/g,CX=new ve("",{providedIn:"root",factory:()=>!0});function gF(s,e){return e.map(t=>t.replace(Uk,s))}let mF=(()=>{class s{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,n,i,r,o,a,l,c=null,u=null){this.eventManager=t,this.sharedStylesHost=n,this.appId=i,this.removeStylesOnCompDestroy=r,this.doc=o,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=u,this.platformIsServer=!1,this.defaultRenderer=new zk(t,o,l,this.platformIsServer,this.tracingService)}createRenderer(t,n){if(!t||!n)return this.defaultRenderer;const i=this.getOrCreateRenderer(t,n);return i instanceof _F?i.applyToHost(t):i instanceof qk&&i.applyStyles(),i}getOrCreateRenderer(t,n){const i=this.rendererByCompId;let r=i.get(n.id);if(!r){const o=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,h=this.platformIsServer,d=this.tracingService;switch(n.encapsulation){case oc.Emulated:r=new _F(l,c,n,this.appId,u,o,a,h,d);break;case oc.ShadowDom:return new EX(l,c,t,n,o,a,this.nonce,h,d);default:r=new qk(l,c,n,u,o,a,h,d)}i.set(n.id,r)}return r}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(n){return new(n||s)(Sn(cF),Sn(fF),Sn(Ep),Sn(CX),Sn(Na),Sn(av),Sn(Jn),Sn(L1),Sn(ig,8))};static \u0275prov=ut({token:s,factory:s.\u0275fac})}return s})();class zk{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,n,i,r){this.eventManager=e,this.doc=t,this.ngZone=n,this.platformIsServer=i,this.tracingService=r}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(Gk[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(yF(e)?e.content:e).appendChild(t)}insertBefore(e,t,n){e&&(yF(e)?e.content:e).insertBefore(t,n)}removeChild(e,t){t.remove()}selectRootElement(e,t){let n="string"==typeof e?this.doc.querySelector(e):e;if(!n)throw new R(-5104,!1);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,i){if(i){t=i+":"+t;const r=Gk[i];r?e.setAttributeNS(r,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const i=Gk[n];i?e.removeAttributeNS(i,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,i){i&(Qc.DashCase|Qc.Important)?e.style.setProperty(t,n,i&Qc.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&Qc.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){null!=e&&(e[t]=n)}setValue(e,t){e.nodeValue=t}listen(e,t,n,i){if("string"==typeof e&&!(e=jc().getGlobalEventTarget(this.doc,e)))throw new R(5102,!1);let r=this.decoratePreventDefault(n);return this.tracingService?.wrapEventListener&&(r=this.tracingService.wrapEventListener(e,t,r)),this.eventManager.addEventListener(e,t,r,i)}decoratePreventDefault(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&t.preventDefault()}}}function yF(s){return"TEMPLATE"===s.tagName&&void 0!==s.content}class EX extends zk{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,n,i,r,o,a,l,c){super(e,r,o,l,c),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=i.styles;u=gF(i.id,u);for(const d of u){const p=document.createElement("style");a&&p.setAttribute("nonce",a),p.textContent=d,this.shadowRoot.appendChild(p)}const h=i.getExternalStyles?.();if(h)for(const d of h){const p=Wk(d,r);a&&p.setAttribute("nonce",a),this.shadowRoot.appendChild(p)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class qk extends zk{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,t,n,i,r,o,a,l,c){super(e,r,o,a,l),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i;let u=n.styles;this.styles=c?gF(c,u):u,this.styleUrls=n.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&0===$y.size&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}}class _F extends qk{contentAttr;hostAttr;constructor(e,t,n,i,r,o,a,l,c){const u=i+"-"+n.id;super(e,t,n,r,o,a,l,c,u),this.contentAttr=function DX(s){return"_ngcontent-%COMP%".replace(Uk,s)}(u),this.hostAttr=function xX(s){return"_nghost-%COMP%".replace(Uk,s)}(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class $k extends p4{supportsDOMEvents=!0;static makeCurrent(){!function f4(s){DE??=s}(new $k)}onAndCancel(e,t,n,i){return e.addEventListener(t,n,i),()=>{e.removeEventListener(t,n,i)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function IX(){return wg=wg||document.head.querySelector("base"),wg?wg.getAttribute("href"):null}();return null==t?null:function BX(s){return new URL(s,document.baseURI).pathname}(t)}resetBaseElement(){wg=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function S4(s,e){e=encodeURIComponent(e);for(const t of s.split(";")){const n=t.indexOf("="),[i,r]=-1==n?[t,""]:[t.slice(0,n),t.slice(n+1)];if(i.trim()===e)return decodeURIComponent(r)}return null}(document.cookie,e)}}let wg=null,PX=(()=>{class s{build(){return new XMLHttpRequest}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac})}return s})(),AX=(()=>{class s extends uF{constructor(t){super(t)}supports(t){return!0}addEventListener(t,n,i,r){return t.addEventListener(n,i,r),()=>this.removeEventListener(t,n,i,r)}removeEventListener(t,n,i,r){return t.removeEventListener(n,i,r)}static \u0275fac=function(n){return new(n||s)(Sn(Na))};static \u0275prov=ut({token:s,factory:s.\u0275fac})}return s})();const bF=["alt","control","meta","shift"],RX={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},FX={alt:s=>s.altKey,control:s=>s.ctrlKey,meta:s=>s.metaKey,shift:s=>s.shiftKey};let OX=(()=>{class s extends uF{constructor(t){super(t)}supports(t){return null!=s.parseEventName(t)}addEventListener(t,n,i,r){const o=s.parseEventName(n),a=s.eventCallback(o.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>jc().onAndCancel(t,o.domEventName,a,r))}static parseEventName(t){const n=t.toLowerCase().split("."),i=n.shift();if(0===n.length||"keydown"!==i&&"keyup"!==i)return null;const r=s._normalizeKey(n.pop());let o="",a=n.indexOf("code");if(a>-1&&(n.splice(a,1),o="code."),bF.forEach(c=>{const u=n.indexOf(c);u>-1&&(n.splice(u,1),o+=c+".")}),o+=r,0!=n.length||0===r.length)return null;const l={};return l.domEventName=i,l.fullKey=o,l}static matchEventFullKeyCode(t,n){let i=RX[t.key]||t.key,r="";return n.indexOf("code.")>-1&&(i=t.code,r="code."),!(null==i||!i)&&(i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),bF.forEach(o=>{o!==i&&(0,FX[o])(t)&&(r+=o+".")}),r+=i,r===n)}static eventCallback(t,n,i){return r=>{s.matchEventFullKeyCode(r,t)&&i.runGuarded(()=>n(r))}}static _normalizeKey(t){return"esc"===t?"escape":t}static \u0275fac=function(n){return new(n||s)(Sn(Na))};static \u0275prov=ut({token:s,factory:s.\u0275fac})}return s})();function wF(s){return{appProviders:[...zX,...s?.providers??[]],platformProviders:GX}}const GX=[{provide:av,useValue:"browser"},{provide:O1,useValue:function VX(){$k.makeCurrent()},multi:!0},{provide:Na,useFactory:function WX(){return function d8(s){ov=s}(document),document}}],zX=[{provide:wS,useValue:"root"},{provide:Sd,useFactory:function HX(){return new Sd}},{provide:Vk,useClass:AX,multi:!0,deps:[Na]},{provide:Vk,useClass:OX,multi:!0,deps:[Na]},mF,fF,cF,{provide:cT,useExisting:mF},{provide:class v4{},useClass:PX},[]];function Hs(s){return function YX(s){const e=vt(null);try{return s()}finally{vt(e)}}(s)}function Ma(s,e){return function ka(s,e){const t=Object.create($l);t.computation=s,void 0!==e&&(t.equal=e);const n=()=>{if(Ul(t),nl(t),t.value===mr)throw t.error;return t.value};return n[Zn]=t,n}(s,e?.equal)}function la(s,e,t,n){var o,i=arguments.length,r=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(o=s[a])&&(r=(i<3?o(r):i>3?o(e,t,r):o(e,t))||r);return i>3&&r&&Object.defineProperty(e,t,r),r}function Is(s,e,t,n){return new(t||(t=Promise))(function(r,o){function a(u){try{c(n.next(u))}catch(h){o(h)}}function l(u){try{c(n.throw(u))}catch(h){o(h)}}function c(u){u.done?r(u.value):function i(r){return r instanceof t?r:new t(function(o){o(r)})}(u.value).then(a,l)}c((n=n.apply(s,e||[])).next())})}function au(s){return this instanceof au?(this.v=s,this):new au(s)}function BF(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=s[Symbol.asyncIterator];return e?e.call(s):(s=function Zk(s){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&s[e],n=0;if(t)return t.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&n>=s.length&&(s=void 0),{value:s&&s[n++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(s),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=s[r]&&function(o){return new Promise(function(a,l){!function i(r,o,a,l){Promise.resolve(l).then(function(c){r({value:c,done:a})},o)}(a,l,(o=s[r](o)).done,o.value)})}}}Error,Error,"function"==typeof SuppressedError&&SuppressedError;const MF=s=>s&&"number"==typeof s.length&&"function"!=typeof s;function PF(s){return As(s?.then)}function AF(s){return As(s[Ai])}function RF(s){return Symbol.asyncIterator&&As(s?.[Symbol.asyncIterator])}function FF(s){return new TypeError(`You provided ${null!==s&&"object"==typeof s?"an invalid object":`'${s}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const OF=function OJ(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function LF(s){return As(s?.[OF])}function VF(s){return function IF(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,n=t.apply(s,e||[]),r=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function o(p){return function(g){return Promise.resolve(g).then(p,h)}}),i[Symbol.asyncIterator]=function(){return this},i;function a(p,g){n[p]&&(i[p]=function(m){return new Promise(function(_,y){r.push([p,m,_,y])>1||l(p,m)})},g&&(i[p]=g(i[p])))}function l(p,g){try{!function c(p){p.value instanceof au?Promise.resolve(p.value.v).then(u,h):d(r[0][2],p)}(n[p](g))}catch(m){d(r[0][3],m)}}function u(p){l("next",p)}function h(p){l("throw",p)}function d(p,g){p(g),r.shift(),r.length&&l(r[0][0],r[0][1])}}(this,arguments,function*(){const t=s.getReader();try{for(;;){const{value:n,done:i}=yield au(t.read());if(i)return yield au(void 0);yield yield au(n)}}finally{t.releaseLock()}})}function HF(s){return As(s?.getReader)}function Pa(s){if(s instanceof Lt)return s;if(null!=s){if(AF(s))return function LJ(s){return new Lt(e=>{const t=s[Ai]();if(As(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(s);if(MF(s))return function VJ(s){return new Lt(e=>{for(let t=0;t<s.length&&!e.closed;t++)e.next(s[t]);e.complete()})}(s);if(PF(s))return function HJ(s){return new Lt(e=>{s.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,jm)})}(s);if(RF(s))return WF(s);if(LF(s))return function WJ(s){return new Lt(e=>{for(const t of s)if(e.next(t),e.closed)return;e.complete()})}(s);if(HF(s))return function GJ(s){return WF(VF(s))}(s)}throw FF(s)}function WF(s){return new Lt(e=>{(function UJ(s,e){var t,n,i,r;return Is(this,void 0,void 0,function*(){try{for(t=BF(s);!(n=yield t.next()).done;)if(e.next(n.value),e.closed)return}catch(o){i={error:o}}finally{try{n&&!n.done&&(r=t.return)&&(yield r.call(t))}finally{if(i)throw i.error}}e.complete()})})(s,e).catch(t=>e.error(t))})}function dc(s,e,t,n=0,i=!1){const r=e.schedule(function(){t(),i?s.add(this.schedule(null,n)):this.unsubscribe()},n);if(s.add(r),!i)return r}function GF(s,e=0){return Oi((t,n)=>{t.subscribe(pi(n,i=>dc(n,s,()=>n.next(i),e),()=>dc(n,s,()=>n.complete(),e),i=>dc(n,s,()=>n.error(i),e)))})}function UF(s,e=0){return Oi((t,n)=>{n.add(s.schedule(()=>t.subscribe(n),e))})}function zF(s,e){if(!s)throw new Error("Iterable cannot be null");return new Lt(t=>{dc(t,e,()=>{const n=s[Symbol.asyncIterator]();dc(t,e,()=>{n.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function Br(s,e){return e?function XJ(s,e){if(null!=s){if(AF(s))return function zJ(s,e){return Pa(s).pipe(UF(e),GF(e))}(s,e);if(MF(s))return function $J(s,e){return new Lt(t=>{let n=0;return e.schedule(function(){n===s.length?t.complete():(t.next(s[n++]),t.closed||this.schedule())})})}(s,e);if(PF(s))return function qJ(s,e){return Pa(s).pipe(UF(e),GF(e))}(s,e);if(RF(s))return zF(s,e);if(LF(s))return function jJ(s,e){return new Lt(t=>{let n;return dc(t,e,()=>{n=s[OF](),dc(t,e,()=>{let i,r;try{({value:i,done:r}=n.next())}catch(o){return void t.error(o)}r?t.complete():t.next(i)},0,!0)}),()=>As(n?.return)&&n.return()})}(s,e);if(HF(s))return function YJ(s,e){return zF(VF(s),e)}(s,e)}throw FF(s)}(s,e):Pa(s)}function qF(s){return s&&As(s.schedule)}function Kk(s){return s[s.length-1]}function $F(s){return As(Kk(s))?s.pop():void 0}function eb(s){return qF(Kk(s))?s.pop():void 0}function pn(...s){return Br(s,eb(s))}const tb=od(s=>function(){s(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:JJ}=Array,{getPrototypeOf:ZJ,prototype:QJ,keys:KJ}=Object;function jF(s){if(1===s.length){const e=s[0];if(JJ(e))return{args:e,keys:null};if(function eZ(s){return s&&"object"==typeof s&&ZJ(s)===QJ}(e)){const t=KJ(e);return{args:t.map(n=>e[n]),keys:t}}}return{args:s,keys:null}}const{isArray:tZ}=Array;function YF(s){return Kn(e=>function nZ(s,e){return tZ(e)?s(...e):s(e)}(s,e))}function XF(s,e){return s.reduce((t,n,i)=>(t[n]=e[i],t),{})}function JF(...s){const e=eb(s),t=$F(s),{args:n,keys:i}=jF(s);if(0===n.length)return Br([],e);const r=new Lt(function sZ(s,e,t=ys){return n=>{ZF(e,()=>{const{length:i}=s,r=new Array(i);let o=i,a=i;for(let l=0;l<i;l++)ZF(e,()=>{const c=Br(s[l],e);let u=!1;c.subscribe(pi(n,h=>{r[l]=h,u||(u=!0,a--),a||n.next(t(r.slice()))},()=>{--o||n.complete()}))},n)},n)}}(n,e,i?o=>XF(i,o):ys));return t?r.pipe(YF(t)):r}function ZF(s,e,t){s?dc(t,s,e):e()}function Mr(s,e,t=1/0){return As(e)?Mr((n,i)=>Kn((r,o)=>e(n,r,i,o))(Pa(s(n,i))),t):("number"==typeof e&&(t=e),Oi((n,i)=>function iZ(s,e,t,n,i,r,o,a){const l=[];let c=0,u=0,h=!1;const d=()=>{h&&!l.length&&!c&&e.complete()},p=m=>c<n?g(m):l.push(m),g=m=>{r&&e.next(m),c++;let _=!1;Pa(t(m,u++)).subscribe(pi(e,y=>{i?.(y),r?p(y):e.next(y)},()=>{_=!0},void 0,()=>{if(_)try{for(c--;l.length&&c<n;){const y=l.shift();o?dc(e,o,()=>g(y)):g(y)}d()}catch(y){e.error(y)}}))};return s.subscribe(pi(e,p,()=>{h=!0,d()})),()=>{a?.()}}(n,i,s,t)))}function nb(...s){return function rZ(){return function eC(s=1/0){return Mr(ys,s)}(1)}()(Br(s,eb(s)))}function tC(s){return new Lt(e=>{Pa(s()).subscribe(e)})}function sb(s,e){const t=As(s)?s:()=>s,n=i=>i.error(t());return new Lt(e?i=>e.schedule(n,0,i):n)}const Aa=new Lt(s=>s.complete());function nC(){return Oi((s,e)=>{let t=null;s._refCount++;const n=pi(e,void 0,void 0,void 0,()=>{if(!s||s._refCount<=0||0<--s._refCount)return void(t=null);const i=s._connection,r=t;t=null,i&&(!r||i===r)&&i.unsubscribe(),e.unsubscribe()});s.subscribe(n),n.closed||(t=s.connect())})}class QF extends Lt{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,UE(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new rr;const t=this.getSubject();e.add(this.source.subscribe(pi(t,void 0,()=>{this._teardown(),t.complete()},n=>{this._teardown(),t.error(n)},()=>this._teardown()))),e.closed&&(this._connection=null,e=rr.EMPTY)}return e}refCount(){return nC()(this)}}function ca(s,e){return Oi((t,n)=>{let i=null,r=0,o=!1;const a=()=>o&&!i&&n.complete();t.subscribe(pi(n,l=>{i?.unsubscribe();let c=0;const u=r++;Pa(s(l,u)).subscribe(i=pi(n,h=>n.next(e?e(l,h,u,c++):h),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function lu(s){return s<=0?()=>Aa:Oi((e,t)=>{let n=0;e.subscribe(pi(t,i=>{++n<=s&&(t.next(i),s<=n&&t.complete())}))})}function cu(s,e){return Oi((t,n)=>{let i=0;t.subscribe(pi(n,r=>s.call(e,r,i++)&&n.next(r)))})}function ib(s){return Oi((e,t)=>{let n=!1;e.subscribe(pi(t,i=>{n=!0,t.next(i)},()=>{n||t.next(s),t.complete()}))})}function KF(s=lZ){return Oi((e,t)=>{let n=!1;e.subscribe(pi(t,i=>{n=!0,t.next(i)},()=>n?t.complete():t.error(s())))})}function lZ(){return new tb}function Sh(s,e){const t=arguments.length>=2;return n=>n.pipe(s?cu((i,r)=>s(i,r,n)):ys,lu(1),t?ib(e):KF(()=>new tb))}function rb(s,e){return As(e)?Mr(s,e,1):Mr(s,1)}function Pr(s,e,t){const n=As(s)||e||t?{next:s,error:e,complete:t}:s;return n?Oi((i,r)=>{var o;null===(o=n.subscribe)||void 0===o||o.call(n);let a=!0;i.subscribe(pi(r,l=>{var c;null===(c=n.next)||void 0===c||c.call(n,l),r.next(l)},()=>{var l;a=!1,null===(l=n.complete)||void 0===l||l.call(n),r.complete()},l=>{var c;a=!1,null===(c=n.error)||void 0===c||c.call(n,l),r.error(l)},()=>{var l,c;a&&(null===(l=n.unsubscribe)||void 0===l||l.call(n)),null===(c=n.finalize)||void 0===c||c.call(n)}))}):ys}function uf(s){return Oi((e,t)=>{let r,n=null,i=!1;n=e.subscribe(pi(t,void 0,void 0,o=>{r=Pa(s(o,uf(s)(e))),n?(n.unsubscribe(),n=null,r.subscribe(t)):i=!0})),i&&(n.unsubscribe(),n=null,r.subscribe(t))})}function sC(s){return s<=0?()=>Aa:Oi((e,t)=>{let n=[];e.subscribe(pi(t,i=>{n.push(i),s<n.length&&n.shift()},()=>{for(const i of n)t.next(i);t.complete()},void 0,()=>{n=null}))})}function iC(s){return Oi((e,t)=>{try{e.subscribe(t)}finally{t.add(s)}})}function eO(s){return Oi((e,t)=>{Pa(s).subscribe(pi(t,()=>t.complete(),Uu)),!t.closed&&e.subscribe(t)})}let dZ=(()=>{class s{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(n){return new(n||s)(Sn(Na))};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const vn="primary",vg=Symbol("RouteTitle");class mZ{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function hf(s){return new mZ(s)}function yZ(s,e,t){const n=t.path.split("/");if(n.length>s.length||"full"===t.pathMatch&&(e.hasChildren()||n.length<s.length))return null;const i={};for(let r=0;r<n.length;r++){const o=n[r],a=s[r];if(":"===o[0])i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:s.slice(0,n.length),posParams:i}}function yl(s,e){const t=s?rC(s):void 0,n=e?rC(e):void 0;if(!t||!n||t.length!=n.length)return!1;let i;for(let r=0;r<t.length;r++)if(i=t[r],!sO(s[i],e[i]))return!1;return!0}function rC(s){return[...Object.keys(s),...Object.getOwnPropertySymbols(s)]}function sO(s,e){if(Array.isArray(s)&&Array.isArray(e)){if(s.length!==e.length)return!1;const t=[...s].sort(),n=[...e].sort();return t.every((i,r)=>n[r]===i)}return s===e}function iO(s){return s.length>0?s[s.length-1]:null}function fc(s){return function hJ(s){return!!s&&(s instanceof Lt||As(s.lift)&&As(s.subscribe))}(s)?s:ag(s)?Br(Promise.resolve(s)):pn(s)}const bZ={exact:function aO(s,e,t){if(!Th(s.segments,e.segments)||!ob(s.segments,e.segments,t)||s.numberOfChildren!==e.numberOfChildren)return!1;for(const n in e.children)if(!s.children[n]||!aO(s.children[n],e.children[n],t))return!1;return!0},subset:lO},rO={exact:function wZ(s,e){return yl(s,e)},subset:function SZ(s,e){return Object.keys(e).length<=Object.keys(s).length&&Object.keys(e).every(t=>sO(s[t],e[t]))},ignored:()=>!0};function oO(s,e,t){return bZ[t.paths](s.root,e.root,t.matrixParams)&&rO[t.queryParams](s.queryParams,e.queryParams)&&!("exact"===t.fragment&&s.fragment!==e.fragment)}function lO(s,e,t){return cO(s,e,e.segments,t)}function cO(s,e,t,n){if(s.segments.length>t.length){const i=s.segments.slice(0,t.length);return!(!Th(i,t)||e.hasChildren()||!ob(i,t,n))}if(s.segments.length===t.length){if(!Th(s.segments,t)||!ob(s.segments,t,n))return!1;for(const i in e.children)if(!s.children[i]||!lO(s.children[i],e.children[i],n))return!1;return!0}{const i=t.slice(0,s.segments.length),r=t.slice(s.segments.length);return!!(Th(s.segments,i)&&ob(s.segments,i,n)&&s.children[vn])&&cO(s.children[vn],e,r,n)}}function ob(s,e,t){return e.every((n,i)=>rO[t](s[i].parameters,n.parameters))}class vh{root;queryParams;fragment;_queryParamMap;constructor(e=new Bs([],{}),t={},n=null){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap??=hf(this.queryParams),this._queryParamMap}toString(){return kZ.serialize(this)}}class Bs{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return cb(this)}}class Tg{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=hf(this.parameters),this._parameterMap}toString(){return dO(this)}}function Th(s,e){return s.length===e.length&&s.every((t,n)=>t.path===e[n].path)}let ab=(()=>{class s{static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:()=>new lb,providedIn:"root"})}return s})();class lb{parse(e){const t=new RZ(e);return new vh(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${kg(e.root,!0)}`,n=function xZ(s){const e=Object.entries(s).map(([t,n])=>Array.isArray(n)?n.map(i=>`${ub(t)}=${ub(i)}`).join("&"):`${ub(t)}=${ub(n)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${n}${"string"==typeof e.fragment?`#${function CZ(s){return encodeURI(s)}(e.fragment)}`:""}`}}const kZ=new lb;function cb(s){return s.segments.map(e=>dO(e)).join("/")}function kg(s,e){if(!s.hasChildren())return cb(s);if(e){const t=s.children[vn]?kg(s.children[vn],!1):"",n=[];return Object.entries(s.children).forEach(([i,r])=>{i!==vn&&n.push(`${i}:${kg(r,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}{const t=function TZ(s,e){let t=[];return Object.entries(s.children).forEach(([n,i])=>{n===vn&&(t=t.concat(e(i,n)))}),Object.entries(s.children).forEach(([n,i])=>{n!==vn&&(t=t.concat(e(i,n)))}),t}(s,(n,i)=>i===vn?[kg(s.children[vn],!1)]:[`${i}:${kg(n,!1)}`]);return 1===Object.keys(s.children).length&&null!=s.children[vn]?`${cb(s)}/${t[0]}`:`${cb(s)}/(${t.join("//")})`}}function uO(s){return encodeURIComponent(s).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ub(s){return uO(s).replace(/%3B/gi,";")}function oC(s){return uO(s).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function hb(s){return decodeURIComponent(s)}function hO(s){return hb(s.replace(/\+/g,"%20"))}function dO(s){return`${oC(s.path)}${function DZ(s){return Object.entries(s).map(([e,t])=>`;${oC(e)}=${oC(t)}`).join("")}(s.parameters)}`}const NZ=/^[^\/()?;#]+/;function aC(s){const e=s.match(NZ);return e?e[0]:""}const EZ=/^[^\/()?;=#]+/,BZ=/^[^=?&#]+/,PZ=/^[^&#]+/;class RZ{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Bs([],{}):new Bs([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[vn]=new Bs(e,t)),n}parseSegment(){const e=aC(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new R(4009,!1);return this.capture(e),new Tg(hb(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=function IZ(s){const e=s.match(EZ);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const i=aC(this.remaining);i&&(n=i,this.capture(n))}e[hb(t)]=hb(n)}parseQueryParam(e){const t=function MZ(s){const e=s.match(BZ);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const o=function AZ(s){const e=s.match(PZ);return e?e[0]:""}(this.remaining);o&&(n=o,this.capture(n))}const i=hO(t),r=hO(n);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(r)}else e[i]=r}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=aC(this.remaining),i=this.remaining[n.length];if("/"!==i&&")"!==i&&";"!==i)throw new R(4010,!1);let r;n.indexOf(":")>-1?(r=n.slice(0,n.indexOf(":")),this.capture(r),this.capture(":")):e&&(r=vn);const o=this.parseChildren();t[r]=1===Object.keys(o).length?o[vn]:new Bs([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new R(4011,!1)}}function fO(s){return s.segments.length>0?new Bs([],{[vn]:s}):s}function pO(s){const e={};for(const[n,i]of Object.entries(s.children)){const r=pO(i);if(n===vn&&0===r.segments.length&&r.hasChildren())for(const[o,a]of Object.entries(r.children))e[o]=a;else(r.segments.length>0||r.hasChildren())&&(e[n]=r)}return function FZ(s){if(1===s.numberOfChildren&&s.children[vn]){const e=s.children[vn];return new Bs(s.segments.concat(e.segments),e.children)}return s}(new Bs(s.segments,e))}function kh(s){return s instanceof vh}function gO(s){let e;const i=fO(function t(r){const o={};for(const l of r.children){const c=t(l);o[l.outlet]=c}const a=new Bs(r.url,o);return r===s&&(e=a),a}(s.root));return e??i}function mO(s,e,t,n){let i=s;for(;i.parent;)i=i.parent;if(0===e.length)return lC(i,i,i,t,n);const r=function LZ(s){if("string"==typeof s[0]&&1===s.length&&"/"===s[0])return new _O(!0,0,s);let e=0,t=!1;const n=s.reduce((i,r,o)=>{if("object"==typeof r&&null!=r){if(r.outlets){const a={};return Object.entries(r.outlets).forEach(([l,c])=>{a[l]="string"==typeof c?c.split("/"):c}),[...i,{outlets:a}]}if(r.segmentPath)return[...i,r.segmentPath]}return"string"!=typeof r?[...i,r]:0===o?(r.split("/").forEach((a,l)=>{0==l&&"."===a||(0==l&&""===a?t=!0:".."===a?e++:""!=a&&i.push(a))}),i):[...i,r]},[]);return new _O(t,e,n)}(e);if(r.toRoot())return lC(i,i,new Bs([],{}),t,n);const o=function VZ(s,e,t){if(s.isAbsolute)return new fb(e,!0,0);if(!t)return new fb(e,!1,NaN);if(null===t.parent)return new fb(t,!0,0);const n=db(s.commands[0])?0:1;return function HZ(s,e,t){let n=s,i=e,r=t;for(;r>i;){if(r-=i,n=n.parent,!n)throw new R(4005,!1);i=n.segments.length}return new fb(n,!1,i-r)}(t,t.segments.length-1+n,s.numberOfDoubleDots)}(r,i,s),a=o.processChildren?Dg(o.segmentGroup,o.index,r.commands):bO(o.segmentGroup,o.index,r.commands);return lC(i,o.segmentGroup,a,t,n)}function db(s){return"object"==typeof s&&null!=s&&!s.outlets&&!s.segmentPath}function Cg(s){return"object"==typeof s&&null!=s&&s.outlets}function lC(s,e,t,n,i){let o,r={};n&&Object.entries(n).forEach(([l,c])=>{r[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`}),o=s===e?t:yO(s,e,t);const a=fO(pO(o));return new vh(a,r,i)}function yO(s,e,t){const n={};return Object.entries(s.children).forEach(([i,r])=>{n[i]=r===e?t:yO(r,e,t)}),new Bs(s.segments,n)}class _O{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&db(n[0]))throw new R(4003,!1);const i=n.find(Cg);if(i&&i!==iO(n))throw new R(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class fb{segmentGroup;processChildren;index;constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function bO(s,e,t){if(s??=new Bs([],{}),0===s.segments.length&&s.hasChildren())return Dg(s,e,t);const n=function GZ(s,e,t){let n=0,i=e;const r={match:!1,pathIndex:0,commandIndex:0};for(;i<s.segments.length;){if(n>=t.length)return r;const o=s.segments[i],a=t[n];if(Cg(a))break;const l=`${a}`,c=n<t.length-1?t[n+1]:null;if(i>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!SO(l,c,o))return r;n+=2}else{if(!SO(l,{},o))return r;n++}i++}return{match:!0,pathIndex:i,commandIndex:n}}(s,e,t),i=t.slice(n.commandIndex);if(n.match&&n.pathIndex<s.segments.length){const r=new Bs(s.segments.slice(0,n.pathIndex),{});return r.children[vn]=new Bs(s.segments.slice(n.pathIndex),s.children),Dg(r,0,i)}return n.match&&0===i.length?new Bs(s.segments,{}):n.match&&!s.hasChildren()?cC(s,e,t):n.match?Dg(s,0,i):cC(s,e,t)}function Dg(s,e,t){if(0===t.length)return new Bs(s.segments,{});{const n=function WZ(s){return Cg(s[0])?s[0].outlets:{[vn]:s}}(t),i={};if(Object.keys(n).some(r=>r!==vn)&&s.children[vn]&&1===s.numberOfChildren&&0===s.children[vn].segments.length){const r=Dg(s.children[vn],e,t);return new Bs(s.segments,r.children)}return Object.entries(n).forEach(([r,o])=>{"string"==typeof o&&(o=[o]),null!==o&&(i[r]=bO(s.children[r],e,o))}),Object.entries(s.children).forEach(([r,o])=>{void 0===n[r]&&(i[r]=o)}),new Bs(s.segments,i)}}function cC(s,e,t){const n=s.segments.slice(0,e);let i=0;for(;i<t.length;){const r=t[i];if(Cg(r)){const l=UZ(r.outlets);return new Bs(n,l)}if(0===i&&db(t[0])){n.push(new Tg(s.segments[e].path,wO(t[0]))),i++;continue}const o=Cg(r)?r.outlets[vn]:`${r}`,a=i<t.length-1?t[i+1]:null;o&&a&&db(a)?(n.push(new Tg(o,wO(a))),i+=2):(n.push(new Tg(o,{})),i++)}return new Bs(n,{})}function UZ(s){const e={};return Object.entries(s).forEach(([t,n])=>{"string"==typeof n&&(n=[n]),null!==n&&(e[t]=cC(new Bs([],{}),0,n))}),e}function wO(s){const e={};return Object.entries(s).forEach(([t,n])=>e[t]=`${n}`),e}function SO(s,e,t){return s==t.path&&yl(e,t.parameters)}const pb="imperative";var Wn=function(s){return s[s.NavigationStart=0]="NavigationStart",s[s.NavigationEnd=1]="NavigationEnd",s[s.NavigationCancel=2]="NavigationCancel",s[s.NavigationError=3]="NavigationError",s[s.RoutesRecognized=4]="RoutesRecognized",s[s.ResolveStart=5]="ResolveStart",s[s.ResolveEnd=6]="ResolveEnd",s[s.GuardsCheckStart=7]="GuardsCheckStart",s[s.GuardsCheckEnd=8]="GuardsCheckEnd",s[s.RouteConfigLoadStart=9]="RouteConfigLoadStart",s[s.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",s[s.ChildActivationStart=11]="ChildActivationStart",s[s.ChildActivationEnd=12]="ChildActivationEnd",s[s.ActivationStart=13]="ActivationStart",s[s.ActivationEnd=14]="ActivationEnd",s[s.Scroll=15]="Scroll",s[s.NavigationSkipped=16]="NavigationSkipped",s}(Wn||{});class _l{id;url;constructor(e,t){this.id=e,this.url=t}}class uC extends _l{type=Wn.NavigationStart;navigationTrigger;restoredState;constructor(e,t,n="imperative",i=null){super(e,t),this.navigationTrigger=n,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Ch extends _l{urlAfterRedirects;type=Wn.NavigationEnd;constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var To=function(s){return s[s.Redirect=0]="Redirect",s[s.SupersededByNewNavigation=1]="SupersededByNewNavigation",s[s.NoDataFromResolver=2]="NoDataFromResolver",s[s.GuardRejected=3]="GuardRejected",s[s.Aborted=4]="Aborted",s}(To||{}),hC=function(s){return s[s.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",s[s.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",s}(hC||{});class Dh extends _l{reason;code;type=Wn.NavigationCancel;constructor(e,t,n,i){super(e,t),this.reason=n,this.code=i}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class xg extends _l{reason;code;type=Wn.NavigationSkipped;constructor(e,t,n,i){super(e,t),this.reason=n,this.code=i}}class dC extends _l{error;target;type=Wn.NavigationError;constructor(e,t,n,i){super(e,t),this.error=n,this.target=i}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class vO extends _l{urlAfterRedirects;state;type=Wn.RoutesRecognized;constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class zZ extends _l{urlAfterRedirects;state;type=Wn.GuardsCheckStart;constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qZ extends _l{urlAfterRedirects;state;shouldActivate;type=Wn.GuardsCheckEnd;constructor(e,t,n,i,r){super(e,t),this.urlAfterRedirects=n,this.state=i,this.shouldActivate=r}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class $Z extends _l{urlAfterRedirects;state;type=Wn.ResolveStart;constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jZ extends _l{urlAfterRedirects;state;type=Wn.ResolveEnd;constructor(e,t,n,i){super(e,t),this.urlAfterRedirects=n,this.state=i}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class YZ{route;type=Wn.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class XZ{route;type=Wn.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class JZ{snapshot;type=Wn.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ZZ{snapshot;type=Wn.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class QZ{snapshot;type=Wn.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class KZ{snapshot;type=Wn.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class fC{}class gb{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}}function Ra(s){return s.outlet||vn}function df(s){if(!s)return null;if(s.routeConfig?._injector)return s.routeConfig._injector;for(let e=s.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class oQ{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return df(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new Ng(this.rootInjector)}}let Ng=(()=>{class s{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,n){const i=this.getOrCreateContext(t);i.outlet=n,this.contexts.set(t,i)}onChildOutletDestroyed(t){const n=this.getContext(t);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let n=this.getContext(t);return n||(n=new oQ(this.rootInjector),this.contexts.set(t,n)),n}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(n){return new(n||s)(Sn($r))};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();class TO{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=pC(e,this._root);return t?t.children.map(n=>n.value):[]}firstChild(e){const t=pC(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=gC(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return gC(e,this._root).map(t=>t.value)}}function pC(s,e){if(s===e.value)return e;for(const t of e.children){const n=pC(s,t);if(n)return n}return null}function gC(s,e){if(s===e.value)return[e];for(const t of e.children){const n=gC(s,t);if(n.length)return n.unshift(e),n}return[]}class Fa{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function ff(s){const e={};return s&&s.children.forEach(t=>e[t.value.outlet]=t),e}class kO extends TO{snapshot;constructor(e,t){super(e),this.snapshot=t,mC(this,e)}toString(){return this.snapshot.toString()}}function CO(s){const e=function aQ(s){const r=new yb([],{},{},"",{},vn,s,null,{});return new DO("",new Fa(r,[]))}(s),t=new lt([new Tg("",{})]),n=new lt({}),i=new lt({}),r=new lt({}),o=new lt(""),a=new pf(t,n,r,o,i,vn,s,e.root);return a.snapshot=e.root,new kO(new Fa(a,[]),e)}class pf{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,n,i,r,o,a,l){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=n,this.fragmentSubject=i,this.dataSubject=r,this.outlet=o,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(Kn(c=>c[vg]))??pn(void 0),this.url=e,this.params=t,this.queryParams=n,this.fragment=i,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Kn(e=>hf(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Kn(e=>hf(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function mb(s,e,t="emptyOnly"){let n;const{routeConfig:i}=s;return n=null===e||"always"!==t&&""!==i?.path&&(e.component||e.routeConfig?.loadComponent)?{params:{...s.params},data:{...s.data},resolve:{...s.data,...s._resolvedData??{}}}:{params:{...e.params,...s.params},data:{...e.data,...s.data},resolve:{...s.data,...e.data,...i?.data,...s._resolvedData}},i&&NO(i)&&(n.resolve[vg]=i.title),n}class yb{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[vg]}constructor(e,t,n,i,r,o,a,l,c){this.url=e,this.params=t,this.queryParams=n,this.fragment=i,this.data=r,this.outlet=o,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=hf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=hf(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class DO extends TO{url;constructor(e,t){super(t),this.url=e,mC(this,t)}toString(){return xO(this._root)}}function mC(s,e){e.value._routerState=s,e.children.forEach(t=>mC(s,t))}function xO(s){const e=s.children.length>0?` { ${s.children.map(xO).join(", ")} } `:"";return`${s.value}${e}`}function yC(s){if(s.snapshot){const e=s.snapshot,t=s._futureSnapshot;s.snapshot=t,yl(e.queryParams,t.queryParams)||s.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&s.fragmentSubject.next(t.fragment),yl(e.params,t.params)||s.paramsSubject.next(t.params),function _Z(s,e){if(s.length!==e.length)return!1;for(let t=0;t<s.length;++t)if(!yl(s[t],e[t]))return!1;return!0}(e.url,t.url)||s.urlSubject.next(t.url),yl(e.data,t.data)||s.dataSubject.next(t.data)}else s.snapshot=s._futureSnapshot,s.dataSubject.next(s._futureSnapshot.data)}function _C(s,e){const t=yl(s.params,e.params)&&function vZ(s,e){return Th(s,e)&&s.every((t,n)=>yl(t.parameters,e[n].parameters))}(s.url,e.url);return t&&!(!s.parent!=!e.parent)&&(!s.parent||_C(s.parent,e.parent))}function NO(s){return"string"==typeof s.title||null===s.title}const lQ=new ve("");let bC=(()=>{class s{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=vn;activateEvents=new Li;deactivateEvents=new Li;attachEvents=new Li;detachEvents=new Li;routerOutletData=CY(void 0);parentContexts=le(Ng);location=le(Ba);changeDetector=le(lf);inputBinder=le(wC,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){const{firstChange:n,previousValue:i}=t.name;if(n)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new R(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new R(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new R(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,n){this.activated=t,this._activatedRoute=n,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,n){if(this.isActivated)throw new R(4013,!1);this._activatedRoute=t;const i=this.location,o=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new cQ(t,a,i.injector,this.routerOutletData);this.activated=i.createComponent(o,{index:i.length,injector:l,environmentInjector:n}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(n){return new(n||s)};static \u0275dir=Qt({type:s,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[ra]})}return s})();class cQ{route;childContexts;parent;outletData;constructor(e,t,n,i){this.route=e,this.childContexts=t,this.parent=n,this.outletData=i}get(e,t){return e===pf?this.route:e===Ng?this.childContexts:e===lQ?this.outletData:this.parent.get(e,t)}}const wC=new ve("");let EO=(()=>{class s{static \u0275fac=function(n){return new(n||s)};static \u0275cmp=eg({type:s,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(n,i){1&n&&Xi(0,"router-outlet")},dependencies:[bC],encapsulation:2})}return s})();function SC(s){const e=s.children&&s.children.map(SC),t=e?{...s,children:e}:{...s};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==vn&&(t.component=EO),t}function Eg(s,e,t){if(t&&s.shouldReuseRoute(e.value,t.value.snapshot)){const n=t.value;n._futureSnapshot=e.value;const i=function hQ(s,e,t){return e.children.map(n=>{for(const i of t.children)if(s.shouldReuseRoute(n.value,i.value.snapshot))return Eg(s,n,i);return Eg(s,n)})}(s,e,t);return new Fa(n,i)}{if(s.shouldAttach(e.value)){const r=s.retrieve(e.value);if(null!==r){const o=r.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>Eg(s,a)),o}}const n=function dQ(s){return new pf(new lt(s.url),new lt(s.params),new lt(s.queryParams),new lt(s.fragment),new lt(s.data),s.outlet,s.component,s)}(e.value),i=e.children.map(r=>Eg(s,r));return new Fa(n,i)}}class vC{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}}const IO="ngNavigationCancelingError";function _b(s,e){const{redirectTo:t,navigationBehaviorOptions:n}=kh(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=BO(!1,To.Redirect);return i.url=t,i.navigationBehaviorOptions=n,i}function BO(s,e){const t=new Error(`NavigationCancelingError: ${s||""}`);return t[IO]=!0,t.cancellationCode=e,t}function MO(s){return!!s&&s[IO]}class gQ{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,n,i,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=i,this.inputBindingEnabled=r}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),yC(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const i=ff(t);e.children.forEach(r=>{const o=r.value.outlet;this.deactivateRoutes(r,i[o],n),delete i[o]}),Object.values(i).forEach(r=>{this.deactivateRouteAndItsChildren(r,n)})}deactivateRoutes(e,t,n){const i=e.value,r=t?t.value:null;if(i===r)if(i.component){const o=n.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,n);else r&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet),i=n&&e.value.component?n.children:t,r=ff(e);for(const o of Object.values(r))this.deactivateRouteAndItsChildren(o,i);if(n&&n.outlet){const o=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet),i=n&&e.value.component?n.children:t,r=ff(e);for(const o of Object.values(r))this.deactivateRouteAndItsChildren(o,i);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(e,t,n){const i=ff(t);e.children.forEach(r=>{this.activateRoutes(r,i[r.value.outlet],n),this.forwardEvent(new KZ(r.value.snapshot))}),e.children.length&&this.forwardEvent(new ZZ(e.value.snapshot))}activateRoutes(e,t,n){const i=e.value,r=t?t.value:null;if(yC(i),i===r)if(i.component){const o=n.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,n);else if(i.component){const o=n.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),yC(a.route.value),this.activateChildRoutes(e,null,o.children)}else o.attachRef=null,o.route=i,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}else this.activateChildRoutes(e,null,n)}}class PO{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class bb{component;route;constructor(e,t){this.component=e,this.route=t}}function mQ(s,e,t){const n=s._root;return Ig(n,e?e._root:null,t,[n.value])}function gf(s,e){const t=Symbol(),n=e.get(s,t);return n===t?"function"!=typeof s||function ea(s){return null!==xr(s)}(s)?e.get(s):s:n}function Ig(s,e,t,n,i={canDeactivateChecks:[],canActivateChecks:[]}){const r=ff(e);return s.children.forEach(o=>{(function _Q(s,e,t,n,i={canDeactivateChecks:[],canActivateChecks:[]}){const r=s.value,o=e?e.value:null,a=t?t.getContext(s.value.outlet):null;if(o&&r.routeConfig===o.routeConfig){const l=function bQ(s,e,t){if("function"==typeof t)return t(s,e);switch(t){case"pathParamsChange":return!Th(s.url,e.url);case"pathParamsOrQueryParamsChange":return!Th(s.url,e.url)||!yl(s.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!_C(s,e)||!yl(s.queryParams,e.queryParams);default:return!_C(s,e)}}(o,r,r.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new PO(n)):(r.data=o.data,r._resolvedData=o._resolvedData),Ig(s,e,r.component?a?a.children:null:t,n,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new bb(a.outlet.component,o))}else o&&Bg(e,a,i),i.canActivateChecks.push(new PO(n)),Ig(s,null,r.component?a?a.children:null:t,n,i)})(o,r[o.value.outlet],t,n.concat([o.value]),i),delete r[o.value.outlet]}),Object.entries(r).forEach(([o,a])=>Bg(a,t.getContext(o),i)),i}function Bg(s,e,t){const n=ff(s),i=s.value;Object.entries(n).forEach(([r,o])=>{Bg(o,i.component?e?e.children.getContext(r):null:e,t)}),t.canDeactivateChecks.push(new bb(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}function Mg(s){return"function"==typeof s}function AO(s){return s instanceof tb||"EmptyError"===s?.name}const wb=Symbol("INITIAL_VALUE");function mf(){return ca(s=>JF(s.map(e=>e.pipe(lu(1),function aZ(...s){const e=eb(s);return Oi((t,n)=>{(e?nb(s,t,e):nb(s,t)).subscribe(n)})}(wb)))).pipe(Kn(e=>{for(const t of e)if(!0!==t){if(t===wb)return wb;if(!1===t||DQ(t))return t}return!0}),cu(e=>e!==wb),lu(1)))}function DQ(s){return kh(s)||s instanceof vC}function RO(s){return function Mt(...s){return Ue(s)}(Pr(e=>{if("boolean"!=typeof e)throw _b(0,e)}),Kn(e=>!0===e))}class TC{segmentGroup;constructor(e){this.segmentGroup=e||null}}class kC extends Error{urlTree;constructor(e){super(),this.urlTree=e}}function yf(s){return sb(new TC(s))}function OQ(s){return sb(new R(4e3,!1))}class VQ{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let n=[],i=t.root;for(;;){if(n=n.concat(i.segments),0===i.numberOfChildren)return pn(n);if(i.numberOfChildren>1||!i.children[vn])return OQ();i=i.children[vn]}}applyRedirectCommands(e,t,n,i,r){return function HQ(s,e,t){if("string"==typeof s)return pn(s);const n=s,{queryParams:i,fragment:r,routeConfig:o,url:a,outlet:l,params:c,data:u,title:h}=e;return fc(na(t,()=>n({params:c,data:u,queryParams:i,fragment:r,routeConfig:o,url:a,outlet:l,title:h})))}(t,i,r).pipe(Kn(o=>{if(o instanceof vh)throw new kC(o);const a=this.applyRedirectCreateUrlTree(o,this.urlSerializer.parse(o),e,n);if("/"===o[0])throw new kC(a);return a}))}applyRedirectCreateUrlTree(e,t,n,i){const r=this.createSegmentGroup(e,t.root,n,i);return new vh(r,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return Object.entries(e).forEach(([i,r])=>{if("string"==typeof r&&":"===r[0]){const a=r.substring(1);n[i]=t[a]}else n[i]=r}),n}createSegmentGroup(e,t,n,i){const r=this.createSegments(e,t.segments,n,i);let o={};return Object.entries(t.children).forEach(([a,l])=>{o[a]=this.createSegmentGroup(e,l,n,i)}),new Bs(r,o)}createSegments(e,t,n,i){return t.map(r=>":"===r.path[0]?this.findPosParam(e,r,i):this.findOrReturn(r,n))}findPosParam(e,t,n){const i=n[t.path.substring(1)];if(!i)throw new R(4001,!1);return i}findOrReturn(e,t){let n=0;for(const i of t){if(i.path===e.path)return t.splice(n),i;n++}return e}}const CC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function WQ(s,e,t,n,i){const r=FO(s,e,t);return r.matched?(n=function tQ(s,e){return s.providers&&!s._injector&&(s._injector=NT(s.providers,e,`Route: ${s.path}`)),s._injector??e}(e,n),function FQ(s,e,t,n){const i=e.canMatch;return i&&0!==i.length?pn(i.map(o=>{const a=gf(o,s);return fc(function CQ(s){return s&&Mg(s.canMatch)}(a)?a.canMatch(e,t):na(s,()=>a(e,t)))})).pipe(mf(),RO()):pn(!0)}(n,e,t).pipe(Kn(o=>!0===o?r:{...CC}))):pn(r)}function FO(s,e,t){if("**"===e.path)return function GQ(s){return{matched:!0,parameters:s.length>0?iO(s).parameters:{},consumedSegments:s,remainingSegments:[],positionalParamSegments:{}}}(t);if(""===e.path)return"full"===e.pathMatch&&(s.hasChildren()||t.length>0)?{...CC}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const i=(e.matcher||yZ)(t,s,e);if(!i)return{...CC};const r={};Object.entries(i.posParams??{}).forEach(([a,l])=>{r[a]=l.path});const o=i.consumed.length>0?{...r,...i.consumed[i.consumed.length-1].parameters}:r;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function OO(s,e,t,n){return t.length>0&&function qQ(s,e,t){return t.some(n=>Sb(s,e,n)&&Ra(n)!==vn)}(s,t,n)?{segmentGroup:new Bs(e,zQ(n,new Bs(t,s.children))),slicedSegments:[]}:0===t.length&&function $Q(s,e,t){return t.some(n=>Sb(s,e,n))}(s,t,n)?{segmentGroup:new Bs(s.segments,UQ(s,t,n,s.children)),slicedSegments:t}:{segmentGroup:new Bs(s.segments,s.children),slicedSegments:t}}function UQ(s,e,t,n){const i={};for(const r of t)if(Sb(s,e,r)&&!n[Ra(r)]){const o=new Bs([],{});i[Ra(r)]=o}return{...n,...i}}function zQ(s,e){const t={};t[vn]=e;for(const n of s)if(""===n.path&&Ra(n)!==vn){const i=new Bs([],{});t[Ra(n)]=i}return t}function Sb(s,e,t){return(!(s.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}class YQ{}class ZQ{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,n,i,r,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=n,this.config=i,this.urlTree=r,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new VQ(this.urlSerializer,this.urlTree)}noMatchError(e){return new R(4002,`'${e.segmentGroup}'`)}recognize(){const e=OO(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(Kn(({children:t,rootSnapshot:n})=>{const i=new Fa(n,t),r=new DO("",i),o=function OZ(s,e,t=null,n=null){return mO(gO(s),e,t,n)}(n,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(o),{state:r,tree:o}}))}match(e){const t=new yb([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),vn,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,vn,t).pipe(Kn(n=>({children:n,rootSnapshot:t})),uf(n=>{if(n instanceof kC)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof TC?this.noMatchError(n):n}))}processSegmentGroup(e,t,n,i,r){return 0===n.segments.length&&n.hasChildren()?this.processChildren(e,t,n,r):this.processSegment(e,t,n,n.segments,i,!0,r).pipe(Kn(o=>o instanceof Fa?[o]:[]))}processChildren(e,t,n,i){const r=[];for(const o of Object.keys(n.children))"primary"===o?r.unshift(o):r.push(o);return Br(r).pipe(rb(o=>{const a=n.children[o],l=function rQ(s,e){const t=s.filter(n=>Ra(n)===e);return t.push(...s.filter(n=>Ra(n)!==e)),t}(t,o);return this.processSegmentGroup(e,l,a,o,i)}),function uZ(s,e){return Oi(function cZ(s,e,t,n,i){return(r,o)=>{let a=t,l=e,c=0;r.subscribe(pi(o,u=>{const h=c++;l=a?s(l,u,h):(a=!0,u),n&&o.next(l)},i&&(()=>{a&&o.next(l),o.complete()})))}}(s,e,arguments.length>=2,!0))}((o,a)=>(o.push(...a),o)),ib(null),function hZ(s,e){const t=arguments.length>=2;return n=>n.pipe(s?cu((i,r)=>s(i,r,n)):ys,sC(1),t?ib(e):KF(()=>new tb))}(),Mr(o=>{if(null===o)return yf(n);const a=LO(o);return function QQ(s){s.sort((e,t)=>e.value.outlet===vn?-1:t.value.outlet===vn?1:e.value.outlet.localeCompare(t.value.outlet))}(a),pn(a)}))}processSegment(e,t,n,i,r,o,a){return Br(t).pipe(rb(l=>this.processSegmentAgainstRoute(l._injector??e,t,l,n,i,r,o,a).pipe(uf(c=>{if(c instanceof TC)return pn(null);throw c}))),Sh(l=>!!l),uf(l=>{if(AO(l))return function jQ(s,e,t){return 0===e.length&&!s.children[t]}(n,i,r)?pn(new YQ):yf(n);throw l}))}processSegmentAgainstRoute(e,t,n,i,r,o,a,l){return Ra(n)===o||o!==vn&&Sb(i,r,n)?void 0===n.redirectTo?this.matchSegmentAgainstRoute(e,i,n,r,o,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,n,r,o,l):yf(i):yf(i)}expandSegmentAgainstRouteUsingRedirect(e,t,n,i,r,o,a){const{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:h,remainingSegments:d}=FO(t,i,r);if(!l)return yf(t);"string"==typeof i.redirectTo&&"/"===i.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const p=new yb(r,c,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,VO(i),Ra(i),i.component??i._loadedComponent??null,i,HO(i)),g=mb(p,a,this.paramsInheritanceStrategy);return p.params=Object.freeze(g.params),p.data=Object.freeze(g.data),this.applyRedirects.applyRedirectCommands(u,i.redirectTo,h,p,e).pipe(ca(_=>this.applyRedirects.lineralizeSegments(i,_)),Mr(_=>this.processSegment(e,n,t,_.concat(d),o,!1,a)))}matchSegmentAgainstRoute(e,t,n,i,r,o){const a=WQ(t,n,i,e);return"**"===n.path&&(t.children={}),a.pipe(ca(l=>l.matched?this.getChildConfig(e=n._injector??e,n,i).pipe(ca(({routes:c})=>{const u=n._loadedInjector??e,{parameters:h,consumedSegments:d,remainingSegments:p}=l,g=new yb(d,h,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,VO(n),Ra(n),n.component??n._loadedComponent??null,n,HO(n)),m=mb(g,o,this.paramsInheritanceStrategy);g.params=Object.freeze(m.params),g.data=Object.freeze(m.data);const{segmentGroup:_,slicedSegments:y}=OO(t,d,p,c);if(0===y.length&&_.hasChildren())return this.processChildren(u,c,_,g).pipe(Kn(S=>new Fa(g,S)));if(0===c.length&&0===y.length)return pn(new Fa(g,[]));const b=Ra(n)===r;return this.processSegment(u,c,_,y,b?vn:r,!0,g).pipe(Kn(S=>new Fa(g,S instanceof Fa?[S]:[])))})):yf(t)))}getChildConfig(e,t,n){return t.children?pn({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?pn({routes:t._loadedRoutes,injector:t._loadedInjector}):function RQ(s,e,t,n){const i=e.canLoad;return void 0===i||0===i.length?pn(!0):pn(i.map(o=>{const a=gf(o,s);return fc(function SQ(s){return s&&Mg(s.canLoad)}(a)?a.canLoad(e,t):na(s,()=>a(e,t)))})).pipe(mf(),RO())}(e,t,n).pipe(Mr(i=>i?this.configLoader.loadChildren(e,t).pipe(Pr(r=>{t._loadedRoutes=r.routes,t._loadedInjector=r.injector})):function LQ(){return sb(BO(!1,To.GuardRejected))}())):pn({routes:[],injector:e})}}function KQ(s){const e=s.value.routeConfig;return e&&""===e.path}function LO(s){const e=[],t=new Set;for(const n of s){if(!KQ(n)){e.push(n);continue}const i=e.find(r=>n.value.routeConfig===r.value.routeConfig);void 0!==i?(i.children.push(...n.children),t.add(i)):e.push(n)}for(const n of t){const i=LO(n.children);e.push(new Fa(n.value,i))}return e.filter(n=>!t.has(n))}function VO(s){return s.data||{}}function HO(s){return s.resolve||{}}function WO(s){const e=s.children.map(t=>WO(t)).flat();return[s,...e]}function DC(s){return ca(e=>{const t=s(e);return t?Br(t).pipe(Kn(()=>e)):pn(e)})}let GO=(()=>{class s{buildTitle(t){let n,i=t.root;for(;void 0!==i;)n=this.getResolvedTitleForRoute(i)??n,i=i.children.find(r=>r.outlet===vn);return n}getResolvedTitleForRoute(t){return t.data[vg]}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:()=>le(rK),providedIn:"root"})}return s})(),rK=(()=>{class s extends GO{title;constructor(t){super(),this.title=t}updateTitle(t){const n=this.buildTitle(t);void 0!==n&&this.title.setTitle(n)}static \u0275fac=function(n){return new(n||s)(Sn(dZ))};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const vb=new ve("",{providedIn:"root",factory:()=>({})}),xC=new ve("");let UO=(()=>{class s{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=le(lY);loadComponent(t,n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return pn(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const i=fc(na(t,()=>n.loadComponent())).pipe(Kn(zO),ca(qO),Pr(o=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=o}),iC(()=>{this.componentLoaders.delete(n)})),r=new QF(i,()=>new xn).pipe(nC());return this.componentLoaders.set(n,r),r}loadChildren(t,n){if(this.childrenLoaders.get(n))return this.childrenLoaders.get(n);if(n._loadedRoutes)return pn({routes:n._loadedRoutes,injector:n._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(n);const r=function oK(s,e,t,n){return fc(na(t,()=>s.loadChildren())).pipe(Kn(zO),ca(qO),Mr(i=>i instanceof wM||Array.isArray(i)?pn(i):Br(e.compileModuleAsync(i))),Kn(i=>{n&&n(s);let r,o,a=!1;return Array.isArray(i)?(o=i,!0):(r=i.create(t).injector,o=r.get(xC,[],{optional:!0,self:!0}).flat()),{routes:o.map(SC),injector:r}}))}(n,this.compiler,t,this.onLoadEndListener).pipe(iC(()=>{this.childrenLoaders.delete(n)})),o=new QF(r,()=>new xn).pipe(nC());return this.childrenLoaders.set(n,o),o}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function zO(s){return function aK(s){return s&&"object"==typeof s&&"default"in s}(s)?s.default:s}function qO(s){return pn(s)}let NC=(()=>{class s{static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:()=>le(lK),providedIn:"root"})}return s})(),lK=(()=>{class s{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,n){return t}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const cK=new ve(""),dK=new ve("");let fK=(()=>{class s{currentNavigation=ic(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=null;events=new xn;transitionAbortWithErrorSubject=new xn;configLoader=le(UO);environmentInjector=le($r);destroyRef=le(fl);urlSerializer=le(ab);rootContexts=le(Ng);location=le(yp);inputBindingEnabled=null!==le(wC,{optional:!0});titleStrategy=le(GO);options=le(vb,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=le(NC);createViewTransition=le(cK,{optional:!0});navigationErrorHandler=le(dK,{optional:!0});navigationId=0;get hasRequestedNavigation(){return 0!==this.navigationId}transitions;afterPreactivation=()=>pn(void 0);rootComponentType=null;destroyed=!1;constructor(){this.configLoader.onLoadEndListener=i=>this.events.next(new XZ(i)),this.configLoader.onLoadStartListener=i=>this.events.next(new YZ(i)),this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){const n=++this.navigationId;Hs(()=>{this.transitions?.next({...t,extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,abortController:new AbortController,id:n})})}setupNavigations(t){return this.transitions=new lt(null),this.transitions.pipe(cu(n=>null!==n),ca(n=>{let i=!1;return pn(n).pipe(ca(r=>{if(this.navigationId>n.id)return this.cancelNavigationTransition(n,"",To.SupersededByNewNavigation),Aa;this.currentTransition=n,this.currentNavigation.set({id:r.id,initialUrl:r.rawUrl,extractedUrl:r.extractedUrl,targetBrowserUrl:"string"==typeof r.extras.browserUrl?this.urlSerializer.parse(r.extras.browserUrl):r.extras.browserUrl,trigger:r.source,extras:r.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null,abort:()=>r.abortController.abort()});const o=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!o&&"reload"!==(r.extras.onSameUrlNavigation??t.onSameUrlNavigation))return this.events.next(new xg(r.id,this.urlSerializer.serialize(r.rawUrl),"",hC.IgnoredSameUrlNavigation)),r.resolve(!1),Aa;if(this.urlHandlingStrategy.shouldProcessUrl(r.rawUrl))return pn(r).pipe(ca(l=>(this.events.next(new uC(l.id,this.urlSerializer.serialize(l.extractedUrl),l.source,l.restoredState)),l.id!==this.navigationId?Aa:Promise.resolve(l))),function eK(s,e,t,n,i,r){return Mr(o=>function XQ(s,e,t,n,i,r,o="emptyOnly"){return new ZQ(s,e,t,n,i,o,r).recognize()}(s,e,t,n,o.extractedUrl,i,r).pipe(Kn(({state:a,tree:l})=>({...o,targetSnapshot:a,urlAfterRedirects:l}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),Pr(l=>{n.targetSnapshot=l.targetSnapshot,n.urlAfterRedirects=l.urlAfterRedirects,this.currentNavigation.update(u=>(u.finalUrl=l.urlAfterRedirects,u));const c=new vO(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}));if(o&&this.urlHandlingStrategy.shouldProcessUrl(r.currentRawUrl)){const{id:l,extractedUrl:c,source:u,restoredState:h,extras:d}=r,p=new uC(l,this.urlSerializer.serialize(c),u,h);this.events.next(p);const g=CO(this.rootComponentType).snapshot;return this.currentTransition=n={...r,targetSnapshot:g,urlAfterRedirects:c,extras:{...d,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.update(m=>(m.finalUrl=c,m)),pn(n)}return this.events.next(new xg(r.id,this.urlSerializer.serialize(r.extractedUrl),"",hC.IgnoredByUrlHandlingStrategy)),r.resolve(!1),Aa}),Pr(r=>{const o=new zZ(r.id,this.urlSerializer.serialize(r.extractedUrl),this.urlSerializer.serialize(r.urlAfterRedirects),r.targetSnapshot);this.events.next(o)}),Kn(r=>(this.currentTransition=n={...r,guards:mQ(r.targetSnapshot,r.currentSnapshot,this.rootContexts)},n)),function xQ(s,e){return Mr(t=>{const{targetSnapshot:n,currentSnapshot:i,guards:{canActivateChecks:r,canDeactivateChecks:o}}=t;return 0===o.length&&0===r.length?pn({...t,guardsResult:!0}):function NQ(s,e,t,n){return Br(s).pipe(Mr(i=>function AQ(s,e,t,n,i){const r=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return r&&0!==r.length?pn(r.map(a=>{const l=df(e)??i,c=gf(a,l);return fc(function kQ(s){return s&&Mg(s.canDeactivate)}(c)?c.canDeactivate(s,e,t,n):na(l,()=>c(s,e,t,n))).pipe(Sh())})).pipe(mf()):pn(!0)}(i.component,i.route,t,e,n)),Sh(i=>!0!==i,!0))}(o,n,i,s).pipe(Mr(a=>a&&function wQ(s){return"boolean"==typeof s}(a)?function EQ(s,e,t,n){return Br(e).pipe(rb(i=>nb(function BQ(s,e){return null!==s&&e&&e(new JZ(s)),pn(!0)}(i.route.parent,n),function IQ(s,e){return null!==s&&e&&e(new QZ(s)),pn(!0)}(i.route,n),function PQ(s,e,t){const n=e[e.length-1],r=e.slice(0,e.length-1).reverse().map(o=>function yQ(s){const e=s.routeConfig?s.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:s,guards:e}:null}(o)).filter(o=>null!==o).map(o=>tC(()=>pn(o.guards.map(l=>{const c=df(o.node)??t,u=gf(l,c);return fc(function TQ(s){return s&&Mg(s.canActivateChild)}(u)?u.canActivateChild(n,s):na(c,()=>u(n,s))).pipe(Sh())})).pipe(mf())));return pn(r).pipe(mf())}(s,i.path,t),function MQ(s,e,t){const n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||0===n.length)return pn(!0);const i=n.map(r=>tC(()=>{const o=df(e)??t,a=gf(r,o);return fc(function vQ(s){return s&&Mg(s.canActivate)}(a)?a.canActivate(e,s):na(o,()=>a(e,s))).pipe(Sh())}));return pn(i).pipe(mf())}(s,i.route,t))),Sh(i=>!0!==i,!0))}(n,r,s,e):pn(a)),Kn(a=>({...t,guardsResult:a})))})}(this.environmentInjector,r=>this.events.next(r)),Pr(r=>{if(n.guardsResult=r.guardsResult,r.guardsResult&&"boolean"!=typeof r.guardsResult)throw _b(0,r.guardsResult);const o=new qZ(r.id,this.urlSerializer.serialize(r.extractedUrl),this.urlSerializer.serialize(r.urlAfterRedirects),r.targetSnapshot,!!r.guardsResult);this.events.next(o)}),cu(r=>!!r.guardsResult||(this.cancelNavigationTransition(r,"",To.GuardRejected),!1)),DC(r=>{if(0!==r.guards.canActivateChecks.length)return pn(r).pipe(Pr(o=>{const a=new $Z(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}),ca(o=>{let a=!1;return pn(o).pipe(function tK(s,e){return Mr(t=>{const{targetSnapshot:n,guards:{canActivateChecks:i}}=t;if(!i.length)return pn(t);const r=new Set(i.map(l=>l.route)),o=new Set;for(const l of r)if(!o.has(l))for(const c of WO(l))o.add(c);let a=0;return Br(o).pipe(rb(l=>r.has(l)?function nK(s,e,t,n){const i=s.routeConfig,r=s._resolve;return void 0!==i?.title&&!NO(i)&&(r[vg]=i.title),tC(()=>(s.data=mb(s,s.parent,t).resolve,function sK(s,e,t,n){const i=rC(s);if(0===i.length)return pn({});const r={};return Br(i).pipe(Mr(o=>function iK(s,e,t,n){const i=df(e)??n,r=gf(s,i);return fc(r.resolve?r.resolve(e,t):na(i,()=>r(e,t)))}(s[o],e,t,n).pipe(Sh(),Pr(a=>{if(a instanceof vC)throw _b(new lb,a);r[o]=a}))),sC(1),Kn(()=>r),uf(o=>AO(o)?Aa:sb(o)))}(r,s,e,n).pipe(Kn(o=>(s._resolvedData=o,s.data={...s.data,...o},null)))))}(l,n,s,e):(l.data=mb(l,l.parent,s).resolve,pn(void 0))),Pr(()=>a++),sC(1),Mr(l=>a===o.size?pn(t):Aa))})}(this.paramsInheritanceStrategy,this.environmentInjector),Pr({next:()=>a=!0,complete:()=>{a||this.cancelNavigationTransition(o,"",To.NoDataFromResolver)}}))}),Pr(o=>{const a=new jZ(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}))}),DC(r=>{const o=a=>{const l=[];if(a.routeConfig?.loadComponent){const c=df(a)??this.environmentInjector;l.push(this.configLoader.loadComponent(c,a.routeConfig).pipe(Pr(u=>{a.component=u}),Kn(()=>{})))}for(const c of a.children)l.push(...o(c));return l};return JF(o(r.targetSnapshot.root)).pipe(ib(null),lu(1))}),DC(()=>this.afterPreactivation()),ca(()=>{const{currentSnapshot:r,targetSnapshot:o}=n,a=this.createViewTransition?.(this.environmentInjector,r.root,o.root);return a?Br(a).pipe(Kn(()=>n)):pn(n)}),Kn(r=>{const o=function uQ(s,e,t){const n=Eg(s,e._root,t?t._root:void 0);return new kO(n,e)}(t.routeReuseStrategy,r.targetSnapshot,r.currentRouterState);return this.currentTransition=n={...r,targetRouterState:o},this.currentNavigation.update(a=>(a.targetRouterState=o,a)),n}),Pr(()=>{this.events.next(new fC)}),((s,e,t,n)=>Kn(i=>(new gQ(e,i.targetRouterState,i.currentRouterState,t,n).activate(s),i)))(this.rootContexts,t.routeReuseStrategy,r=>this.events.next(r),this.inputBindingEnabled),lu(1),eO(new Lt(r=>{const o=n.abortController.signal,a=()=>r.next();return o.addEventListener("abort",a),()=>o.removeEventListener("abort",a)}).pipe(cu(()=>!i&&!n.targetRouterState),Pr(()=>{this.cancelNavigationTransition(n,n.abortController.signal.reason+"",To.Aborted)}))),Pr({next:r=>{i=!0,this.lastSuccessfulNavigation=Hs(this.currentNavigation),this.events.next(new Ch(r.id,this.urlSerializer.serialize(r.extractedUrl),this.urlSerializer.serialize(r.urlAfterRedirects))),this.titleStrategy?.updateTitle(r.targetRouterState.snapshot),r.resolve(!0)},complete:()=>{i=!0}}),eO(this.transitionAbortWithErrorSubject.pipe(Pr(r=>{throw r}))),iC(()=>{i||this.cancelNavigationTransition(n,"",To.SupersededByNewNavigation),this.currentTransition?.id===n.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),uf(r=>{if(this.destroyed)return n.resolve(!1),Aa;if(i=!0,MO(r))this.events.next(new Dh(n.id,this.urlSerializer.serialize(n.extractedUrl),r.message,r.cancellationCode)),function fQ(s){return MO(s)&&kh(s.url)}(r)?this.events.next(new gb(r.url,r.navigationBehaviorOptions)):n.resolve(!1);else{const o=new dC(n.id,this.urlSerializer.serialize(n.extractedUrl),r,n.targetSnapshot??void 0);try{const a=na(this.environmentInjector,()=>this.navigationErrorHandler?.(o));if(!(a instanceof vC))throw this.events.next(o),r;{const{message:l,cancellationCode:c}=_b(0,a);this.events.next(new Dh(n.id,this.urlSerializer.serialize(n.extractedUrl),l,c)),this.events.next(new gb(a.redirectTo,a.navigationBehaviorOptions))}}catch(a){this.options.resolveNavigationPromiseOnError?n.resolve(!1):n.reject(a)}}return Aa}))}))}cancelNavigationTransition(t,n,i){const r=new Dh(t.id,this.urlSerializer.serialize(t.extractedUrl),n,i);this.events.next(r),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),n=Hs(this.currentNavigation),i=n?.targetBrowserUrl??n?.extractedUrl;return t.toString()!==i?.toString()&&!n?.extras.skipLocationChange}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function pK(s){return s!==pb}let gK=(()=>{class s{static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:()=>le(yK),providedIn:"root"})}return s})();class mK{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}let yK=(()=>{class s extends mK{static \u0275fac=(()=>{let t;return function(i){return(t||(t=ur(s)))(i||s)}})();static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),$O=(()=>{class s{urlSerializer=le(ab);options=le(vb,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=le(yp);urlHandlingStrategy=le(NC);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new vh;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:n,targetBrowserUrl:i}){const r=void 0!==t?this.urlHandlingStrategy.merge(t,n):n,o=i??r;return o instanceof vh?this.urlSerializer.serialize(o):o}commitTransition({targetRouterState:t,finalUrl:n,initialUrl:i}){n&&t?(this.currentUrlTree=n,this.rawUrlTree=this.urlHandlingStrategy.merge(n,i),this.routerState=t):this.rawUrlTree=i}routerState=CO(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:()=>le(_K),providedIn:"root"})}return s})(),_K=(()=>{class s extends $O{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(n=>{"popstate"===n.type&&setTimeout(()=>{t(n.url,n.state,"popstate")})})}handleRouterEvent(t,n){t instanceof uC?this.updateStateMemento():t instanceof xg?this.commitTransition(n):t instanceof vO?"eager"===this.urlUpdateStrategy&&(n.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(n),n)):t instanceof fC?(this.commitTransition(n),"deferred"===this.urlUpdateStrategy&&!n.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(n),n)):t instanceof Dh&&t.code!==To.SupersededByNewNavigation&&t.code!==To.Redirect?this.restoreHistory(n):t instanceof dC?this.restoreHistory(n,!0):t instanceof Ch&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:n,id:i}){const{replaceUrl:r,state:o}=n;if(this.location.isCurrentPathEqualTo(t)||r){const a=this.browserPageId,l={...o,...this.generateNgRouterState(i,a)};this.location.replaceState(t,"",l)}else{const a={...o,...this.generateNgRouterState(i,this.browserPageId+1)};this.location.go(t,"",a)}}restoreHistory(t,n=!1){if("computed"===this.canceledNavigationResolution){const r=this.currentPageId-this.browserPageId;0!==r?this.location.historyGo(r):this.getCurrentUrlTree()===t.finalUrl&&0===r&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(n&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,n){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:n}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(i){return(t||(t=ur(s)))(i||s)}})();static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const wK={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},SK={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let _f=(()=>{class s{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=le(iP);stateManager=le($O);options=le(vb,{optional:!0})||{};pendingTasks=le($c);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=le(fK);urlSerializer=le(ab);location=le(yp);urlHandlingStrategy=le(NC);injector=le($r);_events=new xn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=le(gK);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=le(xC,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!le(wC,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new rr;subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(n=>{try{const i=this.navigationTransitions.currentTransition,r=Hs(this.navigationTransitions.currentNavigation);if(null!==i&&null!==r)if(this.stateManager.handleRouterEvent(n,r),n instanceof Dh&&n.code!==To.Redirect&&n.code!==To.SupersededByNewNavigation)this.navigated=!0;else if(n instanceof Ch)this.navigated=!0;else if(n instanceof gb){const o=n.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(n.url,i.currentRawUrl),l={browserUrl:i.extras.browserUrl,info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:i.extras.replaceUrl||"eager"===this.urlUpdateStrategy||pK(i.source),...o};this.scheduleNavigation(a,pb,null,l,{resolve:i.resolve,reject:i.reject,promise:i.promise})}(function eQ(s){return!(s instanceof fC||s instanceof gb)})(n)&&this._events.next(n)}catch(i){this.navigationTransitions.transitionAbortWithErrorSubject.next(i)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),pb,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,n,i)=>{this.navigateToSyncWithBrowser(t,i,n)})}navigateToSyncWithBrowser(t,n,i){const r={replaceUrl:!0},o=i?.navigationId?i:null;if(i){const l={...i};delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(r.state=l)}const a=this.parseUrl(t);this.scheduleNavigation(a,n,o,r).catch(l=>{this.disposed||this.injector.get(Ea)(l)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return Hs(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(SC),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,n={}){const{relativeTo:i,queryParams:r,fragment:o,queryParamsHandling:a,preserveFragment:l}=n,c=l?this.currentUrlTree.fragment:o;let h,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u={...this.currentUrlTree.queryParams,...r};break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=r||null}null!==u&&(u=this.removeEmptyProps(u));try{h=gO(i?i.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||"/"!==t[0][0])&&(t=[]),h=this.currentUrlTree.root}return mO(h,t,u,c??null)}navigateByUrl(t,n={skipLocationChange:!1}){const i=kh(t)?t:this.parseUrl(t),r=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(r,pb,null,n)}navigate(t,n={skipLocationChange:!1}){return function vK(s){for(let e=0;e<s.length;e++)if(null==s[e])throw new R(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,n),n)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,n){let i;if(i=!0===n?{...wK}:!1===n?{...SK}:n,kh(t))return oO(this.currentUrlTree,t,i);const r=this.parseUrl(t);return oO(this.currentUrlTree,r,i)}removeEmptyProps(t){return Object.entries(t).reduce((n,[i,r])=>(null!=r&&(n[i]=r),n),{})}scheduleNavigation(t,n,i,r,o){if(this.disposed)return Promise.resolve(!1);let a,l,c;o?(a=o.resolve,l=o.reject,c=o.promise):c=new Promise((h,d)=>{a=h,l=d});const u=this.pendingTasks.add();return function bK(s,e){s.events.pipe(cu(t=>t instanceof Ch||t instanceof Dh||t instanceof dC||t instanceof xg),Kn(t=>t instanceof Ch||t instanceof xg?0:t instanceof Dh&&(t.code===To.Redirect||t.code===To.SupersededByNewNavigation)?2:1),cu(t=>2!==t),lu(1)).subscribe(()=>{e()})}(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:n,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:r,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(h=>Promise.reject(h))}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const IC=new ve("");function YO(s){return s.routerState.root}function XO(){const s=le(Vo);return e=>{const t=s.get(uc);if(e!==t.components[0])return;const n=s.get(_f),i=s.get(JO);1===s.get(BC)&&n.initialNavigation(),s.get(ZO,null,{optional:!0})?.setUpPreloading(),s.get(IC,null,{optional:!0})?.init(),n.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}const JO=new ve("",{factory:()=>new xn}),BC=new ve("",{providedIn:"root",factory:()=>1}),ZO=new ve(""),MK={providers:[function dY(s){const e=s?.ignoreChangesOutsideZone,t=s?.scheduleInRootZone,n=Ek({ngZoneFactory:()=>{const i=Ik(s);return i.scheduleInRootZone=t,i.shouldCoalesceEventChangeDetection&&Ir("NgZone_CoalesceEvent"),new Jn(i)},ignoreChangesOutsideZone:e,scheduleInRootZone:t});return sy([{provide:hY,useValue:!0},{provide:WS,useValue:!1},n])}({eventCoalescing:!0}),function xK(s,...e){return sy([{provide:xC,multi:!0,useValue:s},[],{provide:pf,useFactory:YO,deps:[_f]},{provide:TP,multi:!0,useFactory:XO},e.map(t=>t.\u0275providers)])}([])]};let KO=(()=>{class s{_renderer;_elementRef;onChange=t=>{};onTouched=()=>{};constructor(t,n){this._renderer=t,this._elementRef=n}setProperty(t,n){this._renderer.setProperty(this._elementRef.nativeElement,t,n)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static \u0275fac=function(n){return new(n||s)(ue(cc),ue(Ho))};static \u0275dir=Qt({type:s})}return s})(),xh=(()=>{class s extends KO{static \u0275fac=(()=>{let t;return function(i){return(t||(t=ur(s)))(i||s)}})();static \u0275dir=Qt({type:s,features:[bs]})}return s})();const wl=new ve(""),AK={provide:wl,useExisting:ae(()=>Tb),multi:!0};let Tb=(()=>{class s extends xh{writeValue(t){this.setProperty("checked",t)}static \u0275fac=(()=>{let t;return function(i){return(t||(t=ur(s)))(i||s)}})();static \u0275dir=Qt({type:s,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(n,i){1&n&&ht("change",function(o){return i.onChange(o.target.checked)})("blur",function(){return i.onTouched()})},standalone:!1,features:[Qs([AK]),bs]})}return s})();const RK={provide:wl,useExisting:ae(()=>kb),multi:!0},OK=new ve("");let kb=(()=>{class s extends KO{_compositionMode;_composing=!1;constructor(t,n,i){super(t,n),this._compositionMode=i,null==this._compositionMode&&(this._compositionMode=!function FK(){const s=jc()?jc().getUserAgent():"";return/android (\d+)/.test(s.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static \u0275fac=function(n){return new(n||s)(ue(cc),ue(Ho),ue(OK,8))};static \u0275dir=Qt({type:s,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,i){1&n&&ht("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},standalone:!1,features:[Qs([RK]),bs]})}return s})();const Ar=new ve(""),hu=new ve("");function lL(s){return null!=s}function cL(s){return ag(s)?Br(s):s}function uL(s){let e={};return s.forEach(t=>{e=null!=t?{...e,...t}:e}),0===Object.keys(e).length?null:e}function hL(s,e){return e.map(t=>t(s))}function dL(s){return s.map(e=>function VK(s){return!s.validate}(e)?e:t=>e.validate(t))}function AC(s){return null!=s?function fL(s){if(!s)return null;const e=s.filter(lL);return 0==e.length?null:function(t){return uL(hL(t,e))}}(dL(s)):null}function RC(s){return null!=s?function pL(s){if(!s)return null;const e=s.filter(lL);return 0==e.length?null:function(t){return function PK(...s){const e=$F(s),{args:t,keys:n}=jF(s),i=new Lt(r=>{const{length:o}=t;if(!o)return void r.complete();const a=new Array(o);let l=o,c=o;for(let u=0;u<o;u++){let h=!1;Pa(t[u]).subscribe(pi(r,d=>{h||(h=!0,c--),a[u]=d},()=>l--,void 0,()=>{(!l||!h)&&(c||r.next(n?XF(n,a):a),r.complete())}))}});return e?i.pipe(YF(e)):i}(hL(t,e).map(cL)).pipe(Kn(uL))}}(dL(s)):null}function gL(s,e){return null===s?[e]:Array.isArray(s)?[...s,e]:[s,e]}function FC(s){return s?Array.isArray(s)?s:[s]:[]}function Db(s,e){return Array.isArray(s)?s.includes(e):s===e}function _L(s,e){const t=FC(e);return FC(s).forEach(i=>{Db(t,i)||t.push(i)}),t}function bL(s,e){return FC(e).filter(t=>!Db(s,t))}class wL{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=AC(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=RC(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class Qr extends wL{name;get formDirective(){return null}get path(){return null}}class du extends wL{_parent=null;name=null;valueAccessor=null}class SL{_cd;constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let OC=(()=>{class s extends SL{constructor(t){super(t)}static \u0275fac=function(n){return new(n||s)(ue(du,2))};static \u0275dir=Qt({type:s,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,i){2&n&&br("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},standalone:!1,features:[bs]})}return s})();const Pg="VALID",Nb="INVALID",bf="PENDING",Ag="DISABLED";class wf{}class TL extends wf{value;source;constructor(e,t){super(),this.value=e,this.source=t}}class HC extends wf{pristine;source;constructor(e,t){super(),this.pristine=e,this.source=t}}class WC extends wf{touched;source;constructor(e,t){super(),this.touched=e,this.source=t}}class Eb extends wf{status;source;constructor(e,t){super(),this.status=e,this.source=t}}class GC extends wf{source;constructor(e){super(),this.source=e}}function Ib(s){return null!=s&&!Array.isArray(s)&&"object"==typeof s}class qC{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(e,t){this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Hs(this.statusReactive)}set status(e){Hs(()=>this.statusReactive.set(e))}_status=Ma(()=>this.statusReactive());statusReactive=ic(void 0);get valid(){return this.status===Pg}get invalid(){return this.status===Nb}get pending(){return this.status==bf}get disabled(){return this.status===Ag}get enabled(){return this.status!==Ag}errors;get pristine(){return Hs(this.pristineReactive)}set pristine(e){Hs(()=>this.pristineReactive.set(e))}_pristine=Ma(()=>this.pristineReactive());pristineReactive=ic(!0);get dirty(){return!this.pristine}get touched(){return Hs(this.touchedReactive)}set touched(e){Hs(()=>this.touchedReactive.set(e))}_touched=Ma(()=>this.touchedReactive());touchedReactive=ic(!1);get untouched(){return!this.touched}_events=new xn;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(_L(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(_L(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(bL(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(bL(e,this._rawAsyncValidators))}hasValidator(e){return Db(this._rawValidators,e)}hasAsyncValidator(e){return Db(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){const t=!1===this.touched;this.touched=!0;const n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched({...e,sourceControl:n}),t&&!1!==e.emitEvent&&this._events.next(new WC(!0,n))}markAllAsDirty(e={}){this.markAsDirty({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsDirty(e))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){const t=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const n=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:n})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,n),t&&!1!==e.emitEvent&&this._events.next(new WC(!1,n))}markAsDirty(e={}){const t=!0===this.pristine;this.pristine=!1;const n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty({...e,sourceControl:n}),t&&!1!==e.emitEvent&&this._events.next(new HC(!1,n))}markAsPristine(e={}){const t=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const n=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,n),t&&!1!==e.emitEvent&&this._events.next(new HC(!0,n))}markAsPending(e={}){this.status=bf;const t=e.sourceControl??this;!1!==e.emitEvent&&(this._events.next(new Eb(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending({...e,sourceControl:t})}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Ag,this.errors=null,this._forEachChild(i=>{i.disable({...e,onlySelf:!0})}),this._updateValue();const n=e.sourceControl??this;!1!==e.emitEvent&&(this._events.next(new TL(this.value,n)),this._events.next(new Eb(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...e,skipPristineCheck:t},this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Pg,this._forEachChild(n=>{n.enable({...e,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors({...e,skipPristineCheck:t},this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Pg||this.status===bf)&&this._runAsyncValidator(n,e.emitEvent)}const t=e.sourceControl??this;!1!==e.emitEvent&&(this._events.next(new TL(this.value,t)),this._events.next(new Eb(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity({...e,sourceControl:t})}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ag:Pg}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=bf,this._hasOwnPendingAsyncValidator={emitEvent:!1!==t,shouldHaveEmitted:!1!==e};const n=cL(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const e=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent,this,t.shouldHaveEmitted)}get(e){let t=e;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((n,i)=>n&&n._find(i),this)}getError(e,t){const n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,n){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||n)&&this._events.next(new Eb(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,n)}_initObservables(){this.valueChanges=new Li,this.statusChanges=new Li}_calculateStatus(){return this._allControlsDisabled()?Ag:this.errors?Nb:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(bf)?bf:this._anyControlsHaveStatus(Nb)?Nb:Pg}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){const n=!this._anyControlsDirty(),i=this.pristine!==n;this.pristine=n,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new HC(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new WC(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_onDisabledChange=[];_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Ib(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=function jK(s){return Array.isArray(s)?AC(s):s||null}(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=function YK(s){return Array.isArray(s)?RC(s):s||null}(this._rawAsyncValidators)}}const Sf=new ve("",{providedIn:"root",factory:()=>Bb}),Bb="always";function Rg(s,e,t=Bb){(function jC(s,e){const t=function mL(s){return s._rawValidators}(s);null!==e.validator?s.setValidators(gL(t,e.validator)):"function"==typeof t&&s.setValidators([t]);const n=function yL(s){return s._rawAsyncValidators}(s);null!==e.asyncValidator?s.setAsyncValidators(gL(n,e.asyncValidator)):"function"==typeof n&&s.setAsyncValidators([n]);const i=()=>s.updateValueAndValidity();Ab(e._rawValidators,i),Ab(e._rawAsyncValidators,i)})(s,e),e.valueAccessor.writeValue(s.value),(s.disabled||"always"===t)&&e.valueAccessor.setDisabledState?.(s.disabled),function ZK(s,e){e.valueAccessor.registerOnChange(t=>{s._pendingValue=t,s._pendingChange=!0,s._pendingDirty=!0,"change"===s.updateOn&&xL(s,e)})}(s,e),function KK(s,e){const t=(n,i)=>{e.valueAccessor.writeValue(n),i&&e.viewToModelUpdate(n)};s.registerOnChange(t),e._registerOnDestroy(()=>{s._unregisterOnChange(t)})}(s,e),function QK(s,e){e.valueAccessor.registerOnTouched(()=>{s._pendingTouched=!0,"blur"===s.updateOn&&s._pendingChange&&xL(s,e),"submit"!==s.updateOn&&s.markAsTouched()})}(s,e),function JK(s,e){if(e.valueAccessor.setDisabledState){const t=n=>{e.valueAccessor.setDisabledState(n)};s.registerOnDisabledChange(t),e._registerOnDestroy(()=>{s._unregisterOnDisabledChange(t)})}}(s,e)}function Ab(s,e){s.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function xL(s,e){s._pendingDirty&&s.markAsDirty(),s.setValue(s._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(s._pendingValue),s._pendingChange=!1}function IL(s,e){const t=s.indexOf(e);t>-1&&s.splice(t,1)}function BL(s){return"object"==typeof s&&null!==s&&2===Object.keys(s).length&&"value"in s&&"disabled"in s}Promise.resolve();const ML=class extends qC{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(e=null,t,n){super(function UC(s){return(Ib(s)?s.validators:s)||null}(t),function zC(s,e){return(Ib(e)?e.asyncValidators:s)||null}(n,t)),this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ib(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=BL(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(n=>n(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1,!1!==t?.emitEvent&&this._events.next(new GC(this))}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){IL(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){IL(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){BL(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}},cee={provide:du,useExisting:ae(()=>Vb)},PL=Promise.resolve();let Vb=(()=>{class s extends du{_changeDetectorRef;callSetDisabledState;control=new ML;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Li;constructor(t,n,i,r,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this._parent=t,this._setValidators(n),this._setAsyncValidators(i),this.valueAccessor=function JC(s,e){if(!e)return null;let t,n,i;return Array.isArray(e),e.forEach(r=>{r.constructor===kb?t=r:function nee(s){return Object.getPrototypeOf(s.constructor)===xh}(r)?n=r:i=r}),i||n||t||null}(0,r)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const n=t.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),function XC(s,e){if(!s.hasOwnProperty("model"))return!1;const t=s.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Rg(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){PL.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){const n=t.isDisabled.currentValue,i=0!==n&&function cf(s){return"boolean"==typeof s?s:null!=s&&"false"!==s}(n);PL.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?function Mb(s,e){return[...e.path,s]}(t,this._parent):[t]}static \u0275fac=function(n){return new(n||s)(ue(Qr,9),ue(Ar,10),ue(hu,10),ue(wl,10),ue(lf,8),ue(Sf,8))};static \u0275dir=Qt({type:s,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Qs([cee]),bs,ra]})}return s})();const dee={provide:wl,useExisting:ae(()=>ZC),multi:!0};let fee=(()=>{class s{_accessors=[];add(t,n){this._accessors.push([t,n])}remove(t){for(let n=this._accessors.length-1;n>=0;--n)if(this._accessors[n][1]===t)return void this._accessors.splice(n,1)}select(t){this._accessors.forEach(n=>{this._isSameGroup(n,t)&&n[1]!==t&&n[1].fireUncheck(t.value)})}_isSameGroup(t,n){return!!t[0].control&&t[0]._parent===n._control._parent&&t[1].name===n.name}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),ZC=(()=>{class s extends xh{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=le(Sf,{optional:!0})??Bb;constructor(t,n,i,r){super(t,n),this._registry=i,this._injector=r}ngOnInit(){this._control=this._injector.get(du),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(t){this._state=t===this.value,this.setProperty("checked",this._state)}registerOnChange(t){this._fn=t,this.onChange=()=>{t(this.value),this._registry.select(this)}}setDisabledState(t){(this.setDisabledStateFired||t||"whenDisabledForLegacyCode"===this.callSetDisabledState)&&this.setProperty("disabled",t),this.setDisabledStateFired=!0}fireUncheck(t){this.writeValue(t)}_checkName(){!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(n){return new(n||s)(ue(cc),ue(Ho),ue(fee),ue(Vo))};static \u0275dir=Qt({type:s,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(n,i){1&n&&ht("change",function(){return i.onChange()})("blur",function(){return i.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[Qs([dee]),bs]})}return s})();const wee={provide:wl,useExisting:ae(()=>Gb),multi:!0};function HL(s,e){return null==s?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${s}: ${e}`.slice(0,50))}let Gb=(()=>{class s extends xh{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;appRefInjector=le(uc).injector;destroyRef=le(fl);cdr=le(lf);_queuedWrite=!1;_writeValueAfterRender(){this._queuedWrite||this.appRefInjector.destroyed||(this._queuedWrite=!0,YM({write:()=>{this.destroyRef.destroyed||(this._queuedWrite=!1,this.writeValue(this.value))}},{injector:this.appRefInjector}))}writeValue(t){this.cdr.markForCheck(),this.value=t;const i=HL(this._getOptionId(t),t);this.setProperty("value",i)}registerOnChange(t){this.onChange=n=>{this.value=this._getOptionValue(n),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n),t))return n;return null}_getOptionValue(t){const n=function See(s){return s.split(":")[0]}(t);return this._optionMap.has(n)?this._optionMap.get(n):t}static \u0275fac=(()=>{let t;return function(i){return(t||(t=ur(s)))(i||s)}})();static \u0275dir=Qt({type:s,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,i){1&n&&ht("change",function(o){return i.onChange(o.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Qs([wee]),bs]})}return s})(),WL=(()=>{class s{_element;_renderer;_select;id;constructor(t,n,i){this._element=t,this._renderer=n,this._select=i,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(HL(this.id,t)),this._select._writeValueAfterRender())}set value(t){this._setElementValue(t),this._select&&this._select._writeValueAfterRender()}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select._writeValueAfterRender())}static \u0275fac=function(n){return new(n||s)(ue(Ho),ue(cc),ue(Gb,9))};static \u0275dir=Qt({type:s,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return s})();const vee={provide:wl,useExisting:ae(()=>QC),multi:!0};function GL(s,e){return null==s?`${e}`:("string"==typeof e&&(e=`'${e}'`),e&&"object"==typeof e&&(e="Object"),`${s}: ${e}`.slice(0,50))}let QC=(()=>{class s extends xh{value;_optionMap=new Map;_idCounter=0;set compareWith(t){this._compareWith=t}_compareWith=Object.is;writeValue(t){let n;if(this.value=t,Array.isArray(t)){const i=t.map(r=>this._getOptionId(r));n=(r,o)=>{r._setSelected(i.indexOf(o.toString())>-1)}}else n=(i,r)=>{i._setSelected(!1)};this._optionMap.forEach(n)}registerOnChange(t){this.onChange=n=>{const i=[],r=n.selectedOptions;if(void 0!==r){const o=r;for(let a=0;a<o.length;a++){const c=this._getOptionValue(o[a].value);i.push(c)}}else{const o=n.options;for(let a=0;a<o.length;a++){const l=o[a];if(l.selected){const c=this._getOptionValue(l.value);i.push(c)}}}this.value=i,t(i)}}_registerOption(t){const n=(this._idCounter++).toString();return this._optionMap.set(n,t),n}_getOptionId(t){for(const n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n)._value,t))return n;return null}_getOptionValue(t){const n=function Tee(s){return s.split(":")[0]}(t);return this._optionMap.has(n)?this._optionMap.get(n)._value:t}static \u0275fac=(()=>{let t;return function(i){return(t||(t=ur(s)))(i||s)}})();static \u0275dir=Qt({type:s,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,i){1&n&&ht("change",function(o){return i.onChange(o.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Qs([vee]),bs]})}return s})(),UL=(()=>{class s{_element;_renderer;_select;id;_value;constructor(t,n,i){this._element=t,this._renderer=n,this._select=i,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(GL(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(GL(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(n){return new(n||s)(ue(Ho),ue(cc),ue(QC,9))};static \u0275dir=Qt({type:s,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return s})(),Mee=(()=>{class s{static \u0275fac=function(n){return new(n||s)};static \u0275mod=tg({type:s});static \u0275inj=Ko({})}return s})(),KL=(()=>{class s{static withConfig(t){return{ngModule:s,providers:[{provide:Sf,useValue:t.callSetDisabledState??Bb}]}}static \u0275fac=function(n){return new(n||s)};static \u0275mod=tg({type:s});static \u0275inj=Ko({imports:[Mee]})}return s})();class bte{$implicit;ngForOf;index;count;constructor(e,t,n,i){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=i}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let uD=(()=>{class s{_viewContainer;_template;_differs;set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(t,n,i){this._viewContainer=t,this._template=n,this._differs=i}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const n=this._viewContainer;t.forEachOperation((i,r,o)=>{if(null==i.previousIndex)n.createEmbeddedView(this._template,new bte(i.item,this._ngForOf,-1,-1),null===o?void 0:o);else if(null==o)n.remove(null===r?void 0:r);else if(null!==r){const a=n.get(r);n.move(a,o),u2(a,i)}});for(let i=0,r=n.length;i<r;i++){const a=n.get(i).context;a.index=i,a.count=r,a.ngForOf=this._ngForOf}t.forEachIdentityChange(i=>{u2(n.get(i.currentIndex),i)})}static ngTemplateContextGuard(t,n){return!0}static \u0275fac=function(n){return new(n||s)(ue(Ba),ue(lc),ue(Fk))};static \u0275dir=Qt({type:s,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return s})();function u2(s,e){s.context.$implicit=e.item}let hD=(()=>{class s{_viewContainer;_context=new wte;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(t,n){this._viewContainer=t,this._thenTemplateRef=n}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){h2(t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){h2(t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(t,n){return!0}static \u0275fac=function(n){return new(n||s)(ue(Ba),ue(lc))};static \u0275dir=Qt({type:s,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return s})();class wte{$implicit=null;ngIf=null}function h2(s,e){if(s&&!s.createEmbeddedView)throw new R(2020,!1)}let f2=(()=>{class s{_ngEl;_differs;_renderer;_ngStyle=null;_differ=null;constructor(t,n,i){this._ngEl=t,this._differs=n,this._renderer=i}set ngStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}ngDoCheck(){if(this._differ){const t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_setStyle(t,n){const[i,r]=t.split("."),o=-1===i.indexOf("-")?void 0:Qc.DashCase;null!=n?this._renderer.setStyle(this._ngEl.nativeElement,i,r?`${n}${r}`:n,o):this._renderer.removeStyle(this._ngEl.nativeElement,i,o)}_applyChanges(t){t.forEachRemovedItem(n=>this._setStyle(n.key,null)),t.forEachAddedItem(n=>this._setStyle(n.key,n.currentValue)),t.forEachChangedItem(n=>this._setStyle(n.key,n.currentValue))}static \u0275fac=function(n){return new(n||s)(ue(Ho),ue(X_),ue(cc))};static \u0275dir=Qt({type:s,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}})}return s})(),p2=(()=>{class s{differs;constructor(t){this.differs=t}differ;keyValues=[];compareFn=g2;transform(t,n=g2){if(!t||!(t instanceof Map)&&"object"!=typeof t)return null;this.differ??=this.differs.find(t).create();const i=this.differ.diff(t),r=n!==this.compareFn;return i&&(this.keyValues=[],i.forEachItem(o=>{this.keyValues.push(function Wte(s,e){return{key:s,value:e}}(o.key,o.currentValue))})),(i||r)&&(n&&this.keyValues.sort(n),this.compareFn=n),this.keyValues}static \u0275fac=function(n){return new(n||s)(ue(X_,16))};static \u0275pipe=_o({name:"keyvalue",type:s,pure:!1})}return s})();function g2(s,e){const t=s.key,n=e.key;if(t===n)return 0;if(null==t)return 1;if(null==n)return-1;if("string"==typeof t&&"string"==typeof n)return t<n?-1:1;if("number"==typeof t&&"number"==typeof n)return t-n;if("boolean"==typeof t&&"boolean"==typeof n)return t<n?-1:1;const i=String(t),r=String(n);return i==r?0:i<r?-1:1}let m2=(()=>{class s{static \u0275fac=function(n){return new(n||s)};static \u0275mod=tg({type:s});static \u0275inj=Ko({})}return s})();typeof Symbol.dispose>"u"&&(Symbol.dispose=Symbol("Symbol.dispose")),typeof window<"u"&&("ResizeObserver"in globalThis||(globalThis.ResizeObserver=class qte{constructor(e){this._targets=new Set,this._callback=e,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}observe(e){this._targets.add(e)}unobserve(e){this._targets.delete(e)}disconnect(){this._targets.clear()}onWindowResize(){const e=[];for(const t of this._targets)e.push({target:t,contentRect:void 0,borderBoxSize:void 0,contentBoxSize:[],devicePixelContentBoxSize:[]});this._callback(e,this)}}),"IntersectionObserver"in globalThis||(globalThis.IntersectionObserver=class $te{constructor(e){this._elements=[];let t=null;const n=this.check.bind(this);this.check=()=>{t||(t=setTimeout(()=>{n(),t=null},100))},this._callback=e,window.addEventListener("resize",this.check,!0),document.addEventListener("scroll",this.check,!0)}observe(e){this._elements.indexOf(e)>=0||(this._elements.push(e),this.check())}unobserve(e){this._elements=this._elements.filter(t=>t!==e)}check(){const e=[];for(const t of this._elements){const n=t.getBoundingClientRect();n.top+n.height>=0&&n.top<=window.innerHeight&&n.left+n.width>=0&&n.left<=window.innerWidth&&e.push({target:t,isIntersecting:!0})}e.length&&this._callback(e,this)}}),"replaceChildren"in Element.prototype||(Element.prototype.replaceChildren=function(...s){this.innerHTML="",this.append(...s)},Document.prototype.replaceChildren=Element.prototype.replaceChildren,DocumentFragment.prototype.replaceChildren=Element.prototype.replaceChildren)),"replaceAll"in String.prototype||(String.prototype.replaceAll=function(s,e){return this.replace(new RegExp(s,"g"),e)});var fu=function(s){return s[s.Page=0]="Page",s[s.Horizontal=1]="Horizontal",s}(fu||{}),pu=function(s){return s[s.Default=0]="Default",s[s.ScoreTab=1]="ScoreTab",s[s.Score=2]="Score",s[s.Tab=3]="Tab",s[s.TabMixed=4]="TabMixed",s}(pu||{});class Va{static getValue(e){return Va._values||(Va._values=new Map),e=e.toLowerCase().replaceAll(" ",""),Va._values.has(e)?Va._values.get(e):0}static isPiano(e){return e<=7||e>=16&&e<=23}static isGuitar(e){return e>=24&&e<=39||105===e||43===e}}Va._values=new Map([["acousticgrandpiano",0],["brightacousticpiano",1],["electricgrandpiano",2],["honkytonkpiano",3],["electricpiano1",4],["electricpiano2",5],["harpsichord",6],["clavinet",7],["celesta",8],["glockenspiel",9],["musicbox",10],["vibraphone",11],["marimba",12],["xylophone",13],["tubularbells",14],["dulcimer",15],["drawbarorgan",16],["percussiveorgan",17],["rockorgan",18],["churchorgan",19],["reedorgan",20],["accordion",21],["harmonica",22],["tangoaccordion",23],["acousticguitarnylon",24],["acousticguitarsteel",25],["electricguitarjazz",26],["electricguitarclean",27],["electricguitarmuted",28],["overdrivenguitar",29],["distortionguitar",30],["guitarharmonics",31],["acousticbass",32],["electricbassfinger",33],["electricbasspick",34],["fretlessbass",35],["slapbass1",36],["slapbass2",37],["synthbass1",38],["synthbass2",39],["violin",40],["viola",41],["cello",42],["contrabass",43],["tremolostrings",44],["pizzicatostrings",45],["orchestralharp",46],["timpani",47],["stringensemble1",48],["stringensemble2",49],["synthstrings1",50],["synthstrings2",51],["choiraahs",52],["voiceoohs",53],["synthvoice",54],["orchestrahit",55],["trumpet",56],["trombone",57],["tuba",58],["mutedtrumpet",59],["frenchhorn",60],["brasssection",61],["synthbrass1",62],["synthbrass2",63],["sopranosax",64],["altosax",65],["tenorsax",66],["baritonesax",67],["oboe",68],["englishhorn",69],["bassoon",70],["clarinet",71],["piccolo",72],["flute",73],["recorder",74],["panflute",75],["blownbottle",76],["shakuhachi",77],["whistle",78],["ocarina",79],["lead1square",80],["lead2sawtooth",81],["lead3calliope",82],["lead4chiff",83],["lead5charang",84],["lead6voice",85],["lead7fifths",86],["lead8bassandlead",87],["pad1newage",88],["pad2warm",89],["pad3polysynth",90],["pad4choir",91],["pad5bowed",92],["pad6metallic",93],["pad7halo",94],["pad8sweep",95],["fx1rain",96],["fx2soundtrack",97],["fx3crystal",98],["fx4atmosphere",99],["fx5brightness",100],["fx6goblins",101],["fx7echoes",102],["fx8scifi",103],["sitar",104],["banjo",105],["shamisen",106],["koto",107],["kalimba",108],["bagpipe",109],["fiddle",110],["shanai",111],["tinklebell",112],["agogo",113],["steeldrums",114],["woodblock",115],["taikodrum",116],["melodictom",117],["synthdrum",118],["reversecymbal",119],["guitarfretnoise",120],["breathnoise",121],["seashore",122],["birdtweet",123],["telephonering",124],["helicopter",125],["applause",126],["gunshot",127]]);var Ha=function(s){return s[s.NoBrackets=0]="NoBrackets",s[s.GroupStaves=1]="GroupStaves",s[s.GroupSimilarInstruments=2]="GroupSimilarInstruments",s}(Ha||{}),rs=function(s){return s[s.Hidden=0]="Hidden",s[s.FirstSystem=1]="FirstSystem",s[s.AllSystems=2]="AllSystems",s}(rs||{}),Wi=function(s){return s[s.FullName=0]="FullName",s[s.ShortName=1]="ShortName",s}(Wi||{}),Gi=function(s){return s[s.Horizontal=0]="Horizontal",s[s.Vertical=1]="Vertical",s}(Gi||{});class y2{constructor(){this.hideDynamics=!1,this.bracketExtendMode=Ha.GroupStaves,this.useSystemSignSeparator=!1,this.globalDisplayTuning=!0,this.perTrackDisplayTuning=null,this.globalDisplayChordDiagramsOnTop=!0,this.perTrackChordDiagramsOnTop=null,this.singleTrackTrackNamePolicy=rs.FirstSystem,this.multiTrackTrackNamePolicy=rs.FirstSystem,this.firstSystemTrackNameMode=Wi.ShortName,this.otherSystemsTrackNameMode=Wi.ShortName,this.firstSystemTrackNameOrientation=Gi.Vertical,this.otherSystemsTrackNameOrientation=Gi.Vertical,this.multiTrackMultiBarRest=!1,this.perTrackMultiBarRest=null}}class mD{constructor(){this.masterBars=[],this.opening=null,this.closings=[],this.isClosed=!1}get openings(){const e=this.opening;return e?[e]:[]}get isOpened(){return!0===this.opening?.isRepeatStart}addMasterBar(e){null===this.opening&&(this.opening=e),this.masterBars.push(e),e.repeatGroup=this,e.isRepeatEnd&&(this.closings.push(e),this.isClosed=!0)}}class Eh{constructor(){this.colors=new Map}}var Et=function(s){return s[s.Neutral=0]="Neutral",s[s.C3=1]="C3",s[s.C4=2]="C4",s[s.F4=3]="F4",s[s.G2=4]="G2",s}(Et||{}),Ze=function(s){return s[s._15ma=0]="_15ma",s[s._8va=1]="_8va",s[s.Regular=2]="Regular",s[s._8vb=3]="_8vb",s[s._15mb=4]="_15mb",s}(Ze||{}),ws=function(s){return s[s.None=0]="None",s[s.Simple=1]="Simple",s[s.FirstOfDouble=2]="FirstOfDouble",s[s.SecondOfDouble=3]="SecondOfDouble",s}(ws||{}),wt=function(s){return s[s.Cb=-7]="Cb",s[s.Gb=-6]="Gb",s[s.Db=-5]="Db",s[s.Ab=-4]="Ab",s[s.Eb=-3]="Eb",s[s.Bb=-2]="Bb",s[s.F=-1]="F",s[s.C=0]="C",s[s.G=1]="G",s[s.D=2]="D",s[s.A=3]="A",s[s.E=4]="E",s[s.B=5]="B",s[s.FSharp=6]="FSharp",s[s.CSharp=7]="CSharp",s}(wt||{}),dr=function(s){return s[s.Major=0]="Major",s[s.Minor=1]="Minor",s}(dr||{}),Ms=function(s){return s[s.Down=0]="Down",s[s.Hold=1]="Hold",s[s.Up=2]="Up",s}(Ms||{});class gu{constructor(){this.ratioPosition=0,this.pedalType=Ms.Down,this.nextPedalMarker=null,this.previousPedalMarker=null}}var Ht=function(s){return s[s.StandardNotationRepeats=0]="StandardNotationRepeats",s[s.GuitarTabsRepeats=1]="GuitarTabsRepeats",s[s.SlashRepeats=2]="SlashRepeats",s[s.NumberedRepeats=3]="NumberedRepeats",s[s.StandardNotationBarNumber=4]="StandardNotationBarNumber",s[s.GuitarTabsBarNumber=5]="GuitarTabsBarNumber",s[s.SlashBarNumber=6]="SlashBarNumber",s[s.NumberedBarNumber=7]="NumberedBarNumber",s[s.StandardNotationBarLines=8]="StandardNotationBarLines",s[s.GuitarTabsBarLines=9]="GuitarTabsBarLines",s[s.SlashBarLines=10]="SlashBarLines",s[s.NumberedBarLines=11]="NumberedBarLines",s[s.StandardNotationClef=12]="StandardNotationClef",s[s.GuitarTabsClef=13]="GuitarTabsClef",s[s.StandardNotationKeySignature=14]="StandardNotationKeySignature",s[s.NumberedKeySignature=15]="NumberedKeySignature",s[s.StandardNotationTimeSignature=16]="StandardNotationTimeSignature",s[s.GuitarTabsTimeSignature=17]="GuitarTabsTimeSignature",s[s.SlashTimeSignature=18]="SlashTimeSignature",s[s.NumberedTimeSignature=19]="NumberedTimeSignature",s[s.StandardNotationStaffLine=20]="StandardNotationStaffLine",s[s.GuitarTabsStaffLine=21]="GuitarTabsStaffLine",s[s.SlashStaffLine=22]="SlashStaffLine",s[s.NumberedStaffLine=23]="NumberedStaffLine",s}(Ht||{});class _2 extends Eh{}var We=function(s){return s[s.Automatic=0]="Automatic",s[s.Dashed=1]="Dashed",s[s.Dotted=2]="Dotted",s[s.Heavy=3]="Heavy",s[s.HeavyHeavy=4]="HeavyHeavy",s[s.HeavyLight=5]="HeavyLight",s[s.LightHeavy=6]="LightHeavy",s[s.LightLight=7]="LightLight",s[s.None=8]="None",s[s.Regular=9]="Regular",s[s.Short=10]="Short",s[s.Tick=11]="Tick",s}(We||{});let Sl=(()=>{class s{constructor(){this.id=s._globalBarId++,this.index=0,this.nextBar=null,this.previousBar=null,this.clef=Et.G2,this.clefOttava=Ze.Regular,this.voices=[],this.simileMark=ws.None,this.isMultiVoice=!1,this.displayScale=1,this.displayWidth=-1,this.sustainPedals=[],this._isEmpty=!0,this._isRestOnly=!0,this.barLineLeft=We.Automatic,this.barLineRight=We.Automatic,this.keySignature=wt.C,this.keySignatureType=dr.Major}static resetIds(){s._globalBarId=0}get masterBar(){return this.staff.track.score.masterBars[this.index]}get isEmpty(){return this._isEmpty}get hasChanges(){return 0===this.index||this.keySignature!==this.previousBar.keySignature||this.keySignatureType!==this.previousBar.keySignatureType||this.clef!==this.previousBar.clef||this.clefOttava!==this.previousBar.clefOttava||this.simileMark!==ws.None||this.sustainPedals.length>0||this.barLineLeft!==We.Automatic||this.barLineRight!==We.Automatic}get isRestOnly(){return this._isRestOnly}getActualBarLineLeft(t){return s.actualBarLine(this,!1,t)}getActualBarLineRight(){return s.actualBarLine(this,!0,!1)}static automaticToActualType(t,n,i){let r;return r=n?t.isRepeatEnd?We.LightHeavy:t.nextMasterBar?t.isFreeTime?We.Dashed:t.isDoubleBar?We.LightLight:We.Regular:We.LightHeavy:t.isRepeatStart?We.HeavyLight:i?We.Regular:We.None,r}static actualBarLine(t,n,i){const o=n?t.barLineRight:t.barLineLeft;let a;return a=o===We.Automatic?s.automaticToActualType(t.masterBar,n,i):o,a}addVoice(t){t.bar=this,t.index=this.voices.length,this.voices.push(t)}finish(t,n=null){this.isMultiVoice=!1,this._isEmpty=!0,this._isRestOnly=!0;for(let r=0,o=this.voices.length;r<o;r++){const a=this.voices[r];a.finish(t,n),r>0&&!a.isEmpty&&(this.isMultiVoice=!0),a.isEmpty||(this._isEmpty=!1),a.isRestOnly||(this._isRestOnly=!1)}const i=this.sustainPedals;if(i.length>0){let r=null;this.sustainPedals=[],this.previousBar&&this.previousBar.sustainPedals.length>0&&(r=this.previousBar.sustainPedals[this.previousBar.sustainPedals.length-1]);const o=null!==r&&r.pedalType!==Ms.Up;for(const a of i){if(r&&r.pedalType!==Ms.Up){if(r.bar===this&&a.ratioPosition<=r.ratioPosition)continue;r.nextPedalMarker=a,a.previousPedalMarker=r}o&&a.pedalType===Ms.Down&&(a.pedalType=Ms.Hold),a.bar=this,this.sustainPedals.push(a),r=a}}else if(this.previousBar&&this.previousBar.sustainPedals.length>0){const r=this.previousBar.sustainPedals[this.previousBar.sustainPedals.length-1];if(r.pedalType!==Ms.Up){const o=new gu;o.ratioPosition=0,o.bar=this,o.pedalType=Ms.Hold,this.sustainPedals.push(o),r.nextPedalMarker=o,o.previousPedalMarker=r}}}calculateDuration(){let t=0;for(const n of this.voices){const i=n.calculateDuration();i>t&&(t=i)}return t}}return s._globalBarId=0,s})();var Te=function(s){return s[s.PPP=0]="PPP",s[s.PP=1]="PP",s[s.P=2]="P",s[s.MP=3]="MP",s[s.MF=4]="MF",s[s.F=5]="F",s[s.FF=6]="FF",s[s.FFF=7]="FFF",s[s.PPPP=8]="PPPP",s[s.PPPPP=9]="PPPPP",s[s.PPPPPP=10]="PPPPPP",s[s.FFFF=11]="FFFF",s[s.FFFFF=12]="FFFFF",s[s.FFFFFF=13]="FFFFFF",s[s.SF=14]="SF",s[s.SFP=15]="SFP",s[s.SFPP=16]="SFPP",s[s.FP=17]="FP",s[s.RF=18]="RF",s[s.RFZ=19]="RFZ",s[s.SFZ=20]="SFZ",s[s.SFFZ=21]="SFFZ",s[s.FZ=22]="FZ",s[s.N=23]="N",s[s.PF=24]="PF",s[s.SFZP=25]="SFZP",s}(Te||{});let G=(()=>{class s{static ticksToMillis(t,n){return t*(6e4/(n*s.QuarterTime))|0}static millisToTicks(t,n){return t/(6e4/(n*s.QuarterTime))|0}static toTicks(t){return s.valueToTicks(t)}static valueToTicks(t){let n=t;return n<0&&(n=1/-n),s.QuarterTime*(4/n)|0}static applyDot(t,n){return n?t+3*(t/4|0):t+(t/2|0)}static applyTuplet(t,n,i){return t*i/n|0}static removeTuplet(t,n,i){return t*n/i|0}static dynamicToVelocity(t,n=0){let i=1;switch(t){case Te.PPP:i=s.MinVelocity+0*s.VelocityIncrement;break;case Te.PP:i=s.MinVelocity+1*s.VelocityIncrement;break;case Te.P:i=s.MinVelocity+2*s.VelocityIncrement;break;case Te.MP:i=s.MinVelocity+3*s.VelocityIncrement;break;case Te.MF:i=s.MinVelocity+4*s.VelocityIncrement;break;case Te.F:i=s.MinVelocity+5*s.VelocityIncrement;break;case Te.FF:i=s.MinVelocity+6*s.VelocityIncrement;break;case Te.FFF:i=s.MinVelocity+7*s.VelocityIncrement;break;case Te.PPPP:i=10;break;case Te.PPPPP:i=5;break;case Te.PPPPPP:i=3;break;case Te.FFFF:i=s.MinVelocity+8*s.VelocityIncrement;break;case Te.FFFFF:i=s.MinVelocity+9*s.VelocityIncrement;break;case Te.FFFFFF:i=s.MinVelocity+10*s.VelocityIncrement;break;case Te.SF:case Te.SFP:case Te.SFZP:case Te.SFPP:case Te.SFZ:case Te.FZ:i=s.MinVelocity+6*s.VelocityIncrement;break;case Te.FP:case Te.RF:case Te.RFZ:case Te.SFFZ:i=s.MinVelocity+5*s.VelocityIncrement;break;case Te.N:i=1;break;case Te.PF:i=s.MinVelocity+(4.5*s.VelocityIncrement|0)}return i+=n*s.VelocityIncrement,Math.min(Math.max(i,1),127)}}return s.QuarterTime=960,s.MinVelocity=15,s.VelocityIncrement=16,s})();var $n=function(s){return s[s.Tempo=0]="Tempo",s[s.Volume=1]="Volume",s[s.Instrument=2]="Instrument",s[s.Balance=3]="Balance",s[s.SyncPoint=4]="SyncPoint",s}($n||{});class Vg{constructor(){this.barOccurence=0,this.millisecondOffset=0}}class fs{constructor(){this.isLinear=!1,this.type=$n.Tempo,this.value=0,this.ratioPosition=0,this.text=""}static buildTempoAutomation(e,t,n,i){(i<1||i>5)&&(i=2);const r=new Float32Array([1,.5,1,1.5,2,3]),o=new fs;return o.type=$n.Tempo,o.isLinear=e,o.ratioPosition=t,o.value=n*r[i],o}static buildInstrumentAutomation(e,t,n){const i=new fs;return i.type=$n.Instrument,i.isLinear=e,i.ratioPosition=t,i.value=n,i}}let se=(()=>{class s{constructor(t=0,n=0){this.offset=t,this.value=n}}return s.MaxPosition=60,s.MaxValue=12,s})();var Cn=function(s){return s[s.Default=0]="Default",s[s.Gradual=1]="Gradual",s[s.Fast=2]="Fast",s}(Cn||{}),me=function(s){return s[s.None=0]="None",s[s.Custom=1]="Custom",s[s.Bend=2]="Bend",s[s.Release=3]="Release",s[s.BendRelease=4]="BendRelease",s[s.Hold=5]="Hold",s[s.Prebend=6]="Prebend",s[s.PrebendBend=7]="PrebendBend",s[s.PrebendRelease=8]="PrebendRelease",s}(me||{}),fe=function(s){return s[s.None=0]="None",s[s.BrushUp=1]="BrushUp",s[s.BrushDown=2]="BrushDown",s[s.ArpeggioUp=3]="ArpeggioUp",s[s.ArpeggioDown=4]="ArpeggioDown",s}(fe||{}),Zi=function(s){return s[s.None=0]="None",s[s.Crescendo=1]="Crescendo",s[s.Decrescendo=2]="Decrescendo",s}(Zi||{}),w=function(s){return s[s.QuadrupleWhole=-4]="QuadrupleWhole",s[s.DoubleWhole=-2]="DoubleWhole",s[s.Whole=1]="Whole",s[s.Half=2]="Half",s[s.Quarter=4]="Quarter",s[s.Eighth=8]="Eighth",s[s.Sixteenth=16]="Sixteenth",s[s.ThirtySecond=32]="ThirtySecond",s[s.SixtyFourth=64]="SixtyFourth",s[s.OneHundredTwentyEighth=128]="OneHundredTwentyEighth",s[s.TwoHundredFiftySixth=256]="TwoHundredFiftySixth",s}(w||{}),Ee=function(s){return s[s.None=0]="None",s[s.OnBeat=1]="OnBeat",s[s.BeforeBeat=2]="BeforeBeat",s[s.BendGrace=3]="BendGrace",s}(Ee||{}),Ss=function(s){return s[s.None=0]="None",s[s.Normal=1]="Normal",s[s.Heavy=2]="Heavy",s[s.Tenuto=3]="Tenuto",s}(Ss||{}),Ne=function(s){return s[s.Unknown=-2]="Unknown",s[s.NoOrDead=-1]="NoOrDead",s[s.Thumb=0]="Thumb",s[s.IndexFinger=1]="IndexFinger",s[s.MiddleFinger=2]="MiddleFinger",s[s.AnnularFinger=3]="AnnularFinger",s[s.LittleFinger=4]="LittleFinger",s}(Ne||{}),Ie=function(s){return s[s.None=0]="None",s[s.Natural=1]="Natural",s[s.Artificial=2]="Artificial",s[s.Pinch=3]="Pinch",s[s.Tap=4]="Tap",s[s.Semi=5]="Semi",s[s.Feedback=6]="Feedback",s}(Ie||{}),mt=function(s){return s[s.Default=0]="Default",s[s.ForceNone=1]="ForceNone",s[s.ForceNatural=2]="ForceNatural",s[s.ForceSharp=3]="ForceSharp",s[s.ForceDoubleSharp=4]="ForceDoubleSharp",s[s.ForceFlat=5]="ForceFlat",s[s.ForceDoubleFlat=6]="ForceDoubleFlat",s}(mt||{}),ri=function(s){return s[s.None=0]="None",s[s.IntoFromBelow=1]="IntoFromBelow",s[s.IntoFromAbove=2]="IntoFromAbove",s}(ri||{}),Qe=function(s){return s[s.None=0]="None",s[s.Shift=1]="Shift",s[s.Legato=2]="Legato",s[s.OutUp=3]="OutUp",s[s.OutDown=4]="OutDown",s[s.PickSlideDown=5]="PickSlideDown",s[s.PickSlideUp=6]="PickSlideUp",s}(Qe||{}),Ft=function(s){return s[s.None=0]="None",s[s.Slight=1]="Slight",s[s.Wide=2]="Wide",s}(Ft||{}),Wa=function(s){return s[s.Hidden=0]="Hidden",s[s.ShowWithBeams=1]="ShowWithBeams",s[s.ShowWithBars=2]="ShowWithBars",s[s.Automatic=3]="Automatic",s}(Wa||{}),vl=function(s){return s[s.ScoreDefault=0]="ScoreDefault",s[s.ScoreForcePiano=1]="ScoreForcePiano",s[s.SingleNoteEffectBand=2]="SingleNoteEffectBand",s[s.SingleNoteEffectBandForcePiano=3]="SingleNoteEffectBandForcePiano",s}(vl||{}),xi=function(s){return s[s.GuitarPro=0]="GuitarPro",s[s.SongBook=1]="SongBook",s}(xi||{}),dt=function(s){return s[s.ScoreTitle=0]="ScoreTitle",s[s.ScoreSubTitle=1]="ScoreSubTitle",s[s.ScoreArtist=2]="ScoreArtist",s[s.ScoreAlbum=3]="ScoreAlbum",s[s.ScoreWords=4]="ScoreWords",s[s.ScoreMusic=5]="ScoreMusic",s[s.ScoreWordsAndMusic=6]="ScoreWordsAndMusic",s[s.ScoreCopyright=7]="ScoreCopyright",s[s.GuitarTuning=8]="GuitarTuning",s[s.TrackNames=9]="TrackNames",s[s.ChordDiagrams=10]="ChordDiagrams",s[s.ParenthesisOnTiedBends=11]="ParenthesisOnTiedBends",s[s.TabNotesOnTiedBends=12]="TabNotesOnTiedBends",s[s.ZerosOnDiveWhammys=13]="ZerosOnDiveWhammys",s[s.EffectAlternateEndings=14]="EffectAlternateEndings",s[s.EffectCapo=15]="EffectCapo",s[s.EffectChordNames=16]="EffectChordNames",s[s.EffectCrescendo=17]="EffectCrescendo",s[s.EffectDynamics=18]="EffectDynamics",s[s.EffectFadeIn=19]="EffectFadeIn",s[s.EffectFermata=20]="EffectFermata",s[s.EffectFingering=21]="EffectFingering",s[s.EffectHarmonics=22]="EffectHarmonics",s[s.EffectLetRing=23]="EffectLetRing",s[s.EffectLyrics=24]="EffectLyrics",s[s.EffectMarker=25]="EffectMarker",s[s.EffectOttavia=26]="EffectOttavia",s[s.EffectPalmMute=27]="EffectPalmMute",s[s.EffectPickSlide=28]="EffectPickSlide",s[s.EffectPickStroke=29]="EffectPickStroke",s[s.EffectSlightBeatVibrato=30]="EffectSlightBeatVibrato",s[s.EffectSlightNoteVibrato=31]="EffectSlightNoteVibrato",s[s.EffectTap=32]="EffectTap",s[s.EffectTempo=33]="EffectTempo",s[s.EffectText=34]="EffectText",s[s.EffectTrill=35]="EffectTrill",s[s.EffectTripletFeel=36]="EffectTripletFeel",s[s.EffectWhammyBar=37]="EffectWhammyBar",s[s.EffectWideBeatVibrato=38]="EffectWideBeatVibrato",s[s.EffectWideNoteVibrato=39]="EffectWideNoteVibrato",s[s.EffectLeftHandTap=40]="EffectLeftHandTap",s[s.EffectFreeTime=41]="EffectFreeTime",s[s.EffectSustainPedal=42]="EffectSustainPedal",s[s.EffectGolpe=43]="EffectGolpe",s[s.EffectWahPedal=44]="EffectWahPedal",s[s.EffectBeatBarre=45]="EffectBeatBarre",s[s.EffectNoteOrnament=46]="EffectNoteOrnament",s[s.EffectRasgueado=47]="EffectRasgueado",s[s.EffectDirections=48]="EffectDirections",s[s.EffectBeatTimer=49]="EffectBeatTimer",s}(dt||{});class Hg{constructor(){this.notationMode=xi.GuitarPro,this.fingeringMode=vl.ScoreDefault,this.elements=new Map,this.rhythmMode=Wa.Automatic,this.rhythmHeight=15,this.transpositionPitches=[],this.displayTranspositionPitches=[],this.smallGraceTabNotes=!0,this.extendBendArrowsOnTiedNotes=!0,this.extendLineEffectsToBeatEnd=!1,this.slurHeight=5}isNotationElementVisible(e){return this.elements.has(e)?this.elements.get(e):!Hg.defaultElements.has(e)||Hg.defaultElements.get(e)}}Hg.defaultElements=new Map([[dt.ZerosOnDiveWhammys,!1]]);class Wg{constructor(e){this._value=void 0,this._factory=e}get value(){return void 0===this._value&&(this._value=this._factory()),this._value}}var Tl=function(s){return s[s.None=0]="None",s[s.Debug=1]="Debug",s[s.Info=2]="Info",s[s.Warning=3]="Warning",s[s.Error=4]="Error",s}(Tl||{});class Ih{static format(e,t){return`[AlphaTab][${e}] ${t}`}debug(e,t,...n){console.debug(Ih.format(e,t),...n)}warning(e,t,...n){console.warn(Ih.format(e,t),...n)}info(e,t,...n){console.info(Ih.format(e,t),...n)}error(e,t,...n){console.error(Ih.format(e,t),...n)}}Ih.logLevel=Tl.Info;class F{static shouldLog(e){return F.logLevel!==Tl.None&&e>=F.logLevel}static debug(e,t,...n){F.shouldLog(Tl.Debug)&&F.log.debug(e,t,...n)}static warning(e,t,...n){F.shouldLog(Tl.Warning)&&F.log.warning(e,t,...n)}static info(e,t,...n){F.shouldLog(Tl.Info)&&F.log.info(e,t,...n)}static error(e,t,...n){F.shouldLog(Tl.Error)&&F.log.error(e,t,...n)}}F.logLevel=Tl.Info,F.log=new Ih;var nt=function(s){return s[s.NoTripletFeel=0]="NoTripletFeel",s[s.Triplet16th=1]="Triplet16th",s[s.Triplet8th=2]="Triplet8th",s[s.Dotted16th=3]="Dotted16th",s[s.Dotted8th=4]="Dotted8th",s[s.Scottish16th=5]="Scottish16th",s[s.Scottish8th=6]="Scottish8th",s}(nt||{});let kl=(()=>{class s{constructor(){this.alternateEndings=0,this.nextMasterBar=null,this.previousMasterBar=null,this.index=0,this.isDoubleBar=!1,this.isRepeatStart=!1,this.repeatCount=0,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.timeSignatureCommon=!1,this.isFreeTime=!1,this.tripletFeel=nt.NoTripletFeel,this.section=null,this.tempoAutomations=[],this.fermata=null,this.start=0,this.isAnacrusis=!1,this.displayScale=1,this.displayWidth=-1,this.directions=null}get hasChanges(){return 0!==this.index&&(this.timeSignatureCommon!==this.previousMasterBar.timeSignatureCommon||this.timeSignatureNumerator!==this.previousMasterBar.timeSignatureNumerator||this.timeSignatureDenominator!==this.previousMasterBar.timeSignatureDenominator||this.tripletFeel!==this.previousMasterBar.tripletFeel||0!==this.alternateEndings||this.isRepeatStart||this.isRepeatEnd||this.isFreeTime||this.isSectionStart||this.tempoAutomations.length>0||this.syncPoints&&this.syncPoints.length>0||null!==this.fermata&&this.fermata.size>0||null!==this.directions&&this.directions.size>0||this.isAnacrusis)}get keySignature(){return this.score.tracks[0].staves[0].bars[this.index].keySignature}set keySignature(t){this.score.tracks[0].staves[0].bars[this.index].keySignature=t}get keySignatureType(){return this.score.tracks[0].staves[0].bars[this.index].keySignatureType}set keySignatureType(t){this.score.tracks[0].staves[0].bars[this.index].keySignatureType=t}get isRepeatEnd(){return this.repeatCount>0}get isSectionStart(){return!!this.section}get tempoAutomation(){return this.tempoAutomations.length>0?this.tempoAutomations[0]:null}calculateDuration(t=!0){if(this.isAnacrusis&&t){let n=0;for(const i of this.score.tracks)for(const r of i.staves){const o=this.index<r.bars.length?r.bars[this.index].calculateDuration():0;o>n&&(n=o)}return n}return this.timeSignatureNumerator*G.valueToTicks(this.timeSignatureDenominator)}addFermata(t,n){let i=this.fermata;null===i&&(i=new Map,this.fermata=i),i.set(t,n)}addDirection(t){null==this.directions&&(this.directions=new Set),this.directions.add(t)}getFermata(t){const n=this.fermata;return null===n?null:n.has(t.playbackStart)?n.get(t.playbackStart):null}addSyncPoint(t){this.syncPoints||(this.syncPoints=[]),this.syncPoints.push(t)}}return s.MaxAlternateEndings=8,s})();class xe{}xe.DefaultChannelCount=17,xe.MetronomeChannel=xe.DefaultChannelCount-1,xe.MetronomeKey=33,xe.AudioChannels=2,xe.MinVolume=0,xe.MinProgram=0,xe.MaxProgram=127,xe.MinPlaybackSpeed=.125,xe.MaxPlaybackSpeed=8,xe.PercussionChannel=9,xe.PercussionBank=128,xe.MaxPitchWheel=16384,xe.MaxPitchWheel20=4294967296,xe.DefaultPitchWheel=xe.MaxPitchWheel/2,xe.MicroBufferCount=32,xe.MicroBufferSize=64;class ew{constructor(){this.beats=[],this.id="empty",this.isComplete=!1}addBeat(e){e.graceIndex=this.beats.length,e.graceGroup=this,this.beats.push(e)}finish(){this.beats.length>0&&(this.id=`${this.beats[0].absoluteDisplayStart}_${this.beats[0].voice.index}`)}}var Gg=function(s){return s[s.Glyphs=0]="Glyphs",s}(Gg||{});class b2 extends Eh{}let ko=(()=>{let s=class vN{constructor(){this._isEmpty=!0,this._isRestOnly=!0,this.id=vN._globalVoiceId++,this.index=0,this.beats=[]}static resetIds(){vN._globalVoiceId=0}get isEmpty(){return this._isEmpty}forceNonEmpty(){this._isEmpty=!1}get isRestOnly(){return this._isRestOnly}insertBeat(t,n){n.nextBeat=t.nextBeat,n.nextBeat&&(n.nextBeat.previousBeat=n),n.previousBeat=t,n.voice=this,t.nextBeat=n,this.beats.splice(t.index+1,0,n)}addBeat(t){t.voice=this,t.index=this.beats.length,this.beats.push(t),t.isEmpty||(this._isEmpty=!1),t.isRest||(this._isRestOnly=!1)}chain(t,n=null){if(this.bar){if(t.index<this.beats.length-1)t.nextBeat=this.beats[t.index+1],t.nextBeat.previousBeat=t;else if(t.isLastOfVoice&&t.voice.bar.nextBar){const i=this.bar.nextBar.voices[this.index];i.beats.length>0&&(t.nextBeat=i.beats[0]),t.nextBeat.previousBeat=t}t.chain(n)}}addGraceBeat(t){if(0===this.beats.length)return void this.addBeat(t);const n=this.beats[this.beats.length-1];this.beats.splice(this.beats.length-1,1),this.addBeat(t),this.addBeat(n),this._isEmpty=!1,this._isRestOnly=!1}getBeatAtPlaybackStart(t){return this._beatLookup.has(t)?this._beatLookup.get(t):null}finish(t,n=null){this._isEmpty=!0,this._isRestOnly=!0,this._beatLookup=new Map;let i=null;for(let a=0;a<this.beats.length;a++){const l=this.beats[a];l.index=a,this.chain(l,n),l.graceType===Ee.None?(l.graceGroup=i,i&&(i.isComplete=!0),i=null):(i||(i=new ew),i.addBeat(l)),l.isEmpty||(this._isEmpty=!1),l.isRest||(this._isRestOnly=!1)}let r=0,o=0;for(let a=0;a<this.beats.length;a++){const l=this.beats[a];if(l.index=a,l.finish(t,n),l.graceType===Ee.None){if(l.graceGroup){const c=l.graceGroup.beats[0],u=l.graceGroup.beats[l.graceGroup.beats.length-1];if(c.graceType!==Ee.BendGrace){const h=u.playbackStart+u.playbackDuration-c.playbackStart;switch(c.graceType){case Ee.BeforeBeat:c.previousBeat?(c.previousBeat.playbackDuration-=h,o=c.previousBeat.voice===this?c.previousBeat.playbackStart+c.previousBeat.playbackDuration:-h):o=-h;for(const d of l.graceGroup.beats)this._beatLookup.delete(d.playbackStart),d.playbackStart=o,this._beatLookup.set(d.playbackStart,l),o+=d.playbackDuration;break;case Ee.OnBeat:l.playbackDuration-=h,o=u.voice===this?u.playbackStart+u.playbackDuration:-h}}}l.displayStart=r,l.playbackStart=o,l.fermata?this.bar.masterBar.addFermata(l.playbackStart,l.fermata):l.fermata=this.bar.masterBar.getFermata(l),this._beatLookup.set(l.playbackStart,l)}else l.displayStart=r,l.playbackStart=o;l.finishTuplet(),l.graceGroup&&l.graceGroup.finish(),r+=l.displayDuration,o+=l.playbackDuration}}calculateDuration(){if(this.isEmpty||0===this.beats.length)return 0;const t=this.beats[this.beats.length-1];return t.playbackStart+t.playbackDuration-this.beats[0].playbackStart}};return s._globalVoiceId=0,s})();class jte{constructor(){this.note=null,this.tone=new w2,this.octave=0}get realValue(){return 12*this.octave+this.tone.noteValue}}class w2{constructor(e=0,t=mt.Default){this.noteValue=e,this.accidentalMode=t}}class ie{static getIndex(e){return e<0?0:0|Math.log2(e)}static keySignatureIsFlat(e){return e<0}static keySignatureIsNatural(e){return 0===e}static keySignatureIsSharp(e){return e>0}static applyPitchOffsets(e,t){for(let n=0;n<t.tracks.length;n++){if(n<e.notation.displayTranspositionPitches.length)for(const i of t.tracks[n].staves)i.displayTranspositionPitch=-e.notation.displayTranspositionPitches[n];if(n<e.notation.transpositionPitches.length)for(const i of t.tracks[n].staves)i.transpositionPitch=-e.notation.transpositionPitches[n]}}static fingerToString(e,t,n,i){if(e.notation.fingeringMode===vl.ScoreForcePiano||e.notation.fingeringMode===vl.SingleNoteEffectBandForcePiano||Va.isPiano(t.voice.bar.staff.track.playbackInfo.program))switch(n){case Ne.Unknown:case Ne.NoOrDead:return null;case Ne.Thumb:return"1";case Ne.IndexFinger:return"2";case Ne.MiddleFinger:return"3";case Ne.AnnularFinger:return"4";case Ne.LittleFinger:return"5";default:return null}if(i)switch(n){case Ne.Unknown:return null;case Ne.NoOrDead:return"0";case Ne.Thumb:return"t";case Ne.IndexFinger:return"1";case Ne.MiddleFinger:return"2";case Ne.AnnularFinger:return"3";case Ne.LittleFinger:return"4";default:return null}switch(n){case Ne.Unknown:case Ne.NoOrDead:return null;case Ne.Thumb:return"p";case Ne.IndexFinger:return"i";case Ne.MiddleFinger:return"m";case Ne.AnnularFinger:return"a";case Ne.LittleFinger:return"c";default:return null}}static isTuning(e){return!!ie.parseTuning(e)}static parseTuning(e){let t="",n="";for(let r=0;r<e.length;r++){const o=e.charCodeAt(r);if(o>=48&&o<=57){if(!t)return null;n+=String.fromCharCode(o)}else{if(!ie.TuningLetters.has(o))return null;t+=String.fromCharCode(o)}}if(!n||!t)return null;const i=new jte;return i.octave=Number.parseInt(n)+1,i.note=t.toLowerCase(),i.tone=ie.getToneForText(i.note),i.tone.noteValue<0&&(i.octave--,i.tone.noteValue+=12),i}static getTuningForText(e){const t=ie.parseTuning(e);return t?t.realValue:-1}static getToneForText(e){const t=e.substring(0,1),n=e.substring(1);let i,r;switch(t.toLowerCase()){case"c":default:i=0;break;case"d":i=2;break;case"e":i=4;break;case"f":i=5;break;case"g":i=7;break;case"a":i=9;break;case"b":i=11}switch(r=ie.parseAccidentalMode(n),r){case mt.Default:case mt.ForceNone:case mt.ForceNatural:break;case mt.ForceSharp:i++;break;case mt.ForceDoubleSharp:i+=2;break;case mt.ForceFlat:i--;break;case mt.ForceDoubleFlat:i-=2}return new w2(i,r)}static parseAccidentalMode(e){const t=e.toLowerCase();return ie.accidentalModeMapping.has(t)?ie.accidentalModeMapping.get(t):mt.Default}static newGuid(){return`${Math.floor(65536*(1+Math.random())).toString(16).substring(1)+Math.floor(65536*(1+Math.random())).toString(16).substring(1)}-${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}-${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}-${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}-${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}${Math.floor(65536*(1+Math.random())).toString(16).substring(1)}`}static isAlmostEqualTo(e,t){return Math.abs(e-t)<1e-5}static toHexString(e,t=0){let n="";do{n=String.fromCharCode("0123456789ABCDEF".charCodeAt(15&e))+n,e>>=4}while(e>0);for(;n.length<t;)n=`0${n}`;return n}static getAlternateEndingsList(e){const t=[];for(let n=0;n<kl.MaxAlternateEndings;n++)e&1<<n&&t.push(n);return t}static deltaFretToHarmonicValue(e){switch(e){case 2:return 2.4;case 3:return 3.2;case 4:case 5:case 7:case 9:case 12:case 16:case 17:case 19:case 24:return e;case 8:return 8.2;case 10:return 9.6;case 14:case 15:return 14.7;case 21:case 22:return 21.7;default:return 12}}static clamp(e,t,n){return e<=t?t:e>=n?n:e}static buildMultiBarRestInfo(e,t,n){if(!e)return null;const i=e[0].score.stylesheet;if(!(e.length>1?i.multiTrackMultiBarRest:!0===i.perTrackMultiBarRest?.has(e[0].index)))return null;const o=new Map,a=e[0].score;let l=t,c=a.tempo;for(;l<=n;){const u=l;let h=null;for(;l<=n;){const d=a.masterBars[l];let p=!1;for(const m of d.tempoAutomations)m.value!==c&&(p=!0),c=m.value;if(d.alternateEndings||d.isRepeatStart&&d.index!==u||d.isFreeTime||d.isAnacrusis||null!==d.section||d.index!==u&&p||null!==d.fermata&&d.fermata.size>0||null!==d.directions&&d.directions.size>0||u>t&&d.previousMasterBar&&(d.timeSignatureCommon!==d.previousMasterBar.timeSignatureCommon||d.timeSignatureNumerator!==d.previousMasterBar.timeSignatureNumerator||d.timeSignatureDenominator!==d.previousMasterBar.timeSignatureDenominator||d.tripletFeel!==d.previousMasterBar.tripletFeel))break;let g=!0;for(const m of e){for(const _ of m.staves){const y=_.bars[d.index];if(!y.isRestOnly){g=!1;break}if(y.index>0&&(y.keySignature!==y.previousBar.keySignature||y.keySignatureType!==y.previousBar.keySignatureType)){g=!1;break}}if(!g)break}if(!g||(l++,d.index>u&&(null===h?h=[d.index]:h.push(d.index)),d.isRepeatEnd))break}h?o.set(u,h):l++}return o}static computeFirstDisplayedBarIndex(e,t){let n=t.display.startBar;return n--,n=Math.min(e.masterBars.length-1,Math.max(0,n)),n}static computeLastDisplayedBarIndex(e,t,n){let i=t.display.barCount;return i<0&&(i=e.masterBars.length),i=n+i-1,i=Math.min(e.masterBars.length-1,Math.max(0,i)),i}static getOrCreateHeaderFooterStyle(e,t){let i,n=e.style;if(e.style||(n=new Bh,e.style=n),n.headerAndFooter.has(t))i=n.headerAndFooter.get(t);else{if(i=new zo,Bh.defaultHeaderAndFooter.has(t)){const r=Bh.defaultHeaderAndFooter.get(t);i.template=r.template,i.textAlign=r.textAlign}n.headerAndFooter.set(t,i)}return i}static consolidate(e){if(0===e.masterBars.length){const n=new kl;e.addMasterBar(n);const i=new fs;i.isLinear=!1,i.type=$n.Tempo,i.value=e.tempo,n.tempoAutomations.push(i);const r=new Sl;e.tracks[0].staves[0].addBar(r);const o=new ko;r.addVoice(o);const a=new Ei;return a.isEmpty=!0,void o.addBeat(a)}const t=new Set([xe.PercussionChannel]);for(const n of e.tracks){if(1===n.staves.length&&n.staves[0].isPercussion)n.playbackInfo.primaryChannel=xe.PercussionChannel,n.playbackInfo.secondaryChannel=xe.PercussionChannel;else{if(n.playbackInfo.primaryChannel!==xe.PercussionChannel)for(;t.has(n.playbackInfo.primaryChannel);)n.playbackInfo.primaryChannel++;if(t.add(n.playbackInfo.primaryChannel),n.playbackInfo.secondaryChannel!==xe.PercussionChannel)for(;t.has(n.playbackInfo.secondaryChannel);)n.playbackInfo.secondaryChannel++;t.add(n.playbackInfo.secondaryChannel)}for(const i of n.staves){for(const o of i.bars)for(const a of o.voices)if(a.isEmpty&&0===a.beats.length){const l=new Ei;l.isEmpty=!0,a.addBeat(l)}const r=0===i.bars.length?1:i.bars[0].voices.length;for(;i.bars.length<e.masterBars.length;){const o=new Sl;i.addBar(o);const a=o.previousBar;a&&(o.clef=a.clef,o.clefOttava=a.clefOttava,o.keySignature=o.previousBar.keySignature,o.keySignatureType=o.previousBar.keySignatureType);for(let l=0;l<r;l++){const c=new ko;o.addVoice(c);const u=new Ei;u.isEmpty=!0,c.addBeat(u)}}}}}static trimEmptyBarsAtEnd(e){for(;e.masterBars.length>1;){const t=e.masterBars.length-1,n=e.masterBars[t];if(n.hasChanges)return;for(const i of e.tracks)for(const r of i.staves)if(t<r.bars.length){const o=r.bars[t];if(!o.isEmpty||o.hasChanges)return}for(const i of e.tracks)for(const r of i.staves)if(t<r.bars.length){const o=r.bars[t];r.bars.pop(),o.previousBar.nextBar=null}e.masterBars.pop(),n.previousMasterBar.nextMasterBar=null}}}ie.TuningLetters=new Set([67,68,69,70,71,65,66,99,100,101,102,103,97,98,35]),ie.accidentalModeMapping=new Map([["default",mt.Default],["d",mt.Default],["forcenone",mt.ForceNone],["-",mt.ForceNone],["forcenatural",mt.ForceNatural],["n",mt.ForceNatural],["forcesharp",mt.ForceSharp],["#",mt.ForceSharp],["forcedoublesharp",mt.ForceDoubleSharp],["##",mt.ForceDoubleSharp],["x",mt.ForceDoubleSharp],["forceflat",mt.ForceFlat],["b",mt.ForceFlat],["forcedoubleflat",mt.ForceDoubleFlat],["bb",mt.ForceDoubleFlat]]);var yi=function(s){return s[s.None=0]="None",s[s.Up=1]="Up",s[s.Down=2]="Down",s}(yi||{}),f=function(s){return s[s.None=-1]="None",s[s.Space=32]="Space",s[s.Brace=57344]="Brace",s[s.BracketTop=57347]="BracketTop",s[s.BracketBottom=57348]="BracketBottom",s[s.SystemDivider=57351]="SystemDivider",s[s.GClef=57424]="GClef",s[s.CClef=57436]="CClef",s[s.FClef=57442]="FClef",s[s.UnpitchedPercussionClef1=57449]="UnpitchedPercussionClef1",s[s.SixStringTabClef=57453]="SixStringTabClef",s[s.FourStringTabClef=57454]="FourStringTabClef",s[s.TimeSig0=57472]="TimeSig0",s[s.TimeSig1=57473]="TimeSig1",s[s.TimeSig2=57474]="TimeSig2",s[s.TimeSig3=57475]="TimeSig3",s[s.TimeSig4=57476]="TimeSig4",s[s.TimeSig5=57477]="TimeSig5",s[s.TimeSig6=57478]="TimeSig6",s[s.TimeSig7=57479]="TimeSig7",s[s.TimeSig8=57480]="TimeSig8",s[s.TimeSig9=57481]="TimeSig9",s[s.TimeSigCommon=57482]="TimeSigCommon",s[s.TimeSigCutCommon=57483]="TimeSigCutCommon",s[s.NoteheadDoubleWholeSquare=57505]="NoteheadDoubleWholeSquare",s[s.NoteheadDoubleWhole=57504]="NoteheadDoubleWhole",s[s.NoteheadWhole=57506]="NoteheadWhole",s[s.NoteheadHalf=57507]="NoteheadHalf",s[s.NoteheadBlack=57508]="NoteheadBlack",s[s.NoteheadNull=57509]="NoteheadNull",s[s.NoteheadXOrnate=57514]="NoteheadXOrnate",s[s.NoteheadPlusDoubleWhole=57516]="NoteheadPlusDoubleWhole",s[s.NoteheadPlusWhole=57517]="NoteheadPlusWhole",s[s.NoteheadPlusHalf=57518]="NoteheadPlusHalf",s[s.NoteheadPlusBlack=57519]="NoteheadPlusBlack",s[s.NoteheadSquareWhite=57528]="NoteheadSquareWhite",s[s.NoteheadSquareBlack=57529]="NoteheadSquareBlack",s[s.NoteheadTriangleUpDoubleWhole=57530]="NoteheadTriangleUpDoubleWhole",s[s.NoteheadTriangleUpWhole=57531]="NoteheadTriangleUpWhole",s[s.NoteheadTriangleUpHalf=57532]="NoteheadTriangleUpHalf",s[s.NoteheadTriangleUpBlack=57534]="NoteheadTriangleUpBlack",s[s.NoteheadTriangleRightWhite=57537]="NoteheadTriangleRightWhite",s[s.NoteheadTriangleRightBlack=57538]="NoteheadTriangleRightBlack",s[s.NoteheadTriangleDownDoubleWhole=57548]="NoteheadTriangleDownDoubleWhole",s[s.NoteheadTriangleDownWhole=57540]="NoteheadTriangleDownWhole",s[s.NoteheadTriangleDownHalf=57541]="NoteheadTriangleDownHalf",s[s.NoteheadTriangleDownBlack=57543]="NoteheadTriangleDownBlack",s[s.NoteheadDiamondDoubleWhole=57559]="NoteheadDiamondDoubleWhole",s[s.NoteheadDiamondWhole=57560]="NoteheadDiamondWhole",s[s.NoteheadDiamondHalf=57561]="NoteheadDiamondHalf",s[s.NoteheadDiamondBlack=57563]="NoteheadDiamondBlack",s[s.NoteheadDiamondBlackWide=57564]="NoteheadDiamondBlackWide",s[s.NoteheadDiamondWhite=57565]="NoteheadDiamondWhite",s[s.NoteheadDiamondWhiteWide=57566]="NoteheadDiamondWhiteWide",s[s.NoteheadCircleXDoubleWhole=57520]="NoteheadCircleXDoubleWhole",s[s.NoteheadCircleXWhole=57521]="NoteheadCircleXWhole",s[s.NoteheadCircleXHalf=57522]="NoteheadCircleXHalf",s[s.NoteheadCircleX=57523]="NoteheadCircleX",s[s.NoteheadXDoubleWhole=57510]="NoteheadXDoubleWhole",s[s.NoteheadXWhole=57511]="NoteheadXWhole",s[s.NoteheadXHalf=57512]="NoteheadXHalf",s[s.NoteheadXBlack=57513]="NoteheadXBlack",s[s.NoteheadParenthesis=57550]="NoteheadParenthesis",s[s.NoteheadSlashedBlack1=57551]="NoteheadSlashedBlack1",s[s.NoteheadSlashedBlack2=57552]="NoteheadSlashedBlack2",s[s.NoteheadSlashedHalf1=57553]="NoteheadSlashedHalf1",s[s.NoteheadSlashedHalf2=57554]="NoteheadSlashedHalf2",s[s.NoteheadSlashedWhole1=57555]="NoteheadSlashedWhole1",s[s.NoteheadSlashedWhole2=57556]="NoteheadSlashedWhole2",s[s.NoteheadSlashedDoubleWhole1=57557]="NoteheadSlashedDoubleWhole1",s[s.NoteheadSlashedDoubleWhole2=57558]="NoteheadSlashedDoubleWhole2",s[s.NoteheadCircledBlack=57572]="NoteheadCircledBlack",s[s.NoteheadCircledHalf=57573]="NoteheadCircledHalf",s[s.NoteheadCircledWhole=57574]="NoteheadCircledWhole",s[s.NoteheadCircledDoubleWhole=57575]="NoteheadCircledDoubleWhole",s[s.NoteheadCircleSlash=57591]="NoteheadCircleSlash",s[s.NoteheadHeavyX=57592]="NoteheadHeavyX",s[s.NoteheadHeavyXHat=57593]="NoteheadHeavyXHat",s[s.NoteheadSlashVerticalEnds=57600]="NoteheadSlashVerticalEnds",s[s.NoteheadSlashWhiteWhole=57602]="NoteheadSlashWhiteWhole",s[s.NoteheadSlashWhiteHalf=57603]="NoteheadSlashWhiteHalf",s[s.NoteheadRoundWhiteWithDot=57621]="NoteheadRoundWhiteWithDot",s[s.NoteheadSquareBlackLarge=57626]="NoteheadSquareBlackLarge",s[s.NoteheadSquareBlackWhite=57627]="NoteheadSquareBlackWhite",s[s.NoteheadClusterDoubleWhole3rd=57640]="NoteheadClusterDoubleWhole3rd",s[s.NoteheadClusterWhole3rd=57641]="NoteheadClusterWhole3rd",s[s.NoteheadClusterHalf3rd=57642]="NoteheadClusterHalf3rd",s[s.NoteheadClusterQuarter3rd=57643]="NoteheadClusterQuarter3rd",s[s.NoteShapeRoundWhite=57776]="NoteShapeRoundWhite",s[s.NoteShapeRoundBlack=57777]="NoteShapeRoundBlack",s[s.NoteShapeSquareWhite=57778]="NoteShapeSquareWhite",s[s.NoteShapeSquareBlack=57779]="NoteShapeSquareBlack",s[s.NoteShapeTriangleRightWhite=57780]="NoteShapeTriangleRightWhite",s[s.NoteShapeTriangleRightBlack=57781]="NoteShapeTriangleRightBlack",s[s.NoteShapeTriangleLeftWhite=57782]="NoteShapeTriangleLeftWhite",s[s.NoteShapeTriangleLeftBlack=57783]="NoteShapeTriangleLeftBlack",s[s.NoteShapeDiamondWhite=57784]="NoteShapeDiamondWhite",s[s.NoteShapeDiamondBlack=57785]="NoteShapeDiamondBlack",s[s.NoteShapeTriangleUpWhite=57786]="NoteShapeTriangleUpWhite",s[s.NoteShapeTriangleUpBlack=57787]="NoteShapeTriangleUpBlack",s[s.NoteShapeMoonWhite=57788]="NoteShapeMoonWhite",s[s.NoteShapeMoonBlack=57789]="NoteShapeMoonBlack",s[s.NoteShapeTriangleRoundWhite=57790]="NoteShapeTriangleRoundWhite",s[s.NoteShapeTriangleRoundBlack=57791]="NoteShapeTriangleRoundBlack",s[s.NoteQuarterUp=57813]="NoteQuarterUp",s[s.NoteEighthUp=57815]="NoteEighthUp",s[s.TextBlackNoteLongStem=57841]="TextBlackNoteLongStem",s[s.TextBlackNoteFrac8thLongStem=57843]="TextBlackNoteFrac8thLongStem",s[s.TextBlackNoteFrac16thLongStem=57845]="TextBlackNoteFrac16thLongStem",s[s.TextBlackNoteFrac32ndLongStem=57846]="TextBlackNoteFrac32ndLongStem",s[s.TextCont8thBeamLongStem=57848]="TextCont8thBeamLongStem",s[s.TextCont16thBeamLongStem=57850]="TextCont16thBeamLongStem",s[s.TextCont32ndBeamLongStem=57851]="TextCont32ndBeamLongStem",s[s.TextAugmentationDot=57852]="TextAugmentationDot",s[s.TextTupletBracketStartLongStem=57857]="TextTupletBracketStartLongStem",s[s.TextTuplet3LongStem=57858]="TextTuplet3LongStem",s[s.TextTupletBracketEndLongStem=57859]="TextTupletBracketEndLongStem",s[s.Tremolo3=57890]="Tremolo3",s[s.Tremolo2=57889]="Tremolo2",s[s.Tremolo1=57888]="Tremolo1",s[s.FlagEighthUp=57920]="FlagEighthUp",s[s.FlagEighthDown=57921]="FlagEighthDown",s[s.FlagSixteenthUp=57922]="FlagSixteenthUp",s[s.FlagSixteenthDown=57923]="FlagSixteenthDown",s[s.FlagThirtySecondUp=57924]="FlagThirtySecondUp",s[s.FlagThirtySecondDown=57925]="FlagThirtySecondDown",s[s.FlagSixtyFourthUp=57926]="FlagSixtyFourthUp",s[s.FlagSixtyFourthDown=57927]="FlagSixtyFourthDown",s[s.FlagOneHundredTwentyEighthUp=57928]="FlagOneHundredTwentyEighthUp",s[s.FlagOneHundredTwentyEighthDown=57929]="FlagOneHundredTwentyEighthDown",s[s.FlagTwoHundredFiftySixthUp=57930]="FlagTwoHundredFiftySixthUp",s[s.FlagTwoHundredFiftySixthDown=57931]="FlagTwoHundredFiftySixthDown",s[s.AccidentalFlat=57952]="AccidentalFlat",s[s.AccidentalNatural=57953]="AccidentalNatural",s[s.AccidentalSharp=57954]="AccidentalSharp",s[s.AccidentalDoubleSharp=57955]="AccidentalDoubleSharp",s[s.AccidentalDoubleFlat=57956]="AccidentalDoubleFlat",s[s.AccidentalQuarterToneFlatArrowUp=57968]="AccidentalQuarterToneFlatArrowUp",s[s.AccidentalQuarterToneSharpArrowUp=57972]="AccidentalQuarterToneSharpArrowUp",s[s.AccidentalQuarterToneNaturalArrowUp=57970]="AccidentalQuarterToneNaturalArrowUp",s[s.Segno=57415]="Segno",s[s.Coda=57416]="Coda",s[s.ArticAccentAbove=58528]="ArticAccentAbove",s[s.ArticAccentBelow=58529]="ArticAccentBelow",s[s.ArticStaccatoAbove=58530]="ArticStaccatoAbove",s[s.ArticStaccatoBelow=58531]="ArticStaccatoBelow",s[s.ArticTenutoAbove=58532]="ArticTenutoAbove",s[s.ArticTenutoBelow=58533]="ArticTenutoBelow",s[s.ArticMarcatoAbove=58540]="ArticMarcatoAbove",s[s.ArticMarcatoBelow=58541]="ArticMarcatoBelow",s[s.FermataAbove=58560]="FermataAbove",s[s.FermataShortAbove=58564]="FermataShortAbove",s[s.FermataLongAbove=58566]="FermataLongAbove",s[s.RestLonga=58593]="RestLonga",s[s.RestDoubleWhole=58594]="RestDoubleWhole",s[s.RestWhole=58595]="RestWhole",s[s.RestHalf=58596]="RestHalf",s[s.RestQuarter=58597]="RestQuarter",s[s.RestEighth=58598]="RestEighth",s[s.RestSixteenth=58599]="RestSixteenth",s[s.RestThirtySecond=58600]="RestThirtySecond",s[s.RestSixtyFourth=58601]="RestSixtyFourth",s[s.RestOneHundredTwentyEighth=58602]="RestOneHundredTwentyEighth",s[s.RestTwoHundredFiftySixth=58603]="RestTwoHundredFiftySixth",s[s.RestHBarLeft=58607]="RestHBarLeft",s[s.RestHBarMiddle=58608]="RestHBarMiddle",s[s.RestHBarRight=58609]="RestHBarRight",s[s.Repeat1Bar=58624]="Repeat1Bar",s[s.Repeat2Bars=58625]="Repeat2Bars",s[s.Ottava=58640]="Ottava",s[s.OttavaAlta=58641]="OttavaAlta",s[s.OttavaBassaVb=58652]="OttavaBassaVb",s[s.Quindicesima=58644]="Quindicesima",s[s.QuindicesimaAlta=58645]="QuindicesimaAlta",s[s.DynamicPPPPPP=58663]="DynamicPPPPPP",s[s.DynamicPPPPP=58664]="DynamicPPPPP",s[s.DynamicPPPP=58665]="DynamicPPPP",s[s.DynamicPPP=58666]="DynamicPPP",s[s.DynamicPP=58667]="DynamicPP",s[s.DynamicPiano=58656]="DynamicPiano",s[s.DynamicMP=58668]="DynamicMP",s[s.DynamicMF=58669]="DynamicMF",s[s.DynamicPF=58670]="DynamicPF",s[s.DynamicForte=58658]="DynamicForte",s[s.DynamicFF=58671]="DynamicFF",s[s.DynamicFFF=58672]="DynamicFFF",s[s.DynamicFFFF=58673]="DynamicFFFF",s[s.DynamicFFFFF=58674]="DynamicFFFFF",s[s.DynamicFFFFFF=58675]="DynamicFFFFFF",s[s.DynamicFortePiano=58676]="DynamicFortePiano",s[s.DynamicNiente=58662]="DynamicNiente",s[s.DynamicSforzando1=58678]="DynamicSforzando1",s[s.DynamicSforzandoPiano=58679]="DynamicSforzandoPiano",s[s.DynamicSforzandoPianissimo=58680]="DynamicSforzandoPianissimo",s[s.DynamicSforzato=58681]="DynamicSforzato",s[s.DynamicSforzatoPiano=58682]="DynamicSforzatoPiano",s[s.DynamicSforzatoFF=58683]="DynamicSforzatoFF",s[s.DynamicRinforzando1=58684]="DynamicRinforzando1",s[s.DynamicRinforzando2=58685]="DynamicRinforzando2",s[s.DynamicForzando=58677]="DynamicForzando",s[s.OrnamentTrill=58726]="OrnamentTrill",s[s.OrnamentTurn=58727]="OrnamentTurn",s[s.OrnamentTurnInverted=58728]="OrnamentTurnInverted",s[s.OrnamentShortTrill=58732]="OrnamentShortTrill",s[s.OrnamentMordent=58733]="OrnamentMordent",s[s.StringsDownBow=58896]="StringsDownBow",s[s.StringsUpBow=58898]="StringsUpBow",s[s.KeyboardPedalPed=58960]="KeyboardPedalPed",s[s.KeyboardPedalUp=58965]="KeyboardPedalUp",s[s.PictEdgeOfCymbal=59177]="PictEdgeOfCymbal",s[s.GuitarString0=59443]="GuitarString0",s[s.GuitarString1=59444]="GuitarString1",s[s.GuitarString2=59445]="GuitarString2",s[s.GuitarString3=59446]="GuitarString3",s[s.GuitarString4=59447]="GuitarString4",s[s.GuitarString5=59448]="GuitarString5",s[s.GuitarString6=59449]="GuitarString6",s[s.GuitarString7=59450]="GuitarString7",s[s.GuitarString8=59451]="GuitarString8",s[s.GuitarString9=59452]="GuitarString9",s[s.GuitarOpenPedal=59453]="GuitarOpenPedal",s[s.GuitarClosePedal=59455]="GuitarClosePedal",s[s.GuitarGolpe=59458]="GuitarGolpe",s[s.GuitarFadeIn=59459]="GuitarFadeIn",s[s.GuitarFadeOut=59460]="GuitarFadeOut",s[s.GuitarVolumeSwell=59461]="GuitarVolumeSwell",s[s.FretboardX=59481]="FretboardX",s[s.FretboardO=59482]="FretboardO",s[s.WiggleTrill=60068]="WiggleTrill",s[s.WiggleVibratoMediumFast=60126]="WiggleVibratoMediumFast",s[s.OctaveBaselineM=60565]="OctaveBaselineM",s[s.OctaveBaselineB=60563]="OctaveBaselineB",s}(f||{}),ye=function(s){return s[s.Left=0]="Left",s[s.Center=1]="Center",s[s.Right=2]="Right",s}(ye||{}),qe=function(s){return s[s.Top=0]="Top",s[s.Middle=1]="Middle",s[s.Bottom=2]="Bottom",s}(qe||{});class Ug{constructor(e,t){this.width=e,this.height=t}}class he{constructor(e="",t=0,n=0,i=f.None,r=f.None,o=f.None,a=f.None,l=qe.Middle){this.elementType=e,this.outputMidiNumber=n,this.staffLine=t,this.noteHeadDefault=i,this.noteHeadHalf=r!==f.None?r:i,this.noteHeadWhole=o!==f.None?o:i,this.techniqueSymbol=a,this.techniqueSymbolPlacement=l}getSymbol(e){switch(e){case w.Whole:return this.noteHeadWhole;case w.Half:return this.noteHeadHalf;default:return this.noteHeadDefault}}}class Gs{static articulationFromElementVariation(e,t){return e<Gs.gp6ElementAndVariationToArticulation.length?(t>=Gs.gp6ElementAndVariationToArticulation.length&&(t=0),Gs.gp6ElementAndVariationToArticulation[e][t]):38}static getArticulation(e){const t=e.percussionArticulation;if(t<0)return null;const n=e.beat.voice.bar.staff.track.percussionArticulations;return t<n.length?n[t]:Gs.getArticulationByInputMidiNumber(t)}static getElementAndVariation(e){const t=Gs.getArticulation(e);if(!t)return[-1,-1];for(let n=0;n<Gs.gp6ElementAndVariationToArticulation.length;n++){const i=Gs.gp6ElementAndVariationToArticulation[n];for(let r=0;r<i.length;r++)if(Gs.getArticulationByInputMidiNumber(i[r])?.outputMidiNumber===t.outputMidiNumber)return[n,r]}return[-1,-1]}static getArticulationByInputMidiNumber(e){return Gs.instrumentArticulations.has(e)?Gs.instrumentArticulations.get(e):null}}Gs.gp6ElementAndVariationToArticulation=[[35,35,35],[38,91,37],[99,100,99],[56,100,56],[102,103,102],[43,43,43],[45,45,45],[47,47,47],[48,48,48],[50,50,50],[42,92,46],[44,44,44],[57,98,57],[49,97,49],[55,95,55],[51,93,127],[52,96,52]],Gs.instrumentArticulations=new Map([[38,new he("snare",3,38,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[37,new he("snare",3,37,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[91,new he("snare",3,38,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite)],[42,new he("hiHat",-1,42,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[92,new he("hiHat",-1,46,f.NoteheadCircleSlash,f.NoteheadCircleSlash,f.NoteheadCircleSlash)],[46,new he("hiHat",-1,46,f.NoteheadCircleX,f.NoteheadCircleX,f.NoteheadCircleX)],[44,new he("hiHat",9,44,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[35,new he("kickDrum",8,35,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[36,new he("kickDrum",7,36,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[50,new he("tom",1,50,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[48,new he("tom",2,48,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[47,new he("tom",4,47,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[45,new he("tom",5,45,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[43,new he("tom",6,43,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[93,new he("ride",0,51,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.PictEdgeOfCymbal,qe.Bottom)],[51,new he("ride",0,51,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[53,new he("ride",0,53,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite)],[94,new he("ride",0,51,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.ArticStaccatoAbove,qe.Top)],[55,new he("splash",-2,55,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[95,new he("splash",-2,55,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.ArticStaccatoAbove,qe.Bottom)],[52,new he("china",-3,52,f.NoteheadHeavyXHat,f.NoteheadHeavyXHat,f.NoteheadHeavyXHat)],[96,new he("china",-3,52,f.NoteheadHeavyXHat,f.NoteheadHeavyXHat,f.NoteheadHeavyXHat)],[49,new he("crash",-2,49,f.NoteheadHeavyX,f.NoteheadHeavyX,f.NoteheadHeavyX)],[97,new he("crash",-2,49,f.NoteheadHeavyX,f.NoteheadHeavyX,f.NoteheadHeavyX,f.ArticStaccatoAbove,qe.Bottom)],[57,new he("crash",-1,57,f.NoteheadHeavyX,f.NoteheadHeavyX,f.NoteheadHeavyX)],[98,new he("crash",-1,57,f.NoteheadHeavyX,f.NoteheadHeavyX,f.NoteheadHeavyX,f.ArticStaccatoAbove,qe.Bottom)],[99,new he("cowbell",1,56,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpHalf,f.NoteheadTriangleUpWhole)],[100,new he("cowbell",1,56,f.NoteheadXBlack,f.NoteheadXHalf,f.NoteheadXWhole)],[56,new he("cowbell",0,56,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpHalf,f.NoteheadTriangleUpWhole)],[101,new he("cowbell",0,56,f.NoteheadXBlack,f.NoteheadXHalf,f.NoteheadXWhole)],[102,new he("cowbell",-1,56,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpHalf,f.NoteheadTriangleUpWhole)],[103,new he("cowbell",-1,56,f.NoteheadXBlack,f.NoteheadXHalf,f.NoteheadXWhole)],[77,new he("woodblock",-9,77,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack)],[76,new he("woodblock",-10,76,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack)],[60,new he("bongo",-4,60,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[104,new he("bongo",-5,60,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.NoteheadParenthesis,qe.Middle)],[105,new he("bongo",-6,60,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[61,new he("bongo",-7,61,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[106,new he("bongo",-8,61,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.NoteheadParenthesis,qe.Middle)],[107,new he("bongo",-16,61,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[66,new he("timbale",10,66,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[65,new he("timbale",9,65,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[68,new he("agogo",12,68,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[67,new he("agogo",11,67,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[64,new he("conga",17,64,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[108,new he("conga",16,64,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[109,new he("conga",15,64,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.NoteheadParenthesis,qe.Middle)],[63,new he("conga",14,63,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[110,new he("conga",13,63,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[62,new he("conga",19,62,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.NoteheadParenthesis,qe.Middle)],[72,new he("whistle",-11,72,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[71,new he("whistle",-17,71,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[73,new he("guiro",38,73,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[74,new he("guiro",37,74,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[86,new he("surdo",36,86,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[87,new he("surdo",35,87,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadParenthesis,qe.Middle)],[54,new he("tambourine",3,54,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack)],[111,new he("tambourine",2,54,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.StringsUpBow,qe.Bottom)],[112,new he("tambourine",1,54,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.NoteheadTriangleUpBlack,f.StringsDownBow,qe.Bottom)],[113,new he("tambourine",-7,54,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[79,new he("cuica",30,79,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[78,new he("cuica",29,78,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[58,new he("vibraslap",28,58,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[81,new he("triangle",27,81,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[80,new he("triangle",26,80,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadParenthesis,qe.Middle)],[114,new he("grancassa",25,43,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[115,new he("piatti",18,49,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[116,new he("piatti",24,49,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[69,new he("cabasa",23,69,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[117,new he("cabasa",22,69,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.StringsUpBow,qe.Bottom)],[85,new he("castanets",21,85,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[75,new he("claves",20,75,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[70,new he("maraca",-12,70,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[118,new he("maraca",-13,70,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.StringsUpBow,qe.Bottom)],[119,new he("maraca",-14,70,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[120,new he("maraca",-15,70,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.StringsUpBow,qe.Bottom)],[82,new he("shaker",-23,54,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[122,new he("shaker",-24,54,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.StringsUpBow,qe.Bottom)],[84,new he("bellTree",-18,53,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[123,new he("bellTree",-19,53,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole,f.StringsUpBow,qe.Bottom)],[83,new he("jingleBell",-20,53,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[124,new he("unpitched",-21,62,f.NoteheadNull,f.NoteheadNull,f.NoteheadNull,f.GuitarGolpe,qe.Top)],[125,new he("unpitched",-22,62,f.NoteheadNull,f.NoteheadNull,f.NoteheadNull,f.GuitarGolpe,qe.Bottom)],[39,new he("handClap",3,39,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[40,new he("snare",3,40,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[31,new he("snare",3,40,f.NoteheadSlashedBlack2,f.NoteheadSlashedBlack2,f.NoteheadSlashedBlack2)],[41,new he("tom",5,41,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole)],[59,new he("ride",2,59,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.PictEdgeOfCymbal,qe.Bottom)],[126,new he("ride",2,59,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[127,new he("ride",2,59,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite,f.NoteheadDiamondWhite)],[29,new he("ride",2,59,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack,f.ArticStaccatoAbove,qe.Top)],[30,new he("crash",-3,49,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[33,new he("snare",3,37,f.NoteheadXBlack,f.NoteheadXBlack,f.NoteheadXBlack)],[34,new he("snare",3,38,f.NoteheadBlack,f.NoteheadBlack,f.NoteheadBlack)]]),Gs.instrumentArticulationNames=new Map([["Ride (choke)",29],["Cymbal (hit)",30],["Snare (side stick)",31],["Snare (side stick) 2",33],["Snare (hit)",34],["Kick (hit)",35],["Kick (hit) 2",36],["Snare (side stick) 3",37],["Snare (hit) 2",38],["Hand Clap (hit)",39],["Snare (hit) 3",40],["Low Floor Tom (hit)",41],["Hi-Hat (closed)",42],["Very Low Tom (hit)",43],["Pedal Hi-Hat (hit)",44],["Low Tom (hit)",45],["Hi-Hat (open)",46],["Mid Tom (hit)",47],["High Tom (hit)",48],["Crash high (hit)",49],["High Floor Tom (hit)",50],["Ride (middle)",51],["China (hit)",52],["Ride (bell)",53],["Tambourine (hit)",54],["Splash (hit)",55],["Cowbell medium (hit)",56],["Crash medium (hit)",57],["Vibraslap (hit)",58],["Ride (edge)",59],["Hand (hit)",60],["Hand (hit)",61],["Conga high (mute)",62],["Conga high (hit)",63],["Conga low (hit)",64],["Timbale high (hit)",65],["Timbale low (hit)",66],["Agogo high (hit)",67],["Agogo tow (hit)",68],["Cabasa (hit)",69],["Left Maraca (hit)",70],["Whistle high (hit)",71],["Whistle low (hit)",72],["Guiro (hit)",73],["Guiro (scrap-return)",74],["Claves (hit)",75],["Woodblock high (hit)",76],["Woodblock low (hit)",77],["Cuica (mute)",78],["Cuica (open)",79],["Triangle (rnute)",80],["Triangle (hit)",81],["Shaker (hit)",82],["Tinkle Bell (hat)",83],["Jingle Bell (hit)",83],["Bell Tree (hit)",84],["Castanets (hit)",85],["Surdo (hit)",86],["Surdo (mute)",87],["Snare (rim shot)",91],["Hi-Hat (half)",92],["Ride (edge) 2",93],["Ride (choke) 2",94],["Splash (choke)",95],["China (choke)",96],["Crash high (choke)",97],["Crash medium (choke)",98],["Cowbell low (hit)",99],["Cowbell low (tip)",100],["Cowbell medium (tip)",101],["Cowbell high (hit)",102],["Cowbell high (tip)",103],["Hand (mute)",104],["Hand (slap)",105],["Hand (mute) 2",106],["Hand (slap) 2",107],["Conga low (slap)",108],["Conga low (mute)",109],["Conga high (slap)",110],["Tambourine (return)",111],["Tambourine (roll)",112],["Tambourine (hand)",113],["Grancassa (hit)",114],["Piatti (hat)",115],["Piatti (hand)",116],["Cabasa (return)",117],["Left Maraca (return)",118],["Right Maraca (hit)",119],["Right Maraca (return)",120],["Shaker (return)",122],["Bell Tee (return)",123],["Golpe (thumb)",124],["Golpe (finger)",125],["Ride (middle) 2",126],["Ride (bell) 2",127]]);var vs=function(s){return s[s.None=0]="None",s[s.InvertedTurn=1]="InvertedTurn",s[s.Turn=2]="Turn",s[s.UpperMordent=3]="UpperMordent",s[s.LowerMordent=4]="LowerMordent",s}(vs||{});class mu{constructor(){this.tieDestinationNoteId=-1,this.tieOriginNoteId=-1,this.slurDestinationNoteId=-1,this.slurOriginNoteId=-1,this.hammerPullDestinationNoteId=-1,this.hammerPullOriginNoteId=-1,this.slideTargetNoteId=-1,this.slideOriginNoteId=-1}}var Qi=function(s){return s[s.Effects=0]="Effects",s[s.StandardNotationNoteHead=1]="StandardNotationNoteHead",s[s.StandardNotationAccidentals=2]="StandardNotationAccidentals",s[s.StandardNotationEffects=3]="StandardNotationEffects",s[s.GuitarTabFretNumber=4]="GuitarTabFretNumber",s[s.GuitarTabEffects=5]="GuitarTabEffects",s[s.SlashNoteHead=6]="SlashNoteHead",s[s.SlashEffects=7]="SlashEffects",s[s.NumberedNumber=8]="NumberedNumber",s[s.NumberedAccidentals=9]="NumberedAccidentals",s[s.NumberedEffects=10]="NumberedEffects",s}(Qi||{});class yD extends Eh{}let Co=(()=>{class s{constructor(){this.id=s.GlobalNoteId++,this.index=0,this.accentuated=Ss.None,this.bendType=me.None,this.bendStyle=Cn.Default,this.bendOrigin=null,this.isContinuedBend=!1,this.bendPoints=null,this.maxBendPoint=null,this.fret=-1,this.string=-1,this.showStringNumber=!1,this.octave=-1,this.tone=-1,this.percussionArticulation=-1,this.isVisible=!0,this.isLeftHandTapped=!1,this.isHammerPullOrigin=!1,this.hammerPullOrigin=null,this.hammerPullDestination=null,this.isSlurDestination=!1,this.slurOrigin=null,this.slurDestination=null,this.harmonicType=Ie.None,this.harmonicValue=0,this.isGhost=!1,this.isLetRing=!1,this.letRingDestination=null,this.isPalmMute=!1,this.palmMuteDestination=null,this.isDead=!1,this.isStaccato=!1,this.slideInType=ri.None,this.slideOutType=Qe.None,this.slideTarget=null,this.slideOrigin=null,this.vibrato=Ft.None,this.tieOrigin=null,this.tieDestination=null,this.isTieDestination=!1,this.leftHandFinger=Ne.Unknown,this.rightHandFinger=Ne.Unknown,this.trillValue=-1,this.trillSpeed=w.ThirtySecond,this.durationPercent=1,this.accidentalMode=mt.Default,this.dynamics=Te.F,this.isEffectSlurOrigin=!1,this.hasEffectSlur=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this.ornament=vs.None,this._noteIdBag=null}static resetIds(){s.GlobalNoteId=0}get hasBend(){return null!==this.bendPoints&&this.bendType!==me.None}get isStringed(){return this.string>=0}get isPiano(){return!this.isStringed&&this.octave>=0&&this.tone>=0}get isPercussion(){return!this.isStringed&&this.percussionArticulation>=0}get element(){return this.isPercussion?Gs.getElementAndVariation(this)[0]:-1}get variation(){return this.isPercussion?Gs.getElementAndVariation(this)[1]:-1}get isHammerPullDestination(){return!!this.hammerPullOrigin}get isSlurOrigin(){return!!this.slurDestination}get isHarmonic(){return this.harmonicType!==Ie.None}get isTieOrigin(){return null!==this.tieDestination}get isFingering(){return this.leftHandFinger!==Ne.Unknown||this.rightHandFinger!==Ne.Unknown}get trillFret(){return this.trillValue-this.stringTuning}get isTrill(){return this.trillValue>=0}get isEffectSlurDestination(){return!!this.effectSlurOrigin}get stringTuning(){return this.beat.voice.bar.staff.capo+s.getStringTuning(this.beat.voice.bar.staff,this.string)}static getStringTuning(t,n){return t.tuning.length>0?t.tuning[t.tuning.length-(n-1)-1]:0}get realValue(){return this.calculateRealValue(!0,!0)}get realValueWithoutHarmonic(){return this.calculateRealValue(!0,!1)}calculateRealValue(t,n){const i=t?this.beat.voice.bar.staff.transpositionPitch:0;if(n){let r=this.calculateRealValue(t,!1);return this.isStringed&&(this.harmonicType===Ie.Natural?r=this.harmonicPitch+this.stringTuning-i:r+=this.harmonicPitch),r}return this.isPercussion?this.percussionArticulation:this.isStringed?this.fret+this.stringTuning-i:this.isPiano?12*this.octave+this.tone-i:0}get harmonicPitch(){if(this.harmonicType===Ie.None||!this.isStringed)return 0;const t=this.harmonicValue;return ie.isAlmostEqualTo(t,2.4)?36:ie.isAlmostEqualTo(t,2.7)?34:t<3?0:t<=3.5?31:t<=4?28:t<=5?24:t<=6?34:t<=7?19:t<=8.5?36:t<=9?28:t<=10?34:t<=11?0:t<=12?12:t<14?0:t<=15?34:t<=16?28:t<=17?36:t<=18?0:t<=19?19:t<=21?0:t<=22?36:t<=24?24:0}get initialBendValue(){return this.hasBend?Math.floor(this.bendPoints[0].value/2):this.bendOrigin?Math.floor(this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value/2):this.isTieDestination&&this.tieOrigin.bendOrigin?Math.floor(this.tieOrigin.bendOrigin.bendPoints[this.tieOrigin.bendOrigin.bendPoints.length-1].value/2):this.beat.hasWhammyBar?Math.floor(this.beat.whammyBarPoints[0].value/2):this.beat.isContinuedWhammy?Math.floor(this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value/2):0}get displayValue(){return this.displayValueWithoutBend+this.initialBendValue}get displayValueWithoutBend(){let t=this.realValue;switch(this.harmonicType!==Ie.Natural&&this.harmonicType!==Ie.None&&(t-=this.harmonicPitch),this.beat.ottava){case Ze._15ma:t-=24;break;case Ze._8va:t-=12;break;case Ze.Regular:break;case Ze._8vb:t+=12;break;case Ze._15mb:t+=24}switch(this.beat.voice.bar.clefOttava){case Ze._15ma:t-=24;break;case Ze._8va:t-=12;break;case Ze.Regular:break;case Ze._8vb:t+=12;break;case Ze._15mb:t+=24}return t-this.beat.voice.bar.staff.displayTranspositionPitch}get hasQuarterToneOffset(){return this.hasBend?this.bendPoints[0].value%2!=0:this.bendOrigin?this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value%2!=0:this.beat.hasWhammyBar?this.beat.whammyBarPoints[0].value%2!=0:!!this.beat.isContinuedWhammy&&this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value%2!=0}addBendPoint(t){let n=this.bendPoints;null===n&&(n=[],this.bendPoints=n),n.push(t),(!this.maxBendPoint||t.value>this.maxBendPoint.value)&&(this.maxBendPoint=t),this.bendType===me.None&&(this.bendType=me.Custom)}finish(t,n=null){const i=new Wg(()=>s.nextNoteOnSameLine(this)),r=t&&t.notation.notationMode===xi.SongBook;if(this.isTieDestination&&(this.chain(n),r&&this.tieOrigin&&this.tieOrigin.isLetRing&&(this.isLetRing=!0)),this.isLetRing&&(this.letRingDestination=i.value&&i.value.isLetRing?i.value:this,r&&this.isTieDestination&&!this.tieOrigin.hasBend&&(this.isVisible=!1)),this.isPalmMute&&(this.palmMuteDestination=i.value&&i.value.isPalmMute?i.value:this),this.isHammerPullOrigin){const c=s.findHammerPullDestination(this);c?(this.hammerPullDestination=c,c.hammerPullOrigin=this):this.isHammerPullOrigin=!1}switch(this.slideOutType){case Qe.Shift:case Qe.Legato:this.slideTarget||(this.slideTarget=i.value),this.slideTarget?this.slideTarget.slideOrigin=this:this.slideOutType=Qe.None}let o=null;this.isHammerPullOrigin&&this.hammerPullDestination?o=this.hammerPullDestination:this.slideOutType===Qe.Legato&&this.slideTarget&&(o=this.slideTarget),o&&(this.hasEffectSlur=!0,this.effectSlurOrigin&&this.beat.pickStroke===yi.None?(this.effectSlurOrigin.effectSlurDestination=o,this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin,this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=o,this.effectSlurDestination.effectSlurOrigin=this));const a=this.bendPoints,l=null!=a&&a.length>0;if(l?this.isContinuedBend=this.isTieDestination&&this.tieOrigin.hasBend:this.bendType=me.None,l&&this.bendType===me.Custom)if(4===a.length){const c=a[0],u=a[1],d=a[3];u.value===a[2].value?d.value>c.value?u.value>d.value?this.bendType=me.BendRelease:!this.isContinuedBend&&c.value>0?(this.bendType=me.PrebendBend,a.splice(2,1),a.splice(1,1)):(this.bendType=me.Bend,a.splice(2,1),a.splice(1,1)):d.value<c.value?this.isContinuedBend?(this.bendType=me.Release,a.splice(2,1),a.splice(1,1)):(this.bendType=me.PrebendRelease,a.splice(2,1),a.splice(1,1)):u.value>c.value?this.bendType=me.BendRelease:c.value>0&&!this.isContinuedBend?(this.bendType=me.Prebend,a.splice(2,1),a.splice(1,1)):(this.bendType=me.Hold,a.splice(2,1),a.splice(1,1)):F.warning("Model","Unsupported bend type detected, fallback to custom",null)}else if(2===a.length){const c=a[0],u=a[1];this.bendType=u.value>c.value?!this.isContinuedBend&&c.value>0?me.PrebendBend:me.Bend:u.value<c.value?this.isContinuedBend?me.Release:me.PrebendRelease:c.value>0&&!this.isContinuedBend?me.Prebend:me.Hold}this.initialBendValue>0&&(this.accidentalMode=mt.Default)}static nextNoteOnSameLine(t){let n=t.beat.nextBeat;for(;n&&n.voice.bar.index<=t.beat.voice.bar.index+s.MaxOffsetForSameLineSearch;){const i=n.getNoteOnString(t.string);if(i)return i;n=n.nextBeat}return null}static findHammerPullDestination(t){let n=t.beat.nextBeat;for(;n&&n.voice.bar.index<=t.beat.voice.bar.index+s.MaxOffsetForSameLineSearch;){let i=n.getNoteOnString(t.string);if(i)return i;for(let r=t.string;r>0;r--)if(i=n.getNoteOnString(r),i){if(i.isLeftHandTapped)return i;break}for(let r=t.string;r<=t.beat.voice.bar.staff.tuning.length;r++)if(i=n.getNoteOnString(r),i){if(i.isLeftHandTapped)return i;break}n=n.nextBeat}return null}static findTieOrigin(t){let n=t.beat.previousBeat;for(;n&&n.voice.bar.index>=t.beat.voice.bar.index-s.MaxOffsetForSameLineSearch;){if(t.isStringed){const i=n.getNoteOnString(t.string);if(i)return i}else if(-1===t.octave&&-1===t.tone){if(t.index<n.notes.length)return n.notes[t.index]}else{const i=n.getNoteWithRealValue(t.realValue);if(i)return i}n=n.previousBeat}return null}chain(t=null){if(null!==t)if(null!==this._noteIdBag){let n;t.has(s.NoteIdLookupKey)?n=t.get(s.NoteIdLookupKey):(n=new Map,t.set(s.NoteIdLookupKey,n)),(-1!==this._noteIdBag.hammerPullDestinationNoteId||-1!==this._noteIdBag.tieDestinationNoteId||-1!==this._noteIdBag.slurDestinationNoteId||-1!==this._noteIdBag.slideTargetNoteId)&&n.set(this.id,this),-1!==this._noteIdBag.hammerPullOriginNoteId&&(this.hammerPullOrigin=n.get(this._noteIdBag.hammerPullOriginNoteId),this.hammerPullOrigin.hammerPullDestination=this),-1!==this._noteIdBag.tieOriginNoteId&&(this.tieOrigin=n.get(this._noteIdBag.tieOriginNoteId),this.tieOrigin.tieDestination=this),-1!==this._noteIdBag.slurOriginNoteId&&(this.slurOrigin=n.get(this._noteIdBag.slurOriginNoteId),this.slurOrigin.slurDestination=this),-1!==this._noteIdBag.slideOriginNoteId&&(this.slideOrigin=n.get(this._noteIdBag.slideOriginNoteId),this.slideOrigin.slideTarget=this),this._noteIdBag=null}else{if(!this.isTieDestination&&null===this.tieOrigin)return;const n=this.tieOrigin??s.findTieOrigin(this);n?(n.tieDestination=this,this.tieOrigin=n,this.fret=n.fret,this.octave=n.octave,this.tone=n.tone,n.hasBend&&(this.bendOrigin=this.tieOrigin)):this.isTieDestination=!1}}toJson(t){null!==this.tieDestination&&t.set("tiedestinationnoteid",this.tieDestination.id),null!==this.tieOrigin&&t.set("tieoriginnoteid",this.tieOrigin.id),null!==this.slurDestination&&t.set("slurdestinationnoteid",this.slurDestination.id),null!==this.slurOrigin&&t.set("sluroriginnoteid",this.slurOrigin.id),null!==this.hammerPullOrigin&&t.set("hammerpulloriginnoteid",this.hammerPullOrigin.id),null!==this.hammerPullDestination&&t.set("hammerpulldestinationnoteid",this.hammerPullDestination.id),null!==this.slideTarget&&t.set("slidetargetnoteid",this.slideTarget.id),null!==this.slideOrigin&&t.set("slideoriginnoteid",this.slideOrigin.id)}setProperty(t,n){switch(t){case"tiedestinationnoteid":return null==this._noteIdBag&&(this._noteIdBag=new mu),this._noteIdBag.tieDestinationNoteId=n,!0;case"tieoriginnoteid":return null==this._noteIdBag&&(this._noteIdBag=new mu),this._noteIdBag.tieOriginNoteId=n,!0;case"slurdestinationnoteid":return null==this._noteIdBag&&(this._noteIdBag=new mu),this._noteIdBag.slurDestinationNoteId=n,!0;case"sluroriginnoteid":return null==this._noteIdBag&&(this._noteIdBag=new mu),this._noteIdBag.slurOriginNoteId=n,!0;case"hammerpulloriginnoteid":return null==this._noteIdBag&&(this._noteIdBag=new mu),this._noteIdBag.hammerPullOriginNoteId=n,!0;case"hammerpulldestinationnoteid":return null==this._noteIdBag&&(this._noteIdBag=new mu),this._noteIdBag.hammerPullDestinationNoteId=n,!0;case"slidetargetnoteid":return null==this._noteIdBag&&(this._noteIdBag=new mu),this._noteIdBag.slideTargetNoteId=n,!0;case"slideoriginnoteid":return null==this._noteIdBag&&(this._noteIdBag=new mu),this._noteIdBag.slideOriginNoteId=n,!0}return!1}}return s.GlobalNoteId=0,s.MaxOffsetForSameLineSearch=3,s.NoteIdLookupKey="NoteIdLookup",s})();class Ni{constructor(e){this._isEqualLengthTuplet=!0,this.totalDuration=0,this.beats=[],this.isFull=!1,this.voice=e}check(e){if(0===this.beats.length)return this.beats.push(e),this.totalDuration+=e.playbackDuration,!0;if(e.graceType!==Ee.None)return!0;if(e.voice!==this.voice||this.isFull||e.tupletNumerator!==this.beats[0].tupletNumerator||e.tupletDenominator!==this.beats[0].tupletDenominator)return!1;if(e.playbackDuration!==this.beats[0].playbackDuration&&(this._isEqualLengthTuplet=!1),this.beats.push(e),this.totalDuration+=e.playbackDuration,this._isEqualLengthTuplet)this.beats.length===this.beats[0].tupletNumerator&&(this.isFull=!0);else{const t=this.beats[0].tupletNumerator/this.beats[0].tupletDenominator|0;for(const n of Ni.AllTicks)if(this.totalDuration===n*t){this.isFull=!0;break}}return!0}}Ni.HalfTicks=1920,Ni.QuarterTicks=960,Ni.EighthTicks=480,Ni.SixteenthTicks=240,Ni.ThirtySecondTicks=120,Ni.SixtyFourthTicks=60,Ni.OneHundredTwentyEighthTicks=30,Ni.TwoHundredFiftySixthTicks=15,Ni.AllTicks=[Ni.HalfTicks,Ni.QuarterTicks,Ni.EighthTicks,Ni.SixteenthTicks,Ni.ThirtySecondTicks,Ni.SixtyFourthTicks,Ni.OneHundredTwentyEighthTicks,Ni.TwoHundredFiftySixthTicks];var Wt=function(s){return s[s.None=0]="None",s[s.Custom=1]="Custom",s[s.Dive=2]="Dive",s[s.Dip=3]="Dip",s[s.Hold=4]="Hold",s[s.Predive=5]="Predive",s[s.PrediveDive=6]="PrediveDive",s}(Wt||{});class S2{static clone(e){const t=new se;return t.offset=e.offset,t.value=e.value,t}}class v2{static clone(e){const t=new Co;if(t.index=e.index,t.accentuated=e.accentuated,t.bendType=e.bendType,t.bendStyle=e.bendStyle,t.isContinuedBend=e.isContinuedBend,e.bendPoints){t.bendPoints=[];for(const n of e.bendPoints)t.addBendPoint(S2.clone(n))}return t.fret=e.fret,t.string=e.string,t.showStringNumber=e.showStringNumber,t.octave=e.octave,t.tone=e.tone,t.percussionArticulation=e.percussionArticulation,t.isVisible=e.isVisible,t.isLeftHandTapped=e.isLeftHandTapped,t.isHammerPullOrigin=e.isHammerPullOrigin,t.isSlurDestination=e.isSlurDestination,t.harmonicType=e.harmonicType,t.harmonicValue=e.harmonicValue,t.isGhost=e.isGhost,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.isDead=e.isDead,t.isStaccato=e.isStaccato,t.slideInType=e.slideInType,t.slideOutType=e.slideOutType,t.vibrato=e.vibrato,t.isTieDestination=e.isTieDestination,t.leftHandFinger=e.leftHandFinger,t.rightHandFinger=e.rightHandFinger,t.trillValue=e.trillValue,t.trillSpeed=e.trillSpeed,t.durationPercent=e.durationPercent,t.accidentalMode=e.accidentalMode,t.dynamics=e.dynamics,t.ornament=e.ornament,t}}class Yte{static clone(e){const t=new Vg;return t.barOccurence=e.barOccurence,t.millisecondOffset=e.millisecondOffset,t}}class Xte{static clone(e){const t=new fs;return t.isLinear=e.isLinear,t.type=e.type,t.value=e.value,t.syncPointValue=e.syncPointValue?Yte.clone(e.syncPointValue):void 0,t.ratioPosition=e.ratioPosition,t.text=e.text,t}}class _D{static clone(e){const t=new Ei;t.index=e.index,t.notes=[];for(const n of e.notes)t.addNote(v2.clone(n));t.isEmpty=e.isEmpty,t.whammyStyle=e.whammyStyle,t.ottava=e.ottava,t.isLegatoOrigin=e.isLegatoOrigin,t.duration=e.duration,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.automations=[];for(const n of e.automations)t.automations.push(Xte.clone(n));if(t.dots=e.dots,t.fade=e.fade,t.lyrics=e.lyrics?e.lyrics.slice():null,t.pop=e.pop,t.slap=e.slap,t.tap=e.tap,t.text=e.text,t.slashed=e.slashed,t.deadSlapped=e.deadSlapped,t.brushType=e.brushType,t.brushDuration=e.brushDuration,t.tupletDenominator=e.tupletDenominator,t.tupletNumerator=e.tupletNumerator,t.isContinuedWhammy=e.isContinuedWhammy,t.whammyBarType=e.whammyBarType,e.whammyBarPoints){t.whammyBarPoints=[];for(const n of e.whammyBarPoints)t.addWhammyBarPoint(S2.clone(n))}return t.vibrato=e.vibrato,t.chordId=e.chordId,t.graceType=e.graceType,t.pickStroke=e.pickStroke,t.tremoloSpeed=e.tremoloSpeed,t.crescendo=e.crescendo,t.displayStart=e.displayStart,t.playbackStart=e.playbackStart,t.displayDuration=e.displayDuration,t.playbackDuration=e.playbackDuration,t.overrideDisplayDuration=e.overrideDisplayDuration,t.golpe=e.golpe,t.dynamics=e.dynamics,t.invertBeamDirection=e.invertBeamDirection,t.preferredBeamDirection=e.preferredBeamDirection,t.isEffectSlurOrigin=e.isEffectSlurOrigin,t.beamingMode=e.beamingMode,t.wahPedal=e.wahPedal,t.barreFret=e.barreFret,t.barreShape=e.barreShape,t.rasgueado=e.rasgueado,t.showTimer=e.showTimer,t.timer=e.timer,t}}var Rr=function(s){return s[s.None=0]="None",s[s.Thumb=1]="Thumb",s[s.Finger=2]="Finger",s}(Rr||{}),Ks=function(s){return s[s.None=0]="None",s[s.FadeIn=1]="FadeIn",s[s.FadeOut=2]="FadeOut",s[s.VolumeSwell=3]="VolumeSwell",s}(Ks||{}),eo=function(s){return s[s.None=0]="None",s[s.Open=1]="Open",s[s.Closed=2]="Closed",s}(eo||{}),to=function(s){return s[s.None=0]="None",s[s.Full=1]="Full",s[s.Half=2]="Half",s}(to||{}),ge=function(s){return s[s.None=0]="None",s[s.Ii=1]="Ii",s[s.Mi=2]="Mi",s[s.MiiTriplet=3]="MiiTriplet",s[s.MiiAnapaest=4]="MiiAnapaest",s[s.PmpTriplet=5]="PmpTriplet",s[s.PmpAnapaest=6]="PmpAnapaest",s[s.PeiTriplet=7]="PeiTriplet",s[s.PeiAnapaest=8]="PeiAnapaest",s[s.PaiTriplet=9]="PaiTriplet",s[s.PaiAnapaest=10]="PaiAnapaest",s[s.AmiTriplet=11]="AmiTriplet",s[s.AmiAnapaest=12]="AmiAnapaest",s[s.Ppp=13]="Ppp",s[s.Amii=14]="Amii",s[s.Amip=15]="Amip",s[s.Eami=16]="Eami",s[s.Eamii=17]="Eamii",s[s.Peami=18]="Peami",s}(ge||{}),jn=function(s){return s[s.Auto=0]="Auto",s[s.ForceSplitToNext=1]="ForceSplitToNext",s[s.ForceMergeWithNext=2]="ForceMergeWithNext",s[s.ForceSplitOnSecondaryToNext=3]="ForceSplitOnSecondaryToNext",s}(jn||{}),In=function(s){return s[s.Effects=0]="Effects",s[s.StandardNotationStem=1]="StandardNotationStem",s[s.StandardNotationFlags=2]="StandardNotationFlags",s[s.StandardNotationBeams=3]="StandardNotationBeams",s[s.StandardNotationTuplet=4]="StandardNotationTuplet",s[s.StandardNotationEffects=5]="StandardNotationEffects",s[s.StandardNotationRests=6]="StandardNotationRests",s[s.GuitarTabStem=7]="GuitarTabStem",s[s.GuitarTabFlags=8]="GuitarTabFlags",s[s.GuitarTabBeams=9]="GuitarTabBeams",s[s.GuitarTabTuplet=10]="GuitarTabTuplet",s[s.GuitarTabEffects=11]="GuitarTabEffects",s[s.GuitarTabRests=12]="GuitarTabRests",s[s.SlashStem=13]="SlashStem",s[s.SlashFlags=14]="SlashFlags",s[s.SlashBeams=15]="SlashBeams",s[s.SlashTuplet=16]="SlashTuplet",s[s.SlashRests=17]="SlashRests",s[s.SlashEffects=18]="SlashEffects",s[s.NumberedDuration=19]="NumberedDuration",s[s.NumberedEffects=20]="NumberedEffects",s[s.NumberedRests=21]="NumberedRests",s[s.NumberedTuplet=22]="NumberedTuplet",s}(In||{});class T2 extends Eh{}let Ei=(()=>{class s{constructor(){this.id=s._globalBeatId++,this.index=0,this.previousBeat=null,this.nextBeat=null,this.notes=[],this.noteStringLookup=new Map,this.noteValueLookup=new Map,this.isEmpty=!1,this.whammyStyle=Cn.Default,this.ottava=Ze.Regular,this.fermata=null,this.isLegatoOrigin=!1,this.minNote=null,this.maxNote=null,this.maxStringNote=null,this.minStringNote=null,this.duration=w.Quarter,this.isLetRing=!1,this.isPalmMute=!1,this.automations=[],this.dots=0,this.fade=Ks.None,this.lyrics=null,this.pop=!1,this.slap=!1,this.tap=!1,this.text=null,this.slashed=!1,this.deadSlapped=!1,this.brushType=fe.None,this.brushDuration=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.tupletGroup=null,this.isContinuedWhammy=!1,this.whammyBarType=Wt.None,this.whammyBarPoints=null,this.maxWhammyPoint=null,this.minWhammyPoint=null,this.vibrato=Ft.None,this.chordId=null,this.graceType=Ee.None,this.graceGroup=null,this.graceIndex=-1,this.pickStroke=yi.None,this.tremoloSpeed=null,this.crescendo=Zi.None,this.displayStart=0,this.playbackStart=0,this.displayDuration=0,this.playbackDuration=0,this.golpe=Rr.None,this.dynamics=Te.F,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isEffectSlurOrigin=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this.beamingMode=jn.Auto,this.wahPedal=eo.None,this.barreFret=-1,this.barreShape=to.None,this.rasgueado=ge.None,this.showTimer=!1,this.timer=null}static resetIds(){s._globalBeatId=0}get isLastOfVoice(){return this.index===this.voice.beats.length-1}get isLegatoDestination(){return!!this.previousBeat&&this.previousBeat.isLegatoOrigin}get isRest(){return this.isEmpty||!this.deadSlapped&&0===this.notes.length}get isFullBarRest(){return this.isRest&&1===this.voice.beats.length&&this.duration===w.Whole}get fadeIn(){return this.fade===Ks.FadeIn}set fadeIn(t){this.fade=t?Ks.FadeIn:Ks.None}get hasRasgueado(){return this.rasgueado!==ge.None}get hasTuplet(){return!(-1===this.tupletDenominator&&-1===this.tupletNumerator||1===this.tupletDenominator&&1===this.tupletNumerator)}get hasWhammyBar(){return null!==this.whammyBarPoints&&this.whammyBarType!==Wt.None}get hasChord(){return!!this.chordId}get chord(){return this.chordId?this.voice.bar.staff.getChord(this.chordId):null}get isTremolo(){return!!this.tremoloSpeed}get displayEnd(){return this.displayStart+this.displayDuration}get absoluteDisplayStart(){return this.voice.bar.masterBar.start+this.displayStart}get absolutePlaybackStart(){return this.voice.bar.masterBar.start+this.playbackStart}get isEffectSlurDestination(){return!!this.effectSlurOrigin}get isBarre(){return this.barreShape!==to.None&&this.barreFret>=0}addWhammyBarPoint(t){let n=this.whammyBarPoints;null===n&&(n=[],this.whammyBarPoints=n),n.push(t),(!this.maxWhammyPoint||t.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=t),(!this.minWhammyPoint||t.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=t),this.whammyBarType===Wt.None&&(this.whammyBarType=Wt.Custom)}removeWhammyBarPoint(t){const n=this.whammyBarPoints;if(null===n||t<0||t>=n.length)return;n.splice(t,1);const i=n[t];if(i===this.maxWhammyPoint){this.maxWhammyPoint=null;for(const r of n)(!this.maxWhammyPoint||r.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=r)}if(i===this.minWhammyPoint){this.minWhammyPoint=null;for(const r of n)(!this.minWhammyPoint||r.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=r)}}addNote(t){t.beat=this,t.index=this.notes.length,this.notes.push(t),t.isStringed&&this.noteStringLookup.set(t.string,t)}removeNote(t){const n=this.notes.indexOf(t);n>=0&&(this.notes.splice(n,1),t.isStringed&&this.noteStringLookup.delete(t.string))}getAutomation(t){for(let n=0,i=this.automations.length;n<i;n++){const r=this.automations[n];if(r.type===t)return r}return null}getNoteOnString(t){return this.noteStringLookup.has(t)?this.noteStringLookup.get(t):null}calculateDuration(){if(void 0!==this.overrideDisplayDuration)return this.overrideDisplayDuration;if(this.isFullBarRest)return this.voice.bar.masterBar.calculateDuration();let t=G.toTicks(this.duration);return 2===this.dots?t=G.applyDot(t,!0):1===this.dots&&(t=G.applyDot(t,!1)),this.tupletDenominator>0&&this.tupletNumerator>=0&&(t=G.applyTuplet(t,this.tupletNumerator,this.tupletDenominator)),t}updateDurations(){const t=this.calculateDuration();switch(this.playbackDuration=t,this.graceType){case Ee.BeforeBeat:case Ee.OnBeat:switch(this.duration){case w.Sixteenth:this.playbackDuration=G.toTicks(w.SixtyFourth);break;case w.ThirtySecond:this.playbackDuration=G.toTicks(w.OneHundredTwentyEighth);break;default:this.playbackDuration=G.toTicks(w.ThirtySecond)}this.displayDuration=0;break;case Ee.BendGrace:this.playbackDuration/=2,this.displayDuration=0;break;default:this.displayDuration=t;const n=this.previousBeat;n&&n.graceType===Ee.BendGrace&&(this.playbackDuration=n.playbackDuration)}}finishTuplet(){const t=this.previousBeat;let n=t?t.tupletGroup:null;if((this.hasTuplet||this.graceType!==Ee.None&&n)&&((!t||!n||!n.check(this))&&(n=new Ni(this.voice),n.check(this)),this.tupletGroup=n),this.index>0){const i=this.voice.bar.masterBar.calculateDuration(),r=[];for(const o of this.automations)0===o.ratioPosition&&(o.ratioPosition=this.playbackStart/i),o.type!==$n.Volume&&r.push(o);this.automations=r}}finish(t,n=null){switch(null===this.getAutomation($n.Instrument)&&0===this.index&&0===this.voice.index&&0===this.voice.bar.index&&0===this.voice.bar.staff.index&&this.automations.push(fs.buildInstrumentAutomation(!1,0,this.voice.bar.staff.track.playbackInfo.program)),this.graceType){case Ee.OnBeat:case Ee.BeforeBeat:const h=this.graceGroup.beats.length;this.duration=1===h?w.Eighth:2===h?w.Sixteenth:w.ThirtySecond}const i=t?t.notation.notationMode:xi.GuitarPro;let r="grad"===this.text||"grad."===this.text;r&&i===xi.SongBook&&(this.text="");let o=!1;this.minNote=null,this.maxNote=null,this.minStringNote=null,this.maxStringNote=null;let a=0,l=!1;for(let h=0,d=this.notes.length;h<d;h++){const p=this.notes[h];if(p.dynamics=this.dynamics,p.finish(t,n),p.isLetRing&&(this.isLetRing=!0),p.isPalmMute&&(this.isPalmMute=!0),i===xi.SongBook&&p.hasBend&&this.graceType!==Ee.BendGrace){if(!p.isTieOrigin)switch(p.bendType){case me.Bend:case me.PrebendRelease:case me.PrebendBend:o=!0}r||p.bendStyle===Cn.Gradual?(r=!0,p.bendStyle=Cn.Gradual,o=!1):p.bendStyle=Cn.Fast}p.isVisible&&(a++,(!this.minNote||p.realValue<this.minNote.realValue)&&(this.minNote=p),(!this.maxNote||p.realValue>this.maxNote.realValue)&&(this.maxNote=p),(!this.minStringNote||p.string<this.minStringNote.string)&&(this.minStringNote=p),(!this.maxStringNote||p.string>this.maxStringNote.string)&&(this.maxStringNote=p),p.hasEffectSlur&&(l=!0))}if(l&&(this.effectSlurOrigin?(this.effectSlurOrigin.effectSlurDestination=this.nextBeat,this.effectSlurOrigin.effectSlurDestination&&(this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin),this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=this.nextBeat,this.effectSlurDestination&&(this.effectSlurDestination.effectSlurOrigin=this))),this.notes.length>0&&0===a&&(this.isEmpty=!0),this.isRest||this.isLetRing&&this.isPalmMute)this.isRest&&this.previousBeat&&t&&t.notation.notationMode===xi.GuitarPro&&(this.previousBeat.isLetRing&&(this.isLetRing=!0),this.previousBeat.isPalmMute&&(this.isPalmMute=!0));else{let h=this.previousBeat;for(;h&&h.isRest;)this.isLetRing||(h.isLetRing=!1),this.isPalmMute||(h.isPalmMute=!1),h=h.previousBeat}const c=this.whammyBarPoints,u=null!==c&&c.length>0;if(u?this.isContinuedWhammy=!!this.previousBeat&&this.previousBeat.hasWhammyBar:this.whammyBarType=Wt.None,u&&this.whammyBarType===Wt.Custom&&(i===xi.SongBook&&(this.whammyStyle=r?Cn.Gradual:Cn.Fast),4===c.length)){const h=c[0],d=c[1],p=c[2],g=c[3];d.value===p.value&&(h.value<d.value&&d.value<g.value||h.value>d.value&&d.value>g.value?(this.whammyBarType=0===h.value||this.isContinuedWhammy?Wt.Dive:Wt.PrediveDive,c.splice(2,1),c.splice(1,1)):h.value>d.value&&d.value<g.value||h.value<d.value&&d.value>g.value?(this.whammyBarType=Wt.Dip,(d.offset===p.offset||i===xi.SongBook)&&c.splice(2,1)):h.value===d.value&&d.value===g.value&&(this.whammyBarType=0===h.value||this.isContinuedWhammy?Wt.Hold:Wt.Predive,c.splice(2,1),c.splice(1,1)))}if(this.updateDurations(),o){const h=_D.clone(this);h.id=s._globalBeatId++,h.pickStroke=yi.None;for(let d=0,p=h.notes.length;d<p;d++){const g=h.notes[d],m=this.notes[d];if(g.bendType=me.None,g.maxBendPoint=null,g.bendPoints=null,g.bendStyle=Cn.Default,g.id=Co.GlobalNoteId++,m.isTieOrigin&&(g.tieDestination=m.tieDestination,m.tieDestination.tieOrigin=g),m.isTieDestination&&(g.tieOrigin=m.tieOrigin?m.tieOrigin:null,m.tieOrigin.tieDestination=g),m.hasBend&&m.isTieOrigin){const _=Co.findTieOrigin(m);if(_&&_.hasBend){g.bendType=me.Hold;const y=m.bendPoints[m.bendPoints.length-1];g.addBendPoint(new se(0,y.value)),g.addBendPoint(new se(se.MaxPosition,y.value))}}g.isTieDestination=!0}this.graceType=Ee.BendGrace,this.graceGroup=new ew,this.graceGroup.addBeat(this),this.graceGroup.isComplete=!0,this.graceGroup.finish(),this.updateDurations(),this.voice.insertBeat(this,h),h.graceGroup=new ew,h.graceGroup.addBeat(this),h.graceGroup.isComplete=!0,h.graceGroup.finish()}}isBefore(t){return this.voice.bar.index<t.voice.bar.index||t.voice.bar.index===this.voice.bar.index&&this.index<t.index}isAfter(t){return this.voice.bar.index>t.voice.bar.index||t.voice.bar.index===this.voice.bar.index&&this.index>t.index}hasNoteOnString(t){return this.noteStringLookup.has(t)}getNoteWithRealValue(t){return this.noteValueLookup.has(t)?this.noteValueLookup.get(t):null}chain(t=null){for(const n of this.notes)this.noteValueLookup.set(n.realValue,n),n.chain(t)}}return s._globalBeatId=0,s})();var re=function(s){return s[s.Title=0]="Title",s[s.SubTitle=1]="SubTitle",s[s.Artist=2]="Artist",s[s.Album=3]="Album",s[s.Words=4]="Words",s[s.Music=5]="Music",s[s.WordsAndMusic=6]="WordsAndMusic",s[s.Transcriber=7]="Transcriber",s[s.Copyright=8]="Copyright",s[s.CopyrightSecondLine=9]="CopyrightSecondLine",s[s.ChordDiagramList=10]="ChordDiagramList",s}(re||{});let zo=(()=>{class s{constructor(t="",n=void 0,i=ye.Left){this.template=t,this.isVisible=n,this.textAlign=i}buildText(t){let n=!1,i=!1;const r=this.template.replace(s.PlaceholderPattern,(o,a)=>{i=!0;let l="";switch(a){case"TITLE":l=t.title;break;case"SUBTITLE":l=t.subTitle;break;case"ARTIST":l=t.artist;break;case"ALBUM":l=t.album;break;case"WORDS":case"WORDSMUSIC":l=t.words;break;case"MUSIC":l=t.music;break;case"TABBER":l=t.tab;break;case"COPYRIGHT":l=t.copyright;break;default:l=""}return l&&(n=!0),l});return i&&!n?"":r}}return s.PlaceholderPattern=/%([^%]+)%/g,s})();class Bh extends Eh{constructor(){super(...arguments),this.headerAndFooter=new Map}}Bh.defaultHeaderAndFooter=new Map([[re.Title,new zo("%TITLE%",void 0,ye.Center)],[re.SubTitle,new zo("%SUBTITLE%",void 0,ye.Center)],[re.Artist,new zo("%ARTIST%",void 0,ye.Center)],[re.Album,new zo("%ALBUM%",void 0,ye.Center)],[re.Words,new zo("Words by %WORDS%",void 0,ye.Left)],[re.Music,new zo("Music by %MUSIC%",void 0,ye.Right)],[re.WordsAndMusic,new zo("Words & Music by %MUSIC%",void 0,ye.Right)],[re.Transcriber,new zo("Tabbed by %TABBER%",!1,ye.Right)],[re.Copyright,new zo("%COPYRIGHT%",void 0,ye.Center)],[re.CopyrightSecondLine,new zo("All Rights Reserved - International Copyright Secured",!0,ye.Center)]]);class Cl{constructor(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0,this.album="",this.artist="",this.copyright="",this.instructions="",this.music="",this.notices="",this.subTitle="",this.title="",this.words="",this.tab="",this.tempo=120,this.tempoLabel="",this.masterBars=[],this.tracks=[],this.defaultSystemsLayout=3,this.systemsLayout=[],this.stylesheet=new y2}static resetIds(){Sl.resetIds(),Ei.resetIds(),ko.resetIds(),Co.resetIds()}rebuildRepeatGroups(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0;for(const e of this.masterBars)this.addMasterBarToRepeatGroups(e)}addMasterBar(e){e.score=this,e.index=this.masterBars.length,0!==this.masterBars.length&&(e.previousMasterBar=this.masterBars[this.masterBars.length-1],e.previousMasterBar.nextMasterBar=e,e.start=e.previousMasterBar.start+(e.previousMasterBar.isAnacrusis?0:e.previousMasterBar.calculateDuration())),this.addMasterBarToRepeatGroups(e),this.masterBars.push(e)}addMasterBarToRepeatGroups(e){e.isRepeatStart?(this._currentRepeatGroup?.isClosed&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--),this._currentRepeatGroup=new mD,this._openedRepeatGroups.push(this._currentRepeatGroup),this._properlyOpenedRepeatGroups++):this._currentRepeatGroup||(this._currentRepeatGroup=new mD,this._openedRepeatGroups.push(this._currentRepeatGroup)),this._currentRepeatGroup.addMasterBar(e),e.isRepeatEnd&&this._properlyOpenedRepeatGroups>1&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--,this._currentRepeatGroup=this._openedRepeatGroups.length>0?this._openedRepeatGroups[this._openedRepeatGroups.length-1]:null)}addTrack(e){e.score=this,e.index=this.tracks.length,this.tracks.push(e)}finish(e){const t=new Map;for(let n=0,i=this.tracks.length;n<i;n++)this.tracks[n].finish(e,t)}applyFlatSyncPoints(e){for(const t of this.masterBars)t.syncPoints=void 0;for(const t of e){const n=new fs;n.ratioPosition=Math.min(1,Math.max(0,t.barPosition)),n.type=$n.SyncPoint,n.syncPointValue=new Vg,n.syncPointValue.millisecondOffset=t.millisecondOffset,n.syncPointValue.barOccurence=t.barOccurence,t.barIndex<this.masterBars.length&&this.masterBars[t.barIndex].addSyncPoint(n)}for(const t of this.masterBars)t.syncPoints&&t.syncPoints.sort((n,i)=>{const r=n.syncPointValue.barOccurence-i.syncPointValue.barOccurence;return 0!==r?r:n.ratioPosition-i.ratioPosition})}exportFlatSyncPoints(){const e=[];for(const t of this.masterBars){const n=t.syncPoints;if(n)for(const i of n)e.push({barIndex:t.index,barOccurence:i.syncPointValue.barOccurence,barPosition:i.ratioPosition,millisecondOffset:i.syncPointValue.millisecondOffset})}return e}}class Mh{init(e,t){this.data=e,this.settings=t,Cl.resetIds()}}var un=function(s){return s[s.General=0]="General",s[s.Format=1]="Format",s[s.AlphaTex=2]="AlphaTex",s}(un||{});class rn extends Error{constructor(e,t="",n){super(t??"",{cause:n}),this.type=e,Object.setPrototypeOf(this,rn.prototype)}}class Ts extends rn{constructor(e=null,t){super(un.Format,e??"Unsupported format",t),Object.setPrototypeOf(this,Ts.prototype)}}class gc{constructor(){this.name="",this.firstFret=1,this.strings=[],this.barreFrets=[],this.showName=!0,this.showDiagram=!0,this.showFingering=!0}get uniqueId(){return[this.name,this.firstFret.toString(),this.strings.join(","),this.barreFrets.join(","),this.showDiagram.toString(),this.showFingering.toString(),this.showName.toString()].join("|")}}var wr=function(s){return s[s.IgnoreSpaces=0]="IgnoreSpaces",s[s.Begin=1]="Begin",s[s.Text=2]="Text",s[s.Comment=3]="Comment",s[s.Dash=4]="Dash",s}(wr||{});let Tf=(()=>{class s{constructor(){this.startBar=0,this.text=""}finish(t=!1){this.chunks=[],this.parse(this.text,0,this.chunks,t)}parse(t,n,i,r){if(!t)return;let o=wr.Begin,a=wr.Begin,l=!1,c=0;for(;n<t.length;){const u=t.charCodeAt(n);switch(o){case wr.IgnoreSpaces:switch(u){case s.CharCodeLF:case s.CharCodeCR:case s.CharCodeTab:break;case s.CharCodeSpace:if(!l){o=a;continue}break;default:l=!1,o=a;continue}break;case wr.Begin:if(u!==s.CharCodeBrackedOpen){c=n,o=wr.Text;continue}o=wr.Comment;break;case wr.Comment:u===s.CharCodeBrackedClose&&(o=wr.Begin);break;case wr.Text:switch(u){case s.CharCodeDash:o=wr.Dash;break;case s.CharCodeCR:case s.CharCodeLF:case s.CharCodeSpace:const h=t.substr(c,n-c);this.addChunk(h,r),o=wr.IgnoreSpaces,a=wr.Begin}break;case wr.Dash:if(u!==s.CharCodeDash){const h=t.substr(c,n-c);this.addChunk(h,r),l=!0,o=wr.IgnoreSpaces,a=wr.Begin;continue}}n+=1}o===wr.Text&&n!==c&&this.addChunk(t.substr(c,n-c),r)}addChunk(t,n){t=this.prepareChunk(t),(!n||t.length>0&&"-"!==t)&&this.chunks.push(t)}prepareChunk(t){const n=t.split("+").join(" ");let i=n.length;for(;i>0&&"_"===n.charAt(i-1);)i--;return i!==n.length?n.substr(0,i):n}}return s.CharCodeLF=10,s.CharCodeTab=9,s.CharCodeCR=13,s.CharCodeSpace=32,s.CharCodeBrackedClose=93,s.CharCodeBrackedOpen=91,s.CharCodeDash=45,s})();class kf{constructor(){this.marker="",this.text=""}}class oi extends rn{constructor(e){super(un.Format,e),Object.setPrototypeOf(this,oi.prototype)}}let _n=(()=>{class s{constructor(t,n,i,r=255){this.raw=0,this.raw=(255&r)<<24|(255&t)<<16|(255&n)<<8|255&i,this.updateRgba()}updateRgba(){this.rgba=255===this.a?`#${ie.toHexString(this.r,2)}${ie.toHexString(this.g,2)}${ie.toHexString(this.b,2)}`:`rgba(${this.r},${this.g},${this.b},${this.a/255})`}get a(){return this.raw>>24&255}get r(){return this.raw>>16&255}get g(){return this.raw>>8&255}get b(){return 255&this.raw}static random(t=100){return new s(255*Math.random()|0,255*Math.random()|0,255*Math.random()|0,t)}static fromJson(t){if(t instanceof s)return t;switch(typeof t){case"number":{const n=new s(0,0,0,0);return n.raw=t,n.updateRgba(),n}case"string":{const n=t;if(n.startsWith("#")){if(4===n.length)return new s(17*Number.parseInt(n[1],16),17*Number.parseInt(n[2],16),17*Number.parseInt(n[3],16));if(5===n.length)return new s(17*Number.parseInt(n[1],16),17*Number.parseInt(n[2],16),17*Number.parseInt(n[3],16),17*Number.parseInt(n[4],16));if(7===n.length)return new s(Number.parseInt(n.substring(1,3),16),Number.parseInt(n.substring(3,5),16),Number.parseInt(n.substring(5,7),16));if(9===n.length)return new s(Number.parseInt(n.substring(1,3),16),Number.parseInt(n.substring(3,5),16),Number.parseInt(n.substring(5,7),16),Number.parseInt(n.substring(7,9),16))}else if(n.startsWith("rgba")||n.startsWith("rgb")){const i=n.indexOf("("),r=n.lastIndexOf(")");if(-1===i||-1===r)throw new oi("No values specified for rgb/rgba function");const o=n.substring(i+1,r).split(",");if(3===o.length)return new s(Number.parseInt(o[0]),Number.parseInt(o[1]),Number.parseInt(o[2]));if(4===o.length)return new s(Number.parseInt(o[0]),Number.parseInt(o[1]),Number.parseInt(o[2]),255*Number.parseFloat(o[3]))}return null}}throw new oi("Unsupported format for color")}static toJson(t){return null===t?null:t.raw}}return s.BlackRgb="#000000",s})();class bD{constructor(){this.volume=15,this.balance=8,this.port=1,this.program=0,this.primaryChannel=0,this.secondaryChannel=0,this.isMute=!1,this.isSolo=!1}}class z{static getTextForTuning(e,t){const n=z.getTextPartsForTuning(e);return t?n.join(""):n[0]}static getTextPartsForTuning(e,t=-1){return[["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"][e%12],((e/12|0)+t).toString()]}static getDefaultTuningFor(e){return z._defaultTunings.has(e)?z._defaultTunings.get(e):null}static getPresetsFor(e){switch(e){case 7:return z._sevenStrings;case 6:return z._sixStrings;case 5:return z._fiveStrings;case 4:return z._fourStrings}return[]}static initialize(){z._defaultTunings.set(7,new z("Guitar 7 strings",[64,59,55,50,45,40,35],!0)),z._sevenStrings.push(z._defaultTunings.get(7)),z._defaultTunings.set(6,new z("Guitar Standard Tuning",[64,59,55,50,45,40],!0)),z._sixStrings.push(z._defaultTunings.get(6)),z._sixStrings.push(new z("Guitar Tune down \xbd step",[63,58,54,49,44,39],!1)),z._sixStrings.push(new z("Guitar Tune down 1 step",[62,57,53,48,43,38],!1)),z._sixStrings.push(new z("Guitar Tune down 2 step",[60,55,51,46,41,36],!1)),z._sixStrings.push(new z("Guitar Dropped D Tuning",[64,59,55,50,45,38],!1)),z._sixStrings.push(new z("Guitar Dropped D Tuning variant",[64,57,55,50,45,38],!1)),z._sixStrings.push(new z("Guitar Double Dropped D Tuning",[62,59,55,50,45,38],!1)),z._sixStrings.push(new z("Guitar Dropped E Tuning",[66,61,57,52,47,40],!1)),z._sixStrings.push(new z("Guitar Dropped C Tuning",[62,57,53,48,43,36],!1)),z._sixStrings.push(new z("Guitar Open C Tuning",[64,60,55,48,43,36],!1)),z._sixStrings.push(new z("Guitar Open Cm Tuning",[63,60,55,48,43,36],!1)),z._sixStrings.push(new z("Guitar Open C6 Tuning",[64,57,55,48,43,36],!1)),z._sixStrings.push(new z("Guitar Open Cmaj7 Tuning",[64,59,55,52,43,36],!1)),z._sixStrings.push(new z("Guitar Open D Tuning",[62,57,54,50,45,38],!1)),z._sixStrings.push(new z("Guitar Open Dm Tuning",[62,57,53,50,45,38],!1)),z._sixStrings.push(new z("Guitar Open D5 Tuning",[62,57,50,50,45,38],!1)),z._sixStrings.push(new z("Guitar Open D6 Tuning",[62,59,54,50,45,38],!1)),z._sixStrings.push(new z("Guitar Open Dsus4 Tuning",[62,57,55,50,45,38],!1)),z._sixStrings.push(new z("Guitar Open E Tuning",[64,59,56,52,47,40],!1)),z._sixStrings.push(new z("Guitar Open Em Tuning",[64,59,55,52,47,40],!1)),z._sixStrings.push(new z("Guitar Open Esus11 Tuning",[64,59,55,52,45,40],!1)),z._sixStrings.push(new z("Guitar Open F Tuning",[65,60,53,48,45,41],!1)),z._sixStrings.push(new z("Guitar Open G Tuning",[62,59,55,50,43,38],!1)),z._sixStrings.push(new z("Guitar Open Gm Tuning",[62,58,55,50,43,38],!1)),z._sixStrings.push(new z("Guitar Open G6 Tuning",[64,59,55,50,43,38],!1)),z._sixStrings.push(new z("Guitar Open Gsus4 Tuning",[62,60,55,50,43,38],!1)),z._sixStrings.push(new z("Guitar Open A Tuning",[64,61,57,52,45,40],!1)),z._sixStrings.push(new z("Guitar Open Am Tuning",[64,60,57,52,45,40],!1)),z._sixStrings.push(new z("Guitar Nashville Tuning",[64,59,67,62,57,52],!1)),z._sixStrings.push(new z("Bass 6 Strings Tuning",[48,43,38,33,28,23],!1)),z._sixStrings.push(new z("Lute or Vihuela Tuning",[64,59,54,50,45,40],!1)),z._defaultTunings.set(5,new z("Bass 5 Strings Tuning",[43,38,33,28,23],!0)),z._fiveStrings.push(z._defaultTunings.get(5)),z._fiveStrings.push(new z("Banjo Dropped C Tuning",[62,59,55,48,67],!1)),z._fiveStrings.push(new z("Banjo Open D Tuning",[62,57,54,50,69],!1)),z._fiveStrings.push(new z("Banjo Open G Tuning",[62,59,55,50,67],!1)),z._fiveStrings.push(new z("Banjo G Minor Tuning",[62,58,55,50,67],!1)),z._fiveStrings.push(new z("Banjo G Modal Tuning",[62,57,55,50,67],!1)),z._defaultTunings.set(4,new z("Bass Standard Tuning",[43,38,33,28],!0)),z._fourStrings.push(z._defaultTunings.get(4)),z._fourStrings.push(new z("Bass Tune down \xbd step",[42,37,32,27],!1)),z._fourStrings.push(new z("Bass Tune down 1 step",[41,36,31,26],!1)),z._fourStrings.push(new z("Bass Tune down 2 step",[39,34,29,24],!1)),z._fourStrings.push(new z("Bass Dropped D Tuning",[43,38,33,26],!1)),z._fourStrings.push(new z("Ukulele C Tuning",[45,40,36,43],!1)),z._fourStrings.push(new z("Ukulele G Tuning",[52,47,43,38],!1)),z._fourStrings.push(new z("Mandolin Standard Tuning",[64,57,50,43],!1)),z._fourStrings.push(new z("Mandolin or Violin Tuning",[76,69,62,55],!1)),z._fourStrings.push(new z("Viola Tuning",[69,62,55,48],!1)),z._fourStrings.push(new z("Cello Tuning",[57,50,43,36],!1))}static findTuning(e){const t=z.getPresetsFor(e.length);for(let n=0,i=t.length;n<i;n++){const r=t[n];let o=!0;for(let a=0,l=e.length;a<l;a++)if(e[a]!==r.tunings[a]){o=!1;break}if(o)return r}return null}constructor(e="",t=null,n=!1){this.isStandard=n,this.name=e,this.tunings=t??[]}finish(){const e=z.findTuning(this.tunings);e&&(this.name=e.name,this.isStandard=e.isStandard),this.name=this.name.trim()}}z._sevenStrings=[],z._sixStrings=[],z._fiveStrings=[],z._fourStrings=[],z._defaultTunings=new Map,z.defaultAccidentals=["","#","","#","","","#","","#","","#",""],z.defaultSteps=["C","C","D","D","E","F","F","G","G","A","A","B"],z.initialize();let tw=(()=>{class s{constructor(){this.index=0,this.bars=[],this.chords=null,this.capo=0,this.transpositionPitch=0,this.displayTranspositionPitch=0,this.stringTuning=new z("",[],!1),this.showSlash=!1,this.showNumbered=!1,this.showTablature=!0,this.showStandardNotation=!0,this.isPercussion=!1,this.standardNotationLineCount=s.DefaultStandardNotationLineCount}get tuning(){return this.stringTuning.tunings}get tuningName(){return this.stringTuning.name}get isStringed(){return this.stringTuning.tunings.length>0}finish(t,n=null){this.stringTuning.finish();for(let i=0,r=this.bars.length;i<r;i++)this.bars[i].finish(t,n)}addChord(t,n){n.staff=this;let i=this.chords;null===i&&(i=new Map,this.chords=i),i.set(t,n)}hasChord(t){return this.chords?.has(t)??!1}getChord(t){return this.chords?.get(t)??null}addBar(t){const n=this.bars;t.staff=this,t.index=n.length,n.length>0&&(t.previousBar=n[n.length-1],t.previousBar.nextBar=t),n.push(t)}}return s.DefaultStandardNotationLineCount=5,s})();var Dl=function(s){return s[s.TrackName=0]="TrackName",s[s.BracesAndBrackets=1]="BracesAndBrackets",s[s.SystemSeparator=2]="SystemSeparator",s[s.StringTuning=3]="StringTuning",s}(Dl||{});class k2 extends Eh{}let Ph=(()=>{class s{constructor(){this.index=0,this.staves=[],this.playbackInfo=new bD,this.color=new _n(200,0,0,255),this.name="",this.isVisibleOnMultiTrack=!0,this.shortName="",this.defaultSystemsLayout=3,this.systemsLayout=[],this.percussionArticulations=[]}addLineBreaks(t){this.lineBreaks||(this.lineBreaks=new Set),this.lineBreaks.add(t)}ensureStaveCount(t){for(;this.staves.length<t;)this.addStaff(new tw)}addStaff(t){t.index=this.staves.length,t.track=this,this.staves.push(t)}finish(t,n=null){this.shortName||(this.shortName=this.name,this.shortName.length>s.ShortNameMaxLength&&(this.shortName=this.shortName.substr(0,s.ShortNameMaxLength)));for(let i=0,r=this.staves.length;i<r;i++)this.staves[i].finish(t,n)}applyLyrics(t){for(const i of t)i.finish();const n=this.staves[0];for(let i=0;i<t.length;i++){const r=t[i];if(r.startBar>=0&&r.startBar<n.bars.length){let o=n.bars[r.startBar].voices[0].beats[0];for(let a=0;a<r.chunks.length&&o;a++){for(;o&&(o.isEmpty||o.isRest);)o=o.nextBeat;o&&(o.lyrics||(o.lyrics=new Array(t.length),o.lyrics.fill("")),o.lyrics[i]=r.chunks[a],o=o.nextBeat)}}}}}return s.ShortNameMaxLength=10,s})();class Xe{static float64ToBytes(e){return Xe._dataView.setFloat64(0,e,!0),Xe._conversionByteArray}static bytesToInt64LE(e){Xe._conversionByteArray.set(e,0);const t=Xe._dataView.getBigInt64(0,!0);return t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER?Number(t):Number.MAX_SAFE_INTEGER}static bytesToFloat64LE(e){return Xe._conversionByteArray.set(e,0),Xe._dataView.getFloat64(0,!0)}static bytesToFloat32LE(e){return Xe._conversionByteArray.set(e,0),Xe._dataView.getFloat32(0,!0)}static float32BEToBytes(e){return Xe._dataView.setFloat32(0,e,!1),Xe._conversionByteArray.slice(0,4)}static uint16ToInt16(e){return Xe._dataView.setUint16(0,e,!0),Xe._dataView.getInt16(0,!0)}static int16ToUint32(e){return Xe._dataView.setInt16(0,e,!0),Xe._dataView.getUint32(0,!0)}static int32ToUint16(e){return Xe._dataView.setInt32(0,e,!0),Xe._dataView.getUint16(0,!0)}static int32ToInt16(e){return Xe._dataView.setInt32(0,e,!0),Xe._dataView.getInt16(0,!0)}static int32ToUint32(e){return Xe._dataView.setInt32(0,e,!0),Xe._dataView.getUint32(0,!0)}static uint8ToInt8(e){return Xe._dataView.setUint8(0,e),Xe._dataView.getInt8(0)}}Xe._conversionBuffer=new ArrayBuffer(8),Xe._conversionByteArray=new Uint8Array(Xe._conversionBuffer),Xe._dataView=new DataView(Xe._conversionBuffer);class N{static readInt32BE(e){return e.readByte()<<24|e.readByte()<<16|e.readByte()<<8|e.readByte()}static readFloat32BE(e){const t=new Uint8Array(4);return e.read(t,0,t.length),t.reverse(),Xe.bytesToFloat32LE(t)}static readFloat64BE(e){const t=new Uint8Array(8);return e.read(t,0,t.length),t.reverse(),Xe.bytesToFloat64LE(t)}static readInt32LE(e){const t=e.readByte(),n=e.readByte(),i=e.readByte();return e.readByte()<<24|i<<16|n<<8|t}static readInt64LE(e){const t=new Uint8Array(8);return e.read(t,0,t.length),Xe.bytesToInt64LE(t)}static readUInt32LE(e){const t=e.readByte(),n=e.readByte(),i=e.readByte();return e.readByte()<<24|i<<16|n<<8|t}static decodeUInt32LE(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}static readUInt16LE(e){const t=e.readByte(),n=e.readByte();return Xe.int32ToUint16(n<<8|t)}static readInt16LE(e){const t=e.readByte(),n=e.readByte();return Xe.int32ToInt16(n<<8|t)}static readUInt32BE(e){const t=e.readByte(),n=e.readByte(),i=e.readByte(),r=e.readByte();return Xe.int32ToUint32(t<<24|n<<16|i<<8|r)}static readUInt16BE(e){const t=e.readByte(),n=e.readByte();return Xe.int32ToInt16(t<<8|n)}static readInt16BE(e){const t=e.readByte(),n=e.readByte();return Xe.int32ToInt16(t<<8|n)}static readByteArray(e,t){const n=new Uint8Array(t);return e.read(n,0,t),n}static read8BitChars(e,t){const n=new Uint8Array(t);return e.read(n,0,n.length),N.toString(n,"utf-8")}static read8BitString(e){let t="",n=e.readByte();for(;0!==n;)t+=String.fromCharCode(n),n=e.readByte();return t}static read8BitStringLength(e,t){let n="",i=-1;for(let o=0;o<t;o++){const a=e.readByte();0===a&&-1===i&&(i=o),n+=String.fromCharCode(a)}const r=n;return i>=0?r.substr(0,i):r}static readSInt8(e){const t=e.readByte();return-256*((255&t)>>7)+(255&t)}static readInt24(e,t){let n=e[t]|e[t+1]<<8|e[t+2]<<16;return!(8388608&~n)&&(n|=255<<24),n}static readInt16(e,t){return Xe.int32ToInt16(e[t]|e[t+1]<<8)}static toString(e,t){const n=N.detectEncoding(e);return n&&(t=n),t||(t="utf-8"),new TextDecoder(t).decode(e.buffer)}static detectEncoding(e){return e.length>2&&254===e[0]&&255===e[1]?"utf-16be":e.length>2&&255===e[0]&&254===e[1]?"utf-16le":e.length>4&&0===e[0]&&0===e[1]&&254===e[2]&&255===e[3]?"utf-32be":e.length>4&&255===e[0]&&254===e[1]&&0===e[2]&&0===e[3]?"utf-32le":null}static stringToBytes(e){return(new TextEncoder).encode(e)}static writeInt32BE(e,t){e.writeByte(t>>24&255),e.writeByte(t>>16&255),e.writeByte(t>>8&255),e.writeByte(255&t)}static writeInt32LE(e,t){e.writeByte(255&t),e.writeByte(t>>8&255),e.writeByte(t>>16&255),e.writeByte(t>>24&255)}static writeUInt16LE(e,t){e.writeByte(255&t),e.writeByte(t>>8&255)}static writeInt16LE(e,t){e.writeByte(255&t),e.writeByte(t>>8&255)}static writeInt16BE(e,t){e.writeByte(t>>8&255),e.writeByte(255&t)}static writeFloat32BE(e,t){const n=Xe.float32BEToBytes(t);e.write(n,0,n.length)}}class ps{constructor(){this.length=0,this.position=0}get bytesWritten(){return this.position}getBuffer(){return this._buffer}static empty(){return ps.withCapacity(0)}static withCapacity(e){const t=new ps;return t._buffer=new Uint8Array(e),t}static fromBuffer(e){const t=new ps;return t._buffer=e,t.length=e.length,t}static fromString(e){const t=N.stringToBytes(e);return ps.fromBuffer(t)}reset(){this.position=0}skip(e){this.position+=e}readByte(){return this.length-this.position<=0?-1:this._buffer[this.position++]}read(e,t,n){let i=this.length-this.position;return i>n&&(i=n),i<=0?0:(e.set(this._buffer.subarray(this.position,this.position+i),t),this.position+=i,i)}writeByte(e){const t=this.position+1;this.ensureCapacity(t),this._buffer[this.position]=255&e,t>this.length&&(this.length=t),this.position=t}write(e,t,n){const i=this.position+n;this.ensureCapacity(i);const r=Math.min(n,e.length-t);this._buffer.set(e.subarray(t,t+r),this.position),i>this.length&&(this.length=i),this.position=i}ensureCapacity(e){if(e>this._buffer.length){let t=e;t<256&&(t=256),t<2*this._buffer.length&&(t=2*this._buffer.length);const n=new Uint8Array(t);this.length>0&&n.set(this._buffer.subarray(0,0+this.length),0),this._buffer=n}}readAll(){return this.toArray()}toArray(){const e=new Uint8Array(this.length);return e.set(this._buffer.subarray(0,0+this.length),0),e}copyTo(e){e.write(this._buffer,0,this.length)}}var j=function(s){return s[s.TargetFine=0]="TargetFine",s[s.TargetSegno=1]="TargetSegno",s[s.TargetSegnoSegno=2]="TargetSegnoSegno",s[s.TargetCoda=3]="TargetCoda",s[s.TargetDoubleCoda=4]="TargetDoubleCoda",s[s.JumpDaCapo=5]="JumpDaCapo",s[s.JumpDaCapoAlCoda=6]="JumpDaCapoAlCoda",s[s.JumpDaCapoAlDoubleCoda=7]="JumpDaCapoAlDoubleCoda",s[s.JumpDaCapoAlFine=8]="JumpDaCapoAlFine",s[s.JumpDalSegno=9]="JumpDalSegno",s[s.JumpDalSegnoAlCoda=10]="JumpDalSegnoAlCoda",s[s.JumpDalSegnoAlDoubleCoda=11]="JumpDalSegnoAlDoubleCoda",s[s.JumpDalSegnoAlFine=12]="JumpDalSegnoAlFine",s[s.JumpDalSegnoSegno=13]="JumpDalSegnoSegno",s[s.JumpDalSegnoSegnoAlCoda=14]="JumpDalSegnoSegnoAlCoda",s[s.JumpDalSegnoSegnoAlDoubleCoda=15]="JumpDalSegnoSegnoAlDoubleCoda",s[s.JumpDalSegnoSegnoAlFine=16]="JumpDalSegnoSegnoAlFine",s[s.JumpDaCoda=17]="JumpDaCoda",s[s.JumpDaDoubleCoda=18]="JumpDaDoubleCoda",s}(j||{}),Ui=function(s){return s[s.Short=0]="Short",s[s.Medium=1]="Medium",s[s.Long=2]="Long",s}(Ui||{});class Cf{constructor(){this.type=Ui.Short,this.length=0}}var V=function(s){return s[s.Up=0]="Up",s[s.Down=1]="Down",s}(V||{}),k=function(s){return s[s.No=0]="No",s[s.Eof=1]="Eof",s[s.Number=2]="Number",s[s.DoubleDot=3]="DoubleDot",s[s.Dot=4]="Dot",s[s.String=5]="String",s[s.Tuning=6]="Tuning",s[s.LParensis=7]="LParensis",s[s.RParensis=8]="RParensis",s[s.LBrace=9]="LBrace",s[s.RBrace=10]="RBrace",s[s.Pipe=11]="Pipe",s[s.MetaCommand=12]="MetaCommand",s[s.Multiply=13]="Multiply",s[s.LowerThan=14]="LowerThan",s}(k||{}),_i=function(s){return s[s.KnownStaffMeta=0]="KnownStaffMeta",s[s.UnknownStaffMeta=1]="UnknownStaffMeta",s[s.EndOfMetaDetected=2]="EndOfMetaDetected",s}(_i||{});class Ah extends rn{constructor(e,t,n,i,r,o,a,l=null){super(un.AlphaTex,e),this.position=t,this.line=n,this.col=i,this.nonTerm=r??"",this.expected=o??k.No,this.symbol=a??k.No,this.symbolData=l,Object.setPrototypeOf(this,Ah.prototype)}static symbolError(e,t,n,i,r,o,a=null){let l=`MalFormed AlphaTex: @${e} (line ${t}, col ${n}): Error on block ${i}`;return r!==o?(l+=`, expected a ${k[r]} found a ${k[o]}`,null!==a&&(l+=`: '${a}'`)):l+=`, invalid value: '${a}'`,new Ah(l,e,t,n,i,r,o,a)}static errorMessage(e,t,n,i){return new Ah(e=`MalFormed AlphaTex: @${t} (line ${n}, col ${i}): ${e}`,t,n,i,null,null,null,null)}}var zg=function(s){return s[s.Auto=0]="Auto",s[s.Explicit=1]="Explicit",s}(zg||{});let nw=(()=>{class s extends Mh{constructor(){super(...arguments),this._trackChannel=0,this._barIndex=0,this._voiceIndex=0,this._input="",this._ch=s.Eof,this._curChPos=0,this._line=1,this._col=0,this._lastValidSpot=[0,1,0],this._sy=k.No,this._syData="",this._allowNegatives=!1,this._allowFloat=!1,this._allowTuning=!1,this._currentDuration=w.QuadrupleWhole,this._currentDynamics=Te.PPP,this._currentTuplet=0,this._staffHasExplicitDisplayTransposition=!1,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._percussionArticulationNames=new Map,this._sustainPedalToBeat=new Map,this._slurs=new Map,this._articulationValueToIndex=new Map,this._accidentalMode=zg.Explicit,this._syncPoints=[],this.logErrors=!1}get name(){return"AlphaTex"}initFromString(t,n){this.data=ps.empty(),this._input=t,this.settings=n,Cl.resetIds()}readScore(){try{if(this.data.length>0&&(this._input=N.toString(this.data.readAll(),this.settings.importer.encoding)),this._allowTuning=!0,this._lyrics=new Map,this._sustainPedalToBeat=new Map,this.createDefaultScore(),this._curChPos=0,this._line=1,this._col=0,this.saveValidSpot(),this._currentDuration=w.Quarter,this._currentDynamics=Te.F,this._currentTuplet=1,this._ch=this.nextChar(),this._sy=this.newSy(),this._sy===k.LowerThan)throw new Ts("Unknown start sign '<' (meant to import as XML?)");if(this._sy!==k.Eof){const t=this.metaData(),n=this.bars();if(!t&&!n)throw new Ts("No alphaTex data found");this._sy===k.Dot&&(this._sy=this.newSy(),this.syncPoints())}ie.consolidate(this._score),this._score.finish(this.settings),ie.trimEmptyBarsAtEnd(this._score),this._score.rebuildRepeatGroups(),this._score.applyFlatSyncPoints(this._syncPoints);for(const[t,n]of this._lyrics)this._score.tracks[t].applyLyrics(n);for(const[t,n]of this._sustainPedalToBeat){const i=n.voice.bar.masterBar.calculateDuration();t.ratioPosition=n.playbackStart/i}return this._score}catch(t){throw t instanceof Ah?new Ts(t.message,t):t}}syncPoints(){for(;this._sy!==k.Eof;)this.syncPoint()}syncPoint(){(this._sy!==k.MetaCommand||"sync"!==this._syData)&&this.error("syncPoint",k.MetaCommand,!0),this._sy=this.newSy(),this._sy!==k.Number&&this.error("syncPointBarIndex",k.Number,!0);const t=this._syData;this._sy=this.newSy(),this._sy!==k.Number&&this.error("syncPointBarOccurence",k.Number,!0);const n=this._syData;this._sy=this.newSy(),this._sy!==k.Number&&this.error("syncPointBarMillis",k.Number,!0);const i=this._syData;this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1;let r=0;this._sy===k.Number&&(r=this._syData,this._sy=this.newSy()),this._syncPoints.push({barIndex:t,barOccurence:n,barPosition:r,millisecondOffset:i})}error(t,n,i=!0){let r,o=!1;i?(r=this._sy,(r===k.String||r===k.Number||r===k.MetaCommand)&&(o=!0)):r=n;const a=Ah.symbolError(this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2],t,n,r,o?this._syData:null);throw this.logErrors&&F.error(this.name,a.message),a}errorMessage(t){const n=Ah.errorMessage(t,this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2]);throw this.logErrors&&F.error(this.name,n.message),n}createDefaultScore(){this._score=new Cl,this._score.tempo=120,this._score.tempoLabel="",this.newTrack()}newTrack(){this._currentTrack=new Ph,this._currentTrack.ensureStaveCount(1),this._currentTrack.playbackInfo.program=25,this._currentTrack.playbackInfo.primaryChannel=this._trackChannel++,this._currentTrack.playbackInfo.secondaryChannel=this._trackChannel++;const t=this._currentTrack.staves[0];t.displayTranspositionPitch=0,t.stringTuning.tunings=z.getDefaultTuningFor(6).tunings,this._articulationValueToIndex.clear(),this.beginStaff(t),this._score.addTrack(this._currentTrack),this._lyrics.set(this._currentTrack.index,[]),this._currentDynamics=Te.F}parseClefFromString(t){switch(t.toLowerCase()){case"g2":case"treble":default:return Et.G2;case"f4":case"bass":return Et.F4;case"c3":case"tenor":return Et.C3;case"c4":case"alto":return Et.C4;case"n":case"neutral":return Et.Neutral}}parseClefFromInt(t){switch(t){case 43:default:return Et.G2;case 65:return Et.F4;case 48:return Et.C3;case 60:return Et.C4}}parseTripletFeelFromString(t){switch(t.toLowerCase()){case"no":case"none":default:return nt.NoTripletFeel;case"t16":case"triplet-16th":return nt.Triplet16th;case"t8":case"triplet-8th":return nt.Triplet8th;case"d16":case"dotted-16th":return nt.Dotted16th;case"d8":case"dotted-8th":return nt.Dotted8th;case"s16":case"scottish-16th":return nt.Scottish16th;case"s8":case"scottish-8th":return nt.Scottish8th}}parseTripletFeelFromInt(t){switch(t){case 0:default:return nt.NoTripletFeel;case 1:return nt.Triplet16th;case 2:return nt.Triplet8th;case 3:return nt.Dotted16th;case 4:return nt.Dotted8th;case 5:return nt.Scottish16th;case 6:return nt.Scottish8th}}parseKeySignature(t){switch(t.toLowerCase()){case"cb":case"cbmajor":case"abminor":return wt.Cb;case"gb":case"gbmajor":case"ebminor":return wt.Gb;case"db":case"dbmajor":case"bbminor":return wt.Db;case"ab":case"abmajor":case"fminor":return wt.Ab;case"eb":case"ebmajor":case"cminor":return wt.Eb;case"bb":case"bbmajor":case"gminor":return wt.Bb;case"f":case"fmajor":case"dminor":return wt.F;case"c":case"cmajor":case"aminor":default:return wt.C;case"g":case"gmajor":case"eminor":return wt.G;case"d":case"dmajor":case"bminor":return wt.D;case"a":case"amajor":case"f#minor":return wt.A;case"e":case"emajor":case"c#minor":return wt.E;case"b":case"bmajor":case"g#minor":return wt.B;case"f#":case"f#major":case"d#minor":return wt.FSharp;case"c#":case"c#major":case"a#minor":return wt.CSharp}}parseKeySignatureType(t){return t.toLowerCase().endsWith("minor")?dr.Minor:dr.Major}nextChar(){return this._curChPos<this._input.length?(this._ch=this._input.charCodeAt(this._curChPos++),10===this._ch?(this._line++,this._col=0):this._col++):this._ch=s.Eof,this._ch}saveValidSpot(){this._lastValidSpot=[this._curChPos,this._line,this._col]}newSy(){for(this.saveValidSpot(),this._sy=k.No;this._sy===k.No;)if(this._ch===s.Eof)this._sy=k.Eof;else if(s.isWhiteSpace(this._ch))this._ch=this.nextChar(),this.saveValidSpot();else if(47===this._ch){if(this._ch=this.nextChar(),47===this._ch)for(;13!==this._ch&&10!==this._ch&&this._ch!==s.Eof;)this._ch=this.nextChar();else if(42===this._ch)for(;this._ch!==s.Eof;)if(42===this._ch){if(this._ch=this.nextChar(),47===this._ch){this._ch=this.nextChar();break}}else this._ch=this.nextChar();else this.error("comment",k.String,!1);this.saveValidSpot()}else if(34===this._ch||39===this._ch){const t=this._ch;this._ch=this.nextChar();let n="";for(this._sy=k.String;this._ch!==t&&this._ch!==s.Eof;)92===this._ch?(this._ch=this.nextChar(),92===this._ch?n+="\\":this._ch===t?n+=String.fromCharCode(this._ch):82===this._ch||114===this._ch?n+="\r":78===this._ch||110===this._ch?n+="\n":84===this._ch||116===this._ch?n+="\t":this.errorMessage("Unsupported escape sequence")):n+=String.fromCharCode(this._ch),this._ch=this.nextChar();this._ch===s.Eof&&this.errorMessage("String opened but never closed"),this._syData=n,this._ch=this.nextChar()}else if(45===this._ch)this._allowNegatives?this.readNumberOrName():(this._sy=k.String,this._syData=this.readName());else if(46===this._ch)this._sy=k.Dot,this._ch=this.nextChar();else if(58===this._ch)this._sy=k.DoubleDot,this._ch=this.nextChar();else if(40===this._ch)this._sy=k.LParensis,this._ch=this.nextChar();else if(92===this._ch)this._ch=this.nextChar(),this._sy=k.MetaCommand,92===this._ch&&(this._ch=this.nextChar()),this._syData=this.readName();else if(41===this._ch)this._sy=k.RParensis,this._ch=this.nextChar();else if(123===this._ch)this._sy=k.LBrace,this._ch=this.nextChar();else if(125===this._ch)this._sy=k.RBrace,this._ch=this.nextChar();else if(124===this._ch)this._sy=k.Pipe,this._ch=this.nextChar();else if(42===this._ch)this._sy=k.Multiply,this._ch=this.nextChar();else if(60===this._ch)this._sy=k.LowerThan,this._ch=this.nextChar();else if(this.isDigit(this._ch))this.readNumberOrName();else if(s.isNameLetter(this._ch)){const t=this.readName(),n=this._allowTuning?ie.parseTuning(t):null;n?(this._sy=k.Tuning,this._syData=n):(this._sy=k.String,this._syData=t)}else this.error("symbol",k.String,!1);return this._sy}readNumberOrName(){let t="",n=!0;do{t+=String.fromCharCode(this._ch),this.isDigit(this._ch)||(n=!1),this._ch=this.nextChar()}while(this.isDigit(this._ch)||s.isNameLetter(this._ch));n?(this._sy=k.Number,this._syData=this._allowFloat?Number.parseFloat(t):Number.parseInt(t)):(this._sy=k.String,this._syData=t)}static isNameLetter(t){return!s.isTerminal(t)&&(33<=t&&t<=47||58<=t&&t<=126||128<=t)}static isTerminal(t){return 46===t||123===t||125===t||91===t||93===t||40===t||41===t||124===t||39===t||34===t||42===t||92===t}static isWhiteSpace(t){return 9===t||10===t||11===t||13===t||32===t}isDigit(t){return t>=48&&t<=57||this._allowNegatives&&45===t||this._allowFloat&&46===t}readName(){let t="";do{t+=String.fromCharCode(this._ch),this._ch=this.nextChar()}while(s.isNameLetter(this._ch)||this.isDigit(this._ch));return t}metaData(){let t=!1,n=!1,i=!0;for(;this._sy===k.MetaCommand&&i;){const r=this._syData.toLowerCase();switch(r){case"title":case"subtitle":case"artist":case"album":case"words":case"music":case"copyright":case"instructions":case"notices":case"tab":this._sy=this.newSy(),this._sy!==k.String&&this.error(r,k.String,!0);const o=this._syData;this._sy=this.newSy(),t=!0;let a=re.ChordDiagramList;switch(r){case"title":this._score.title=o,a=re.Title;break;case"subtitle":this._score.subTitle=o,a=re.SubTitle;break;case"artist":this._score.artist=o,a=re.Artist;break;case"album":this._score.album=o,a=re.Album;break;case"words":this._score.words=o,a=re.Words;break;case"music":this._score.music=o,a=re.Music;break;case"copyright":this._score.copyright=o,a=re.Copyright;break;case"instructions":this._score.instructions=o;break;case"notices":this._score.notices=o;break;case"tab":this._score.tab=o,a=re.Transcriber}a!==re.ChordDiagramList&&this.headerFooterStyle(a);break;case"copyright2":this._sy=this.newSy(),this._sy!==k.String&&this.error(r,k.String,!0),this.headerFooterStyle(re.CopyrightSecondLine),t=!0;break;case"wordsandmusic":this._sy=this.newSy(),this._sy!==k.String&&this.error(r,k.String,!0),this.headerFooterStyle(re.WordsAndMusic),t=!0;break;case"tempo":this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy===k.Number?this._score.tempo=this._syData:this.error("tempo",k.Number,!0),this._sy=this.newSy(),this._sy===k.String&&(this._score.tempoLabel=this._syData,this._sy=this.newSy()),t=!0;break;case"defaultsystemslayout":this._sy=this.newSy(),this._sy===k.Number?(this._score.defaultSystemsLayout=this._syData,this._sy=this.newSy(),t=!0):this.error("default-systems-layout",k.Number,!0);break;case"systemslayout":for(this._sy=this.newSy(),t=!0;this._sy===k.Number;)this._score.systemsLayout.push(this._syData),this._sy=this.newSy();break;case"hidedynamics":this._score.stylesheet.hideDynamics=!0,this._sy=this.newSy(),t=!0;break;case"showdynamics":this._score.stylesheet.hideDynamics=!1,this._sy=this.newSy(),t=!0;break;case"bracketextendmode":this._sy=this.newSy(),this._sy!==k.String&&this.error("bracketExtendMode",k.String,!0),this._score.stylesheet.bracketExtendMode=this.parseBracketExtendMode(this._syData),this._sy=this.newSy(),t=!0;break;case"usesystemsignseparator":this._score.stylesheet.useSystemSignSeparator=!0,this._sy=this.newSy(),t=!0;break;case"multibarrest":this._score.stylesheet.multiTrackMultiBarRest=!0,this._sy=this.newSy(),t=!0;break;case"singletracktracknamepolicy":this._sy=this.newSy(),this._sy!==k.String&&this.error("singleTrackTrackNamePolicy",k.String,!0),this._score.stylesheet.singleTrackTrackNamePolicy=this.parseTrackNamePolicy(this._syData),this._sy=this.newSy(),t=!0;break;case"multitracktracknamepolicy":this._sy=this.newSy(),this._sy!==k.String&&this.error("multiTrackTrackNamePolicy",k.String,!0),this._score.stylesheet.multiTrackTrackNamePolicy=this.parseTrackNamePolicy(this._syData),this._sy=this.newSy(),t=!0;break;case"firstsystemtracknamemode":this._sy=this.newSy(),this._sy!==k.String&&this.error("firstSystemTrackNameMode",k.String,!0),this._score.stylesheet.firstSystemTrackNameMode=this.parseTrackNameMode(this._syData),this._sy=this.newSy(),t=!0;break;case"othersystemstracknamemode":this._sy=this.newSy(),this._sy!==k.String&&this.error("otherSystemsTrackNameMode",k.String,!0),this._score.stylesheet.otherSystemsTrackNameMode=this.parseTrackNameMode(this._syData),this._sy=this.newSy(),t=!0;break;case"firstsystemtracknameorientation":this._sy=this.newSy(),this._sy!==k.String&&this.error("firstSystemTrackNameOrientation",k.String,!0),this._score.stylesheet.firstSystemTrackNameOrientation=this.parseTrackNameOrientation(this._syData),this._sy=this.newSy(),t=!0;break;case"othersystemstracknameorientation":this._sy=this.newSy(),this._sy!==k.String&&this.error("otherSystemsTrackNameOrientation",k.String,!0),this._score.stylesheet.otherSystemsTrackNameOrientation=this.parseTrackNameOrientation(this._syData),this._sy=this.newSy(),t=!0;break;default:switch(this.handleStaffMeta()){case _i.KnownStaffMeta:n=!0;break;case _i.UnknownStaffMeta:t||n?this.error("metaDataTags",k.String,!1):i=!1;break;case _i.EndOfMetaDetected:i=!1}}}return t?(this._sy!==k.Dot&&this.error("song",k.Dot,!0),this._sy=this.newSy()):this._sy===k.Dot&&(this._sy=this.newSy(),t=!0),t||n}headerFooterStyle(t){const n=ie.getOrCreateHeaderFooterStyle(this._score,t);if(void 0===n.isVisible&&(n.isVisible=!0),this._sy===k.String){const i=this._syData;i?n.template=i:n.isVisible=!1,this._sy=this.newSy()}if(this._sy===k.String){switch(this._syData.toLowerCase()){case"left":n.textAlign=ye.Left;break;case"center":n.textAlign=ye.Center;break;case"right":n.textAlign=ye.Right}this._sy=this.newSy()}}parseTrackNamePolicy(t){switch(t.toLowerCase()){case"hidden":return rs.Hidden;case"allsystems":return rs.AllSystems;default:return rs.FirstSystem}}parseTrackNameMode(t){return"fullname"===t.toLowerCase()?Wi.FullName:Wi.ShortName}parseTrackNameOrientation(t){return"horizontal"===t.toLowerCase()?Gi.Horizontal:Gi.Vertical}handleStaffMeta(){switch(this._syData.toLowerCase()){case"capo":return this._sy=this.newSy(),this._sy===k.Number?this._currentStaff.capo=this._syData:this.error("capo",k.Number,!0),this._sy=this.newSy(),_i.KnownStaffMeta;case"tuning":this._sy=this.newSy();const t=this._currentStaff.tuning.length;switch(this._staffHasExplicitTuning=!0,this._staffTuningApplied=!1,this._sy){case k.String:const a=this._syData.toLowerCase();"piano"===a||"none"===a||"voice"===a?this.makeCurrentStaffPitched():this.error("tuning",k.Tuning,!0),this._sy=this.newSy();break;case k.Tuning:const l=[];do{l.push(this._syData.realValue),this._sy=this.newSy()}while(this._sy===k.Tuning);this._currentStaff.stringTuning.tunings=l;break;default:this.error("tuning",k.Tuning,!0)}return this._sy===k.String&&"hide"===this._syData.toLowerCase()&&(this._score.stylesheet.perTrackDisplayTuning||(this._score.stylesheet.perTrackDisplayTuning=new Map),this._score.stylesheet.perTrackDisplayTuning.set(this._currentTrack.index,!1),this._sy=this.newSy()),t!==this._currentStaff.tuning.length&&(this._currentStaff.chords?.size??0)>0&&this.errorMessage("Tuning must be defined before any chord"),_i.KnownStaffMeta;case"instrument":if(this._sy=this.newSy(),this._staffTuningApplied=!1,this._sy===k.Number){const a=this._syData;a>=0&&a<=127?this._currentTrack.playbackInfo.program=this._syData:this.error("instrument",k.Number,!1)}else if(this._sy===k.String){const a=this._syData.toLowerCase();if("percussion"===a){for(const l of this._currentTrack.staves)this.applyPercussionStaff(l);this._currentTrack.playbackInfo.primaryChannel=xe.PercussionChannel,this._currentTrack.playbackInfo.secondaryChannel=xe.PercussionChannel}else this._currentTrack.playbackInfo.program=Va.getValue(a)}else this.error("instrument",k.Number,!0);return this._sy=this.newSy(),_i.KnownStaffMeta;case"lyrics":this._sy=this.newSy();const n=new Tf;return n.startBar=0,n.text="",this._sy===k.Number&&(n.startBar=this._syData,this._sy=this.newSy()),this._sy===k.String?(n.text=this._syData,this._sy=this.newSy()):this.error("lyrics",k.String,!0),this._lyrics.get(this._currentTrack.index).push(n),_i.KnownStaffMeta;case"chord":this._sy=this.newSy();const i=new gc;this.chordProperties(i),this._sy===k.String?(i.name=this._syData,this._sy=this.newSy()):this.error("chord-name",k.String,!0);for(let a=0;a<this._currentStaff.tuning.length;a++)this._sy===k.Number?i.strings.push(this._syData):this._sy===k.String&&"x"===this._syData.toLowerCase()&&i.strings.push(-1),this._sy=this.newSy();return this._currentStaff.addChord(this.getChordId(this._currentStaff,i.name),i),_i.KnownStaffMeta;case"articulation":this._sy=this.newSy();let r="";if(this._sy===k.String?(r=this._syData,this._sy=this.newSy()):this.error("articulation-name",k.String,!0),"defaults"===r){for(const[a,l]of Gs.instrumentArticulationNames)this._percussionArticulationNames.set(a.toLowerCase(),l),this._percussionArticulationNames.set(s.toArticulationId(a),l);return _i.KnownStaffMeta}let o=0;return this._sy===k.Number?(o=this._syData,this._sy=this.newSy()):this.error("articulation-number",k.Number,!0),Gs.instrumentArticulations.has(o)||this.errorMessage(`Unknown articulation ${o}. Refer to https://www.alphatab.net/docs/alphatex/percussion for available ids`),this._percussionArticulationNames.set(r.toLowerCase(),o),_i.KnownStaffMeta;case"accidentals":return this.handleAccidentalMode(),_i.KnownStaffMeta;case"displaytranspose":return this._allowNegatives=!0,this._sy=this.newSy(),this._sy===k.Number?(this._currentStaff.displayTranspositionPitch=-1*this._syData,this._staffHasExplicitDisplayTransposition=!0):this.error("displaytranspose",k.Number,!0),this._allowNegatives=!1,this._sy=this.newSy(),_i.KnownStaffMeta;case"transpose":return this._allowNegatives=!0,this._sy=this.newSy(),this._sy===k.Number?this._currentStaff.transpositionPitch=-1*this._syData:this.error("transpose",k.Number,!0),this._allowNegatives=!1,this._sy=this.newSy(),_i.KnownStaffMeta;case"track":case"staff":return _i.EndOfMetaDetected;case"voice":return this._sy=this.newSy(),this.handleNewVoice()?_i.EndOfMetaDetected:_i.KnownStaffMeta;default:return _i.UnknownStaffMeta}}handleAccidentalMode(){switch(this._sy=this.newSy(),this._sy!==k.String&&this.error("accidental-mode",k.String,!0),this._syData){case"auto":this._accidentalMode=zg.Auto;break;case"explicit":this._accidentalMode=zg.Explicit}this._sy=this.newSy()}makeCurrentStaffPitched(){this._currentStaff.stringTuning.tunings=[],this._staffHasExplicitDisplayTransposition||(this._currentStaff.displayTranspositionPitch=0)}static toArticulationId(t){return t.replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}applyPercussionStaff(t){t.isPercussion=!0,t.showTablature=!1}chordProperties(t){if(this._sy===k.LBrace){for(this._sy=this.newSy();this._sy===k.String;)switch(this._syData.toLowerCase()){case"firstfret":this._sy=this.newSy(),this._sy===k.Number?t.firstFret=this._syData:this.error("chord-firstfret",k.Number,!0),this._sy=this.newSy();break;case"showdiagram":switch(this._sy=this.newSy(),this._sy){case k.String:t.showDiagram="false"!==this._syData.toLowerCase();break;case k.Number:t.showDiagram=0!==this._syData;break;default:this.error("chord-showdiagram",k.String,!0)}this._sy=this.newSy();break;case"showfingering":switch(this._sy=this.newSy(),this._sy){case k.String:t.showDiagram="false"!==this._syData.toLowerCase();break;case k.Number:t.showFingering=0!==this._syData;break;default:this.error("chord-showfingering",k.String,!0)}this._sy=this.newSy();break;case"showname":switch(this._sy=this.newSy(),this._sy){case k.String:t.showName="false"!==this._syData.toLowerCase();break;case k.Number:t.showName=0!==this._syData;break;default:this.error("chord-showname",k.String,!0)}this._sy=this.newSy();break;case"barre":for(this._sy=this.newSy();this._sy===k.Number;)t.barreFrets.push(this._syData),this._sy=this.newSy();break;default:this.error("chord-properties",k.String,!1)}this._sy!==k.RBrace&&this.error("chord-properties",k.RBrace,!0),this._sy=this.newSy()}}bars(){const t=this.bar();for(;this._sy!==k.Eof;)if(this._sy===k.Pipe)this._sy=this.newSy(),this.bar();else{if(this._sy!==k.MetaCommand)break;this.bar()}return t}trackStaffMeta(){if(this._sy!==k.MetaCommand)return!1;if("track"===this._syData.toLowerCase()&&(this._staffHasExplicitDisplayTransposition=!1,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._score.masterBars.length>0&&this.newTrack(),this._sy===k.String&&(this._currentTrack.name=this._syData,this._sy=this.newSy()),this._sy===k.String&&(this._currentTrack.shortName=this._syData,this._sy=this.newSy()),this.trackProperties()),this._sy===k.MetaCommand&&"staff"===this._syData.toLowerCase()){if(this._staffHasExplicitDisplayTransposition=!1,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._currentTrack.staves[0].bars.length>0){const t=this._currentStaff.isPercussion;this._currentTrack.ensureStaveCount(this._currentTrack.staves.length+1),this.beginStaff(this._currentTrack.staves[this._currentTrack.staves.length-1]),t&&this.applyPercussionStaff(this._currentStaff),this._currentDynamics=Te.F}this.staffProperties()}return this._sy===k.MetaCommand&&"voice"===this._syData.toLowerCase()&&(this._sy=this.newSy(),this.handleNewVoice()),!0}handleNewVoice(){if(0===this._voiceIndex&&(0===this._currentStaff.bars.length||1===this._currentStaff.bars.length&&this._currentStaff.bars[0].isEmpty))return!1;for(const t of this._currentStaff.bars){const n=new ko;t.addVoice(n)}return this._voiceIndex++,this._barIndex=0,!0}beginStaff(t){this._currentStaff=t,this._slurs.clear(),this._barIndex=0,this._voiceIndex=0}trackProperties(){if(this._sy===k.LBrace){for(this._sy=this.newSy();this._sy===k.String;)switch(this._syData.toLowerCase()){case"color":this._sy=this.newSy(),this._sy!==k.String&&this.error("track-color",k.String,!0),this._currentTrack.color=_n.fromJson(this._syData),this._sy=this.newSy();break;case"defaultsystemslayout":this._sy=this.newSy(),this._sy===k.Number?(this._currentTrack.defaultSystemsLayout=this._syData,this._sy=this.newSy()):this.error("default-systems-layout",k.Number,!0);break;case"systemslayout":for(this._sy=this.newSy();this._sy===k.Number;)this._currentTrack.systemsLayout.push(this._syData),this._sy=this.newSy();break;case"volume":this._sy=this.newSy(),this._sy!==k.Number&&this.error("track-volume",k.Number,!0),this._currentTrack.playbackInfo.volume=ie.clamp(this._syData,0,16),this._sy=this.newSy();break;case"balance":this._sy=this.newSy(),this._sy!==k.Number&&this.error("track-balance",k.Number,!0),this._currentTrack.playbackInfo.balance=ie.clamp(this._syData,0,16),this._sy=this.newSy();break;case"mute":this._sy=this.newSy(),this._currentTrack.playbackInfo.isMute=!0;break;case"solo":this._sy=this.newSy(),this._currentTrack.playbackInfo.isSolo=!0;break;case"multibarrest":this._sy=this.newSy(),this._score.stylesheet.perTrackMultiBarRest||(this._score.stylesheet.perTrackMultiBarRest=new Set),this._score.stylesheet.perTrackMultiBarRest.add(this._currentTrack.index);break;default:this.error("track-properties",k.String,!1)}this._sy!==k.RBrace&&this.error("track-properties",k.RBrace,!0),this._sy=this.newSy()}}staffProperties(){if(this._sy!==k.LBrace)return;this._sy=this.newSy();let t=!1,n=!1,i=!1,r=!1;for(;this._sy===k.String;)switch(this._syData.toLowerCase()){case"score":t=!0,this._sy=this.newSy(),this._sy===k.Number&&(this._currentStaff.standardNotationLineCount=this._syData,this._sy=this.newSy());break;case"tabs":n=!0,this._sy=this.newSy();break;case"slash":i=!0,this._sy=this.newSy();break;case"numbered":r=!0,this._sy=this.newSy();break;default:this.error("staff-properties",k.String,!1)}(t||n||i||r)&&(this._currentStaff.showStandardNotation=t,this._currentStaff.showTablature=n,this._currentStaff.showSlash=i,this._currentStaff.showNumbered=r),this._sy!==k.RBrace&&this.error("staff-properties",k.RBrace,!0),this._sy=this.newSy()}bar(){const t=this.trackStaffMeta(),n=this.newBar(this._currentStaff);if(this._currentStaff.bars.length>this._score.masterBars.length){const c=new kl;this._score.addMasterBar(c),c.index>0&&(c.timeSignatureDenominator=c.previousMasterBar.timeSignatureDenominator,c.timeSignatureNumerator=c.previousMasterBar.timeSignatureNumerator,c.tripletFeel=c.previousMasterBar.tripletFeel)}const i=this.barMeta(n),r=this._currentTrack.playbackInfo.program;!this._staffTuningApplied&&!this._staffHasExplicitTuning&&(this._currentStaff.stringTuning.tunings=[],15===r||r>=24&&r<=31?this._currentStaff.stringTuning.tunings=z.getDefaultTuningFor(6).tunings:r>=32&&r<=39?this._currentStaff.stringTuning.tunings=[43,38,33,28]:40===r||44===r||45===r||48===r||49===r||50===r||51===r?this._currentStaff.stringTuning.tunings=[52,57,50,43]:41===r?this._currentStaff.stringTuning.tunings=[57,50,43,36]:42===r?this._currentStaff.stringTuning.tunings=[45,38,31,24]:43===r?this._currentStaff.stringTuning.tunings=[43,38,33,28]:105===r?this._currentStaff.stringTuning.tunings=[50,47,43,38,55]:106===r?this._currentStaff.stringTuning.tunings=[57,52,45]:107===r?this._currentStaff.stringTuning.tunings=[52,45,38,31]:110===r&&(this._currentStaff.stringTuning.tunings=[64,57,50,43]),this._staffTuningApplied=!0),this._staffHasExplicitDisplayTransposition||(this._currentStaff.displayTranspositionPitch=r>=24&&r<=31||r>=32&&r<=39||43===r?-12:0);let o=!1;const a=n.voices[this._voiceIndex];if(this._sy!==k.MetaCommand||"track"!==this._syData.toLowerCase()&&"staff"!==this._syData.toLowerCase())for(;this._sy!==k.Pipe&&this._sy!==k.Eof&&this.beat(a);)o=!0;if(0===a.beats.length){const c=new Ei;c.isEmpty=!0,a.addBeat(c)}return t||i||o}newBar(t){if(this._barIndex<t.bars.length){const r=t.bars[this._barIndex];return this._barIndex++,r}const n=0===t.bars.length?1:t.bars[0].voices.length,i=new Sl;t.addBar(i),i.previousBar&&(i.clef=i.previousBar.clef,i.clefOttava=i.previousBar.clefOttava,i.keySignature=i.previousBar.keySignature,i.keySignatureType=i.previousBar.keySignatureType),this._barIndex++;for(let r=0;r<n;r++){const o=new ko;i.addVoice(o)}return i}beat(t){this.beatDuration();const n=new Ei;if(t.addBeat(n),this._allowTuning=!this._currentStaff.isPercussion,this._sy===k.LParensis){for(this._sy=this.newSy(),this.note(n);this._sy!==k.RParensis&&this._sy!==k.Eof&&(this._allowTuning=!this._currentStaff.isPercussion,this.note(n)););this._sy!==k.RParensis&&this.error("note-list",k.RParensis,!0),this._sy=this.newSy()}else if(this._sy===k.String&&"r"===this._syData.toLowerCase())this._sy=this.newSy();else if(!this.note(n))return t.beats.splice(t.beats.length-1,1),!1;this._sy===k.Dot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==k.Number&&this.error("duration",k.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._sy=this.newSy()),n.duration=this._currentDuration,n.dynamics=this._currentDynamics,1!==this._currentTuplet&&!n.hasTuplet&&s.applyTuplet(n,this._currentTuplet);let i=1;this._sy===k.Multiply&&(this._sy=this.newSy(),this._sy!==k.Number?this.error("multiplier",k.Number,!0):i=this._syData,this._sy=this.newSy()),this.beatEffects(n);for(let r=0;r<i-1;r++)t.addBeat(_D.clone(n));return!0}beatDuration(){if(this._sy===k.DoubleDot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==k.Number&&this.error("duration",k.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._currentTuplet=1,this._sy=this.newSy(),this._sy===k.LBrace)){for(this._sy=this.newSy();this._sy===k.String;)"tu"===this._syData.toLowerCase()?(this._sy=this.newSy(),this._sy!==k.Number&&this.error("duration-tuplet",k.Number,!0),this._currentTuplet=this._syData,this._sy=this.newSy()):this.error("beat-duration",k.String,!1);this._sy!==k.RBrace&&this.error("beat-duration",k.RBrace,!0),this._sy=this.newSy()}}beatEffects(t){if(this._sy===k.LBrace){for(this._sy=this.newSy();this._sy===k.String;)this.applyBeatEffect(t)||this.error("beat-effects",k.String,!1);this._sy!==k.RBrace&&this.error("beat-effects",k.RBrace,!0),this._sy=this.newSy()}}applyBeatEffect(t){const n=this._syData.toLowerCase();if("f"===n)t.fade=Ks.FadeIn;else if("fo"===n)t.fade=Ks.FadeOut;else if("vs"===n)t.fade=Ks.VolumeSwell;else if("v"===n)t.vibrato=Ft.Slight;else if("vw"===n)t.vibrato=Ft.Wide;else if("s"===n)t.slap=!0;else if("p"===n)t.pop=!0;else if("tt"===n)t.tap=!0;else if("txt"===n){if(this._sy=this.newSy(),this._sy!==k.String)return this.error("beat-text",k.String,!0),!1;t.text=this._syData}else if("dd"===n)t.dots=2;else if("d"===n)t.dots=1;else if("su"===n)t.pickStroke=yi.Up;else if("sd"===n)t.pickStroke=yi.Down;else{if("tu"===n){if(this._sy=this.newSy(),this._sy!==k.Number)return this.error("tuplet",k.Number,!0),!1;const i=this._syData;if(this._sy=this.newSy(),this._sy===k.Number){const r=this._syData;this._sy=this.newSy(),t.tupletNumerator=i,t.tupletDenominator=r}else s.applyTuplet(t,i);return!0}if("tb"===n||"tbe"===n){this._sy=this.newSy();const i="tbe"===n;for(this._sy===k.String&&(t.whammyBarType=this.parseWhammyType(this._syData),this._sy=this.newSy()),this._sy===k.String&&(t.whammyStyle=this.parseBendStyle(this._syData),this._sy=this.newSy()),this._sy!==k.LParensis&&this.error("tremolobar-effect",k.LParensis,!0),this._allowNegatives=!0,this._allowFloat=!0,this._sy=this.newSy();this._sy!==k.RParensis&&this._sy!==k.Eof;){let r=0,o=0;i?(this._sy!==k.Number&&this.error("tremolobar-effect",k.Number,!0),r=this._syData,this._sy=this.newSy(),this._sy!==k.Number&&this.error("tremolobar-effect",k.Number,!0),o=this._syData):(this._sy!==k.Number&&this.error("tremolobar-effect",k.Number,!0),r=0,o=this._syData),t.addWhammyBarPoint(new se(r,o)),this._sy=this.newSy()}if(null!=t.whammyBarPoints){for(;t.whammyBarPoints.length>60;)t.removeWhammyBarPoint(t.whammyBarPoints.length-1);if(i)t.whammyBarPoints.sort((r,o)=>r.offset-o.offset);else{const r=t.whammyBarPoints.length,o=60/r|0;let a=0;for(;a<r;)t.whammyBarPoints[a].offset=Math.min(60,a*o),a++}}this._allowNegatives=!1,this._allowFloat=!1,this._sy!==k.RParensis&&this.error("tremolobar-effect",k.RParensis,!0)}else{if("bu"===n||"bd"===n||"au"===n||"ad"===n){switch(n){case"bu":t.brushType=fe.BrushUp;break;case"bd":t.brushType=fe.BrushDown;break;case"au":t.brushType=fe.ArpeggioUp;break;case"ad":t.brushType=fe.ArpeggioDown}return this._sy=this.newSy(),this._sy===k.Number?(t.brushDuration=this._syData,this._sy=this.newSy(),!0):(t.updateDurations(),"bu"===n||"bd"===n?t.brushDuration=t.playbackDuration/4/t.notes.length:("au"===n||"ad"===n)&&(t.brushDuration=t.playbackDuration/t.notes.length),!0)}if("ch"===n){this._sy=this.newSy();const i=this._syData,r=this.getChordId(this._currentStaff,i);if(!this._currentStaff.hasChord(r)){const o=new gc;o.showDiagram=!1,o.name=i,this._currentStaff.addChord(r,o)}t.chordId=r}else{if("gr"===n)return this._sy=this.newSy(),"ob"===this._syData.toLowerCase()?(t.graceType=Ee.OnBeat,this._sy=this.newSy()):"b"===this._syData.toLowerCase()?(t.graceType=Ee.BendGrace,this._sy=this.newSy()):t.graceType=Ee.BeforeBeat,!0;if("dy"===n){this._sy=this.newSy();const i=this._syData.toUpperCase();switch(i){case"PPP":case"PP":case"P":case"MP":case"MF":case"F":case"FF":case"FFF":case"PPPP":case"PPPPP":case"PPPPPP":case"FFFF":case"FFFFF":case"FFFFFF":case"SF":case"SFP":case"SFPP":case"FP":case"RF":case"RFZ":case"SFZ":case"SFFZ":case"FZ":case"N":case"PF":case"SFZP":t.dynamics=Te[i]}this._currentDynamics=t.dynamics}else if("cre"===n)t.crescendo=Zi.Crescendo;else if("dec"===n)t.crescendo=Zi.Decrescendo;else{if("tempo"===n){const i=this.readTempoAutomation();return t.automations.push(i),t.voice.bar.masterBar.tempoAutomations.push(i),!0}if("tp"===n){if(this._sy=this.newSy(),t.tremoloSpeed=w.Eighth,this._sy===k.Number){switch(this._syData){case 8:default:t.tremoloSpeed=w.Eighth;break;case 16:t.tremoloSpeed=w.Sixteenth;break;case 32:t.tremoloSpeed=w.ThirtySecond}this._sy=this.newSy()}return!0}if("spd"===n){const i=new gu;return i.pedalType=Ms.Down,i.ratioPosition=t.voice.bar.sustainPedals.length,this._sustainPedalToBeat.set(i,t),t.voice.bar.sustainPedals.push(i),this._sy=this.newSy(),!0}if("spu"===n){const i=new gu;return i.pedalType=Ms.Up,i.ratioPosition=t.voice.bar.sustainPedals.length,this._sustainPedalToBeat.set(i,t),t.voice.bar.sustainPedals.push(i),this._sy=this.newSy(),!0}if("spe"===n){const i=new gu;return i.pedalType=Ms.Up,i.ratioPosition=1,t.voice.bar.sustainPedals.push(i),this._sy=this.newSy(),!0}if("slashed"===n)return t.slashed=!0,this._sy=this.newSy(),!0;if("ds"===n)return t.deadSlapped=!0,this._sy=this.newSy(),!0;if("glpf"===n)return this._sy=this.newSy(),t.golpe=Rr.Finger,!0;if("glpt"===n)return this._sy=this.newSy(),t.golpe=Rr.Thumb,!0;if("waho"===n)return this._sy=this.newSy(),t.wahPedal=eo.Open,!0;if("wahc"===n)return this._sy=this.newSy(),t.wahPedal=eo.Closed,!0;if("barre"===n){if(this._sy=this.newSy(),this._sy!==k.Number&&this.error("beat-barre",k.Number,!0),t.barreFret=this._syData,t.barreShape=to.Full,this._sy=this.newSy(),this._sy===k.String)switch(this._syData.toLowerCase()){case"full":t.barreShape=to.Full,this._sy=this.newSy();break;case"half":t.barreShape=to.Half,this._sy=this.newSy()}return!0}if("rasg"===n){switch(this._sy=this.newSy(),this._sy!==k.String&&this.error("rasgueado",k.String,!0),this._syData.toLowerCase()){case"ii":t.rasgueado=ge.Ii;break;case"mi":t.rasgueado=ge.Mi;break;case"miitriplet":t.rasgueado=ge.MiiTriplet;break;case"miianapaest":t.rasgueado=ge.MiiAnapaest;break;case"pmptriplet":t.rasgueado=ge.PmpTriplet;break;case"pmpanapaest":t.rasgueado=ge.PmpAnapaest;break;case"peitriplet":t.rasgueado=ge.PeiTriplet;break;case"peianapaest":t.rasgueado=ge.PeiAnapaest;break;case"paitriplet":t.rasgueado=ge.PaiTriplet;break;case"paianapaest":t.rasgueado=ge.PaiAnapaest;break;case"amitriplet":t.rasgueado=ge.AmiTriplet;break;case"amianapaest":t.rasgueado=ge.AmiAnapaest;break;case"ppp":t.rasgueado=ge.Ppp;break;case"amii":t.rasgueado=ge.Amii;break;case"amip":t.rasgueado=ge.Amip;break;case"eami":t.rasgueado=ge.Eami;break;case"eamii":t.rasgueado=ge.Eamii;break;case"peami":t.rasgueado=ge.Peami}return this._sy=this.newSy(),!0}if("ot"===n)this._sy=this.newSy(),this._sy!==k.String&&this.error("beat-ottava",k.String,!0),t.ottava=this.parseClefOttavaFromString(this._syData);else if("legatoorigin"===n)t.isLegatoOrigin=!0;else{if("instrument"!==n){if("fermata"===n){this._sy=this.newSy(),this._sy!==k.String&&this.error("fermata",k.Number,!0);const i=new Cf;return i.type=this.parseFermataFromString(this._syData),this._allowFloat=!0,this._sy=this.newSy(),this._sy===k.Number&&(i.length=this._syData,this._sy=this.newSy()),this._allowFloat=!1,t.fermata=i,!0}if("beam"===n){switch(this._sy=this.newSy(),this._sy!==k.String&&this.error("beam",k.Number,!0),this._syData.toLowerCase()){case"invert":t.invertBeamDirection=!0;break;case"up":t.preferredBeamDirection=V.Up;break;case"down":t.preferredBeamDirection=V.Down;break;case"auto":t.beamingMode=jn.Auto;break;case"split":t.beamingMode=jn.ForceSplitToNext;break;case"merge":t.beamingMode=jn.ForceMergeWithNext;break;case"splitsecondary":t.beamingMode=jn.ForceSplitOnSecondaryToNext}return this._sy=this.newSy(),!0}return"timer"===n&&(t.showTimer=!0,this._sy=this.newSy(),!0)}{this._sy=this.newSy();let i=0;this._sy===k.Number?i=this._syData:this._sy===k.String?i=Va.getValue(this._syData):this.error("instrument-change",k.Number,!0);const r=new fs;r.isLinear=!1,r.type=$n.Instrument,r.value=i,t.automations.push(r)}}}}}}return this._sy=this.newSy(),!0}parseBracketExtendMode(t){switch(t.toLowerCase()){case"nobrackets":return Ha.NoBrackets;case"groupstaves":default:return Ha.GroupStaves;case"groupsimilarinstruments":return Ha.GroupSimilarInstruments}}parseFermataFromString(t){switch(t.toLowerCase()){case"short":return Ui.Short;case"medium":default:return Ui.Medium;case"long":return Ui.Long}}parseClefOttavaFromString(t){switch(t.toLowerCase()){case"15ma":return Ze._15ma;case"8va":return Ze._8va;case"regular":default:return Ze.Regular;case"8vb":return Ze._8vb;case"15mb":return Ze._15mb}}getChordId(t,n){return n.toLowerCase()+t.index+t.track.index}static applyTuplet(t,n){switch(n){case 3:t.tupletNumerator=3,t.tupletDenominator=2;break;case 5:t.tupletNumerator=5,t.tupletDenominator=4;break;case 6:t.tupletNumerator=6,t.tupletDenominator=4;break;case 7:t.tupletNumerator=7,t.tupletDenominator=4;break;case 9:t.tupletNumerator=9,t.tupletDenominator=8;break;case 10:t.tupletNumerator=10,t.tupletDenominator=8;break;case 11:t.tupletNumerator=11,t.tupletDenominator=8;break;case 12:t.tupletNumerator=12,t.tupletDenominator=8;break;default:t.tupletNumerator=1,t.tupletDenominator=1}}isNoteText(t){return"x"===t||"-"===t||"r"===t}note(t){let n=!1,i=!1,r=-1,o=-1,a=-1,l=mt.Default;switch(this._sy){case k.Number:r=this._syData,this._currentStaff.isPercussion&&!Gs.instrumentArticulations.has(r)&&this.errorMessage(`Unknown percussion articulation ${r}`);break;case k.String:if(this._currentStaff.isPercussion){const p=this._syData.toLowerCase();this._percussionArticulationNames.has(p)?r=this._percussionArticulationNames.get(p):this.errorMessage(`Unknown percussion articulation '${this._syData}'`)}else n="x"===this._syData,i="-"===this._syData,i||n?r=0:this.error("note-fret",k.Number,!0);break;case k.Tuning:0===t.index&&0===t.voice.index&&0===t.voice.bar.index&&this.makeCurrentStaffPitched();const d=this._syData;o=d.octave,a=d.tone.noteValue,this._accidentalMode===zg.Explicit&&(l=d.tone.accidentalMode);break;default:return!1}this._sy=this.newSy();const c=-1===o&&this._currentStaff.tuning.length>0&&!this._currentStaff.isPercussion;let u=-1;c&&(this._sy!==k.Dot&&this.error("note",k.Dot,!0),this._sy=this.newSy(),this._sy!==k.Number&&this.error("note-string",k.Number,!0),u=this._syData,(u<1||u>this._currentStaff.tuning.length)&&this.error("note-string",k.Number,!1),this._sy=this.newSy());const h=new Co;if(c)h.string=this._currentStaff.tuning.length-(u-1),h.isDead=n,h.isTieDestination=i,i||(h.fret=r);else if(this._currentStaff.isPercussion){const d=r;let p=0;if(this._articulationValueToIndex.has(d))p=this._articulationValueToIndex.get(d);else{p=this._currentTrack.percussionArticulations.length;const g=Gs.getArticulationByInputMidiNumber(d);null===g&&this.errorMessage(`Unknown articulation value ${d}`),this._currentTrack.percussionArticulations.push(g),this._articulationValueToIndex.set(d,p)}h.percussionArticulation=p}else h.octave=o,h.tone=a,h.accidentalMode=l,h.isTieDestination=i;return t.addNote(h),this.noteEffects(h),!0}noteEffects(t){if(this._sy===k.LBrace){for(this._sy=this.newSy();this._sy===k.String;){const n=this._syData.toLowerCase();if("b"===n||"be"===n){this._sy=this.newSy();const i="be"===n;for(this._sy===k.String&&(t.bendType=this.parseBendType(this._syData),this._sy=this.newSy()),this._sy===k.String&&(t.bendStyle=this.parseBendStyle(this._syData),this._sy=this.newSy()),this._sy!==k.LParensis&&this.error("bend-effect",k.LParensis,!0),this._sy=this.newSy();this._sy!==k.RParensis&&this._sy!==k.Eof;){let o=0,a=0;i?(this._sy!==k.Number&&this.error("bend-effect-value",k.Number,!0),o=this._syData,this._sy=this.newSy(),this._sy!==k.Number&&this.error("bend-effect-value",k.Number,!0),a=this._syData):(this._sy!==k.Number&&this.error("bend-effect-value",k.Number,!0),a=this._syData),t.addBendPoint(new se(o,a)),this._sy=this.newSy()}const r=t.bendPoints;if(null!=r){for(;r.length>60;)r.splice(r.length-1,1);if(i)r.sort((o,a)=>o.offset-a.offset);else{const o=r.length,a=60/(o-1)|0;let l=0;for(;l<o;)r[l].offset=Math.min(60,l*a),l++}}this._sy!==k.RParensis&&this.error("bend-effect",k.RParensis,!0),this._sy=this.newSy()}else if("nh"===n)t.harmonicType=Ie.Natural,t.harmonicValue=ie.deltaFretToHarmonicValue(t.fret),this._sy=this.newSy();else if("ah"===n)t.harmonicType=Ie.Artificial,t.harmonicValue=this.harmonicValue(t.harmonicValue);else if("th"===n)t.harmonicType=Ie.Tap,t.harmonicValue=this.harmonicValue(t.harmonicValue);else if("ph"===n)t.harmonicType=Ie.Pinch,t.harmonicValue=this.harmonicValue(t.harmonicValue);else if("sh"===n)t.harmonicType=Ie.Semi,t.harmonicValue=this.harmonicValue(t.harmonicValue);else if("fh"===n)t.harmonicType=Ie.Feedback,t.harmonicValue=this.harmonicValue(t.harmonicValue);else if("tr"===n){this._sy=this.newSy(),this._sy!==k.Number&&this.error("trill-effect",k.Number,!0);const i=this._syData;this._sy=this.newSy();let r=w.Sixteenth;if(this._sy===k.Number){switch(this._syData){case 16:default:r=w.Sixteenth;break;case 32:r=w.ThirtySecond;break;case 64:r=w.SixtyFourth}this._sy=this.newSy()}t.trillValue=i+t.stringTuning,t.trillSpeed=r}else if("v"===n)this._sy=this.newSy(),t.vibrato=Ft.Slight;else if("sl"===n)this._sy=this.newSy(),t.slideOutType=Qe.Legato;else if("ss"===n)this._sy=this.newSy(),t.slideOutType=Qe.Shift;else if("sib"===n)this._sy=this.newSy(),t.slideInType=ri.IntoFromBelow;else if("sia"===n)this._sy=this.newSy(),t.slideInType=ri.IntoFromAbove;else if("sou"===n)this._sy=this.newSy(),t.slideOutType=Qe.OutUp;else if("sod"===n)this._sy=this.newSy(),t.slideOutType=Qe.OutDown;else if("psd"===n)this._sy=this.newSy(),t.slideOutType=Qe.PickSlideDown;else if("psu"===n)this._sy=this.newSy(),t.slideOutType=Qe.PickSlideUp;else if("h"===n)this._sy=this.newSy(),t.isHammerPullOrigin=!0;else if("lht"===n)this._sy=this.newSy(),t.isLeftHandTapped=!0;else if("g"===n)this._sy=this.newSy(),t.isGhost=!0;else if("ac"===n)this._sy=this.newSy(),t.accentuated=Ss.Normal;else if("hac"===n)this._sy=this.newSy(),t.accentuated=Ss.Heavy;else if("ten"===n)this._sy=this.newSy(),t.accentuated=Ss.Tenuto;else if("pm"===n)this._sy=this.newSy(),t.isPalmMute=!0;else if("st"===n)this._sy=this.newSy(),t.isStaccato=!0;else if("lr"===n)this._sy=this.newSy(),t.isLetRing=!0;else if("x"===n)this._sy=this.newSy(),t.fret=0,t.isDead=!0;else if("-"===n||"t"===n)this._sy=this.newSy(),t.isTieDestination=!0;else if("lf"===n){this._sy=this.newSy();let i=Ne.Thumb;this._sy===k.Number&&(i=this.toFinger(this._syData),this._sy=this.newSy()),t.leftHandFinger=i}else if("rf"===n){this._sy=this.newSy();let i=Ne.Thumb;this._sy===k.Number&&(i=this.toFinger(this._syData),this._sy=this.newSy()),t.rightHandFinger=i}else if("acc"===n)this._sy=this.newSy(),this._sy!==k.String&&this.error("note-accidental",k.String,!0),t.accidentalMode=ie.parseAccidentalMode(this._syData),this._sy=this.newSy();else if("turn"===n)this._sy=this.newSy(),t.ornament=vs.Turn;else if("iturn"===n)this._sy=this.newSy(),t.ornament=vs.InvertedTurn;else if("umordent"===n)this._sy=this.newSy(),t.ornament=vs.UpperMordent;else if("lmordent"===n)this._sy=this.newSy(),t.ornament=vs.LowerMordent;else if("string"===n)this._sy=this.newSy(),t.showStringNumber=!0;else if("hide"===n)this._sy=this.newSy(),t.isVisible=!1;else if("slur"===n){this._sy=this.newSy(),this._sy!==k.String&&this.error("slur",k.String,!0);const i=this._syData;if(this._slurs.has(i)){const r=this._slurs.get(i);r.slurDestination=t,t.slurOrigin=r,t.isSlurDestination=!0}else this._slurs.set(i,t);this._sy=this.newSy()}else this.applyBeatEffect(t.beat)||this.error(n,k.String,!1)}this._sy!==k.RBrace&&this.error("note-effect",k.RBrace,!1),this._sy=this.newSy()}}harmonicValue(t){return this._allowNegatives=!0,this._allowFloat=!0,this._sy=this.newSy(),this._sy===k.Number&&(t=this._syData,this._sy=this.newSy()),this._allowNegatives=!1,this._allowFloat=!1,t}toFinger(t){switch(t){case 1:return Ne.Thumb;case 2:return Ne.IndexFinger;case 3:return Ne.MiddleFinger;case 4:return Ne.AnnularFinger;case 5:return Ne.LittleFinger}return Ne.Thumb}parseDuration(t){switch(t){case-4:return w.QuadrupleWhole;case-2:return w.DoubleWhole;case 1:return w.Whole;case 2:return w.Half;case 4:return w.Quarter;case 8:return w.Eighth;case 16:return w.Sixteenth;case 32:return w.ThirtySecond;case 64:return w.SixtyFourth;case 128:return w.OneHundredTwentyEighth;case 256:return w.TwoHundredFiftySixth;default:return w.Quarter}}parseBendStyle(t){switch(t.toLowerCase()){case"gradual":return Cn.Gradual;case"fast":return Cn.Fast;default:return Cn.Default}}parseBendType(t){switch(t.toLowerCase()){case"none":return me.None;case"custom":default:return me.Custom;case"bend":return me.Bend;case"release":return me.Release;case"bendrelease":return me.BendRelease;case"hold":return me.Hold;case"prebend":return me.Prebend;case"prebendbend":return me.PrebendBend;case"prebendrelease":return me.PrebendRelease}}barMeta(t){let n=!1;const i=t.masterBar;let r=!1;for(;!r&&this._sy===k.MetaCommand;){n=!0;const o=this._syData.toLowerCase();if("ts"===o)this._sy=this.newSy(),this._sy===k.String?"common"===this._syData.toLowerCase()?(i.timeSignatureCommon=!0,i.timeSignatureNumerator=4,i.timeSignatureDenominator=4,this._sy=this.newSy()):this.error("timesignature-numerator",k.String,!0):(this._sy!==k.Number&&this.error("timesignature-numerator",k.Number,!0),i.timeSignatureNumerator=this._syData,this._sy=this.newSy(),this._sy!==k.Number&&this.error("timesignature-denominator",k.Number,!0),i.timeSignatureDenominator=this._syData,this._sy=this.newSy());else if("ft"===o)i.isFreeTime=!0,this._sy=this.newSy();else if("ro"===o)i.isRepeatStart=!0,this._sy=this.newSy();else if("rc"===o)this._sy=this.newSy(),this._sy!==k.Number&&this.error("repeatclose",k.Number,!0),this._syData>2048&&this.error("repeatclose",k.Number,!1),i.repeatCount=this._syData,this._sy=this.newSy();else if("ae"===o)if(this._sy=this.newSy(),this._sy===k.LParensis){for(this._sy=this.newSy(),this._sy!==k.Number&&this.error("alternateending",k.Number,!0),this.applyAlternateEnding(i);this._sy===k.Number;)this.applyAlternateEnding(i);this._sy!==k.RParensis&&this.error("alternateending-list",k.RParensis,!0),this._sy=this.newSy()}else this._sy!==k.Number&&this.error("alternateending",k.Number,!0),this.applyAlternateEnding(i);else if("ks"===o)this._sy=this.newSy(),this._sy!==k.String&&this.error("keysignature",k.String,!0),t.keySignature=this.parseKeySignature(this._syData),t.keySignatureType=this.parseKeySignatureType(this._syData),this._sy=this.newSy();else if("clef"===o){switch(this._sy=this.newSy(),this._sy){case k.String:t.clef=this.parseClefFromString(this._syData);break;case k.Number:t.clef=this.parseClefFromInt(this._syData);break;case k.Tuning:t.clef=this.parseClefFromInt(this._syData.realValue);break;default:this.error("clef",k.String,!0)}this._sy=this.newSy()}else if("tempo"===o){const a=this.readTempoAutomation();i.tempoAutomations.push(a)}else if("section"===o){this._sy=this.newSy(),this._sy!==k.String&&this.error("section",k.String,!0);let a=this._syData;this._sy=this.newSy();let l="";this._sy===k.String&&!this.isNoteText(this._syData.toLowerCase())&&(l=a,a=this._syData,this._sy=this.newSy());const c=new kf;c.marker=l,c.text=a,i.section=c}else if("tf"===o){switch(this._allowTuning=!1,this._sy=this.newSy(),this._allowTuning=!0,this._sy){case k.String:i.tripletFeel=this.parseTripletFeelFromString(this._syData);break;case k.Number:i.tripletFeel=this.parseTripletFeelFromInt(this._syData);break;default:this.error("triplet-feel",k.String,!0)}this._sy=this.newSy()}else if("ac"===o)i.isAnacrusis=!0,this._sy=this.newSy();else if("db"===o)i.isDoubleBar=!0,t.barLineRight=We.LightLight,this._sy=this.newSy();else if("barlineleft"===o)this._sy=this.newSy(),this._sy!==k.String&&this.error("barlineleft",k.String,!0),t.barLineLeft=this.parseBarLineStyle(this._syData),this._sy=this.newSy();else if("barlineright"===o)this._sy=this.newSy(),this._sy!==k.String&&this.error("barlineright",k.String,!0),t.barLineRight=this.parseBarLineStyle(this._syData),this._sy=this.newSy();else if("accidentals"===o)this.handleAccidentalMode();else if("jump"===o)this.handleDirections(i);else if("ottava"===o)this._sy=this.newSy(),this._sy!==k.String&&this.error("ottava",k.String,!0),t.clefOttava=this.parseClefOttavaFromString(this._syData),this._sy=this.newSy();else if("simile"===o)this._sy=this.newSy(),this._sy!==k.String&&this.error("simile",k.String,!0),t.simileMark=this.parseSimileMarkFromString(this._syData),this._sy=this.newSy();else if("scale"===o)this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy!==k.Number&&this.error("scale",k.Number,!0),i.displayScale=this._syData,t.displayScale=this._syData,this._sy=this.newSy();else if("width"===o)this._sy=this.newSy(),this._sy!==k.Number&&this.error("width",k.Number,!0),i.displayWidth=this._syData,t.displayWidth=this._syData,this._sy=this.newSy();else if(0===t.index)switch(this.handleStaffMeta()){case _i.KnownStaffMeta:break;case _i.UnknownStaffMeta:this.error("measure-effects",k.String,!1);break;case _i.EndOfMetaDetected:r=!0}else this.handleStaffMeta()===_i.EndOfMetaDetected?r=!0:this.error("measure-effects",k.String,!1)}if(0===i.index&&0===i.tempoAutomations.length){const o=new fs;o.isLinear=!1,o.type=$n.Tempo,o.value=this._score.tempo,o.text=this._score.tempoLabel,i.tempoAutomations.push(o)}return n}parseBarLineStyle(t){switch(t.toLowerCase()){case"automatic":return We.Automatic;case"dashed":return We.Dashed;case"dotted":return We.Dotted;case"heavy":return We.Heavy;case"heavyheavy":return We.HeavyHeavy;case"heavylight":return We.HeavyLight;case"lightheavy":return We.LightHeavy;case"lightlight":return We.LightLight;case"none":return We.None;case"regular":return We.Regular;case"short":return We.Short;case"tick":return We.Tick}return We.Automatic}parseSimileMarkFromString(t){switch(t.toLowerCase()){case"none":default:return ws.None;case"simple":return ws.Simple;case"firstofdouble":return ws.FirstOfDouble;case"secondofdouble":return ws.SecondOfDouble}}handleDirections(t){switch(this._sy=this.newSy(),this._sy!==k.String&&this.error("direction",k.String,!0),this._syData.toLowerCase()){case"fine":t.addDirection(j.TargetFine);break;case"segno":t.addDirection(j.TargetSegno);break;case"segnosegno":t.addDirection(j.TargetSegnoSegno);break;case"coda":t.addDirection(j.TargetCoda);break;case"doublecoda":t.addDirection(j.TargetDoubleCoda);break;case"dacapo":t.addDirection(j.JumpDaCapo);break;case"dacapoalcoda":t.addDirection(j.JumpDaCapoAlCoda);break;case"dacapoaldoublecoda":t.addDirection(j.JumpDaCapoAlDoubleCoda);break;case"dacapoalfine":t.addDirection(j.JumpDaCapoAlFine);break;case"dalsegno":t.addDirection(j.JumpDalSegno);break;case"dalsegnoalcoda":t.addDirection(j.JumpDalSegnoAlCoda);break;case"dalsegnoaldoublecoda":t.addDirection(j.JumpDalSegnoAlDoubleCoda);break;case"dalsegnoalfine":t.addDirection(j.JumpDalSegnoAlFine);break;case"dalsegnosegno":t.addDirection(j.JumpDalSegnoSegno);break;case"dalsegnosegnoalcoda":t.addDirection(j.JumpDalSegnoSegnoAlCoda);break;case"dalsegnosegnoaldoublecoda":t.addDirection(j.JumpDalSegnoSegnoAlDoubleCoda);break;case"dalsegnosegnoalfine":t.addDirection(j.JumpDalSegnoSegnoAlFine);break;case"dacoda":t.addDirection(j.JumpDaCoda);break;case"dadoublecoda":t.addDirection(j.JumpDaDoubleCoda);break;default:return void this.errorMessage(`Unexpected direction value: '${this._syData}'`)}this._sy=this.newSy()}readTempoAutomation(){this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy!==k.Number&&this.error("tempo",k.Number,!0);const t=new fs;return t.isLinear=!1,t.type=$n.Tempo,t.value=this._syData,this._sy=this.newSy(),this._sy===k.String&&(t.text=this._syData,this._sy=this.newSy()),t}applyAlternateEnding(t){const n=this._syData;n<1&&this.error("alternateending",k.Number,!0),t.alternateEndings|=1<<n-1,this._sy=this.newSy()}parseWhammyType(t){switch(t.toLowerCase()){case"none":return Wt.None;case"custom":default:return Wt.Custom;case"dive":return Wt.Dive;case"dip":return Wt.Dip;case"hold":return Wt.Hold;case"predive":return Wt.Predive;case"predivedive":return Wt.PrediveDive}}}return s.Eof=0,s})(),Jte=(()=>{class s extends Mh{constructor(){super(...arguments),this._versionNumber=0,this._globalTripletFeel=nt.NoTripletFeel,this._lyricsTrack=0,this._lyrics=[],this._barCount=0,this._trackCount=0,this._playbackInfos=[],this._doubleBars=new Set,this._keySignatures=new Map,this._beatTextChunksByTrack=new Map,this._directionLookup=new Map}get name(){return"Guitar Pro 3-5"}readScore(){if(this._directionLookup.clear(),this.readVersion(),this._score=new Cl,this.readScoreInformation(),this._versionNumber<500&&(this._globalTripletFeel=Ut.gpReadBool(this.data)?nt.Triplet8th:nt.NoTripletFeel),this._versionNumber>=400&&this.readLyrics(),this._versionNumber>=510&&this.data.skip(19),this._versionNumber>=500&&(this.readPageSetup(),this._score.tempoLabel=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding)),this._score.tempo=N.readInt32LE(this.data),this._versionNumber>=510&&Ut.gpReadBool(this.data),N.readInt32LE(this.data),this._versionNumber>=400&&this.data.readByte(),this.readPlaybackInfos(),this._versionNumber>=500&&(this.readDirection(j.TargetCoda),this.readDirection(j.TargetDoubleCoda),this.readDirection(j.TargetSegno),this.readDirection(j.TargetSegnoSegno),this.readDirection(j.TargetFine),this.readDirection(j.JumpDaCapo),this.readDirection(j.JumpDaCapoAlCoda),this.readDirection(j.JumpDaCapoAlDoubleCoda),this.readDirection(j.JumpDaCapoAlFine),this.readDirection(j.JumpDalSegno),this.readDirection(j.JumpDalSegnoAlCoda),this.readDirection(j.JumpDalSegnoAlDoubleCoda),this.readDirection(j.JumpDalSegnoAlFine),this.readDirection(j.JumpDalSegnoSegno),this.readDirection(j.JumpDalSegnoSegnoAlCoda),this.readDirection(j.JumpDalSegnoSegnoAlDoubleCoda),this.readDirection(j.JumpDalSegnoSegnoAlFine),this.readDirection(j.JumpDaCoda),this.readDirection(j.JumpDaDoubleCoda),this.data.skip(4)),this._barCount=N.readInt32LE(this.data),this._trackCount=N.readInt32LE(this.data),this.readMasterBars(),this.readTracks(),this.readBars(),this._score.masterBars.length>0){const t=fs.buildTempoAutomation(!1,0,this._score.tempo,2);t.text=this._score.tempoLabel,this._score.masterBars[0].tempoAutomations.push(t)}return ie.consolidate(this._score),this._score.finish(this.settings),this._lyrics&&this._lyricsTrack>=0&&this._score.tracks[this._lyricsTrack].applyLyrics(this._lyrics),this._score}readDirection(t){let i,n=N.readInt16LE(this.data);-1!==n&&(n--,this._directionLookup.has(n)?i=this._directionLookup.get(n):(i=[],this._directionLookup.set(n,i)),i.push(t))}readVersion(){let t=Ut.gpReadStringByteLength(this.data,30,this.settings.importer.encoding);if(!t.startsWith(s.VersionString))throw new Ts("Unsupported format");t=t.substr(s.VersionString.length+1);const n=t.indexOf(".");this._versionNumber=100*Number.parseInt(t.substr(0,n))+Number.parseInt(t.substr(n+1)),F.debug(this.name,`Guitar Pro version ${t} detected`)}readScoreInformation(){this._score.title=Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.subTitle=Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.artist=Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.album=Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.words=Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.music=this._versionNumber>=500?Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding):this._score.words,this._score.copyright=Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.tab=Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.instructions=Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding);const t=N.readInt32LE(this.data);let n="";for(let i=0;i<t;i++)i>0&&(n+="\r\n"),n+=Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding)?.toString();this._score.notices=n}readLyrics(){this._lyrics=[],this._lyricsTrack=N.readInt32LE(this.data)-1;for(let t=0;t<5;t++){const n=new Tf;n.startBar=N.readInt32LE(this.data)-1,n.text=Ut.gpReadStringInt(this.data,this.settings.importer.encoding),this._lyrics.push(n)}}readPageSetup(){this.data.skip(28);const t=N.readInt16LE(this.data);ie.getOrCreateHeaderFooterStyle(this._score,re.Title).isVisible=!!(1&t),ie.getOrCreateHeaderFooterStyle(this._score,re.Title).template=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),ie.getOrCreateHeaderFooterStyle(this._score,re.SubTitle).isVisible=!!(2&t),ie.getOrCreateHeaderFooterStyle(this._score,re.SubTitle).template=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),ie.getOrCreateHeaderFooterStyle(this._score,re.Artist).isVisible=!!(4&t),ie.getOrCreateHeaderFooterStyle(this._score,re.Artist).template=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),ie.getOrCreateHeaderFooterStyle(this._score,re.Album).isVisible=!!(8&t),ie.getOrCreateHeaderFooterStyle(this._score,re.Album).template=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),ie.getOrCreateHeaderFooterStyle(this._score,re.Words).isVisible=!!(16&t),ie.getOrCreateHeaderFooterStyle(this._score,re.Words).template=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),ie.getOrCreateHeaderFooterStyle(this._score,re.Music).isVisible=!!(32&t),ie.getOrCreateHeaderFooterStyle(this._score,re.Music).template=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),ie.getOrCreateHeaderFooterStyle(this._score,re.WordsAndMusic).isVisible=!!(64&t),ie.getOrCreateHeaderFooterStyle(this._score,re.WordsAndMusic).template=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),ie.getOrCreateHeaderFooterStyle(this._score,re.Copyright).isVisible=!!(128&t),ie.getOrCreateHeaderFooterStyle(this._score,re.Copyright).template=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),ie.getOrCreateHeaderFooterStyle(this._score,re.CopyrightSecondLine).isVisible=!!(128&t),ie.getOrCreateHeaderFooterStyle(this._score,re.CopyrightSecondLine).template=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding)}readPlaybackInfos(){this._playbackInfos=[];let t=0;for(let n=0;n<64;n++){const i=new bD;i.primaryChannel=t++,i.secondaryChannel=t++,i.program=N.readInt32LE(this.data),i.volume=this.data.readByte(),i.balance=this.data.readByte(),this.data.skip(6),this._playbackInfos.push(i)}}readMasterBars(){for(let t=0;t<this._barCount;t++)this.readMasterBar()}readMasterBar(){let t=null;this._score.masterBars.length>0&&(t=this._score.masterBars[this._score.masterBars.length-1]);const n=new kl,i=this.data.readByte();if(1&i?n.timeSignatureNumerator=this.data.readByte():t&&(n.timeSignatureNumerator=t.timeSignatureNumerator),2&i?n.timeSignatureDenominator=this.data.readByte():t&&(n.timeSignatureDenominator=t.timeSignatureDenominator),n.isRepeatStart=!!(4&i),!!(8&i)&&(n.repeatCount=this.data.readByte()+(this._versionNumber>=500?0:1)),16&i&&this._versionNumber<500){let a=t,l=0;for(;a&&!(a.isRepeatEnd&&a!==t||a.isRepeatStart);)l|=a.alternateEndings,a=a.previousMasterBar;let c=0;const u=this.data.readByte();for(let h=0;h<8;h++){const d=1<<h;u>h&&0===(l&d)&&(c|=d)}n.alternateEndings=c}if(32&i){const a=new kf;a.text=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),a.marker="",Ut.gpReadColor(this.data,!1),n.section=a}if(!!(64&i)&&this._keySignatures.set(this._score.masterBars.length,[N.readSInt8(this.data),this.data.readByte()]),this._versionNumber>=500&&!!(3&i)&&this.data.skip(4),this._versionNumber>=500&&(n.alternateEndings=this.data.readByte()),this._versionNumber>=500){switch(this.data.readByte()){case 1:n.tripletFeel=nt.Triplet8th;break;case 2:n.tripletFeel=nt.Triplet16th}this.data.readByte()}else n.tripletFeel=this._globalTripletFeel;const r=!!(128&i);n.isDoubleBar=r;const o=this._score.masterBars.length;if(this._directionLookup.has(o))for(const a of this._directionLookup.get(o))n.addDirection(a);this._score.addMasterBar(n),r&&this._doubleBars.add(n.index)}readTracks(){for(let t=0;t<this._trackCount;t++)this.readTrack()}readTrack(){const t=new Ph;t.ensureStaveCount(1),this._score.addTrack(t);const n=t.staves[0],i=this.data.readByte();t.name=Ut.gpReadStringByteLength(this.data,40,this.settings.importer.encoding),!!(1&i)&&(n.isPercussion=!0),this._versionNumber>=500&&(t.isVisibleOnMultiTrack=!!(8&i)),null===this._score.stylesheet.perTrackDisplayTuning&&(this._score.stylesheet.perTrackDisplayTuning=new Map),this._score.stylesheet.perTrackDisplayTuning.set(t.index,!!(128&i));const r=N.readInt32LE(this.data),o=[];for(let u=0;u<7;u++){const h=N.readInt32LE(this.data);r>u&&o.push(h)}n.stringTuning.tunings=o;const a=N.readInt32LE(this.data),l=N.readInt32LE(this.data)-1,c=N.readInt32LE(this.data)-1;if(this.data.skip(4),l>=0&&l<this._playbackInfos.length){const u=this._playbackInfos[l];u.port=a,u.isSolo=!!(16&i),u.isMute=!!(32&i),u.secondaryChannel=c,Va.isGuitar(u.program)&&(n.displayTranspositionPitch=-12),t.playbackInfo=u}if(n.capo=N.readInt32LE(this.data),t.color=Ut.gpReadColor(this.data,!1),this._versionNumber>=500){const u=this.data.readByte();n.showTablature=!!(1&u),n.showStandardNotation=!!(2&u);const h=!!(100&u);null===this._score.stylesheet.perTrackChordDiagramsOnTop&&(this._score.stylesheet.perTrackChordDiagramsOnTop=new Map),this._score.stylesheet.perTrackChordDiagramsOnTop.set(t.index,h),this.data.readByte(),this.data.skip(43)}this._versionNumber>=510&&(this.data.skip(4),Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding))}readBars(){for(let t=0;t<this._barCount;t++)for(let n=0;n<this._trackCount;n++)this.readBar(this._score.tracks[n])}readBar(t){const n=new Sl,i=t.staves[0];if(i.isPercussion&&(n.clef=Et.Neutral),i.addBar(n),this._keySignatures.has(n.index)){const o=this._keySignatures.get(n.index);n.keySignature=o[0],n.keySignatureType=o[1]}else n.index>0&&(n.keySignature=n.previousBar.keySignature,n.keySignatureType=n.previousBar.keySignatureType);this._doubleBars.has(n.index)&&(n.barLineRight=We.LightLight);let r=1;this._versionNumber>=500&&(this.data.readByte(),r=2);for(let o=0;o<r;o++)this.readVoice(t,n)}readVoice(t,n){const i=N.readInt32LE(this.data);if(0===i)return;const r=new ko;n.addVoice(r);for(let o=0;o<i;o++)this.readBeat(t,n,r)}readBeat(t,n,i){const r=new Ei,o=this.data.readByte();if(!!(1&o)&&(r.dots=1),64&o){const h=this.data.readByte();r.isEmpty=!(2&h)}switch(i.addBeat(r),N.readSInt8(this.data)){case-2:r.duration=w.Whole;break;case-1:r.duration=w.Half;break;case 0:r.duration=w.Quarter;break;case 1:r.duration=w.Eighth;break;case 2:r.duration=w.Sixteenth;break;case 3:r.duration=w.ThirtySecond;break;case 4:r.duration=w.SixtyFourth;break;default:r.duration=w.Quarter}if(32&o)switch(r.tupletNumerator=N.readInt32LE(this.data),r.tupletNumerator){case 1:r.tupletDenominator=1;break;case 3:r.tupletDenominator=2;break;case 5:case 6:case 7:r.tupletDenominator=4;break;case 9:case 10:case 11:case 12:case 13:r.tupletDenominator=8;break;case 2:case 4:case 8:break;default:r.tupletNumerator=1,r.tupletDenominator=1}2&o&&this.readChord(r);const l=this.settings.importer.beatTextAsLyrics&&t.index!==this._lyricsTrack;if(4&o){const h=Ut.gpReadStringIntUnused(this.data,this.settings.importer.encoding);if(l){const d=new Tf;d.text=h.trim(),d.finish(!0);const p=[];for(let g=d.chunks.length-1;g>=0;g--)p.push(d.chunks[g]);this._beatTextChunksByTrack.set(t.index,p)}else r.text=h}let c=Ie.None;!!(8&o)&&(c=this.readBeatEffects(r)),16&o&&this.readMixTableChange(r);const u=this.data.readByte();for(let h=6;h>=0;h--)if(u&1<<h&&6-h<n.staff.tuning.length){const d=this.readNote(t,n,i,r,6-h);c!==Ie.None&&(d.harmonicType=c,d.harmonicType===Ie.Natural&&(d.harmonicValue=ie.deltaFretToHarmonicValue(d.fret)))}if(this._versionNumber>=500){const h=N.readInt16LE(this.data);if(!!(1&h)&&r.index>0&&(i.beats[r.index-1].beamingMode=jn.ForceSplitToNext),!!(2&h)&&(r.preferredBeamDirection=V.Down),!!(4&h)&&r.index>0&&(i.beats[r.index-1].beamingMode=jn.ForceMergeWithNext),!!(8&h)&&(r.preferredBeamDirection=V.Up),!!(16&h)&&(r.ottava=Ze._8va),!!(32&h)&&(r.ottava=Ze._8vb),!!(64&h)&&(r.ottava=Ze._15ma),!!(256&h)&&(r.ottava=Ze._15mb),2048&h){const d=0!==this.data.readByte();r.index>0&&d&&(i.beats[r.index-1].beamingMode=jn.ForceSplitOnSecondaryToNext)}}l&&!r.isRest&&this._beatTextChunksByTrack.has(t.index)&&this._beatTextChunksByTrack.get(t.index).length>0&&(r.lyrics=[this._beatTextChunksByTrack.get(t.index).pop()])}readChord(t){const n=new gc,i=ie.newGuid();if(this._versionNumber>=500){this.data.skip(17),n.name=Ut.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),n.firstFret=N.readInt32LE(this.data);for(let a=0;a<7;a++){const l=N.readInt32LE(this.data);a<t.voice.bar.staff.tuning.length&&n.strings.push(l)}const r=this.data.readByte(),o=new Uint8Array(5);this.data.read(o,0,o.length);for(let a=0;a<r;a++)n.barreFrets.push(o[a]);this.data.skip(26)}else if(0!==this.data.readByte())if(this._versionNumber>=400){this.data.skip(16),n.name=Ut.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),n.firstFret=N.readInt32LE(this.data);for(let a=0;a<7;a++){const l=N.readInt32LE(this.data);a<t.voice.bar.staff.tuning.length&&n.strings.push(l)}const r=this.data.readByte(),o=new Uint8Array(5);this.data.read(o,0,o.length);for(let a=0;a<r;a++)n.barreFrets.push(o[a]);this.data.skip(26)}else{this.data.skip(25),n.name=Ut.gpReadStringByteLength(this.data,34,this.settings.importer.encoding),n.firstFret=N.readInt32LE(this.data);for(let r=0;r<6;r++){const o=N.readInt32LE(this.data);r<t.voice.bar.staff.tuning.length&&n.strings.push(o)}this.data.skip(36)}else{const r=this._versionNumber>=406?7:6;if(n.name=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),n.firstFret=N.readInt32LE(this.data),n.firstFret>0)for(let o=0;o<r;o++){const a=N.readInt32LE(this.data);o<t.voice.bar.staff.tuning.length&&n.strings.push(a)}}n.name&&(t.chordId=i,t.voice.bar.staff.addChord(t.chordId,n))}readBeatEffects(t){const n=this.data.readByte();let i=0;if(this._versionNumber>=400&&(i=this.data.readByte()),!!(16&n)&&(t.fade=Ks.FadeIn),(this._versionNumber<400&&!!(1&n)||!!(2&n))&&(t.vibrato=Ft.Slight),!!(1&i)&&(t.rasgueado=ge.Ii),32&n&&this._versionNumber>=400)switch(N.readSInt8(this.data)){case 1:t.tap=!0;break;case 2:t.slap=!0;break;case 3:t.pop=!0}else if(32&n){switch(N.readSInt8(this.data)){case 1:t.tap=!0;break;case 2:t.slap=!0;break;case 3:t.pop=!0}this.data.skip(4)}if(!!(4&i)&&this.readTremoloBarEffect(t),64&n){let r=0,o=0;this._versionNumber<500?(o=this.data.readByte(),r=this.data.readByte()):(r=this.data.readByte(),o=this.data.readByte()),r>0?(t.brushType=fe.BrushUp,t.brushDuration=s.toStrokeValue(r)):o>0&&(t.brushType=fe.BrushDown,t.brushDuration=s.toStrokeValue(o))}if(2&i)switch(N.readSInt8(this.data)){case 0:t.pickStroke=yi.None;break;case 1:t.pickStroke=yi.Up;break;case 2:t.pickStroke=yi.Down}if(this._versionNumber<400){if(4&n)return Ie.Natural;if(8&n)return Ie.Artificial}return Ie.None}readTremoloBarEffect(t){this.data.readByte(),N.readInt32LE(this.data);const n=N.readInt32LE(this.data);if(n>0)for(let i=0;i<n;i++){const r=new se(0,0);r.offset=N.readInt32LE(this.data),r.value=N.readInt32LE(this.data)/s.BendStep|0,Ut.gpReadBool(this.data),t.addWhammyBarPoint(r)}}static toStrokeValue(t){switch(t){case 1:case 2:return 30;case 3:return 60;case 4:return 120;case 5:return 240;case 6:return 480;default:return 0}}readMixTableChange(t){const n=new Zte;n.instrument=N.readSInt8(this.data),this._versionNumber>=500&&this.data.skip(16),n.volume=N.readSInt8(this.data),n.balance=N.readSInt8(this.data);const i=N.readSInt8(this.data),r=N.readSInt8(this.data),o=N.readSInt8(this.data),a=N.readSInt8(this.data);if(this._versionNumber>=500&&(n.tempoName=Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding)),n.tempo=N.readInt32LE(this.data),n.volume>=0&&this.data.readByte(),n.balance>=0&&this.data.readByte(),i>=0&&this.data.readByte(),r>=0&&this.data.readByte(),o>=0&&this.data.readByte(),a>=0&&this.data.readByte(),n.tempo>=0&&(n.duration=N.readSInt8(this.data),this._versionNumber>=510&&this.data.readByte()),this._versionNumber>=400&&this.data.readByte(),this._versionNumber>=500){const l=N.readSInt8(this.data);l>=100?t.wahPedal=eo.Closed:l>=0&&(t.wahPedal=eo.Open)}if(this._versionNumber>=510&&(Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding),Ut.gpReadStringIntByte(this.data,this.settings.importer.encoding)),n.volume>=0){const l=new fs;l.isLinear=!0,l.type=$n.Volume,l.value=n.volume,t.automations.push(l)}if(n.balance>=0){const l=new fs;l.isLinear=!0,l.type=$n.Balance,l.value=n.balance,t.automations.push(l)}if(n.instrument>=0){const l=new fs;l.isLinear=!0,l.type=$n.Instrument,l.value=n.instrument,t.automations.push(l)}if(n.tempo>=0){const l=new fs;l.isLinear=!0,l.type=$n.Tempo,l.value=n.tempo,t.automations.push(l),t.voice.bar.masterBar.tempoAutomations.push(l)}}readNote(t,n,i,r,o){const a=new Co;a.string=n.staff.tuning.length-o;const l=this.data.readByte();if(2&l?a.accentuated=Ss.Heavy:!!(64&l)&&(a.accentuated=Ss.Normal),a.isGhost=!!(4&l),32&l){const u=this.data.readByte();3===u?a.isDead=!0:2===u&&(a.isTieDestination=!0)}if(!!(1&l)&&this._versionNumber<500&&(this.data.readByte(),this.data.readByte()),16&l){const u=N.readSInt8(this.data);a.dynamics=this.toDynamicValue(u),r.dynamics=a.dynamics}!!(32&l)&&(a.fret=N.readSInt8(this.data)),128&l&&(a.leftHandFinger=N.readSInt8(this.data),a.rightHandFinger=N.readSInt8(this.data));let c=!1;if(this._versionNumber>=500&&(!!(1&l)&&(a.durationPercent=N.readFloat64BE(this.data)),c=!!(2&this.data.readByte())),r.addNote(a),!!(8&l)&&this.readNoteEffects(t,i,r,a),n.staff.isPercussion&&(a.percussionArticulation=a.fret,a.string=-1,a.fret=-1),c){const u=z.defaultAccidentals[a.realValueWithoutHarmonic%12];"#"===u?a.accidentalMode=mt.ForceFlat:"b"===u&&(a.accidentalMode=mt.ForceSharp)}return a}toDynamicValue(t){switch(t){case 1:return Te.PPP;case 2:return Te.PP;case 3:return Te.P;case 4:return Te.MP;case 5:return Te.MF;case 6:default:return Te.F;case 7:return Te.FF;case 8:return Te.FFF}}readNoteEffects(t,n,i,r){const o=this.data.readByte();let a=0;this._versionNumber>=400&&(a=this.data.readByte()),!!(1&o)&&this.readBend(r),!!(16&o)&&this.readGrace(n,r),!!(4&a)&&this.readTremoloPicking(i),8&a?this.readSlide(r):this._versionNumber<400&&!!(4&o)&&(r.slideOutType=Qe.Shift),!!(16&a)&&this.readArtificialHarmonic(r),!!(32&a)&&this.readTrill(r),r.isLetRing=!!(8&o),r.isHammerPullOrigin=!!(2&o),!!(64&a)&&(r.vibrato=Ft.Slight),r.isPalmMute=!!(2&a),r.isStaccato=!!(1&a)}readBend(t){this.data.readByte(),N.readInt32LE(this.data);const n=N.readInt32LE(this.data);if(n>0)for(let i=0;i<n;i++){const r=new se(0,0);r.offset=N.readInt32LE(this.data),r.value=N.readInt32LE(this.data)/s.BendStep|0,Ut.gpReadBool(this.data),t.addBendPoint(r)}}readGrace(t,n){const i=new Ei,r=new Co;switch(r.string=n.string,r.fret=N.readSInt8(this.data),i.duration=w.ThirtySecond,i.dynamics=this.toDynamicValue(N.readSInt8(this.data)),N.readSInt8(this.data)){case 0:case 2:break;case 1:r.slideOutType=Qe.Legato,r.slideTarget=n;break;case 3:r.isHammerPullOrigin=!0}if(r.dynamics=i.dynamics,this.data.skip(1),this._versionNumber<500)i.graceType=Ee.BeforeBeat;else{const a=this.data.readByte();r.isDead=!!(1&a),i.graceType=2&a?Ee.OnBeat:Ee.BeforeBeat}t.addGraceBeat(i),i.addNote(r)}readTremoloPicking(t){switch(this.data.readByte()){case 1:t.tremoloSpeed=w.Eighth;break;case 2:t.tremoloSpeed=w.Sixteenth;break;case 3:t.tremoloSpeed=w.ThirtySecond}}readSlide(t){if(this._versionNumber>=500){const n=N.readSInt8(this.data);1&n?t.slideOutType=Qe.Shift:2&n?t.slideOutType=Qe.Legato:4&n?t.slideOutType=Qe.OutDown:!!(8&n)&&(t.slideOutType=Qe.OutUp),16&n?t.slideInType=ri.IntoFromBelow:32&n&&(t.slideInType=ri.IntoFromAbove)}else switch(N.readSInt8(this.data)){case 1:t.slideOutType=Qe.Shift;break;case 2:t.slideOutType=Qe.Legato;break;case 3:t.slideOutType=Qe.OutDown;break;case 4:t.slideOutType=Qe.OutUp;break;case-1:t.slideInType=ri.IntoFromBelow;break;case-2:t.slideInType=ri.IntoFromAbove}}readArtificialHarmonic(t){const n=this.data.readByte();if(this._versionNumber>=500)switch(n){case 1:t.harmonicType=Ie.Natural,t.harmonicValue=ie.deltaFretToHarmonicValue(t.fret);break;case 2:this.data.readByte(),this.data.readByte(),this.data.readByte(),t.harmonicType=Ie.Artificial;break;case 3:t.harmonicType=Ie.Tap,t.harmonicValue=ie.deltaFretToHarmonicValue(this.data.readByte());break;case 4:t.harmonicType=Ie.Pinch,t.harmonicValue=12;break;case 5:t.harmonicType=Ie.Semi,t.harmonicValue=12}else if(this._versionNumber>=400)switch(n){case 1:t.harmonicType=Ie.Natural;break;case 3:t.harmonicType=Ie.Tap;break;case 4:t.harmonicType=Ie.Pinch;break;case 5:t.harmonicType=Ie.Semi;break;case 15:case 17:case 22:t.harmonicType=Ie.Artificial}}readTrill(t){switch(t.trillValue=this.data.readByte()+t.stringTuning,this.data.readByte()){case 1:t.trillSpeed=w.Sixteenth;break;case 2:t.trillSpeed=w.ThirtySecond;break;case 3:t.trillSpeed=w.SixtyFourth}}}return s.VersionString="FICHIER GUITAR PRO ",s.BendStep=25,s})();class Ut{static gpReadColor(e,t=!1){const n=e.readByte(),i=e.readByte(),r=e.readByte();let o=255;return t?o=e.readByte():e.skip(1),new _n(n,i,r,o)}static gpReadBool(e){return 0!==e.readByte()}static gpReadStringIntUnused(e,t){return e.skip(4),Ut.gpReadString(e,e.readByte(),t)}static gpReadStringInt(e,t){return Ut.gpReadString(e,N.readInt32LE(e),t)}static gpReadStringIntByte(e,t){const n=N.readInt32LE(e)-1;return e.readByte(),Ut.gpReadString(e,n,t)}static gpReadString(e,t,n){const i=new Uint8Array(t);return e.read(i,0,i.length),N.toString(i,n)}static gpWriteString(e,t){const n=N.stringToBytes(t);e.writeByte(t.length),e.write(n,0,n.length)}static gpReadStringByteLength(e,t,n){const i=e.readByte(),r=Ut.gpReadString(e,i,n);return i<t&&e.skip(t-i),r}}class Zte{constructor(){this.volume=-1,this.balance=-1,this.instrument=-1,this.tempoName="",this.tempo=-1,this.duration=-1}}class bi{constructor(){this.x=0,this.y=0,this.w=0,this.h=0}scaleWith(e){this.x*=e,this.y*=e,this.w*=e,this.h*=e}}var hn=function(s){return s[s.Boolean=0]="Boolean",s[s.Integer=1]="Integer",s[s.Float=2]="Float",s[s.String=3]="String",s[s.Point=4]="Point",s[s.Size=5]="Size",s[s.Rectangle=6]="Rectangle",s[s.Color=7]="Color",s}(hn||{});class no{constructor(e){this._types=new Map,this.raw=new Map,e&&this.read(e)}read(e){const t=ps.fromBuffer(e),n=N.readInt32BE(t);for(let i=0;i<n;i++){const r=Ut.gpReadString(t,t.readByte(),"utf-8"),o=t.readByte();switch(this._types.set(r,o),o){case hn.Boolean:const a=1===t.readByte();this.addValue(r,a);break;case hn.Integer:const l=N.readInt32BE(t);this.addValue(r,l);break;case hn.Float:const c=N.readFloat32BE(t);this.addValue(r,c);break;case hn.String:const u=Ut.gpReadString(t,N.readInt16BE(t),"utf-8");this.addValue(r,u);break;case hn.Point:const h=N.readInt32BE(t),d=N.readInt32BE(t);this.addValue(r,new se(h,d));break;case hn.Size:const p=N.readInt32BE(t),g=N.readInt32BE(t);this.addValue(r,new se(p,g));break;case hn.Rectangle:const m=new bi;m.x=N.readInt32BE(t),m.y=N.readInt32BE(t),m.w=N.readInt32BE(t),m.h=N.readInt32BE(t),this.addValue(r,m);break;case hn.Color:const _=Ut.gpReadColor(t,!0);this.addValue(r,_)}}}apply(e){for(const[t,n]of this.raw)switch(t){case"StandardNotation/hideDynamics":e.stylesheet.hideDynamics=n;break;case"System/bracketExtendMode":e.stylesheet.bracketExtendMode=n;break;case"Global/useSystemSignSeparator":e.stylesheet.useSystemSignSeparator=n;break;case"Global/DisplayTuning":e.stylesheet.globalDisplayTuning=n;break;case"Global/DrawChords":e.stylesheet.globalDisplayChordDiagramsOnTop=n;break;case"System/showTrackNameSingle":n||(e.stylesheet.singleTrackTrackNamePolicy=rs.Hidden);break;case"System/showTrackNameMulti":n||(e.stylesheet.multiTrackTrackNamePolicy=rs.Hidden);break;case"System/trackNameModeSingle":if(e.stylesheet.singleTrackTrackNamePolicy!==rs.Hidden)switch(n){case 0:case 1:e.stylesheet.singleTrackTrackNamePolicy=rs.FirstSystem;break;case 2:e.stylesheet.singleTrackTrackNamePolicy=rs.AllSystems}break;case"System/trackNameModeMulti":if(e.stylesheet.multiTrackTrackNamePolicy!==rs.Hidden)switch(n){case 0:case 1:e.stylesheet.multiTrackTrackNamePolicy=rs.FirstSystem;break;case 2:e.stylesheet.multiTrackTrackNamePolicy=rs.AllSystems}break;case"System/shortTrackNameOnFirstSystem":e.stylesheet.firstSystemTrackNameMode=n?Wi.ShortName:Wi.FullName;break;case"System/shortTrackNameOnOtherSystems":e.stylesheet.otherSystemsTrackNameMode=n?Wi.ShortName:Wi.FullName;break;case"System/horizontalTrackNameOnFirstSystem":e.stylesheet.firstSystemTrackNameOrientation=n?Gi.Horizontal:Gi.Vertical;break;case"System/horizontalTrackNameOnOtherSystems":e.stylesheet.otherSystemsTrackNameOrientation=n?Gi.Horizontal:Gi.Vertical;break;case"Header/Title":ie.getOrCreateHeaderFooterStyle(e,re.Title).template=n;break;case"Header/TitleAlignment":ie.getOrCreateHeaderFooterStyle(e,re.Title).textAlign=this.toTextAlign(n);break;case"Header/drawTitle":ie.getOrCreateHeaderFooterStyle(e,re.Title).isVisible=n;break;case"Header/Subtitle":ie.getOrCreateHeaderFooterStyle(e,re.SubTitle).template=n;break;case"Header/SubtitleAlignment":ie.getOrCreateHeaderFooterStyle(e,re.SubTitle).textAlign=this.toTextAlign(n);break;case"Header/drawSubtitle":ie.getOrCreateHeaderFooterStyle(e,re.SubTitle).isVisible=n;break;case"Header/Artist":ie.getOrCreateHeaderFooterStyle(e,re.Artist).template=n;break;case"Header/ArtistAlignment":ie.getOrCreateHeaderFooterStyle(e,re.Artist).textAlign=this.toTextAlign(n);break;case"Header/drawArtist":ie.getOrCreateHeaderFooterStyle(e,re.Artist).isVisible=n;break;case"Header/Album":ie.getOrCreateHeaderFooterStyle(e,re.Album).template=n;break;case"Header/AlbumAlignment":ie.getOrCreateHeaderFooterStyle(e,re.Album).textAlign=this.toTextAlign(n);break;case"Header/drawAlbum":ie.getOrCreateHeaderFooterStyle(e,re.Album).isVisible=n;break;case"Header/Words":ie.getOrCreateHeaderFooterStyle(e,re.Words).template=n;break;case"Header/WordsAlignment":ie.getOrCreateHeaderFooterStyle(e,re.Words).textAlign=this.toTextAlign(n);break;case"Header/drawWords":ie.getOrCreateHeaderFooterStyle(e,re.Words).isVisible=n;break;case"Header/Music":ie.getOrCreateHeaderFooterStyle(e,re.Music).template=n;break;case"Header/MusicAlignment":ie.getOrCreateHeaderFooterStyle(e,re.Music).textAlign=this.toTextAlign(n);break;case"Header/drawMusic":ie.getOrCreateHeaderFooterStyle(e,re.Music).isVisible=n;break;case"Header/WordsAndMusic":ie.getOrCreateHeaderFooterStyle(e,re.WordsAndMusic).template=n;break;case"Header/WordsAndMusicAlignment":ie.getOrCreateHeaderFooterStyle(e,re.WordsAndMusic).textAlign=this.toTextAlign(n);break;case"Header/drawWordsAndMusic":ie.getOrCreateHeaderFooterStyle(e,re.WordsAndMusic).isVisible=n;break;case"Header/Tabber":ie.getOrCreateHeaderFooterStyle(e,re.Transcriber).template=n;break;case"Header/TabberAlignment":ie.getOrCreateHeaderFooterStyle(e,re.Transcriber).textAlign=this.toTextAlign(n);break;case"Header/drawTabber":ie.getOrCreateHeaderFooterStyle(e,re.Transcriber).isVisible=n;break;case"Footer/Copyright":ie.getOrCreateHeaderFooterStyle(e,re.Copyright).template=n;break;case"Footer/CopyrightAlignment":ie.getOrCreateHeaderFooterStyle(e,re.Copyright).textAlign=this.toTextAlign(n);break;case"Footer/drawCopyright":ie.getOrCreateHeaderFooterStyle(e,re.Copyright).isVisible=n;break;case"Footer/Copyright2":ie.getOrCreateHeaderFooterStyle(e,re.CopyrightSecondLine).template=n;break;case"Footer/Copyright2Alignment":ie.getOrCreateHeaderFooterStyle(e,re.CopyrightSecondLine).textAlign=this.toTextAlign(n);break;case"Footer/drawCopyright2":ie.getOrCreateHeaderFooterStyle(e,re.CopyrightSecondLine).isVisible=n}}toTextAlign(e){switch(e){case 0:return ye.Left;case 1:return ye.Center;case 2:return ye.Right}return ye.Left}addValue(e,t,n){this.raw.set(e,t),void 0!==n&&this._types.set(e,n)}writeTo(e){N.writeInt32BE(e,this.raw.size);for(const[t,n]of this.raw){const i=this.getDataType(t,n);switch(Ut.gpWriteString(e,t),e.writeByte(i),i){case hn.Boolean:e.writeByte(n?1:0);break;case hn.Integer:N.writeInt32BE(e,n);break;case hn.Float:N.writeFloat32BE(e,n);break;case hn.String:const r=N.stringToBytes(n);N.writeInt16BE(e,r.length),e.write(r,0,r.length);break;case hn.Point:case hn.Size:N.writeInt32BE(e,n.offset),N.writeInt32BE(e,n.value);break;case hn.Rectangle:N.writeInt32BE(e,n.x),N.writeInt32BE(e,n.y),N.writeInt32BE(e,n.w),N.writeInt32BE(e,n.h);break;case hn.Color:e.writeByte(n.r),e.writeByte(n.g),e.writeByte(n.b),e.writeByte(n.a)}}}getDataType(e,t){if(this._types.has(e))return this._types.get(e);const n=typeof t;switch(typeof t){case"string":return hn.String;case"number":return t===(0|t)?hn.Integer:hn.Float;case"object":if(t instanceof se)return hn.Point;if(t instanceof bi)return hn.Rectangle;if(t instanceof _n)return hn.Color}throw new rn(un.General,`Unknown value type in BinaryStylesheet: ${n}`)}static writeForScore(e){const t=new no;switch(t.addValue("StandardNotation/hideDynamics",e.stylesheet.hideDynamics,hn.Boolean),t.addValue("System/bracketExtendMode",e.stylesheet.bracketExtendMode,hn.Integer),t.addValue("Global/useSystemSignSeparator",e.stylesheet.useSystemSignSeparator,hn.Boolean),t.addValue("Global/DisplayTuning",e.stylesheet.globalDisplayTuning,hn.Boolean),t.addValue("Global/DrawChords",e.stylesheet.globalDisplayChordDiagramsOnTop,hn.Boolean),e.stylesheet.singleTrackTrackNamePolicy){case rs.Hidden:t.addValue("System/showTrackNameSingle",!1,hn.Boolean);break;case rs.FirstSystem:t.addValue("System/trackNameModeSingle",0,hn.Integer);break;case rs.AllSystems:t.addValue("System/trackNameModeSingle",2,hn.Integer)}switch(e.stylesheet.multiTrackTrackNamePolicy){case rs.Hidden:t.addValue("System/showTrackNameMulti",!1,hn.Boolean);break;case rs.FirstSystem:t.addValue("System/trackNameModeMulti",0,hn.Integer);break;case rs.AllSystems:t.addValue("System/trackNameModeMulti",2,hn.Integer)}switch(e.stylesheet.firstSystemTrackNameMode){case Wi.FullName:t.addValue("System/shortTrackNameOnFirstSystem",!1,hn.Boolean);break;case Wi.ShortName:t.addValue("System/shortTrackNameOnFirstSystem",!0,hn.Boolean)}switch(e.stylesheet.otherSystemsTrackNameMode){case Wi.FullName:t.addValue("System/shortTrackNameOnOtherSystems",!1,hn.Boolean);break;case Wi.ShortName:t.addValue("System/shortTrackNameOnOtherSystems",!0,hn.Boolean)}switch(e.stylesheet.firstSystemTrackNameOrientation){case Gi.Horizontal:t.addValue("System/horizontalTrackNameOnFirstSystem",!0,hn.Boolean);break;case Gi.Vertical:t.addValue("System/horizontalTrackNameOnFirstSystem",!1,hn.Boolean)}switch(e.stylesheet.otherSystemsTrackNameOrientation){case Gi.Horizontal:t.addValue("System/horizontalTrackNameOnOtherSystems",!0,hn.Boolean);break;case Gi.Vertical:t.addValue("System/horizontalTrackNameOnOtherSystems",!1,hn.Boolean)}const n=e.style;if(n)for(const[r,o]of n.headerAndFooter)switch(r){case re.Title:no.addHeaderAndFooter(t,o,"Header/","Title");break;case re.SubTitle:no.addHeaderAndFooter(t,o,"Header/","Subtitle");break;case re.Artist:no.addHeaderAndFooter(t,o,"Header/","Artist");break;case re.Album:no.addHeaderAndFooter(t,o,"Header/","Album");break;case re.Words:no.addHeaderAndFooter(t,o,"Header/","Words");break;case re.Music:no.addHeaderAndFooter(t,o,"Header/","Music");break;case re.WordsAndMusic:no.addHeaderAndFooter(t,o,"Header/","WordsAndMusic");break;case re.Transcriber:no.addHeaderAndFooter(t,o,"Header/","Tabber");break;case re.Copyright:no.addHeaderAndFooter(t,o,"Footer/","Copyright");break;case re.CopyrightSecondLine:no.addHeaderAndFooter(t,o,"Footer/","Copyright2")}const i=ps.withCapacity(128);return t.writeTo(i),i.toArray()}static addHeaderAndFooter(e,t,n,i){e.addValue(`${n}${i}`,t.template,hn.String),e.addValue(`${n}${i}Alignment`,t.textAlign,hn.Integer),void 0!==t.isVisible&&e.addValue(`${n}draw${i}`,t.isVisible,hn.Boolean)}}var es=function(s){return s[s.None=0]="None",s[s.Element=1]="Element",s[s.Text=2]="Text",s[s.CDATA=3]="CDATA",s[s.Document=4]="Document",s[s.DocumentType=5]="DocumentType",s[s.Comment=6]="Comment",s}(es||{});class qo{constructor(){this.nodeType=es.None,this.localName=null,this.value=null,this.childNodes=[],this.attributes=new Map,this.firstChild=null,this.firstElement=null}*childElements(){for(const e of this.childNodes)e.nodeType===es.Element&&(yield e)}addChild(e){this.childNodes.push(e),this.firstChild=e,(e.nodeType===es.Element||e.nodeType===es.CDATA)&&(this.firstElement=e)}getAttribute(e,t=""){return this.attributes.has(e)?this.attributes.get(e):t}getElementsByTagName(e,t=!1){const n=[];return this.searchElementsByTagName(this.childNodes,n,e,t),n}searchElementsByTagName(e,t,n,i=!1){for(const r of e)r&&r.nodeType===es.Element&&r.localName===n&&t.push(r),i&&this.searchElementsByTagName(r.childNodes,t,n,!0)}findChildElement(e){for(const t of this.childNodes)if(t&&t.nodeType===es.Element&&t.localName===e)return t;return null}addElement(e){const t=new qo;return t.nodeType=es.Element,t.localName=e,this.addChild(t),t}get innerText(){if(this.nodeType===es.Element||this.nodeType===es.Document){if(this.firstElement&&this.firstElement.nodeType===es.CDATA)return this.firstElement.innerText;let e="";for(const n of this.childNodes)e+=n.innerText?.toString();return e.trim()}return this.value??""}set innerText(e){const t=new qo;t.nodeType=es.Text,t.value=e,this.childNodes=[t]}setCData(e){const t=new qo;t.nodeType=es.CDATA,t.value=e,this.childNodes=[t]}}class so extends rn{constructor(e,t,n){super(un.Format,e),this.pos=0,this.xml=t,this.pos=n,Object.setPrototypeOf(this,so.prototype)}}var Je=function(s){return s[s.IgnoreSpaces=0]="IgnoreSpaces",s[s.Begin=1]="Begin",s[s.BeginNode=2]="BeginNode",s[s.TagName=3]="TagName",s[s.Body=4]="Body",s[s.AttribName=5]="AttribName",s[s.Equals=6]="Equals",s[s.AttvalBegin=7]="AttvalBegin",s[s.AttribVal=8]="AttribVal",s[s.Childs=9]="Childs",s[s.Close=10]="Close",s[s.WaitEnd=11]="WaitEnd",s[s.WaitEndRet=12]="WaitEndRet",s[s.Pcdata=13]="Pcdata",s[s.Header=14]="Header",s[s.Comment=15]="Comment",s[s.Doctype=16]="Doctype",s[s.Cdata=17]="Cdata",s[s.Escape=18]="Escape",s}(Je||{});class Se{static parse(e,t,n){let i=e.charCodeAt(t),r=Je.Begin,o=Je.Begin,a=0,l="",c=Je.Begin,u=null,h=null,d=0,p=0;for(;t<e.length;){switch(i=e.charCodeAt(t),r){case Je.IgnoreSpaces:switch(i){case Se.CharCodeLF:case Se.CharCodeCR:case Se.CharCodeTab:case Se.CharCodeSpace:break;default:r=o;continue}break;case Je.Begin:if(i!==Se.CharCodeLowerThan){a=t,r=Je.Pcdata;continue}r=Je.IgnoreSpaces,o=Je.BeginNode;break;case Je.Pcdata:if(i===Se.CharCodeLowerThan){l+=e.substr(a,t-a);const g=new qo;g.nodeType=es.Text,g.value=l,l="",n.addChild(g),r=Je.IgnoreSpaces,o=Je.BeginNode}else i===Se.CharCodeAmp&&(l+=e.substr(a,t-a),r=Je.Escape,c=Je.Pcdata,a=t+1);break;case Je.Cdata:if(i===Se.CharCodeBrackedClose&&e.charCodeAt(t+1)===Se.CharCodeBrackedClose&&e.charCodeAt(t+2)===Se.CharCodeGreaterThan){const g=new qo;g.nodeType=es.CDATA,g.value=e.substr(a,t-a),n.addChild(g),t+=2,r=Je.Begin}break;case Je.BeginNode:switch(i){case Se.CharCodeExclamation:if(e.charCodeAt(t+1)===Se.CharCodeBrackedOpen){if("CDATA["!==e.substr(t+=2,6).toUpperCase())throw new so("Expected <![CDATA[",e,t);r=Je.Cdata,a=(t+=5)+1}else if(e.charCodeAt(t+1)===Se.CharCodeUpperD||e.charCodeAt(t+1)===Se.CharCodeLowerD){if("OCTYPE"!==e.substr(t+2,6).toUpperCase())throw new so("Expected <!DOCTYPE",e,t);r=Je.Doctype,a=(t+=8)+1}else{if(e.charCodeAt(t+1)!==Se.CharCodeMinus||e.charCodeAt(t+2)!==Se.CharCodeMinus)throw new so("Expected \x3c!--",e,t);r=Je.Comment,a=(t+=2)+1}break;case Se.CharCodeQuestion:r=Je.Header,a=t;break;case Se.CharCodeSlash:if(!n)throw new so("Expected node name",e,t);a=t+1,r=Je.IgnoreSpaces,o=Je.Close;break;default:r=Je.TagName,a=t;continue}break;case Je.TagName:if(!Se.isValidChar(i)){if(t===a)throw new so("Expected node name",e,t);u=new qo,u.nodeType=es.Element,u.localName=e.substr(a,t-a),n.addChild(u),r=Je.IgnoreSpaces,o=Je.Body;continue}break;case Je.Body:switch(i){case Se.CharCodeSlash:r=Je.WaitEnd;break;case Se.CharCodeGreaterThan:r=Je.Childs;break;default:r=Je.AttribName,a=t;continue}break;case Je.AttribName:if(!Se.isValidChar(i)){if(a===t)throw new so("Expected attribute name",e,t);if(h=e.substr(a,t-a),u.attributes.has(h))throw new so(`Duplicate attribute [${h}]`,e,t);r=Je.IgnoreSpaces,o=Je.Equals;continue}break;case Je.Equals:if(i!==Se.CharCodeEquals)throw new so("Expected =",e,t);r=Je.IgnoreSpaces,o=Je.AttvalBegin;break;case Je.AttvalBegin:switch(i){case Se.CharCodeDoubleQuote:case Se.CharCodeSingleQuote:l="",r=Je.AttribVal,a=t+1,p=i}break;case Je.AttribVal:if(i===Se.CharCodeAmp)l+=e.substr(a,t-a),r=Je.Escape,c=Je.AttribVal,a=t+1;else if(i===p){l+=e.substr(a,t-a);const g=l;l="",u.attributes.set(h,g),r=Je.IgnoreSpaces,o=Je.Body}break;case Je.Childs:a=t=Se.parse(e,t,u),r=Je.Begin;break;case Je.WaitEnd:if(i!==Se.CharCodeGreaterThan)throw new so("Expected >",e,t);r=Je.Begin;break;case Je.WaitEndRet:if(i===Se.CharCodeGreaterThan)return t;throw new so("Expected >",e,t);case Je.Close:if(!Se.isValidChar(i)){if(a===t)throw new so("Expected node name",e,t);if(e.substr(a,t-a)!==n.localName)throw new so(`Expected </${n.localName}>`,e,t);r=Je.IgnoreSpaces,o=Je.WaitEndRet;continue}break;case Je.Comment:i===Se.CharCodeMinus&&e.charCodeAt(t+1)===Se.CharCodeMinus&&e.charCodeAt(t+2)===Se.CharCodeGreaterThan&&(t+=2,r=Je.Begin);break;case Je.Doctype:if(i===Se.CharCodeBrackedOpen)d++;else if(i===Se.CharCodeBrackedClose)d--;else if(i===Se.CharCodeGreaterThan&&0===d){const g=new qo;g.nodeType=es.DocumentType,g.value=e.substr(a,t-a),n.addChild(g),r=Je.Begin}break;case Je.Header:i===Se.CharCodeQuestion&&e.charCodeAt(t+1)===Se.CharCodeGreaterThan&&(t++,r=Je.Begin);break;case Je.Escape:if(i===Se.CharCodeSemi){const g=e.substr(a,t-a);if(g.charCodeAt(0)===Se.CharCodeSharp){const m=g.charCodeAt(1)===Se.CharCodeLowerX?Number.parseInt(`0${g.substr(1,g.length-1)}`):Number.parseInt(g.substr(1,g.length-1));l+=String.fromCharCode(m)}else Se.Escapes.has(g)?l+=Se.Escapes.get(g):l+=`&${g};`?.toString();a=t+1,r=c}else!Se.isValidChar(i)&&i!==Se.CharCodeSharp&&(l+="&",l+=e.substr(a,t-a),a=1+--t,r=c)}t++}if(r===Je.Begin&&(a=t,r=Je.Pcdata),r===Je.Pcdata){if(t!==a){l+=e.substr(a,t-a);const g=new qo;g.nodeType=es.Text,g.value=l,n.addChild(g)}return t}if(r===Je.Escape&&c===Je.Pcdata){l+="&",l+=e.substr(a,t-a);const g=new qo;return g.nodeType=es.Text,g.value=l,n.addChild(g),t}throw new so("Unexpected end",e,t)}static isValidChar(e){return e>=Se.CharCodeLowerA&&e<=Se.CharCodeLowerZ||e>=Se.CharCodeUpperA&&e<=Se.CharCodeUpperZ||e>=Se.CharCode0&&e<=Se.CharCode9||e===Se.CharCodeColon||e===Se.CharCodeDot||e===Se.CharCodeUnderscore||e===Se.CharCodeMinus}}Se.CharCodeLF=10,Se.CharCodeTab=9,Se.CharCodeCR=13,Se.CharCodeSpace=32,Se.CharCodeLowerThan=60,Se.CharCodeAmp=38,Se.CharCodeBrackedClose=93,Se.CharCodeBrackedOpen=91,Se.CharCodeGreaterThan=62,Se.CharCodeExclamation=33,Se.CharCodeUpperD=68,Se.CharCodeLowerD=100,Se.CharCodeMinus=45,Se.CharCodeQuestion=63,Se.CharCodeSlash=47,Se.CharCodeEquals=61,Se.CharCodeDoubleQuote=34,Se.CharCodeSingleQuote=39,Se.CharCodeSharp=35,Se.CharCodeLowerX=120,Se.CharCodeLowerA=97,Se.CharCodeLowerZ=122,Se.CharCodeUpperA=65,Se.CharCodeUpperZ=90,Se.CharCode0=48,Se.CharCode9=57,Se.CharCodeColon=58,Se.CharCodeDot=46,Se.CharCodeUnderscore=95,Se.CharCodeSemi=59,Se.Escapes=new Map([["lt","<"],["gt",">"],["amp","&"],["quot",'"'],["apos","'"]]);class wD{static write(e,t,n){const i=new wD(t,n);return i.writeNode(e),i.toString()}constructor(e,t){this._result=[],this._indention=e,this._xmlHeader=t,this._currentIndention="",this._isStartOfLine=!0}writeNode(e){switch(e.nodeType){case es.None:break;case es.Element:this._result.length>0&&this.writeLine(),this.write(`<${e.localName}`);for(const[t,n]of e.attributes)this.write(` ${t}="`),this.writeAttributeValue(n),this.write('"');if(0===e.childNodes.length)this.write("/>");else{if(this.write(">"),1!==e.childNodes.length||e.firstElement){this.indent();for(const t of e.childNodes)(t.nodeType===es.Element||t.nodeType===es.Comment)&&this.writeNode(t);this.unindend(),this.writeLine()}else this.writeNode(e.childNodes[0]);this.write(`</${e.localName}>`)}break;case es.Text:e.value&&this.write(e.value);break;case es.CDATA:null!==e.value&&this.write(`<![CDATA[${e.value}]]>`);break;case es.Document:this._xmlHeader&&this.write('<?xml version="1.0" encoding="utf-8"?>');for(const t of e.childNodes)this.writeNode(t);break;case es.DocumentType:this.write(`<!DOCTYPE ${e.value}>`);break;case es.Comment:this.write(`\x3c!-- ${e.value} --\x3e`)}}unindend(){this._currentIndention=this._currentIndention.substr(0,this._currentIndention.length-this._indention.length)}indent(){this._currentIndention+=this._indention}writeAttributeValue(e){for(let t=0;t<e.length;t++){const n=e.charAt(t);switch(n){case"<":this._result.push("&lt;");break;case">":this._result.push("&gt;");break;case"&":this._result.push("&amp;");break;case"'":this._result.push("&apos;");break;case'"':this._result.push("&quot;");break;default:this._result.push(n)}}}write(e){this._isStartOfLine&&this._result.push(this._currentIndention),this._result.push(e),this._isStartOfLine=!1}writeLine(e=null){e&&this.write(e),this._indention.length>0&&!this._isStartOfLine&&(this._result.push("\n"),this._isStartOfLine=!0)}toString(){return this._result.join("").trimRight()}}class qg extends qo{constructor(){super(),this.nodeType=es.Document}parse(e){Se.parse(e,0,this)}toString(){return this.toFormattedString()}toFormattedString(e="",t=!1){return wD.write(this,e,t)}}class SD{}class Qte{constructor(){this.id="",this.dots=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.value=w.Quarter}}class Kte{constructor(){this.name="",this.path="",this.role="",this.program=0}get uniqueId(){return`${this.path};${this.name};${this.role}`}}class te{constructor(){this._hasAnacrusis=!1,this._skipApplyLyrics=!1,this._backingTrackPadding=0,this._doubleBars=new Set,this._keySignatures=new Map}parseXml(e,t){this._masterTrackAutomations=new Map,this._automationsPerTrackIdAndBarIndex=new Map,this._sustainPedalsPerTrackIdAndBarIndex=new Map,this._tracksMapping=[],this._tracksById=new Map,this._masterBars=[],this._barsOfMasterBar=[],this._voicesOfBar=new Map,this._barsById=new Map,this._voiceById=new Map,this._beatsOfVoice=new Map,this._beatById=new Map,this._rhythmOfBeat=new Map,this._rhythmById=new Map,this._notesOfBeat=new Map,this._noteById=new Map,this._tappedNotes=new Map,this._lyricsByTrack=new Map,this._soundsByTrack=new Map,this._skipApplyLyrics=!1;const n=new qg;try{n.parse(e)}catch(i){throw new Ts("Could not parse XML",i)}if(this.parseDom(n),this.buildModel(),ie.consolidate(this.score),this.score.finish(t),!this._skipApplyLyrics&&this._lyricsByTrack.size>0)for(const[i,r]of this._lyricsByTrack)this._tracksById.get(i).applyLyrics(r)}parseDom(e){const t=e.firstElement;if(t){if("GPIF"!==t.localName)throw new Ts("Root node of XML was not GPIF");this.score=new Cl;for(const n of t.childElements())switch(n.localName){case"Score":this.parseScoreNode(n);break;case"MasterTrack":this.parseMasterTrackNode(n);break;case"BackingTrack":this.parseBackingTrackNode(n);break;case"Tracks":this.parseTracksNode(n);break;case"MasterBars":this.parseMasterBarsNode(n);break;case"Bars":this.parseBars(n);break;case"Voices":this.parseVoices(n);break;case"Beats":this.parseBeats(n);break;case"Notes":this.parseNotes(n);break;case"Rhythms":this.parseRhythms(n);break;case"Assets":this.parseAssets(n)}}}parseAssets(e){for(const t of e.childElements())"Asset"===t.localName&&t.getAttribute("id")===this._backingTrackAssetId&&this.parseBackingTrackAsset(t)}parseBackingTrackAsset(e){let t="";for(const i of e.childElements())"EmbeddedFilePath"===i.localName&&(t=i.innerText);const n=this.loadAsset;if(n){const i=n(t);i?this.score.backingTrack.rawAudioFile=i:this.score.backingTrack=void 0}}parseScoreNode(e){for(const t of e.childElements())switch(t.localName){case"Title":this.score.title=t.innerText;break;case"SubTitle":this.score.subTitle=t.innerText;break;case"Artist":this.score.artist=t.innerText;break;case"Album":this.score.album=t.innerText;break;case"Words":this.score.words=t.innerText;break;case"Music":this.score.music=t.innerText;break;case"WordsAndMusic":const n=t.innerText;""!==n&&(n&&!this.score.words&&(this.score.words=n),n&&!this.score.music&&(this.score.music=n));break;case"Copyright":this.score.copyright=t.innerText;break;case"Tabber":this.score.tab=t.innerText;break;case"Instructions":this.score.instructions=t.innerText;break;case"Notices":this.score.notices=t.innerText;break;case"ScoreSystemsDefaultLayout":this.score.defaultSystemsLayout=te.parseIntSafe(t.innerText,4);break;case"ScoreSystemsLayout":this.score.systemsLayout=te.splitSafe(t.innerText).map(i=>te.parseIntSafe(i,4))}}static parseIntSafe(e,t){if(!e)return t;const n=Number.parseInt(e);return Number.isNaN(n)?t:n}static parseFloatSafe(e,t){if(!e)return t;const n=Number.parseFloat(e);return Number.isNaN(n)?t:n}static splitSafe(e,t=" "){return e?e.split(t).map(n=>n.trim()).filter(n=>n.length>0):[]}parseBackingTrackNode(e){const t=new SD;let n=!1,i="",r="";for(const o of e.childElements())switch(o.localName){case"Enabled":n="true"===o.innerText;break;case"Source":i=o.innerText;break;case"AssetId":r=o.innerText;break;case"FramePadding":this._backingTrackPadding=te.parseIntSafe(o.innerText,0)/te.SampleRate*1e3}n&&"Local"===i&&(this.score.backingTrack=t,this._backingTrackAssetId=r)}parseMasterTrackNode(e){for(const t of e.childElements())switch(t.localName){case"Automations":this.parseAutomations(t,this._masterTrackAutomations,null,null);break;case"Tracks":this._tracksMapping=te.splitSafe(t.innerText);break;case"Anacrusis":this._hasAnacrusis=!0}}parseAutomations(e,t,n,i){for(const r of e.childElements())"Automation"===r.localName&&this.parseAutomation(r,t,n,i)}parseAutomation(e,t,n,i){let p,r=null,o=!1,a=-1,l=0,c=0,u=null,h=0,d=null;for(const m of e.childElements())switch(m.localName){case"Type":r=m.innerText;break;case"Linear":o="true"===m.innerText.toLowerCase();break;case"Bar":a=te.parseIntSafe(m.innerText,0);break;case"Position":l=te.parseFloatSafe(m.innerText,0);break;case"Value":if(m.firstElement&&m.firstElement.nodeType===es.CDATA)u=m.innerText;else if(m.firstElement&&m.firstElement.nodeType===es.Element&&"SyncPoint"===r){p=new Vg;for(const _ of m.childElements())switch(_.localName){case"BarIndex":a=te.parseIntSafe(_.innerText,0);break;case"BarOccurrence":p.barOccurence=te.parseIntSafe(_.innerText,0);break;case"FrameOffset":const y=te.parseFloatSafe(_.innerText,0);p.millisecondOffset=y/te.SampleRate*1e3}}else{const _=te.splitSafe(m.innerText);1===_.length?(c=te.parseFloatSafe(_[0],0),h=1):(c=te.parseFloatSafe(_[0],0),h=te.parseIntSafe(_[1],0))}break;case"Text":d=m.innerText}if(!r)return;let g=null;switch(r){case"Tempo":g=fs.buildTempoAutomation(o,l,c,h);break;case"SyncPoint":g=new fs,g.type=$n.SyncPoint,g.isLinear=o,g.ratioPosition=l,g.syncPointValue=p;break;case"Sound":u&&n&&n.has(u)&&(g=fs.buildInstrumentAutomation(o,l,n.get(u).program));break;case"SustainPedal":if(i){let m;i.has(a)?m=i.get(a):(m=[],i.set(a,m));const _=new gu;switch(_.ratioPosition=l,h){case 1:_.pedalType=Ms.Down;break;case 3:_.pedalType=Ms.Up}m.push(_)}}g&&(d&&(g.text=d),a>=0&&(t.has(a)||t.set(a,[]),t.get(a).push(g)))}parseTracksNode(e){for(const t of e.childElements())"Track"===t.localName&&this.parseTrack(t)}parseTrack(e){this._articulationByName=new Map;const t=new Ph;t.ensureStaveCount(1),t.staves[0].showStandardNotation=!0;const i=e.getAttribute("id");for(const r of e.childElements())switch(r.localName){case"Name":t.name=r.innerText;break;case"Color":const o=te.splitSafe(r.innerText);if(o.length>=3){const c=te.parseIntSafe(o[0],0),u=te.parseIntSafe(o[1],0),h=te.parseIntSafe(o[2],0);t.color=new _n(c,u,h,255)}break;case"Instrument":const a=r.getAttribute("ref");(a.endsWith("-gs")||a.endsWith("GrandStaff"))&&(t.ensureStaveCount(2),t.staves[1].showStandardNotation=!0);break;case"InstrumentSet":this.parseInstrumentSet(t,r);break;case"NotationPatch":this.parseNotationPatch(t,r);break;case"ShortName":t.shortName=r.innerText;break;case"SystemsDefautLayout":t.defaultSystemsLayout=te.parseIntSafe(r.innerText,4);break;case"SystemsLayout":t.systemsLayout=te.splitSafe(r.innerText).map(c=>te.parseIntSafe(c,4));break;case"Lyrics":this.parseLyrics(i,r);break;case"Properties":this.parseTrackProperties(t,r);break;case"GeneralMidi":case"MidiConnection":case"MIDISettings":this.parseGeneralMidi(t,r);break;case"Sounds":this.parseSounds(i,t,r);break;case"PlaybackState":const l=r.innerText;t.playbackInfo.isSolo="Solo"===l,t.playbackInfo.isMute="Mute"===l;break;case"PartSounding":this.parsePartSounding(t,r);break;case"Staves":this.parseStaves(t,r);break;case"Transpose":this.parseTranspose(t,r);break;case"RSE":this.parseRSE(t,r);break;case"Automations":this.parseTrackAutomations(i,r)}this._tracksById.set(i,t)}parseTrackAutomations(e,t){const n=new Map;this._automationsPerTrackIdAndBarIndex.set(e,n);const i=new Map;this._sustainPedalsPerTrackIdAndBarIndex.set(e,i),this.parseAutomations(t,n,this._soundsByTrack.get(e),i)}parseNotationPatch(e,t){for(const n of t.childElements())switch(n.localName){case"LineCount":const i=te.parseIntSafe(n.innerText,5);for(const r of e.staves)r.standardNotationLineCount=i;break;case"Elements":this.parseElements(e,n)}}parseInstrumentSet(e,t){for(const n of t.childElements())switch(n.localName){case"Type":if("drumKit"===n.innerText)for(const r of e.staves)r.isPercussion=!0;break;case"Elements":this.parseElements(e,n);break;case"LineCount":const i=te.parseIntSafe(n.innerText,5);for(const r of e.staves)r.standardNotationLineCount=i}}parseElements(e,t){for(const n of t.childElements())"Element"===n.localName&&this.parseElement(e,n)}parseElement(e,t){const n=t.findChildElement("Type")?.innerText??"";for(const i of t.childElements())switch(i.localName){case"Name":case"Articulations":this.parseArticulations(e,i,n)}}parseArticulations(e,t,n){for(const i of t.childElements())"Articulation"===i.localName&&this.parseArticulation(e,i,n)}parseArticulation(e,t,n){const i=new he;i.outputMidiNumber=-1,i.elementType=n;let r="";for(const o of t.childElements()){const a=o.innerText;switch(o.localName){case"Name":r=o.innerText;break;case"OutputMidiNumber":i.outputMidiNumber=te.parseIntSafe(a,0);break;case"TechniqueSymbol":i.techniqueSymbol=this.parseTechniqueSymbol(a);break;case"TechniquePlacement":switch(a){case"outside":case"above":i.techniqueSymbolPlacement=qe.Bottom;break;case"inside":i.techniqueSymbolPlacement=qe.Middle;break;case"below":i.techniqueSymbolPlacement=qe.Top}break;case"Noteheads":const l=te.splitSafe(a);l.length>=1&&(i.noteHeadDefault=this.parseNoteHead(l[0])),l.length>=2&&(i.noteHeadHalf=this.parseNoteHead(l[1])),l.length>=3&&(i.noteHeadWhole=this.parseNoteHead(l[2])),i.noteHeadHalf===f.None&&(i.noteHeadHalf=i.noteHeadDefault),i.noteHeadWhole===f.None&&(i.noteHeadWhole=i.noteHeadDefault);break;case"StaffLine":i.staffLine=te.parseIntSafe(a,0)}}-1!==i.outputMidiNumber?(e.percussionArticulations.push(i),r.length>0&&this._articulationByName.set(r,i)):r.length>0&&this._articulationByName.has(r)&&(this._articulationByName.get(r).staffLine=i.staffLine)}parseTechniqueSymbol(e){switch(e){case"pictEdgeOfCymbal":return f.PictEdgeOfCymbal;case"articStaccatoAbove":return f.ArticStaccatoAbove;case"noteheadParenthesis":return f.NoteheadParenthesis;case"stringsUpBow":return f.StringsUpBow;case"stringsDownBow":return f.StringsDownBow;case"guitarGolpe":return f.GuitarGolpe;default:return f.None}}parseNoteHead(e){switch(e){case"noteheadDoubleWholeSquare":return f.NoteheadDoubleWholeSquare;case"noteheadDoubleWhole":return f.NoteheadDoubleWhole;case"noteheadWhole":return f.NoteheadWhole;case"noteheadHalf":return f.NoteheadHalf;case"noteheadBlack":return f.NoteheadBlack;case"noteheadNull":return f.NoteheadNull;case"noteheadXOrnate":return f.NoteheadXOrnate;case"noteheadTriangleUpWhole":return f.NoteheadTriangleUpWhole;case"noteheadTriangleUpHalf":return f.NoteheadTriangleUpHalf;case"noteheadTriangleUpBlack":return f.NoteheadTriangleUpBlack;case"noteheadDiamondBlackWide":return f.NoteheadDiamondBlackWide;case"noteheadDiamondWhite":return f.NoteheadDiamondWhite;case"noteheadDiamondWhiteWide":return f.NoteheadDiamondWhiteWide;case"noteheadCircleX":return f.NoteheadCircleX;case"noteheadXWhole":return f.NoteheadXWhole;case"noteheadXHalf":return f.NoteheadXHalf;case"noteheadXBlack":return f.NoteheadXBlack;case"noteheadParenthesis":return f.NoteheadParenthesis;case"noteheadSlashedBlack2":return f.NoteheadSlashedBlack2;case"noteheadCircleSlash":return f.NoteheadCircleSlash;case"noteheadHeavyX":return f.NoteheadHeavyX;case"noteheadHeavyXHat":return f.NoteheadHeavyXHat;default:return F.warning("GPIF","Unknown notehead symbol",e),f.None}}parseStaves(e,t){let n=0;for(const i of t.childElements())"Staff"===i.localName&&(e.ensureStaveCount(n+1),this.parseStaff(e.staves[n],i),n++)}parseStaff(e,t){for(const n of t.childElements())"Properties"===n.localName&&this.parseStaffProperties(e,n)}parseStaffProperties(e,t){for(const n of t.childElements())"Property"===n.localName&&this.parseStaffProperty(e,n)}parseStaffProperty(e,t){switch(t.getAttribute("name")){case"Tuning":for(const r of t.childElements())switch(r.localName){case"Pitches":const o=te.splitSafe(t.findChildElement("Pitches")?.innerText),a=new Array(o.length);for(let l=0;l<a.length;l++)a[a.length-1-l]=te.parseIntSafe(o[l],0);e.stringTuning.tunings=a;break;case"Label":e.stringTuning.name=r.innerText}e.isPercussion||(e.showTablature=!0);break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForStaff(e,t);break;case"CapoFret":const i=te.parseIntSafe(t.findChildElement("Fret")?.innerText,0);e.capo=i}}parseLyrics(e,t){const n=[];for(const i of t.childElements())"Line"===i.localName&&n.push(this.parseLyricsLine(i));this._lyricsByTrack.set(e,n)}parseLyricsLine(e){const t=new Tf;for(const n of e.childElements())switch(n.localName){case"Offset":t.startBar=te.parseIntSafe(n.innerText,0);break;case"Text":t.text=n.innerText}return t}parseDiagramCollectionForTrack(e,t){const n=t.findChildElement("Items");if(n)for(const i of n.childElements())"Item"===i.localName&&this.parseDiagramItemForTrack(e,i)}parseDiagramCollectionForStaff(e,t){const n=t.findChildElement("Items");if(n)for(const i of n.childElements())"Item"===i.localName&&this.parseDiagramItemForStaff(e,i)}parseDiagramItemForTrack(e,t){const n=new gc,i=t.getAttribute("id");for(const r of e.staves)r.addChord(i,n);this.parseDiagramItemForChord(n,t)}parseDiagramItemForStaff(e,t){const n=new gc,i=t.getAttribute("id");e.addChord(i,n),this.parseDiagramItemForChord(n,t)}parseDiagramItemForChord(e,t){e.name=t.getAttribute("name");const n=t.findChildElement("Diagram");if(!n)return e.showDiagram=!1,void(e.showFingering=!1);const i=te.parseIntSafe(n.getAttribute("stringCount"),6),r=te.parseIntSafe(n.getAttribute("baseFret"),0);e.firstFret=r+1;for(let o=0;o<i;o++)e.strings.push(-1);for(const o of n.childElements())switch(o.localName){case"Fret":const a=te.parseIntSafe(o.getAttribute("string"),0);e.strings[i-a-1]=r+te.parseIntSafe(o.getAttribute("fret"),0);break;case"Fingering":const l=new Map;for(const c of o.childElements())if("Position"===c.localName){let u=Ne.Unknown;const h=r+te.parseIntSafe(c.getAttribute("fret"),0);switch(c.getAttribute("finger")){case"Index":u=Ne.IndexFinger;break;case"Middle":u=Ne.MiddleFinger;break;case"Rank":u=Ne.AnnularFinger;break;case"Pinky":u=Ne.LittleFinger;break;case"Thumb":u=Ne.Thumb}u!==Ne.Unknown&&(l.has(u)?e.barreFrets.push(h):l.set(u,!0))}break;case"Property":switch(o.getAttribute("name")){case"ShowName":e.showName="true"===o.getAttribute("value");break;case"ShowDiagram":e.showDiagram="true"===o.getAttribute("value");break;case"ShowFingering":e.showFingering="true"===o.getAttribute("value")}}}parseTrackProperties(e,t){for(const n of t.childElements())"Property"===n.localName&&this.parseTrackProperty(e,n)}parseTrackProperty(e,t){switch(t.getAttribute("name")){case"Tuning":const i=te.splitSafe(t.findChildElement("Pitches")?.innerText),r=new Array(i.length);for(let a=0;a<r.length;a++)r[r.length-1-a]=te.parseIntSafe(i[a],0);for(const a of e.staves)a.stringTuning.tunings=r,a.showStandardNotation=!0,a.showTablature=!0;break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForTrack(e,t);break;case"CapoFret":const o=te.parseIntSafe(t.findChildElement("Fret")?.innerText,0);for(const a of e.staves)a.capo=o}}parseGeneralMidi(e,t){for(const i of t.childElements())switch(i.localName){case"Program":e.playbackInfo.program=te.parseIntSafe(i.innerText,0);break;case"Port":e.playbackInfo.port=te.parseIntSafe(i.innerText,0);break;case"PrimaryChannel":e.playbackInfo.primaryChannel=te.parseIntSafe(i.innerText,0);break;case"SecondaryChannel":e.playbackInfo.secondaryChannel=te.parseIntSafe(i.innerText,0)}if("Percussion"===t.getAttribute("table"))for(const i of e.staves)i.isPercussion=!0}parseSounds(e,t,n){for(const i of n.childElements())"Sound"===i.localName&&this.parseSound(e,t,i)}parseSound(e,t,n){const i=new Kte;for(const r of n.childElements())switch(r.localName){case"Name":i.name=r.innerText;break;case"Path":i.path=r.innerText;break;case"Role":i.role=r.innerText;break;case"MIDI":this.parseSoundMidi(i,r)}("Factory"===i.role||0===t.playbackInfo.program)&&(t.playbackInfo.program=i.program),this._soundsByTrack.has(e)||this._soundsByTrack.set(e,new Map),this._soundsByTrack.get(e).set(i.uniqueId,i)}parseSoundMidi(e,t){for(const n of t.childElements())"Program"===n.localName&&(e.program=te.parseIntSafe(n.innerText,0))}parsePartSounding(e,t){for(const n of t.childElements())if("TranspositionPitch"===n.localName)for(const i of e.staves)i.displayTranspositionPitch=te.parseIntSafe(n.innerText,0)}parseTranspose(e,t){let n=0,i=0;for(const r of t.childElements())switch(r.localName){case"Chromatic":i=te.parseIntSafe(r.innerText,0);break;case"Octave":n=te.parseIntSafe(r.innerText,0)}for(const r of e.staves)r.displayTranspositionPitch=12*n+i}parseRSE(e,t){for(const n of t.childElements())"ChannelStrip"===n.localName&&this.parseChannelStrip(e,n)}parseChannelStrip(e,t){for(const n of t.childElements())"Parameters"===n.localName&&this.parseChannelStripParameters(e,n)}parseChannelStripParameters(e,t){if(t.firstChild&&t.firstChild.value){const n=te.splitSafe(t.firstChild.value);n.length>=12&&(e.playbackInfo.balance=Math.floor(16*te.parseFloatSafe(n[11],.5)),e.playbackInfo.volume=Math.floor(16*te.parseFloatSafe(n[12],.9)))}}parseMasterBarsNode(e){for(const t of e.childElements())"MasterBar"===t.localName&&this.parseMasterBar(t)}parseMasterBar(e){const t=new kl;0===this._masterBars.length&&this._hasAnacrusis&&(t.isAnacrusis=!0);for(const n of e.childElements())switch(n.localName){case"Time":const i=n.innerText.split("/");t.timeSignatureNumerator=te.parseIntSafe(i[0],4),t.timeSignatureDenominator=te.parseIntSafe(i[1],4);break;case"FreeTime":t.isFreeTime=!0;break;case"DoubleBar":t.isDoubleBar=!0,this._doubleBars.add(t);break;case"Section":t.section=new kf,t.section.marker=n.findChildElement("Letter")?.innerText??"",t.section.text=n.findChildElement("Text")?.innerText??"";break;case"Repeat":"true"===n.getAttribute("start").toLowerCase()&&(t.isRepeatStart=!0),"true"===n.getAttribute("end").toLowerCase()&&n.getAttribute("count")&&(t.repeatCount=te.parseIntSafe(n.getAttribute("count"),1));break;case"AlternateEndings":const r=te.splitSafe(n.innerText);let o=0;for(let u=0;u<r.length;u++)o|=1<<-1+te.parseIntSafe(r[u],0);t.alternateEndings=o;break;case"Bars":this._barsOfMasterBar.push(te.splitSafe(n.innerText));break;case"TripletFeel":switch(n.innerText){case"NoTripletFeel":t.tripletFeel=nt.NoTripletFeel;break;case"Triplet8th":t.tripletFeel=nt.Triplet8th;break;case"Triplet16th":t.tripletFeel=nt.Triplet16th;break;case"Dotted8th":t.tripletFeel=nt.Dotted8th;break;case"Dotted16th":t.tripletFeel=nt.Dotted16th;break;case"Scottish8th":t.tripletFeel=nt.Scottish8th;break;case"Scottish16th":t.tripletFeel=nt.Scottish16th}break;case"Key":const a=te.parseIntSafe(n.findChildElement("AccidentalCount")?.innerText,0),l=n.findChildElement("Mode");let c=dr.Major;if(l)switch(l.innerText.toLowerCase()){case"major":c=dr.Major;break;case"minor":c=dr.Minor}this._keySignatures.set(this._masterBars.length,[a,c]);break;case"Fermatas":this.parseFermatas(t,n);break;case"XProperties":this.parseMasterBarXProperties(t,n);break;case"Directions":this.parseDirections(t,n)}this._masterBars.push(t)}parseDirections(e,t){for(const n of t.childElements())switch(n.localName){case"Target":switch(n.innerText){case"Coda":e.addDirection(j.TargetCoda);break;case"DoubleCoda":e.addDirection(j.TargetDoubleCoda);break;case"Segno":e.addDirection(j.TargetSegno);break;case"SegnoSegno":e.addDirection(j.TargetSegnoSegno);break;case"Fine":e.addDirection(j.TargetFine)}break;case"Jump":switch(n.innerText){case"DaCapo":e.addDirection(j.JumpDaCapo);break;case"DaCapoAlCoda":e.addDirection(j.JumpDaCapoAlCoda);break;case"DaCapoAlDoubleCoda":e.addDirection(j.JumpDaCapoAlDoubleCoda);break;case"DaCapoAlFine":e.addDirection(j.JumpDaCapoAlFine);break;case"DaSegno":e.addDirection(j.JumpDalSegno);break;case"DaSegnoAlCoda":e.addDirection(j.JumpDalSegnoAlCoda);break;case"DaSegnoAlDoubleCoda":e.addDirection(j.JumpDalSegnoAlDoubleCoda);break;case"DaSegnoAlFine":e.addDirection(j.JumpDalSegnoAlFine);break;case"DaSegnoSegno":e.addDirection(j.JumpDalSegnoSegno);break;case"DaSegnoSegnoAlCoda":e.addDirection(j.JumpDalSegnoSegnoAlCoda);break;case"DaSegnoSegnoAlDoubleCoda":e.addDirection(j.JumpDalSegnoSegnoAlDoubleCoda);break;case"DaSegnoSegnoAlFine":e.addDirection(j.JumpDalSegnoSegnoAlFine);break;case"DaCoda":e.addDirection(j.JumpDaCoda);break;case"DaDoubleCoda":e.addDirection(j.JumpDaDoubleCoda)}}}parseFermatas(e,t){for(const n of t.childElements())"Fermata"===n.localName&&this.parseFermata(e,n)}parseFermata(e,t){let n=0;const i=new Cf;for(const r of t.childElements())switch(r.localName){case"Type":switch(r.innerText){case"Short":i.type=Ui.Short;break;case"Medium":i.type=Ui.Medium;break;case"Long":i.type=Ui.Long}break;case"Length":i.length=te.parseFloatSafe(r.innerText,0);break;case"Offset":const o=r.innerText.split("/");2===o.length&&(n=te.parseIntSafe(o[0],4)/te.parseIntSafe(o[1],4)*G.QuarterTime|0)}e.addFermata(n,i)}parseBars(e){for(const t of e.childElements())"Bar"===t.localName&&this.parseBar(t)}parseBar(e){const t=new Sl,n=e.getAttribute("id");for(const i of e.childElements())switch(i.localName){case"Voices":this._voicesOfBar.set(n,te.splitSafe(i.innerText));break;case"Clef":switch(i.innerText){case"Neutral":t.clef=Et.Neutral;break;case"G2":t.clef=Et.G2;break;case"F4":t.clef=Et.F4;break;case"C4":t.clef=Et.C4;break;case"C3":t.clef=Et.C3}break;case"Ottavia":switch(i.innerText){case"8va":t.clefOttava=Ze._8va;break;case"15ma":t.clefOttava=Ze._15ma;break;case"8vb":t.clefOttava=Ze._8vb;break;case"15mb":t.clefOttava=Ze._15mb}break;case"SimileMark":switch(i.innerText){case"Simple":t.simileMark=ws.Simple;break;case"FirstOfDouble":t.simileMark=ws.FirstOfDouble;break;case"SecondOfDouble":t.simileMark=ws.SecondOfDouble}break;case"XProperties":this.parseBarXProperties(i,t)}this._barsById.set(n,t)}parseVoices(e){for(const t of e.childElements())"Voice"===t.localName&&this.parseVoice(t)}parseVoice(e){const t=new ko,n=e.getAttribute("id");for(const i of e.childElements())"Beats"===i.localName&&this._beatsOfVoice.set(n,te.splitSafe(i.innerText));this._voiceById.set(n,t)}parseBeats(e){for(const t of e.childElements())"Beat"===t.localName&&this.parseBeat(t)}parseBeat(e){const t=new Ei,n=e.getAttribute("id");for(const i of e.childElements())switch(i.localName){case"Notes":this._notesOfBeat.set(n,te.splitSafe(i.innerText));break;case"Rhythm":this._rhythmOfBeat.set(n,i.getAttribute("ref"));break;case"Fadding":switch(i.innerText){case"FadeIn":t.fade=Ks.FadeIn;break;case"FadeOut":t.fade=Ks.FadeOut;break;case"VolumeSwell":t.fade=Ks.VolumeSwell}break;case"Tremolo":switch(i.innerText){case"1/2":t.tremoloSpeed=w.Eighth;break;case"1/4":t.tremoloSpeed=w.Sixteenth;break;case"1/8":t.tremoloSpeed=w.ThirtySecond}break;case"Chord":t.chordId=i.innerText;break;case"Hairpin":switch(i.innerText){case"Crescendo":t.crescendo=Zi.Crescendo;break;case"Decrescendo":t.crescendo=Zi.Decrescendo}break;case"Arpeggio":t.brushType="Up"===i.innerText?fe.ArpeggioUp:fe.ArpeggioDown;break;case"Properties":this.parseBeatProperties(i,t);break;case"XProperties":this.parseBeatXProperties(i,t);break;case"FreeText":t.text=i.innerText;break;case"TransposedPitchStemOrientation":switch(i.innerText){case"Upward":t.preferredBeamDirection=V.Up;break;case"Downward":t.preferredBeamDirection=V.Down}break;case"Dynamic":switch(i.innerText){case"PPP":t.dynamics=Te.PPP;break;case"PP":t.dynamics=Te.PP;break;case"P":t.dynamics=Te.P;break;case"MP":t.dynamics=Te.MP;break;case"MF":t.dynamics=Te.MF;break;case"F":t.dynamics=Te.F;break;case"FF":t.dynamics=Te.FF;break;case"FFF":t.dynamics=Te.FFF}break;case"GraceNotes":switch(i.innerText){case"OnBeat":t.graceType=Ee.OnBeat;break;case"BeforeBeat":t.graceType=Ee.BeforeBeat}break;case"Legato":"true"===i.getAttribute("origin")&&(t.isLegatoOrigin=!0);break;case"Whammy":const r=new se(0,0);r.value=this.toBendValue(te.parseFloatSafe(i.getAttribute("originValue"),0)),r.offset=this.toBendOffset(te.parseFloatSafe(i.getAttribute("originOffset"),0)),t.addWhammyBarPoint(r);const o=new se(0,0);o.value=this.toBendValue(te.parseFloatSafe(i.getAttribute("middleValue"),0)),o.offset=this.toBendOffset(te.parseFloatSafe(i.getAttribute("middleOffset1"),0)),t.addWhammyBarPoint(o);const a=new se(0,0);a.value=this.toBendValue(te.parseFloatSafe(i.getAttribute("middleValue"),0)),a.offset=this.toBendOffset(te.parseFloatSafe(i.getAttribute("middleOffset2"),0)),t.addWhammyBarPoint(a);const l=new se(0,0);l.value=this.toBendValue(te.parseFloatSafe(i.getAttribute("destinationValue"),0)),l.offset=this.toBendOffset(te.parseFloatSafe(i.getAttribute("destinationOffset"),0)),t.addWhammyBarPoint(l);break;case"Ottavia":switch(i.innerText){case"8va":t.ottava=Ze._8va;break;case"8vb":t.ottava=Ze._8vb;break;case"15ma":t.ottava=Ze._15ma;break;case"15mb":t.ottava=Ze._15mb}break;case"Lyrics":t.lyrics=this.parseBeatLyrics(i),this._skipApplyLyrics=!0;break;case"Slashed":t.slashed=!0;break;case"DeadSlapped":t.deadSlapped=!0;break;case"Golpe":switch(i.innerText){case"Finger":t.golpe=Rr.Finger;break;case"Thumb":t.golpe=Rr.Thumb}break;case"Wah":switch(i.innerText){case"Open":t.wahPedal=eo.Open;break;case"Closed":t.wahPedal=eo.Closed}break;case"UserTransposedPitchStemOrientation":switch(i.innerText){case"Downward":t.preferredBeamDirection=V.Down;break;case"Upward":t.preferredBeamDirection=V.Up}break;case"Timer":t.showTimer=!0,t.timer=te.parseIntSafe(i.innerText,-1),t.timer<0&&(t.timer=null)}this._beatById.set(n,t)}parseBeatLyrics(e){const t=[];for(const n of e.childElements())"Line"===n.localName&&t.push(n.innerText);return t}parseBeatXProperties(e,t){for(const n of e.childElements())if("XProperty"===n.localName){let r=0;switch(n.getAttribute("id")){case"1124204546":switch(r=te.parseIntSafe(n.findChildElement("Int")?.innerText,0),r){case 1:t.beamingMode=jn.ForceMergeWithNext;break;case 2:t.beamingMode=jn.ForceSplitToNext}break;case"1124204552":1===(r=te.parseIntSafe(n.findChildElement("Int")?.innerText,0),r)&&t.beamingMode!==jn.ForceSplitToNext&&(t.beamingMode=jn.ForceSplitOnSecondaryToNext);break;case"1124204545":r=te.parseIntSafe(n.findChildElement("Int")?.innerText,0),t.invertBeamDirection=1===r;break;case"687935489":r=te.parseIntSafe(n.findChildElement("Int")?.innerText,0),t.brushDuration=r}}}parseBarXProperties(e,t){for(const n of e.childElements())if("XProperty"===n.localName&&"1124139520"===n.getAttribute("id")){const r=n.findChildElement("Double")??n.findChildElement("Float");t.displayScale=te.parseFloatSafe(r?.innerText,1)}}parseMasterBarXProperties(e,t){for(const n of t.childElements())"XProperty"===n.localName&&"1124073984"===n.getAttribute("id")&&(e.displayScale=te.parseFloatSafe(n.findChildElement("Double")?.innerText,1))}parseBeatProperties(e,t){let n=!1,i=null,r=null,o=null,a=null,l=null;for(const c of e.childElements())if("Property"===c.localName)switch(c.getAttribute("name")){case"Brush":t.brushType="Up"===c.findChildElement("Direction")?.innerText?fe.BrushUp:fe.BrushDown;break;case"PickStroke":t.pickStroke="Up"===c.findChildElement("Direction")?.innerText?yi.Up:yi.Down;break;case"Slapped":c.findChildElement("Enable")&&(t.slap=!0);break;case"Popped":c.findChildElement("Enable")&&(t.pop=!0);break;case"VibratoWTremBar":switch(c.findChildElement("Strength")?.innerText){case"Wide":t.vibrato=Ft.Wide;break;case"Slight":t.vibrato=Ft.Slight}break;case"WhammyBar":n=!0;break;case"WhammyBarExtend":break;case"WhammyBarOriginValue":i||(i=new se(0,0)),i.value=this.toBendValue(te.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarOriginOffset":i||(i=new se(0,0)),i.offset=this.toBendOffset(te.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarMiddleValue":r=this.toBendValue(te.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarMiddleOffset1":o=this.toBendOffset(te.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarMiddleOffset2":a=this.toBendOffset(te.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarDestinationValue":l||(l=new se(se.MaxPosition,0)),l.value=this.toBendValue(te.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"WhammyBarDestinationOffset":l||(l=new se(0,0)),l.offset=this.toBendOffset(te.parseFloatSafe(c.findChildElement("Float")?.innerText,0));break;case"BarreFret":t.barreFret=te.parseIntSafe(c.findChildElement("Fret")?.innerText,0);break;case"BarreString":switch(c.findChildElement("String")?.innerText){case"0":t.barreShape=to.Full;break;case"1":t.barreShape=to.Half}break;case"Rasgueado":switch(c.findChildElement("Rasgueado")?.innerText){case"ii_1":t.rasgueado=ge.Ii;break;case"mi_1":t.rasgueado=ge.Mi;break;case"mii_1":t.rasgueado=ge.MiiTriplet;break;case"mii_2":t.rasgueado=ge.MiiAnapaest;break;case"pmp_1":t.rasgueado=ge.PmpTriplet;break;case"pmp_2":t.rasgueado=ge.PmpAnapaest;break;case"pei_1":t.rasgueado=ge.PeiTriplet;break;case"pei_2":t.rasgueado=ge.PeiAnapaest;break;case"pai_1":t.rasgueado=ge.PaiTriplet;break;case"pai_2":t.rasgueado=ge.PaiAnapaest;break;case"ami_1":t.rasgueado=ge.AmiTriplet;break;case"ami_2":t.rasgueado=ge.AmiAnapaest;break;case"ppp_1":t.rasgueado=ge.Ppp;break;case"amii_1":t.rasgueado=ge.Amii;break;case"amip_1":t.rasgueado=ge.Amip;break;case"eami_1":t.rasgueado=ge.Eami;break;case"eamii_1":t.rasgueado=ge.Eamii;break;case"peami_1":t.rasgueado=ge.Peami}}n&&(i||(i=new se(0,0)),l||(l=new se(se.MaxPosition,0)),t.addWhammyBarPoint(i),o&&r&&t.addWhammyBarPoint(new se(o,r)),a&&r&&t.addWhammyBarPoint(new se(a,r)),!o&&!a&&r&&t.addWhammyBarPoint(new se(se.MaxPosition/2|0,r)),t.addWhammyBarPoint(l))}parseNotes(e){for(const t of e.childElements())"Note"===t.localName&&this.parseNote(t)}parseNote(e){const t=new Co,n=e.getAttribute("id");for(const i of e.childElements())switch(i.localName){case"Properties":this.parseNoteProperties(i,t,n);break;case"AntiAccent":"normal"===i.innerText.toLowerCase()&&(t.isGhost=!0);break;case"LetRing":t.isLetRing=!0;break;case"Trill":t.trillValue=te.parseIntSafe(i.innerText,-1),t.trillSpeed=w.Sixteenth;break;case"Accent":const r=te.parseIntSafe(i.innerText,0);!!(1&r)&&(t.isStaccato=!0),!!(4&r)&&(t.accentuated=Ss.Heavy),!!(8&r)&&(t.accentuated=Ss.Normal),16&r&&(t.accentuated=Ss.Tenuto);break;case"Tie":"true"===i.getAttribute("destination").toLowerCase()&&(t.isTieDestination=!0);break;case"Vibrato":switch(i.innerText){case"Slight":t.vibrato=Ft.Slight;break;case"Wide":t.vibrato=Ft.Wide}break;case"LeftFingering":switch(i.innerText){case"P":t.leftHandFinger=Ne.Thumb;break;case"I":t.leftHandFinger=Ne.IndexFinger;break;case"M":t.leftHandFinger=Ne.MiddleFinger;break;case"A":t.leftHandFinger=Ne.AnnularFinger;break;case"C":t.leftHandFinger=Ne.LittleFinger}break;case"RightFingering":switch(i.innerText){case"P":t.rightHandFinger=Ne.Thumb;break;case"I":t.rightHandFinger=Ne.IndexFinger;break;case"M":t.rightHandFinger=Ne.MiddleFinger;break;case"A":t.rightHandFinger=Ne.AnnularFinger;break;case"C":t.rightHandFinger=Ne.LittleFinger}break;case"InstrumentArticulation":t.percussionArticulation=te.parseIntSafe(i.innerText,0);break;case"Ornament":switch(i.innerText){case"Turn":t.ornament=vs.Turn;break;case"InvertedTurn":t.ornament=vs.InvertedTurn;break;case"UpperMordent":t.ornament=vs.UpperMordent;break;case"LowerMordent":t.ornament=vs.LowerMordent}}this._noteById.set(n,t)}parseNoteProperties(e,t,n){let i=!1,r=null,o=null,a=null,l=null,c=null,u=-1,h=-1;for(const d of e.childElements())if("Property"===d.localName)switch(d.getAttribute("name")){case"ShowStringNumber":d.findChildElement("Enable")&&(t.showStringNumber=!0);break;case"String":t.string=te.parseIntSafe(d.findChildElement("String")?.innerText,0)+1;break;case"Fret":t.fret=te.parseIntSafe(d.findChildElement("Fret")?.innerText,0);break;case"Element":u=te.parseIntSafe(d.findChildElement("Element")?.innerText,0);break;case"Variation":h=te.parseIntSafe(d.findChildElement("Variation")?.innerText,0);break;case"Tapped":this._tappedNotes.set(n,!0);break;case"HarmonicType":const g=d.findChildElement("HType");if(g)switch(g.innerText){case"NoHarmonic":t.harmonicType=Ie.None;break;case"Natural":t.harmonicType=Ie.Natural;break;case"Artificial":t.harmonicType=Ie.Artificial;break;case"Pinch":t.harmonicType=Ie.Pinch;break;case"Tap":t.harmonicType=Ie.Tap;break;case"Semi":t.harmonicType=Ie.Semi;break;case"Feedback":t.harmonicType=Ie.Feedback}break;case"HarmonicFret":const m=d.findChildElement("HFret");m&&(t.harmonicValue=te.parseFloatSafe(m.innerText,0));break;case"Muted":d.findChildElement("Enable")&&(t.isDead=!0);break;case"PalmMuted":d.findChildElement("Enable")&&(t.isPalmMute=!0);break;case"Octave":t.octave=te.parseIntSafe(d.findChildElement("Number")?.innerText,0),-1===t.tone&&(t.tone=0);break;case"Tone":t.tone=te.parseIntSafe(d.findChildElement("Step")?.innerText,0);break;case"ConcertPitch":this.parseConcertPitch(d,t);break;case"Bended":i=!0;break;case"BendOriginValue":r||(r=new se(0,0)),r.value=this.toBendValue(te.parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"BendOriginOffset":r||(r=new se(0,0)),r.offset=this.toBendOffset(te.parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"BendMiddleValue":o=this.toBendValue(te.parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"BendMiddleOffset1":a=this.toBendOffset(te.parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"BendMiddleOffset2":l=this.toBendOffset(te.parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"BendDestinationValue":c||(c=new se(se.MaxPosition,0)),c.value=this.toBendValue(te.parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"BendDestinationOffset":c||(c=new se(0,0)),c.offset=this.toBendOffset(te.parseFloatSafe(d.findChildElement("Float")?.innerText,0));break;case"HopoOrigin":d.findChildElement("Enable")&&(t.isHammerPullOrigin=!0);break;case"HopoDestination":break;case"LeftHandTapped":t.isLeftHandTapped=!0;break;case"Slide":const _=te.parseIntSafe(d.findChildElement("Flags")?.innerText,0);1&_?t.slideOutType=Qe.Shift:2&_?t.slideOutType=Qe.Legato:4&_?t.slideOutType=Qe.OutDown:!!(8&_)&&(t.slideOutType=Qe.OutUp),16&_?t.slideInType=ri.IntoFromBelow:!!(32&_)&&(t.slideInType=ri.IntoFromAbove),64&_?t.slideOutType=Qe.PickSlideDown:128&_&&(t.slideOutType=Qe.PickSlideUp)}i&&(r||(r=new se(0,0)),c||(c=new se(se.MaxPosition,0)),t.addBendPoint(r),a&&o&&t.addBendPoint(new se(a,o)),l&&o&&t.addBendPoint(new se(l,o)),!a&&!l&&o&&t.addBendPoint(new se(se.MaxPosition/2|0,o)),t.addBendPoint(c)),-1!==u&&-1!==h&&(t.percussionArticulation=Gs.articulationFromElementVariation(u,h))}parseConcertPitch(e,t){const n=e.findChildElement("Pitch");if(n)for(const i of n.childElements())if("Accidental"===i.localName)switch(i.innerText){case"x":t.accidentalMode=mt.ForceDoubleSharp;break;case"#":t.accidentalMode=mt.ForceSharp;break;case"b":t.accidentalMode=mt.ForceFlat;break;case"bb":t.accidentalMode=mt.ForceDoubleFlat}}toBendValue(e){return e*te.BendPointValueFactor|0}toBendOffset(e){return e*te.BendPointPositionFactor}parseRhythms(e){for(const t of e.childElements())"Rhythm"===t.localName&&this.parseRhythm(t)}parseRhythm(e){const t=new Qte,n=e.getAttribute("id");t.id=n;for(const i of e.childElements())switch(i.localName){case"NoteValue":switch(i.innerText){case"Long":t.value=w.QuadrupleWhole;break;case"DoubleWhole":t.value=w.DoubleWhole;break;case"Whole":t.value=w.Whole;break;case"Half":t.value=w.Half;break;case"Quarter":t.value=w.Quarter;break;case"Eighth":t.value=w.Eighth;break;case"16th":t.value=w.Sixteenth;break;case"32nd":t.value=w.ThirtySecond;break;case"64th":t.value=w.SixtyFourth;break;case"128th":t.value=w.OneHundredTwentyEighth;break;case"256th":t.value=w.TwoHundredFiftySixth}break;case"PrimaryTuplet":t.tupletNumerator=te.parseIntSafe(i.getAttribute("num"),-1),t.tupletDenominator=te.parseIntSafe(i.getAttribute("den"),-1);break;case"AugmentationDot":t.dots=te.parseIntSafe(i.getAttribute("count"),0)}this._rhythmById.set(n,t)}buildModel(){for(let n=0,i=this._masterBars.length;n<i;n++)this.score.addMasterBar(this._masterBars[n]);const e=this._masterBars[this._masterBars.length-1];this._doubleBars.has(e)&&(this._doubleBars.delete(e),e.isDoubleBar=!1);for(const n of this._tracksMapping){if(!n)continue;const i=this._tracksById.get(n);this.score.addTrack(i)}let t;for(const n of this._barsOfMasterBar){let i=0;t=[wt.C,dr.Major];for(let r=0,o=0;r<n.length&&o<this.score.tracks.length;r++){const a=n[r];if(a!==te.InvalidId){const l=this._barsById.get(a),c=this.score.tracks[o],u=c.staves[i];u.addBar(l);const h=u.bars.length-1;if(this._keySignatures.has(h)&&(t=this._keySignatures.get(h)),l.keySignature=t[0],l.keySignatureType=t[1],this._doubleBars.has(l.masterBar)&&(l.barLineRight=We.LightLight),this._voicesOfBar.has(a))for(const d of this._voicesOfBar.get(a))if(d!==te.InvalidId){const p=this._voiceById.get(d);if(l.addVoice(p),this._beatsOfVoice.has(d))for(const g of this._beatsOfVoice.get(d))if(g!==te.InvalidId){const m=_D.clone(this._beatById.get(g));p.addBeat(m);const _=this._rhythmOfBeat.get(g),y=this._rhythmById.get(_);if(m.duration=y.value,m.dots=y.dots,m.tupletNumerator=y.tupletNumerator,m.tupletDenominator=y.tupletDenominator,this._notesOfBeat.has(g))for(const b of this._notesOfBeat.get(g))if(b!==te.InvalidId){const S=v2.clone(this._noteById.get(b));u.isPercussion?(S.fret=-1,S.string=-1):S.percussionArticulation=-1,m.addNote(S),this._tappedNotes.has(b)&&(m.tap=!0)}}}else{const p=new ko;l.addVoice(p);const g=new Ei;g.isEmpty=!0,g.duration=w.Quarter,p.addBeat(g)}i===c.staves.length-1?(o++,i=0,t=[wt.C,dr.Major]):(i++,t=[wt.C,dr.Major])}else o++}}for(const n of this._tracksMapping){if(!n)continue;const i=this._tracksById.get(n);let r=!1;for(const o of i.staves)if(o.isPercussion){r=!0;break}if(r||(i.percussionArticulations=[]),this._automationsPerTrackIdAndBarIndex.has(n)){const o=this._automationsPerTrackIdAndBarIndex.get(n);for(const[a,l]of o)if(i.staves.length>0&&a<i.staves[0].bars.length){const c=i.staves[0].bars[a];if(c.voices.length>0&&c.voices[0].beats.length>0){const u=c.voices[0].beats[0];for(const h of l)u.automations.push(h)}}}if(this._sustainPedalsPerTrackIdAndBarIndex.has(n)){const o=this._sustainPedalsPerTrackIdAndBarIndex.get(n);for(const[a,l]of o)i.staves.length>0&&a<i.staves[0].bars.length&&(i.staves[0].bars[a].sustainPedals=l)}}for(const[n,i]of this._masterTrackAutomations){const r=this.score.masterBars[n];for(let o=0,a=i.length;o<a;o++){const l=i[o];switch(l.type){case $n.Tempo:0===n&&(this.score.tempo=0|l.value,l.text&&(this.score.tempoLabel=l.text)),r.tempoAutomations.push(l);break;case $n.SyncPoint:l.syncPointValue.millisecondOffset-=this._backingTrackPadding,r.addSyncPoint(l)}}}}}te.InvalidId="-1",te.BendPointPositionFactor=se.MaxPosition/100,te.BendPointValueFactor=.04,te.SampleRate=44100;class vD{constructor(){this.isMultiRest=!1,this.trackViewGroups=[]}}class C2{constructor(){this.showNumbered=!1,this.showSlash=!1,this.showStandardNotation=!1,this.showTablature=!1}}class TD{apply(e){if(this.scoreViews.length>0){let t=0;e.stylesheet.multiTrackMultiBarRest=this.scoreViews[0].isMultiRest;for(const n of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const i=e.tracks[t];for(const r of i.staves)r.showTablature=n.showTablature,r.showStandardNotation=n.showStandardNotation,r.showSlash=n.showSlash,r.showNumbered=n.showNumbered}t++}for(let n=1;n<this.scoreViews.length;n++)this.scoreViews[n].isMultiRest&&(e.stylesheet.perTrackMultiBarRest||(e.stylesheet.perTrackMultiBarRest=new Set),t=n-1,e.stylesheet.perTrackMultiBarRest.add(t))}}constructor(e){this.scoreViews=[];const t=ps.fromBuffer(e),n=N.readInt32BE(t);for(let i=0;i<n;i++){const r=new vD;this.scoreViews.push(r),r.isMultiRest=Ut.gpReadBool(t);const o=N.readInt32BE(t);for(let a=0;a<o;a++){let l=t.readByte();0===l&&(l=1);const c=new C2;c.showStandardNotation=!!(1&l),c.showTablature=!!(2&l),c.showSlash=!!(4&l),c.showNumbered=!!(8&l),r.trackViewGroups.push(c)}}}static writeForScore(e){const t=ps.withCapacity(128),n=[new vD];n[0].isMultiRest=e.stylesheet.multiTrackMultiBarRest;for(const i of e.tracks){const r=new C2;r.showStandardNotation=i.staves[0].showStandardNotation,r.showTablature=i.staves[0].showTablature,r.showSlash=i.staves[0].showSlash,r.showNumbered=i.staves[0].showNumbered,n[0].trackViewGroups.push(r);const o=new vD;o.isMultiRest=!0===e.stylesheet.perTrackMultiBarRest?.has(i.index),o.trackViewGroups.push(r),n.push(o)}N.writeInt32BE(t,n.length);for(const i of n){t.writeByte(i.isMultiRest?1:0),N.writeInt32BE(t,i.trackViewGroups.length);for(const r of i.trackViewGroups){let o=0;r.showStandardNotation&&(o|=1),r.showTablature&&(o|=2),r.showSlash&&(o|=4),r.showNumbered&&(o|=8),t.writeByte(o)}}return N.writeInt32BE(t,1),t.toArray()}}let kD=class{};class sw extends kD{constructor(e){super(),this.n=e}}class Rh extends kD{constructor(e,t){super(),this.left=e,this.right=t}}class CD extends kD{constructor(e,t){super(),this.n=e,this.table=t}}class zi{static make(e,t,n,i){const r=[],o=[];if(i>32)throw new oi("Invalid huffman");for(let c=0;c<i;c++)r.push(0),o.push(0);for(let c=0;c<n;c++){const u=e[c+t];if(u>=i)throw new oi("Invalid huffman");r[u]++}let a=0;for(let c=1;c<i-1;c++)a=a+r[c]<<1,o[c]=a;const l=new Map;for(let c=0;c<n;c++){const u=e[c+t];if(0!==u){const h=o[u-1];o[u-1]=h+1,l.set(h<<5|u,c)}}return zi.treeCompress(new Rh(zi.treeMake(l,i,0,1),zi.treeMake(l,i,1,1)))}static treeMake(e,t,n,i){if(i>t)throw new oi("Invalid huffman");const r=n<<5|i;return e.has(r)?new sw(e.get(r)):new Rh(zi.treeMake(e,t,n<<=1,i+=1),zi.treeMake(e,t,1|n,i))}static treeCompress(e){const t=zi.treeDepth(e);if(0===t)return e;if(1===t){if(e instanceof Rh)return new Rh(zi.treeCompress(e.left),zi.treeCompress(e.right));throw new oi("assert")}const n=1<<t,i=[];for(let r=0;r<n;r++)i.push(new sw(-1));return zi.treeWalk(i,0,0,t,e),new CD(t,i)}static treeWalk(e,t,n,i,r){r instanceof Rh&&i>0?(zi.treeWalk(e,t,n+1,i-1,r.left),zi.treeWalk(e,t|1<<n,n+1,i-1,r.right)):e[t]=zi.treeCompress(r)}static treeDepth(e){if(e instanceof sw)return 0;if(e instanceof CD)throw new oi("assert");if(e instanceof Rh){const t=zi.treeDepth(e.left),n=zi.treeDepth(e.right);return 1+(t<n?t:n)}return 0}}var ai=function(s){return s[s.Head=0]="Head",s[s.Block=1]="Block",s[s.CData=2]="CData",s[s.Flat=3]="Flat",s[s.Crc=4]="Crc",s[s.Dist=5]="Dist",s[s.DistOne=6]="DistOne",s[s.Done=7]="Done",s}(ai||{});let ene=(()=>{class s{constructor(){this.buffer=new Uint8Array(s.BufferSize),this.pos=0}slide(){const t=new Uint8Array(s.BufferSize);this.pos-=s.Size,t.set(this.buffer.subarray(s.Size,s.Size+this.pos),0),this.buffer=t}addBytes(t,n,i){this.pos+i>s.BufferSize&&this.slide(),this.buffer.set(t.subarray(n,n+i),this.pos),this.pos+=i}addByte(t){this.pos===s.BufferSize&&this.slide(),this.buffer[this.pos]=t,this.pos++}getLastChar(){return this.buffer[this.pos-1]}available(){return this.pos}}return s.Size=32768,s.BufferSize=65536,s})();class Sr{static buildFixedHuffman(){const e=[];for(let t=0;t<288;t++)e.push(t<=143?8:t<=255?9:t<=279?7:8);return zi.make(e,0,288,10)}constructor(e){this._nbits=0,this._bits=0,this._state=ai.Block,this._isFinal=!1,this._huffman=Sr._fixedHuffman,this._huffdist=null,this._len=0,this._dist=0,this._needed=0,this._output=null,this._outpos=0,this._lengths=[],this._window=new ene,this._input=e;for(let t=0;t<19;t++)this._lengths.push(-1)}readBytes(e,t,n){if(this._needed=n,this._outpos=t,this._output=e,n>0)for(;this.inflateLoop(););return n-this._needed}inflateLoop(){switch(this._state){case ai.Head:const e=this._input.readByte();if(8!=(15&e))throw new oi("Invalid data");const n=this._input.readByte(),i=!!(32&n);if(((e<<8)+n)%31!=0)throw new oi("Invalid data");if(i)throw new oi("Unsupported dictionary");return this._state=ai.Block,!0;case ai.Crc:return this._state=ai.Done,!0;case ai.Done:return!1;case ai.Block:switch(this._isFinal=this.getBit(),this.getBits(2)){case 0:if(this._len=N.readUInt16LE(this._input),N.readUInt16LE(this._input)!==65535-this._len)throw new oi("Invalid data");this._state=ai.Flat;const u=this.inflateLoop();return this.resetBits(),u;case 1:return this._huffman=Sr._fixedHuffman,this._huffdist=null,this._state=ai.CData,!0;case 2:const h=this.getBits(5)+257,d=this.getBits(5)+1,p=this.getBits(4)+4;for(let m=0;m<p;m++)this._lengths[Sr.CodeLengthsPos[m]]=this.getBits(3);for(let m=p;m<19;m++)this._lengths[Sr.CodeLengthsPos[m]]=0;this._huffman=zi.make(this._lengths,0,19,8);const g=[];for(let m=0;m<h+d;m++)g.push(0);return this.inflateLengths(g,h+d),this._huffdist=zi.make(g,h,d,16),this._huffman=zi.make(g,0,h,16),this._state=ai.CData,!0;default:throw new oi("Invalid data")}case ai.Flat:{const c=this._len<this._needed?this._len:this._needed,u=N.readByteArray(this._input,c);return this._len-=c,this.addBytes(u,0,c),0===this._len&&(this._state=this._isFinal?ai.Crc:ai.Block),this._needed>0}case ai.DistOne:{const c=this._len<this._needed?this._len:this._needed;return this.addDistOne(c),this._len-=c,0===this._len&&(this._state=ai.CData),this._needed>0}case ai.Dist:for(;this._len>0&&this._needed>0;){const c=this._len<this._dist?this._len:this._dist,u=this._needed<c?this._needed:c;this.addDist(this._dist,u),this._len-=u}return 0===this._len&&(this._state=ai.CData),this._needed>0;case ai.CData:let r=this.applyHuffman(this._huffman);if(r<256)return this.addByte(r),this._needed>0;if(256===r)return this._state=this._isFinal?ai.Crc:ai.Block,!0;r=r-257&255;let o=Sr.LenExtraBitsTbl[r];if(-1===o)throw new oi("Invalid data");this._len=Sr.LenBaseValTbl[r]+this.getBits(o);const a=this._huffdist,l=a?this.applyHuffman(a):this.getRevBits(5);if(o=Sr.DistExtraBitsTbl[l],-1===o)throw new oi("Invalid data");if(this._dist=Sr.DistBaseValTbl[l]+this.getBits(o),this._dist>this._window.available())throw new oi("Invalid data");return this._state=1===this._dist?ai.DistOne:ai.Dist,!0}return!1}addDistOne(e){const t=this._window.getLastChar();for(let n=0;n<e;n++)this.addByte(t)}addByte(e){this._window.addByte(e),this._output[this._outpos]=e,this._needed--,this._outpos++}addDist(e,t){this.addBytes(this._window.buffer,this._window.pos-e,t)}getBit(){0===this._nbits&&(this._nbits=8,this._bits=this._input.readByte());const e=!(1&~this._bits);return this._nbits--,this._bits=this._bits>>1,e}getBits(e){for(;this._nbits<e;)this._bits=this._bits|this._input.readByte()<<this._nbits,this._nbits+=8;const t=this._bits&(1<<e)-1;return this._nbits-=e,this._bits=this._bits>>e,t}getRevBits(e){return 0===e?0:this.getBit()?1<<e-1|this.getRevBits(e-1):this.getRevBits(e-1)}resetBits(){this._bits=0,this._nbits=0}addBytes(e,t,n){this._window.addBytes(e,t,n),this._output.set(e.subarray(t,t+n),this._outpos),this._needed-=n,this._outpos+=n}inflateLengths(e,t){let n=0,i=0;for(;n<t;){const r=this.applyHuffman(this._huffman);switch(r){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:i=r,e[n]=r,n++;break;case 16:const o=n+3+this.getBits(2);if(o>t)throw new oi("Invalid data");for(;n<o;)e[n]=i,n++;break;case 17:if(n+=3+this.getBits(3),n>t)throw new oi("Invalid data");break;case 18:if(n+=11+this.getBits(7),n>t)throw new oi("Invalid data");break;default:throw new oi("Invalid data")}}}applyHuffman(e){if(e instanceof sw)return e.n;if(e instanceof Rh)return this.applyHuffman(this.getBit()?e.right:e.left);if(e instanceof CD)return this.applyHuffman(e.table[this.getBits(e.n)]);throw new oi("Invalid data")}}Sr.LenExtraBitsTbl=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1],Sr.LenBaseValTbl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Sr.DistExtraBitsTbl=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1],Sr.DistBaseValTbl=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Sr.CodeLengthsPos=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Sr._fixedHuffman=Sr.buildFixedHuffman();let Fr=(()=>{class s{constructor(t,n){this.fullName=t;const i=t.lastIndexOf("/");this.fileName=-1===i||i===t.length-1?this.fullName:t.substr(i+1),this.data=n}}return s.OptionalDataDescriptorSignature=134695760,s.CompressionMethodDeflate=8,s.LocalFileHeaderSignature=67324752,s.CentralFileHeaderSignature=33639248,s.EndOfCentralDirSignature=101010256,s})();class DD{constructor(e){this._readable=e}read(){const e=[];for(;;){const t=this.readEntry();if(!t)break;e.push(t)}return e}readEntry(){const e=this._readable;if(N.readInt32LE(e)!==Fr.LocalFileHeaderSignature)return null;N.readUInt16LE(e);const n=N.readUInt16LE(e),i=N.readUInt16LE(e),r=0!==i;if(r&&i!==Fr.CompressionMethodDeflate)return null;N.readInt16LE(this._readable),N.readInt16LE(this._readable),N.readInt32LE(e),N.readInt32LE(e);const o=N.readInt32LE(e),a=N.readInt16LE(e),l=N.readInt16LE(e),c=N.toString(N.readByteArray(e,a),"utf-8");let u;if(e.skip(l),r){const h=ps.empty(),d=new Sr(this._readable),p=new Uint8Array(65536);for(;;){const g=d.readBytes(p,0,p.length);if(h.write(p,0,g),g<p.length)break}u=h.toArray()}else u=N.readByteArray(this._readable,o);return!!(8&n)&&(N.readInt32LE(this._readable)===Fr.OptionalDataDescriptorSignature&&N.readInt32LE(this._readable),N.readInt32LE(this._readable),N.readInt32LE(this._readable)),new Fr(c,u)}}class tne{constructor(){this.trackViewGroups=[]}}class nne{constructor(){this.isVisible=!1}}var D2=function(s){return s[s.PageVertical=0]="PageVertical",s[s.PageGrid=1]="PageGrid",s[s.PageParchment=2]="PageParchment",s[s.ScreenVertical=3]="ScreenVertical",s[s.ScreenHorizontal=4]="ScreenHorizontal",s[s.PageHorizontal=5]="PageHorizontal",s}(D2||{});class xD{constructor(e,t){this.zoomLevel=4,this.view=D2.PageVertical,this.muiltiVoiceCursor=!1,this.scoreViews=[];const n=ps.fromBuffer(t);this.zoomLevel=N.readInt32BE(n),this.view=n.readByte(),this.muiltiVoiceCursor=0!==n.readByte();const i=e.scoreViews.length;for(let r=0;r<i;r++){const o=new tne;this.scoreViews.push(o);const a=e.scoreViews[r];for(let l=0;l<a.trackViewGroups.length;l++){const c=new nne;c.isVisible=0!==n.readByte(),o.trackViewGroups.push(c)}}}apply(e){if(this.scoreViews.length>0){let t=0;for(const n of this.scoreViews[0].trackViewGroups)t<e.tracks.length&&(e.tracks[t].isVisibleOnMultiTrack=n.isVisible),t++}}static writeForScore(e){const t=ps.withCapacity(128);N.writeInt32BE(t,4),t.writeByte(0),t.writeByte(e.tracks.length>0&&e.tracks[0].staves[0].bars[0].isMultiVoice?255:0);for(const i of e.tracks)t.writeByte(i.isVisibleOnMultiTrack?255:0);for(const i of e.tracks)t.writeByte(255);return t.toArray()}}class sne extends Mh{get name(){return"Guitar Pro 7-8"}readScore(){F.debug(this.name,"Loading ZIP entries");const e=new DD(this.data);let t;try{t=e.read()}catch(h){throw new Ts("No Zip archive",h)}F.debug(this.name,"Zip entries loaded");let n=null,i=null,r=null,o=null;const a=new Map;for(const h of t)switch(a.set(h.fullName,h),h.fileName){case"score.gpif":n=N.toString(h.data,this.settings.importer.encoding);break;case"BinaryStylesheet":i=h.data;break;case"PartConfiguration":r=h.data;break;case"LayoutConfiguration":o=h.data}if(!n)throw new Ts("No score.gpif found in zip archive");F.debug(this.name,"Start Parsing score.gpif");const l=new te;l.loadAsset=h=>{if(a.has(h))return a.get(h).data},l.parseXml(n,this.settings),F.debug(this.name,"score.gpif parsed");const c=l.score;i&&(F.debug(this.name,"Start Parsing BinaryStylesheet"),new no(i).apply(c),F.debug(this.name,"BinaryStylesheet parsed"));let u=null;return r&&(F.debug(this.name,"Start Parsing Part Configuration"),u=new TD(r),u.apply(c),F.debug(this.name,"Part Configuration parsed")),o&&null!=u&&(F.debug(this.name,"Start Parsing Layout Configuration"),new xD(u,o).apply(c),F.debug(this.name,"Layout Configuration parsed")),c}}class $g extends rn{constructor(){super(un.Format,"Unexpected end of data within reader"),Object.setPrototypeOf(this,$g.prototype)}}let ine=(()=>{class s{constructor(t){this._currentByte=0,this._position=s.ByteSize,this._source=t}readByte(){return this.readBits(8)}readBytes(t){const n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=255&this.readByte();return n}readBits(t){let n=0,i=t-1;for(;i>=0;)n|=this.readBit()<<i,i--;return n}readBitsReversed(t){let n=0;for(let i=0;i<t;i++)n|=this.readBit()<<i;return n}readBit(){if(this._position>=8){if(this._currentByte=this._source.readByte(),-1===this._currentByte)throw new $g;this._position=0}const t=this._currentByte>>s.ByteSize-this._position-1&1;return this._position++,t}readAll(){const t=ps.empty();try{for(;;)t.writeByte(255&this.readByte())}catch(n){if(!(n instanceof $g))throw n}return t.toArray()}}return s.ByteSize=8,s})();class rne{constructor(){this.fileName="",this.fileSize=0,this.data=null}}let one=(()=>{class s{constructor(){this.files=[],this.files=[],this.fileFilter=t=>!0}load(t){const n=new ine(t);this.readBlock(n)}readHeader(t){return this.getString(t.readBytes(4),0,4)}decompress(t,n=!1){const i=ps.empty();let r;const o=this.getInteger(t.readBytes(4),0);try{for(;i.length<o;)if(1===t.readBits(1)){const d=t.readBits(4),p=t.readBitsReversed(d),g=t.readBitsReversed(d),m=i.length-p,_=Math.min(p,g);r=i.getBuffer(),i.write(r,m,_)}else{const d=t.readBitsReversed(2);for(let p=0;p<d;p++)i.writeByte(t.readByte())}}catch(h){if(!(h instanceof $g))throw h}r=i.getBuffer();const a=n?4:0,l=i.length-a,c=new Uint8Array(l);return c.set(r.subarray(a,a+l),0),c}readBlock(t){const n=this.readHeader(t);if("BCFZ"===n)this.readUncompressedBlock(this.decompress(t,!0));else{if("BCFS"!==n)throw new Ts("Unsupported format");this.readUncompressedBlock(t.readAll())}}readUncompressedBlock(t){let i=4096;for(;i+3<t.length;){if(2===this.getInteger(t,i)){const o=new rne;o.fileName=this.getString(t,i+4,127),o.fileSize=this.getInteger(t,i+140);const a=!this.fileFilter||this.fileFilter(o.fileName);a&&this.files.push(o);const l=i+148;let c=0,u=0;const h=a?ps.withCapacity(o.fileSize):null;for(;c=this.getInteger(t,l+4*u++),0!==c;)i=4096*c,a&&h.write(t,i,4096);if(a){o.data=new Uint8Array(Math.min(o.fileSize,h.length));const d=h.toArray();o.data.set(d.subarray(0,0+o.data.length),0)}}i+=4096}}getString(t,n,i){let r="";for(let o=0;o<i;o++){const a=255&t[n+o];if(0===a)break;r+=String.fromCharCode(a)}return r}getInteger(t,n){return t[n+3]<<24|t[n+2]<<16|t[n+1]<<8|t[n]}}return s.HeaderBcFs="BCFS",s.HeaderBcFz="BCFZ",s})();class ane extends Mh{get name(){return"Guitar Pro 6"}readScore(){F.debug(this.name,"Loading GPX filesystem");const e=new one;e.fileFilter=c=>c.endsWith("score.gpif")||c.endsWith("BinaryStylesheet")||c.endsWith("PartConfiguration")||c.endsWith("LayoutConfiguration"),e.load(this.data),F.debug(this.name,"GPX filesystem loaded");let t=null,n=null,i=null,r=null;for(const c of e.files)switch(c.fileName){case"score.gpif":t=N.toString(c.data,this.settings.importer.encoding);break;case"BinaryStylesheet":n=c.data;break;case"PartConfiguration":i=c.data;break;case"LayoutConfiguration":r=c.data}if(!t)throw new Ts("No score.gpif found in GPX");F.debug(this.name,"Start Parsing score.gpif");const o=new te;o.parseXml(t,this.settings),F.debug(this.name,"score.gpif parsed");const a=o.score;n&&(F.debug(this.name,"Start Parsing BinaryStylesheet"),new no(n).apply(a),F.debug(this.name,"BinaryStylesheet parsed"));let l=null;return i&&(F.debug(this.name,"Start Parsing Part Configuration"),l=new TD(i),l.apply(a),F.debug(this.name,"Part Configuration parsed")),r&&null!=l&&(F.debug(this.name,"Start Parsing Layout Configuration"),new xD(l,r).apply(a),F.debug(this.name,"Layout Configuration parsed")),a}}var Be=function(s){return s[s.None=0]="None",s[s.Natural=1]="Natural",s[s.Sharp=2]="Sharp",s[s.Flat=3]="Flat",s[s.NaturalQuarterNoteUp=4]="NaturalQuarterNoteUp",s[s.SharpQuarterNoteUp=5]="SharpQuarterNoteUp",s[s.FlatQuarterNoteUp=6]="FlatQuarterNoteUp",s[s.DoubleSharp=7]="DoubleSharp",s[s.DoubleFlat=8]="DoubleFlat",s}(Be||{});class lne{constructor(){this.maxLine=-1e3,this.minLine=-1e3}}let Ga=(()=>{class s{constructor(t){this._registeredAccidentals=new Map,this._appliedScoreLines=new Map,this._appliedScoreLinesByValue=new Map,this._notesByValue=new Map,this._beatLines=new Map,this.maxLineBeat=null,this.minLineBeat=null,this.maxLine=-1e3,this.minLine=-1e3,this._barRenderer=t,this._bar=t.bar}static getPercussionLine(t,n){return n<t.staff.track.percussionArticulations.length?t.staff.track.percussionArticulations[n].staffLine:Gs.getArticulationByInputMidiNumber(n)?.staffLine??0}static getNoteValue(t){if(t.isPercussion)return t.percussionArticulation;let n=t.displayValue;switch(t.accidentalMode){case mt.ForceDoubleFlat:n+=2;break;case mt.ForceDoubleSharp:n-=2;break;case mt.ForceFlat:n+=1;break;case mt.ForceSharp:n-=1}return n}applyAccidental(t){const n=s.getNoteValue(t);return this.getAccidental(n,t.hasQuarterToneOffset,t.beat,!1,t)}applyAccidentalForValue(t,n,i,r){return this.getAccidental(n,i,t,r,null)}static computeLineWithoutAccidentals(t,n){let i=0;const r=s.getNoteValue(n);return i=n.isPercussion?s.getPercussionLine(t,r):s.calculateNoteSteps(t.keySignature,t.clef,r),i}static computeAccidental(t,n,i,r,o=null){const l=t+7,c=i%12,u=l<7?Be.Flat:Be.Sharp,h=s.KeySignatureLookup[l][c],d=s.AccidentalNotes[c];let p=Be.None;if(r)switch(p=d?u:Be.Natural,p){case Be.Natural:p=Be.NaturalQuarterNoteUp;break;case Be.Sharp:p=Be.SharpQuarterNoteUp;break;case Be.Flat:p=Be.FlatQuarterNoteUp}else{switch(n){case mt.ForceSharp:p=Be.Sharp;break;case mt.ForceDoubleSharp:p=Be.DoubleSharp;break;case mt.ForceFlat:p=Be.Flat;break;case mt.ForceDoubleFlat:p=Be.DoubleFlat;break;default:d?p=u:h&&(p=Be.Natural)}p!==Be.None?null!=o?o===p&&(p=Be.None):h&&p===u&&(p=Be.None):null!==o&&(p=o===Be.Natural?Be.None:Be.Natural)}return p}getAccidental(t,n,i,r,o=null){let a=0,l=Be.None;if(null!=o?o.isPercussion:this._bar.staff.isPercussion)a=s.getPercussionLine(this._bar,t);else{const u=o?o.accidentalMode:mt.Default;a=s.calculateNoteSteps(this._bar.keySignature,this._bar.clef,t);const h=this._registeredAccidentals.has(a)?this._registeredAccidentals.get(a):null;l=s.computeAccidental(this._bar.keySignature,u,t,n,h);let d=!1;switch(l){case Be.NaturalQuarterNoteUp:case Be.SharpQuarterNoteUp:case Be.FlatQuarterNoteUp:break;default:if(o&&o.isTieDestination&&0===o.beat.index){const p=this._barRenderer.scoreRenderer.layout?.getRendererForBar(this._barRenderer.staff.staffId,o.tieOrigin.beat.voice.bar);p&&p.staff===this._barRenderer.staff&&p.accidentalHelper.getNoteLine(o.tieOrigin)===a&&(d=!0)}d?l=Be.None:l!==Be.None&&this._registeredAccidentals.set(a,l)}}return o?(this._appliedScoreLines.set(o.id,a),this._notesByValue.set(t,o)):this._appliedScoreLinesByValue.set(t,a),(-1e3===this.minLine||this.minLine<a)&&(this.minLine=a,this.minLineBeat=i),(-1e3===this.maxLine||this.maxLine>a)&&(this.maxLine=a,this.maxLineBeat=i),r||this.registerLine(i,a),l}registerLine(t,n){let i;this._beatLines.has(t.id)?i=this._beatLines.get(t.id):(i=new lne,this._beatLines.set(t.id,i)),(-1e3===i.minLine||n<i.minLine)&&(i.minLine=n),(-1e3===i.minLine||n>i.maxLine)&&(i.maxLine=n)}getMaxLine(t){return this._beatLines.has(t.id)?this._beatLines.get(t.id).maxLine:0}getMinLine(t){return this._beatLines.has(t.id)?this._beatLines.get(t.id).minLine:0}static calculateNoteSteps(t,n,i){const o=t,l=i%12;let u=s.OctaveSteps[n];return u-=((i/12|0)-1)*s.StepsPerOctave,u-=(ie.keySignatureIsSharp(o)||ie.keySignatureIsNatural(o)?s.SharpNoteSteps:s.FlatNoteSteps)[l],u}getNoteLine(t){return this._appliedScoreLines.get(t.id)}getNoteLineForValue(t,n=!1){return this._appliedScoreLinesByValue.has(t)?this._appliedScoreLinesByValue.get(t):n&&this._notesByValue.has(t)?this.getNoteLine(this._notesByValue.get(t)):0}}return s.KeySignatureLookup=[[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]],s.AccidentalNotes=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1],s.StepsPerOctave=7,s.OctaveSteps=[38,32,30,26,38],s.SharpNoteSteps=[0,0,1,1,2,3,3,4,4,5,5,6],s.FlatNoteSteps=[0,1,1,2,2,3,4,4,5,5,6,6],s})();class cne{constructor(){this.currentDynamics=Te.F,this.slideOrigins=new Map,this.transpose=0,this.isExplicitlyBeamed=!1,this.tieStarts=new Set,this.tieStartIds=new Map,this.slideOrigins=new Map,this.slurStarts=new Map}}class une extends he{constructor(){super(...arguments),this.outputMidiChannel=-1,this.outputMidiProgram=-1,this.outputVolume=-1,this.outputBalance=-1}}class iw{constructor(e){this.instruments=new Map,this._instrumentIdToArticulationIndex=new Map,this._lyricsLine=0,this._lyricsLines=new Map,this.track=e}getLyricLine(e){if(this._lyricsLines.has(e))return this._lyricsLines.get(e);const t=this._lyricsLine;return this._lyricsLines.set(e,t),this._lyricsLine++,t}getOrCreateArticulation(e,t){const n=12*t.octave+t.tone,i=`${e}_${n}`;if(this._instrumentIdToArticulationIndex.has(i))return this._instrumentIdToArticulationIndex.get(i);let r;r=this.instruments.has(e)?this.instruments.get(e):iw.defaultNoteArticulation;const o=this.track.percussionArticulations.length,a=t.beat.voice.bar;let l;l=0===n?4:Ga.calculateNoteSteps(a.keySignature,a.clef,n);const p=new he(r.elementType,l-(9-(2*t.beat.voice.bar.staff.standardNotationLineCount-1)),r.outputMidiNumber,r.noteHeadDefault,r.noteHeadHalf,r.noteHeadWhole,r.techniqueSymbol,r.techniqueSymbolPlacement);return this._instrumentIdToArticulationIndex.set(i,o),this.track.percussionArticulations.push(p),o}}iw.defaultNoteArticulation=new he("Default",0,0,f.NoteheadBlack,f.NoteheadHalf,f.NoteheadWhole);class bn extends Mh{constructor(){super(...arguments),this._idToTrackInfo=new Map,this._indexToTrackInfo=new Map,this._staffToContext=new Map,this._divisionsPerQuarterNote=1,this._currentDynamics=Te.F,this._musicalPosition=0,this._lastBeat=null,this._nextMasterBarRepeatEnding=0,this._nextBeatAutomations=null,this._nextBeatChord=null,this._nextBeatCrescendo=null,this._nextBeatLetRing=!1,this._nextBeatPalmMute=!1,this._nextBeatOttavia=null,this._nextBeatText=null,this._simileMarkAllStaves=null,this._simileMarkPerStaff=null,this._isBeatSlash=!1,this._keyAllStaves=null,this._currentTrillStep=-1}get name(){return"MusicXML"}readScore(){const e=this.extractMusicXml(),t=new qg;try{t.parse(e)}catch(n){throw new Ts("Unsupported format",n)}return this._score=new Cl,this._score.tempo=120,this._score.stylesheet.hideDynamics=!0,this.parseDom(t),ie.consolidate(this._score),this._score.finish(this.settings),this._score.rebuildRepeatGroups(),this._score}extractMusicXml(){const e=new DD(this.data);let t;try{t=e.read()}catch{t=[]}if(0===t.length)return this.data.reset(),N.toString(this.data.readAll(),this.settings.importer.encoding);const n=t.find(c=>"META-INF/container.xml"===c.fullName);if(!n)throw new Ts("No compressed MusicXML");const i=new qg;try{i.parse(N.toString(n.data,this.settings.importer.encoding))}catch(c){throw new Ts("Malformed container.xml, could not parse as XML",c)}const r=i.firstElement;if(!r||"container"!==r.localName)throw new Ts("Malformed container.xml, root element not 'container'");const o=r.findChildElement("rootfiles");if(!o)throw new Ts("Malformed container.xml, 'container/rootfiles' not found");let a="";for(const c of o.childElements())if("rootfile"===c.localName){a=c.getAttribute("full-path");break}if(!a)throw new Ts("Unsupported compressed MusicXML, missing rootfile");const l=t.find(c=>c.fullName===a);if(!l)throw new Ts(`Malformed container.xml, '${a}' not contained in zip`);return N.toString(l.data,this.settings.importer.encoding)}parseDom(e){const t=e.firstElement;if(!t)throw new Ts("Unsupported format");switch(t.localName){case"score-partwise":this.parsePartwise(t);break;case"score-timewise":this.parseTimewise(t);break;default:throw new Ts("Unsupported format")}}parsePartwise(e){for(const t of e.childElements())switch(t.localName){case"credit":this.parseCredit(t);break;case"identification":this.parseIdentification(t);break;case"movement-title":this.parseMovementTitle(t);break;case"part":this.parsePartwisePart(t);break;case"part-list":this.parsePartList(t);break;case"work":this.parseWork(t)}}parseTimewise(e){let t=0;for(const n of e.childElements())switch(n.localName){case"credit":this.parseCredit(n);break;case"identification":this.parseIdentification(n);break;case"movement-title":this.parseMovementTitle(n);break;case"part-list":this.parsePartList(n);break;case"work":this.parseWork(n);break;case"measure":this.parseTimewiseMeasure(n,t),t++}}parseCredit(e){if("1"!==e.getAttribute("page","1"))return;const t=[];let n=null,i="";for(const r of e.childElements())switch(r.localName){case"credit-type":t.push(r.innerText);break;case"credit-words":null===n&&(n=r),i+=r.innerText}if(t.length>0)for(const r of t)switch(r){case"title":this._score.title=bn.sanitizeDisplay(i);break;case"subtitle":this._score.subTitle=bn.sanitizeDisplay(i);break;case"composer":case"arranger":this._score.artist=bn.sanitizeDisplay(i);break;case"lyricist":this._score.words=bn.sanitizeDisplay(i);break;case"rights":this._score.copyright=bn.sanitizeDisplay(i)}else if(n){const r=n.getAttribute("font-size","0"),o=n.getAttribute("font-size","top"),a=n.getAttribute("halign","left");if("top"===o){if(i.includes("copyright")||i.includes("Copyright")||i.includes("\xa9")||i.includes("(c)")||i.includes("(C)"))return void(this._score.copyright=bn.sanitizeDisplay(i));if("center"===a||"center"===r){if(0===this._score.title.length)return void(this._score.title=bn.sanitizeDisplay(i));if(0===this._score.subTitle.length)return void(this._score.subTitle=bn.sanitizeDisplay(i));if(0===this._score.album.length)return void(this._score.album=bn.sanitizeDisplay(i))}else if(("right"===a||"right"===r)&&0===this._score.music.length)return void(this._score.music=bn.sanitizeDisplay(i));if(0===this._score.artist.length)return void(this._score.artist=bn.sanitizeDisplay(i));if(0===this._score.words.length)return void(this._score.words=bn.sanitizeDisplay(i))}}}static sanitizeDisplay(e){return e.replaceAll("\r","").replaceAll("\n"," ").replaceAll("\t","\xa0\xa0").replaceAll(" ","\xa0")}parseIdentification(e){for(const t of e.childElements())switch(t.localName){case"creator":if(t.attributes.has("type"))switch(t.attributes.get("type")){case"composer":this._score.artist=bn.sanitizeDisplay(t.innerText);break;case"lyricist":this._score.words=bn.sanitizeDisplay(t.innerText);break;case"arranger":this._score.music=bn.sanitizeDisplay(t.innerText)}else this._score.artist=bn.sanitizeDisplay(t.innerText);break;case"rights":this._score.copyright.length>0&&(this._score.copyright+=", "),this._score.copyright+=t.innerText,t.attributes.has("type")&&(this._score.copyright+=` (${t.attributes.get("type")})`);break;case"encoding":this.parseEncoding(t)}}parseEncoding(e){for(const t of e.childElements())switch(t.localName){case"encoder":this._score.tab.length>0&&(this._score.tab+=", "),this._score.tab+=t.innerText,t.attributes.has("type")&&(this._score.tab+=` (${t.attributes.get("type")})`);break;case"encoding-description":this._score.notices+=bn.sanitizeDisplay(t.innerText)}}parseMovementTitle(e){0===this._score.title.length?this._score.title=bn.sanitizeDisplay(e.innerText):this._score.subTitle=bn.sanitizeDisplay(e.innerText)}parsePartList(e){for(const t of e.childElements())"score-part"===t.localName&&this.parseScorePart(t)}parseScorePart(e){const t=new Ph;t.ensureStaveCount(1),this._score.addTrack(t);const n=e.attributes.get("id"),i=new iw(t);this._idToTrackInfo.set(n,i),this._indexToTrackInfo.set(t.index,i);for(const r of e.childElements())switch(r.localName){case"part-name":t.name=bn.sanitizeDisplay(r.innerText);break;case"part-name-display":t.name=this.parsePartDisplayAsText(r);break;case"part-abbreviation":t.shortName=bn.sanitizeDisplay(r.innerText);break;case"part-abbreviation-display":t.shortName=this.parsePartDisplayAsText(r);break;case"score-instrument":this.parseScoreInstrument(r,i);break;case"midi-device":r.attributes.has("port")&&(t.playbackInfo.port=Number.parseInt(r.attributes.get("port"),10));break;case"midi-instrument":this.parseScorePartMidiInstrument(r,i)}i.firstArticulation&&(i.firstArticulation.outputMidiProgram>=0&&(t.playbackInfo.program=i.firstArticulation.outputMidiProgram),i.firstArticulation.outputBalance>=0&&(t.playbackInfo.balance=i.firstArticulation.outputBalance),i.firstArticulation.outputVolume>=0&&(t.playbackInfo.volume=i.firstArticulation.outputVolume),i.firstArticulation.outputMidiChannel>=0&&(t.playbackInfo.primaryChannel=i.firstArticulation.outputMidiChannel,t.playbackInfo.secondaryChannel=i.firstArticulation.outputMidiChannel))}parseScoreInstrument(e,t){const n=new une;t.firstArticulation||(t.firstArticulation=n),t.instruments.set(e.getAttribute("id",""),n)}parseScorePartMidiInstrument(e,t){const n=e.getAttribute("id","");if(!t.instruments.has(n))return;const i=t.instruments.get(n);for(const r of e.childElements())switch(r.localName){case"midi-channel":i.outputMidiChannel=Number.parseInt(r.innerText)-1;break;case"midi-program":i.outputMidiProgram=Number.parseInt(r.innerText)-1;break;case"midi-unpitched":i.outputMidiNumber=Number.parseInt(r.innerText)-1;break;case"volume":i.outputVolume=bn.interpolatePercent(Number.parseFloat(r.innerText));break;case"pan":i.outputBalance=bn.interpolatePan(Number.parseFloat(r.innerText))}}static interpolatePercent(e){return 0|bn.interpolate(0,100,0,16,e)}static interpolatePan(e){return 0|bn.interpolate(-90,90,0,16,e)}static interpolate(e,t,n,i,r){return n+(r-e)/(t-e)*(i-n)}parsePartDisplayAsText(e){let t="";for(const n of e.childElements())switch(n.localName){case"display-text":t+=n.innerText;break;case"accidental-text":switch(n.innerText){case"sharp":t+="\u266f";break;case"natural":t+="\u266e";break;case"flat":t+="\u266d";break;case"double-sharp":t+="\u{1d12a}";break;case"sharp-sharp":t+="\u266f\u266f";break;case"flat-flat":t+="\u{1d12b}";break;case"natural-sharp":t+="\u266e\u266f";break;case"natural-flat":t+="\u266e\u266d";break;case"sharp-down":t+="\u{1d131}";break;case"sharp-up":t+="\u{1d130}";break;case"natural-down":t+="\u{1d12f}";break;case"natural-up":t+="\u{1d12e}";break;case"flat-down":t+="\u{1d12d}";break;case"flat-up":t+="\u{1d12c}";break;case"arrow-down":t+="\u2193";break;case"arrow-up":t+="\u2191";break;case"triple-sharp":t+="\u266f\u{1d12a}";break;case"triple-flat":t+="\u{1d12c}\u{1d12c}\u{1d12c}";break;case"sharp-1":t+="\u266f\xb9";break;case"sharp-2":t+="\u266f\xb2";break;case"sharp-3":t+="\u266f\xb3";break;case"sharp-4":t+="\u266f\u2074";break;case"sharp-5":t+="\u266f\u2075";break;case"flat-1":t+="\u266d\xb9";break;case"flat-2":t+="\u266d\xb2";break;case"flat-3":t+="\u266d\xb3";break;case"flat-4":t+="\u266d\u2074";break;case"flat-5":t+="\u266d\u2075"}}return bn.sanitizeDisplay(t)}parseWork(e){for(const t of e.childElements())"work-title"===t.localName&&(this._score.title=bn.sanitizeDisplay(t.innerText))}parsePartwisePart(e){const t=e.attributes.get("id");if(!t||!this._idToTrackInfo.has(t))return;const n=this._idToTrackInfo.get(t).track;let i=0;for(const r of e.childElements())"measure"===r.localName&&(this.parsePartwiseMeasure(r,n,i),i++)}parsePartwiseMeasure(e,t,n){const i=this.getOrCreateMasterBar(e,n);this.parsePartMeasure(e,i,t)}parseTimewiseMeasure(e,t){const n=this.getOrCreateMasterBar(e,t);for(const i of e.childElements())"part"===i.localName&&this.parseTimewisePart(i,n)}getOrCreateMasterBar(e,t){const n="yes"===e.attributes.get("implicit");for(;this._score.masterBars.length<=t;){const r=new kl;n&&(r.isAnacrusis=!0),this._score.addMasterBar(r),r.index>0&&(r.timeSignatureDenominator=r.previousMasterBar.timeSignatureDenominator,r.timeSignatureNumerator=r.previousMasterBar.timeSignatureNumerator,r.tripletFeel=r.previousMasterBar.tripletFeel)}return this._score.masterBars[t]}parseTimewisePart(e,t){const n=e.attributes.get("id");if(!n||!this._idToTrackInfo.has(n))return;const i=this._idToTrackInfo.get(n).track;this.parsePartMeasure(e,t,i)}parsePartMeasure(e,t,n){this._musicalPosition=0,this._lastBeat=null,t.alternateEndings=this._nextMasterBarRepeatEnding;const i=[];for(const o of e.childElements())switch(o.localName){case"note":this.parseNote(o,t,n);break;case"backup":this.parseBackup(o);break;case"forward":this.parseForward(o);break;case"direction":this.parseDirection(o,t,n);break;case"attributes":this.parseAttributes(o,t,n);break;case"harmony":this.parseHarmony(o,n);break;case"print":this.parsePrint(o,t,n);break;case"sound":this.parseSound(o,t,n);break;case"barline":i.push(o)}for(const o of i)this.parseBarLine(o,t,n);this.applySimileMarks(t,n);const r=this.getOrCreateStaff(n,0);this.getOrCreateBar(r,t),this._keyAllStaves=null}parsePrint(e,t,n){("yes"===e.getAttribute("new-system","no")||"yes"===e.getAttribute("new-page","no"))&&n.addLineBreaks(t.index)}applySimileMarks(e,t){if(null!==this._simileMarkAllStaves){for(const n of t.staves){const i=this.getOrCreateBar(n,e);i.simileMark=this._simileMarkAllStaves,i.simileMark!==ws.None&&this.clearBar(i)}this._simileMarkAllStaves=this._simileMarkAllStaves===ws.FirstOfDouble?ws.SecondOfDouble:null}if(null!==this._simileMarkPerStaff){const n=Array.from(this._simileMarkPerStaff.keys());for(const i of n){const r=this.getOrCreateStaff(t,i),o=this.getOrCreateBar(r,e);o.simileMark=this._simileMarkPerStaff.get(i),o.simileMark!==ws.None&&this.clearBar(o),o.simileMark===ws.FirstOfDouble?this._simileMarkPerStaff.set(i,ws.SecondOfDouble):this._simileMarkPerStaff.delete(i)}0===this._simileMarkPerStaff.size&&(this._simileMarkPerStaff=null)}}clearBar(e){for(const t of e.voices){const n=new Ei;n.isEmpty=!0,t.addBeat(n)}}parseBarLine(e,t,n){for(const i of e.childElements())switch(i.localName){case"bar-style":this.parseBarStyle(i,t,n,e.getAttribute("location","right"));break;case"ending":this.parseEnding(i,t);break;case"repeat":this.parseRepeat(i,t)}}parseRepeat(e,t){const n=e.getAttribute("direction");let i=Number.parseInt(e.getAttribute("times"));(i<0||Number.isNaN(i))&&(i=2),"backward"===n?t.repeatCount=i:"forward"===n&&(t.isRepeatStart=!0)}parseEnding(e,t){const n=e.getAttribute("number").split(",").map(r=>Number.parseInt(r));let i=0;for(const r of n)i|=1<<r-1&255;switch(t.alternateEndings=i,e.getAttribute("type","")){case"start":this._nextMasterBarRepeatEnding=this._nextMasterBarRepeatEnding|i;break;case"stop":case"discontinue":this._nextMasterBarRepeatEnding=this._nextMasterBarRepeatEnding&~i}}parseBarStyle(e,t,n,i){let r=We.Automatic;switch(e.innerText){case"dashed":r=We.Dashed;break;case"dotted":r=We.Dotted;break;case"heavy":r=We.Heavy;break;case"heavy-heavy":r=We.HeavyHeavy;break;case"heavy-light":r=We.HeavyLight;break;case"light-heavy":r=We.LightHeavy;break;case"light-light":r=We.LightLight;break;case"none":r=We.None;break;case"regular":r=We.Regular;break;case"short":r=We.Short;break;case"tick":r=We.Tick}for(const o of n.staves){const a=this.getOrCreateBar(o,t);switch(i){case"left":a.barLineLeft=r;break;case"right":a.barLineRight=r}}}parseSound(e,t,n){for(const i of e.childElements())switch(i.localName){case"midi-instrument":this.parseSoundMidiInstrument(i,t);break;case"swing":this.parseSwing(i,t)}if(e.attributes.has("coda")&&t.addDirection(j.TargetCoda),e.attributes.has("tocoda")&&t.addDirection(j.JumpDaCoda),e.attributes.has("dacapo")&&t.addDirection(j.JumpDaCapo),e.attributes.has("dalsegno")&&t.addDirection(j.JumpDalSegno),e.attributes.has("fine")&&t.addDirection(j.TargetFine),e.attributes.has("segno")&&t.addDirection(j.TargetSegno),e.attributes.has("pan")){this._nextBeatAutomations||(this._nextBeatAutomations=[]);const i=new fs;i.type=$n.Balance,i.value=bn.interpolatePan(Number.parseFloat(e.attributes.get("pan"))),this._nextBeatAutomations.push(i)}if(e.attributes.has("tempo")){this._nextBeatAutomations||(this._nextBeatAutomations=[]);const i=new fs;i.type=$n.Tempo,i.value=bn.interpolatePercent(Number.parseFloat(e.attributes.get("tempo"))),this._nextBeatAutomations.push(i)}}parseSwing(e,t){let n=0,i=0,r=null;for(const o of e.childElements())switch(o.localName){case"straight":return void(t.tripletFeel=nt.NoTripletFeel);case"first":n=Number.parseInt(o.innerText);break;case"second":i=Number.parseInt(o.innerText);break;case"swing-type":r=this.parseBeatDuration(o)}r||(r=w.Eighth),r===w.Eighth?2===n&&1===i?t.tripletFeel=nt.Triplet8th:3===n&&1===i?t.tripletFeel=nt.Dotted8th:1===n&&3===i&&(t.tripletFeel=nt.Scottish8th):r===w.Sixteenth&&(2===n&&1===i?t.tripletFeel=nt.Triplet16th:3===n&&1===i?t.tripletFeel=nt.Dotted16th:1===n&&3===i&&(t.tripletFeel=nt.Scottish16th))}parseSoundMidiInstrument(e,t){let n;for(const i of e.childElements())switch(i.localName){case"midi-program":this._nextBeatAutomations||(this._nextBeatAutomations=[]),n=new fs,n.type=$n.Instrument,n.value=Number.parseInt(i.innerText)-1,this._nextBeatAutomations.push(n);break;case"volume":this._nextBeatAutomations||(this._nextBeatAutomations=[]),n=new fs,n.type=$n.Volume,n.value=bn.interpolatePercent(Number.parseFloat(i.innerText)),this._nextBeatAutomations.push(n);break;case"pan":this._nextBeatAutomations||(this._nextBeatAutomations=[]),n=new fs,n.type=$n.Balance,n.value=bn.interpolatePan(Number.parseFloat(i.innerText)),this._nextBeatAutomations.push(n)}}parseHarmony(e,t){const n=new gc;let i=!1,r="";for(const o of e.childElements())switch(o.localName){case"root":n.name=this.parseHarmonyRoot(o);break;case"kind":n.name=n.name+this.parseHarmonyKind(o),"yes"===o.getAttribute("parentheses-degrees","no")&&(i=!0);break;case"frame":this.parseHarmonyFrame(o,n);break;case"degree":r+=this.parseDegree(o)}r&&(n.name+=i?`(${r})`:r),null===this._nextBeatChord&&(this._nextBeatChord=n)}parseDegree(e){let t="",n="",i="";for(const r of e.childElements())switch(r.localName){case"degree-value":t=r.innerText;break;case"degree-alter":switch(r.innerText){case"-1":n="\u266d";break;case"1":n="\u266f"}break;case"degree-type":i+=r.getAttribute("text","")}return`${i}${n}${t}`}parseHarmonyRoot(e){let t="",n="";for(const i of e.childElements())switch(i.localName){case"root-step":t=i.innerText;break;case"root-alter":switch(Number.parseFloat(i.innerText)){case-2:n="bb";break;case-1:n="b";break;case 0:n="";break;case 1:n="#";break;case 2:n="##"}}return t+n}parseHarmonyKind(e){const t=e.getAttribute("text");let n="";if(t)n=t;else{const i=e.innerText;switch(i){case"major":n="";break;case"minor":n="m";break;case"augmented":n="+";break;case"diminished":n="\u25cb";break;case"dominant":n="7";break;case"major-seventh":n="7M";break;case"minor-seventh":n="m7";break;case"diminished-seventh":n="\u25cb7";break;case"augmented-seventh":n="+7";break;case"half-diminished":n="\u2349";break;case"major-minor":n="mMaj";break;case"major-sixth":n="maj6";break;case"minor-sixth":n="m6";break;case"dominant-ninth":n="9";break;case"major-ninth":n="maj9";break;case"minor-ninth":n="m9";break;case"dominant-11th":n="11";break;case"major-11th":n="maj11";break;case"minor-11th":n="m11";break;case"dominant-13th":n="13";break;case"major-13th":n="maj13";break;case"minor-13th":n="m13";break;case"suspended-second":n="sus2";break;case"suspended-fourth":n="sus4";break;case"Neapolitan":n="\u266dII";break;case"Italian":n="It\u207a\u2076";break;case"French":case"German":n="Fr\u207a\u2076";break;default:n=i}}return n}parseHarmonyFrame(e,t){for(const n of e.childElements())switch(n.localName){case"frame-strings":const i=Number.parseInt(n.innerText);t.strings=new Array(i);for(let a=0;a<i;a++)t.strings[a]=-1;break;case"first-fret":t.firstFret=Number.parseInt(n.innerText);break;case"frame-note":let r=null,o=null;for(const a of n.childElements())switch(a.localName){case"string":r=Number.parseInt(a.innerText);break;case"fret":o=Number.parseInt(a.innerText),r&&o>=0&&(t.strings[r-1]=o);break;case"barre":r&&o&&"start"===a.getAttribute("type")&&t.barreFrets.push(o)}}}parseAttributes(e,t,n){let i,r,o;if(null==this._lastBeat)for(const a of e.childElements())switch(a.localName){case"divisions":this._divisionsPerQuarterNote=Number.parseFloat(a.innerText);break;case"key":this.parseKey(a,t,n);break;case"time":this.parseTime(a,t);break;case"staves":n.ensureStaveCount(Number.parseInt(a.innerText));break;case"clef":i=Number.parseInt(a.getAttribute("number","1"))-1,r=this.getOrCreateStaff(n,i),o=this.getOrCreateBar(r,t),this.parseClef(a,o);break;case"staff-details":i=Number.parseInt(a.getAttribute("number","1"))-1,r=this.getOrCreateStaff(n,i),this.parseStaffDetails(a,r);break;case"transpose":this.parseTranspose(a,n);break;case"measure-style":this.parseMeasureStyle(a,n,!1)}else for(const a of e.childElements())switch(a.localName){case"divisions":this._divisionsPerQuarterNote=Number.parseFloat(a.innerText);break;case"measure-style":this.parseMeasureStyle(a,n,!0)}}parseMeasureStyle(e,t,n){for(const i of e.childElements())switch(i.localName){case"measure-repeat":if(!n){let r=null;switch(i.getAttribute("type")){case"start":switch(Number.parseInt(i.getAttribute("slashes","1"))){case 1:r=ws.Simple;break;case 2:r=ws.FirstOfDouble}break;case"stop":r=null}if(e.attributes.has("number")){this._simileMarkPerStaff=this._simileMarkPerStaff??new Map;const o=Number.parseInt(e.attributes.get("number"))-1;null==r?this._simileMarkPerStaff.delete(o):this._simileMarkPerStaff.set(o,r)}else this._simileMarkAllStaves=r}break;case"slash":switch(i.getAttribute("type")){case"start":this._isBeatSlash=!0;break;case"stop":this._isBeatSlash=!1}}}parseTranspose(e,t){let n=0;for(const i of e.childElements())switch(i.localName){case"chromatic":n+=Number.parseFloat(i.innerText);break;case"octave-change":n+=12*Number.parseFloat(i.innerText)}if(e.attributes.has("number")){const i=this.getOrCreateStaff(t,Number.parseInt(e.attributes.get("number"))-1);this.getStaffContext(i).transpose=n,i.displayTranspositionPitch=n}else for(const i of t.staves)this.getStaffContext(i).transpose=n,i.displayTranspositionPitch=n}parseStaffDetails(e,t){for(const n of e.childElements())switch(n.localName){case"staff-lines":t.standardNotationLineCount=Number.parseInt(n.innerText);break;case"staff-tuning":this.parseStaffTuning(n,t);break;case"capo":t.capo=Number.parseInt(n.innerText)}}parseStaffTuning(e,t){0===t.stringTuning.tunings.length&&(t.showTablature=!0,t.showStandardNotation=!1,t.stringTuning.tunings=new Array(t.standardNotationLineCount).fill(0));const n=Number.parseInt(e.getAttribute("line"));let i="C",r="",o=0;for(const l of e.childElements())switch(l.localName){case"tuning-step":i=l.innerText;break;case"tuning-alter":o=Number.parseFloat(l.innerText);break;case"tuning-octave":r=l.innerText}const a=ie.getTuningForText(i+r)+o;t.tuning[t.tuning.length-n]=a}parseClef(e,t){let n="s",i=0;for(const r of e.childElements())switch(r.localName){case"sign":n=r.innerText.toLowerCase();break;case"line":i=Number.parseInt(r.innerText);break;case"clef-octave-change":switch(Number.parseInt(r.innerText)){case-2:t.clefOttava=Ze._15mb;break;case-1:t.clefOttava=Ze._8vb;break;case 1:t.clefOttava=Ze._8va;break;case 2:t.clefOttava=Ze._15mb}}switch(n){case"g":default:t.clef=Et.G2;break;case"f":t.clef=Et.F4;break;case"c":t.clef=3===i?Et.C3:Et.C4;break;case"percussion":t.clef=Et.Neutral,t.staff.isPercussion=!0;break;case"tab":t.clef=Et.G2,t.staff.showTablature=!0}}parseTime(e,t){let n=!1,i=!1;for(const r of e.childElements()){const o=r.innerText;switch(r.localName){case"beats":n||(t.timeSignatureNumerator=-1===o.indexOf("+")?Number.parseInt(o):o.split("+").map(a=>Number.parseInt(a)).reduce((a,l)=>l+a,0),n=!0);break;case"beat-type":i||(t.timeSignatureDenominator=-1===o.indexOf("+")?Number.parseInt(o):o.split("+").map(a=>Number.parseInt(a)).reduce((a,l)=>l+a,0),i=!0)}}switch(e.getAttribute("symbol","")){case"common":case"cut":t.timeSignatureCommon=!0}}parseKey(e,t,n){let o,a,i=-wt.C,r="";for(const l of e.childElements())switch(l.localName){case"fifths":i=Number.parseInt(l.innerText);break;case"mode":r=l.innerText}if(o=-7<=i&&i<=7?i:wt.C,a="minor"===r?dr.Minor:dr.Major,e.attributes.has("number")){const l=this.getOrCreateStaff(n,Number.parseInt(e.attributes.get("number"))-1),c=this.getOrCreateBar(l,t);c.keySignature=o,c.keySignatureType=a}else{this._keyAllStaves=[o,a];for(const l of n.staves)l.bars.length>t.index&&(l.bars[t.index].keySignature=o,l.bars[t.index].keySignatureType=a)}}parseDirection(e,t,n){const i=[];let r=null,o=-1,a=-1;for(const d of e.childElements())switch(d.localName){case"direction-type":const p=d.firstElement;p&&i.push(p);break;case"offset":r=Number.parseFloat(d.innerText);break;case"voice":break;case"staff":o=Number.parseInt(d.innerText)-1;break;case"sound":d.attributes.has("tempo")&&(a=Number.parseFloat(d.attributes.get("tempo")))}let l=null;l=o>=0?this.getOrCreateStaff(n,o):null!==this._lastBeat?this._lastBeat.voice.bar.staff:this.getOrCreateStaff(n,0);const c=l?this.getOrCreateBar(l,t):null,u=()=>{let d=this._musicalPosition;return null!==r&&(d+=r),d/t.calculateDuration(!1)};if(a>0){const d=new fs;d.type=$n.Tempo,d.value=a,d.ratioPosition=u(),this.hasSameTempo(t,d)||(t.tempoAutomations.push(d),0===t.index&&(t.score.tempo=d.value))}let h="";for(const d of i)switch(d.localName){case"rehearsal":t.section=new kf,t.section.marker=d.innerText;break;case"segno":t.addDirection(j.TargetSegno);break;case"coda":t.addDirection(j.TargetCoda);break;case"words":h=d.innerText;break;case"wedge":switch(d.getAttribute("type")){case"crescendo":this._nextBeatCrescendo=Zi.Crescendo;break;case"diminuendo":this._nextBeatCrescendo=Zi.Decrescendo;break;case"stop":this._nextBeatCrescendo=null}break;case"dynamics":const p=this.parseDynamics(d);null!==p&&(this._currentDynamics=p,this._score.stylesheet.hideDynamics=!1);break;case"dashes":const g=d.getAttribute("type","start");switch(h){case"LetRing":this._nextBeatLetRing="start"===g||"continue"===g;break;case"P.M.":this._nextBeatPalmMute="start"===g||"continue"===g}h="";break;case"pedal":const m=this.parsePedal(d);m&&c&&(m.ratioPosition=u(),(m.pedalType!==Ms.Up||c.sustainPedals.length>0&&c.sustainPedals[c.sustainPedals.length-1].pedalType!==Ms.Up)&&c.sustainPedals.push(m));break;case"metronome":this.parseMetronome(d,t,u());break;case"octave-shift":this._nextBeatOttavia=this.parseOctaveShift(d)}h&&(this._nextBeatText=h)}parseOctaveShift(e){const t=e.getAttribute("type");switch(Number.parseInt(e.getAttribute("size","8"))){case 15:switch(t){case"up":return Ze._15mb;case"down":return Ze._15ma;case"stop":return Ze.Regular;case"continue":return this._nextBeatOttavia}break;case 8:switch(t){case"up":return Ze._8vb;case"down":return Ze._8va;case"stop":return Ze.Regular;case"continue":return this._nextBeatOttavia}}return null}parseMetronome(e,t,n){let i=null,r=-1;for(const o of e.childElements())switch(o.localName){case"beat-unit":i=this.parseBeatDuration(o);break;case"per-minute":r=Number.parseFloat(o.innerText)}if(null!==i&&r>0){const o=new fs;o.type=$n.Tempo,o.value=r*(i/4)|0,o.ratioPosition=n,this.hasSameTempo(t,o)||(t.tempoAutomations.push(o),0===t.index&&(t.score.tempo=o.value))}}hasSameTempo(e,t){for(const n of e.tempoAutomations)if(t.ratioPosition===n.ratioPosition&&t.value===n.value)return!0;return!1}parsePedal(e){const t=new gu;switch(e.getAttribute("type")){case"start":t.pedalType=Ms.Down;break;case"stop":t.pedalType=Ms.Up;break;case"continue":t.pedalType=Ms.Hold;break;default:return null}return t}parseDynamics(e){for(const t of e.childElements()){const n=t.localName.toUpperCase();switch(n){case"PPP":case"PP":case"P":case"MP":case"MF":case"F":case"FF":case"FFF":case"PPPP":case"PPPPP":case"PPPPPP":case"FFFF":case"FFFFF":case"FFFFFF":case"SF":case"SFP":case"SFPP":case"FP":case"RF":case"RFZ":case"SFZ":case"SFFZ":case"FZ":case"N":case"PF":case"SFZP":return Te[n]}}return null}parseForward(e){for(const t of e.childElements())"duration"===t.localName&&(this._musicalPosition+=this.musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(t.innerText)))}parseBackup(e){for(const t of e.childElements())if("duration"===t.localName&&this._lastBeat){let i=this._musicalPosition;i-=this.musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(t.innerText)),i<0&&(i=0),this._musicalPosition=i}}getOrCreateStaff(e,t){for(;e.staves.length<=t;){const n=new tw;e.addStaff(n),this._score.masterBars.length>0&&this.getOrCreateBar(n,this._score.masterBars[this._score.masterBars.length-1])}return e.staves[t]}getOrCreateBar(e,t){const n=0===e.bars.length?1:e.bars[0].voices.length;for(;e.bars.length<=t.index;){const i=new Sl;e.addBar(i),i.previousBar&&(i.clef=i.previousBar.clef,i.clefOttava=i.previousBar.clefOttava,i.keySignature=i.previousBar.keySignature,i.keySignatureType=i.previousBar.keySignatureType),null!=this._keyAllStaves&&(i.keySignature=this._keyAllStaves[0],i.keySignatureType=this._keyAllStaves[1]);for(let r=0;r<n;r++){const o=new ko;i.addVoice(o)}}return e.bars[t.index]}getOrCreateVoice(e,t){let n=!1;for(;e.voices.length<=t;)e.addVoice(new ko),n=!0;if(n)for(const i of e.staff.bars)for(;i.voices.length<=t;)i.addVoice(new ko);return e.voices[t]}parseNote(e,t,n){let i=null,r=Ee.None,o=0,a=null,l=!1,c=0,u=0,h=-1,d=null,p=0,g=-1,m=-1,_=null,y=null,b=!1,S=null;const D="no"!==e.getAttribute("print-object","yes"),T=()=>{if(null!==i)return;l&&!this._lastBeat&&(F.warning("MusicXML","Malformed MusicXML, <chord /> cannot be set on the first note of a measure"),l=!1),l&&!y&&(F.warning("MusicXML","Cannot mix <chord /> and <rest />"),l=!1);const C=this.getOrCreateStaff(n,c);if(l)return i=this._lastBeat,void i.addNote(y);const v=this.getOrCreateBar(C,t),x=this.getOrCreateVoice(v,u);let W=this._musicalPosition-(0===x.beats.length?0:x.beats[x.beats.length-1].displayEnd);if(W>0){if(this._lastBeat&&this._lastBeat.beamingMode===jn.ForceMergeWithNext&&this._lastBeat.voice.bar.staff.index!==c&&x.beats.length>0&&x.beats[x.beats.length-1].beamingMode===jn.ForceMergeWithNext){const De=x.beats[x.beats.length-1].duration;for(;W>0;){const Ve=this.createRestForGap(W,De);if(null===Ve)break;this.insertBeatToVoice(Ve,x),W-=Ve.playbackDuration}}if(W>0){const De=new Ei;De.dynamics=this._currentDynamics,De.isEmpty=!0,De.duration=w.TwoHundredFiftySixth,De.overrideDisplayDuration=W,De.updateDurations(),this.insertBeatToVoice(De,x)}}else W<0&&F.error("MusicXML","Unsupported forward/backup detected. Cannot fill new beats into already filled area of voice");h<0&&null!==d&&(h=G.toTicks(d),p>0&&(h=G.applyDot(h,2===p)));const L=new Ei;i=L,null===a?L.beamingMode=this.getStaffContext(C).isExplicitlyBeamed?jn.ForceSplitToNext:jn.Auto:(L.beamingMode=a,this.getStaffContext(C).isExplicitlyBeamed=!0),L.isEmpty=!1,L.dynamics=this._currentDynamics,this._isBeatSlash&&(L.slashed=!0);const H=this._nextBeatAutomations;if(this._nextBeatAutomations=null,null!==H)for(const De of H)L.automations.push(De);const Ce=this._nextBeatChord;this._nextBeatChord=null,null!==Ce&&(L.chordId=Ce.uniqueId,x.bar.staff.hasChord(Ce.uniqueId)||x.bar.staff.addChord(L.chordId,Ce));const Re=this._nextBeatCrescendo;null!==Re&&(L.crescendo=Re);const Fe=this._nextBeatOttavia;if(null!==Fe&&(L.ottava=Fe),L.isLetRing=this._nextBeatLetRing,L.isPalmMute=this._nextBeatPalmMute,this._nextBeatText&&(L.text=this._nextBeatText,this._nextBeatText=null),null!==y&&L.addNote(y),this.insertBeatToVoice(L,x),null!==y){y.isVisible=D;const De=this._indexToTrackInfo.get(n.index);null!==S?y.percussionArticulation=De.getOrCreateArticulation(S,y):b||(y.percussionArticulation=De.getOrCreateArticulation("",y))}r!==Ee.None?(L.graceType=r,this.applyBeatDurationFromTicks(L,o,null,!1)):(L.tupletNumerator=g,L.tupletDenominator=m,L.dots=p,L.preferredBeamDirection=_,this.applyBeatDurationFromTicks(L,h,d,!0)),this._musicalPosition=L.displayEnd,this._lastBeat=L};for(const C of e.childElements())switch(C.localName){case"grace":const v=Number.parseFloat(C.getAttribute("make-time","-1"));v>=0?(o=this.musicXmlDivisionsToAlphaTabTicks(v),r=Ee.BeforeBeat):r=Ee.OnBeat,"yes"===C.getAttribute("slash")&&(r=Ee.BeforeBeat);break;case"chord":l=!0;break;case"cue":return;case"pitch":y=this.parsePitch(C),b=!0;break;case"unpitched":y=this.parseUnpitched(C,n);break;case"rest":y=null,null===d&&(d=w.Whole);break;case"duration":h=this.parseDuration(C);break;case"instrument":S=C.getAttribute("id","");break;case"voice":u=Number.parseInt(C.innerText),Number.isNaN(u)?(F.warning("MusicXML","Voices need to be specified as numbers"),u=0):u-=1;break;case"type":d=this.parseBeatDuration(C);break;case"dot":p++;break;case"accidental":null===y?F.warning("MusicXML","Malformed MusicXML, missing pitch or unpitched for note"):this.parseAccidental(C,y);break;case"time-modification":for(const x of C.childElements())switch(x.localName){case"actual-notes":g=Number.parseInt(x.innerText);break;case"normal-notes":m=Number.parseInt(x.innerText)}break;case"stem":_=this.parseStem(C);break;case"notehead":null===y?F.warning("MusicXML","Malformed MusicXML, missing pitch or unpitched for note"):this.parseNoteHead(C,y,d??w.Quarter,_??this.estimateBeamDirection(y));break;case"staff":c=Number.parseInt(C.innerText)-1;break;case"beam":if("1"===C.getAttribute("number","1"))switch(C.innerText){case"begin":case"continue":a=jn.ForceMergeWithNext;break;case"end":a=jn.ForceSplitToNext}break;case"notations":T(),this.parseNotations(C,y,i);break;case"lyric":T(),this.parseLyric(C,i,n);break;case"play":this.parsePlay(C,y)}if(b){const C=this.getOrCreateStaff(n,c),v=this.getStaffContext(C).transpose;if(0!==v){const x=12*y.octave+y.tone+v;y.octave=x/12|0,y.tone=x-12*y.octave}}T()}parsePlay(e,t){for(const n of e.childElements())"mute"===n.localName&&t&&"palm"===n.innerText&&(t.isPalmMute=!0)}estimateBeamDirection(e){return e.calculateRealValue(!1,!1)<bn.B4Value?V.Down:V.Up}parseNoteHead(e,t,n,i){"yes"===e.getAttribute("parentheses","no")&&(t.isGhost=!0);const r=e.getAttribute("filled","");let o;switch("yes"===r?o=!0:"no"===r&&(o=!1),t.style=new yD,e.innerText){case"arrow down":t.style.noteHeadCenterOnStem=!0,this.applyNoteHead(t,n,o,f.NoteheadTriangleDownDoubleWhole,f.NoteheadTriangleDownWhole,f.NoteheadTriangleDownHalf,f.NoteheadTriangleDownBlack);break;case"arrow up":t.style.noteHeadCenterOnStem=!0,this.applyNoteHead(t,n,o,f.NoteheadTriangleUpDoubleWhole,f.NoteheadTriangleUpWhole,f.NoteheadTriangleUpHalf,f.NoteheadTriangleUpBlack);break;case"back slashed":this.applyNoteHead(t,n,o,f.NoteheadSlashedDoubleWhole2,f.NoteheadSlashedWhole2,f.NoteheadSlashedHalf2,f.NoteheadSlashedBlack2);break;case"circle dot":t.style.noteHead=f.NoteheadRoundWhiteWithDot;break;case"circle-x":this.applyNoteHead(t,n,o,f.NoteheadCircleXDoubleWhole,f.NoteheadCircleXWhole,f.NoteheadCircleXHalf,f.NoteheadCircleX);break;case"circled":this.applyNoteHead(t,n,o,f.NoteheadCircledDoubleWhole,f.NoteheadCircledWhole,f.NoteheadCircledHalf,f.NoteheadCircledBlack);break;case"cluster":this.applyNoteHead(t,n,o,f.NoteheadClusterDoubleWhole3rd,f.NoteheadClusterWhole3rd,f.NoteheadClusterHalf3rd,f.NoteheadClusterQuarter3rd);break;case"cross":this.applyNoteHead(t,n,o,f.NoteheadPlusDoubleWhole,f.NoteheadPlusWhole,f.NoteheadPlusHalf,f.NoteheadPlusBlack);break;case"diamond":this.applyNoteHead(t,n,o,f.NoteheadDiamondDoubleWhole,f.NoteheadDiamondWhole,f.NoteheadDiamondHalf,f.NoteheadDiamondBlack);break;case"do":this.applyNoteHead(t,n,o,f.NoteShapeTriangleUpWhite,f.NoteShapeTriangleUpWhite,f.NoteShapeTriangleUpWhite,f.NoteShapeTriangleUpBlack);break;case"fa":i===V.Up?this.applyNoteHead(t,n,o,f.NoteShapeTriangleRightWhite,f.NoteShapeTriangleRightWhite,f.NoteShapeTriangleRightWhite,f.NoteShapeTriangleRightBlack):this.applyNoteHead(t,n,o,f.NoteShapeTriangleLeftWhite,f.NoteShapeTriangleLeftWhite,f.NoteShapeTriangleLeftWhite,f.NoteShapeTriangleLeftBlack);break;case"fa up":this.applyNoteHead(t,n,o,f.NoteShapeTriangleLeftWhite,f.NoteShapeTriangleLeftWhite,f.NoteShapeTriangleLeftWhite,f.NoteShapeTriangleLeftBlack);break;case"inverted triangle":this.applyNoteHead(t,n,o,f.NoteheadTriangleDownDoubleWhole,f.NoteheadTriangleDownWhole,f.NoteheadTriangleDownHalf,f.NoteheadTriangleDownBlack);break;case"la":case"square":this.applyNoteHead(t,n,o,f.NoteShapeSquareWhite,f.NoteShapeSquareWhite,f.NoteShapeSquareWhite,f.NoteShapeSquareBlack);break;case"left triangle":this.applyNoteHead(t,n,o,f.NoteheadTriangleRightWhite,f.NoteheadTriangleRightWhite,f.NoteheadTriangleRightWhite,f.NoteheadTriangleRightBlack);break;case"mi":this.applyNoteHead(t,n,o,f.NoteShapeDiamondWhite,f.NoteShapeDiamondWhite,f.NoteShapeDiamondWhite,f.NoteShapeDiamondBlack);break;case"none":t.style.noteHead=f.NoteheadNull;break;case"normal":this.applyNoteHead(t,n,o,f.NoteheadDoubleWhole,f.NoteheadWhole,f.NoteheadHalf,f.NoteheadBlack);break;case"re":this.applyNoteHead(t,n,o,f.NoteShapeMoonWhite,f.NoteShapeMoonWhite,f.NoteShapeMoonWhite,f.NoteShapeMoonBlack);break;case"rectangle":this.applyNoteHead(t,n,o,f.NoteheadSquareWhite,f.NoteheadSquareWhite,f.NoteheadSquareWhite,f.NoteheadSquareBlack);break;case"slash":this.applyNoteHead(t,n,o,f.NoteheadSlashWhiteWhole,f.NoteheadSlashWhiteWhole,f.NoteheadSlashWhiteHalf,f.NoteheadSlashVerticalEnds);break;case"slashed":this.applyNoteHead(t,n,o,f.NoteheadSlashedDoubleWhole1,f.NoteheadSlashedWhole1,f.NoteheadSlashedHalf1,f.NoteheadSlashedBlack1);break;case"so":this.applyNoteHead(t,n,o,f.NoteShapeRoundWhite,f.NoteShapeRoundWhite,f.NoteShapeRoundWhite,f.NoteShapeRoundBlack);break;case"ti":this.applyNoteHead(t,n,o,f.NoteShapeTriangleRoundWhite,f.NoteShapeTriangleRoundWhite,f.NoteShapeTriangleRoundWhite,f.NoteShapeTriangleRoundBlack);break;case"triangle":this.applyNoteHead(t,n,o,f.NoteheadTriangleUpDoubleWhole,f.NoteheadTriangleUpWhole,f.NoteheadTriangleUpHalf,f.NoteheadTriangleUpBlack);break;case"x":this.applyNoteHead(t,n,o,f.NoteheadXDoubleWhole,f.NoteheadXWhole,f.NoteheadXHalf,f.NoteheadXBlack)}}createRestForGap(e,t){let n=G.toTicks(t);for(;n>e;){if(t===w.TwoHundredFiftySixth)return null;n=G.toTicks(t*=2)}const i=new Ei;return i.dynamics=this._currentDynamics,i.isEmpty=!1,i.duration=t,i.overrideDisplayDuration=n,i.updateDurations(),i}insertBeatToVoice(e,t){if(t.beats.length>0){const n=t.beats[t.beats.length-1];n.nextBeat=e,e.previousBeat=n;let i=n;for(;null!==i&&i.graceType!==Ee.None;)i=i.index>0?i.previousBeat:null;null!==i&&(e.displayStart=i.displayEnd)}t.addBeat(e)}musicXmlDivisionsToAlphaTabTicks(e){return e*G.QuarterTime/this._divisionsPerQuarterNote}parseBeatDuration(e){switch(e.innerText){case"1024th":case"512th":case"256th":return w.TwoHundredFiftySixth;case"128th":return w.OneHundredTwentyEighth;case"64th":return w.SixtyFourth;case"32nd":return w.ThirtySecond;case"16th":return w.Sixteenth;case"eighth":return w.Eighth;case"quarter":return w.Quarter;case"half":return w.Half;case"whole":return w.Whole;case"breve":return w.DoubleWhole;case"long":return w.QuadrupleWhole}return null}applyBeatDurationFromTicks(e,t,n,i){if(!n)for(let r=0;r<bn.allDurations.length&&t>=bn.allDurationTicks[r];r++)n=bn.allDurations[r];e.duration=n??w.Sixteenth,i&&(e.overrideDisplayDuration=t),e.updateDurations()}parseLyric(e,t,n){const r=this._indexToTrackInfo.get(n.index).getLyricLine(e.getAttribute("number",""));for(null===t.lyrics&&(t.lyrics=[]);t.lyrics.length<=r;)t.lyrics.push("");for(const o of e.childElements())switch(o.localName){case"text":t.lyrics[r]?t.lyrics[r]+=` ${o.innerText}`:t.lyrics[r]=o.innerText;break;case"elision":t.lyrics[r]+=o.innerText}}parseNotations(e,t,n){for(const i of e.childElements())switch(i.localName){case"tied":t&&this.parseTied(i,t,n.voice.bar.staff);break;case"slur":t&&this.parseSlur(i,t);break;case"glissando":t&&this.parseGlissando(i,t);break;case"slide":t&&this.parseSlide(i,t);break;case"ornaments":t&&this.parseOrnaments(i,t);break;case"technical":this.parseTechnical(i,t,n);break;case"articulations":t&&this.parseArticulations(i,t);break;case"dynamics":const r=this.parseDynamics(i);null!==r&&(n.dynamics=r,this._currentDynamics=r);break;case"fermata":this.parseFermata(i,n);break;case"arpeggiate":this.parseArpeggiate(i,n)}}getStaffContext(e){if(!this._staffToContext.has(e)){const t=new cne;return this._staffToContext.set(e,t),t}return this._staffToContext.get(e)}parseGlissando(e,t){const n=e.getAttribute("type"),i=e.getAttribute("number","1"),r=this.getStaffContext(t.beat.voice.bar.staff);switch(n){case"start":r.slideOrigins.set(i,t);break;case"stop":if(r.slideOrigins.has(i)){const o=r.slideOrigins.get(i);o.slideTarget=t,t.slideOrigin=o,o.slideOutType=Qe.Shift}}}parseSlur(e,t){const n=e.getAttribute("number","1"),i=this.getStaffContext(t.beat.voice.bar.staff);switch(e.getAttribute("type")){case"start":i.slurStarts.set(n,t);break;case"stop":if(i.slurStarts.has(n)){t.isSlurDestination=!0;const r=i.slurStarts.get(n);r.slurDestination=t,t.slurOrigin=r,i.slurStarts.delete(n)}}}parseArpeggiate(e,t){switch(e.getAttribute("direction","down")){case"down":t.brushType=fe.ArpeggioDown;break;case"up":t.brushType=fe.ArpeggioUp}}parseFermata(e,t){let n;switch(e.innerText){case"normal":default:n=Ui.Medium;break;case"angled":n=Ui.Short;break;case"square":n=Ui.Long}t.fermata=new Cf,t.fermata.type=n}parseArticulations(e,t){for(const n of e.childElements())switch(n.localName){case"accent":t.accentuated=Ss.Normal;break;case"strong-accent":t.accentuated=Ss.Heavy;break;case"staccato":t.isStaccato=!0;break;case"tenuto":t.accentuated=Ss.Tenuto}}parseTechnical(e,t,n){const i=[];for(const r of e.childElements())switch(r.localName){case"up-bow":n.pickStroke=yi.Up;break;case"down-bow":n.pickStroke=yi.Down;break;case"harmonic":break;case"fingering":t&&(t.leftHandFinger=this.parseFingering(r));break;case"pluck":t&&(t.rightHandFinger=this.parseFingering(r));break;case"fret":t&&(t.fret=Number.parseInt(r.innerText));break;case"string":t&&(t.string=n.voice.bar.staff.tuning.length-Number.parseInt(r.innerText)+1);break;case"hammer-on":case"pull-off":t&&(t.isHammerPullOrigin=!0);break;case"bend":i.push(r);break;case"tap":n.tap=!0;break;case"smear":t&&(t.vibrato=Ft.Slight);break;case"golpe":switch(r.getAttribute("placement","above")){case"above":n.golpe=Rr.Finger;break;case"below":n.golpe=Rr.Thumb}}t&&i.length>0&&this.parseBends(i,t)}parseBends(e,t){const n=se.MaxPosition/e.length;let i=0,r=0,o=!0;for(const a of e){const l=a.findChildElement("bend-alter");if(l){const c=Math.round(2*Math.abs(Number.parseFloat(l.innerText)));a.findChildElement("pre-bend")?o?(i+=c,t.addBendPoint(new se(r,i)),r+=n,t.addBendPoint(new se(r,i)),o=!1):r+=n:a.findChildElement("release")?(o&&(i+=c),t.addBendPoint(new se(r,i)),r+=n,i-=c,t.addBendPoint(new se(r,i)),o=!1):(t.addBendPoint(new se(r,i)),i+=c,r+=n,t.addBendPoint(new se(r,i)),o=!1)}}}parseFingering(e){switch(e.innerText){case"0":return Ne.NoOrDead;case"1":case"p":case"t":return Ne.Thumb;case"2":case"i":return Ne.IndexFinger;case"3":case"m":return Ne.MiddleFinger;case"4":case"a":return Ne.AnnularFinger;case"5":case"c":return Ne.LittleFinger}return Ne.Unknown}parseOrnaments(e,t){let n=-1;for(const i of e.childElements())switch(i.localName){case"trill-mark":n=Number.parseInt(i.getAttribute("trill-step","2")),t.isStringed?t.trillValue=t.stringTuning+n:t.isPercussion||(t.trillValue=t.calculateRealValue(!1,!1)+n);break;case"turn":t.ornament=vs.Turn;break;case"inverted-turn":t.ornament=vs.InvertedTurn;break;case"wavy-line":n>0?"start"===i.getAttribute("type")&&(this._currentTrillStep=n):this._currentTrillStep>0?"stop"===i.getAttribute("type")?this._currentTrillStep=-1:t.isStringed?t.trillValue=t.stringTuning+this._currentTrillStep:t.isPercussion||(t.trillValue=t.calculateRealValue(!1,!1)+this._currentTrillStep):t.vibrato=Ft.Slight;break;case"mordent":t.ornament=vs.LowerMordent;break;case"inverted-mordent":t.ornament=vs.UpperMordent;break;case"tremolo":switch(i.innerText){case"1":t.beat.tremoloSpeed=w.Eighth;break;case"2":t.beat.tremoloSpeed=w.Sixteenth;break;case"3":t.beat.tremoloSpeed=w.ThirtySecond}}}parseSlide(e,t){const n=e.getAttribute("type"),i=e.getAttribute("number","1"),r=this.getStaffContext(t.beat.voice.bar.staff);switch(n){case"start":r.slideOrigins.set(i,t);break;case"stop":if(r.slideOrigins.has(i)){const o=r.slideOrigins.get(i);o.slideTarget=t,t.slideOrigin=o,o.slideOutType=Qe.Shift}}}parseTied(e,t,n){const i=e.getAttribute("type"),r=e.getAttribute("number",""),o=this.getStaffContext(n);if("start"===i){if(r){if(o.tieStartIds.has(r)){const a=o.tieStartIds.get(r);o.tieStarts.delete(a)}o.tieStartIds.set(r,t)}o.tieStarts.add(t)}else if("stop"===i&&!t.isTieDestination){let a=null;if(r){if(!o.tieStartIds.has(r))return;a=o.tieStartIds.get(r),o.tieStartIds.delete(r),o.tieStarts.delete(t)}else{const l=this.calculatePitchedNoteValue(t);for(const c of o.tieStarts)if(this.calculatePitchedNoteValue(c)===l){a=c,o.tieStarts.delete(a);break}}if(!a)return;t.isTieDestination=!0,t.tieOrigin=a}}parseStem(e){switch(e.innerText){case"down":return V.Down;case"up":return V.Up;default:return null}}parseAccidental(e,t){switch(e.innerText){case"sharp":t.accidentalMode=mt.ForceSharp;break;case"natural":t.accidentalMode=mt.ForceNatural;break;case"flat":t.accidentalMode=mt.ForceFlat;break;case"double-sharp":t.accidentalMode=mt.ForceDoubleSharp;break;case"flat-flat":t.accidentalMode=mt.ForceDoubleFlat}}calculatePitchedNoteValue(e){return 12*e.octave+e.tone}parseDuration(e){return this.musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(e.innerText))}parseUnpitched(e,t){let n="",i=0;for(const o of e.childElements())switch(o.localName){case"display-step":n=o.innerText;break;case"display-octave":i=Number.parseInt(o.innerText)+1}const r=new Co;if(""===n)r.octave=0,r.tone=0;else{const o=12*i+ie.getToneForText(n).noteValue;r.octave=o/12|0,r.tone=o-12*r.octave}return r}parsePitch(e){let t="",n=0,i=0;for(const a of e.childElements())switch(a.localName){case"step":t=a.innerText;break;case"alter":n=Number.parseFloat(a.innerText),Number.isNaN(n)&&(n=0);break;case"octave":i=Number.parseInt(a.innerText)+1}n|=0;const r=12*i+ie.getToneForText(t).noteValue+n,o=new Co;return o.octave=r/12|0,o.tone=r-12*o.octave,o}applyNoteHead(e,t,n,i,r,o,a){if(void 0===n)switch(t){case w.QuadrupleWhole:case w.DoubleWhole:e.style.noteHead=i;break;case w.Whole:e.style.noteHead=r;break;case w.Half:e.style.noteHead=o;break;default:e.style.noteHead=a}else if(!0===n)e.style.noteHead=a;else switch(t){case w.QuadrupleWhole:case w.DoubleWhole:e.style.noteHead=i;break;case w.Whole:e.style.noteHead=r;break;default:e.style.noteHead=o}}}bn.B4Value=71,bn.allDurations=[w.TwoHundredFiftySixth,w.OneHundredTwentyEighth,w.SixtyFourth,w.ThirtySecond,w.Sixteenth,w.Eighth,w.Quarter,w.Half,w.Whole,w.DoubleWhole,w.QuadrupleWhole],bn.allDurationTicks=bn.allDurations.map(s=>G.toTicks(s));var Df=function(s){return s[s.SingleTrackMultiChannel=0]="SingleTrackMultiChannel",s[s.MultiTrack=1]="MultiTrack",s}(Df||{});class ND{constructor(){this.events=[]}addEvent(e){if(0===this.events.length||e.tick>=this.events[this.events.length-1].tick)this.events.push(e);else{let t=this.events.length;for(;t>0&&this.events[t-1].tick>e.tick;)t--;this.events.splice(t,0,e)}}writeTo(e){const t=ps.empty();let n=0;for(const o of this.events)xl.writeVariableInt(t,o.tick-n),o.writeTo(t),n=o.tick;const i=new Uint8Array([77,84,114,107]);e.write(i,0,i.length);const r=t.toArray();N.writeInt32BE(e,r.length),e.write(r,0,r.length)}}class xl{constructor(){this.format=Df.SingleTrackMultiChannel,this.division=G.QuarterTime,this.tracks=[]}get events(){if(1===this.tracks.length)return this.tracks[0].events;const e=[];for(const t of this.tracks)this.events.push(...t.events);return e.sort((t,n)=>t.tick-n.tick),e}ensureTracks(e){for(;this.tracks.length<e;)this.tracks.push(new ND)}addEvent(e){this.format===Df.SingleTrackMultiChannel?(this.ensureTracks(1),this.tracks[0].addEvent(e)):(this.ensureTracks(e.track+1),this.tracks[e.track].addEvent(e))}toBinary(){const e=ps.empty();return this.writeTo(e),e.toArray()}writeTo(e){const t=new Uint8Array([77,84,104,100]);e.write(t,0,t.length),N.writeInt32BE(e,6),N.writeInt16BE(e,this.format),N.writeInt16BE(e,this.tracks.length),N.writeInt16BE(e,this.division);for(const n of this.tracks)n.writeTo(e)}static writeVariableInt(e,t){const n=new Uint8Array(4);let i=0;do{n[i++]=127&t,t>>=7}while(t>0);for(;i>0;)i--,e.writeByte(i>0?128|n[i]:n[i])}}var jt=function(s){return s[s.TimeSignature=88]="TimeSignature",s[s.NoteOn=128]="NoteOn",s[s.NoteOff=144]="NoteOff",s[s.ControlChange=176]="ControlChange",s[s.ProgramChange=192]="ProgramChange",s[s.TempoChange=81]="TempoChange",s[s.PitchBend=224]="PitchBend",s[s.PerNotePitchBend=96]="PerNotePitchBend",s[s.EndOfTrack=47]="EndOfTrack",s[s.AlphaTabRest=241]="AlphaTabRest",s[s.AlphaTabMetronome=242]="AlphaTabMetronome",s[s.SystemExclusive=240]="SystemExclusive",s[s.SystemExclusive2=247]="SystemExclusive2",s[s.Meta=255]="Meta",s}(jt||{});class Ua{constructor(e,t,n){this.track=e,this.tick=t,this.type=n}get command(){return this.type}get message(){return 0}get data1(){return 0}get data2(){return 0}}class ED extends Ua{constructor(e,t,n,i,r,o){super(e,t,jt.TimeSignature),this.track=e,this.tick=t,this.numerator=n,this.denominatorIndex=i,this.midiClocksPerMetronomeClick=r,this.thirtySecondNodesInQuarter=o}writeTo(e){e.writeByte(255),e.writeByte(88),xl.writeVariableInt(e,4),e.writeByte(255&this.numerator),e.writeByte(255&this.denominatorIndex),e.writeByte(255&this.midiClocksPerMetronomeClick),e.writeByte(255&this.thirtySecondNodesInQuarter)}}let jg=(()=>{class s extends Ua{writeTo(t){t.writeByte(240);const n=ps.withCapacity(16);n.writeByte(s.AlphaTabManufacturerId),this.writeEventData(n),n.writeByte(247),xl.writeVariableInt(t,n.length),n.copyTo(t)}}return s.AlphaTabManufacturerId=125,s.MetronomeEventId=0,s.RestEventId=1,s})();class ID extends jg{constructor(e,t,n,i,r){super(e,t,jt.AlphaTabMetronome),this.isMetronome=!0,this.metronomeNumerator=n,this.metronomeDurationInMilliseconds=r,this.metronomeDurationInTicks=i}writeEventData(e){e.writeByte(jg.MetronomeEventId),e.writeByte(this.metronomeNumerator),N.writeInt32LE(e,this.metronomeDurationInTicks),N.writeInt32LE(e,this.metronomeDurationInMilliseconds)}}class BD extends jg{constructor(e,t,n){super(e,t,jt.AlphaTabRest),this.channel=n}writeEventData(e){e.writeByte(jg.RestEventId),e.writeByte(this.channel)}}class MD extends Ua{constructor(e,t,n,i,r,o){super(e,t,n),this.channel=i,this.noteKey=r,this.noteVelocity=o}get data1(){return this.noteKey}get data2(){return this.noteVelocity}}class PD extends MD{constructor(e,t,n,i,r){super(e,t,jt.NoteOn,n,i,r)}writeTo(e){e.writeByte(15&this.channel|144),e.writeByte(255&this.noteKey),e.writeByte(255&this.noteVelocity)}}class AD extends MD{constructor(e,t,n,i,r){super(e,t,jt.NoteOff,n,i,r)}writeTo(e){e.writeByte(15&this.channel|128),e.writeByte(255&this.noteKey),e.writeByte(255&this.noteVelocity)}}class RD extends Ua{constructor(e,t,n,i,r){super(e,t,jt.ControlChange),this.channel=n,this.controller=i,this.value=r}writeTo(e){e.writeByte(15&this.channel|176),e.writeByte(255&this.controller),e.writeByte(255&this.value)}get data1(){return this.controller}get data2(){return this.value}}class FD extends Ua{constructor(e,t,n,i){super(e,t,jt.ProgramChange),this.channel=n,this.program=i}writeTo(e){e.writeByte(15&this.channel|192),e.writeByte(255&this.program)}get data1(){return this.program}}class OD extends Ua{get microSecondsPerQuarterNote(){return 6e7/this.beatsPerMinute}set microSecondsPerQuarterNote(e){this.beatsPerMinute=6e7/e}constructor(e,t){super(0,e,jt.TempoChange),this.beatsPerMinute=0,this.microSecondsPerQuarterNote=t}writeTo(e){e.writeByte(255),e.writeByte(81),e.writeByte(3),e.writeByte(this.microSecondsPerQuarterNote>>16&255),e.writeByte(this.microSecondsPerQuarterNote>>8&255),e.writeByte(255&this.microSecondsPerQuarterNote)}}class LD extends Ua{constructor(e,t,n,i){super(e,t,jt.PitchBend),this.channel=n,this.value=i}writeTo(e){e.writeByte(15&this.channel|224),e.writeByte(127&this.value),e.writeByte(this.value>>7&127)}get data1(){return 127&this.value}get data2(){return this.value>>7&127}}class VD extends Ua{constructor(e,t,n,i,r){super(e,t,jt.PerNotePitchBend),this.channel=n,this.noteKey=i,this.value=r}writeTo(e){throw new rn(un.General,"Note Bend (Midi2.0) events cannot be exported to SMF1.0")}}class HD extends Ua{constructor(e,t){super(e,t,jt.EndOfTrack)}writeTo(e){e.writeByte(255),e.writeByte(47),e.writeByte(0)}}class Yg{constructor(e,t){this.time=0,this.eventIndex=e,this.event=t,this.isMetronome=this.event.type===jt.AlphaTabMetronome}static newMetronomeEvent(e,t,n,i,r){const o=new ID(0,t,n,i,r);return new Yg(e,o)}}class xf{constructor(){this.masterBarIndex=0,this.masterBarOccurence=0,this.synthBpm=0,this.synthTime=0,this.synthTick=0,this.syncTime=0,this.syncBpm=0}updateSyncBpm(e,t){this.syncBpm=(e-this.synthTime)/(t-this.syncTime)*this.synthBpm}}class x2{constructor(e,t,n){this.bpm=e,this.ticks=t,this.time=n}}class WD{constructor(){this.tempoChanges=[],this.tempoChangeIndex=0,this.syncPoints=[],this.firstProgramEventPerChannel=new Map,this.firstTimeSignatureNumerator=0,this.firstTimeSignatureDenominator=0,this.synthData=[],this.division=G.QuarterTime,this.eventIndex=0,this.currentTime=0,this.syncPointIndex=0,this.playbackRange=null,this.playbackRangeStartTime=0,this.playbackRangeEndTime=0,this.endTick=0,this.endTime=0,this.currentTempo=0,this.syncPointTempo=0}}class N2{get isPlayingMain(){return this._currentState===this._mainState}get isPlayingOneTimeMidi(){return this._currentState===this._oneTimeState}get isPlayingCountIn(){return this._currentState===this._countInState}constructor(e){this._oneTimeState=null,this._countInState=null,this.isLooping=!1,this.playbackSpeed=1,this.instrumentPrograms=new Set,this.percussionKeys=new Set,this._synthesizer=e,this._mainState=new WD,this._currentState=this._mainState}get mainPlaybackRange(){return this._mainState.playbackRange}set mainPlaybackRange(e){this._mainState.playbackRange=e,e&&(this._mainState.playbackRangeStartTime=this.tickPositionToTimePositionWithSpeed(this._mainState,e.startTick,1),this._mainState.playbackRangeEndTime=this.tickPositionToTimePositionWithSpeed(this._mainState,e.endTick,1))}get currentTime(){return this._currentState.currentTime/this.playbackSpeed}get currentEndTick(){return this._currentState.endTick}get currentEndTime(){return this._currentState.endTime/this.playbackSpeed}get currentTempo(){return this._currentState.currentTempo}get modifiedTempo(){return this._currentState.syncPointTempo*this.playbackSpeed}get syncPointTempo(){return this._currentState.syncPointTempo}get currentSyncPoints(){return this._currentState.syncPoints}mainSeek(e){if(e*=this.playbackSpeed,this.mainPlaybackRange&&(e<this._mainState.playbackRangeStartTime?e=this._mainState.playbackRangeStartTime:e>this._mainState.playbackRangeEndTime&&(e=this._mainState.playbackRangeEndTime)),e>this._mainState.currentTime)this.mainSilentProcess(e-this._mainState.currentTime);else if(e<this._mainState.currentTime){if(this._mainState.currentTime=0,this._mainState.eventIndex=0,this._mainState.syncPointIndex=0,this._mainState.tempoChangeIndex=0,this._mainState.currentTempo=this._mainState.tempoChanges[0].bpm,this._mainState.syncPointTempo=this._mainState.syncPoints.length>0?this._mainState.syncPoints[0].syncBpm:this._mainState.currentTempo,this.isPlayingMain){const t=this._synthesizer.metronomeVolume;this._synthesizer.noteOffAll(!0),this._synthesizer.resetSoft(),this._synthesizer.setupMetronomeChannel(t)}this.mainSilentProcess(e)}}mainSilentProcess(e){if(e<=0)return;const t=Date.now(),n=this._mainState.currentTime+e;if(this.isPlayingMain)for(;this._mainState.currentTime<n;)this.fillMidiEventQueueLimited(n-this._mainState.currentTime)&&this._synthesizer.synthesizeSilent(xe.MicroBufferSize);this._mainState.currentTime=n;const i=Date.now()-t;F.debug("Sequencer",`Silent seek finished in ${i}ms (main)`)}loadOneTimeMidi(e){this._oneTimeState=this.createStateFromFile(e),this._currentState=this._oneTimeState}loadMidi(e){this.instrumentPrograms.clear(),this.percussionKeys.clear(),this._mainState=this.createStateFromFile(e),this._currentState=this._mainState}createStateFromFile(e){const t=new WD;this.percussionKeys.add(xe.MetronomeKey),t.tempoChanges=[],t.division=e.division,t.eventIndex=0,t.currentTime=0,t.synthData=[];let n=120,i=0,r=0,o=0,a=0,l=0,c=0,u=0,h=0;for(const d of e.events){const p=new Yg(t.synthData.length,d);t.synthData.push(p);const g=d.tick-h;if(i+=g,r+=g*(6e4/(n*e.division)),p.time=r,h=d.tick,a>0)for(;c<i;){const m=Yg.newMetronomeEvent(t.synthData.length,c,Math.floor(c/a)%o,a,l);t.synthData.push(m),m.time=u,c+=a,u+=l}if(d.type===jt.TempoChange)n=d.beatsPerMinute,t.tempoChanges.push(new x2(n,i,r)),l=a*(6e4/(n*e.division));else if(d.type===jt.TimeSignature){const m=d,_=Math.pow(2,m.denominatorIndex);o=m.numerator,a=t.division*(4/_)|0,l=a*(6e4/(n*e.division)),0===t.firstTimeSignatureDenominator&&(t.firstTimeSignatureNumerator=m.numerator,t.firstTimeSignatureDenominator=_)}else if(d.type===jt.ProgramChange){const m=d,_=m.channel;t.firstProgramEventPerChannel.has(_)||t.firstProgramEventPerChannel.set(_,p),_===xe.PercussionChannel||this.instrumentPrograms.add(m.program)}else d.type===jt.NoteOn&&d.channel===xe.PercussionChannel&&this.percussionKeys.add(d.noteKey)}return t.currentTempo=t.tempoChanges.length>0?t.tempoChanges[0].bpm:n,t.syncPointTempo=t.currentTempo,t.synthData.sort((d,p)=>d.time>p.time?1:d.time<p.time?-1:d.eventIndex-p.eventIndex),t.endTime=r,t.endTick=i,t}fillMidiEventQueue(){return this.fillMidiEventQueueLimited(-1)}fillMidiEventQueueToEndTime(e){for(;this._mainState.currentTime<e;)this.fillMidiEventQueueLimited(e-this._mainState.currentTime)&&this._synthesizer.synthesizeSilent(xe.MicroBufferSize);let t=!1;for(this._currentState.currentTime=e;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime;)this._synthesizer.dispatchEvent(this._currentState.synthData[this._currentState.eventIndex]),this._currentState.eventIndex++,t=!0;return t}fillMidiEventQueueLimited(e){let t=xe.MicroBufferSize/this._synthesizer.outSampleRate*1e3*this.playbackSpeed,n=this.internalEndTime;e>0&&(e<t&&(t=e),n=Math.min(this.internalEndTime,this._currentState.currentTime+e));let i=!1;for(this._currentState.currentTime+=t;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime&&this._currentState.currentTime<n;)this._synthesizer.dispatchEvent(this._currentState.synthData[this._currentState.eventIndex]),this._currentState.eventIndex++,i=!0;return i}mainTickPositionToTimePosition(e){return this.tickPositionToTimePositionWithSpeed(this._mainState,e,this.playbackSpeed)}mainUpdateSyncPoints(e){const t=this._mainState;if(e.sort((n,i)=>n.synthTick-i.synthTick),t.syncPoints=[],e.length>=0){let n=120,i=0,r=0,o=0;for(let a=0;a<e.length;a++){const l=e[a];let u,h,d,c=0;if(0===a)u=n,h=0,d=0;else{const p=e[a-1];u=p.syncBpm,h=p.syncTime,d=p.synthTick}for(;o<t.tempoChanges.length&&t.tempoChanges[o].ticks<=l.synthTick;){if(c=t.tempoChanges[o].ticks-i,c>0){i+=c,r+=c*(6e4/(n*t.division));const g=(l.syncTime-h)/(l.synthTick-d)*(i-d)+h,m=new xf;m.synthTick=i,m.synthBpm=n,m.synthTime=r,m.syncTime=g,m.syncBpm=u}n=t.tempoChanges[o].bpm,o++}c=l.synthTick-i,i+=c,r+=c*(6e4/(n*t.division)),t.syncPoints.push(l)}}t.syncPointIndex=0,t.syncPointTempo=t.syncPoints.length>0?t.syncPoints[0].syncBpm:t.currentTempo}currentTimePositionToTickPosition(e){const t=this._currentState;if(0===t.tempoChanges.length)return 0;this.updateCurrentTempo(t,e*=this.playbackSpeed);const n=t.tempoChanges[t.tempoChangeIndex];return n.ticks+((e-n.time)/(6e4/(n.bpm*t.division))|0)+1}currentUpdateCurrentTempo(e){this.updateCurrentTempo(this._mainState,e*this.playbackSpeed)}updateCurrentTempo(e,t){let n=e.tempoChangeIndex;for(t<e.tempoChanges[n].time&&(n=0);n+1<e.tempoChanges.length&&e.tempoChanges[n+1].time<=t;)n++;n!==e.tempoChangeIndex&&(e.tempoChangeIndex=n,e.currentTempo=e.tempoChanges[e.tempoChangeIndex].bpm,0===e.syncPoints.length&&(e.syncPointTempo=e.currentTempo))}currentUpdateSyncPoints(e){this.updateSyncPoints(this._mainState,e)}updateSyncPoints(e,t){const n=e.syncPoints;if(n.length>0){let i=Math.min(e.syncPointIndex,n.length-1);for(t<n[i].syncTime&&(i=0);i+1<n.length&&n[i+1].syncTime<=t;)i++;i!==e.syncPointIndex&&(e.syncPointIndex=i,e.syncPointTempo=n[i].syncBpm)}else e.syncPointTempo=e.currentTempo}mainTimePositionFromBackingTrack(e,t){const n=this._mainState,i=n.syncPoints;if(e<0||0===i.length)return e;this.updateSyncPoints(this._mainState,e);const r=Math.min(n.syncPointIndex,i.length-1),o=i[r],a=e-o.syncTime;let l;if(r+1<i.length){const c=i[r+1];l=a/(c.syncTime-o.syncTime)*(c.synthTime-o.synthTime)}else l=a/(t-o.syncTime)*(n.endTime-o.synthTime);return(o.synthTime+l)/this.playbackSpeed}mainTimePositionToBackingTrack(e,t){const n=this._mainState,i=n.syncPoints;if(e<0||0===i.length)return e;e*=this.playbackSpeed;let r=Math.min(n.syncPointIndex,i.length-1);for(e<i[r].synthTime&&(r=0);r+1<i.length&&i[r+1].synthTime<=e;)r++;const o=i[r],a=e-o.synthTime;let l;if(r+1<i.length){const c=i[r+1];l=o.syncTime+a/(c.synthTime-o.synthTime)*(c.syncTime-o.syncTime)}else l=o.syncTime+a/(n.endTime-o.synthTime)*(t-o.syncTime);return l}tickPositionToTimePositionWithSpeed(e,t,n){let i=0,r=120,o=0;for(const a of e.tempoChanges){if(t<a.ticks)break;i=a.time,r=a.bpm,o=a.ticks}return i+=(t-=o)*(6e4/(r*e.division)),i/n}get internalEndTime(){return this.isPlayingMain&&this.mainPlaybackRange?this._currentState.playbackRangeEndTime:this._currentState.endTime}get isFinished(){return this._currentState.currentTime>=this.internalEndTime}stop(){this._currentState.currentTime=this.isPlayingMain&&this.mainPlaybackRange?this.mainPlaybackRange.startTick:0,this._currentState.eventIndex=0}resetOneTimeMidi(){this._oneTimeState=null,this._currentState=this._mainState}resetCountIn(){this._countInState=null,this._currentState=this._mainState}startCountIn(){this.generateCountInMidi(),this._currentState=this._countInState,this.stop(),this._synthesizer.noteOffAll(!0)}generateCountInMidi(){const e=new WD;e.division=this._mainState.division;let t=120,n=4,i=4;0===this._mainState.eventIndex?(t=this._mainState.tempoChanges[0].bpm,n=this._mainState.firstTimeSignatureNumerator,i=this._mainState.firstTimeSignatureDenominator):(t=this._synthesizer.currentTempo,n=this._synthesizer.timeSignatureNumerator,i=this._synthesizer.timeSignatureDenominator),e.tempoChanges.push(new x2(t,0,0));const r=e.division*(4/i)|0,o=r*(6e4/(t*this._mainState.division));let a=0,l=0;for(let c=0;c<n;c++){const u=Yg.newMetronomeEvent(e.synthData.length,a,c,r,o);e.synthData.push(u),u.time=l,a+=r,l+=o}e.synthData.sort((c,u)=>c.time>u.time?1:c.time<u.time?-1:c.eventIndex-u.eventIndex),e.endTime=l,e.endTick=a,e.currentTempo=t,e.syncPointTempo=t,this._countInState=e}}var wi=function(s){return s[s.Paused=0]="Paused",s[s.Playing=1]="Playing",s}(wi||{});class Fh{constructor(e,t){this.state=e,this.stopped=t}}class Nl{constructor(e,t,n,i,r,o,a){this.originalTempo=0,this.modifiedTempo=0,this.currentTime=e,this.endTime=t,this.currentTick=n,this.endTick=i,this.isSeek=r,this.originalTempo=o,this.modifiedTempo=a}}let Oh=(()=>{class s{constructor(){this.id="",this.size=0}static load(t,n,i){if(t&&s.HeaderSize>t.size||i.position+s.HeaderSize>=i.length||(n.id=N.read8BitStringLength(i,4),n.id.charCodeAt(0)<=32||n.id.charCodeAt(0)>=122)||(n.size=N.readUInt32LE(i),t&&s.HeaderSize+n.size>t.size))return!1;t&&(t.size-=s.HeaderSize+n.size);const r="RIFF"===n.id;return!(r&&t||(r||"LIST"===n.id)&&(n.id=N.read8BitStringLength(i,4),n.id.charCodeAt(0)<=32||n.id.charCodeAt(0)>=122||(n.size-=4,0)))}}return s.HeaderSize=8,s})();class hne{constructor(e,t,n,i){this.packetData=e,this.isBeginningOfStream=t,this.isEndOfStream=n,this.granulePosition=n?i:null}addData(e){const t=this.packetData,n=new Uint8Array(t.length+e.length);n.set(t,0),n.set(e,t.length)}}var rw=function(s){return s[s.ContinuesPacket=1]="ContinuesPacket",s[s.BeginningOfStream=2]="BeginningOfStream",s[s.EndOfStream=4]="EndOfStream",s}(rw||{});class dne{constructor(e){this._readable=e}read(){const e=[];for(;this.findAndReadPage(e););return e}findAndReadPage(e){return!!this.seekPageHeader()&&this.readPage(e)}seekPageHeader(){for(let e=0;e<65536;e++){if(1399285583===N.readInt32LE(this._readable))return!0;this._readable.position-=3}return!1}readPage(e){const t=this._readable.readByte();if(-1===t||0!==t)return!1;const n=this._readable.readByte(),i=N.readInt64LE(this._readable);this._readable.skip(4),this._readable.skip(4),this._readable.skip(4);const r=this._readable.readByte();if(-1===r)return!1;const o=[];let a=0;for(let l=0;l<r;l++){const c=this._readable.readByte();a===o.length&&o.push(0),o[a]+=c,c<255&&a++}for(let l=0;l<o.length;l++){const c=new Uint8Array(o[l]);if(this._readable.read(c,0,c.length)!==c.length)return!1;if(0!==(n&rw.ContinuesPacket)){if(0===e.length)throw new rn(un.Format,"OGG: Continuation page without any previous packets");e[e.length-1].addData(c)}else{const h=new hne(c,0!==(n&rw.BeginningOfStream)&&0===l,0!==(n&rw.EndOfStream)&&l===o.length-1,i);e.push(h)}}return!0}}class fne{constructor(){this.audioChannels=0,this.audioSampleRate=0,this.samples=new Float32Array(0),this.bitrateMaximum=0,this.bitrateNominal=0,this.bitrateMinimum=0,this.blocksize0=0,this.blocksize1=0}}class E2{constructor(){this.value=0,this.bitsRead=0}}let I2=(()=>{class s{constructor(t){this._bitBucket=0n,this._bitCount=0n,this._overflowBits=0n,this._source=t}readByte(){return this.readBits(s.ByteSize)}readBit(){return 1===this.readBits(1)}readBytes(t){const n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=255&this.readByte();return n}readBits(t){if(0===t)return 0;const n=this.tryPeekBits(t);return this.skipBits(t),n.value}tryPeekBits(t){if(t<0||t>32)throw new rn(un.General,"IO: Cannot read more than 32 bits in one go");if(0===t)return new E2;const n=new E2;for(;this._bitCount<t;){const r=BigInt(this._source.readByte());if(-1n===r)return n.bitsRead=Number(this._bitCount),n.value=Number(this._bitBucket),this._bitBucket=0n,this._bitCount=0n,n;this._bitBucket=(0xffn&r)<<this._bitCount|this._bitBucket,this._bitCount+=8n,this._bitCount>32&&(this._overflowBits=r>>40n-this._bitCount&0xffn)}let i=this._bitBucket;return t<64&&(i&=(1n<<BigInt(t))-1n),n.value=Number(i),n.bitsRead=t,n}skipBits(t){let n=BigInt(t);if(0!==t)if(this._bitCount>n){if(this._bitBucket=t>31?0n:this._bitBucket>>n,this._bitCount>32){const i=this._bitCount-32n;this._bitBucket=this._bitBucket|this._overflowBits<<this._bitCount-n-i,i>t&&(this._overflowBits=this._overflowBits>>n&0xffn)}this._bitCount-=n}else if(this._bitCount===n)this._bitBucket=0n,this._bitCount=0n;else{for(n-=this._bitCount,this._bitCount=0n,this._bitBucket=0n;n>8;){if(-1===this._source.readByte()){n=0n;break}n-=8n}if(n>0){const i=BigInt(this._source.readByte());-1n===i||(this._bitBucket=i>>n,this._bitCount=8n-n)}}}}return s.ByteSize=8,s})();class pne{constructor(){this.codebooks=[],this.timeDomainTransforms=[],this.floors=[],this.residues=[],this.mappings=[],this.modes=[]}}class El{static ilog(e){let t=0;for(;e>0;)++t,e>>=1;return t}static bitReverse(e,t=32){let n=BigInt(e);return n=(n&BigInt(2863311530))>>1n|(n&BigInt(1431655765))<<1n,n=(n&BigInt(3435973836))>>2n|(n&BigInt(858993459))<<2n,n=(n&BigInt(4042322160))>>4n|(n&BigInt(252645135))<<4n,n=(n&BigInt(4278255360))>>8n|(n&BigInt(16711935))<<8n,n=(n>>16n|n<<16n)>>32n-BigInt(t),Number(BigInt.asUintN(32,n))}static convertFromVorbisFloat32(e){const t=BigInt(e);let n=t&BigInt(2097151);const i=t&BigInt(2147483648),r=(t&BigInt(2145386496))>>21n;return 0n!==i&&(n=-n),Number(n)*Math.pow(2,Number(r)-788)}}class gne{constructor(e){this._data=e}get(e){return this._data[e]}}class GD{get(e){return e}}GD.instance=new GD;class mne{constructor(e,t){if(this._maxBits=0,this._overflowList=null,this._prefixList=null,this._prefixBitLength=0,this.dimensions=0,this.entries=0,this.mapType=0,5653314!==e.readBits(24))throw new rn(un.Format,"Vorbis: Book header had invalid signature!");this.dimensions=e.readBits(16),this.entries=e.readBits(24),this._lengths=new Int32Array(this.entries),this.initTree(e,t),this.initLookupTable(e)}get(e,t){return this._lookupTable[e*this.dimensions+t]}decodeScalar(e){let t=e.tryPeekBits(this._prefixBitLength);if(0===t.bitsRead)return-1;let n=this._prefixList[t.value];if(null!=n)return e.skipBits(n.length),n.value;if(t=e.tryPeekBits(this._maxBits),null!==this._overflowList)for(let i=0;i<this._overflowList.length;i++)if(n=this._overflowList[i],n.bits===(t.value&n.mask))return e.skipBits(n.length),n.value;return-1}initTree(e,t){let n,r,i=0;if(e.readBit()){let o=e.readBits(5)+1;for(let a=0;a<this.entries;){let l=e.readBits(El.ilog(this.entries-a));for(;--l>=0;)this._lengths[a++]=o;++o}i=0,n=!1,r=o}else{r=-1,n=e.readBit();for(let o=0;o<this.entries;o++)!n||e.readBit()?(this._lengths[o]=e.readBits(5)+1,++i):this._lengths[o]=-1,this._lengths[o]>r&&(r=this._lengths[o])}if(this._maxBits=r,r>-1){let a,o=null;n&&i>=this.entries>>2&&(o=new Int32Array(this.entries),o.set(this._lengths.subarray(0,this.entries),0),n=!1),a=n?i:0;let l=null,c=null;if(n?0!==a&&(o=new Int32Array(a),c=new Int32Array(a),l=new Int32Array(a)):c=new Int32Array(this.entries),!this.computeCodewords(n,c,o,this._lengths,this.entries,l))throw new rn(un.Format,"Vorbis: Failed to compute codewords");const u=null==l?GD.instance:new gne(l);t.generateTable(u,o??this._lengths,c),this._prefixList=t.prefixTree,this._prefixBitLength=t.tableBits,this._overflowList=t.overflowList}}computeCodewords(e,t,n,i,r,o){const a=new Uint32Array(32);let l=0,c=0;for(l=0;l<r&&!(i[l]>0);++l);if(l===r)return!0;this.addEntry(e,t,n,0,l,c++,i[l],o);for(let u=1;u<=i[l];++u)a[u]=1<<32-u;for(let u=l+1;u<r;++u){let h=i[u];if(h<=0)continue;for(;h>0&&0===a[h];)--h;if(0===h)return!1;const d=a[h];if(a[h]=0,this.addEntry(e,t,n,El.bitReverse(d),u,c++,i[u],o),h!==i[u])for(let p=i[u];p>h;--p)a[p]=d+(1<<32-p)}return!0}addEntry(e,t,n,i,r,o,a,l){e?(t[o]=i,n[o]=a,l[o]=r):t[r]=i}initLookupTable(e){if(this.mapType=e.readBits(4),0===this.mapType)return;const t=El.convertFromVorbisFloat32(e.readBits(32)),n=El.convertFromVorbisFloat32(e.readBits(32)),i=e.readBits(4)+1,r=e.readBit();let o=this.entries*this.dimensions;const a=new Float32Array(o);1===this.mapType&&(o=this.lookup1Values());const l=new Uint32Array(o);for(let c=0;c<o;c++)l[c]=e.readBits(i);if(1===this.mapType)for(let c=0;c<this.entries;c++){let u=0,h=1;for(let d=0;d<this.dimensions;d++){const g=l[c/h%o|0]*n+t+u;a[c*this.dimensions+d]=g,r&&(u=g),h*=o}}else for(let c=0;c<this.entries;c++){let u=0,h=c*this.dimensions;for(let d=0;d<this.dimensions;d++){const p=l[h]*n+t+u;a[c*this.dimensions+d]=p,r&&(u=p),++h}}this._lookupTable=a}lookup1Values(){let e=Math.floor(Math.exp(Math.log(this.entries)/this.dimensions));return Math.floor(Math.pow(e+1,this.dimensions))<=this.entries&&++e,e}}class yne{constructor(){this.value=0,this.length=0,this.bits=0,this.mask=0}}let _ne=(()=>{class s{constructor(){this.tableBits=0,this.prefixTree=[],this.overflowList=null}generateTable(t,n,i){const r=new Array(n.length);let o=0;for(let u=0;u<r.length;u++){const h=new yne;h.value=t.get(u),h.length=n[u]<=0?99999:n[u],h.bits=i[u],h.mask=(1<<n[u])-1,r[u]=h,n[u]>0&&o<n[u]&&(o=n[u])}r.sort((u,h)=>{const d=u.length-h.length;return 0===d?u.bits-h.bits:d});const a=o>s.MAX_TABLE_BITS?s.MAX_TABLE_BITS:o,l=[];let c=null;for(let u=0;u<r.length&&r[u].length<99999;u++){const h=r[u].length;if(h>a)for(c=[];u<r.length&&r[u].length<99999;u++)c.push(r[u]);else{const d=1<<a-h,p=r[u];for(let g=0;g<d;g++){const m=g<<h|p.bits;for(;l.length<=m;)l.push(null);l[m]=p}}}for(;l.length<1<<a;)l.push(null);this.tableBits=a,this.prefixTree=l,this.overflowList=c}}return s.MAX_TABLE_BITS=10,s})();class bne{constructor(e){e.readBits(16)}}class wne{get executeChannel(){return(this.forceEnergy||this.amp>0)&&!this.forceNoEnergy}constructor(e){this.amp=0,this.forceEnergy=!1,this.forceNoEnergy=!1,this.coeff=e}}class ow{constructor(e,t,n,i){if(this._order=e.readBits(8),this._rate=e.readBits(16),this._bark_map_size=e.readBits(16),this._ampBits=e.readBits(6),this._ampOfs=e.readBits(8),this._books=new Array(e.readBits(4)+1),this._order<1||this._rate<1||this._bark_map_size<1||0===this._books.length)throw new rn(un.Format,"Vorbis: Invalid Floor0 Data");this._ampDiv=(1<<this._ampBits)-1;for(let r=0;r<this._books.length;r++){const o=e.readBits(8);if(o<0||o>=i.length)throw new rn(un.Format,"Vorbis: Invalid Floor0 Data");const a=i[o];if(0===a.mapType||a.dimensions<1)throw new rn(un.Format,"Vorbis: Invalid Floor0 Data");this._books[r]=a}this._bookBits=El.ilog(this._books.length),this._barkMaps=new Map([[t,this.synthesizeBarkCurve(t/2)],[n,this.synthesizeBarkCurve(n/2)]]),this._wMap=new Map([[t,this.synthesizeWDelMap(t/2)],[n,this.synthesizeWDelMap(n/2)]])}synthesizeBarkCurve(e){const t=this._bark_map_size/ow.toBARK(this._rate/2),n=new Int32Array(e+1);for(let i=0;i<e-1;i++)n[i]=Math.min(this._bark_map_size-1,Math.floor(ow.toBARK(this._rate/2/e*i)*t));return n[e]=-1,n}static toBARK(e){return 13.1*Math.atan(74e-5*e)+2.24*Math.atan(1.85e-8*e*e)+1e-4*e}synthesizeWDelMap(e){const t=Math.PI/this._bark_map_size,n=new Float32Array(e);for(let i=0;i<e;i++)n[i]=2*Math.cos(t*i);return n}unpack(e,t,n){const i=new wne(new Float32Array(this._order+1));if(i.amp=e.readBits(this._ampBits),i.amp>0){i.amp=i.amp/this._ampDiv*this._ampOfs;const r=e.readBits(this._bookBits);if(r>=this._books.length)return i.amp=0,i;const o=this._books[r];for(let l=0;l<this._order;){const c=o.decodeScalar(e);if(-1===c)return i.amp=0,i;for(let u=0;l<this._order&&u<o.dimensions;u++,l++)i.coeff[l]=o.get(c,u)}let a=0;for(let l=0;l<this._order;){for(let c=0;l<this._order&&c<o.dimensions;l++,c++)i.coeff[l]+=a;a=i.coeff[l-1]}}return i}apply(e,t,n){const i=e,r=t/2;if(i.amp>0){const o=this._barkMaps.get(t),a=this._wMap.get(t);let l=0;for(l=0;l<this._order;l++)i.coeff[l]=2*Math.cos(i.coeff[l]);for(l=0;l<r;){let c=0;const u=o[l];let h=.5,d=.5;const p=a[u];for(c=1;c<this._order;c+=2)d*=p-i.coeff[c-1],h*=p-i.coeff[c];for(c===this._order?(d*=p-i.coeff[c-1],h*=h*(4-p*p),d*=d):(h*=h*(2-p),d*=d*(2+p)),d=i.amp/Math.sqrt(h+d)-this._ampOfs,d=Math.exp(.11512925*d),n[l]*=d;o[++l]===u;)n[l]*=d}}else n.fill(0,0,r)}}class Sne{constructor(){this.posts=new Int32Array(64),this.postCount=0,this.forceEnergy=!1,this.forceNoEnergy=!1}get executeChannel(){return(this.forceEnergy||this.postCount>0)&&!this.forceNoEnergy}}class mc{constructor(e,t){let n=-1;this._partitionClass=new Int32Array(e.readBits(5));for(let o=0;o<this._partitionClass.length;o++)this._partitionClass[o]=e.readBits(4),this._partitionClass[o]>n&&(n=this._partitionClass[o]);++n,this._classDimensions=new Int32Array(n),this._classSubclasses=new Int32Array(n),this._classMasterbooks=new Array(n),this._classMasterBookIndex=new Int32Array(n),this._subclassBooks=new Array(n),this._subclassBookIndex=new Array(n);for(let o=0;o<n;o++){this._classDimensions[o]=e.readBits(3)+1,this._classSubclasses[o]=e.readBits(2),this._classSubclasses[o]>0&&(this._classMasterBookIndex[o]=e.readBits(8),this._classMasterbooks[o]=t[this._classMasterBookIndex[o]]),this._subclassBooks[o]=new Array(1<<this._classSubclasses[o]),this._subclassBookIndex[o]=new Int32Array(this._subclassBooks[o].length);for(let a=0;a<this._subclassBooks[o].length;a++){const l=e.readBits(8)-1;l>=0&&(this._subclassBooks[o][a]=t[l]),this._subclassBookIndex[o][a]=l}}this._multiplier=e.readBits(2),this._range=mc._rangeLookup[this._multiplier],this._yBits=mc._yBitsLookup[this._multiplier],++this._multiplier;const i=e.readBits(4),r=[];r.push(0),r.push(1<<i);for(let o=0;o<this._partitionClass.length;o++){const a=this._partitionClass[o];for(let l=0;l<this._classDimensions[a];l++)r.push(e.readBits(i))}this._xList=new Int32Array(r),this._lNeigh=new Int32Array(r.length),this._hNeigh=new Int32Array(r.length),this._sortIdx=new Int32Array(r.length),this._sortIdx[0]=0,this._sortIdx[1]=1;for(let o=2;o<this._lNeigh.length;o++){this._lNeigh[o]=0,this._hNeigh[o]=1,this._sortIdx[o]=o;for(let a=2;a<o;a++){const l=this._xList[a];l<this._xList[o]?l>this._xList[this._lNeigh[o]]&&(this._lNeigh[o]=a):l<this._xList[this._hNeigh[o]]&&(this._hNeigh[o]=a)}}for(let o=0;o<this._sortIdx.length-1;o++)for(let a=o+1;a<this._sortIdx.length;a++){if(this._xList[o]===this._xList[a])throw new rn(un.Format,"Vorbis: Invalid Floor1 Data");if(this._xList[this._sortIdx[o]]>this._xList[this._sortIdx[a]]){const l=this._sortIdx[o];this._sortIdx[o]=this._sortIdx[a],this._sortIdx[a]=l}}}unpack(e,t,n){const i=new Sne;if(e.readBit()){let r=2;i.posts[0]=e.readBits(this._yBits),i.posts[1]=e.readBits(this._yBits);for(let o=0;o<this._partitionClass.length;o++){const a=this._partitionClass[o],l=this._classDimensions[a],c=this._classSubclasses[a],u=(1<<c)-1;let h=0;if(c>0&&(h=this._classMasterbooks[a].decodeScalar(e),-1===h)){r=0;break}for(let d=0;d<l;d++){const p=this._subclassBooks[a][h&u];if(h>>=c,null!=p&&(i.posts[r]=p.decodeScalar(e),-1===i.posts[r])){r=0,o=this._partitionClass.length;break}++r}}i.postCount=r}return i}apply(e,t,n){const i=e,r=t/2;if(i.postCount>0){const o=this.unwrapPosts(i);let a=0,l=i.posts[0]*this._multiplier;for(let c=1;c<i.postCount;c++){const u=this._sortIdx[c];if(o[u]){const h=this._xList[u],d=i.posts[u]*this._multiplier;a<r&&this.renderLineMulti(a,l,Math.min(h,r),d,n),a=h,l=d}if(a>=r)break}a<r&&this.renderLineMulti(a,l,r,l,n)}else n.fill(0,0,r)}unwrapPosts(e){const t=new Array(64);t.fill(!1),t[0]=!0,t[1]=!0;const n=new Int32Array(64);n[0]=e.posts[0],n[1]=e.posts[1];for(let i=2;i<e.postCount;i++){const r=this._lNeigh[i],o=this._hNeigh[i],a=this.renderPoint(this._xList[r],n[r],this._xList[o],n[o],this._xList[i]),l=e.posts[i],c=this._range-a,u=a;let h;h=c<u?2*c:2*u,0!==l?(t[r]=!0,t[o]=!0,t[i]=!0,n[i]=l>=h?c>u?l-u+a:a-l+c-1:l%2==1?a-(l+1)/2:a+l/2):(t[i]=!1,n[i]=a)}for(let i=0;i<e.postCount;i++)e.posts[i]=n[i];return t}renderPoint(e,t,n,i,r){const o=i-t,a=n-e,u=Math.abs(o)*(r-e)/a|0;return o<0?t-u:t+u}renderLineMulti(e,t,n,i,r){const o=i-t,a=n-e;let l=Math.abs(o);const c=1-2*(o>>31&1),u=o/a|0;let h=e,d=t,p=-a;for(r[e]*=mc.inverse_dB_table[t],l-=Math.abs(u)*a;++h<n;)d+=u,p+=l,p>=0&&(p-=a,d+=c),r[h]*=mc.inverse_dB_table[d]}}mc._rangeLookup=[256,128,86,64],mc._yBitsLookup=[8,7,7,6],mc.inverse_dB_table=new Float32Array([1.0649863e-7,1.1341951e-7,1.2079015e-7,1.2863978e-7,1.3699951e-7,1.4590251e-7,1.5538408e-7,1.6548181e-7,1.7623575e-7,1.8768855e-7,1.9988561e-7,2.128753e-7,2.2670913e-7,2.4144197e-7,2.5713223e-7,2.7384213e-7,2.9163793e-7,3.1059021e-7,3.3077411e-7,3.5226968e-7,3.7516214e-7,3.9954229e-7,4.255068e-7,4.5315863e-7,4.8260743e-7,5.1396998e-7,5.4737065e-7,5.8294187e-7,6.2082472e-7,6.6116941e-7,7.0413592e-7,7.4989464e-7,7.9862701e-7,8.505263e-7,9.0579828e-7,9.6466216e-7,10273513e-13,10941144e-13,11652161e-13,12409384e-13,13215816e-13,14074654e-13,14989305e-13,15963394e-13,17000785e-13,18105592e-13,19282195e-13,20535261e-13,21869758e-13,23290978e-13,24804557e-13,26416497e-13,2813319e-12,29961443e-13,31908506e-13,33982101e-13,36190449e-13,38542308e-13,41047004e-13,4371447e-12,46555282e-13,49580707e-13,5280274e-12,5623416e-12,59888572e-13,63780469e-13,67925283e-13,72339451e-13,77040476e-13,82047e-10,87378876e-13,93057248e-13,99104632e-13,10554501e-12,11240392e-12,11970856e-12,12748789e-12,13577278e-12,14459606e-12,15399272e-12,16400004e-12,17465768e-12,18600792e-12,19809576e-12,21096914e-12,22467911e-12,23928002e-12,25482978e-12,27139006e-12,28902651e-12,30780908e-12,32781225e-12,34911534e-12,37180282e-12,39596466e-12,42169667e-12,4491009e-11,47828601e-12,50936773e-12,54246931e-12,57772202e-12,61526565e-12,65524908e-12,69783085e-12,74317983e-12,79147585e-12,8429104e-11,89768747e-12,95602426e-12,.00010181521,.00010843174,.00011547824,.00012298267,.00013097477,.00013948625,.00014855085,.00015820453,.00016848555,.00017943469,.00019109536,.00020351382,.00021673929,.00023082423,.00024582449,.00026179955,.00027881276,.00029693158,.00031622787,.00033677814,.00035866388,.00038197188,.00040679456,.00043323036,.00046138411,.00049136745,.00052329927,.00055730621,.00059352311,.00063209358,.00067317058,716917e-9,.0007635063,.00081312324,.00086596457,.00092223983,.00098217216,.0010459992,.0011139742,.0011863665,.0012634633,.0013455702,.0014330129,.0015261382,.0016253153,.0017309374,.0018434235,.0019632195,.0020908006,.0022266726,.0023713743,.0025254795,.0026895994,.0028643847,.0030505286,.0032487691,.0034598925,.0036847358,.0039241906,.0041792066,.004450795,.0047400328,.0050480668,.0053761186,.0057254891,.0060975636,.0064938176,.0069158225,.0073652516,.0078438871,.0083536271,.0088964928,.009474637,.010090352,.01074608,.011444421,.012188144,.012980198,.013823725,.014722068,.015678791,.016697687,.017782797,.018938423,.020169149,.021479854,.022875735,.02436233,.025945531,.027631618,.029427276,.031339626,.033376252,.035545228,.037855157,.040315199,.042935108,.045725273,.048696758,.051861348,.055231591,.05882085,.062643361,.066714279,.071049749,.075666962,.080584227,.085821044,.091398179,.097337747,.1036633,.11039993,.11757434,.12521498,.13335215,.14201813,.15124727,.16107617,.1715438,.18269168,.19456402,.20720788,.22067342,.23501402,.25028656,.26655159,.28387361,.30232132,.32196786,.34289114,.36517414,.38890521,.41417847,.44109412,.4697589,.50028648,.53279791,.56742212,.6042964,.64356699,.68538959,.72993007,.77736504,.8278826,.88168307,.9389798,1]);class vne{constructor(e,t,n,i){const r=e.readBits(16);switch(r){case 0:this.floor=new ow(e,t,n,i);break;case 1:this.floor=new mc(e,i);break;default:throw new rn(un.Format,`Vorbis: Invalid Floor type: ${r}`)}}apply(e,t,n){this.floor.apply(e,t,n)}unpack(e,t,n){return this.floor.unpack(e,t,n)}}class Xg{constructor(e,t,n){this._begin=e.readBits(24),this._end=e.readBits(24),this._partitionSize=e.readBits(24)+1,this._classifications=e.readBits(6)+1,this._classBook=n[e.readBits(8)],this._cascade=new Int32Array(this._classifications);let i=0;for(let h=0;h<this._classifications;h++){const d=e.readBits(3);this._cascade[h]=e.readBit()?e.readBits(5)<<3|d:d,i+=Xg.icount(this._cascade[h])}const r=new Int32Array(i);for(let h=0;h<i;h++)if(r[h]=e.readBits(8),0===n[r[h]].mapType)throw new rn(un.Format,"Vorbis: Invalid Residue 0");const o=this._classBook.entries;let a=this._classBook.dimensions,l=1;for(;a>0;){if(l*=this._classifications,l>o)throw new rn(un.Format,"Vorbis: Invalid Residue 0");--a}this._books=new Array(this._classifications),i=0;let u,c=0;for(let h=0;h<this._classifications;h++)if(u=El.ilog(this._cascade[h]),this._books[h]=new Array(u),u>0){c=Math.max(c,u);for(let d=0;d<u;d++)(this._cascade[h]&1<<d)>0&&(this._books[h][d]=n[r[i++]])}this._maxStages=c,this._decodeMap=new Array(l);for(let h=0;h<l;h++){let d=h,p=l/this._classifications|0;this._decodeMap[h]=new Int32Array(this._classBook.dimensions);for(let g=0;g<this._classBook.dimensions;g++){const m=d/p|0;d-=m*p,p=p/this._classifications|0,this._decodeMap[h][g]=m}}this._channels=t}static icount(e){let t=0;for(;0!==e;)t+=1&e,e>>=1;return t}decode(e,t,n,i){const o=(this._end<n/2?this._end:n/2)-this._begin;if(o>0&&-1!==t.indexOf(!1)){const a=o/this._partitionSize,l=(a+this._classBook.dimensions-1)/this._classBook.dimensions|0,c=[];for(let u=0;u<this._channels;u++)c.push(new Array(l));for(let u=0;u<this._maxStages;u++)for(let h=0,d=0;h<a;d++){if(0===u)for(let p=0;p<this._channels;p++){const g=this._classBook.decodeScalar(e);if(!(g>=0&&g<this._decodeMap.length)){h=a,u=this._maxStages;break}c[p][d]=this._decodeMap[g]}for(let p=0;h<a&&p<this._classBook.dimensions;p++,h++){const g=this._begin+h*this._partitionSize;for(let m=0;m<this._channels;m++){const _=c[m][d][p];if(this._cascade[_]&1<<u){const y=this._books[_][u];if(y&&this.writeVectors(y,e,i,m,g,this._partitionSize)){h=a,u=this._maxStages;break}}}}}}}writeVectors(e,t,n,i,r,o){const a=n[i],l=o/e.dimensions,c=new Int32Array(l);for(let u=0;u<l;u++)if(c[u]=e.decodeScalar(t),-1===c[u])return!0;for(let u=0;u<e.dimensions;u++)for(let h=0;h<l;h++,r++)a[r]+=e.get(c[h],u);return!1}}class Tne extends Xg{writeVectors(e,t,n,i,r,o){const a=n[i];for(let l=0;l<o;){const c=e.decodeScalar(t);if(-1===c)return!0;for(let u=0;u<e.dimensions;l++,u++)a[r+l]+=e.get(c,u)}return!1}}class kne extends Xg{constructor(e,t,n){super(e,1,n),this._realChannels=t}decode(e,t,n,i){super.decode(e,t,n*this._realChannels,i)}writeVectors(e,t,n,i,r,o){let a=0;r/=this._realChannels;for(let l=0;l<o;){const c=e.decodeScalar(t);if(-1===c)return!0;for(let u=0;u<e.dimensions;u++,l++)n[a][r]+=e.get(c,u),++a===this._realChannels&&(a=0,r++)}return!1}}class Cne{constructor(e,t,n){const i=e.readBits(16);switch(i){case 0:this.residue=new Xg(e,t,n);break;case 1:this.residue=new Tne(e,t,n);break;case 2:this.residue=new kne(e,t,n);break;default:throw new rn(un.Format,`Vorbis: Invalid Residue type: ${i}`)}}decode(e,t,n,i){this.residue.decode(e,t,n,i)}}class Dne{constructor(e,t,n,i,r){if(0!==e.readBits(16))throw new rn(un.Format,"Vorbis: Invalid mapping type!");let a=1;e.readBit()&&(a+=e.readBits(4));let l=0;e.readBit()&&(l=e.readBits(8)+1);const c=El.ilog(t-1);this._couplingAngle=new Int32Array(l),this._couplingMangitude=new Int32Array(l);for(let h=0;h<l;h++){const d=e.readBits(c),p=e.readBits(c);if(d===p||d>t-1||p>t-1)throw new rn(un.Format,"Vorbis: Invalid magnitude or angle in mapping header!");this._couplingAngle[h]=p,this._couplingMangitude[h]=d}if(0!==e.readBits(2))throw new rn(un.Format,"Vorbis: Reserved bits not 0 in mapping header.");const u=new Int32Array(t);if(a>1)for(let h=0;h<t;h++)if(u[h]=e.readBits(4),u[h]>a)throw new rn(un.Format,"Vorbis: Invalid channel mux submap index in mapping header!");this._submapFloor=new Array(a),this._submapResidue=new Array(a);for(let h=0;h<a;h++){e.skipBits(8);const d=e.readBits(8);if(d>=n.length)throw new rn(un.Format,"Vorbis: Invalid floor number in mapping header!");const p=e.readBits(8);if(p>=i.length)throw new rn(un.Format,"Vorbis: Invalid residue number in mapping header!");this._submapFloor[h]=n[d],this._submapResidue[h]=i[p]}this._channelFloor=new Array(t),this._channelResidue=new Array(t);for(let h=0;h<t;h++)this._channelFloor[h]=this._submapFloor[u[h]],this._channelResidue[h]=this._submapResidue[u[h]];this._mdct=r}decodePacket(e,t,n){const i=t>>1,r=new Array(this._channelFloor.length),o=new Array(this._channelFloor.length);o.fill(!1);for(let a=0;a<this._channelFloor.length;a++)r[a]=this._channelFloor[a].unpack(e,t,a),o[a]=!r[a].executeChannel,n[a].fill(0,0,i);for(let a=0;a<this._couplingAngle.length;a++)(r[this._couplingAngle[a]].executeChannel||r[this._couplingMangitude[a]].executeChannel)&&(r[this._couplingAngle[a]].forceEnergy=!0,r[this._couplingMangitude[a]].forceEnergy=!0);for(let a=0;a<this._submapFloor.length;a++){for(let l=0;l<this._channelFloor.length;l++)(this._submapFloor[a]!==this._channelFloor[l]||this._submapResidue[a]!==this._channelResidue[l])&&(r[l].forceNoEnergy=!0);this._submapResidue[a].decode(e,o,t,n)}for(let a=this._couplingAngle.length-1;a>=0;a--)if(r[this._couplingAngle[a]].executeChannel||r[this._couplingMangitude[a]].executeChannel){const l=n[this._couplingMangitude[a]],c=n[this._couplingAngle[a]];for(let u=0;u<i;u++){let h,d;const p=l[u],g=c[u];p>0?g>0?(h=p,d=p-g):(d=p,h=p+g):g>0?(h=p,d=p+g):(d=p,h=p-g),l[u]=h,c[u]=d}}for(let a=0;a<this._channelFloor.length;a++)r[a].executeChannel?(this._channelFloor[a].apply(r[a],t,n[a]),this._mdct.reverse(n[a],t)):n[a].fill(0,i,2*i)}}class B2{constructor(){this.packetStartIndex=0,this.packetTotalLength=0,this.packetValidLength=0}}class xne{constructor(){this.overlapInfo=new B2,this.windowIndex=0}}class Nne{constructor(e=null){this.samplePosition=null,this.samplePosition=e}}let Ene=(()=>{class s{constructor(t,n,i,r,o){if(this._overlapInfo=null,this._channels=n,this._blockFlag=t.readBit(),0!==t.readBits(32))throw new rn(un.Format,"Vorbis: Mode header had invalid window or transform type!");const a=t.readBits(8);if(a>=o.length)throw new rn(un.Format,"Vorbis: Mode header had invalid mapping index!");this._mapping=o[a],this._blockFlag?(this._blockSize=r,this._windows=[s.calcWindow(i,r,i),s.calcWindow(r,r,i),s.calcWindow(i,r,r),s.calcWindow(r,r,r)],this._overlapInfo=[s.calcOverlap(i,r,i),s.calcOverlap(r,r,i),s.calcOverlap(i,r,r),s.calcOverlap(r,r,r)]):(this._blockSize=i,this._windows=[s.calcWindow(i,i,i)])}decode(t,n){const i=this.getPacketInfo(t);this._mapping.decodePacket(t,this._blockSize,n);const r=this._windows[i.windowIndex];for(let o=0;o<this._blockSize;o++)for(let a=0;a<this._channels;a++)n[a][o]*=r[o];return i.overlapInfo}getPacketInfo(t){const n=new xne;if(this._blockFlag){const i=t.readBit(),r=t.readBit();n.windowIndex=(i?1:0)+(r?2:0);const o=this._overlapInfo[n.windowIndex];n.overlapInfo.packetStartIndex=o.packetStartIndex,n.overlapInfo.packetValidLength=o.packetValidLength,n.overlapInfo.packetTotalLength=o.packetTotalLength}else n.windowIndex=0,n.overlapInfo.packetStartIndex=0,n.overlapInfo.packetValidLength=this._blockSize/2,n.overlapInfo.packetTotalLength=this._blockSize;return n}static calcWindow(t,n,i){const r=new Float32Array(n),o=t/2,l=i/2,c=n/4-o/2,u=n-n/4-l/2;for(let h=0;h<o;h++){let d=Math.sin((h+.5)/o*s.M_PI2);d*=d,r[c+h]=Math.sin(d*s.M_PI2)}for(let h=c+o;h<u;h++)r[h]=1;for(let h=0;h<l;h++){let d=Math.sin((l-h-.5)/l*s.M_PI2);d*=d,r[u+h]=Math.sin(d*s.M_PI2)}return r}static calcOverlap(t,n,i){const o=i/4,a=n/4-t/4,l=n/4*3+o,c=l-2*o,u=new B2;return u.packetStartIndex=a,u.packetValidLength=c,u.packetTotalLength=l,u}}return s.M_PI2=1.57079632695,s})(),Ine=(()=>{class s{constructor(t){this._n=t,this._n2=t>>1,this._n4=this._n2>>1,this._n8=this._n4>>1,this._ld=El.ilog(t)-1,this._a=new Float32Array(this._n2),this._b=new Float32Array(this._n2),this._c=new Float32Array(this._n4);let n=0,i=0;for(;n<this._n4;++n,i+=2)this._a[i]=Math.cos(4*n*s.M_PI/t),this._a[i+1]=-Math.sin(4*n*s.M_PI/t),this._b[i]=.5*Math.cos((i+1)*s.M_PI/t/2),this._b[i+1]=.5*Math.sin((i+1)*s.M_PI/t/2);for(n=0,i=0;n<this._n8;++n,i+=2)this._c[i]=Math.cos(2*(i+1)*s.M_PI/t),this._c[i+1]=-Math.sin(2*(i+1)*s.M_PI/t);this._bitrev=new Uint16Array(this._n8);for(let r=0;r<this._n8;++r)this._bitrev[r]=Xe.int32ToUint16(El.bitReverse(r,this._ld-3)<<2)}calcReverse(t){let n,i;const r=new Float32Array(this._n2);{let a=this._n2-2,l=0,c=0;const u=this._n2;for(;c!==u;)r[a+1]=t[c]*this._a[l]-t[c+2]*this._a[l+1],r[a]=t[c]*this._a[l+1]+t[c+2]*this._a[l],a-=2,l+=2,c+=4;for(c=this._n2-3;a>=0;)r[a+1]=-t[c+2]*this._a[l]- -t[c]*this._a[l+1],r[a]=-t[c+2]*this._a[l+1]+-t[c]*this._a[l],a-=2,l+=2,c-=4}n=t,i=r;{let a=this._n2-8,l=this._n4,c=0,u=this._n4,h=0;for(;a>=0;){let d,p;p=i[l+1]-i[c+1],d=i[l]-i[c],n[u+1]=i[l+1]+i[c+1],n[u]=i[l]+i[c],n[h+1]=p*this._a[a+4]-d*this._a[a+5],n[h]=d*this._a[a+4]+p*this._a[a+5],p=i[l+3]-i[c+3],d=i[l+2]-i[c+2],n[u+3]=i[l+3]+i[c+3],n[u+2]=i[l+2]+i[c+2],n[h+3]=p*this._a[a]-d*this._a[a+1],n[h+2]=d*this._a[a]+p*this._a[a+1],a-=8,u+=4,h+=4,l+=4,c+=4}}this.step3_iter0_loop(this._n>>4,n,this._n2-1-0*this._n4,-this._n8),this.step3_iter0_loop(this._n>>4,n,this._n2-1-1*this._n4,-this._n8),this.step3_inner_r_loop(this._n>>5,n,this._n2-1-0*this._n8,-(this._n>>4),16),this.step3_inner_r_loop(this._n>>5,n,this._n2-1-1*this._n8,-(this._n>>4),16),this.step3_inner_r_loop(this._n>>5,n,this._n2-1-2*this._n8,-(this._n>>4),16),this.step3_inner_r_loop(this._n>>5,n,this._n2-1-3*this._n8,-(this._n>>4),16);let o=2;for(;o<this._ld-3>>1;++o){const a=this._n>>o+2,l=a>>1,c=1<<o+1;for(let u=0;u<c;++u)this.step3_inner_r_loop(this._n>>o+4,n,this._n2-1-a*u,-l,1<<o+3)}for(;o<this._ld-6;++o){const a=this._n>>o+2,l=1<<o+3,c=a>>1,h=1<<o+1;let d=this._n2-1,p=0;for(let g=this._n>>o+6;g>0;--g)this.step3_inner_s_loop(h,n,d,-c,p,l,a),p+=4*l,d-=8}this.step3_inner_s_loop_ld654(this._n>>5,n,this._n2-1,this._n);{let a=0,l=this._n4-4,c=this._n2-4;for(;l>=0;){let u;u=this._bitrev[a],i[c+3]=n[u],i[c+2]=n[u+1],i[l+3]=n[u+2],i[l+2]=n[u+3],u=this._bitrev[a+1],i[c+1]=n[u],i[c]=n[u+1],i[l+1]=n[u+2],i[l]=n[u+3],l-=4,c-=4,a+=2}}{let a=0,l=0,c=this._n2-4;for(;l<c;){let u,h,d,p,g,m;u=i[l]-i[c+2],h=i[l+1]+i[c+3],d=this._c[a+1]*u+this._c[a]*h,p=this._c[a+1]*h-this._c[a]*u,g=i[l]+i[c+2],m=i[l+1]-i[c+3],i[l]=g+d,i[l+1]=m+p,i[c+2]=g-d,i[c+3]=p-m,u=i[l+2]-i[c],h=i[l+3]+i[c+1],d=this._c[a+3]*u+this._c[a+2]*h,p=this._c[a+3]*h-this._c[a+2]*u,g=i[l+2]+i[c],m=i[l+3]-i[c+1],i[l+2]=g+d,i[l+3]=m+p,i[c]=g-d,i[c+1]=p-m,a+=4,l+=4,c-=4}}{let a=this._n2-8,l=this._n2-8,c=0,u=this._n2-4,h=this._n2,d=this._n-4;for(;l>=0;){let p,g,m,_;_=r[l+6]*this._b[a+7]-r[l+7]*this._b[a+6],m=-r[l+6]*this._b[a+6]-r[l+7]*this._b[a+7],t[c]=_,t[u+3]=-_,t[h]=m,t[d+3]=m,g=r[l+4]*this._b[a+5]-r[l+5]*this._b[a+4],p=-r[l+4]*this._b[a+4]-r[l+5]*this._b[a+5],t[c+1]=g,t[u+2]=-g,t[h+1]=p,t[d+2]=p,_=r[l+2]*this._b[a+3]-r[l+3]*this._b[a+2],m=-r[l+2]*this._b[a+2]-r[l+3]*this._b[a+3],t[c+2]=_,t[u+1]=-_,t[h+2]=m,t[d+1]=m,g=r[l]*this._b[a+1]-r[l+1]*this._b[a],p=-r[l]*this._b[a]-r[l+1]*this._b[a+1],t[c+3]=g,t[u]=-g,t[h+3]=p,t[d]=p,a-=8,l-=8,c+=4,h+=4,u-=4,d-=4}}}step3_inner_r_loop(t,n,i,r,o){let a,l,c=i,u=c+r,h=0;for(let d=t>>2;d>0;--d)a=n[c]-n[u],l=n[c-1]-n[u-1],n[c]+=n[u],n[c-1]+=n[u-1],n[u]=a*this._a[h]-l*this._a[h+1],n[u-1]=l*this._a[h]+a*this._a[h+1],h+=o,a=n[c-2]-n[u-2],l=n[c-3]-n[u-3],n[c-2]+=n[u-2],n[c-3]+=n[u-3],n[u-2]=a*this._a[h]-l*this._a[h+1],n[u-3]=l*this._a[h]+a*this._a[h+1],h+=o,a=n[c-4]-n[u-4],l=n[c-5]-n[u-5],n[c-4]+=n[u-4],n[c-5]+=n[u-5],n[u-4]=a*this._a[h]-l*this._a[h+1],n[u-5]=l*this._a[h]+a*this._a[h+1],h+=o,a=n[c-6]-n[u-6],l=n[c-7]-n[u-7],n[c-6]+=n[u-6],n[c-7]+=n[u-7],n[u-6]=a*this._a[h]-l*this._a[h+1],n[u-7]=l*this._a[h]+a*this._a[h+1],h+=o,c-=8,u-=8}step3_iter0_loop(t,n,i,r){let o=i,a=o+r,l=0;for(let c=t>>2;c>0;--c){let u,h;u=n[o]-n[a],h=n[o-1]-n[a-1],n[o]+=n[a],n[o-1]+=n[a-1],n[a]=u*this._a[l]-h*this._a[l+1],n[a-1]=h*this._a[l]+u*this._a[l+1],l+=8,u=n[o-2]-n[a-2],h=n[o-3]-n[a-3],n[o-2]+=n[a-2],n[o-3]+=n[a-3],n[a-2]=u*this._a[l]-h*this._a[l+1],n[a-3]=h*this._a[l]+u*this._a[l+1],l+=8,u=n[o-4]-n[a-4],h=n[o-5]-n[a-5],n[o-4]+=n[a-4],n[o-5]+=n[a-5],n[a-4]=u*this._a[l]-h*this._a[l+1],n[a-5]=h*this._a[l]+u*this._a[l+1],l+=8,u=n[o-6]-n[a-6],h=n[o-7]-n[a-7],n[o-6]+=n[a-6],n[o-7]+=n[a-7],n[a-6]=u*this._a[l]-h*this._a[l+1],n[a-7]=h*this._a[l]+u*this._a[l+1],l+=8,o-=8,a-=8}}step3_inner_s_loop(t,n,i,r,o,a,l){const c=this._a[o],u=this._a[o+1],h=this._a[o+a],d=this._a[o+a+1],p=this._a[o+2*a],g=this._a[o+2*a+1],m=this._a[o+3*a],_=this._a[o+3*a+1];let y,b,S=i,D=S+r;for(let T=t;T>0;--T)y=n[S]-n[D],b=n[S-1]-n[D-1],n[S]+=n[D],n[S-1]+=n[D-1],n[D]=y*c-b*u,n[D-1]=b*c+y*u,y=n[S-2]-n[D-2],b=n[S-3]-n[D-3],n[S-2]+=n[D-2],n[S-3]+=n[D-3],n[D-2]=y*h-b*d,n[D-3]=b*h+y*d,y=n[S-4]-n[D-4],b=n[S-5]-n[D-5],n[S-4]+=n[D-4],n[S-5]+=n[D-5],n[D-4]=y*p-b*g,n[D-5]=b*p+y*g,y=n[S-6]-n[D-6],b=n[S-7]-n[D-7],n[S-6]+=n[D-6],n[S-7]+=n[D-7],n[D-6]=y*m-b*_,n[D-7]=b*m+y*_,S-=l,D-=l}step3_inner_s_loop_ld654(t,n,i,r){const a=this._a[r>>3];let l=i;const c=l-16*t;for(;l>c;){let u,h;u=n[l]-n[l-8],h=n[l-1]-n[l-9],n[l]+=n[l-8],n[l-1]+=n[l-9],n[l-8]=u,n[l-9]=h,u=n[l-2]-n[l-10],h=n[l-3]-n[l-11],n[l-2]+=n[l-10],n[l-3]+=n[l-11],n[l-10]=(u+h)*a,n[l-11]=(h-u)*a,u=n[l-12]-n[l-4],h=n[l-5]-n[l-13],n[l-4]+=n[l-12],n[l-5]+=n[l-13],n[l-12]=h,n[l-13]=u,u=n[l-14]-n[l-6],h=n[l-7]-n[l-15],n[l-6]+=n[l-14],n[l-7]+=n[l-15],n[l-14]=(u+h)*a,n[l-15]=(u-h)*a,this.iter_54(n,l),this.iter_54(n,l-8),l-=16}}iter_54(t,n){const i=t[n]-t[n-4],r=t[n]+t[n-4],o=t[n-2]+t[n-6],a=t[n-2]-t[n-6];t[n]=r+o,t[n-2]=r-o;const l=t[n-3]-t[n-7];t[n-4]=i+l,t[n-6]=i-l;const c=t[n-1]-t[n-5],u=t[n-1]+t[n-5],h=t[n-3]+t[n-7];t[n-1]=u+h,t[n-3]=u-h,t[n-5]=c-a,t[n-7]=c+a}}return s.M_PI=3.141592653589793,s})();class Bne{constructor(){this._setupCache=new Map}reverse(e,t){let n;this._setupCache.has(t)?n=this._setupCache.get(t):(n=new Ine(t),this._setupCache.set(t,n)),n.calcReverse(e)}}class UD{constructor(e,t,n){this._packetIndex=0,this._stream=e,this._setup=t,this._packets=n,this._currentPosition=0,this._prevPacketBuf=null,this._prevPacketStart=0,this._prevPacketEnd=0,this._prevPacketStop=0,this._nextPacketBuf=null,this._eosFound=!1,this._hasPosition=!1,this._modeFieldBits=El.ilog(t.modes.length-1)}decode(){let e=new Float32Array(this._packets[this._packets.length-1].granulePosition*this._stream.audioChannels);const t=new Float32Array(.2*this._stream.audioSampleRate*this._stream.audioChannels);let n=0,i=0;for(;n=this.read(t,0,t.length),0!==n;){if(i+n>=e.length){const r=new Float32Array(e.length+t.length);r.set(e,0),e=r}e.set(t.subarray(0,n),i),i+=n}return e.subarray(0,i)}read(e,t,n){if(0===n)return 0;let i=t;const r=t+n;for(;i<r;){if(this._prevPacketStart===this._prevPacketEnd){if(this._eosFound){this._nextPacketBuf=null,this._prevPacketBuf=null;break}const a=this.readNextPacket((i-t)/this._stream.audioChannels);null===a&&(this._prevPacketEnd=this._prevPacketStop),null!==a&&null!==a.samplePosition&&!this._hasPosition&&(this._hasPosition=!0,this._currentPosition=a.samplePosition-(this._prevPacketEnd-this._prevPacketStart)-(i-t)/this._stream.audioChannels)}const o=Math.min((r-i)/this._stream.audioChannels,this._prevPacketEnd-this._prevPacketStart);o>0&&(i+=this.copyBuffer(e,i,o))}return this._currentPosition+=(n=i-t)/this._stream.audioChannels,n}copyBuffer(e,t,n){let i=t;for(;n>0;this._prevPacketStart++,n--)for(let r=0;r<this._stream.audioChannels;r++)e[i++]=this._prevPacketBuf[r][this._prevPacketStart];return i-t}readNextPacket(e){const t=this.decodeNextPacket();if(this._eosFound=this._eosFound||t.isEndOfStream,null==t.curPacket)return null;if(null!==t.samplePosition&&t.isEndOfStream){const i=t.samplePosition-(this._currentPosition+e+t.validLen-t.startIndex);i<0&&(t.validLen+=i,t.validLen<0&&(t.validLen=0))}return this._prevPacketEnd>0?(UD.overlapBuffers(this._prevPacketBuf,t.curPacket,this._prevPacketStart,this._prevPacketStop,t.startIndex,this._stream.audioChannels),this._prevPacketStart=t.startIndex):null==this._prevPacketBuf&&(this._prevPacketStart=t.validLen),this._nextPacketBuf=this._prevPacketBuf,this._prevPacketEnd=t.validLen,this._prevPacketStop=t.totalLen,this._prevPacketBuf=t.curPacket,new Nne(t.samplePosition)}static overlapBuffers(e,t,n,i,r,o){for(;n<i;n++,r++)for(let a=0;a<o;a++)t[a][r]+=e[a][n]}decodeNextPacket(){const e=new Mne;let t=null;if(this._packetIndex>=this._packets.length)e.isEndOfStream=!0;else{t=this._packets[this._packetIndex++];const n=new I2(ps.fromBuffer(t.packetData));if(e.isEndOfStream=t.isEndOfStream,!n.readBit()){const i=this._setup.modes[n.readBits(this._modeFieldBits)];if(null==this._nextPacketBuf){this._nextPacketBuf=new Array(this._stream.audioChannels);for(let o=0;o<this._stream.audioChannels;o++)this._nextPacketBuf[o]=new Float32Array(this._stream.blocksize1)}const r=i.decode(n,this._nextPacketBuf);return e.startIndex=r.packetStartIndex,e.validLen=r.packetValidLength,e.totalLen=r.packetTotalLength,e.samplePosition=t.granulePosition,e.curPacket=this._nextPacketBuf,e}}return e}}class Mne{constructor(){this.curPacket=null,this.startIndex=0,this.validLen=0,this.totalLen=0,this.isEndOfStream=!1,this.samplePosition=null}}var aw=function(s){return s[s.IdentificationHeader=1]="IdentificationHeader",s[s.Comment=3]="Comment",s[s.SetupHeader=5]="SetupHeader",s}(aw||{});class yc{constructor(e){this._packetIndex=-1,this._packets=e}read(){let e;for(;;){if(e=this.nextPacket(),null==e)return null;if(e.isBeginningOfStream){const t=this.readStream(e);if(null!=t)return t}}}nextPacket(){return this._packetIndex++,this._packetIndex<this._packets.length?this._packets[this._packetIndex]:null}readStream(e){const t=new fne;if(!this.readIdentificationHeader(t,e)||!this.readComments(this.nextPacket()))return null;const n=new pne;if(!this.readSetupHeader(t,n,this.nextPacket()))return null;const i=[];let r;for(;r=this.nextPacket(),null!=r&&(i.push(r),!r.isEndOfStream););const o=new UD(t,n,i);return t.samples=o.decode(),t}comonHeaderDecode(e,t){const n=new Uint8Array(7);if(t.read(n,0,n.length),n[0]!==e)return!1;for(let i=0;i<yc.VorbisHeaderMarker.length;i++)if(n[1+i]!==yc.VorbisHeaderMarker[i])return!1;return!0}comonHeaderDecodeBit(e,t){const n=t.readBytes(7);if(n[0]!==e)return!1;for(let i=0;i<yc.VorbisHeaderMarker.length;i++)if(n[1+i]!==yc.VorbisHeaderMarker[i])return!1;return!0}readIdentificationHeader(e,t){const n=ps.fromBuffer(t.packetData);if(!this.comonHeaderDecode(aw.IdentificationHeader,n)||0!==N.readUInt32LE(n)||(e.audioChannels=n.readByte(),e.audioSampleRate=N.readUInt32LE(n),e.audioChannels<=0||e.audioSampleRate<=0))return!1;e.bitrateMaximum=N.readInt32LE(n),e.bitrateNominal=N.readInt32LE(n),e.bitrateMinimum=N.readInt32LE(n);const r=n.readByte();return e.blocksize0=1<<(15&r),e.blocksize1=1<<(r>>4),!(e.blocksize0>e.blocksize1||!yc.isAllowedBlockSize(e.blocksize0)||!yc.isAllowedBlockSize(e.blocksize0)||0===n.readByte())}static isAllowedBlockSize(e){switch(e){case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:return!0;default:return!1}}readComments(e){if(null==e)return!1;const t=ps.fromBuffer(e.packetData);if(!this.comonHeaderDecode(aw.Comment,t))return!1;const n=N.readUInt32LE(t);t.skip(n);const i=N.readUInt32LE(t);for(let o=0;o<i;o++){const a=N.readUInt32LE(t);t.skip(a)}return 0!==t.readByte()}readSetupHeader(e,t,n){if(null==n)return!1;const i=new I2(ps.fromBuffer(n.packetData)),r=new Bne,o=new _ne;if(!this.comonHeaderDecodeBit(aw.SetupHeader,i))return!1;let a=i.readByte()+1;for(let l=0;l<a;l++)t.codebooks.push(new mne(i,o));a=i.readBits(6)+1;for(let l=0;l<a;l++)t.timeDomainTransforms.push(new bne(i));a=i.readBits(6)+1;for(let l=0;l<a;l++)t.floors.push(new vne(i,e.blocksize0,e.blocksize1,t.codebooks));a=i.readBits(6)+1;for(let l=0;l<a;l++)t.residues.push(new Cne(i,e.audioChannels,t.codebooks));a=i.readBits(6)+1;for(let l=0;l<a;l++)t.mappings.push(new Dne(i,e.audioChannels,t.floors,t.residues,r));a=i.readBits(6)+1;for(let l=0;l<a;l++)t.modes.push(new Ene(i,e.audioChannels,e.blocksize0,e.blocksize1,t.mappings));return!!i.readBit()}}yc.VorbisHeaderMarker=new Uint8Array([118,111,114,98,105,115]);class Pne{constructor(e){this.streams=[];const n=new dne(e).read(),i=new yc(n);for(;;){const r=i.read();if(null==r)break;this.streams.push(r)}}}class M2{constructor(){this.phdrs=[],this.pbags=[],this.pmods=[],this.pgens=[],this.insts=[],this.ibags=[],this.imods=[],this.igens=[],this.sHdrs=[],this.sampleData=new Uint8Array(0),this._sampleCache=new Map}decodeSamples(e,t,n){const i=`${e}_${t}_${n}`;if(!this._sampleCache.has(i)){let r;const o=this.sampleData.slice(e,t);if(n)r=new Pne(ps.fromBuffer(o)).streams[0].samples;else{const a=new DataView(o.buffer,o.byteOffset,o.length);r=new Float32Array(o.length/2);for(let l=0;l<r.length;l++)r[l]=a.getInt16(2*l,!0)/32767}return this._sampleCache.set(i,r),r}return this._sampleCache.get(i)}load(e){const t=new Oh,n=new Oh;if(!Oh.load(null,t,e)||"sfbk"!==t.id)throw new oi("Soundfont is not a valid Soundfont2 file");for(;Oh.load(t,n,e);){const i=new Oh;if("pdta"===n.id)for(;Oh.load(n,i,e);)switch(i.id){case"phdr":for(let r=0,o=i.size/L2.SizeInFile|0;r<o;r++)this.phdrs.push(new L2(e));break;case"pbag":for(let r=0,o=i.size/O2.SizeInFile|0;r<o;r++)this.pbags.push(new O2(e));break;case"pmod":for(let r=0,o=i.size/V2.SizeInFile|0;r<o;r++)this.pmods.push(new V2(e));break;case"pgen":for(let r=0,o=i.size/_c.SizeInFile|0;r<o;r++)this.pgens.push(new _c(e));break;case"inst":for(let r=0,o=i.size/F2.SizeInFile|0;r<o;r++)this.insts.push(new F2(e));break;case"ibag":for(let r=0,o=i.size/P2.SizeInFile|0;r<o;r++)this.ibags.push(new P2(e));break;case"imod":for(let r=0,o=i.size/A2.SizeInFile|0;r<o;r++)this.imods.push(new A2(e));break;case"igen":for(let r=0,o=i.size/R2.SizeInFile|0;r<o;r++)this.igens.push(new R2(e));break;case"shdr":for(let r=0,o=i.size/H2.SizeInFile|0;r<o;r++)this.sHdrs.push(new H2(e));break;default:e.position+=i.size}else if("sdta"===n.id)for(;Oh.load(n,i,e);)"smpl"===i.id?(this.sampleData=new Uint8Array(i.size),e.read(this.sampleData,0,i.size)):e.position+=i.size;else e.position+=n.size}}}let P2=(()=>{class s{constructor(t){this.instGenNdx=N.readUInt16LE(t),this.instModNdx=N.readUInt16LE(t)}}return s.SizeInFile=4,s})(),A2=(()=>{class s{constructor(t){this.modSrcOper=N.readUInt16LE(t),this.modDestOper=N.readUInt16LE(t),this.modAmount=N.readInt16LE(t),this.modAmtSrcOper=N.readUInt16LE(t),this.modTransOper=N.readUInt16LE(t)}}return s.SizeInFile=10,s})(),R2=(()=>{class s{constructor(t){this.genOper=N.readUInt16LE(t),this.genAmount=new W2(t)}}return s.SizeInFile=4,s})(),F2=(()=>{class s{constructor(t){this.instName=N.read8BitStringLength(t,20),this.instBagNdx=N.readUInt16LE(t)}}return s.SizeInFile=22,s})(),O2=(()=>{class s{constructor(t){this.genNdx=N.readUInt16LE(t),this.modNdx=N.readUInt16LE(t)}}return s.SizeInFile=4,s})(),_c=(()=>{class s{constructor(t){this.genOper=N.readUInt16LE(t),this.genAmount=new W2(t)}}return s.SizeInFile=4,s.GenInstrument=41,s.GenKeyRange=43,s.GenVelRange=44,s.GenSampleId=53,s})(),L2=(()=>{class s{constructor(t){this.presetName=N.read8BitStringLength(t,20),this.preset=N.readUInt16LE(t),this.bank=N.readUInt16LE(t),this.presetBagNdx=N.readUInt16LE(t),this.library=N.readUInt32LE(t),this.genre=N.readUInt32LE(t),this.morphology=N.readUInt32LE(t)}}return s.SizeInFile=38,s})(),V2=(()=>{class s{constructor(t){this.modSrcOper=N.readUInt16LE(t),this.modDestOper=N.readUInt16LE(t),this.modAmount=N.readUInt16LE(t),this.modAmtSrcOper=N.readUInt16LE(t),this.modTransOper=N.readUInt16LE(t)}}return s.SizeInFile=10,s})(),H2=(()=>{class s{constructor(t){this.sampleName=N.read8BitStringLength(t,20),this.start=N.readUInt32LE(t),this.end=N.readUInt32LE(t),this.startLoop=N.readUInt32LE(t),this.endLoop=N.readUInt32LE(t),this.sampleRate=N.readUInt32LE(t),this.originalPitch=t.readByte(),this.pitchCorrection=N.readSInt8(t),this.sampleLink=N.readUInt16LE(t),this.sampleType=N.readUInt16LE(t)}}return s.SizeInFile=46,s})();class W2{get shortAmount(){return Xe.uint16ToInt16(this.wordAmount)}get lowByteAmount(){return 255&this.wordAmount}get highByteAmount(){return(65280&this.wordAmount)>>8&255}constructor(e){this.wordAmount=N.readUInt16LE(e)}}class Ane{constructor(){this.presetIndex=0,this.bank=0,this.pitchWheel=0,this.perNotePitchWheel=new Map,this.midiPan=0,this.midiVolume=0,this.midiExpression=0,this.midiRpn=0,this.midiData=0,this.panOffset=0,this.gainDb=0,this.pitchRange=0,this.tuning=0,this.mixVolume=0,this.mute=!1,this.solo=!1}}class Rne{constructor(){this.activeChannel=0,this.channelList=[]}setupVoice(e,t){const n=this.channelList[this.activeChannel],i=t.region.pan+n.panOffset;t.playingChannel=this.activeChannel,t.mixVolume=n.mixVolume,t.noteGainDb+=n.gainDb,t.updatePitchRatio(n,e.outSampleRate),i<=-.5?(t.panFactorLeft=1,t.panFactorRight=0):i>=.5?(t.panFactorLeft=0,t.panFactorRight=1):(t.panFactorLeft=Math.sqrt(.5-i),t.panFactorRight=Math.sqrt(.5+i))}}var yu=function(s){return s[s.None=0]="None",s[s.Continuous=1]="Continuous",s[s.Sustain=2]="Sustain",s}(yu||{}),Nf=function(s){return s[s.StereoInterleaved=0]="StereoInterleaved",s[s.StereoUnweaved=1]="StereoUnweaved",s[s.Mono=2]="Mono",s}(Nf||{});class Fne{constructor(){this.name="",this.presetNumber=0,this.bank=0,this.regions=null}}class li{static timecents2Secs(e){return Math.pow(2,e/1200)}static decibelsToGain(e){return e>-100?Math.pow(10,.05*e):0}static gainToDecibels(e){return e<=1e-5?-100:20*Math.log10(e)}static cents2Hertz(e){return 8.176*Math.pow(2,e/1200)}}class Jg{constructor(e){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0,e&&(this.delay=e.delay,this.attack=e.attack,this.hold=e.hold,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.keynumToHold=e.keynumToHold,this.keynumToDecay=e.keynumToDecay)}clear(){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0}envToSecs(e){this.delay=this.delay<-11950?0:li.timecents2Secs(this.delay),this.attack=this.attack<-11950?0:li.timecents2Secs(this.attack),this.release=this.release<-11950?0:li.timecents2Secs(this.release),0===this.keynumToHold&&(this.hold=this.hold<-11950?0:li.timecents2Secs(this.hold)),0===this.keynumToDecay&&(this.decay=this.decay<-11950?0:li.timecents2Secs(this.decay)),this.sustain=this.sustain<0?0:e?li.decibelsToGain(-this.sustain/10):1-this.sustain/1e3}}var Kt=function(s){return s[s.StartAddrsOffset=0]="StartAddrsOffset",s[s.EndAddrsOffset=1]="EndAddrsOffset",s[s.StartloopAddrsOffset=2]="StartloopAddrsOffset",s[s.EndloopAddrsOffset=3]="EndloopAddrsOffset",s[s.StartAddrsCoarseOffset=4]="StartAddrsCoarseOffset",s[s.ModLfoToPitch=5]="ModLfoToPitch",s[s.VibLfoToPitch=6]="VibLfoToPitch",s[s.ModEnvToPitch=7]="ModEnvToPitch",s[s.InitialFilterFc=8]="InitialFilterFc",s[s.InitialFilterQ=9]="InitialFilterQ",s[s.ModLfoToFilterFc=10]="ModLfoToFilterFc",s[s.ModEnvToFilterFc=11]="ModEnvToFilterFc",s[s.EndAddrsCoarseOffset=12]="EndAddrsCoarseOffset",s[s.ModLfoToVolume=13]="ModLfoToVolume",s[s.Unused1=14]="Unused1",s[s.ChorusEffectsSend=15]="ChorusEffectsSend",s[s.ReverbEffectsSend=16]="ReverbEffectsSend",s[s.Pan=17]="Pan",s[s.Unused2=18]="Unused2",s[s.Unused3=19]="Unused3",s[s.Unused4=20]="Unused4",s[s.DelayModLFO=21]="DelayModLFO",s[s.FreqModLFO=22]="FreqModLFO",s[s.DelayVibLFO=23]="DelayVibLFO",s[s.FreqVibLFO=24]="FreqVibLFO",s[s.DelayModEnv=25]="DelayModEnv",s[s.AttackModEnv=26]="AttackModEnv",s[s.HoldModEnv=27]="HoldModEnv",s[s.DecayModEnv=28]="DecayModEnv",s[s.SustainModEnv=29]="SustainModEnv",s[s.ReleaseModEnv=30]="ReleaseModEnv",s[s.KeynumToModEnvHold=31]="KeynumToModEnvHold",s[s.KeynumToModEnvDecay=32]="KeynumToModEnvDecay",s[s.DelayVolEnv=33]="DelayVolEnv",s[s.AttackVolEnv=34]="AttackVolEnv",s[s.HoldVolEnv=35]="HoldVolEnv",s[s.DecayVolEnv=36]="DecayVolEnv",s[s.SustainVolEnv=37]="SustainVolEnv",s[s.ReleaseVolEnv=38]="ReleaseVolEnv",s[s.KeynumToVolEnvHold=39]="KeynumToVolEnvHold",s[s.KeynumToVolEnvDecay=40]="KeynumToVolEnvDecay",s[s.Instrument=41]="Instrument",s[s.Reserved1=42]="Reserved1",s[s.KeyRange=43]="KeyRange",s[s.VelRange=44]="VelRange",s[s.StartloopAddrsCoarseOffset=45]="StartloopAddrsCoarseOffset",s[s.Keynum=46]="Keynum",s[s.Velocity=47]="Velocity",s[s.InitialAttenuation=48]="InitialAttenuation",s[s.Reserved2=49]="Reserved2",s[s.EndloopAddrsCoarseOffset=50]="EndloopAddrsCoarseOffset",s[s.CoarseTune=51]="CoarseTune",s[s.FineTune=52]="FineTune",s[s.SampleID=53]="SampleID",s[s.SampleModes=54]="SampleModes",s[s.Reserved3=55]="Reserved3",s[s.ScaleTuning=56]="ScaleTuning",s[s.ExclusiveClass=57]="ExclusiveClass",s[s.OverridingRootKey=58]="OverridingRootKey",s[s.Unused5=59]="Unused5",s[s.EndOper=60]="EndOper",s}(Kt||{});class Il{constructor(e){this.loopMode=yu.None,this.samples=Il.NoSamples,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv=new Jg,this.modEnv=new Jg,this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,e&&(this.loopMode=e.loopMode,this.samples=e.samples,this.sampleRate=e.sampleRate,this.loKey=e.loKey,this.hiKey=e.hiKey,this.loVel=e.loVel,this.hiVel=e.hiVel,this.group=e.group,this.offset=e.offset,this.end=e.end,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.transpose=e.transpose,this.tune=e.tune,this.pitchKeyCenter=e.pitchKeyCenter,this.pitchKeyTrack=e.pitchKeyTrack,this.attenuation=e.attenuation,this.pan=e.pan,this.ampEnv=new Jg(e.ampEnv),this.modEnv=new Jg(e.modEnv),this.initialFilterQ=e.initialFilterQ,this.initialFilterFc=e.initialFilterFc,this.modEnvToPitch=e.modEnvToPitch,this.modEnvToFilterFc=e.modEnvToFilterFc,this.modLfoToFilterFc=e.modLfoToFilterFc,this.modLfoToVolume=e.modLfoToVolume,this.delayModLFO=e.delayModLFO,this.freqModLFO=e.freqModLFO,this.modLfoToPitch=e.modLfoToPitch,this.delayVibLFO=e.delayVibLFO,this.freqVibLFO=e.freqVibLFO,this.vibLfoToPitch=e.vibLfoToPitch)}clear(e){this.loopMode=yu.None,this.samples=Il.NoSamples,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv.clear(),this.modEnv.clear(),this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,this.hiKey=127,this.hiVel=127,this.pitchKeyCenter=60,!e&&(this.pitchKeyTrack=100,this.pitchKeyCenter=-1,this.ampEnv.delay=-12e3,this.ampEnv.attack=-12e3,this.ampEnv.hold=-12e3,this.ampEnv.decay=-12e3,this.ampEnv.release=-12e3,this.modEnv.delay=-12e3,this.modEnv.attack=-12e3,this.modEnv.hold=-12e3,this.modEnv.decay=-12e3,this.modEnv.release=-12e3,this.initialFilterFc=13500,this.delayModLFO=-12e3,this.delayVibLFO=-12e3)}operator(e,t){switch(e){case Kt.StartAddrsOffset:this.offset+=Xe.int16ToUint32(t.shortAmount);break;case Kt.EndAddrsOffset:this.end+=Xe.int16ToUint32(t.shortAmount);break;case Kt.StartloopAddrsOffset:this.loopStart+=Xe.int16ToUint32(t.shortAmount);break;case Kt.EndloopAddrsOffset:this.loopEnd+=Xe.int16ToUint32(t.shortAmount);break;case Kt.StartAddrsCoarseOffset:this.offset+=32768*Xe.int16ToUint32(t.shortAmount);break;case Kt.ModLfoToPitch:this.modLfoToPitch=t.shortAmount;break;case Kt.VibLfoToPitch:this.vibLfoToPitch=t.shortAmount;break;case Kt.ModEnvToPitch:this.modEnvToPitch=t.shortAmount;break;case Kt.InitialFilterFc:this.initialFilterFc=t.shortAmount;break;case Kt.InitialFilterQ:this.initialFilterQ=t.shortAmount;break;case Kt.ModLfoToFilterFc:this.modLfoToFilterFc=t.shortAmount;break;case Kt.ModEnvToFilterFc:this.modEnvToFilterFc=t.shortAmount;break;case Kt.EndAddrsCoarseOffset:this.end+=32768*Xe.int16ToUint32(t.shortAmount);break;case Kt.ModLfoToVolume:this.modLfoToVolume=t.shortAmount;break;case Kt.Pan:this.pan=t.shortAmount/1e3;break;case Kt.DelayModLFO:this.delayModLFO=t.shortAmount;break;case Kt.FreqModLFO:this.freqModLFO=t.shortAmount;break;case Kt.DelayVibLFO:this.delayVibLFO=t.shortAmount;break;case Kt.FreqVibLFO:this.freqVibLFO=t.shortAmount;break;case Kt.DelayModEnv:this.modEnv.delay=t.shortAmount;break;case Kt.AttackModEnv:this.modEnv.attack=t.shortAmount;break;case Kt.HoldModEnv:this.modEnv.hold=t.shortAmount;break;case Kt.DecayModEnv:this.modEnv.decay=t.shortAmount;break;case Kt.SustainModEnv:this.modEnv.sustain=t.shortAmount;break;case Kt.ReleaseModEnv:this.modEnv.release=t.shortAmount;break;case Kt.KeynumToModEnvHold:this.modEnv.keynumToHold=t.shortAmount;break;case Kt.KeynumToModEnvDecay:this.modEnv.keynumToDecay=t.shortAmount;break;case Kt.DelayVolEnv:this.ampEnv.delay=t.shortAmount;break;case Kt.AttackVolEnv:this.ampEnv.attack=t.shortAmount;break;case Kt.HoldVolEnv:this.ampEnv.hold=t.shortAmount;break;case Kt.DecayVolEnv:this.ampEnv.decay=t.shortAmount;break;case Kt.SustainVolEnv:this.ampEnv.sustain=t.shortAmount;break;case Kt.ReleaseVolEnv:this.ampEnv.release=t.shortAmount;break;case Kt.KeynumToVolEnvHold:this.ampEnv.keynumToHold=t.shortAmount;break;case Kt.KeynumToVolEnvDecay:this.ampEnv.keynumToDecay=t.shortAmount;break;case Kt.KeyRange:this.loKey=t.lowByteAmount,this.hiKey=t.highByteAmount;break;case Kt.VelRange:this.loVel=t.lowByteAmount,this.hiVel=t.highByteAmount;break;case Kt.StartloopAddrsCoarseOffset:this.loopStart+=32768*Xe.int16ToUint32(t.shortAmount);break;case Kt.InitialAttenuation:this.attenuation+=.1*t.shortAmount;break;case Kt.EndloopAddrsCoarseOffset:this.loopEnd+=32768*Xe.int16ToUint32(t.shortAmount);break;case Kt.CoarseTune:this.transpose+=t.shortAmount;break;case Kt.FineTune:this.tune+=t.shortAmount;break;case Kt.SampleModes:this.loopMode=3&~t.wordAmount?1==(3&t.wordAmount)?yu.Continuous:yu.None:yu.Sustain;break;case Kt.ScaleTuning:this.pitchKeyTrack=t.shortAmount;break;case Kt.ExclusiveClass:this.group=t.wordAmount;break;case Kt.OverridingRootKey:this.pitchKeyCenter=t.shortAmount}}}Il.NoSamples=new Float32Array(0);var Yn=function(s){return s[s.None=0]="None",s[s.Delay=1]="Delay",s[s.Attack=2]="Attack",s[s.Hold=3]="Hold",s[s.Decay=4]="Decay",s[s.Sustain=5]="Sustain",s[s.Release=6]="Release",s[s.Done=7]="Done",s}(Yn||{});let G2=(()=>{class s{constructor(){this.level=0,this.slope=0,this.samplesUntilNextSegment=0,this.segment=Yn.None,this.midiVelocity=0,this.parameters=null,this.segmentIsExponential=!1,this.isAmpEnv=!1}nextSegment(t,n){if(this.parameters)for(;;)switch(t){case Yn.None:if(this.samplesUntilNextSegment=this.parameters.delay*n|0,this.samplesUntilNextSegment>0)return this.segment=Yn.Delay,this.segmentIsExponential=!1,this.level=0,void(this.slope=0);t=Yn.Delay;break;case Yn.Delay:if(this.samplesUntilNextSegment=this.parameters.attack*n|0,this.samplesUntilNextSegment>0)return this.isAmpEnv||(this.samplesUntilNextSegment=this.parameters.attack*((145-this.midiVelocity)/144)*n|0),this.segment=Yn.Attack,this.segmentIsExponential=!1,this.level=0,void(this.slope=1/this.samplesUntilNextSegment);t=Yn.Attack;break;case Yn.Attack:if(this.samplesUntilNextSegment=this.parameters.hold*n|0,this.samplesUntilNextSegment>0)return this.segment=Yn.Hold,this.segmentIsExponential=!1,this.level=1,void(this.slope=0);t=Yn.Hold;break;case Yn.Hold:if(this.samplesUntilNextSegment=this.parameters.decay*n|0,this.samplesUntilNextSegment>0){if(this.segment=Yn.Decay,this.level=1,this.isAmpEnv){const i=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(i),this.segmentIsExponential=!0,this.parameters.sustain>0&&(this.samplesUntilNextSegment=Math.log(this.parameters.sustain)/i|0)}else this.slope=-1/this.samplesUntilNextSegment,this.samplesUntilNextSegment=this.parameters.decay*(1-this.parameters.sustain)*n|0,this.segmentIsExponential=!1;return}t=Yn.Decay;break;case Yn.Decay:return this.segment=Yn.Sustain,this.level=this.parameters.sustain,this.slope=0,this.samplesUntilNextSegment=2147483647,void(this.segmentIsExponential=!1);case Yn.Sustain:return this.segment=Yn.Release,this.samplesUntilNextSegment=(this.parameters.release<=0?s.FastReleaseTime:this.parameters.release)*n|0,void(this.isAmpEnv?(this.slope=Math.exp(-9.226/this.samplesUntilNextSegment),this.segmentIsExponential=!0):(this.slope=-this.level/this.samplesUntilNextSegment,this.segmentIsExponential=!1));default:return this.segment=Yn.Done,this.segmentIsExponential=!1,this.level=0,this.slope=0,void(this.samplesUntilNextSegment=134217727)}}setup(t,n,i,r,o){this.parameters=new Jg(t),this.parameters.keynumToHold>0&&(this.parameters.hold+=this.parameters.keynumToHold*(60-n),this.parameters.hold=this.parameters.hold<-1e4?0:li.timecents2Secs(this.parameters.hold)),this.parameters.keynumToDecay>0&&(this.parameters.decay+=this.parameters.keynumToDecay*(60-n),this.parameters.decay=this.parameters.decay<-1e4?0:li.timecents2Secs(this.parameters.decay)),this.midiVelocity=0|i,this.isAmpEnv=r,this.nextSegment(Yn.None,o)}process(t,n){this.slope>0&&(this.segmentIsExponential?this.level*=Math.pow(this.slope,t):this.level+=this.slope*t),this.samplesUntilNextSegment-=t,this.samplesUntilNextSegment<=0&&this.nextSegment(this.segment,n)}}return s.FastReleaseTime=.01,s})();class U2{constructor(){this.samplesUntil=0,this.level=0,this.delta=0}setup(e,t,n){this.samplesUntil=e*n|0,this.delta=4*li.cents2Hertz(t)/n,this.level=0}process(e){this.samplesUntil>e?this.samplesUntil-=e:(this.level+=this.delta*e,this.level>1?(this.delta=-this.delta,this.level=2-this.level):this.level<-1&&(this.delta=-this.delta,this.level=-2-this.level))}}class z2{constructor(e){this.qInv=0,this.a0=0,this.a1=0,this.b1=0,this.b2=0,this.z1=0,this.z2=0,this.active=!1,e&&(this.qInv=e.qInv,this.a0=e.a0,this.a1=e.a1,this.b1=e.b1,this.b2=e.b2,this.z1=e.z1,this.z2=e.z2,this.active=e.active)}setup(e){const t=Math.tan(Math.PI*e),n=t*t,i=1/(1+t*this.qInv+n);this.a0=n*i,this.a1=2*this.a0,this.b1=2*(n-1)*i,this.b2=(1-t*this.qInv+n)*i}process(e){const t=e*this.a0+this.z1;return this.z1=e*this.a1+this.z2-this.b1*t,this.z2=e*this.a0-this.b2*t,t}}class Zg{constructor(){this.playingPreset=0,this.playingKey=0,this.playingChannel=0,this.region=null,this.pitchInputTimecents=0,this.pitchOutputFactor=0,this.sourceSamplePosition=0,this.noteGainDb=0,this.panFactorLeft=0,this.panFactorRight=0,this.playIndex=0,this.loopStart=0,this.loopEnd=0,this.ampEnv=new G2,this.modEnv=new G2,this.lowPass=new z2,this.modLfo=new U2,this.vibLfo=new U2,this.mixVolume=0,this.mute=!1}updatePitchRatio(e,t){let n=e.pitchWheel;e.perNotePitchWheel.has(this.playingKey)&&(n+=e.perNotePitchWheel.get(this.playingKey)-8192),this.calcPitchRatio(8192===n?e.tuning:n/16383*e.pitchRange*2-e.pitchRange+e.tuning,t)}calcPitchRatio(e,t){if(!this.region)return;let i=this.region.pitchKeyCenter+this.region.pitchKeyTrack/100*(this.playingKey+this.region.transpose+this.region.tune/100-this.region.pitchKeyCenter);0!==e&&(i+=e),this.pitchInputTimecents=100*i,this.pitchOutputFactor=this.region.sampleRate/(li.timecents2Secs(100*this.region.pitchKeyCenter)*t)}end(e){this.region&&(this.ampEnv.nextSegment(Yn.Sustain,e),this.modEnv.nextSegment(Yn.Sustain,e),this.region.loopMode===yu.Sustain&&(this.loopEnd=this.loopStart))}endQuick(e){this.ampEnv.parameters.release=0,this.ampEnv.nextSegment(Yn.Sustain,e),this.modEnv.parameters.release=0,this.modEnv.nextSegment(Yn.Sustain,e)}render(e,t,n,i,r){if(!this.region)return;const o=this.region,a=o.samples;let l=0,c=e.outputMode===Nf.StereoUnweaved?i:-1;const u=0!==o.modEnvToPitch||0!==o.modEnvToFilterFc,h=this.modLfo.delta>0&&(0!==o.modLfoToPitch||0!==o.modLfoToFilterFc||0!==o.modLfoToVolume),d=this.vibLfo.delta>0&&0!==o.vibLfoToPitch,p=this.loopStart<this.loopEnd,g=this.loopStart,m=this.loopEnd,_=o.end,y=m+1;let b=this.sourceSamplePosition;const S=new z2(this.lowPass),D=0!==o.modLfoToFilterFc||0!==o.modEnvToFilterFc;let T=0,C=0,v=0,x=0;const q=0!==o.modLfoToPitch||0!==o.modEnvToPitch||0!==o.vibLfoToPitch;let W=0,L=0,H=0,Ce=0;const Re=0!==o.modLfoToVolume;let Fe=0,De=0;for(D?(T=e.outSampleRate,C=o.initialFilterFc,v=o.modLfoToFilterFc,x=o.modEnvToFilterFc):(T=0,C=0,v=0,x=0),q?(W=0,L=o.modLfoToPitch,H=o.vibLfoToPitch,Ce=o.modEnvToPitch):(W=li.timecents2Secs(this.pitchInputTimecents)*this.pitchOutputFactor,L=0,H=0,Ce=0),Re?De=.1*o.modLfoToVolume:(Fe=li.decibelsToGain(this.noteGainDb),De=0);i>0;){let Ve,Dt,at=0,Bt=i>Zg.RenderEffectSampleBlock?Zg.RenderEffectSampleBlock:i;if(i-=Bt,D){const tt=C+this.modLfo.level*v+this.modEnv.level*x;S.active=tt<=13500,S.active&&S.setup(li.cents2Hertz(tt)/T)}switch(q&&(W=li.timecents2Secs(this.pitchInputTimecents+(this.modLfo.level*L+this.vibLfo.level*H+this.modEnv.level*Ce))*this.pitchOutputFactor),Re&&(Fe=li.decibelsToGain(this.noteGainDb+this.modLfo.level*De)),Ve=Fe*this.ampEnv.level,r?Ve=0:Ve*=this.mixVolume,this.ampEnv.process(Bt,e.outSampleRate),u&&this.modEnv.process(Bt,e.outSampleRate),h&&this.modLfo.process(Bt),d&&this.vibLfo.process(Bt),e.outputMode){case Nf.StereoInterleaved:for(Dt=Ve*this.panFactorLeft,at=Ve*this.panFactorRight;Bt-- >0&&b<_;){const tt=0|b,as=b-tt;let En=a[tt]*(1-as)+a[tt>=m&&p?g:tt+1]*as;S.active&&(En=S.process(En)),t[n+l]+=En*Dt,l++,t[n+l]+=En*at,l++,b+=W,b>=y&&p&&(b-=m-g+1)}break;case Nf.StereoUnweaved:for(Dt=Ve*this.panFactorLeft,at=Ve*this.panFactorRight;Bt-- >0&&b<_;){const tt=0|b,as=b-tt;let En=a[tt]*(1-as)+a[tt>=m&&p?g:tt+1]*as;S.active&&(En=S.process(En)),t[n+l]+=En*Dt,l++,t[n+c]+=En*at,c++,b+=W,b>=y&&p&&(b-=m-g+1)}break;case Nf.Mono:for(;Bt-- >0&&b<_;){const tt=0|b,as=b-tt;let En=a[tt]*(1-as)+a[tt>=m&&p?g:tt+1]*as;S.active&&(En=S.process(En)),t[n+l]=En*Ve,l++,b+=W,b>=y&&p&&(b-=m-g+1)}}if(b>=_||this.ampEnv.segment===Yn.Done)return void this.kill()}this.sourceSamplePosition=b,(S.active||D)&&(this.lowPass=S)}kill(){this.playingPreset=-1}}Zg.RenderEffectSampleBlock=xe.MicroBufferSize;class One{constructor(e){this.value=e}}class zD{get isEmpty(){return void 0===this._head}clear(){this._head=void 0,this._tail=void 0}enqueue(e){const t=new One(e);this._tail?(this._tail.next=t,this._tail=t):(this._head=t,this._tail=t)}peek(){const e=this._head;if(e)return e.value}dequeue(){const e=this._head;if(!e)return;const t=e.next;return this._head=t,t||(this._tail=void 0),e.value}}var Gn=function(s){return s[s.BankSelectCoarse=0]="BankSelectCoarse",s[s.ModulationCoarse=1]="ModulationCoarse",s[s.DataEntryCoarse=6]="DataEntryCoarse",s[s.VolumeCoarse=7]="VolumeCoarse",s[s.PanCoarse=10]="PanCoarse",s[s.ExpressionControllerCoarse=11]="ExpressionControllerCoarse",s[s.BankSelectFine=32]="BankSelectFine",s[s.ModulationFine=33]="ModulationFine",s[s.DataEntryFine=38]="DataEntryFine",s[s.VolumeFine=39]="VolumeFine",s[s.PanFine=42]="PanFine",s[s.ExpressionControllerFine=43]="ExpressionControllerFine",s[s.HoldPedal=64]="HoldPedal",s[s.LegatoPedal=68]="LegatoPedal",s[s.NonRegisteredParameterFine=98]="NonRegisteredParameterFine",s[s.NonRegisteredParameterCourse=99]="NonRegisteredParameterCourse",s[s.RegisteredParameterFine=100]="RegisteredParameterFine",s[s.RegisteredParameterCourse=101]="RegisteredParameterCourse",s[s.AllSoundOff=120]="AllSoundOff",s[s.ResetControllers=121]="ResetControllers",s[s.AllNotesOff=123]="AllNotesOff",s}(Gn||{});class lw{constructor(e){this._midiEventQueue=new zD,this._mutedChannels=new Map,this._soloChannels=new Map,this._isAnySolo=!1,this._transpositionPitches=new Map,this._liveTranspositionPitches=new Map,this.currentTempo=0,this.timeSignatureNumerator=0,this.timeSignatureDenominator=0,this.presets=null,this._voices=[],this._channels=null,this._voicePlayIndex=0,this.outputMode=Nf.StereoInterleaved,this.outSampleRate=0,this.globalGainDb=0,this.outSampleRate=e}synthesize(e,t,n){return this.fillWorkingBuffer(e,t,n)}synthesizeSilent(e){this.fillWorkingBuffer(null,0,e)}channelGetMixVolume(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].mixVolume:1}channelSetMixVolume(e,t){const n=this.channelInit(e);for(const i of this._voices)i.playingChannel===e&&-1!==i.playingPreset&&(i.mixVolume=t);n.mixVolume=t}channelSetMute(e,t){t?this._mutedChannels.set(e,!0):this._mutedChannels.delete(e)}channelSetSolo(e,t){t?this._soloChannels.set(e,!0):this._soloChannels.delete(e),this._isAnySolo=this._soloChannels.size>0}resetChannelStates(){this._mutedChannels=new Map,this._soloChannels=new Map,this._liveTranspositionPitches=new Map,this.applyTranspositionPitches(new Map),this._isAnySolo=!1}setChannelTranspositionPitch(e,t){let n=0;this._liveTranspositionPitches.has(e)&&(n=this._liveTranspositionPitches.get(e)),0===t?this._liveTranspositionPitches.delete(e):this._liveTranspositionPitches.set(e,t);for(const i of this._voices)if(i.playingChannel===e&&9!==i.playingChannel){let r=0;r-=n,r+=t,i.playingKey+=r,this._channels&&i.updatePitchRatio(this._channels.channelList[i.playingChannel],this.outSampleRate)}}applyTranspositionPitches(e){const t=this._transpositionPitches;for(const n of this._voices)if(n.playingChannel>=0&&9!==n.playingChannel){let i=0;t.has(n.playingChannel)&&(i-=t.get(n.playingChannel)),e.has(n.playingChannel)&&(i+=e.get(n.playingChannel)),n.playingKey+=i,this._channels&&n.updatePitchRatio(this._channels.channelList[n.playingChannel],this.outSampleRate)}this._transpositionPitches=e}dispatchEvent(e){this._midiEventQueue.enqueue(e)}fillWorkingBuffer(e,t,n){const i=this._isAnySolo,r=[];for(;!this._midiEventQueue.isEmpty;){const o=this._midiEventQueue.dequeue();o.isMetronome&&this.metronomeVolume>0?(this.channelNoteOff(xe.MetronomeChannel,xe.MetronomeKey),this.channelNoteOn(xe.MetronomeChannel,xe.MetronomeKey,95/127)):o.event&&this.processMidiMessage(o.event),r.push(o)}for(const o of this._voices)if(-1!==o.playingPreset){const a=o.playingChannel,l=this._mutedChannels.has(a)||i&&a!==xe.MetronomeChannel&&!this._soloChannels.has(a);e?o.render(this,e,t,n,l):o.kill()}return r}processMidiMessage(e){switch(e.type){case jt.TimeSignature:const n=e;this.timeSignatureNumerator=n.numerator,this.timeSignatureDenominator=Math.pow(2,n.denominatorIndex);break;case jt.NoteOn:this.channelNoteOn(e.channel,e.noteKey,e.noteVelocity/127);break;case jt.NoteOff:this.channelNoteOff(e.channel,e.noteKey);break;case jt.ControlChange:this.channelMidiControl(e.channel,e.controller,e.value);break;case jt.ProgramChange:this.channelSetPresetNumber(e.channel,e.program,9===e.channel);break;case jt.TempoChange:this.currentTempo=e.beatsPerMinute;break;case jt.PitchBend:this.channelSetPitchWheel(e.channel,e.value);break;case jt.PerNotePitchBend:let h=e.value;h=h*xe.MaxPitchWheel/xe.MaxPitchWheel20,this.channelSetPerNotePitchWheel(e.channel,e.noteKey,h)}}get metronomeVolume(){return this.channelGetMixVolume(xe.MetronomeChannel)}set metronomeVolume(e){this.setupMetronomeChannel(e)}setupMetronomeChannel(e){this.channelSetMixVolume(xe.MetronomeChannel,e),e>0&&(this.channelSetVolume(xe.MetronomeChannel,1),this.channelSetPresetNumber(xe.MetronomeChannel,0,!0))}get masterVolume(){return li.decibelsToGain(this.globalGainDb)}set masterVolume(e){const t=li.gainToDecibels(e),n=t-this.globalGainDb;if(0!==n){for(const i of this._voices)-1!==i.playingPreset&&(i.noteGainDb+=n);this.globalGainDb=t}}resetSoft(){for(const e of this._voices)-1!==e.playingPreset&&(e.ampEnv.segment<Yn.Release||0!==e.ampEnv.parameters.release)&&e.endQuick(this.outSampleRate);if(this._channels)for(const e of this._channels.channelList)e.presetIndex=0,e.bank=0,e.pitchWheel=8192,e.midiPan=8192,e.perNotePitchWheel.clear(),e.midiVolume=16383,e.midiExpression=16383,e.midiRpn=65535,e.midiData=0,e.panOffset=0,e.gainDb=0,e.pitchRange=2,e.tuning=0}get presetCount(){return this.presets?.length??0}reset(){for(const e of this._voices)-1!==e.playingPreset&&(e.ampEnv.segment<Yn.Release||0!==e.ampEnv.parameters.release)&&e.endQuick(this.outSampleRate);this._channels=null}setOutput(e,t,n){this.outputMode=e,this.outSampleRate=t>=1?t:44100,this.globalGainDb=n}noteOn(e,t,n){if(!this.presets)return;const i=127*n|0;if(e<0||e>=this.presets.length)return;if(n<=0)return void this.noteOff(e,t);const r=this._voicePlayIndex++;for(const o of this.presets[e].regions){if(t<o.loKey||t>o.hiKey||i<o.loVel||i>o.hiVel)continue;let a=null;if(0!==o.group)for(const u of this._voices)u.playingPreset===e&&u.region.group===o.group?u.endQuick(this.outSampleRate):-1===u.playingPreset&&!a&&(a=u);else for(const u of this._voices)-1===u.playingPreset&&(a=u);if(!a){for(let u=0;u<4;u++){const h=new Zg;h.playingPreset=-1,this._voices.push(h)}a=this._voices[this._voices.length-4]}a.region=o,a.playingPreset=e,a.playingKey=t,a.playIndex=r,a.noteGainDb=this.globalGainDb-o.attenuation-li.gainToDecibels(1/n),this._channels?this._channels.setupVoice(this,a):(a.calcPitchRatio(0,this.outSampleRate),a.panFactorLeft=Math.sqrt(.5-o.pan),a.panFactorRight=Math.sqrt(.5+o.pan)),a.sourceSamplePosition=o.offset;const l=o.loopMode!==yu.None&&o.loopStart<o.loopEnd;a.loopStart=l?o.loopStart:0,a.loopEnd=l?o.loopEnd:0,a.ampEnv.setup(o.ampEnv,t,i,!0,this.outSampleRate),a.modEnv.setup(o.modEnv,t,i,!1,this.outSampleRate),a.lowPass.qInv=1/Math.pow(10,o.initialFilterQ/10/20),a.lowPass.z1=0,a.lowPass.z2=0,a.lowPass.active=o.initialFilterFc<=13500,a.lowPass.active&&a.lowPass.setup(li.cents2Hertz(o.initialFilterFc)/this.outSampleRate),a.modLfo.setup(o.delayModLFO,o.freqModLFO,this.outSampleRate),a.vibLfo.setup(o.delayVibLFO,o.freqVibLFO,this.outSampleRate)}}bankNoteOn(e,t,n,i){const r=this.getPresetIndex(e,t);return-1!==r&&(this.noteOn(r,n,i),!0)}noteOff(e,t){let n=null,i=null;const r=[];for(const o of this._voices)o.playingPreset!==e||o.playingKey!==t||o.ampEnv.segment>=Yn.Release||(!n||o.playIndex<n.playIndex?(n=o,i=o,r.push(o)):o.playIndex===n.playIndex&&(i=o,r.push(o)));if(n)for(const o of r)o!==n&&o!==i&&(o.playIndex!==n.playIndex||o.playingPreset!==e||o.playingKey!==t||o.ampEnv.segment>=Yn.Release)||o.end(this.outSampleRate)}bankNoteOff(e,t,n){const i=this.getPresetIndex(e,t);return-1!==i&&(this.noteOff(i,n),!0)}noteOffAll(e){for(const t of this._voices)-1!==t.playingPreset&&(e?t.endQuick(this.outSampleRate):t.ampEnv.segment<Yn.Release&&t.end(this.outSampleRate))}get activeVoiceCount(){let e=0;for(const t of this._voices)-1!==t.playingPreset&&e++;return e}channelInit(e){if(this._channels&&e<this._channels.channelList.length)return this._channels.channelList[e];this._channels||(this._channels=new Rne);for(let t=this._channels.channelList.length;t<=e;t++){const n=new Ane;n.presetIndex=0,n.bank=0,n.pitchWheel=8192,n.midiPan=8192,n.midiVolume=16383,n.midiExpression=16383,n.midiRpn=65535,n.midiData=0,n.panOffset=0,n.gainDb=0,n.pitchRange=2,n.tuning=0,n.mixVolume=1,this._channels.channelList.push(n)}return this._channels.channelList[e]}getPresetIndex(e,t){if(!this.presets)return-1;for(let n=this.presets.length-1;n>=0;n--){const i=this.presets[n];if(i.presetNumber===t&&i.bank===e)return n}return-1}getPresetName(e){return this.presets?e<0||e>=this.presets.length?null:this.presets[e].name:null}bankGetPresetName(e,t){return this.getPresetName(this.getPresetIndex(e,t))}channelNoteOn(e,t,n){!this._channels||e>this._channels.channelList.length||(this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e)),this._channels.activeChannel=e,this.noteOn(this._channels.channelList[e].presetIndex,t,n))}channelNoteOff(e,t){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e));const n=[];let i=null,r=null;for(const a of this._voices)-1===a.playingPreset||a.playingChannel!==e||a.playingKey!==t||a.ampEnv.segment>=Yn.Release||(!i||a.playIndex<i.playIndex?(i=a,r=a,n.push(a)):a.playIndex===i.playIndex&&(r=a,n.push(a)));if(this.channelInit(e).perNotePitchWheel.delete(t),i)for(const a of n)a!==i&&a!==r&&(a.playIndex!==i.playIndex||-1===a.playingPreset||a.playingChannel!==e||a.playingKey!==t||a.ampEnv.segment>=Yn.Release)||a.end(this.outSampleRate)}channelNoteOffAll(e){this.channelInit(e).perNotePitchWheel.clear();for(const n of this._voices)-1!==n.playingPreset&&n.playingChannel===e&&n.ampEnv.segment<Yn.Release&&n.end(this.outSampleRate)}channelSoundsOffAll(e){this.channelInit(e).perNotePitchWheel.clear();for(const n of this._voices)-1!==n.playingPreset&&n.playingChannel===e&&(n.ampEnv.segment<Yn.Release||0===n.ampEnv.parameters.release)&&n.endQuick(this.outSampleRate)}channelSetPresetIndex(e,t){this.channelInit(e).presetIndex=Xe.int32ToUint16(t)}channelSetPresetNumber(e,t,n=!1){const i=this.channelInit(e);let r=0;return n?(r=this.getPresetIndex(128|32767&i.bank,t),-1===r&&(r=this.getPresetIndex(128,t)),-1===r&&(r=this.getPresetIndex(128,0)),-1===r&&(r=this.getPresetIndex(2047&i.bank,t))):r=this.getPresetIndex(2047&i.bank,t),i.presetIndex=r,-1!==r}channelSetBank(e,t){this.channelInit(e).bank=Xe.int32ToUint16(t)}channelSetBankPreset(e,t,n){const i=this.channelInit(e),r=this.getPresetIndex(t,n);return-1!==r&&(i.presetIndex=Xe.int32ToUint16(r),i.bank=Xe.int32ToUint16(t),!0)}channelSetPan(e,t){for(const n of this._voices)if(n.playingChannel===e&&-1!==n.playingPreset){const i=n.region.pan+t-.5;i<=-.5?(n.panFactorLeft=1,n.panFactorRight=0):i>=.5?(n.panFactorLeft=0,n.panFactorRight=1):(n.panFactorLeft=Math.sqrt(.5-i),n.panFactorRight=Math.sqrt(.5+i))}this.channelInit(e).panOffset=t-.5}channelSetVolume(e,t){const n=this.channelInit(e),i=li.gainToDecibels(t),r=i-n.gainDb;if(0!==r){for(const o of this._voices)o.playingChannel===e&&-1!==o.playingPreset&&(o.noteGainDb+=r);n.gainDb=i}}channelSetPitchWheel(e,t){const n=this.channelInit(e);n.pitchWheel!==t&&(n.pitchWheel=Xe.int32ToUint16(t),this.channelApplyPitch(e,n))}channelSetPerNotePitchWheel(e,t,n){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e));const i=this.channelInit(e);i.perNotePitchWheel.has(t)&&i.perNotePitchWheel.get(t)===n||(i.perNotePitchWheel.set(t,n),this.channelApplyPitch(e,i,t))}channelApplyPitch(e,t,n=-1){for(const i of this._voices)i.playingChannel===e&&-1!==i.playingPreset&&(-1===n||i.playingKey===n)&&i.updatePitchRatio(t,this.outSampleRate)}channelSetPitchRange(e,t){const n=this.channelInit(e);n.pitchRange!==t&&(n.pitchRange=t,8192!==n.pitchWheel&&this.channelApplyPitch(e,n))}channelSetTuning(e,t){const n=this.channelInit(e);n.tuning!==t&&(n.tuning=t,this.channelApplyPitch(e,n))}channelMidiControl(e,t,n){const i=this.channelInit(e);switch(t){case Gn.DataEntryFine:return i.midiData=Xe.int32ToUint16(16256&i.midiData|n),void(0===i.midiRpn?this.channelSetPitchRange(e,(i.midiData>>7)+.01*(127&i.midiData)):1===i.midiRpn?this.channelSetTuning(e,(0|i.tuning)+(i.midiData-8192)/8192):2===i.midiRpn&&this.channelSetTuning(e,n-64+(i.tuning-(0|i.tuning))));case Gn.VolumeCoarse:return i.midiVolume=Xe.int32ToUint16(127&i.midiVolume|n<<7),void this.channelSetVolume(e,Math.pow(i.midiVolume/16383*(i.midiExpression/16383),3));case Gn.VolumeFine:return i.midiVolume=Xe.int32ToUint16(16256&i.midiVolume|n),void this.channelSetVolume(e,Math.pow(i.midiVolume/16383*(i.midiExpression/16383),3));case Gn.ExpressionControllerCoarse:return i.midiExpression=Xe.int32ToUint16(127&i.midiExpression|n<<7),void this.channelSetVolume(e,Math.pow(i.midiVolume/16383*(i.midiExpression/16383),3));case Gn.ExpressionControllerFine:return i.midiExpression=Xe.int32ToUint16(16256&i.midiExpression|n),void this.channelSetVolume(e,Math.pow(i.midiVolume/16383*(i.midiExpression/16383),3));case Gn.PanCoarse:return i.midiPan=Xe.int32ToUint16(127&i.midiPan|n<<7),void this.channelSetPan(e,i.midiPan/16383);case Gn.PanFine:return i.midiPan=Xe.int32ToUint16(16256&i.midiPan|n),void this.channelSetPan(e,i.midiPan/16383);case Gn.DataEntryCoarse:return i.midiData=Xe.int32ToUint16(127&i.midiData|n<<7),void(0===i.midiRpn?this.channelSetPitchRange(e,(i.midiData>>7)+.01*(127&i.midiData)):1===i.midiRpn?this.channelSetTuning(e,(0|i.tuning)+(i.midiData-8192)/8192):2===i.midiRpn&&t===Gn.DataEntryCoarse&&this.channelSetTuning(e,n-64+(i.tuning-(0|i.tuning))));case Gn.BankSelectCoarse:return void(i.bank=Xe.int32ToUint16(32768|n));case Gn.BankSelectFine:return void(i.bank=Xe.int32ToUint16((32768&i.bank?(127&i.bank)<<7:0)|n));case Gn.RegisteredParameterCourse:return void(i.midiRpn=Xe.int32ToUint16(127&(65535===i.midiRpn?0:i.midiRpn)|n<<7));case Gn.RegisteredParameterFine:return void(i.midiRpn=Xe.int32ToUint16(16256&(65535===i.midiRpn?0:i.midiRpn)|n));case Gn.NonRegisteredParameterFine:case Gn.NonRegisteredParameterCourse:return void(i.midiRpn=65535);case Gn.AllSoundOff:return void this.channelSoundsOffAll(e);case Gn.AllNotesOff:return void this.channelNoteOffAll(e);case Gn.ResetControllers:return i.midiVolume=16383,i.midiExpression=16383,i.midiPan=8192,i.bank=0,this.channelSetVolume(e,1),this.channelSetPan(e,.5),void this.channelSetPitchRange(e,2)}}channelGetPresetIndex(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].presetIndex:0}channelGetPresetBank(e){return this._channels&&e<this._channels.channelList.length?32767&this._channels.channelList[e].bank:0}channelGetPan(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].panOffset-.5:.5}channelGetVolume(e){return this._channels&&e<this._channels.channelList.length?li.decibelsToGain(this._channels.channelList[e].gainDb):1}channelGetPitchWheel(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchWheel:8192}channelGetPitchRange(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchRange:2}channelGetTuning(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].tuning:0}resetPresets(){this.presets=[]}loadPresets(e,t,n,i){const r=[];for(let o=0;o<e.phdrs.length-1;o++){const a=e.phdrs[o];let l=0;const c=new Fne;r.push(c),c.name=a.presetName,c.bank=a.bank,c.presetNumber=a.preset;let u=0;for(let d=a.presetBagNdx;d<e.phdrs[o+1].presetBagNdx;d++){let g=0,m=127,_=0,y=127;for(let b=e.pbags[d].genNdx;b<e.pbags[d+1].genNdx;b++){const S=e.pgens[b];if(S.genOper!==_c.GenKeyRange)if(S.genOper!==_c.GenVelRange){if(!(S.genOper!==_c.GenInstrument||S.genAmount.wordAmount>=e.insts.length))for(let T=e.insts[S.genAmount.wordAmount].instBagNdx;T<e.insts[S.genAmount.wordAmount+1].instBagNdx;T++){let v=0,x=127,q=0,W=127;for(let L=e.ibags[T].instGenNdx;L<e.ibags[T+1].instGenNdx;L++){const H=e.igens[L];H.genOper!==_c.GenKeyRange?H.genOper!==_c.GenVelRange?53===H.genOper&&x>=g&&v<=m&&W>=_&&q<=y&&u++:(q=H.genAmount.lowByteAmount,W=H.genAmount.highByteAmount):(v=H.genAmount.lowByteAmount,x=H.genAmount.highByteAmount)}}}else _=S.genAmount.lowByteAmount,y=S.genAmount.highByteAmount;else g=S.genAmount.lowByteAmount,m=S.genAmount.highByteAmount}}c.regions=new Array(u);let h=new Il;h.clear(!0);for(let d=a.presetBagNdx;d<e.phdrs[o+1].presetBagNdx;d++){const p=e.pbags[d],g=new Il(h);let m=!1;for(let _=p.genNdx;_<e.pbags[d+1].genNdx;_++){const y=e.pgens[_];if(y.genOper===_c.GenInstrument){const b=y.genAmount.wordAmount;if(b>=e.insts.length)continue;let S=new Il;S.clear(!1);const D=e.insts[b];for(let T=D.instBagNdx;T<e.insts[b+1].instBagNdx;T++){const C=e.ibags[T],v=new Il(S);let x=!1;for(let q=C.instGenNdx;q<e.ibags[T+1].instGenNdx;q++){const W=e.igens[q];if(W.genOper===_c.GenSampleId){if(v.hiKey<g.loKey||v.loKey>g.hiKey||v.hiVel<g.loVel||v.loVel>g.hiVel)continue;g.loKey>v.loKey&&(v.loKey=g.loKey),g.hiKey<v.hiKey&&(v.hiKey=g.hiKey),g.loVel>v.loVel&&(v.loVel=g.loVel),g.hiVel<v.hiVel&&(v.hiVel=g.hiVel),v.offset+=g.offset,v.end+=g.end,v.loopStart+=g.loopStart,v.loopEnd+=g.loopEnd,v.transpose+=g.transpose,v.tune+=g.tune,v.pitchKeyTrack+=g.pitchKeyTrack,v.attenuation+=g.attenuation,v.pan+=g.pan,v.ampEnv.delay+=g.ampEnv.delay,v.ampEnv.attack+=g.ampEnv.attack,v.ampEnv.hold+=g.ampEnv.hold,v.ampEnv.decay+=g.ampEnv.decay,v.ampEnv.sustain+=g.ampEnv.sustain,v.ampEnv.release+=g.ampEnv.release,v.modEnv.delay+=g.modEnv.delay,v.modEnv.attack+=g.modEnv.attack,v.modEnv.hold+=g.modEnv.hold,v.modEnv.decay+=g.modEnv.decay,v.modEnv.sustain+=g.modEnv.sustain,v.modEnv.release+=g.modEnv.release,v.initialFilterQ+=g.initialFilterQ,v.initialFilterFc+=g.initialFilterFc,v.modEnvToPitch+=g.modEnvToPitch,v.modEnvToFilterFc+=g.modEnvToFilterFc,v.delayModLFO+=g.delayModLFO,v.freqModLFO+=g.freqModLFO,v.modLfoToPitch+=g.modLfoToPitch,v.modLfoToFilterFc+=g.modLfoToFilterFc,v.modLfoToVolume+=g.modLfoToVolume,v.delayVibLFO+=g.delayVibLFO,v.freqVibLFO+=g.freqVibLFO,v.vibLfoToPitch+=g.vibLfoToPitch,v.ampEnv.envToSecs(!0),v.modEnv.envToSecs(!1),v.delayModLFO=v.delayModLFO<-11950?0:li.timecents2Secs(v.delayModLFO),v.delayVibLFO=v.delayVibLFO<-11950?0:li.timecents2Secs(v.delayVibLFO),v.pan<-.5?v.pan=-.5:v.pan>.5&&(v.pan=.5),(v.initialFilterQ<1500||v.initialFilterQ>13500)&&(v.initialFilterQ=0);const L=e.sHdrs[W.genAmount.wordAmount];v.offset+=L.start,v.end+=L.end,v.loopStart+=L.startLoop,v.loopEnd+=L.endLoop,L.endLoop>0&&(v.loopEnd-=1),-1===v.pitchKeyCenter&&(v.pitchKeyCenter=L.originalPitch),v.tune+=L.pitchCorrection,v.sampleRate=L.sampleRate;const H=a.bank===xe.PercussionBank;H&&lw.setContainsRange(n,v.loKey,v.hiKey)||!H&&t.has(a.preset)?1&L.sampleType?(F.debug("AlphaSynth",`Loading of used sample ${L.sampleName} for preset ${a.presetName} (bank ${c.bank} program ${c.presetNumber})`),16&L.sampleType?v.samples=e.decodeSamples(L.start,L.end,!0):(v.samples=e.decodeSamples(2*v.offset,2*v.end,!1),v.loopStart>0&&(v.loopStart-=v.offset),v.loopEnd>0&&(v.loopEnd-=v.offset)),v.offset=0,v.end=v.samples.length-1):(F.warning("AlphaSynth",`Skipping load of unsupported sample ${L.sampleName} for preset ${a.presetName}, sample type ${L.sampleType} is not supported (bank ${c.bank} program ${c.presetNumber})`),v.samples=new Float32Array(0)):(F.debug("AlphaSynth",`Skipping load of unused sample ${L.sampleName} for preset ${a.presetName} (bank ${c.bank} program ${c.presetNumber})`),v.samples=new Float32Array(0)),c.regions[l]=new Il(v),l++,x=!0}else v.operator(W.genOper,W.genAmount)}C===e.ibags[D.instBagNdx]&&!x&&(S=new Il(v))}m=!0}else g.operator(y.genOper,y.genAmount)}p===e.pbags[a.presetBagNdx]&&!m&&(h=g)}}if(i&&this.presets)for(const o of r)this.presets.push(o);else this.presets=r}static setContainsRange(e,t,n){for(let i=t;i<=n;i++)if(e.has(i))return!0;return!1}hasSamplesForProgram(e){const t=this.presets;if(!t)return!1;for(const n of t)if(n.presetNumber===e)for(const i of n.regions)if(i.samples.length>0)return!0;return!1}hasSamplesForPercussion(e){const t=this.presets;if(!t)return!1;for(const n of t)if(n.bank===xe.PercussionBank)for(const i of n.regions)if(i.loKey>=e&&i.hiKey<=e&&i.samples.length>0)return!0;return!1}}class ks{constructor(e=void 0){this._listeners=[],this._fireOnRegister=e}on(e){return this._listeners.push(e),this._fireOnRegister?.()&&e(),()=>{this.off(e)}}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(){for(const e of this._listeners)e()}}class ft{constructor(e=void 0){this._listeners=[],this._fireOnRegister=e}on(e){if(this._listeners.push(e),this._fireOnRegister){const t=this._fireOnRegister();null!==t&&e(t)}return()=>{this.off(e)}}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(e){for(const t of this._listeners)t(e)}}class qD{constructor(e){this.events=e}}class Qg{constructor(e){this.playbackRange=e}}class q2{constructor(){this.sampleRate=44100,this.useSyncPoints=!1,this.masterVolume=1,this.metronomeVolume=0,this.trackVolume=new Map,this.trackTranspositionPitches=new Map}}class $2{constructor(){this.currentTime=0,this.endTime=0,this.currentTick=0,this.endTick=0}}class $D{get output(){return this._output}get isReadyForPlayback(){return this.isReady&&this.isSoundFontLoaded&&this._isMidiLoaded}get logLevel(){return F.logLevel}set logLevel(e){F.logLevel=e}get masterVolume(){return this.synthesizer.masterVolume}set masterVolume(e){e=Math.max(e,xe.MinVolume),this.updateMasterVolume(e)}updateMasterVolume(e){this.synthesizer.masterVolume=e}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,xe.MinVolume),this._metronomeVolume=e,this.synthesizer.metronomeVolume=e}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,xe.MinVolume),this._countInVolume=e}get midiEventsPlayedFilter(){return Array.from(this._midiEventsPlayedFilter)}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=new Set(e)}get playbackSpeed(){return this.sequencer.playbackSpeed}set playbackSpeed(e){e=ie.clamp(e,xe.MinPlaybackSpeed,xe.MaxPlaybackSpeed),this.updatePlaybackSpeed(e)}updatePlaybackSpeed(e){const t=this.sequencer.playbackSpeed;this.sequencer.playbackSpeed=e,this.timePosition=this.timePosition*(t/e)}get loadedMidiInfo(){return this._loadedMidiInfo}get currentPosition(){return this._currentPosition}get tickPosition(){return this._tickPosition}set tickPosition(e){this.timePosition=this.sequencer.mainTickPositionToTimePosition(e)}get timePosition(){return this._timePosition}set timePosition(e){F.debug("AlphaSynth",`Seeking to position ${e}ms (main)`),this.sequencer.mainSeek(e),this.updateTimePosition(e,!0),this.sequencer.isPlayingMain&&(this._notPlayedSamples=0,this.output.resetSamples())}get playbackRange(){return this.sequencer.mainPlaybackRange}set playbackRange(e){this.sequencer.mainPlaybackRange=e,e&&(this.tickPosition=e.startTick),this.playbackRangeChanged.trigger(new Qg(e))}get isLooping(){return this.sequencer.isLooping}set isLooping(e){this.sequencer.isLooping=e}destroy(){F.debug("AlphaSynth","Destroying player"),this.stop(),this.output.destroy()}constructor(e,t,n){this.isSoundFontLoaded=!1,this._isMidiLoaded=!1,this._tickPosition=0,this._timePosition=0,this._metronomeVolume=0,this._countInVolume=0,this._playedEventsQueue=new zD,this._midiEventsPlayedFilter=new Set,this._notPlayedSamples=0,this._synthStopping=!1,this._currentPosition=new Nl(0,0,0,0,!1,120,120),this.isReady=!1,this.state=wi.Paused,this._loadedSoundFonts=[],this.readyForPlayback=new ks,this.finished=new ks,this.soundFontLoaded=new ks,this.soundFontLoadFailed=new ft,this.midiLoadFailed=new ft,this.midiEventsPlayed=new ft,F.debug("AlphaSynth","Initializing player"),this.state=wi.Paused,this.ready=new ks(()=>this.isReady),this.readyForPlayback=new ks(()=>this.isReadyForPlayback),this.midiLoaded=new ft(()=>this._loadedMidiInfo?this._loadedMidiInfo:null),this.stateChanged=new ft(()=>new Fh(this.state,!1)),this.positionChanged=new ft(()=>this._currentPosition),this.playbackRangeChanged=new ft(()=>this.playbackRange?new Qg(this.playbackRange):null),F.debug("AlphaSynth","Creating output"),this._output=e,F.debug("AlphaSynth","Creating synthesizer"),this.synthesizer=t,this.sequencer=new N2(this.synthesizer),F.debug("AlphaSynth","Opening output"),this.output.ready.on(()=>{this.isReady=!0,this.ready.trigger(),this.checkReadyForPlayback()}),this.output.sampleRequest.on(()=>{this.onSampleRequest()}),this.output.samplesPlayed.on(this.onSamplesPlayed.bind(this)),this.output.open(n)}onSampleRequest(){if(this.state===wi.Playing&&(!this.sequencer.isFinished||this.synthesizer.activeVoiceCount>0)){let e=new Float32Array(xe.MicroBufferSize*xe.MicroBufferCount*xe.AudioChannels),t=0;for(let n=0;n<xe.MicroBufferCount;n++){this.sequencer.fillMidiEventQueue();const i=this.synthesizer.synthesize(e,t,xe.MicroBufferSize);t+=xe.MicroBufferSize*xe.AudioChannels;for(const r of i)this._midiEventsPlayedFilter.has(r.event.type)&&this._playedEventsQueue.enqueue(r);if(this.sequencer.isFinished)break}t<e.length&&(e=e.subarray(0,t)),this._notPlayedSamples+=e.length,this.output.addSamples(e)}else{const e=new Float32Array(0);this.output.addSamples(e)}}play(){return!(this.state!==wi.Paused||!this._isMidiLoaded||(this.output.activate(),this.playInternal(),this._countInVolume>0&&(F.debug("AlphaSynth","Starting countin"),this.sequencer.startCountIn(),this.synthesizer.setupMetronomeChannel(this._countInVolume),this.updateTimePosition(0,!0)),this.output.play(),0))}playInternal(){this.sequencer.isPlayingOneTimeMidi&&(F.debug("AlphaSynth","Cancelling one time midi"),this.stopOneTimeMidi()),F.debug("AlphaSynth","Starting playback"),this.synthesizer.setupMetronomeChannel(this.metronomeVolume),this._synthStopping=!1,this.state=wi.Playing,this.stateChanged.trigger(new Fh(this.state,!1))}pause(){this.state===wi.Paused||!this._isMidiLoaded||(F.debug("AlphaSynth","Pausing playback"),this.state=wi.Paused,this.stateChanged.trigger(new Fh(this.state,!1)),this.output.pause(),this.synthesizer.noteOffAll(!1))}playPause(){this.state===wi.Paused&&this._isMidiLoaded?this.play():this.pause()}stop(){this._isMidiLoaded&&(F.debug("AlphaSynth","Stopping playback"),this.state=wi.Paused,this.output.pause(),this._notPlayedSamples=0,this.sequencer.stop(),this.synthesizer.noteOffAll(!0),this.tickPosition=this.sequencer.mainPlaybackRange?this.sequencer.mainPlaybackRange.startTick:0,this.stateChanged.trigger(new Fh(this.state,!0)))}playOneTimeMidiFile(e){this.sequencer.isPlayingOneTimeMidi?this.stopOneTimeMidi():this.pause(),this.sequencer.loadOneTimeMidi(e),this.synthesizer.noteOffAll(!0),this.updateTimePosition(0,!0),this._notPlayedSamples=0,this.output.resetSamples(),this.output.play()}resetSoundFonts(){this.stop(),this.synthesizer.resetPresets(),this._loadedSoundFonts=[],this.isSoundFontLoaded=!1,this.soundFontLoaded.trigger()}loadSoundFont(e,t){this.pause();const n=ps.fromBuffer(e);try{F.debug("AlphaSynth","Loading soundfont from bytes");const i=new M2;i.load(n),t||(this._loadedSoundFonts=[]),this._loadedSoundFonts.push(i),this.isSoundFontLoaded=!0,this.soundFontLoaded.trigger(),F.debug("AlphaSynth","soundFont successfully loaded"),this.checkReadyForPlayback()}catch(i){F.error("AlphaSynth",`Could not load soundfont from bytes ${i}`),this.soundFontLoadFailed.trigger(i)}}checkReadyForPlayback(){if(this.isReadyForPlayback){this.synthesizer.setupMetronomeChannel(this.metronomeVolume);const e=this.sequencer.instrumentPrograms,t=this.sequencer.percussionKeys;let n=!1;for(const i of this._loadedSoundFonts)this.synthesizer.loadPresets(i,e,t,n),n=!0;this.readyForPlayback.trigger()}}loadMidiFile(e){this.stop();try{F.debug("AlphaSynth","Loading midi from model"),this.sequencer.loadMidi(e),this._isMidiLoaded=!0,this._loadedMidiInfo=new Nl(0,this.sequencer.currentEndTime,0,this.sequencer.currentEndTick,!1,this.sequencer.currentTempo,this.sequencer.modifiedTempo),this.midiLoaded.trigger(this._loadedMidiInfo),F.debug("AlphaSynth","Midi successfully loaded"),this.checkReadyForPlayback(),this.tickPosition=0}catch(t){F.error("AlphaSynth",`Could not load midi from model ${t}`),this.midiLoadFailed.trigger(t)}}applyTranspositionPitches(e){this.synthesizer.applyTranspositionPitches(e)}setChannelTranspositionPitch(e,t){this.synthesizer.setChannelTranspositionPitch(e,t)}setChannelMute(e,t){this.synthesizer.channelSetMute(e,t)}resetChannelStates(){this.synthesizer.resetChannelStates()}setChannelSolo(e,t){this.synthesizer.channelSetSolo(e,t)}setChannelVolume(e,t){t=Math.max(t,xe.MinVolume),this.synthesizer.channelSetMixVolume(e,t)}onSamplesPlayed(e){if(0===e)return;const t=e/this.synthesizer.outSampleRate*1e3;this._notPlayedSamples-=e*xe.AudioChannels,this.updateTimePosition(this._timePosition+t,!1),this.checkForFinish()}checkForFinish(){let e=0,t=0;this.playbackRange&&this.sequencer.isPlayingMain?(e=this.playbackRange.startTick,t=this.playbackRange.endTick):t=this.sequencer.currentEndTick,this._tickPosition>=t&&(this._notPlayedSamples<=0?(this._notPlayedSamples=0,this.sequencer.isPlayingCountIn?(F.debug("AlphaSynth","Finished playback (count-in)"),this.sequencer.resetCountIn(),this.timePosition=this.sequencer.currentTime,this.playInternal(),this.output.resetSamples()):this.sequencer.isPlayingOneTimeMidi?(F.debug("AlphaSynth","Finished playback (one time)"),this.output.resetSamples(),this.state=wi.Paused,this.stopOneTimeMidi()):this.isLooping?(F.debug("AlphaSynth","Finished playback (main looping)"),this.finished.trigger(),this.tickPosition=e,this._synthStopping=!1):this.synthesizer.activeVoiceCount>0?this._synthStopping||(F.debug("AlphaSynth","Signaling synth to stop all voices (all samples played)"),this.synthesizer.noteOffAll(!0),this._synthStopping=!0):(this._synthStopping=!1,F.debug("AlphaSynth","Finished playback (main)"),this.finished.trigger(),this.stop())):this._synthStopping||(F.debug("AlphaSynth","Signaling synth to stop all voices (not all samples played)"),this.synthesizer.noteOffAll(!0),this._synthStopping=!0))}stopOneTimeMidi(){this.output.pause(),this.synthesizer.noteOffAll(!0),this.sequencer.resetOneTimeMidi(),this.timePosition=this.sequencer.currentTime}createPositionChangedEventArgs(e){let t=this._timePosition,n=this.sequencer.currentTimePositionToTickPosition(t);const i=this.sequencer.currentEndTime,r=this.sequencer.currentEndTick;return t>i&&(t=i,n=r),new Nl(t,i,n,r,e,this.sequencer.currentTempo,this.sequencer.modifiedTempo)}updateTimePosition(e,t){this._timePosition=e;const n=this.createPositionChangedEventArgs(t);if(this._tickPosition=n.currentTick,F.debug("AlphaSynth",`Position changed: (time: ${n.currentTime}/${n.endTime}, tick: ${n.currentTick}/${n.endTick}, Active Voices: ${this.synthesizer.activeVoiceCount} (${this.sequencer.isPlayingMain?"main":this.sequencer.isPlayingCountIn?"count-in":"one-time"}), Tempo original: ${this.sequencer.currentTempo}, Tempo modified: ${this.sequencer.modifiedTempo})`),this.sequencer.isPlayingMain&&(this._currentPosition=n,this.positionChanged.trigger(n)),t)this._playedEventsQueue.clear();else{const r=[];for(;!this._playedEventsQueue.isEmpty&&this._playedEventsQueue.peek().time<n.currentTime;){const o=this._playedEventsQueue.dequeue();r.push(o.event)}r.length>0&&(r.reverse(),this.midiEventsPlayed.trigger(new qD(r)))}}hasSamplesForProgram(e){return this.synthesizer.hasSamplesForProgram(e)}hasSamplesForPercussion(e){return this.synthesizer.hasSamplesForPercussion(e)}loadBackingTrack(e){}updateSyncPoints(e){}}class j2 extends $D{constructor(e,t){super(e,new lw(e.sampleRate),t)}exportAudio(e,t,n,i){const r=new Lne(e);r.loadMidiFile(t),e.useSyncPoints&&r.updateSyncPoints(n),r.applyTranspositionPitches(i);for(const[o,a]of e.trackTranspositionPitches)r.setChannelTranspositionPitch(o,a);for(const[o,a]of e.trackVolume)r.channelSetMixVolume(o,a);if(e.soundFonts)for(const o of e.soundFonts)r.loadSoundFont(o);else r.loadPresets(this.synthesizer.presets);return e.playbackRange&&r.limitExport(e.playbackRange),r.setup(),r}}class Lne{constructor(e){this._generatedAudioCurrentTime=0,this._generatedAudioEndTime=0,this._synth=new lw(e.sampleRate),this._sequencer=new N2(this._synth),this._synth.masterVolume=Math.max(e.masterVolume,xe.MinVolume),this._synth.metronomeVolume=Math.max(e.metronomeVolume,xe.MinVolume)}loadSoundFont(e){const t=ps.fromBuffer(e),n=new M2;n.load(t),this._synth.loadPresets(n,this._sequencer.instrumentPrograms,this._sequencer.percussionKeys,!0)}loadPresets(e){this._synth.presets=e}limitExport(e){this._sequencer.mainPlaybackRange=e,this._sequencer.mainSeek(this._sequencer.mainTickPositionToTimePosition(e.startTick))}setChannelTranspositionPitch(e,t){this._synth.setChannelTranspositionPitch(e,t)}applyTranspositionPitches(e){this._synth.applyTranspositionPitches(e)}loadMidiFile(e){this._sequencer.loadMidi(e)}updateSyncPoints(e){this._sequencer.mainUpdateSyncPoints(e)}channelSetMixVolume(e,t){t=Math.max(t,xe.MinVolume),this._synth.channelSetMixVolume(e,t)}setup(){this._synth.setupMetronomeChannel(this._synth.metronomeVolume);const e=this._sequencer.currentSyncPoints;if(0===e.length)this._generatedAudioEndTime=this._sequencer.currentEndTime;else{const n=e[e.length-1];let i=n.syncTime;const r=this._sequencer.currentEndTick-n.synthTick;r>0&&(i+=G.ticksToMillis(r,n.syncBpm)),this._generatedAudioEndTime=i}}render(e){if(this._sequencer.isFinished)return;const t=1e3*xe.MicroBufferSize/this._synth.outSampleRate,n=Math.ceil(e/t);let i=new Float32Array(xe.MicroBufferSize*n*xe.AudioChannels);const r=this._sequencer.currentSyncPoints;let o=0,a=this._generatedAudioCurrentTime,l=0;for(let u=0;u<n;u++){if(r.length>0){this._sequencer.currentUpdateSyncPoints(a),this._sequencer.currentUpdateCurrentTempo(this._sequencer.currentTime);const h=this._sequencer.syncPointTempo/this._sequencer.currentTempo;this._sequencer.playbackSpeed!==h&&(this._sequencer.playbackSpeed=h)}if(this._sequencer.fillMidiEventQueue(),this._synth.synthesize(i,o,xe.MicroBufferSize),o+=xe.MicroBufferSize*xe.AudioChannels,a+=t,l+=t*this._sequencer.playbackSpeed,this._sequencer.isFinished)break}o<i.length&&(i=i.subarray(0,o));const c=new $2;return c.currentTime=this._generatedAudioCurrentTime,c.endTime=this._generatedAudioEndTime,c.currentTick=this._sequencer.currentTimePositionToTickPosition(this._sequencer.currentTime),c.endTick=this._sequencer.currentEndTick,this._generatedAudioCurrentTime+=e,c.samples=i,this._sequencer.isFinished&&this._synth.noteOffAll(!0),c}}class O{static parseEnum(e,t){switch(typeof e){case"string":const n=Number.parseInt(e);return Number.isNaN(n)?t[Object.keys(t).find(i=>i.toLowerCase()===e.toLowerCase())]:n;case"number":return e;case"undefined":case"object":return}throw new rn(un.Format,`Could not parse enum value '${e}'`)}static forEach(e,t){if(e instanceof Map)e.forEach(t);else if("object"==typeof e)for(const n in e)t(e[n],n)}static getValue(e,t){return e instanceof Map?e.get(t):"object"==typeof e?e[t]:null}}class Vne{constructor(e,t,n){this.text=e,this.startPos=t,this.endPos=n}}class Ef{constructor(e){this.style="normal",this.variant="normal",this.weight="normal",this.stretch="normal",this.lineHeight="normal",this.size="1rem",this.families=[],this.parseOnlyFamilies=!1,this._currentTokenIndex=-1,this._input="",this._currentToken=null,this._input=e,this._tokens=this.splitToTokens(e)}splitToTokens(e){const t=[];let n=0;for(;n<e.length;){let i=n;for(;i<e.length&&" "!==e.charAt(i);)i++;i>n&&t.push(new Vne(e.substring(n,i),n,i)),n=i+1}return t}parse(){if(this.reset(),1===this._tokens.length)switch(this._currentToken?.text){case"caption":case"icon":case"menu":case"message-box":case"small-caption":case"status-bar":case"inherit":return}this.parseOnlyFamilies||(this.fontStyleVariantWeight(),this.fontSizeLineHeight()),this.fontFamily()}static parseFamilies(e){const t=new Ef(e);return t.parseOnlyFamilies=!0,t.parse(),t.families}fontFamily(){if(!this._currentToken){if(this.parseOnlyFamilies)return;throw new Error("Missing font list")}const e=this._input.substr(this._currentToken.startPos).trim();let t=0;for(;t<e.length;){const n=e.charAt(t);if(" "===n||","===n)t++;else if('"'===n||"'"===n){const i=this.findEndOfQuote(e,t+1,n);this.families.push(e.substring(t+1,i).split(`\\${n}`).join(n)),t=i+1}else{const i=this.findEndOfQuote(e,t+1,",");this.families.push(e.substring(t,i).trim()),t=i+1}}}findEndOfQuote(e,t,n){let i=!1;for(;t<e.length;){const r=e.charAt(t);if(!i&&r===n)return t;i=!i&&"\\"===r,t+=1}return e.length}fontSizeLineHeight(){if(!this._currentToken)throw new Error("Missing font size");const e=this._currentToken.text.split("/");if(e.length>=3)throw new Error(`Invalid font size '${this._currentToken}' specified`);if(this.nextToken(),e.length>=2)if("/"===e[1]){if(!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.size=e[0],this.lineHeight=e[1];else{if(!(e.length>=1))throw new Error("Missing font size");if(this.size=e[0],this._currentToken&&0===this._currentToken.text.indexOf("/"))if("/"===this._currentToken.text){if(this.nextToken(),!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.lineHeight=this._currentToken.text.substr(1),this.nextToken()}}nextToken(){this._currentTokenIndex++,this._currentToken=this._currentTokenIndex<this._tokens.length?this._tokens[this._currentTokenIndex]:null}fontStyleVariantWeight(){let e=!1,t=!1,n=!1,i=3;const r=[];for(;;){if(!this._currentToken)return;const o=this._currentToken.text;switch(o){case"normal":case"inherit":r.push(o),i--,this.nextToken();break;case"italic":case"oblique":this.style=o,e=!0,i--,this.nextToken();break;case"small-caps":this.variant=o,t=!0,i--,this.nextToken();break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":this.weight=o,n=!0,i--,this.nextToken();break;default:return}if(0===i)break}for(;r.length>0;){const o=r.pop();n?t?e||(this.style=o):this.variant=o:this.weight=o}}reset(){this._currentTokenIndex=-1,this.nextToken()}static quoteFont(e){return-1===e.indexOf(" ")?e:`"${e.replaceAll('"','\\"')}"`}}var ts=function(s){return s[s.Plain=0]="Plain",s[s.Italic=1]="Italic",s}(ts||{}),Or=function(s){return s[s.Regular=0]="Regular",s[s.Bold=1]="Bold",s}(Or||{});class Ke{reset(){this._cssScale=0,this._css=this.toCssString()}get family(){return this._families[0]}set family(e){this.families=Ef.parseFamilies(e)}get families(){return this._families}set families(e){this._families=e,this.reset()}get size(){return this._size}set size(e){this._size=e,this.reset()}get style(){return this._style}set style(e){this._style=e,this.reset()}get weight(){return this._weight}set weight(e){this._weight=e,this.reset()}get isBold(){return this.weight===Or.Bold}get isItalic(){return this.style===ts.Italic}constructor(e,t,n=ts.Plain,i=Or.Regular){this._cssScale=0,this._families=Ef.parseFamilies(e),this._size=t,this._style=n,this._weight=i,this._css=this.toCssString()}withSize(e){return Ke.withFamilyList(this._families,e,this._style,this._weight)}static withFamilyList(e,t,n=ts.Plain,i=Or.Regular){const r=new Ke("",t,n,i);return r.families=e,r}toCssString(e=1){if(!(this._css&&Math.abs(e-this._cssScale)<.01)){let t="";this.isBold&&(t+="bold "),this.isItalic&&(t+="italic "),t+=this.size*e,t+="px ",t+=this.families.map(n=>Ef.quoteFont(n)).join(", "),this._css=t,this._cssScale=e}return this._css}static fromJson(e){if(e instanceof Ke)return e;switch(typeof e){case"undefined":default:return;case"object":{const t=e,n=t.get("families"),i=t.get("size"),r=O.parseEnum(t.get("style"),ts),o=O.parseEnum(t.get("weight"),Or);return Ke.withFamilyList(n,i,r,o)}case"string":{const t=new Ef(e);t.parse();const n=t.families,i=t.size.toLowerCase();let r=0;switch(i){case"xx-small":r=7;break;case"x-small":r=10;break;case"small":case"smaller":r=13;break;case"medium":r=16;break;case"large":case"larger":r=18;break;case"x-large":r=24;break;case"xx-large":r=32;break;default:try{r=i.endsWith("em")?16*Number.parseFloat(i.substr(0,i.length-2)):i.endsWith("pt")?16*Number.parseFloat(i.substr(0,i.length-2))/12:i.endsWith("px")?Number.parseFloat(i.substr(0,i.length-2)):12}catch{r=12}}let o=ts.Plain;"italic"===t.style&&(o=ts.Italic);let a=Or.Regular;switch(t.weight.toLowerCase()){case"normal":case"lighter":break;default:a=Or.Bold}return Ke.withFamilyList(n,r,o,a)}}}static toJson(e){if(!e)return;const t=new Map;return t.set("families",e.families),t.set("size",e.size),t.set("style",e.style),t.set("weight",e.weight),t}}let Hne=(()=>{class s{constructor(){this.copyrightFont=new Ke(s.sansFont,12,ts.Plain,Or.Bold),this.titleFont=new Ke(s.serifFont,32,ts.Plain),this.subTitleFont=new Ke(s.serifFont,20,ts.Plain),this.wordsFont=new Ke(s.serifFont,15,ts.Plain),this.effectFont=new Ke(s.serifFont,12,ts.Italic),this.timerFont=new Ke(s.serifFont,12,ts.Plain),this.directionsFont=new Ke(s.serifFont,14,ts.Plain),this.fretboardNumberFont=new Ke(s.sansFont,11,ts.Plain),this.numberedNotationFont=new Ke(s.sansFont,16,ts.Plain),this.numberedNotationGraceFont=new Ke(s.sansFont,14,ts.Plain),this.tablatureFont=new Ke(s.sansFont,13,ts.Plain),this.graceFont=new Ke(s.sansFont,11,ts.Plain),this.staffLineColor=new _n(165,165,165,255),this.barSeparatorColor=new _n(34,34,17,255),this.barNumberFont=new Ke(s.sansFont,11,ts.Plain),this.barNumberColor=new _n(200,0,0,255),this.fingeringFont=new Ke(s.serifFont,14,ts.Plain),this.inlineFingeringFont=new Ke(s.serifFont,12,ts.Plain),this.markerFont=new Ke(s.serifFont,14,ts.Plain,Or.Bold),this.mainGlyphColor=new _n(0,0,0,255),this.secondaryGlyphColor=new _n(0,0,0,100),this.scoreInfoColor=new _n(0,0,0,255)}getFontForElement(t){switch(t){case re.Title:return this.titleFont;case re.SubTitle:case re.Artist:case re.Album:return this.subTitleFont;case re.Words:case re.Music:case re.WordsAndMusic:case re.Transcriber:return this.wordsFont;case re.Copyright:case re.CopyrightSecondLine:return this.copyrightFont}return this.wordsFont}}return s.sansFont="Arial, sans-serif",s.serifFont="Georgia, serif",s})();var Lh=function(s){return s[s.Automatic=0]="Automatic",s[s.UseModelLayout=1]="UseModelLayout",s}(Lh||{});class Wne{constructor(){this.scale=1,this.stretchForce=1,this.layoutMode=fu.Page,this.staveProfile=pu.Default,this.barsPerRow=-1,this.startBar=1,this.barCount=-1,this.barCountPerPartial=10,this.justifyLastSystem=!1,this.resources=new Hne,this.padding=[35,35],this.firstSystemPaddingTop=5,this.systemPaddingTop=10,this.systemPaddingBottom=20,this.lastSystemPaddingBottom=0,this.systemLabelPaddingLeft=0,this.systemLabelPaddingRight=3,this.accoladeBarPaddingRight=3,this.notationStaffPaddingTop=5,this.notationStaffPaddingBottom=5,this.effectStaffPaddingTop=0,this.effectStaffPaddingBottom=0,this.firstStaffPaddingLeft=6,this.staffPaddingLeft=2,this.systemsLayoutMode=Lh.Automatic}}class Gne{constructor(){this.encoding="utf-8",this.mergePartGroupsInMusicXml=!1,this.beatTextAsLyrics=!1}}var bc=function(s){return s[s.Off=0]="Off",s[s.Continuous=1]="Continuous",s[s.OffScreen=2]="OffScreen",s}(bc||{});class Une{constructor(){this.noteWideLength=240,this.noteWideAmplitude=1,this.noteSlightLength=360,this.noteSlightAmplitude=.5,this.beatWideLength=480,this.beatWideAmplitude=2,this.beatSlightLength=480,this.beatSlightAmplitude=2}}class zne{constructor(){this.simpleSlidePitchOffset=6,this.simpleSlideDurationRatio=.25,this.shiftSlideDurationRatio=.5}}var cw=function(s){return s[s.WebAudioAudioWorklets=0]="WebAudioAudioWorklets",s[s.WebAudioScriptProcessor=1]="WebAudioScriptProcessor",s}(cw||{}),vr=function(s){return s[s.Disabled=0]="Disabled",s[s.EnabledAutomatic=1]="EnabledAutomatic",s[s.EnabledSynthesizer=2]="EnabledSynthesizer",s[s.EnabledBackingTrack=3]="EnabledBackingTrack",s[s.EnabledExternalMedia=4]="EnabledExternalMedia",s}(vr||{});class qne{constructor(){this.soundFont=null,this.scrollElement="html,body",this.outputMode=cw.WebAudioAudioWorklets,this.enablePlayer=!1,this.playerMode=vr.Disabled,this.enableCursor=!0,this.enableAnimatedBeatCursor=!0,this.enableElementHighlighting=!0,this.enableUserInteraction=!0,this.scrollOffsetX=0,this.scrollOffsetY=0,this.scrollMode=bc.Continuous,this.scrollSpeed=300,this.nativeBrowserSmoothScroll=!0,this.songBookBendDuration=75,this.songBookDipDuration=150,this.vibrato=new Une,this.slide=new zne,this.playTripletFeel=!0,this.bufferTimeInMilliseconds=500}}class Kg{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Kg.setProperty(e,i.toLowerCase(),n))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("scriptfile",e.scriptFile),t.set("fontdirectory",e.fontDirectory),null!==e.smuflFontSources){const n=new Map;t.set("smuflfontsources",n);for(const[i,r]of e.smuflFontSources)n.set(i.toString(),r)}return t.set("file",e.file),t.set("tex",e.tex),t.set("tracks",e.tracks),t.set("enablelazyloading",e.enableLazyLoading),t.set("engine",e.engine),t.set("loglevel",e.logLevel),t.set("useworkers",e.useWorkers),t.set("includenotebounds",e.includeNoteBounds),t}static setProperty(e,t,n){switch(t){case"scriptfile":return e.scriptFile=n,!0;case"fontdirectory":return e.fontDirectory=n,!0;case"smuflfontsources":return e.smuflFontSources=new Map,O.forEach(n,(i,r)=>{e.smuflFontSources.set(O.parseEnum(r,Ya),i)}),!0;case"file":return e.file=n,!0;case"tex":return e.tex=n,!0;case"tracks":return e.tracks=n,!0;case"enablelazyloading":return e.enableLazyLoading=n,!0;case"engine":return e.engine=n,!0;case"loglevel":return e.logLevel=O.parseEnum(n,Tl),!0;case"useworkers":return e.useWorkers=n,!0;case"includenotebounds":return e.includeNoteBounds=n,!0}return!1}}class em{static fromJson(e,t){t&&O.forEach(t,(n,i)=>em.setProperty(e,i.toLowerCase(),n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("smuflfont",Ke.toJson(e.smuflFont)),t.set("copyrightfont",Ke.toJson(e.copyrightFont)),t.set("titlefont",Ke.toJson(e.titleFont)),t.set("subtitlefont",Ke.toJson(e.subTitleFont)),t.set("wordsfont",Ke.toJson(e.wordsFont)),t.set("effectfont",Ke.toJson(e.effectFont)),t.set("timerfont",Ke.toJson(e.timerFont)),t.set("directionsfont",Ke.toJson(e.directionsFont)),t.set("fretboardnumberfont",Ke.toJson(e.fretboardNumberFont)),t.set("numberednotationfont",Ke.toJson(e.numberedNotationFont)),t.set("numberednotationgracefont",Ke.toJson(e.numberedNotationGraceFont)),t.set("tablaturefont",Ke.toJson(e.tablatureFont)),t.set("gracefont",Ke.toJson(e.graceFont)),t.set("stafflinecolor",_n.toJson(e.staffLineColor)),t.set("barseparatorcolor",_n.toJson(e.barSeparatorColor)),t.set("barnumberfont",Ke.toJson(e.barNumberFont)),t.set("barnumbercolor",_n.toJson(e.barNumberColor)),t.set("fingeringfont",Ke.toJson(e.fingeringFont)),t.set("inlinefingeringfont",Ke.toJson(e.inlineFingeringFont)),t.set("markerfont",Ke.toJson(e.markerFont)),t.set("mainglyphcolor",_n.toJson(e.mainGlyphColor)),t.set("secondaryglyphcolor",_n.toJson(e.secondaryGlyphColor)),t.set("scoreinfocolor",_n.toJson(e.scoreInfoColor)),t}static setProperty(e,t,n){switch(t){case"smuflfont":return e.smuflFont=Ke.fromJson(n),!0;case"copyrightfont":return e.copyrightFont=Ke.fromJson(n),!0;case"titlefont":return e.titleFont=Ke.fromJson(n),!0;case"subtitlefont":return e.subTitleFont=Ke.fromJson(n),!0;case"wordsfont":return e.wordsFont=Ke.fromJson(n),!0;case"effectfont":return e.effectFont=Ke.fromJson(n),!0;case"timerfont":return e.timerFont=Ke.fromJson(n),!0;case"directionsfont":return e.directionsFont=Ke.fromJson(n),!0;case"fretboardnumberfont":return e.fretboardNumberFont=Ke.fromJson(n),!0;case"numberednotationfont":return e.numberedNotationFont=Ke.fromJson(n),!0;case"numberednotationgracefont":return e.numberedNotationGraceFont=Ke.fromJson(n),!0;case"tablaturefont":return e.tablatureFont=Ke.fromJson(n),!0;case"gracefont":return e.graceFont=Ke.fromJson(n),!0;case"stafflinecolor":return e.staffLineColor=_n.fromJson(n),!0;case"barseparatorcolor":return e.barSeparatorColor=_n.fromJson(n),!0;case"barnumberfont":return e.barNumberFont=Ke.fromJson(n),!0;case"barnumbercolor":return e.barNumberColor=_n.fromJson(n),!0;case"fingeringfont":return e.fingeringFont=Ke.fromJson(n),!0;case"inlinefingeringfont":return e.inlineFingeringFont=Ke.fromJson(n),!0;case"markerfont":return e.markerFont=Ke.fromJson(n),!0;case"mainglyphcolor":return e.mainGlyphColor=_n.fromJson(n),!0;case"secondaryglyphcolor":return e.secondaryGlyphColor=_n.fromJson(n),!0;case"scoreinfocolor":return e.scoreInfoColor=_n.fromJson(n),!0}return!1}}class tm{static fromJson(e,t){t&&O.forEach(t,(n,i)=>tm.setProperty(e,i.toLowerCase(),n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("scale",e.scale),t.set("stretchforce",e.stretchForce),t.set("layoutmode",e.layoutMode),t.set("staveprofile",e.staveProfile),t.set("barsperrow",e.barsPerRow),t.set("startbar",e.startBar),t.set("barcount",e.barCount),t.set("barcountperpartial",e.barCountPerPartial),t.set("justifylastsystem",e.justifyLastSystem),t.set("resources",em.toJson(e.resources)),t.set("padding",e.padding),t.set("firstsystempaddingtop",e.firstSystemPaddingTop),t.set("systempaddingtop",e.systemPaddingTop),t.set("systempaddingbottom",e.systemPaddingBottom),t.set("lastsystempaddingbottom",e.lastSystemPaddingBottom),t.set("systemlabelpaddingleft",e.systemLabelPaddingLeft),t.set("systemlabelpaddingright",e.systemLabelPaddingRight),t.set("accoladebarpaddingright",e.accoladeBarPaddingRight),t.set("notationstaffpaddingtop",e.notationStaffPaddingTop),t.set("notationstaffpaddingbottom",e.notationStaffPaddingBottom),t.set("effectstaffpaddingtop",e.effectStaffPaddingTop),t.set("effectstaffpaddingbottom",e.effectStaffPaddingBottom),t.set("firststaffpaddingleft",e.firstStaffPaddingLeft),t.set("staffpaddingleft",e.staffPaddingLeft),t.set("systemslayoutmode",e.systemsLayoutMode),t}static setProperty(e,t,n){switch(t){case"scale":return e.scale=n,!0;case"stretchforce":return e.stretchForce=n,!0;case"layoutmode":return e.layoutMode=O.parseEnum(n,fu),!0;case"staveprofile":return e.staveProfile=O.parseEnum(n,pu),!0;case"barsperrow":return e.barsPerRow=n,!0;case"startbar":return e.startBar=n,!0;case"barcount":return e.barCount=n,!0;case"barcountperpartial":return e.barCountPerPartial=n,!0;case"justifylastsystem":return e.justifyLastSystem=n,!0;case"padding":return e.padding=n,!0;case"firstsystempaddingtop":return e.firstSystemPaddingTop=n,!0;case"systempaddingtop":return e.systemPaddingTop=n,!0;case"systempaddingbottom":return e.systemPaddingBottom=n,!0;case"lastsystempaddingbottom":return e.lastSystemPaddingBottom=n,!0;case"systemlabelpaddingleft":return e.systemLabelPaddingLeft=n,!0;case"systemlabelpaddingright":return e.systemLabelPaddingRight=n,!0;case"accoladebarpaddingright":return e.accoladeBarPaddingRight=n,!0;case"notationstaffpaddingtop":return e.notationStaffPaddingTop=n,!0;case"notationstaffpaddingbottom":return e.notationStaffPaddingBottom=n,!0;case"effectstaffpaddingtop":return e.effectStaffPaddingTop=n,!0;case"effectstaffpaddingbottom":return e.effectStaffPaddingBottom=n,!0;case"firststaffpaddingleft":return e.firstStaffPaddingLeft=n,!0;case"staffpaddingleft":return e.staffPaddingLeft=n,!0;case"systemslayoutmode":return e.systemsLayoutMode=O.parseEnum(n,Lh),!0}if(["resources"].indexOf(t)>=0)return em.fromJson(e.resources,n),!0;for(const i of["resources"])if(0===t.indexOf(i)&&em.setProperty(e.resources,t.substring(i.length),n))return!0;return!1}}class nm{static fromJson(e,t){t&&O.forEach(t,(n,i)=>nm.setProperty(e,i.toLowerCase(),n))}static toJson(e){if(!e)return null;const t=new Map;t.set("notationmode",e.notationMode),t.set("fingeringmode",e.fingeringMode);{const n=new Map;t.set("elements",n);for(const[i,r]of e.elements)n.set(i.toString(),r)}return t.set("rhythmmode",e.rhythmMode),t.set("rhythmheight",e.rhythmHeight),t.set("transpositionpitches",e.transpositionPitches),t.set("displaytranspositionpitches",e.displayTranspositionPitches),t.set("smallgracetabnotes",e.smallGraceTabNotes),t.set("extendbendarrowsontiednotes",e.extendBendArrowsOnTiedNotes),t.set("extendlineeffectstobeatend",e.extendLineEffectsToBeatEnd),t.set("slurheight",e.slurHeight),t}static setProperty(e,t,n){switch(t){case"notationmode":return e.notationMode=O.parseEnum(n,xi),!0;case"fingeringmode":return e.fingeringMode=O.parseEnum(n,vl),!0;case"elements":return e.elements=new Map,O.forEach(n,(i,r)=>{e.elements.set(O.parseEnum(r,dt),i)}),!0;case"rhythmmode":return e.rhythmMode=O.parseEnum(n,Wa),!0;case"rhythmheight":return e.rhythmHeight=n,!0;case"transpositionpitches":return e.transpositionPitches=n,!0;case"displaytranspositionpitches":return e.displayTranspositionPitches=n,!0;case"smallgracetabnotes":return e.smallGraceTabNotes=n,!0;case"extendbendarrowsontiednotes":return e.extendBendArrowsOnTiedNotes=n,!0;case"extendlineeffectstobeatend":return e.extendLineEffectsToBeatEnd=n,!0;case"slurheight":return e.slurHeight=n,!0}return!1}}class sm{static fromJson(e,t){t&&O.forEach(t,(n,i)=>sm.setProperty(e,i.toLowerCase(),n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("encoding",e.encoding),t.set("mergepartgroupsinmusicxml",e.mergePartGroupsInMusicXml),t.set("beattextaslyrics",e.beatTextAsLyrics),t}static setProperty(e,t,n){switch(t){case"encoding":return e.encoding=n,!0;case"mergepartgroupsinmusicxml":return e.mergePartGroupsInMusicXml=n,!0;case"beattextaslyrics":return e.beatTextAsLyrics=n,!0}return!1}}class im{static fromJson(e,t){t&&O.forEach(t,(n,i)=>im.setProperty(e,i.toLowerCase(),n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("notewidelength",e.noteWideLength),t.set("notewideamplitude",e.noteWideAmplitude),t.set("noteslightlength",e.noteSlightLength),t.set("noteslightamplitude",e.noteSlightAmplitude),t.set("beatwidelength",e.beatWideLength),t.set("beatwideamplitude",e.beatWideAmplitude),t.set("beatslightlength",e.beatSlightLength),t.set("beatslightamplitude",e.beatSlightAmplitude),t}static setProperty(e,t,n){switch(t){case"notewidelength":return e.noteWideLength=n,!0;case"notewideamplitude":return e.noteWideAmplitude=n,!0;case"noteslightlength":return e.noteSlightLength=n,!0;case"noteslightamplitude":return e.noteSlightAmplitude=n,!0;case"beatwidelength":return e.beatWideLength=n,!0;case"beatwideamplitude":return e.beatWideAmplitude=n,!0;case"beatslightlength":return e.beatSlightLength=n,!0;case"beatslightamplitude":return e.beatSlightAmplitude=n,!0}return!1}}class rm{static fromJson(e,t){t&&O.forEach(t,(n,i)=>rm.setProperty(e,i.toLowerCase(),n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("simpleslidepitchoffset",e.simpleSlidePitchOffset),t.set("simpleslidedurationratio",e.simpleSlideDurationRatio),t.set("shiftslidedurationratio",e.shiftSlideDurationRatio),t}static setProperty(e,t,n){switch(t){case"simpleslidepitchoffset":return e.simpleSlidePitchOffset=n,!0;case"simpleslidedurationratio":return e.simpleSlideDurationRatio=n,!0;case"shiftslidedurationratio":return e.shiftSlideDurationRatio=n,!0}return!1}}class om{static fromJson(e,t){t&&O.forEach(t,(n,i)=>om.setProperty(e,i.toLowerCase(),n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("soundfont",e.soundFont),t.set("outputmode",e.outputMode),t.set("enableplayer",e.enablePlayer),t.set("playermode",e.playerMode),t.set("enablecursor",e.enableCursor),t.set("enableanimatedbeatcursor",e.enableAnimatedBeatCursor),t.set("enableelementhighlighting",e.enableElementHighlighting),t.set("enableuserinteraction",e.enableUserInteraction),t.set("scrolloffsetx",e.scrollOffsetX),t.set("scrolloffsety",e.scrollOffsetY),t.set("scrollmode",e.scrollMode),t.set("scrollspeed",e.scrollSpeed),t.set("nativebrowsersmoothscroll",e.nativeBrowserSmoothScroll),t.set("songbookbendduration",e.songBookBendDuration),t.set("songbookdipduration",e.songBookDipDuration),t.set("vibrato",im.toJson(e.vibrato)),t.set("slide",rm.toJson(e.slide)),t.set("playtripletfeel",e.playTripletFeel),t.set("buffertimeinmilliseconds",e.bufferTimeInMilliseconds),t}static setProperty(e,t,n){switch(t){case"soundfont":return e.soundFont=n,!0;case"scrollelement":return e.scrollElement=n,!0;case"outputmode":return e.outputMode=O.parseEnum(n,cw),!0;case"enableplayer":return e.enablePlayer=n,!0;case"playermode":return e.playerMode=O.parseEnum(n,vr),!0;case"enablecursor":return e.enableCursor=n,!0;case"enableanimatedbeatcursor":return e.enableAnimatedBeatCursor=n,!0;case"enableelementhighlighting":return e.enableElementHighlighting=n,!0;case"enableuserinteraction":return e.enableUserInteraction=n,!0;case"scrolloffsetx":return e.scrollOffsetX=n,!0;case"scrolloffsety":return e.scrollOffsetY=n,!0;case"scrollmode":return e.scrollMode=O.parseEnum(n,bc),!0;case"scrollspeed":return e.scrollSpeed=n,!0;case"nativebrowsersmoothscroll":return e.nativeBrowserSmoothScroll=n,!0;case"songbookbendduration":return e.songBookBendDuration=n,!0;case"songbookdipduration":return e.songBookDipDuration=n,!0;case"playtripletfeel":return e.playTripletFeel=n,!0;case"buffertimeinmilliseconds":return e.bufferTimeInMilliseconds=n,!0}if(["vibrato"].indexOf(t)>=0)return im.fromJson(e.vibrato,n),!0;for(const i of["vibrato"])if(0===t.indexOf(i)&&im.setProperty(e.vibrato,t.substring(i.length),n))return!0;if(["slide"].indexOf(t)>=0)return rm.fromJson(e.slide,n),!0;for(const i of["slide"])if(0===t.indexOf(i)&&rm.setProperty(e.slide,t.substring(i.length),n))return!0;return!1}}class _u{static fromJson(e,t){t&&O.forEach(t,(n,i)=>_u.setProperty(e,i.toLowerCase(),n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("core",Kg.toJson(e.core)),t.set("display",tm.toJson(e.display)),t.set("notation",nm.toJson(e.notation)),t.set("importer",sm.toJson(e.importer)),t.set("player",om.toJson(e.player)),t}static setProperty(e,t,n){if(["core",""].indexOf(t)>=0)return Kg.fromJson(e.core,n),!0;for(const i of["core",""])if(0===t.indexOf(i)&&Kg.setProperty(e.core,t.substring(i.length),n))return!0;if(["display",""].indexOf(t)>=0)return tm.fromJson(e.display,n),!0;for(const i of["display",""])if(0===t.indexOf(i)&&tm.setProperty(e.display,t.substring(i.length),n))return!0;if(["notation"].indexOf(t)>=0)return nm.fromJson(e.notation,n),!0;for(const i of["notation"])if(0===t.indexOf(i)&&nm.setProperty(e.notation,t.substring(i.length),n))return!0;if(["importer"].indexOf(t)>=0)return sm.fromJson(e.importer,n),!0;for(const i of["importer"])if(0===t.indexOf(i)&&sm.setProperty(e.importer,t.substring(i.length),n))return!0;if(["player"].indexOf(t)>=0)return om.fromJson(e.player,n),!0;for(const i of["player"])if(0===t.indexOf(i)&&om.setProperty(e.player,t.substring(i.length),n))return!0;return!1}}class wc{constructor(){this.core=new kx,this.display=new Wne,this.notation=new Hg,this.importer=new Gne,this.player=new qne}setSongBookModeSettings(){this.notation.notationMode=xi.SongBook,this.notation.smallGraceTabNotes=!1,this.notation.fingeringMode=vl.SingleNoteEffectBand,this.notation.extendBendArrowsOnTiedNotes=!1,this.notation.elements.set(dt.ParenthesisOnTiedBends,!1),this.notation.elements.set(dt.TabNotesOnTiedBends,!1),this.notation.elements.set(dt.ZerosOnDiveWhammys,!0)}static get songBook(){const e=new wc;return e.setSongBookModeSettings(),e}fillFromJson(e){_u.fromJson(this,e)}handleBackwardsCompatibility(){this.player.playerMode===vr.Disabled&&this.player.enablePlayer&&(this.player.playerMode=vr.EnabledAutomatic)}}class uw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>uw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("marker",e.marker),t.set("text",e.text),t}static setProperty(e,t,n){switch(t){case"marker":return e.marker=n,!0;case"text":return e.text=n,!0}return!1}}class hw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>hw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("baroccurence",e.barOccurence),t.set("millisecondoffset",e.millisecondOffset),t}static setProperty(e,t,n){switch(t){case"baroccurence":return e.barOccurence=n,!0;case"millisecondoffset":return e.millisecondOffset=n,!0}return!1}}class bu{static fromJson(e,t){t&&O.forEach(t,(n,i)=>bu.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("islinear",e.isLinear),t.set("type",e.type),t.set("value",e.value),e.syncPointValue&&t.set("syncpointvalue",hw.toJson(e.syncPointValue)),t.set("ratioposition",e.ratioPosition),t.set("text",e.text),t}static setProperty(e,t,n){switch(t){case"islinear":return e.isLinear=n,!0;case"type":return e.type=O.parseEnum(n,$n),!0;case"value":return e.value=n,!0;case"syncpointvalue":return n?(e.syncPointValue=new Vg,hw.fromJson(e.syncPointValue,n)):e.syncPointValue=void 0,!0;case"ratioposition":return e.ratioPosition=n,!0;case"text":return e.text=n,!0}return!1}}class dw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>dw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("type",e.type),t.set("length",e.length),t}static setProperty(e,t,n){switch(t){case"type":return e.type=O.parseEnum(n,Ui),!0;case"length":return e.length=n,!0}return!1}}class fw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>fw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("alternateendings",e.alternateEndings),t.set("isdoublebar",e.isDoubleBar),t.set("isrepeatstart",e.isRepeatStart),t.set("repeatcount",e.repeatCount),t.set("timesignaturenumerator",e.timeSignatureNumerator),t.set("timesignaturedenominator",e.timeSignatureDenominator),t.set("timesignaturecommon",e.timeSignatureCommon),t.set("isfreetime",e.isFreeTime),t.set("tripletfeel",e.tripletFeel),e.section&&t.set("section",uw.toJson(e.section)),t.set("tempoautomations",e.tempoAutomations.map(n=>bu.toJson(n))),void 0!==e.syncPoints&&t.set("syncpoints",e.syncPoints?.map(n=>bu.toJson(n))),null!==e.fermata){const n=new Map;t.set("fermata",n);for(const[i,r]of e.fermata)n.set(i.toString(),dw.toJson(r))}if(t.set("start",e.start),t.set("isanacrusis",e.isAnacrusis),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),null!==e.directions){const n=[];t.set("directions",n);for(const i of e.directions)n.push(i)}return t}static setProperty(e,t,n){switch(t){case"alternateendings":return e.alternateEndings=n,!0;case"isdoublebar":return e.isDoubleBar=n,!0;case"isrepeatstart":return e.isRepeatStart=n,!0;case"repeatcount":return e.repeatCount=n,!0;case"timesignaturenumerator":return e.timeSignatureNumerator=n,!0;case"timesignaturedenominator":return e.timeSignatureDenominator=n,!0;case"timesignaturecommon":return e.timeSignatureCommon=n,!0;case"isfreetime":return e.isFreeTime=n,!0;case"tripletfeel":return e.tripletFeel=O.parseEnum(n,nt),!0;case"section":return n?(e.section=new kf,uw.fromJson(e.section,n)):e.section=null,!0;case"tempoautomations":e.tempoAutomations=[];for(const i of n){const r=new fs;bu.fromJson(r,i),e.tempoAutomations.push(r)}return!0;case"syncpoints":if(n){e.syncPoints=[];for(const i of n){const r=new fs;bu.fromJson(r,i),e.addSyncPoint(r)}}return!0;case"fermata":return e.fermata=new Map,O.forEach(n,(i,r)=>{const o=new Cf;dw.fromJson(o,i),e.addFermata(Number.parseInt(r),o)}),!0;case"start":return e.start=n,!0;case"isanacrusis":return e.isAnacrusis=n,!0;case"displayscale":return e.displayScale=n,!0;case"displaywidth":return e.displayWidth=n,!0;case"directions":for(const i of n)e.addDirection(O.parseEnum(i,j));return!0}return!1}}class If{static fromJson(e,t){t&&O.forEach(t,(n,i)=>If.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("offset",e.offset),t.set("value",e.value),t}static setProperty(e,t,n){switch(t){case"offset":return e.offset=n,!0;case"value":return e.value=n,!0}return!1}}class pw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>pw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;t.set("notehead",e.noteHead),t.set("noteheadcenteronstem",e.noteHeadCenterOnStem);{const n=new Map;t.set("colors",n);for(const[i,r]of e.colors)n.set(i.toString(),_n.toJson(r))}return t}static setProperty(e,t,n){switch(t){case"notehead":return e.noteHead=O.parseEnum(n,f),!0;case"noteheadcenteronstem":return e.noteHeadCenterOnStem=n,!0;case"colors":return e.colors=new Map,O.forEach(n,(i,r)=>{e.colors.set(O.parseEnum(r,Qi),_n.fromJson(i))}),!0}return!1}}class gw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>gw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("accentuated",e.accentuated),t.set("bendtype",e.bendType),t.set("bendstyle",e.bendStyle),t.set("iscontinuedbend",e.isContinuedBend),null!==e.bendPoints&&t.set("bendpoints",e.bendPoints?.map(n=>If.toJson(n))),t.set("fret",e.fret),t.set("string",e.string),t.set("showstringnumber",e.showStringNumber),t.set("octave",e.octave),t.set("tone",e.tone),t.set("percussionarticulation",e.percussionArticulation),t.set("isvisible",e.isVisible),t.set("islefthandtapped",e.isLeftHandTapped),t.set("ishammerpullorigin",e.isHammerPullOrigin),t.set("isslurdestination",e.isSlurDestination),t.set("harmonictype",e.harmonicType),t.set("harmonicvalue",e.harmonicValue),t.set("isghost",e.isGhost),t.set("isletring",e.isLetRing),t.set("ispalmmute",e.isPalmMute),t.set("isdead",e.isDead),t.set("isstaccato",e.isStaccato),t.set("slideintype",e.slideInType),t.set("slideouttype",e.slideOutType),t.set("vibrato",e.vibrato),t.set("istiedestination",e.isTieDestination),t.set("lefthandfinger",e.leftHandFinger),t.set("righthandfinger",e.rightHandFinger),t.set("trillvalue",e.trillValue),t.set("trillspeed",e.trillSpeed),t.set("durationpercent",e.durationPercent),t.set("accidentalmode",e.accidentalMode),t.set("dynamics",e.dynamics),t.set("ornament",e.ornament),e.style&&t.set("style",pw.toJson(e.style)),e.toJson(t),t}static setProperty(e,t,n){switch(t){case"id":return e.id=n,!0;case"accentuated":return e.accentuated=O.parseEnum(n,Ss),!0;case"bendtype":return e.bendType=O.parseEnum(n,me),!0;case"bendstyle":return e.bendStyle=O.parseEnum(n,Cn),!0;case"iscontinuedbend":return e.isContinuedBend=n,!0;case"bendpoints":if(n){e.bendPoints=[];for(const i of n){const r=new se;If.fromJson(r,i),e.addBendPoint(r)}}return!0;case"fret":return e.fret=n,!0;case"string":return e.string=n,!0;case"showstringnumber":return e.showStringNumber=n,!0;case"octave":return e.octave=n,!0;case"tone":return e.tone=n,!0;case"percussionarticulation":return e.percussionArticulation=n,!0;case"isvisible":return e.isVisible=n,!0;case"islefthandtapped":return e.isLeftHandTapped=n,!0;case"ishammerpullorigin":return e.isHammerPullOrigin=n,!0;case"isslurdestination":return e.isSlurDestination=n,!0;case"harmonictype":return e.harmonicType=O.parseEnum(n,Ie),!0;case"harmonicvalue":return e.harmonicValue=n,!0;case"isghost":return e.isGhost=n,!0;case"isletring":return e.isLetRing=n,!0;case"ispalmmute":return e.isPalmMute=n,!0;case"isdead":return e.isDead=n,!0;case"isstaccato":return e.isStaccato=n,!0;case"slideintype":return e.slideInType=O.parseEnum(n,ri),!0;case"slideouttype":return e.slideOutType=O.parseEnum(n,Qe),!0;case"vibrato":return e.vibrato=O.parseEnum(n,Ft),!0;case"istiedestination":return e.isTieDestination=n,!0;case"lefthandfinger":return e.leftHandFinger=O.parseEnum(n,Ne),!0;case"righthandfinger":return e.rightHandFinger=O.parseEnum(n,Ne),!0;case"trillvalue":return e.trillValue=n,!0;case"trillspeed":return e.trillSpeed=O.parseEnum(n,w),!0;case"durationpercent":return e.durationPercent=n,!0;case"accidentalmode":return e.accidentalMode=O.parseEnum(n,mt),!0;case"dynamics":return e.dynamics=O.parseEnum(n,Te),!0;case"ornament":return e.ornament=O.parseEnum(n,vs),!0;case"style":return n?(e.style=new yD,pw.fromJson(e.style,n)):e.style=void 0,!0}return e.setProperty(t,n)}}class mw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>mw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;{const n=new Map;t.set("colors",n);for(const[i,r]of e.colors)n.set(i.toString(),_n.toJson(r))}return t}static setProperty(e,t,n){return"colors"===t&&(e.colors=new Map,O.forEach(n,(i,r)=>{e.colors.set(O.parseEnum(r,In),_n.fromJson(i))}),!0)}}class yw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>yw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("notes",e.notes.map(n=>gw.toJson(n))),t.set("isempty",e.isEmpty),t.set("whammystyle",e.whammyStyle),t.set("ottava",e.ottava),t.set("islegatoorigin",e.isLegatoOrigin),t.set("duration",e.duration),t.set("automations",e.automations.map(n=>bu.toJson(n))),t.set("dots",e.dots),t.set("fade",e.fade),t.set("lyrics",e.lyrics),t.set("pop",e.pop),t.set("slap",e.slap),t.set("tap",e.tap),t.set("text",e.text),t.set("slashed",e.slashed),t.set("deadslapped",e.deadSlapped),t.set("brushtype",e.brushType),t.set("brushduration",e.brushDuration),t.set("tupletdenominator",e.tupletDenominator),t.set("tupletnumerator",e.tupletNumerator),t.set("iscontinuedwhammy",e.isContinuedWhammy),t.set("whammybartype",e.whammyBarType),null!==e.whammyBarPoints&&t.set("whammybarpoints",e.whammyBarPoints?.map(n=>If.toJson(n))),t.set("vibrato",e.vibrato),t.set("chordid",e.chordId),t.set("gracetype",e.graceType),t.set("pickstroke",e.pickStroke),t.set("tremolospeed",e.tremoloSpeed),t.set("crescendo",e.crescendo),t.set("displaystart",e.displayStart),t.set("playbackstart",e.playbackStart),t.set("displayduration",e.displayDuration),t.set("playbackduration",e.playbackDuration),t.set("overridedisplayduration",e.overrideDisplayDuration),t.set("golpe",e.golpe),t.set("dynamics",e.dynamics),t.set("invertbeamdirection",e.invertBeamDirection),t.set("preferredbeamdirection",e.preferredBeamDirection),t.set("beamingmode",e.beamingMode),t.set("wahpedal",e.wahPedal),t.set("barrefret",e.barreFret),t.set("barreshape",e.barreShape),t.set("rasgueado",e.rasgueado),t.set("showtimer",e.showTimer),t.set("timer",e.timer),e.style&&t.set("style",mw.toJson(e.style)),t}static setProperty(e,t,n){switch(t){case"id":return e.id=n,!0;case"notes":e.notes=[];for(const i of n){const r=new Co;gw.fromJson(r,i),e.addNote(r)}return!0;case"isempty":return e.isEmpty=n,!0;case"whammystyle":return e.whammyStyle=O.parseEnum(n,Cn),!0;case"ottava":return e.ottava=O.parseEnum(n,Ze),!0;case"islegatoorigin":return e.isLegatoOrigin=n,!0;case"duration":return e.duration=O.parseEnum(n,w),!0;case"automations":e.automations=[];for(const i of n){const r=new fs;bu.fromJson(r,i),e.automations.push(r)}return!0;case"dots":return e.dots=n,!0;case"fade":return e.fade=O.parseEnum(n,Ks),!0;case"lyrics":return e.lyrics=n,!0;case"pop":return e.pop=n,!0;case"slap":return e.slap=n,!0;case"tap":return e.tap=n,!0;case"text":return e.text=n,!0;case"slashed":return e.slashed=n,!0;case"deadslapped":return e.deadSlapped=n,!0;case"brushtype":return e.brushType=O.parseEnum(n,fe),!0;case"brushduration":return e.brushDuration=n,!0;case"tupletdenominator":return e.tupletDenominator=n,!0;case"tupletnumerator":return e.tupletNumerator=n,!0;case"iscontinuedwhammy":return e.isContinuedWhammy=n,!0;case"whammybartype":return e.whammyBarType=O.parseEnum(n,Wt),!0;case"whammybarpoints":if(n){e.whammyBarPoints=[];for(const i of n){const r=new se;If.fromJson(r,i),e.addWhammyBarPoint(r)}}return!0;case"vibrato":return e.vibrato=O.parseEnum(n,Ft),!0;case"chordid":return e.chordId=n,!0;case"gracetype":return e.graceType=O.parseEnum(n,Ee),!0;case"pickstroke":return e.pickStroke=O.parseEnum(n,yi),!0;case"tremolospeed":return e.tremoloSpeed=O.parseEnum(n,w)??null,!0;case"crescendo":return e.crescendo=O.parseEnum(n,Zi),!0;case"displaystart":return e.displayStart=n,!0;case"playbackstart":return e.playbackStart=n,!0;case"displayduration":return e.displayDuration=n,!0;case"playbackduration":return e.playbackDuration=n,!0;case"overridedisplayduration":return e.overrideDisplayDuration=n,!0;case"golpe":return e.golpe=O.parseEnum(n,Rr),!0;case"dynamics":return e.dynamics=O.parseEnum(n,Te),!0;case"invertbeamdirection":return e.invertBeamDirection=n,!0;case"preferredbeamdirection":return e.preferredBeamDirection=O.parseEnum(n,V)??null,!0;case"beamingmode":return e.beamingMode=O.parseEnum(n,jn),!0;case"wahpedal":return e.wahPedal=O.parseEnum(n,eo),!0;case"barrefret":return e.barreFret=n,!0;case"barreshape":return e.barreShape=O.parseEnum(n,to),!0;case"rasgueado":return e.rasgueado=O.parseEnum(n,ge),!0;case"showtimer":return e.showTimer=n,!0;case"timer":return e.timer=n,!0;case"style":return n?(e.style=new T2,mw.fromJson(e.style,n)):e.style=void 0,!0}return!1}}class _w{static fromJson(e,t){t&&O.forEach(t,(n,i)=>_w.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;{const n=new Map;t.set("colors",n);for(const[i,r]of e.colors)n.set(i.toString(),_n.toJson(r))}return t}static setProperty(e,t,n){return"colors"===t&&(e.colors=new Map,O.forEach(n,(i,r)=>{e.colors.set(O.parseEnum(r,Gg),_n.fromJson(i))}),!0)}}class bw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>bw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("beats",e.beats.map(n=>yw.toJson(n))),e.style&&t.set("style",_w.toJson(e.style)),t}static setProperty(e,t,n){switch(t){case"id":return e.id=n,!0;case"beats":e.beats=[];for(const i of n){const r=new Ei;yw.fromJson(r,i),e.addBeat(r)}return!0;case"style":return n?(e.style=new b2,_w.fromJson(e.style,n)):e.style=void 0,!0}return!1}}class ww{static fromJson(e,t){t&&O.forEach(t,(n,i)=>ww.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("ratioposition",e.ratioPosition),t.set("pedaltype",e.pedalType),t}static setProperty(e,t,n){switch(t){case"ratioposition":return e.ratioPosition=n,!0;case"pedaltype":return e.pedalType=O.parseEnum(n,Ms),!0}return!1}}class Sw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Sw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;{const n=new Map;t.set("colors",n);for(const[i,r]of e.colors)n.set(i.toString(),_n.toJson(r))}return t}static setProperty(e,t,n){return"colors"===t&&(e.colors=new Map,O.forEach(n,(i,r)=>{e.colors.set(O.parseEnum(r,Ht),_n.fromJson(i))}),!0)}}class vw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>vw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("clef",e.clef),t.set("clefottava",e.clefOttava),t.set("voices",e.voices.map(n=>bw.toJson(n))),t.set("similemark",e.simileMark),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),t.set("sustainpedals",e.sustainPedals.map(n=>ww.toJson(n))),t.set("barlineleft",e.barLineLeft),t.set("barlineright",e.barLineRight),t.set("keysignature",e.keySignature),t.set("keysignaturetype",e.keySignatureType),e.style&&t.set("style",Sw.toJson(e.style)),t}static setProperty(e,t,n){switch(t){case"id":return e.id=n,!0;case"clef":return e.clef=O.parseEnum(n,Et),!0;case"clefottava":return e.clefOttava=O.parseEnum(n,Ze),!0;case"voices":e.voices=[];for(const i of n){const r=new ko;bw.fromJson(r,i),e.addVoice(r)}return!0;case"similemark":return e.simileMark=O.parseEnum(n,ws),!0;case"displayscale":return e.displayScale=n,!0;case"displaywidth":return e.displayWidth=n,!0;case"sustainpedals":e.sustainPedals=[];for(const i of n){const r=new gu;ww.fromJson(r,i),e.sustainPedals.push(r)}return!0;case"barlineleft":return e.barLineLeft=O.parseEnum(n,We),!0;case"barlineright":return e.barLineRight=O.parseEnum(n,We),!0;case"keysignature":return e.keySignature=O.parseEnum(n,wt),!0;case"keysignaturetype":return e.keySignatureType=O.parseEnum(n,dr),!0;case"style":return n?(e.style=new _2,Sw.fromJson(e.style,n)):e.style=void 0,!0}return!1}}class Tw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Tw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("name",e.name),t.set("firstfret",e.firstFret),t.set("strings",e.strings),t.set("barrefrets",e.barreFrets),t.set("showname",e.showName),t.set("showdiagram",e.showDiagram),t.set("showfingering",e.showFingering),t}static setProperty(e,t,n){switch(t){case"name":return e.name=n,!0;case"firstfret":return e.firstFret=n,!0;case"strings":return e.strings=n,!0;case"barrefrets":return e.barreFrets=n,!0;case"showname":return e.showName=n,!0;case"showdiagram":return e.showDiagram=n,!0;case"showfingering":return e.showFingering=n,!0}return!1}}class kw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>kw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("isstandard",e.isStandard),t.set("name",e.name),t.set("tunings",e.tunings),t}static setProperty(e,t,n){switch(t){case"isstandard":return e.isStandard=n,!0;case"name":return e.name=n,!0;case"tunings":return e.tunings=n,!0}return!1}}class Cw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Cw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("bars",e.bars.map(n=>vw.toJson(n))),null!==e.chords){const n=new Map;t.set("chords",n);for(const[i,r]of e.chords)n.set(i.toString(),Tw.toJson(r))}return t.set("capo",e.capo),t.set("transpositionpitch",e.transpositionPitch),t.set("displaytranspositionpitch",e.displayTranspositionPitch),t.set("stringtuning",kw.toJson(e.stringTuning)),t.set("showslash",e.showSlash),t.set("shownumbered",e.showNumbered),t.set("showtablature",e.showTablature),t.set("showstandardnotation",e.showStandardNotation),t.set("ispercussion",e.isPercussion),t.set("standardnotationlinecount",e.standardNotationLineCount),t}static setProperty(e,t,n){switch(t){case"bars":e.bars=[];for(const i of n){const r=new Sl;vw.fromJson(r,i),e.addBar(r)}return!0;case"chords":return e.chords=new Map,O.forEach(n,(i,r)=>{const o=new gc;Tw.fromJson(o,i),e.addChord(r,o)}),!0;case"capo":return e.capo=n,!0;case"transpositionpitch":return e.transpositionPitch=n,!0;case"displaytranspositionpitch":return e.displayTranspositionPitch=n,!0;case"stringtuning":return kw.fromJson(e.stringTuning,n),!0;case"showslash":return e.showSlash=n,!0;case"shownumbered":return e.showNumbered=n,!0;case"showtablature":return e.showTablature=n,!0;case"showstandardnotation":return e.showStandardNotation=n,!0;case"ispercussion":return e.isPercussion=n,!0;case"standardnotationlinecount":return e.standardNotationLineCount=n,!0}return!1}}class Dw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Dw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("volume",e.volume),t.set("balance",e.balance),t.set("port",e.port),t.set("program",e.program),t.set("primarychannel",e.primaryChannel),t.set("secondarychannel",e.secondaryChannel),t.set("ismute",e.isMute),t.set("issolo",e.isSolo),t}static setProperty(e,t,n){switch(t){case"volume":return e.volume=n,!0;case"balance":return e.balance=n,!0;case"port":return e.port=n,!0;case"program":return e.program=n,!0;case"primarychannel":return e.primaryChannel=n,!0;case"secondarychannel":return e.secondaryChannel=n,!0;case"ismute":return e.isMute=n,!0;case"issolo":return e.isSolo=n,!0}return!1}}class xw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>xw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("elementtype",e.elementType),t.set("staffline",e.staffLine),t.set("noteheaddefault",e.noteHeadDefault),t.set("noteheadhalf",e.noteHeadHalf),t.set("noteheadwhole",e.noteHeadWhole),t.set("techniquesymbol",e.techniqueSymbol),t.set("techniquesymbolplacement",e.techniqueSymbolPlacement),t.set("outputmidinumber",e.outputMidiNumber),t}static setProperty(e,t,n){switch(t){case"elementtype":return e.elementType=n,!0;case"staffline":return e.staffLine=n,!0;case"noteheaddefault":return e.noteHeadDefault=O.parseEnum(n,f),!0;case"noteheadhalf":return e.noteHeadHalf=O.parseEnum(n,f),!0;case"noteheadwhole":return e.noteHeadWhole=O.parseEnum(n,f),!0;case"techniquesymbol":return e.techniqueSymbol=O.parseEnum(n,f),!0;case"techniquesymbolplacement":return e.techniqueSymbolPlacement=O.parseEnum(n,qe),!0;case"outputmidinumber":return e.outputMidiNumber=n,!0}return!1}}class Nw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Nw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;{const n=new Map;t.set("colors",n);for(const[i,r]of e.colors)n.set(i.toString(),_n.toJson(r))}return t}static setProperty(e,t,n){return"colors"===t&&(e.colors=new Map,O.forEach(n,(i,r)=>{e.colors.set(O.parseEnum(r,Dl),_n.fromJson(i))}),!0)}}class Ew{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Ew.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("staves",e.staves.map(n=>Cw.toJson(n))),t.set("playbackinfo",Dw.toJson(e.playbackInfo)),t.set("color",_n.toJson(e.color)),t.set("name",e.name),t.set("isvisibleonmultitrack",e.isVisibleOnMultiTrack),t.set("shortname",e.shortName),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),void 0!==e.lineBreaks){const n=[];t.set("linebreaks",n);for(const i of e.lineBreaks)n.push(i)}return t.set("percussionarticulations",e.percussionArticulations.map(n=>xw.toJson(n))),e.style&&t.set("style",Nw.toJson(e.style)),t}static setProperty(e,t,n){switch(t){case"staves":e.staves=[];for(const i of n){const r=new tw;Cw.fromJson(r,i),e.addStaff(r)}return!0;case"playbackinfo":return Dw.fromJson(e.playbackInfo,n),!0;case"color":return e.color=_n.fromJson(n),!0;case"name":return e.name=n,!0;case"isvisibleonmultitrack":return e.isVisibleOnMultiTrack=n,!0;case"shortname":return e.shortName=n,!0;case"defaultsystemslayout":return e.defaultSystemsLayout=n,!0;case"systemslayout":return e.systemsLayout=n,!0;case"linebreaks":for(const i of n)e.addLineBreaks(i);return!0;case"percussionarticulations":e.percussionArticulations=[];for(const i of n){const r=new he;xw.fromJson(r,i),e.percussionArticulations.push(r)}return!0;case"style":return n?(e.style=new k2,Nw.fromJson(e.style,n)):e.style=void 0,!0}return!1}}class Iw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Iw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("hidedynamics",e.hideDynamics),t.set("bracketextendmode",e.bracketExtendMode),t.set("usesystemsignseparator",e.useSystemSignSeparator),t.set("globaldisplaytuning",e.globalDisplayTuning),null!==e.perTrackDisplayTuning){const n=new Map;t.set("pertrackdisplaytuning",n);for(const[i,r]of e.perTrackDisplayTuning)n.set(i.toString(),r)}if(t.set("globaldisplaychorddiagramsontop",e.globalDisplayChordDiagramsOnTop),null!==e.perTrackChordDiagramsOnTop){const n=new Map;t.set("pertrackchorddiagramsontop",n);for(const[i,r]of e.perTrackChordDiagramsOnTop)n.set(i.toString(),r)}if(t.set("singletracktracknamepolicy",e.singleTrackTrackNamePolicy),t.set("multitracktracknamepolicy",e.multiTrackTrackNamePolicy),t.set("firstsystemtracknamemode",e.firstSystemTrackNameMode),t.set("othersystemstracknamemode",e.otherSystemsTrackNameMode),t.set("firstsystemtracknameorientation",e.firstSystemTrackNameOrientation),t.set("othersystemstracknameorientation",e.otherSystemsTrackNameOrientation),t.set("multitrackmultibarrest",e.multiTrackMultiBarRest),null!==e.perTrackMultiBarRest){const n=[];t.set("pertrackmultibarrest",n);for(const i of e.perTrackMultiBarRest)n.push(i)}return t}static setProperty(e,t,n){switch(t){case"hidedynamics":return e.hideDynamics=n,!0;case"bracketextendmode":return e.bracketExtendMode=O.parseEnum(n,Ha),!0;case"usesystemsignseparator":return e.useSystemSignSeparator=n,!0;case"globaldisplaytuning":return e.globalDisplayTuning=n,!0;case"pertrackdisplaytuning":return e.perTrackDisplayTuning=new Map,O.forEach(n,(i,r)=>{e.perTrackDisplayTuning.set(Number.parseInt(r),i)}),!0;case"globaldisplaychorddiagramsontop":return e.globalDisplayChordDiagramsOnTop=n,!0;case"pertrackchorddiagramsontop":return e.perTrackChordDiagramsOnTop=new Map,O.forEach(n,(i,r)=>{e.perTrackChordDiagramsOnTop.set(Number.parseInt(r),i)}),!0;case"singletracktracknamepolicy":return e.singleTrackTrackNamePolicy=O.parseEnum(n,rs),!0;case"multitracktracknamepolicy":return e.multiTrackTrackNamePolicy=O.parseEnum(n,rs),!0;case"firstsystemtracknamemode":return e.firstSystemTrackNameMode=O.parseEnum(n,Wi),!0;case"othersystemstracknamemode":return e.otherSystemsTrackNameMode=O.parseEnum(n,Wi),!0;case"firstsystemtracknameorientation":return e.firstSystemTrackNameOrientation=O.parseEnum(n,Gi),!0;case"othersystemstracknameorientation":return e.otherSystemsTrackNameOrientation=O.parseEnum(n,Gi),!0;case"multitrackmultibarrest":return e.multiTrackMultiBarRest=n,!0;case"pertrackmultibarrest":return e.perTrackMultiBarRest=new Set(n),!0}return!1}}class Bw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Bw.setProperty(e,i,n))}static toJson(e){return e?new Map:null}static setProperty(e,t,n){return!1}}class Mw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Mw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("template",e.template),t.set("isvisible",e.isVisible),t.set("textalign",e.textAlign),t}static setProperty(e,t,n){switch(t){case"template":return e.template=n,!0;case"isvisible":return e.isVisible=n,!0;case"textalign":return e.textAlign=O.parseEnum(n,ye),!0}return!1}}class Pw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Pw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;{const n=new Map;t.set("headerandfooter",n);for(const[i,r]of e.headerAndFooter)n.set(i.toString(),Mw.toJson(r))}{const n=new Map;t.set("colors",n);for(const[i,r]of e.colors)n.set(i.toString(),_n.toJson(r))}return t}static setProperty(e,t,n){switch(t){case"headerandfooter":return e.headerAndFooter=new Map,O.forEach(n,(i,r)=>{const o=new zo;Mw.fromJson(o,i),e.headerAndFooter.set(O.parseEnum(r,re),o)}),!0;case"colors":return e.colors=new Map,O.forEach(n,(i,r)=>{e.colors.set(O.parseEnum(r,re),_n.fromJson(i))}),!0}return!1}}class Aw{static fromJson(e,t){t&&O.forEach(t,(n,i)=>Aw.setProperty(e,i,n))}static toJson(e){if(!e)return null;const t=new Map;return t.set("album",e.album),t.set("artist",e.artist),t.set("copyright",e.copyright),t.set("instructions",e.instructions),t.set("music",e.music),t.set("notices",e.notices),t.set("subtitle",e.subTitle),t.set("title",e.title),t.set("words",e.words),t.set("tab",e.tab),t.set("tempo",e.tempo),t.set("tempolabel",e.tempoLabel),t.set("masterbars",e.masterBars.map(n=>fw.toJson(n))),t.set("tracks",e.tracks.map(n=>Ew.toJson(n))),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),t.set("stylesheet",Iw.toJson(e.stylesheet)),e.backingTrack&&t.set("backingtrack",Bw.toJson(e.backingTrack)),e.style&&t.set("style",Pw.toJson(e.style)),t}static setProperty(e,t,n){switch(t){case"album":return e.album=n,!0;case"artist":return e.artist=n,!0;case"copyright":return e.copyright=n,!0;case"instructions":return e.instructions=n,!0;case"music":return e.music=n,!0;case"notices":return e.notices=n,!0;case"subtitle":return e.subTitle=n,!0;case"title":return e.title=n,!0;case"words":return e.words=n,!0;case"tab":return e.tab=n,!0;case"tempo":return e.tempo=n,!0;case"tempolabel":return e.tempoLabel=n,!0;case"masterbars":e.masterBars=[];for(const i of n){const r=new kl;fw.fromJson(r,i),e.addMasterBar(r)}return!0;case"tracks":e.tracks=[];for(const i of n){const r=new Ph;Ew.fromJson(r,i),e.addTrack(r)}return!0;case"defaultsystemslayout":return e.defaultSystemsLayout=n,!0;case"systemslayout":return e.systemsLayout=n,!0;case"stylesheet":return Iw.fromJson(e.stylesheet,n),!0;case"backingtrack":return n?(e.backingTrack=new SD,Bw.fromJson(e.backingTrack,n)):e.backingTrack=void 0,!0;case"style":return n?(e.style=new Bh,Pw.fromJson(e.style,n)):e.style=void 0,!0}return!1}}class Os{static jsonReplacer(e,t){if(t instanceof Map){if("fromEntries"in Object)return Object.fromEntries(t);const n={};for(const[i,r]of t)n[i]=r;return n}return ArrayBuffer.isView(t)?Array.apply([],[t]):t}static scoreToJson(e){const t=Os.scoreToJsObject(e);return JSON.stringify(t,Os.jsonReplacer)}static jsonToScore(e,t){return Os.jsObjectToScore(JSON.parse(e),t)}static scoreToJsObject(e){return Aw.toJson(e)}static jsObjectToScore(e,t){const n=new Cl;return Aw.fromJson(n,e),n.finish(t??new wc),n}static settingsToJson(e){const t=Os.settingsToJsObject(e);return JSON.stringify(t,Os.jsonReplacer)}static jsonToSettings(e){return Os.jsObjectToSettings(JSON.parse(e))}static settingsToJsObject(e){return _u.toJson(e)}static jsObjectToSettings(e){const t=new wc;return _u.fromJson(t,e),t}static jsObjectToMidiFile(e){const t=new xl;return O.forEach(e,(n,i)=>{switch(i){case"division":t.division=n;break;case"tracks":for(const r of n){const o=Os.jsObjectToMidiTrack(r);t.tracks.push(o)}}}),t}static jsObjectToMidiTrack(e){const t=new ND;return O.forEach(e,(n,i)=>{if("events"===i)for(const r of n){const o=Os.jsObjectToMidiEvent(r);t.events.push(o)}}),t}static jsObjectToMidiEvent(e){const t=O.getValue(e,"track"),n=O.getValue(e,"tick"),i=O.getValue(e,"type");switch(i){case jt.TimeSignature:return new ED(t,n,O.getValue(e,"numerator"),O.getValue(e,"denominatorIndex"),O.getValue(e,"midiClocksPerMetronomeClick"),O.getValue(e,"thirdySecondNodesInQuarter"));case jt.AlphaTabRest:return new BD(t,n,O.getValue(e,"channel"));case jt.AlphaTabMetronome:return new ID(t,n,O.getValue(e,"metronomeNumerator"),O.getValue(e,"metronomeDurationInTicks"),O.getValue(e,"metronomeDurationInMilliseconds"));case jt.NoteOn:return new PD(t,n,O.getValue(e,"channel"),O.getValue(e,"noteKey"),O.getValue(e,"noteVelocity"));case jt.NoteOff:return new AD(t,n,O.getValue(e,"channel"),O.getValue(e,"noteKey"),O.getValue(e,"noteVelocity"));case jt.ControlChange:return new RD(t,n,O.getValue(e,"channel"),O.getValue(e,"controller"),O.getValue(e,"value"));case jt.ProgramChange:return new FD(t,n,O.getValue(e,"channel"),O.getValue(e,"program"));case jt.TempoChange:const r=new OD(n,0);return r.beatsPerMinute=O.getValue(e,"beatsPerMinute"),r;case jt.PitchBend:return new LD(t,n,O.getValue(e,"channel"),O.getValue(e,"value"));case jt.PerNotePitchBend:return new VD(t,n,O.getValue(e,"channel"),O.getValue(e,"noteKey"),O.getValue(e,"value"));case jt.EndOfTrack:return new HD(t,n)}throw new rn(un.Format,`Unknown Midi Event type: ${i}`)}static midiFileToJsObject(e){const t=new Map;t.set("division",e.division);const n=[];for(const i of e.tracks)n.push(Os.midiTrackToJsObject(i));return t.set("tracks",n),t}static midiTrackToJsObject(e){const t=new Map,n=[];for(const i of e.events)n.push(Os.midiEventToJsObject(i));return t.set("events",n),t}static midiEventToJsObject(e){const t=new Map;switch(t.set("track",e.track),t.set("tick",e.tick),t.set("type",e.type),e.type){case jt.TimeSignature:t.set("numerator",e.numerator),t.set("denominatorIndex",e.denominatorIndex),t.set("midiClocksPerMetronomeClick",e.midiClocksPerMetronomeClick),t.set("thirdySecondNodesInQuarter",e.thirtySecondNodesInQuarter);break;case jt.AlphaTabRest:t.set("channel",e.channel);break;case jt.AlphaTabMetronome:t.set("metronomeNumerator",e.metronomeNumerator),t.set("metronomeDurationInMilliseconds",e.metronomeDurationInMilliseconds),t.set("metronomeDurationInTicks",e.metronomeDurationInTicks);break;case jt.NoteOn:case jt.NoteOff:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("noteVelocity",e.noteVelocity);break;case jt.ControlChange:t.set("channel",e.channel),t.set("controller",e.controller),t.set("value",e.value);break;case jt.ProgramChange:t.set("channel",e.channel),t.set("program",e.program);break;case jt.TempoChange:t.set("beatsPerMinute",e.beatsPerMinute);break;case jt.PitchBend:t.set("channel",e.channel),t.set("value",e.value);break;case jt.PerNotePitchBend:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("value",e.value)}return t}}class ns{constructor(){this.ready=new ks,this.samplesPlayed=new ft,this.sampleRequest=new ks}get sampleRate(){return ns.preferredSampleRate}open(){F.debug("AlphaSynth","Initializing synth worker"),this._worker=B.globalThis,this._worker.addEventListener("message",this.handleMessage.bind(this)),this.ready.trigger()}destroy(){this._worker.postMessage({cmd:"alphaSynth.output.destroy"})}handleMessage(e){const t=e.data;switch(t.cmd){case ns.CmdOutputSampleRequest:this.sampleRequest.trigger();break;case ns.CmdOutputSamplesPlayed:this.samplesPlayed.trigger(t.samples)}}addSamples(e){this._worker.postMessage({cmd:"alphaSynth.output.addSamples",samples:B.prepareForPostMessage(e)})}play(){this._worker.postMessage({cmd:"alphaSynth.output.play"})}pause(){this._worker.postMessage({cmd:"alphaSynth.output.pause"})}resetSamples(){this._worker.postMessage({cmd:"alphaSynth.output.resetSamples"})}activate(){}enumerateOutputDevices(){return Ae(function*(){return[]})()}setOutputDevice(e){return Ae(function*(){})()}getOutputDevice(){return Ae(function*(){return null})()}}ns.CmdOutputPrefix="alphaSynth.output.",ns.CmdOutputAddSamples=`${ns.CmdOutputPrefix}addSamples`,ns.CmdOutputPlay=`${ns.CmdOutputPrefix}play`,ns.CmdOutputPause=`${ns.CmdOutputPrefix}pause`,ns.CmdOutputResetSamples=`${ns.CmdOutputPrefix}resetSamples`,ns.CmdOutputStop=`${ns.CmdOutputPrefix}stop`,ns.CmdOutputSampleRequest=`${ns.CmdOutputPrefix}sampleRequest`,ns.CmdOutputSamplesPlayed=`${ns.CmdOutputPrefix}samplesPlayed`,ns.preferredSampleRate=0;class jD{constructor(e,t){this._exporter=new Map,this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this)),this._player=new j2(new ns,t),this._player.positionChanged.on(this.onPositionChanged.bind(this)),this._player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this._player.finished.on(this.onFinished.bind(this)),this._player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.midiLoaded.on(this.onMidiLoaded.bind(this)),this._player.midiLoadFailed.on(this.onMidiLoadFailed.bind(this)),this._player.readyForPlayback.on(this.onReadyForPlayback.bind(this)),this._player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this._player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this._main.postMessage({cmd:"alphaSynth.ready"})}static init(){const e=B.globalThis;e.addEventListener("message",t=>{const n=t.data;"alphaSynth.initialize"===n.cmd&&(ns.preferredSampleRate=n.sampleRate,F.logLevel=n.logLevel,B.globalThis.alphaSynthWebWorker=new jD(e,n.bufferTimeInMilliseconds))})}handleMessage(e){const t=e.data,n=t.cmd;switch(n){case"alphaSynth.setLogLevel":F.logLevel=t.value;break;case"alphaSynth.setMasterVolume":this._player.masterVolume=t.value;break;case"alphaSynth.setMetronomeVolume":this._player.metronomeVolume=t.value;break;case"alphaSynth.setPlaybackSpeed":this._player.playbackSpeed=t.value;break;case"alphaSynth.setTickPosition":this._player.tickPosition=t.value;break;case"alphaSynth.setTimePosition":this._player.timePosition=t.value;break;case"alphaSynth.setPlaybackRange":this._player.playbackRange=t.value;break;case"alphaSynth.setIsLooping":this._player.isLooping=t.value;break;case"alphaSynth.setCountInVolume":this._player.countInVolume=t.value;break;case"alphaSynth.setMidiEventsPlayedFilter":this._player.midiEventsPlayedFilter=t.value;break;case"alphaSynth.play":this._player.play();break;case"alphaSynth.pause":this._player.pause();break;case"alphaSynth.playPause":this._player.playPause();break;case"alphaSynth.stop":this._player.stop();break;case"alphaSynth.playOneTimeMidiFile":this._player.playOneTimeMidiFile(Os.jsObjectToMidiFile(t.midi));break;case"alphaSynth.loadSoundFontBytes":this._player.loadSoundFont(t.data,t.append);break;case"alphaSynth.resetSoundFonts":this._player.resetSoundFonts();break;case"alphaSynth.loadMidi":this._player.loadMidiFile(Os.jsObjectToMidiFile(t.midi));break;case"alphaSynth.setChannelMute":this._player.setChannelMute(t.channel,t.mute);break;case"alphaSynth.setChannelTranspositionPitch":this._player.setChannelTranspositionPitch(t.channel,t.semitones);break;case"alphaSynth.setChannelSolo":this._player.setChannelSolo(t.channel,t.solo);break;case"alphaSynth.setChannelVolume":this._player.setChannelVolume(t.channel,t.volume);break;case"alphaSynth.resetChannelStates":this._player.resetChannelStates();break;case"alphaSynth.destroy":this._player.destroy(),this._main.postMessage({cmd:"alphaSynth.destroyed"});break;case"alphaSynth.applyTranspositionPitches":this._player.applyTranspositionPitches(new Map(JSON.parse(t.transpositionPitches)))}n.startsWith("alphaSynth.exporter")&&this.handleExporterMessage(e)}handleExporterMessage(e){const t=e.data,n=t.cmd;try{switch(n){case"alphaSynth.exporter.initialize":const i=this._player.exportAudio(t.options,Os.jsObjectToMidiFile(t.midi),t.syncPoints,t.transpositionPitches);this._exporter.set(t.exporterId,i),this._main.postMessage({cmd:"alphaSynth.exporter.initialized",exporterId:t.exporterId});break;case"alphaSynth.exporter.render":if(this._exporter.has(t.exporterId)){const o=this._exporter.get(t.exporterId).render(t.milliseconds);this._main.postMessage({cmd:"alphaSynth.exporter.rendered",exporterId:t.exporterId,chunk:o})}else this._main.postMessage({cmd:"alphaSynth.exporter.error",exporterId:t.exporterId,error:new Error("Unknown exporter ID")});break;case"alphaSynth.exporter.destroy":this._exporter.delete(t.exporterId)}}catch(i){this._main.postMessage({cmd:"alphaSynth.exporter.error",exporterId:t.exporterId,error:i})}}onPositionChanged(e){this._main.postMessage({cmd:"alphaSynth.positionChanged",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek,originalTempo:e.originalTempo,modifiedTempo:e.modifiedTempo})}onPlayerStateChanged(e){this._main.postMessage({cmd:"alphaSynth.playerStateChanged",state:e.state,stopped:e.stopped})}onFinished(){this._main.postMessage({cmd:"alphaSynth.finished"})}onSoundFontLoaded(){this._main.postMessage({cmd:"alphaSynth.soundFontLoaded"})}onSoundFontLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.soundFontLoadFailed",error:this.serializeException(B.prepareForPostMessage(e))})}serializeException(e){const t=JSON.parse(JSON.stringify(e));return e.message&&(t.message=e.message),e.stack&&(t.stack=e.stack),e.constructor&&e.constructor.name&&(t.type=e.constructor.name),t}onMidiLoaded(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek,originalTempo:e.originalTempo,modifiedTempo:e.modifiedTempo})}onMidiLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",error:this.serializeException(B.prepareForPostMessage(e))})}onReadyForPlayback(){this._main.postMessage({cmd:"alphaSynth.readyForPlayback"})}onMidiEventsPlayed(e){this._main.postMessage({cmd:"alphaSynth.midiEventsPlayed",events:e.events.map(Os.midiEventToJsObject)})}onPlaybackRangeChanged(e){this._main.postMessage({cmd:"alphaSynth.playbackRangeChanged",playbackRange:e.playbackRange})}}var io=function(s){return s[s.Browser=0]="Browser",s[s.NodeJs=1]="NodeJs",s[s.BrowserModule=2]="BrowserModule",s}(io||{});class YD{constructor(e,t){this.characterWidths=e,this.fontSizeToHeight=t}}class Ki{static generateFontLookup(e){if(!Ki.FontSizeLookupTables.has(e))if(B.isRunningInWorker||B.webPlatform===io.NodeJs){const t=new YD(new Uint8Array([8]),1.2);Ki.FontSizeLookupTables.set(e,t)}else{const n=document.createElement("canvas").getContext("2d"),i=11;n.font=`${i}px ${e}`;const r=[];let o="";for(let d=Ki.ControlChars;d<255;d++){const p=String.fromCharCode(d);o+=p;const g=n.measureText(p);r.push(g.width)}const a=n.measureText(`${o}\xc4\xd6\xdc\xc1\xc8`),l=0-Math.abs(a.fontBoundingBoxAscent),u=0+Math.abs(a.fontBoundingBoxDescent)-l,h=new YD(new Uint8Array(r),u/i);Ki.FontSizeLookupTables.set(e,h)}}static measureString(e,t,n,i,r){let o,l=t[0];for(let h=0;h<t.length;h++)if(Ki.FontSizeLookupTables.has(t[h])){l=t[h];break}Ki.FontSizeLookupTables.has(l)||Ki.generateFontLookup(l),o=Ki.FontSizeLookupTables.get(l);let c=1;i===ts.Italic&&(c*=1.1),r===Or.Bold&&(c*=1.1);let u=0;for(let h=0;h<e.length;h++){const d=Math.min(o.characterWidths.length-1,e.charCodeAt(h)-Ki.ControlChars);d>=0&&(u+=o.characterWidths[d]*n/11)}return c*=1.07,new Ug(u*c,n*o.fontSizeToHeight)}}Ki.FontSizeLookupTables=new Map,Ki.ControlChars=32;class Sc{constructor(){this.id=ie.newGuid(),this.x=0,this.y=0,this.width=0,this.height=0,this.totalWidth=0,this.totalHeight=0,this.firstMasterBarIndex=-1,this.lastMasterBarIndex=-1,this.renderResult=null}}class XD{constructor(){this.beats=[]}addBeat(e){e.barBounds=this,this.beats.push(e),this.masterBarBounds.addBeat(e)}findBeatAtPos(e){let t=null;for(const n of this.beats)if(!t||n.realBounds.x<e)t=n;else if(n.realBounds.x>e)break;return t}finish(e=1){this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e),this.beats.sort((t,n)=>t.realBounds.x-n.realBounds.x);for(const t of this.beats)t.finish(e)}}class JD{constructor(){this.onNotesX=0,this.notes=null}addNote(e){this.notes||(this.notes=[]),e.beatBounds=this,this.notes.push(e)}findNoteAtPos(e,t){const n=this.notes;if(!n)return null;for(const i of n)if(i.noteHeadBounds.x<=e&&i.noteHeadBounds.y<=t&&e<=i.noteHeadBounds.x+i.noteHeadBounds.w&&t<=i.noteHeadBounds.y+i.noteHeadBounds.h)return i.note;return null}finish(e=1){if(this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e),this.onNotesX*=e,this.notes)for(const t of this.notes)t.finish(e)}}class ZD{constructor(){this.index=0,this.isFirstOfLine=!1,this.bars=[],this.staffSystemBounds=null}get staveGroupBounds(){return this.staffSystemBounds}addBar(e){e.masterBarBounds=this,this.bars.push(e)}findBeatAtPos(e,t){let n=null;for(const r of this.bars){const o=r.findBeatAtPos(e);if(o&&(!n||n.realBounds.x<o.realBounds.x)){const a=Math.abs(o.realBounds.x-e);(!n||a<1e7)&&(n=o)}}return n?n.beat:null}finish(e=1){this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e),this.lineAlignedBounds.scaleWith(e),this.bars.sort((t,n)=>t.realBounds.y<n.realBounds.y?-1:t.realBounds.y>n.realBounds.y?1:t.realBounds.x<n.realBounds.x?-1:t.realBounds.x>n.realBounds.x?1:0);for(const t of this.bars)t.finish(e)}addBeat(e){this.staffSystemBounds.boundsLookup.addBeat(e)}}class Bf{finish(e=1){this.noteHeadBounds.scaleWith(e)}}class QD{constructor(){this.index=0,this.bars=[]}finish(e=1){this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e);for(const t of this.bars)t.finish(e)}addBar(e){this.boundsLookup.addMasterBar(e),e.staffSystemBounds=this,this.bars.push(e)}findBarAtPos(e){let t=null;for(const n of this.bars)if(!t||n.realBounds.x<e)t=n;else if(e>n.realBounds.x+n.realBounds.w)break;return t}}class Lr{constructor(){this._beatLookup=new Map,this._masterBarLookup=new Map,this._currentStaffSystem=null,this.staffSystems=[],this.isFinished=!1}toJson(){const e={},t=[];e.staffSystems=t;for(const n of this.staffSystems){const i={};i.visualBounds=this.boundsToJson(n.visualBounds),i.realBounds=this.boundsToJson(n.realBounds),i.bars=[];for(const r of n.bars){const o={};o.lineAlignedBounds=this.boundsToJson(r.lineAlignedBounds),o.visualBounds=this.boundsToJson(r.visualBounds),o.realBounds=this.boundsToJson(r.realBounds),o.index=r.index,o.bars=[];for(const a of r.bars){const l={};l.visualBounds=this.boundsToJson(a.visualBounds),l.realBounds=this.boundsToJson(a.realBounds),l.beats=[];for(const c of a.beats){const u={};u.visualBounds=this.boundsToJson(c.visualBounds),u.realBounds=this.boundsToJson(c.realBounds),u.onNotesX=c.onNotesX;const h=u;if(h.beatIndex=c.beat.index,h.voiceIndex=c.beat.voice.index,h.barIndex=c.beat.voice.bar.index,h.staffIndex=c.beat.voice.bar.staff.index,h.trackIndex=c.beat.voice.bar.staff.track.index,c.notes){const d=[];u.notes=d;for(const p of c.notes){const g={};g.index=p.note.index,g.noteHeadBounds=this.boundsToJson(p.noteHeadBounds),d.push(g)}}l.beats.push(u)}o.bars.push(l)}i.bars.push(o)}t.push(i)}return e}static fromJson(e,t){const n=new Lr,i=e.staffSystems;for(const r of i){const o=new QD;o.visualBounds=Lr.boundsFromJson(r.visualBounds),o.realBounds=Lr.boundsFromJson(r.realBounds),n.addStaffSystem(o);for(const a of r.bars){const l=new ZD;l.index=a.index,l.isFirstOfLine=a.isFirstOfLine,l.lineAlignedBounds=Lr.boundsFromJson(a.lineAlignedBounds),l.visualBounds=Lr.boundsFromJson(a.visualBounds),l.realBounds=Lr.boundsFromJson(a.realBounds),o.addBar(l);for(const c of a.bars){const u=new XD;u.visualBounds=Lr.boundsFromJson(c.visualBounds),u.realBounds=Lr.boundsFromJson(c.realBounds),l.addBar(u);for(const h of c.beats){const d=new JD;if(d.visualBounds=Lr.boundsFromJson(h.visualBounds),d.realBounds=Lr.boundsFromJson(h.realBounds),d.onNotesX=h.onNotesX,d.beat=t.tracks[h.trackIndex].staves[h.staffIndex].bars[h.barIndex].voices[h.voiceIndex].beats[h.beatIndex],h.notes){d.notes=[];for(const g of h.notes){const m=new Bf;m.note=d.beat.notes[g.index],m.noteHeadBounds=Lr.boundsFromJson(g.noteHeadBounds),d.addNote(m)}}u.addBeat(d)}}}}return n}static boundsFromJson(e){const t=new bi;return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t}boundsToJson(e){const t={};return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t}finish(e=1){for(const t of this.staffSystems)t.finish(e);this.isFinished=!0}addStaffSystem(e){e.index=this.staffSystems.length,e.boundsLookup=this,this.staffSystems.push(e),this._currentStaffSystem=e}addMasterBar(e){e.staffSystemBounds?this._masterBarLookup.set(e.index,e):(e.staffSystemBounds=this._currentStaffSystem,this._masterBarLookup.set(e.index,e),this._currentStaffSystem.addBar(e))}addBeat(e){this._beatLookup.has(e.beat.id)||this._beatLookup.set(e.beat.id,[]),this._beatLookup.get(e.beat.id)?.push(e)}findMasterBarByIndex(e){return this._masterBarLookup.has(e)?this._masterBarLookup.get(e):null}findMasterBar(e){const t=e.index;return this._masterBarLookup.has(t)?this._masterBarLookup.get(t):null}findBeat(e){const t=this.findBeats(e);return t?t[0]:null}findBeats(e){const t=e.id;return this._beatLookup.has(t)?this._beatLookup.get(t):null}getBeatAtPos(e,t){let n=0,i=this.staffSystems.length-1,r=-1;for(;n<=i;){const l=(i+n)/2|0,c=this.staffSystems[l];if(t>=c.realBounds.y&&t<=c.realBounds.y+c.realBounds.h){r=l;break}t<c.realBounds.y?i=l-1:n=l+1}if(-1===r)return null;const a=this.staffSystems[r].findBarAtPos(e);return a?a.findBeatAtPos(e,t):null}getNoteAtPos(e,t,n){const i=this.findBeats(e);if(i)for(const r of i){const o=r.findNoteAtPos(t,n);if(o)return o}return null}}class Mf{constructor(e){this._currentLayoutMode=fu.Page,this._currentRenderEngine=null,this._renderedTracks=null,this.canvas=null,this.score=null,this.tracks=null,this.layout=null,this.boundsLookup=null,this.width=0,this.preRender=new ft,this.renderFinished=new ft,this.partialRenderFinished=new ft,this.partialLayoutFinished=new ft,this.postRenderFinished=new ks,this.error=new ft,this.settings=e,this.recreateCanvas(),this.recreateLayout()}destroy(){this.score=null,this.canvas?.destroy(),this.canvas=null,this.layout=null,this.boundsLookup=null,this.tracks=null}recreateCanvas(){return this._currentRenderEngine!==this.settings.core.engine&&(this.canvas?.destroy(),this.canvas=B.getRenderEngineFactory(this.settings.core.engine).createCanvas(),this._currentRenderEngine=this.settings.core.engine,!0)}recreateLayout(){return!(this.layout&&this._currentLayoutMode===this.settings.display.layoutMode||(this.layout=B.getLayoutEngineFactory(this.settings.display.layoutMode).createLayout(this),this._currentLayoutMode=this.settings.display.layoutMode,0))}renderScore(e,t){try{this.score=e;let n=null;if(null!=e&&null!=t){if(t){n=[];for(const i of t)i>=0&&i<e.tracks.length&&n.push(e.tracks[i])}else n=e.tracks.slice(0);0===n.length&&e.tracks.length>0&&n.push(e.tracks[0])}this.tracks=n,this.render()}catch(n){this.error.trigger(n)}}renderTracks(e){this.score=0===e.length?null:e[0].score,this.tracks=e,this.render()}updateSettings(e){this.settings=e}renderResult(e){try{const t=this.layout;t?(F.debug("Rendering",`Request render of lazy partial ${e}`),t.renderLazyPartial(e)):F.warning("Rendering",`Request render of lazy partial ${e} ignored, no layout exists`)}catch(t){this.error.trigger(t)}}render(){if(0!==this.width)if(this.boundsLookup=new Lr,this.recreateCanvas(),this.canvas.lineWidth=1,this.canvas.settings=this.settings,this.tracks&&0!==this.tracks.length&&this.score){F.debug("Rendering",`Rendering ${this.tracks.length} tracks`);for(let e=0;e<this.tracks.length;e++)F.debug("Rendering",`Track ${e}: ${this.tracks[e].name}`);this.preRender.trigger(!1),this.recreateLayout(),this.layoutAndRender(),F.debug("Rendering","Rendering finished")}else F.debug("Rendering","Clearing rendered tracks because no score or tracks are set"),this.preRender.trigger(!1),this._renderedTracks=null,this.onRenderFinished(),this.postRenderFinished.trigger(),F.debug("Rendering","Clearing finished");else F.warning("Rendering","AlphaTab skipped rendering because of width=0 (element invisible)",null)}resizeRender(){this.recreateLayout()||this.recreateCanvas()||this._renderedTracks!==this.tracks||!this.tracks?(F.debug("Rendering","Starting full rerendering due to layout or canvas change",null),this.render()):this.layout.supportsResize?(F.debug("Rendering","Starting optimized rerendering for resize"),this.boundsLookup=new Lr,this.preRender.trigger(!0),this.canvas.settings=this.settings,this.layout.resize(),this.onRenderFinished(),this.postRenderFinished.trigger()):F.debug("Rendering","Current layout does not support dynamic resizing, nothing was done",null),F.debug("Rendering","Resize finished")}layoutAndRender(){F.debug("Rendering",`Rendering at scale ${this.settings.display.scale} with layout ${this.layout.name}`,null),this.layout.layoutAndRender(),this._renderedTracks=this.tracks,this.onRenderFinished(),this.postRenderFinished.trigger()}onRenderFinished(){this.boundsLookup?.finish(this.settings.display.scale);const e=new Sc;e.totalHeight=this.layout.height,e.totalWidth=this.layout.width,e.renderResult=this.canvas.onRenderFinished(),this.renderFinished.trigger(e)}}class KD{constructor(e){this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this),!1)}static init(){B.globalThis.alphaTabWebWorker=new KD(B.globalThis)}handleMessage(e){const t=e.data;switch(t?t.cmd:""){case"alphaTab.initialize":const i=Os.jsObjectToSettings(t.settings);F.logLevel=i.core.logLevel,this._renderer=new Mf(i),this._renderer.partialRenderFinished.on(o=>{this._main.postMessage({cmd:"alphaTab.partialRenderFinished",result:o})}),this._renderer.partialLayoutFinished.on(o=>{this._main.postMessage({cmd:"alphaTab.partialLayoutFinished",result:o})}),this._renderer.renderFinished.on(o=>{this._main.postMessage({cmd:"alphaTab.renderFinished",result:o})}),this._renderer.postRenderFinished.on(()=>{this._main.postMessage({cmd:"alphaTab.postRenderFinished",boundsLookup:this._renderer.boundsLookup?.toJson()??null})}),this._renderer.preRender.on(o=>{this._main.postMessage({cmd:"alphaTab.preRender",resize:o})}),this._renderer.error.on(this.error.bind(this));break;case"alphaTab.invalidate":this._renderer.render();break;case"alphaTab.resizeRender":this._renderer.resizeRender();break;case"alphaTab.renderResult":this._renderer.renderResult(t.resultId);break;case"alphaTab.setWidth":this._renderer.width=t.width;break;case"alphaTab.renderScore":this.updateFontSizes(t.fontSizes);const r=null==t.score?null:Os.jsObjectToScore(t.score,this._renderer.settings);this.renderMultiple(r,t.trackIndexes);break;case"alphaTab.updateSettings":this.updateSettings(t.settings)}}updateFontSizes(e){if(!(e instanceof Map)){const t=e;e=new Map;for(const n in t)e.set(n,t[n])}if(e){Ki.FontSizeLookupTables||(Ki.FontSizeLookupTables=new Map);for(const[t,n]of e)Ki.FontSizeLookupTables.set(t,n)}}updateSettings(e){_u.fromJson(this._renderer.settings,e)}renderMultiple(e,t){try{this._renderer.renderScore(e,t)}catch(n){this.error(n)}}error(e){F.error("Worker","An unexpected error occurred in worker",e),this._main.postMessage({cmd:"alphaTab.error",error:e})}}class $ne{constructor(){this._canvas=null,this._color=new _n(0,0,0,255),this._font=new Ke("Arial",10,ts.Plain),this._lineWidth=0,this._measureCanvas=document.createElement("canvas"),this._measureCanvas.width=10,this._measureCanvas.height=10,this._measureCanvas.style.width="10px",this._measureCanvas.style.height="10px",this._measureContext=this._measureCanvas.getContext("2d"),this._measureContext.textBaseline="hanging"}destroy(){}onRenderFinished(){return null}beginRender(e,t){this._musicFont=this.settings.display.resources.smuflFont;const n=this.settings.display.scale;this._canvas=document.createElement("canvas"),this._canvas.width=e*B.HighDpiFactor|0,this._canvas.height=t*B.HighDpiFactor|0,this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`,this._context=this._canvas.getContext("2d"),this._context.textBaseline="hanging",this._context.scale(B.HighDpiFactor*n,B.HighDpiFactor*n),this._context.lineWidth=this._lineWidth}endRender(){const e=this._canvas;return this._canvas=null,e}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._context.strokeStyle=e.rgba,this._context.fillStyle=e.rgba)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._context&&(this._context.lineWidth=e)}fillRect(e,t,n,i){n>0&&this._context.fillRect(0|e,0|t,n,i)}strokeRect(e,t,n,i){const r=this.lineWidth%2==0?0:.5;this._context.strokeRect((0|e)+r,(0|t)+r,n,i)}beginPath(){this._context.beginPath()}closePath(){this._context.closePath()}moveTo(e,t){this._context.moveTo(e,t)}lineTo(e,t){this._context.lineTo(e,t)}quadraticCurveTo(e,t,n,i){this._context.quadraticCurveTo(e,t,n,i)}bezierCurveTo(e,t,n,i,r,o){this._context.bezierCurveTo(e,t,n,i,r,o)}fillCircle(e,t,n){this._context.beginPath(),this._context.arc(e,t,n,0,2*Math.PI,!0),this.fill()}strokeCircle(e,t,n){this._context.beginPath(),this._context.arc(e,t,n,0,2*Math.PI,!0),this.stroke()}fill(){this._context.fill(),this._context.beginPath()}stroke(){this._context.stroke(),this._context.beginPath()}get font(){return this._font}set font(e){this._font=e,this._context&&(this._context.font=e.toCssString(1)),this._measureContext.font=e.toCssString(1)}get textAlign(){switch(this._context.textAlign){case"left":default:return ye.Left;case"center":return ye.Center;case"right":return ye.Right}}set textAlign(e){switch(e){case ye.Left:this._context.textAlign="left";break;case ye.Center:this._context.textAlign="center";break;case ye.Right:this._context.textAlign="right"}}get textBaseline(){switch(this._context.textBaseline){case"hanging":default:return qe.Top;case"middle":return qe.Middle;case"bottom":return qe.Bottom}}set textBaseline(e){switch(e){case qe.Top:this._context.textBaseline="hanging";break;case qe.Middle:this._context.textBaseline="middle";break;case qe.Bottom:this._context.textBaseline="bottom"}}beginGroup(e){}endGroup(){}fillText(e,t,n){this._context.fillText(e,t,n)}measureText(e){const t=this._measureContext.measureText(e);return new Ug(t.width,t.actualBoundingBoxDescent+t.actualBoundingBoxAscent)}fillMusicFontSymbol(e,t,n,i,r=!1){i!==f.None&&this.fillMusicFontSymbolText(e,t,n,String.fromCharCode(i),r)}fillMusicFontSymbols(e,t,n,i,r=!1){let o="";for(const a of i)a!==f.None&&(o+=String.fromCharCode(a));this.fillMusicFontSymbolText(e,t,n,o,r)}fillMusicFontSymbolText(e,t,n,i,r){const o=this._context.textAlign,a=this._context.textBaseline,l=this._context.font;this._context.font=this._musicFont.toCssString(n),this._context.textBaseline="middle",this._context.textAlign=r?"center":"left",this._context.fillText(i,e,t),this._context.textBaseline=a,this._context.font=l,this._context.textAlign=o}beginRotate(e,t,n){this._context.save(),this._context.translate(e,t),this._context.rotate(n*Math.PI/180)}endRotate(){this._context.restore()}}class da{constructor(e,t=!1){this._midiFile=e,this._smf1Mode=t}addTimeSignature(e,t,n){let i=0,r=n;for(;r>>=1,r>0;)i++;this._midiFile.addEvent(new ED(0,e,t,i,48,8))}addRest(e,t,n){this._smf1Mode||this._midiFile.addEvent(new BD(e,t,n))}addNote(e,t,n,i,r,o){this._midiFile.addEvent(new PD(e,t,o,da.fixValue(i),da.fixValue(r))),this._midiFile.addEvent(new AD(e,t+n,o,da.fixValue(i),da.fixValue(r)))}static fixValue(e){return e>127?127:e<0?0:e}addControlChange(e,t,n,i,r){this._midiFile.addEvent(new RD(e,t,n,i,da.fixValue(r)))}addProgramChange(e,t,n,i){this._midiFile.addEvent(new FD(e,t,n,i))}addTempo(e,t){const n=new OD(e,0);n.beatsPerMinute=t,this._midiFile.addEvent(n)}addBend(e,t,n,i){i=i>=xe.MaxPitchWheel?xe.MaxPitchWheel:Math.floor(i),this._midiFile.addEvent(new LD(e,t,n,i))}addNoteBend(e,t,n,i,r){this._smf1Mode?this.addBend(e,t,n,r):this._midiFile.addEvent(new VD(e,t,n,i,r=r*xe.MaxPitchWheel20/xe.MaxPitchWheel))}finishTrack(e,t){(this._midiFile.format===Df.MultiTrack||0===e)&&this._midiFile.addEvent(new HD(e,t))}}class jne{constructor(e,t){this.closingIndex=0,this.group=e,this.opening=t,e.closings=e.closings.sort((n,i)=>n.index-i.index),this.iterations=e.closings.map(n=>0)}}var Si=function(s){return s[s.PlayingNormally=0]="PlayingNormally",s[s.DirectionJumped=1]="DirectionJumped",s[s.DirectionJumpedAlCoda=2]="DirectionJumpedAlCoda",s[s.DirectionJumpedAlDoubleCoda=3]="DirectionJumpedAlDoubleCoda",s[s.DirectionJumpedAlFine=4]="DirectionJumpedAlFine",s}(Si||{});class Yne{get finished(){return this.index>=this._score.masterBars.length}constructor(e){this._repeatStack=[],this._groupsOnStack=new Set,this._previousAlternateEndings=0,this._state=Si.PlayingNormally,this.shouldPlay=!0,this.index=0,this.currentTick=0,this._score=e}processCurrent(){const e=this._score.masterBars[this.index];if(this._state===Si.PlayingNormally){let t=e.alternateEndings;if(0===t&&(t=this._previousAlternateEndings),e===e.repeatGroup.opening&&e.repeatGroup.isClosed&&!this._groupsOnStack.has(e.repeatGroup)){const n=new jne(e.repeatGroup,e);this._repeatStack.push(n),this._groupsOnStack.add(e.repeatGroup),this._previousAlternateEndings=0,t=e.alternateEndings}if(0===this._repeatStack.length||0===t)this.shouldPlay=!0;else{const n=this._repeatStack[this._repeatStack.length-1],i=n.iterations[n.closingIndex];this._previousAlternateEndings=t,this.shouldPlay=!!(t&1<<i)}}else this.shouldPlay=!0;this.shouldPlay&&(this.currentTick+=e.calculateDuration())}moveNext(){this.moveNextWithDirections()||this.moveNextWithNormalRepeats()}resetRepeats(){this._groupsOnStack.clear(),this._previousAlternateEndings=0,this._repeatStack=[]}handleDaCapo(e,t,n){return!!e.has(t)&&(this.index=0,this._state=n,this.resetRepeats(),!0)}handleDalSegno(e,t,n,i){if(e.has(t)){const r=this.findJumpTarget(i,this.index,!0);return-1!==r&&(this.index=r,this._state=n,this.resetRepeats(),!0)}return!1}handleDaCoda(e,t,n){if(e.has(t)){const i=this.findJumpTarget(n,this.index,!1);return-1===i?(this.index++,!0):(this.index=i,this._state=Si.PlayingNormally,!0)}return!1}moveNextWithDirections(){const e=this._score.masterBars[this.index],t=null!==e.directions&&e.directions.size>0;if(this._state===Si.PlayingNormally&&!t)return!1;if(!t)return this.index++,!0;switch(this._state){case Si.PlayingNormally:return!!(this.handleDaCapo(e.directions,j.JumpDaCapo,Si.DirectionJumped)||this.handleDaCapo(e.directions,j.JumpDaCapoAlCoda,Si.DirectionJumpedAlCoda)||this.handleDaCapo(e.directions,j.JumpDaCapoAlDoubleCoda,Si.DirectionJumpedAlDoubleCoda)||this.handleDaCapo(e.directions,j.JumpDaCapoAlFine,Si.DirectionJumpedAlFine)||this.handleDalSegno(e.directions,j.JumpDalSegno,Si.DirectionJumped,j.TargetSegno)||this.handleDalSegno(e.directions,j.JumpDalSegnoAlCoda,Si.DirectionJumpedAlCoda,j.TargetSegno)||this.handleDalSegno(e.directions,j.JumpDalSegnoAlDoubleCoda,Si.DirectionJumpedAlDoubleCoda,j.TargetSegno)||this.handleDalSegno(e.directions,j.JumpDalSegnoAlFine,Si.DirectionJumpedAlFine,j.TargetSegno)||this.handleDalSegno(e.directions,j.JumpDalSegnoSegno,Si.DirectionJumped,j.TargetSegnoSegno)||this.handleDalSegno(e.directions,j.JumpDalSegnoSegnoAlCoda,Si.DirectionJumpedAlCoda,j.TargetSegnoSegno)||this.handleDalSegno(e.directions,j.JumpDalSegnoSegnoAlDoubleCoda,Si.DirectionJumpedAlDoubleCoda,j.TargetSegnoSegno)||this.handleDalSegno(e.directions,j.JumpDalSegnoSegnoAlFine,Si.DirectionJumpedAlFine,j.TargetSegnoSegno));case Si.DirectionJumped:return this.index++,!0;case Si.DirectionJumpedAlCoda:return this.handleDaCoda(e.directions,j.JumpDaCoda,j.TargetCoda)||this.index++,!0;case Si.DirectionJumpedAlDoubleCoda:return this.handleDaCoda(e.directions,j.JumpDaDoubleCoda,j.TargetDoubleCoda)||this.index++,!0;case Si.DirectionJumpedAlFine:return e.directions.has(j.TargetFine)?(this.index=this._score.masterBars.length,!0):(this.index++,!0)}return!0}findJumpTarget(e,t,n){let i;return n?(i=this.findJumpTargetBackwards(e,t),-1===i&&(i=this.findJumpTargetForwards(e,t)),i):(i=this.findJumpTargetForwards(e,t),-1===i&&(i=this.findJumpTargetBackwards(e,t)),i)}findJumpTargetForwards(e,t){let n=t;for(;n<this._score.masterBars.length;){const i=this._score.masterBars[n].directions;if(i&&i.has(e))return n;n++}return-1}findJumpTargetBackwards(e,t){let n=t;for(;n>=0;){const i=this._score.masterBars[n].directions;if(i&&i.has(e))return n;n--}return-1}moveNextWithNormalRepeats(){const t=this._score.masterBars[this.index].repeatCount-1;if(this._repeatStack.length>0&&t>0){const n=this._repeatStack[this._repeatStack.length-1];if(n.iterations[n.closingIndex]<t){this.index=n.opening.index,n.iterations[n.closingIndex]++;for(let r=0;r<n.closingIndex;r++)n.iterations[r]=0;n.closingIndex=0,this._previousAlternateEndings=0}else n.closingIndex<n.group.closings.length-1?(n.closingIndex++,this.index++):(this._repeatStack.pop(),this._groupsOnStack.delete(n.group),this.index++)}else this.index++}}class Y2{constructor(e,t){this.beat=e,this.playbackStart=t}}class $o{get duration(){return this.end-this.start}constructor(e,t){this._highlightedBeats=new Map,this.highlightedBeats=[],this.nextBeat=null,this.previousBeat=null,this.start=e,this.end=t}highlightBeat(e,t){e.isEmpty&&!e.voice.isEmpty||this._highlightedBeats.has(e.id)||(this._highlightedBeats.set(e.id,!0),this.highlightedBeats.push(new Y2(e,t)))}getVisibleBeatAtStart(e){for(const t of this.highlightedBeats)if(t.playbackStart===this.start&&e.has(t.beat.voice.bar.staff.track.index))return t.beat;return null}}class am{constructor(e,t){this.tick=e,this.tempo=t}}class ex{constructor(){this.start=0,this.end=0,this.tempoChanges=[],this.firstBeat=null,this.lastBeat=null,this.nextMasterBar=null,this.previousMasterBar=null}get tempo(){return this.tempoChanges[0].tempo}insertAfter(e,t){null==this.firstBeat||null==e||null==this.lastBeat?(this.firstBeat=t,this.lastBeat=t):(t.nextBeat=e.nextBeat,t.previousBeat=e,e.nextBeat&&(e.nextBeat.previousBeat=t),e.nextBeat=t,e===this.lastBeat&&(this.lastBeat=t))}insertBefore(e,t){null==this.firstBeat||null==e||null==this.lastBeat?(this.firstBeat=t,this.lastBeat=t):(t.previousBeat=e.previousBeat,t.nextBeat=e,e.previousBeat&&(e.previousBeat.nextBeat=t),e.previousBeat=t,e===this.firstBeat&&(this.firstBeat=t))}addBeat(e,t,n,i){const r=n+i;if(null==this.firstBeat){const o=new $o(n,r);o.highlightBeat(e,t),this.insertAfter(this.firstBeat,o)}else if(n>=this.lastBeat.end){const o=new $o(this.lastBeat.end,r);o.highlightBeat(e,t),this.insertAfter(this.lastBeat,o)}else{let o=null;if(n<this.firstBeat.start)o=this.firstBeat;else{let a=this.firstBeat;for(;null!=a;){if(n>=a.start&&n<a.end){o=a;break}a=a.nextBeat}if(null===o)throw new rn(un.General,"Error on building lookup, unknown variant")}if(n<o.start)if(r===o.start){const a=new $o(n,o.start);a.highlightBeat(e,t),this.insertBefore(this.firstBeat,a)}else if(r<o.end){const a=new $o(n,o.start);a.highlightBeat(e,t),this.insertBefore(o,a);const l=new $o(o.start,r);for(const c of o.highlightedBeats)l.highlightBeat(c.beat,c.playbackStart);l.highlightBeat(e,t),this.insertBefore(o,l),o.start=r}else if(r===o.end){const a=new $o(n,o.start);a.highlightBeat(e,t),o.highlightBeat(e,t),this.insertBefore(o,a)}else{const a=new $o(n,o.start);a.highlightBeat(e,t),o.highlightBeat(e,t),this.insertBefore(o,a),this.addBeat(e,t,o.end,r-o.end)}else if(n>o.start)if(r===o.end){const a=new $o(o.start,n);for(const l of o.highlightedBeats)a.highlightBeat(l.beat,l.playbackStart);o.start=n,o.highlightBeat(e,t),this.insertBefore(o,a)}else if(r<o.end){const a=new $o(o.start,n);this.insertBefore(o,a);const l=new $o(n,r);this.insertBefore(o,l);for(const c of o.highlightedBeats)a.highlightBeat(c.beat,c.playbackStart),l.highlightBeat(c.beat,c.playbackStart);l.highlightBeat(e,t),o.start=r}else{const a=new $o(o.start,n);for(const l of o.highlightedBeats)a.highlightBeat(l.beat,l.playbackStart);o.start=n,o.highlightBeat(e,t),this.insertBefore(o,a),this.addBeat(e,t,o.end,r-o.end)}else if(r===o.end)o.highlightBeat(e,t);else if(r<o.end){const a=new $o(o.start,r);for(const l of o.highlightedBeats)a.highlightBeat(l.beat,l.playbackStart);a.highlightBeat(e,t),o.start=r,this.insertBefore(o,a)}else o.highlightBeat(e,t),this.addBeat(e,t,o.end,r-o.end)}}}var jo=function(s){return s[s.Unknown=0]="Unknown",s[s.ToNextBext=1]="ToNextBext",s[s.ToEndOfBar=2]="ToEndOfBar",s}(jo||{});class X2{get start(){return this.masterBar.start+this.beatLookup.start}get end(){return this.start+this.tickDuration}constructor(e){this.nextBeat=null,this.tickDuration=0,this.duration=0,this.cursorMode=jo.Unknown,this.masterBar=e}calculateDuration(){if(1===this.masterBar.tempoChanges.length)this.duration=G.ticksToMillis(this.tickDuration,this.masterBar.tempoChanges[0].tempo);else{let e=0,t=this.start,n=this.masterBar.tempoChanges[0].tempo;const i=this.end;for(const r of this.masterBar.tempoChanges)if(r.tick<t)n=r.tempo;else{if(r.tick>i)break;e+=G.ticksToMillis(r.tick-t,n),n=r.tempo,t=r.tick}i>t&&(e+=G.ticksToMillis(i-t,n)),this.duration=e}}}class J2{constructor(){this._currentMasterBar=null,this.masterBarLookup=new Map,this.masterBars=[],this.multiBarRestInfo=null}findBeat(e,t,n=null){let i=null;return n&&(i=this.findBeatFast(e,n,t)),i||(i=this.findBeatSlow(e,n,t,!1)),i}findBeatFast(e,t,n){if(n>=t.start&&n<t.end)return t;if(t.nextBeat&&n>=t.nextBeat.start&&n<t.nextBeat.end){const i=t.nextBeat;return this.fillNextBeat(i,e),i}return null}fillNextBeatMultiBarRest(e,t){const n=this.multiBarRestInfo.get(e.masterBar.masterBar.index);let i=e.masterBar;for(let r=0;r<n.length&&i;r++)i=i.nextMasterBar;i?i.nextMasterBar?(e.nextBeat=this.firstBeatInMasterBar(t,i.nextMasterBar,i.nextMasterBar.start,!0),e.nextBeat?(e.tickDuration=e.nextBeat.start-e.start,e.cursorMode=jo.ToNextBext,e.nextBeat.masterBar.masterBar.index!==i.masterBar.index+1&&(e.nextBeat.masterBar.masterBar.index!==i.masterBar.index||e.nextBeat.beat.playbackStart<=e.beat.playbackStart)&&(e.cursorMode=jo.ToEndOfBar)):(e.tickDuration=i.nextMasterBar.end-e.start,e.cursorMode=jo.ToEndOfBar)):(e.tickDuration=i.end-e.start,e.cursorMode=jo.ToEndOfBar):(F.warning("Synth","MultiBar Rest Info and the nextMasterBar are out of sync, this is an unexpected error. Please report it as bug.  (broken chain fill-next)"),e.tickDuration=(e.masterBar.end-e.masterBar.start)*(n.length+1),e.cursorMode=jo.ToEndOfBar),e.calculateDuration()}fillNextBeat(e,t){this.isMultiBarRestResult(e)?this.fillNextBeatMultiBarRest(e,t):this.fillNextBeatDefault(e,t)}fillNextBeatDefault(e,t){e.nextBeat=this.findBeatInMasterBar(e.masterBar,e.beatLookup.nextBeat,e.end,t,!0),null==e.nextBeat&&(e.nextBeat=this.findBeatSlow(t,e,e.end,!0)),e.nextBeat?(e.tickDuration=e.nextBeat.start-e.start,e.cursorMode=jo.ToNextBext,e.calculateDuration()):(e.tickDuration=e.masterBar.end-e.start,e.cursorMode=jo.ToEndOfBar,e.calculateDuration()),e.nextBeat&&e.nextBeat.masterBar.masterBar.index!==e.masterBar.masterBar.index+1&&(e.nextBeat.masterBar.masterBar.index!==e.masterBar.masterBar.index||e.nextBeat.beat.playbackStart<=e.beat.playbackStart)&&(e.cursorMode=jo.ToEndOfBar)}isMultiBarRestResult(e){return this.internalIsMultiBarRestResult(e.masterBar.masterBar.index,e.beat)}internalIsMultiBarRestResult(e,t){return this.multiBarRestInfo&&this.multiBarRestInfo.has(e)&&t.isRest&&t.voice.bar.isRestOnly}findBeatSlow(e,t,n,i){let r=null;return null!=t&&(t.masterBar.start<=n&&t.masterBar.end>n?r=t.masterBar:t.masterBar.nextMasterBar&&t.masterBar.nextMasterBar.start<=n&&t.masterBar.nextMasterBar.end>n&&(r=t.masterBar.nextMasterBar)),r||(r=this.findMasterBar(n)),r?this.firstBeatInMasterBar(e,r,n,i):null}firstBeatInMasterBar(e,t,n,i){let r=t;for(;r;){if(r.firstBeat){const o=this.findBeatInMasterBar(r,r.firstBeat,n,e,i);if(o)return o}r=r.nextMasterBar}return null}findBeatInMasterBar(e,t,n,i,r){if(!t)return null;let o=null,a=null;const l=n-e.start;for(;null!=t&&null==a;){if((t.start<=l||r&&l<0)&&l<t.end){if(o=t,a=t.getVisibleBeatAtStart(i),!a)if(r){let u=e;for(;null!=u&&null==a;){for(;null!=t;){if(a=t.getVisibleBeatAtStart(i),a){o=t,e=u;break}t=t.nextBeat}(!a||!o)&&(u=u.nextMasterBar,t=u?.firstBeat??null)}}else{let u=e;for(;null!=u&&null==a;){for(;null!=t;){if(a=t.getVisibleBeatAtStart(i),a){o=t,e=u;break}t=t.previousBeat}(!a||!o)&&(u=u.previousMasterBar,t=u?.firstBeat??null)}}}else if(t.end>l)break;t=t?.nextBeat??null}return null==a?null:this.createResult(e,o,a,r,i)}createResult(e,t,n,i,r){const o=new X2(e);if(o.beat=n,o.beatLookup=t,o.tickDuration=t.end-t.start,i){if(this.isMultiBarRestResult(o)){const a=this.multiBarRestInfo.get(e.masterBar.index);let l=e;for(let c=0;c<a.length&&l;c++)l=l.nextMasterBar;l?o.tickDuration=l.nextMasterBar?l.nextMasterBar.start-t.start:l.end-t.start:F.warning("Synth","MultiBar Rest Info and the nextMasterBar are out of sync, this is an unexpected error. Please report it as bug.  (broken chain stretch-result)")}}else this.fillNextBeat(o,r);return o.calculateDuration(),o}findMasterBar(e){const t=this.masterBars;let n=0,i=t.length-1;for(;n<=i;){const r=(i+n)/2|0,o=t[r];if(e>=o.start&&e<o.end)return o;e<o.start?i=r-1:n=r+1}return null}getMasterBar(e){if(!this.masterBarLookup.has(e.index)){const t=new ex;return t.masterBar=e,t}return this.masterBarLookup.get(e.index)}getMasterBarStart(e){return this.masterBarLookup.has(e.index)?this.masterBarLookup.get(e.index).start:0}getBeatStart(e){return this.masterBarLookup.has(e.voice.bar.index)?this.masterBarLookup.get(e.voice.bar.index).start+e.playbackStart:0}addMasterBar(e){this.masterBars.push(e),this._currentMasterBar&&(e.previousMasterBar=this._currentMasterBar,this._currentMasterBar.nextMasterBar=e),this._currentMasterBar=e,this.masterBarLookup.has(e.masterBar.index)||this.masterBarLookup.set(e.masterBar.index,e)}addBeat(e,t,n){const i=this._currentMasterBar;if(i)if(t<0&&i.previousMasterBar){const r=i.previousMasterBar.end-i.previousMasterBar.start,o=r+t,a=o+n;i.previousMasterBar.addBeat(e,o,o,n),a>r&&i.addBeat(e,t,0,n+t)}else i.addBeat(e,t,t,n)}}class Xne{constructor(){this.noteOnly=0,this.untilTieOrSlideEnd=0,this.letRingEnd=0}}class Jne{constructor(){this.firstBeatDuration=0,this.secondBeatStartOffset=0,this.secondBeatDuration=0}}class Zne{constructor(){this.durations=[],this.brushInfos=[]}}class Qne{constructor(){this.synthTick=0,this.synthTime=0,this.currentTempo=0,this.automationToSyncPoint=new Map,this.createNewSyncPoints=!1}}class Ye{constructor(e,t,n){this._programsPerChannel=new Map,this._currentTime=0,this._calculatedBeatTimers=new Set,this.tickLookup=new J2,this.applyTranspositionPitches=!0,this.syncPoints=[],this.transpositionPitches=new Map,this._currentTripletFeel=null,this.vibratoResolution=16,this._score=e,this._settings=t||new wc,this._handler=n}generate(){this.transpositionPitches.clear(),this._calculatedBeatTimers.clear(),this._currentTime=0;for(const e of this._score.tracks)this.generateTrack(e);F.debug("Midi","Begin midi generation"),this.syncPoints=[],Ye.playThroughSong(this._score,this.syncPoints,!1,(e,t,n,i,r)=>{this.generateMasterBar(e,t,n,i,r)},(e,t,n)=>{for(const i of this._score.tracks)for(const r of i.staves)e<r.bars.length&&this.generateBar(r.bars[e],t,n)},e=>{for(const t of this._score.tracks)this._handler.finishTrack(t.index,e)}),F.debug("Midi","Midi generation done")}generateTrack(e){this.generateChannel(e,e.playbackInfo.primaryChannel,e.playbackInfo),e.playbackInfo.primaryChannel!==e.playbackInfo.secondaryChannel&&this.generateChannel(e,e.playbackInfo.secondaryChannel,e.playbackInfo)}addProgramChange(e,t,n,i){(!this._programsPerChannel.has(n)||this._programsPerChannel.get(n)!==i)&&(this._handler.addProgramChange(e.index,t,n,i),this._programsPerChannel.set(n,i))}static buildTranspositionPitches(e,t){const n=new Map;for(const i of e.tracks){const r=i.index<t.notation.transpositionPitches.length?t.notation.transpositionPitches[i.index]:-i.staves[0].transpositionPitch;n.set(i.playbackInfo.primaryChannel,r),n.set(i.playbackInfo.secondaryChannel,r)}return n}generateChannel(e,t,n){this.transpositionPitches.set(t,e.index<this._settings.notation.transpositionPitches.length?this._settings.notation.transpositionPitches[e.index]:-e.staves[0].transpositionPitch);const r=Ye.toChannelShort(n.volume),o=Ye.toChannelShort(n.balance);this._handler.addControlChange(e.index,0,t,Gn.VolumeCoarse,r),this._handler.addControlChange(e.index,0,t,Gn.PanCoarse,o),this._handler.addControlChange(e.index,0,t,Gn.ExpressionControllerCoarse,127),this._handler.addControlChange(e.index,0,t,Gn.RegisteredParameterFine,0),this._handler.addControlChange(e.index,0,t,Gn.RegisteredParameterCourse,0),this._handler.addControlChange(e.index,0,t,Gn.DataEntryFine,0),this._handler.addControlChange(e.index,0,t,Gn.DataEntryCoarse,Ye.PitchBendRangeInSemitones),this.addProgramChange(e,0,t,n.program)}static generateSyncPoints(e,t=!1){const n=[];return Ye.playThroughSong(e,n,t,(i,r,o,a,l)=>{},(i,r,o)=>{},i=>{}),n}static buildModifiedTempoLookup(e){return Ye.playThroughSong(e,[],!1,(i,r,o,a,l)=>{},(i,r,o)=>{},i=>{}).automationToSyncPoint}static playThroughSong(e,t,n,i,r,o){const a=new Yne(e),l=new Qne;l.currentTempo=e.tempo,l.syncPoints=t,l.createNewSyncPoints=n;let c=null;const u=new Map;for(;!a.finished;){const h=a.index,d=e.masterBars[h],p=a.currentTick;if(a.processCurrent(),a.shouldPlay){let g=u.has(h)?u.get(h):-1;g++,u.set(h,g),i(d,c,p,l.currentTempo,g),r(h,p,d.tempoAutomations.length>0?d.tempoAutomations[0].value:l.currentTempo),l.synthTick=p,Ye.processBarTime(d,g,l)}a.moveNext(),c=d}if(t.length>0){const h=t[t.length-1],d=a.currentTick-h.synthTick;if(d>0){const p=new xf;p.masterBarIndex=c.index,p.masterBarOccurence=u.get(c.index)-1,p.synthTick=a.currentTick,p.synthBpm=l.currentTempo,l.createNewSyncPoints?(p.syncBpm=h.synthBpm,p.synthBpm=h.synthBpm):p.syncBpm=1===t.length?h.synthBpm:t[t.length-2].syncBpm,p.synthTime=h.synthTime+G.ticksToMillis(d,h.synthBpm),p.syncTime=h.syncTime+G.ticksToMillis(d,p.syncBpm),l.createNewSyncPoints||h.updateSyncBpm(p.synthTime,p.syncTime),t.push(p)}}return o(a.currentTick),l}static processBarTime(e,t,n){const i=e.calculateDuration(),r=e.syncPoints,o=n.synthTick;n.createNewSyncPoints?Ye.processBarTimeWithNewSyncPoints(e,t,n):r?Ye.processBarTimeWithSyncPoints(e,t,n):Ye.processBarTimeNoSyncPoints(e,n);const a=o+i,l=a-n.synthTick;l>0&&(n.synthTime+=G.ticksToMillis(l,n.currentTempo),n.synthTick=a)}static processBarTimeWithNewSyncPoints(e,t,n){const i=n.synthTick;if(0===e.index&&0===t){n.currentTempo=e.score.tempo;const o=new xf;o.masterBarIndex=e.index,o.masterBarOccurence=t,o.synthTick=i,o.synthBpm=n.currentTempo,o.synthTime=n.synthTime,o.syncBpm=n.currentTempo,o.syncTime=n.synthTime,n.syncPoints.push(o)}const r=e.calculateDuration();for(const o of e.tempoAutomations){const a=i+o.ratioPosition*r,l=a-n.synthTick;if(l>0&&(n.synthTick=a,n.synthTime+=G.ticksToMillis(l,n.currentTempo)),o.value!==n.currentTempo){n.currentTempo=o.value;const c=new xf;c.masterBarIndex=e.index,c.masterBarOccurence=t,c.synthTick=a,c.synthBpm=n.currentTempo,c.synthTime=n.synthTime,c.syncBpm=n.currentTempo,c.syncTime=n.synthTime,n.syncPoints.push(c)}}}static processBarTimeWithSyncPoints(e,t,n){const i=n.synthTick,r=e.calculateDuration();let a,o=0;for(const l of e.syncPoints){if(l.syncPointValue.barOccurence!==t)continue;const c=i+l.ratioPosition*r;for(;o<e.tempoAutomations.length&&e.tempoAutomations[o].ratioPosition<=l.ratioPosition;){const h=e.tempoAutomations[o],d=i+h.ratioPosition*r;a=d-n.synthTick,a>0&&(n.synthTick=d,n.synthTime+=G.ticksToMillis(a,n.currentTempo)),n.currentTempo=h.value,o++}a=c-n.synthTick,a>0&&(n.synthTick=c,n.synthTime+=G.ticksToMillis(a,n.currentTempo)),n.syncPoints.length>0&&n.syncPoints[n.syncPoints.length-1].updateSyncBpm(n.synthTime,l.syncPointValue.millisecondOffset);const u=new xf;u.masterBarIndex=e.index,u.masterBarOccurence=t,u.synthTick=c,u.synthBpm=n.currentTempo,u.synthTime=n.synthTime,u.syncTime=l.syncPointValue.millisecondOffset,u.syncBpm=0,n.syncPoints.push(u),n.automationToSyncPoint.set(l,u)}for(;o<e.tempoAutomations.length;){const l=e.tempoAutomations[o],c=i+l.ratioPosition*r;a=c-n.synthTick,a>0&&(n.synthTick=c,n.synthTime+=G.ticksToMillis(a,n.currentTempo)),n.currentTempo=l.value,o++}}static processBarTimeNoSyncPoints(e,t){const n=t.synthTick,i=e.calculateDuration();for(const r of e.tempoAutomations){const o=n+r.ratioPosition*i,a=o-t.synthTick;a>0&&(t.synthTick=o,t.synthTime+=G.ticksToMillis(a,t.currentTempo)),t.currentTempo=r.value}}static toChannelShort(e){const t=Math.max(-32768,Math.min(32767,8*e-1));return Math.max(t,-1)+1}generateMasterBar(e,t,n,i,r){(!t||t.timeSignatureDenominator!==e.timeSignatureDenominator||t.timeSignatureNumerator!==e.timeSignatureNumerator)&&this._handler.addTimeSignature(n,e.timeSignatureNumerator,e.timeSignatureDenominator);const o=e.calculateDuration(),a=new ex;if(e.tempoAutomations.length>0){e.tempoAutomations[0].ratioPosition>0&&a.tempoChanges.push(new am(n,i));for(const l of e.tempoAutomations){const c=n+o*l.ratioPosition;this._handler.addTempo(c,l.value),a.tempoChanges.push(new am(c,l.value))}}else t?a.tempoChanges.push(new am(n,i)):(this._handler.addTempo(n,e.score.tempo),a.tempoChanges.push(new am(n,e.score.tempo)));a.masterBar=e,a.start=n,a.end=a.start+o,this.tickLookup.addMasterBar(a)}generateBar(e,t,n){const i=this.getPlaybackBar(e),r=this._currentTime;for(const c of i.voices)this._currentTime=r,this.generateVoice(c,t,e,n);const o=i.masterBar,a=o.calculateDuration(),l=o.tempoAutomations.slice();if(0===l.length)this._currentTime=r+G.ticksToMillis(a,n);else{this._currentTime=r;let c=t,u=n;const h=t+a;for(const p of l){const m=a*p.ratioPosition-c;m>0&&(this._currentTime+=G.ticksToMillis(m,u)),u=p.value,c+=m}const d=h-c;d>0&&(this._currentTime+=G.ticksToMillis(d,u))}i.id!==e.id&&this.tickLookup.addBeat(e.voices[0].beats[0],0,a)}getPlaybackBar(e){switch(e.simileMark){case ws.Simple:e.previousBar&&(e=this.getPlaybackBar(e.previousBar));break;case ws.FirstOfDouble:case ws.SecondOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this.getPlaybackBar(e.previousBar.previousBar))}return e}generateVoice(e,t,n,i){if(e.isEmpty&&(!e.bar.isEmpty||0!==e.index))return;const r=n.masterBar.tempoAutomations.slice();let o=i;const a=n.masterBar.calculateDuration();for(const l of e.beats){const c=l.playbackStart/a;for(;r.length>0&&r[0].ratioPosition<=c;)o=r.shift().value;this.generateBeat(l,t,n,o)}}generateBeat(e,t,n,i){let r=e.playbackStart,o=e.playbackDuration;const a=e.voice.bar.masterBar.calculateDuration();e.voice.bar.isEmpty?o=a:e.voice.bar.masterBar.tripletFeel!==nt.NoTripletFeel&&this._settings.player.playTripletFeel&&(this._currentTripletFeel?(r-=this._currentTripletFeel.secondBeatStartOffset,o=this._currentTripletFeel.secondBeatDuration,this._currentTripletFeel=null):(this._currentTripletFeel=Ye.calculateTripletFeelInfo(r,o,e),this._currentTripletFeel&&(o=this._currentTripletFeel.firstBeatDuration))),e.showTimer&&!this._calculatedBeatTimers.has(e.id)&&(e.timer=this._currentTime,this._calculatedBeatTimers.add(e.id)),this._currentTime+=G.ticksToMillis(o,i),n===e.voice.bar&&this.tickLookup.addBeat(e,r,o);const l=e.voice.bar.staff.track;for(const c of e.automations)this.generateNonTempoAutomation(e,c,t);if(e.isRest)this._handler.addRest(l.index,t+r,l.playbackInfo.primaryChannel);else if(e.deadSlapped)this.generateDeadSlap(e,t+r);else{const c=this.getBrushInfo(e),u=this.getRasgueadoInfo(e,o);for(const h of e.notes)this.generateNote(h,t+r,o,i,c,u)}if(e.fade!==Ks.None&&this.generateFade(e,t+r,o),e.vibrato!==Ft.None){let c=240,u=3;switch(e.vibrato){case Ft.Slight:c=this._settings.player.vibrato.beatSlightLength,u=this._settings.player.vibrato.beatSlightAmplitude;break;case Ft.Wide:c=this._settings.player.vibrato.beatWideLength,u=this._settings.player.vibrato.beatWideAmplitude}this.generateVibratorWithParams(t+r,e.playbackDuration,c,0,u,(h,d)=>{this._handler.addBend(e.voice.bar.staff.track.index,h,l.playbackInfo.secondaryChannel,d)})}}static calculateTripletFeelInfo(e,t,n){let i;switch(n.voice.bar.masterBar.tripletFeel){case nt.Triplet8th:case nt.Dotted8th:case nt.Scottish8th:i=w.Eighth;break;case nt.Triplet16th:case nt.Dotted16th:case nt.Scottish16th:i=w.Sixteenth;break;default:return null}const r=G.toTicks(i);if(t!==r||e%r!==0||!n.nextBeat||n.nextBeat.voice!==n.voice||n.playbackDuration!==r)return null;const o=new Jne;switch(n.voice.bar.masterBar.tripletFeel){case nt.Triplet8th:o.firstBeatDuration=G.applyTuplet(G.toTicks(w.Quarter),3,2),o.secondBeatDuration=G.applyTuplet(G.toTicks(w.Eighth),3,2);break;case nt.Dotted8th:o.firstBeatDuration=G.applyDot(G.toTicks(w.Eighth),!1),o.secondBeatDuration=G.toTicks(w.Sixteenth);break;case nt.Scottish8th:o.firstBeatDuration=G.toTicks(w.Sixteenth),o.secondBeatDuration=G.applyDot(G.toTicks(w.Eighth),!1);break;case nt.Triplet16th:o.firstBeatDuration=G.applyTuplet(G.toTicks(w.Eighth),3,2),o.secondBeatDuration=G.applyTuplet(G.toTicks(w.Sixteenth),3,2);break;case nt.Dotted16th:o.firstBeatDuration=G.applyDot(G.toTicks(w.Sixteenth),!1),o.secondBeatDuration=G.toTicks(w.ThirtySecond);break;case nt.Scottish16th:o.firstBeatDuration=G.toTicks(w.ThirtySecond),o.secondBeatDuration=G.applyDot(G.toTicks(w.Sixteenth),!1)}return o.secondBeatStartOffset=t-o.firstBeatDuration,o}generateDeadSlap(e,t){const n=G.toTicks(w.SixtyFourth),i=e.voice.bar.staff;if(i.tuning.length>0)for(const r of i.tuning)this._handler.addNote(i.track.index,t,n,r,G.dynamicToVelocity(Te.F),i.track.playbackInfo.primaryChannel)}needsSecondaryChannel(e){return e.hasBend||e.beat.hasWhammyBar||e.beat.vibrato!==Ft.None}determineChannel(e,t){if(this.needsSecondaryChannel(t))return e.playbackInfo.secondaryChannel;let n=t;for(;n.isTieDestination;)if(n=n.tieOrigin,this.needsSecondaryChannel(n))return e.playbackInfo.secondaryChannel;for(n=t;n.isTieOrigin;)if(n=n.tieDestination,this.needsSecondaryChannel(n))return e.playbackInfo.secondaryChannel;return e.playbackInfo.primaryChannel}generateNote(e,t,n,i,r,o){const a=e.beat.voice.bar.staff.track,l=e.beat.voice.bar.staff;let c=e.calculateRealValue(this.applyTranspositionPitches,!0);if(e.isPercussion){const y=Gs.getArticulation(e);y&&(c=y.outputMidiNumber)}const u=null==o&&e.isStringed&&e.string<=r.length?r[e.string-1]:0,h=t+u,d=this.getNoteDuration(e,n,i);d.untilTieOrSlideEnd-=u,d.noteOnly-=u,d.letRingEnd-=u;const p=Ye.getNoteVelocity(e),g=this.determineChannel(a,e);let m=0;const _=Math.max(d.untilTieOrSlideEnd,d.letRingEnd);m=e.hasBend?Ye.getPitchWheel(e.bendPoints[0].value):e.beat.hasWhammyBar?Ye.getPitchWheel(e.beat.whammyBarPoints[0].value):e.isTieDestination||e.slideOrigin&&e.slideOrigin.slideOutType===Qe.Legato?-1:Ye.getPitchWheel(0),m>=0&&this._handler.addNoteBend(a.index,h,g,c,m),e.beat.hasRasgueado?this.generateRasgueado(a,e,h,c,p,g,o):e.ornament===vs.None?!e.isTrill||l.isPercussion?e.beat.isTremolo?this.generateTremoloPicking(e,h,d,c,p,g):(e.hasBend?this.generateBend(e,h,d,c,g,i):e.beat.hasWhammyBar&&0===e.index?this.generateWhammy(e.beat,h,d,g,i):e.slideInType!==ri.None||e.slideOutType!==Qe.None?this.generateSlide(e,h,d,c,g,i):(e.vibrato!==Ft.None||e.isTieDestination&&e.tieOrigin.vibrato!==Ft.None)&&this.generateVibrato(e,h,d,c,g),!e.isTieDestination&&(!e.slideOrigin||e.slideOrigin.slideOutType!==Qe.Legato)&&this._handler.addNote(a.index,h,_,c,p,g)):this.generateTrill(e,h,d,c,p,g):this.generateOrnament(a,e,h,_,c,p,g)}generateOrnament(e,t,n,i,r,o,a){let l,c;const u=r%12,h=1/3;switch(t.ornament){case vs.Turn:l=[r+Ye.OrnamentKeysUp[u],r,r+Ye.OrnamentKeysDown[u]],c=[G.toTicks(w.Sixteenth)*h,G.toTicks(w.Sixteenth)*h,G.toTicks(w.Sixteenth)*h];break;case vs.InvertedTurn:l=[r+Ye.OrnamentKeysDown[u],r,r+Ye.OrnamentKeysUp[u]],c=[G.toTicks(w.Sixteenth)*h,G.toTicks(w.Sixteenth)*h,G.toTicks(w.Sixteenth)*h];break;case vs.UpperMordent:l=[r,r+Ye.OrnamentKeysUp[u]],c=[G.toTicks(w.ThirtySecond),G.toTicks(w.ThirtySecond)];break;case vs.LowerMordent:l=[r,r+Ye.OrnamentKeysDown[u]],c=[G.toTicks(w.ThirtySecond),G.toTicks(w.ThirtySecond)];break;default:return}let d=1;i<G.QuarterTime&&(d=i/G.QuarterTime),o-=G.VelocityIncrement;let p=0;for(let m=0;m<l.length;m++){const _=c[m]*d;this._handler.addNote(e.index,n,_,l[m],o,a),n+=_,p+=_}this._handler.addNote(e.index,n,i-p,r,o,a)}getNoteDuration(e,t,n){const i=new Xne;if(i.noteOnly=t,i.untilTieOrSlideEnd=t,i.letRingEnd=t,e.isDead)return i.noteOnly=this.applyStaticDuration(Ye.DefaultDurationDead,t,n),i.untilTieOrSlideEnd=i.noteOnly,i.letRingEnd=i.noteOnly,i;if(e.isPalmMute)return i.noteOnly=this.applyStaticDuration(Ye.DefaultDurationPalmMute,t,n),i.untilTieOrSlideEnd=i.noteOnly,i.letRingEnd=i.noteOnly,i;if(e.isStaccato)return i.noteOnly=t/2|0,i.untilTieOrSlideEnd=i.noteOnly,i.letRingEnd=i.noteOnly,i;if(e.isTieOrigin){const r=e.tieDestination;if(r)if(e.isTieDestination){const o=this.getNoteDuration(r,r.beat.playbackDuration,n);i.untilTieOrSlideEnd=t+o.untilTieOrSlideEnd}else{const o=e.beat.absolutePlaybackStart,a=this.getNoteDuration(r,r.beat.playbackDuration,n);i.untilTieOrSlideEnd=r.beat.absolutePlaybackStart+a.untilTieOrSlideEnd-o}}else if(e.slideOutType===Qe.Legato){const r=e.slideTarget;if(r){const o=e.beat.absolutePlaybackStart,a=this.getNoteDuration(r,r.beat.playbackDuration,n);i.untilTieOrSlideEnd=r.beat.absolutePlaybackStart+a.untilTieOrSlideEnd-o}}if(e.isLetRing&&this._settings.notation.notationMode===xi.GuitarPro){let r=e.beat,o=0;const a=e.beat.voice.bar.masterBar.calculateDuration();for(;r.nextBeat;){const l=r.nextBeat;if(l.isRest||e.isStringed&&l.hasNoteOnString(e.string))break;if(r=r.nextBeat,o=r.absolutePlaybackStart-e.beat.absolutePlaybackStart+r.playbackDuration,o>a){o=a;break}}i.letRingEnd=r===e.beat?t:o}else i.letRingEnd=i.untilTieOrSlideEnd;return i}applyStaticDuration(e,t,n){return Math.min(n*e/se.MaxPosition|0,t)}static getNoteVelocity(e){let t=0;switch(!e.beat.voice.bar.staff.isPercussion&&e.hammerPullOrigin&&t--,e.isGhost&&t--,e.accentuated){case Ss.Normal:t++;break;case Ss.Heavy:t+=2}return G.dynamicToVelocity(e.dynamics,t)}generateFade(e,t,n){const i=e.voice.bar.staff.track;switch(e.fade){case Ks.FadeIn:this.generateFadeSteps(i,t,n,0,Ye.toChannelShort(i.playbackInfo.volume));break;case Ks.FadeOut:this.generateFadeSteps(i,t,n,Ye.toChannelShort(i.playbackInfo.volume),0);break;case Ks.VolumeSwell:const r=n/2|0;this.generateFadeSteps(i,t,r,0,Ye.toChannelShort(i.playbackInfo.volume)),this.generateFadeSteps(i,t+r,r,Ye.toChannelShort(i.playbackInfo.volume),0)}}generateFadeSteps(e,t,n,i,r){const a=(r-i)/(n=.8*n|0),l=n/120+1|0,c=t+n;for(let u=0;u<l;u++){const h=u===l-1,d=h?c:t+120*u,p=h?r:Math.round(i+(d-t)*a);this._handler.addControlChange(e.index,d,e.playbackInfo.primaryChannel,Gn.VolumeCoarse,p),this._handler.addControlChange(e.index,d,e.playbackInfo.secondaryChannel,Gn.VolumeCoarse,p)}}generateVibrato(e,t,n,i,r){let o=0,a=0;switch(e.vibrato!==Ft.None?e.vibrato:e.isTieDestination?e.tieOrigin.vibrato:Ft.Slight){case Ft.Slight:o=this._settings.player.vibrato.noteSlightLength,a=this._settings.player.vibrato.noteSlightAmplitude;break;case Ft.Wide:o=this._settings.player.vibrato.noteWideLength,a=this._settings.player.vibrato.noteWideAmplitude;break;default:return}const c=e.beat.voice.bar.staff.track;let u=0;if(e.isTieDestination&&e.tieOrigin.hasBend){const h=e.tieOrigin.bendPoints;u=h[h.length-1].value}this.generateVibratorWithParams(t,n.noteOnly,o,u,a,(h,d)=>{this._handler.addNoteBend(c.index,h,r,i,d)})}generateVibratorWithParams(e,t,n,i,r,o){const a=this.vibratoResolution,l=n/2|0,c=e+t;for(;e<c;){let u=0;const h=e+n<c?n:c-e;for(;u<h;){const d=i+r*Math.sin(u*Math.PI/l);o(e+u|0,Ye.getPitchWheel(d)),u+=a}e+=n}o(0|c,Ye.getPitchWheel(i))}static getPitchWheel(e){return xe.DefaultPitchWheel+e/2*Ye.PitchValuePerSemitone}generateSlide(e,t,n,i,r,o){const a=e.slideOutType===Qe.Legato?n.noteOnly:n.untilTieOrSlideEnd,l=[],c=e.beat.voice.bar.staff.track,u=this._settings.player.slide.simpleSlidePitchOffset,h=Math.floor(se.MaxPosition*this._settings.player.slide.simpleSlideDurationRatio),d=Math.floor(se.MaxPosition*this._settings.player.slide.shiftSlideDurationRatio);switch(e.slideInType){case ri.IntoFromAbove:l.push(new se(0,u)),l.push(new se(h,0));break;case ri.IntoFromBelow:l.push(new se(0,-u)),l.push(new se(h,0))}switch(e.slideOutType){case Qe.Legato:case Qe.Shift:l.push(new se(d,0));const p=2*(e.slideTarget.calculateRealValue(this.applyTranspositionPitches,!0)-e.calculateRealValue(this.applyTranspositionPitches,!0));l.push(new se(se.MaxPosition,p));break;case Qe.OutDown:l.push(new se(se.MaxPosition-h,0)),l.push(new se(se.MaxPosition,-u));break;case Qe.OutUp:l.push(new se(se.MaxPosition-h,0)),l.push(new se(se.MaxPosition,u))}this.generateWhammyOrBend(t,a,l,o,(p,g)=>{this._handler.addNoteBend(c.index,p,r,i,g)})}generateBend(e,t,n,i,r,o){const a=e.bendPoints,l=e.beat.voice.bar.staff.track,c=(g,m)=>{this._handler.addNoteBend(l.index,g,r,i,m)};let h,u=null;if(e.isTieOrigin&&this._settings.notation.extendBendArrowsOnTiedNotes){let g=e;for(;g.isTieOrigin&&!g.tieDestination.hasBend&&g.tieDestination.vibrato===Ft.None;)g=g.tieDestination;h=g.beat.absolutePlaybackStart-e.beat.absolutePlaybackStart+this.getNoteDuration(g,g.beat.playbackDuration,o).noteOnly}else if(e.isTieOrigin&&e.beat.graceType!==Ee.None){switch(e.tieDestination.bendType){case me.Bend:case me.BendRelease:case me.PrebendBend:u=e.tieDestination.bendPoints[1].value;break;case me.Prebend:case me.PrebendRelease:u=e.tieDestination.bendPoints[0].value}h=Math.max(n.noteOnly,G.millisToTicks(this._settings.player.songBookBendDuration,o))}else h=n.noteOnly;a[0].value>0&&!e.isContinuedBend&&t>0&&t--;const d=Math.min(h,G.millisToTicks(this._settings.player.songBookBendDuration,o));let p=[];switch(e.bendType){case me.Custom:p=a;break;case me.Bend:case me.Release:switch(e.bendStyle){case Cn.Default:p=a;break;case Cn.Gradual:p.push(new se(0,e.bendPoints[0].value)),(!u||u<e.bendPoints[1].value)&&(u=e.bendPoints[1].value),p.push(new se(se.MaxPosition,u));break;case Cn.Fast:return(!u||u<e.bendPoints[1].value)&&(u=e.bendPoints[1].value),void this.generateSongBookWhammyOrBend(t,h,e.beat.graceType===Ee.BendGrace,[e.bendPoints[0].value,u],d,o,c)}break;case me.BendRelease:switch(e.bendStyle){case Cn.Default:p=a;break;case Cn.Gradual:p.push(new se(0,e.bendPoints[0].value)),p.push(new se(se.MaxPosition/2|0,e.bendPoints[1].value)),p.push(new se(se.MaxPosition,e.bendPoints[2].value));break;case Cn.Fast:return void this.generateSongBookWhammyOrBend(t,h,!1,[e.bendPoints[0].value,e.bendPoints[1].value,e.bendPoints[2].value],d,o,c)}break;case me.Hold:case me.Prebend:p=a;break;case me.PrebendBend:switch(e.bendStyle){case Cn.Default:p=a;break;case Cn.Gradual:p.push(new se(0,e.bendPoints[0].value)),p.push(new se(se.MaxPosition,e.bendPoints[1].value));break;case Cn.Fast:return c(t,0|Ye.getPitchWheel(e.bendPoints[0].value)),(!u||u<e.bendPoints[1].value)&&(u=e.bendPoints[1].value),void this.generateSongBookWhammyOrBend(t,h,!1,[e.bendPoints[0].value,u],d,o,c)}break;case me.PrebendRelease:switch(e.bendStyle){case Cn.Default:p=a;break;case Cn.Gradual:p.push(new se(0,e.bendPoints[0].value)),p.push(new se(se.MaxPosition,e.bendPoints[1].value));break;case Cn.Fast:return c(t,0|Ye.getPitchWheel(e.bendPoints[0].value)),void this.generateSongBookWhammyOrBend(t,h,!1,[e.bendPoints[0].value,e.bendPoints[1].value],d,o,c)}}this.generateWhammyOrBend(t,h,p,o,c)}generateSongBookWhammyOrBend(e,t,n,i,r,o,a){const l=n?e:e+t-r,c=r/(i.length-1);for(let u=0;u<i.length-1;u++){const h=Ye.getPitchWheel(i[u]),d=Ye.getPitchWheel(i[u+1]);this.generateBendValues(l+c*u,c,h,d,o,a)}}generateWhammy(e,t,n,i,r){const o=e.whammyBarPoints,a=e.voice.bar.staff.track,l=n.noteOnly;o[0].value>0&&!e.isContinuedWhammy&&t--;const c=(h,d)=>{this._handler.addBend(a.index,h,i,d)};let u=[];switch(e.whammyBarType){case Wt.Custom:u=o;break;case Wt.Dive:switch(e.whammyStyle){case Cn.Default:u=o;break;case Cn.Gradual:u.push(new se(0,o[0].value)),u.push(new se(se.MaxPosition,o[1].value));break;case Cn.Fast:const h=Math.min(l,G.millisToTicks(this._settings.player.songBookBendDuration,r));return void this.generateSongBookWhammyOrBend(t,l,!1,[o[0].value,o[1].value],h,r,c)}break;case Wt.Dip:switch(e.whammyStyle){case Cn.Default:u=o;break;case Cn.Gradual:u.push(new se(0,o[0].value)),u.push(new se(se.MaxPosition/2|0,o[1].value)),u.push(new se(se.MaxPosition,o[2].value));break;case Cn.Fast:const h=Math.min(l,G.millisToTicks(this._settings.player.songBookDipDuration,r));return void this.generateSongBookWhammyOrBend(t,l,!0,[o[0].value,o[1].value,o[2].value],h,r,c)}break;case Wt.Hold:case Wt.Predive:u=o;break;case Wt.PrediveDive:switch(e.whammyStyle){case Cn.Default:u=o;break;case Cn.Gradual:u.push(new se(0,o[0].value)),u.push(new se(se.MaxPosition/2|0,o[0].value)),u.push(new se(se.MaxPosition,o[1].value));break;case Cn.Fast:const h=Ye.getPitchWheel(o[0].value);this._handler.addBend(a.index,t,i,0|h);const d=Math.min(l,G.millisToTicks(this._settings.player.songBookBendDuration,r));return void this.generateSongBookWhammyOrBend(t,l,!1,[o[0].value,o[1].value],d,r,c)}}this.generateWhammyOrBend(t,l,u,r,c)}generateWhammyOrBend(e,t,n,i,r){const o=t/se.MaxPosition;for(let a=0;a<n.length-1;a++){const l=n[a],c=n[a+1],u=Ye.getPitchWheel(l.value),h=Ye.getPitchWheel(c.value);this.generateBendValues(e+o*l.offset,o*(c.offset-l.offset),u,h,i,r)}}generateBendValues(e,t,n,i,r,o){const a=G.ticksToMillis(t,r),l=Math.abs(i-n)/Ye.PitchValuePerSemitone,c=Math.max(Ye.MinBreakpointsPerSemitone*l,a/Ye.MillisecondsPerBreakpoint),u=t/c,h=(i-n)/c,d=e+t;for(let p=0;p<c;p++)o(0|e,Math.round(n)),n+=h,e+=u;o(0|d,i)}generateRasgueado(e,t,n,i,r,o,a){let l=n;for(let c=0;c<a.durations.length;c++){const u=a.brushInfos[c],h=t.isStringed&&t.string<=u.length?u[t.string-1]:0,d=a.durations[c];this._handler.addNote(e.index,l+h,d-h,i,r,o),l+=d}}generateTrill(e,t,n,i,r,o){const a=e.beat.voice.bar.staff.track,l=e.stringTuning+e.trillFret;let c=G.toTicks(e.trillSpeed),u=!0,h=t;const d=t+n.untilTieOrSlideEnd;for(;h+10<d;)h+c>=d&&(c=d-h),this._handler.addNote(a.index,h,c,u?l:i,r,o),u=!u,h+=c}generateTremoloPicking(e,t,n,i,r,o){const a=e.beat.voice.bar.staff.track;let l=G.toTicks(e.beat.tremoloSpeed),c=t;const u=t+n.untilTieOrSlideEnd;for(;c+10<u;)c+l>=u&&(l=u-c),this._handler.addNote(a.index,c,l,i,r,o),c+=l}getRasgueadoInfo(e,t){if(!e.hasRasgueado)return null;const n=new Zne,r=Ye.RasgueadoDurations.get(e.rasgueado).reduce((u,h)=>u+h,0);n.durations=Ye.RasgueadoDurations.get(e.rasgueado).map(u=>t*u/r),n.brushInfos=new Array(n.durations.length);const o=G.toTicks(w.Sixteenth);let a=0,l=0;for(const u of e.notes)u.isTieDestination||(a|=1<<u.string-1,l++);const c=Ye.RasgueadoDirections.get(e.rasgueado);for(let u=0;u<n.durations.length;u++){const h=n.durations[u]*o/G.QuarterTime,d=new Int32Array(e.voice.bar.staff.tuning.length);n.brushInfos[u]=d;const p=c[u];p!==fe.None&&this.fillBrushInfo(e,d,p===fe.ArpeggioDown||p===fe.BrushDown,a,l,h)}return n}getBrushInfo(e){const t=new Int32Array(e.voice.bar.staff.tuning.length);if(e.brushType){let n=0,i=0;for(const r of e.notes)r.isTieDestination||(n|=1<<r.string-1,i++);this.fillBrushInfo(e,t,e.brushType===fe.ArpeggioDown||e.brushType===fe.BrushDown,n,i,e.brushDuration)}return t}fillBrushInfo(e,t,n,i,r,o){if(e.notes.length>0){let a=0;const l=o/(r-1)|0;for(let c=0;c<e.voice.bar.staff.tuning.length;c++){const u=n?c:t.length-1-c;i&1<<u&&(t[u]=a,a+=l)}}return t}generateNonTempoAutomation(e,t,n){switch(t.type){case $n.Instrument:this.addProgramChange(e.voice.bar.staff.track,e.playbackStart+n,e.voice.bar.staff.track.playbackInfo.primaryChannel,255&t.value),this.addProgramChange(e.voice.bar.staff.track,e.playbackStart+n,e.voice.bar.staff.track.playbackInfo.secondaryChannel,255&t.value);break;case $n.Balance:const i=Ye.toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+n,e.voice.bar.staff.track.playbackInfo.primaryChannel,Gn.PanCoarse,i),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+n,e.voice.bar.staff.track.playbackInfo.secondaryChannel,Gn.PanCoarse,i);break;case $n.Volume:const r=Ye.toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+n,e.voice.bar.staff.track.playbackInfo.primaryChannel,Gn.VolumeCoarse,r),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+n,e.voice.bar.staff.track.playbackInfo.secondaryChannel,Gn.VolumeCoarse,r)}}prepareSingleBeat(e){let t=-1,n=-1,i=e;for(;i&&(-1===t||-1===n);){for(const u of e.automations)switch(u.type){case $n.Instrument:n=u.value;break;case $n.Tempo:t=u.value}i=i.previousBeat}const r=e.voice.bar.staff.track,o=e.voice.bar.masterBar;-1===t&&(t=o.score.tempo);const a=e.playbackStart/o.calculateDuration();for(const u of o.tempoAutomations){if(!(u.ratioPosition<=a))break;t=u.value}-1===n&&(n=r.playbackInfo.program);const l=r.playbackInfo.volume;this.generateTrack(r),this._handler.addTimeSignature(0,o.timeSignatureNumerator,o.timeSignatureDenominator),this._handler.addTempo(0,t);const c=Ye.toChannelShort(l);return this._handler.addControlChange(0,0,r.playbackInfo.primaryChannel,Gn.VolumeCoarse,c),this._handler.addControlChange(0,0,r.playbackInfo.secondaryChannel,Gn.VolumeCoarse,c),t}generateSingleBeat(e){const t=this.prepareSingleBeat(e);this.generateBeat(e,-e.playbackStart,e.voice.bar,t)}generateSingleNote(e){const t=this.prepareSingleBeat(e.beat);this.generateNote(e,0,e.beat.playbackDuration,t,new Int32Array(e.beat.voice.bar.staff.tuning.length),null)}}Ye.DefaultDurationDead=30,Ye.DefaultDurationPalmMute=80,Ye.OrnamentKeysUp=[2,2,2,1,1,2,2,2,2,2,1,1],Ye.OrnamentKeysDown=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],Ye.PitchBendRangeInSemitones=16,Ye.PitchValuePerSemitone=xe.DefaultPitchWheel/Ye.PitchBendRangeInSemitones,Ye.MinBreakpointsPerSemitone=6,Ye.MillisecondsPerBreakpoint=150,Ye.RasgueadoDirections=new Map([[ge.Ii,[fe.BrushDown,fe.BrushUp]],[ge.Mi,[fe.BrushDown,fe.BrushDown]],[ge.MiiTriplet,[fe.BrushDown,fe.BrushDown,fe.BrushUp]],[ge.MiiAnapaest,[fe.BrushDown,fe.BrushDown,fe.BrushUp]],[ge.PmpTriplet,[fe.BrushUp,fe.BrushDown,fe.BrushDown]],[ge.PmpAnapaest,[fe.BrushUp,fe.BrushDown,fe.BrushDown]],[ge.PeiTriplet,[fe.BrushUp,fe.BrushDown,fe.BrushDown]],[ge.PeiAnapaest,[fe.BrushUp,fe.BrushDown,fe.BrushDown]],[ge.PaiTriplet,[fe.BrushUp,fe.BrushDown,fe.BrushDown]],[ge.PaiAnapaest,[fe.BrushUp,fe.BrushDown,fe.BrushDown]],[ge.AmiTriplet,[fe.BrushDown,fe.BrushDown,fe.BrushDown]],[ge.AmiAnapaest,[fe.BrushDown,fe.BrushDown,fe.BrushDown]],[ge.Ppp,[fe.None,fe.BrushDown,fe.BrushUp]],[ge.Amii,[fe.BrushDown,fe.BrushDown,fe.BrushDown,fe.BrushUp]],[ge.Amip,[fe.BrushDown,fe.BrushDown,fe.BrushDown,fe.BrushUp]],[ge.Eami,[fe.BrushDown,fe.BrushDown,fe.BrushDown,fe.BrushDown]],[ge.Eamii,[fe.BrushDown,fe.BrushDown,fe.BrushDown,fe.BrushDown,fe.BrushUp]],[ge.Peami,[fe.BrushDown,fe.BrushDown,fe.BrushDown,fe.BrushDown,fe.BrushUp]]]),Ye.RasgueadoDurations=new Map([[ge.Ii,[G.toTicks(w.Eighth),G.toTicks(w.Eighth)]],[ge.Mi,[G.toTicks(w.Eighth),G.toTicks(w.Eighth)]],[ge.MiiTriplet,[G.toTicks(w.Eighth)/3,G.toTicks(w.Eighth)/3,G.toTicks(w.Eighth)/3]],[ge.MiiAnapaest,[G.toTicks(w.Sixteenth),G.toTicks(w.Sixteenth),G.toTicks(w.Eighth)]],[ge.PmpTriplet,[G.toTicks(w.Eighth)/3,G.toTicks(w.Eighth)/3,G.toTicks(w.Eighth)/3]],[ge.PmpAnapaest,[G.toTicks(w.Sixteenth)/3,G.toTicks(w.Sixteenth)/3,G.toTicks(w.Eighth)/3]],[ge.PeiTriplet,[G.toTicks(w.Eighth)/3,G.toTicks(w.Eighth)/3,G.toTicks(w.Eighth)/3]],[ge.PeiAnapaest,[G.toTicks(w.Sixteenth),G.toTicks(w.Sixteenth),G.toTicks(w.Eighth)]],[ge.PaiTriplet,[G.toTicks(w.Eighth)/3,G.toTicks(w.Eighth)/3,G.toTicks(w.Eighth)/3]],[ge.PaiAnapaest,[G.toTicks(w.Sixteenth),G.toTicks(w.Sixteenth),G.toTicks(w.Eighth)]],[ge.AmiTriplet,[G.toTicks(w.Eighth)/3,G.toTicks(w.Eighth)/3,G.toTicks(w.Eighth)/3]],[ge.AmiAnapaest,[G.toTicks(w.Sixteenth)/3,G.toTicks(w.Sixteenth)/3,G.toTicks(w.Eighth)/3]],[ge.Ppp,[G.toTicks(w.Sixteenth)/3,G.toTicks(w.Sixteenth)/3,G.toTicks(w.Eighth)/3]],[ge.Amii,[G.toTicks(w.Sixteenth)/3,G.toTicks(w.Sixteenth)/3,G.toTicks(w.Sixteenth)/3,G.toTicks(w.Eighth)]],[ge.Amip,[G.toTicks(w.Sixteenth)/3,G.toTicks(w.Sixteenth)/3,G.toTicks(w.Sixteenth)/3,G.toTicks(w.Eighth)]],[ge.Eami,[G.toTicks(w.Sixteenth),G.toTicks(w.Sixteenth),G.toTicks(w.Sixteenth),G.toTicks(w.Sixteenth)]],[ge.Eamii,[G.toTicks(w.Sixteenth)/5,G.toTicks(w.Sixteenth)/5,G.toTicks(w.Sixteenth)/5,G.toTicks(w.Sixteenth)/5,G.toTicks(w.Sixteenth)/5]],[ge.Peami,[G.toTicks(w.Sixteenth)/5,G.toTicks(w.Sixteenth)/5,G.toTicks(w.Sixteenth)/5,G.toTicks(w.Sixteenth)/5,G.toTicks(w.Sixteenth)/5]]]);class Z2{constructor(){this.startTick=0,this.endTick=0}}class os{constructor(e,t){this.width=0,this.height=0,this.x=e,this.y=t}doLayout(){}paint(e,t,n){}}class ro extends os{constructor(e=0,t=0){super(e,t),this.beat=null,this.nextGlyph=null,this.previousGlyph=null}}class on{}on.Widths=new Map([[f.Brace,3],[f.BracketTop,0],[f.BracketBottom,0],[f.SystemDivider,0],[f.GClef,28],[f.CClef,28],[f.FClef,28],[f.UnpitchedPercussionClef1,15],[f.SixStringTabClef,28],[f.FourStringTabClef,28],[f.TimeSig0,14],[f.TimeSig1,10],[f.TimeSig2,14],[f.TimeSig3,14],[f.TimeSig4,14],[f.TimeSig5,14],[f.TimeSig6,14],[f.TimeSig7,14],[f.TimeSig8,14],[f.TimeSig9,14],[f.TimeSigCommon,14],[f.TimeSigCutCommon,14],[f.NoteheadDoubleWholeSquare,14],[f.NoteheadDoubleWhole,14],[f.NoteheadWhole,14],[f.NoteheadHalf,9],[f.NoteheadBlack,9],[f.NoteheadNull,9],[f.NoteheadXOrnate,9],[f.NoteheadPlusDoubleWhole,16],[f.NoteheadPlusWhole,10],[f.NoteheadPlusHalf,10],[f.NoteheadPlusBlack,10],[f.NoteheadSquareWhite,11],[f.NoteheadSquareBlack,11],[f.NoteheadTriangleUpDoubleWhole,16],[f.NoteheadTriangleUpWhole,11],[f.NoteheadTriangleUpHalf,11],[f.NoteheadTriangleUpBlack,11],[f.NoteheadTriangleRightWhite,11],[f.NoteheadTriangleRightBlack,11],[f.NoteheadTriangleDownDoubleWhole,16],[f.NoteheadTriangleDownWhole,11],[f.NoteheadTriangleDownHalf,11],[f.NoteheadTriangleDownBlack,11],[f.NoteheadDiamondDoubleWhole,16],[f.NoteheadDiamondWhole,9],[f.NoteheadDiamondHalf,9],[f.NoteheadDiamondBlack,9],[f.NoteheadDiamondBlackWide,10],[f.NoteheadDiamondWhite,9],[f.NoteheadDiamondWhiteWide,9],[f.NoteheadCircleXDoubleWhole,16],[f.NoteheadCircleXWhole,9],[f.NoteheadCircleXHalf,9],[f.NoteheadCircleX,9],[f.NoteheadXDoubleWhole,16],[f.NoteheadXWhole,9],[f.NoteheadXHalf,9],[f.NoteheadXBlack,9],[f.NoteheadParenthesis,9],[f.NoteheadSlashedBlack1,9],[f.NoteheadSlashedBlack2,9],[f.NoteheadSlashedHalf1,9],[f.NoteheadSlashedHalf2,9],[f.NoteheadSlashedWhole1,9],[f.NoteheadSlashedWhole2,9],[f.NoteheadSlashedDoubleWhole1,16],[f.NoteheadSlashedDoubleWhole2,16],[f.NoteheadCircledBlack,9],[f.NoteheadCircledHalf,9],[f.NoteheadCircledWhole,9],[f.NoteheadCircledDoubleWhole,16],[f.NoteheadCircleSlash,9],[f.NoteheadHeavyX,13],[f.NoteheadHeavyXHat,13],[f.NoteheadSlashVerticalEnds,12],[f.NoteheadSlashWhiteWhole,32],[f.NoteheadSlashWhiteHalf,25],[f.NoteheadRoundWhiteWithDot,9],[f.NoteheadSquareBlackLarge,9],[f.NoteheadSquareBlackWhite,9],[f.NoteheadClusterDoubleWhole3rd,16],[f.NoteheadClusterWhole3rd,12],[f.NoteheadClusterHalf3rd,12],[f.NoteheadClusterQuarter3rd,12],[f.NoteShapeRoundWhite,9],[f.NoteShapeRoundBlack,9],[f.NoteShapeSquareWhite,12],[f.NoteShapeSquareBlack,12],[f.NoteShapeTriangleRightWhite,12],[f.NoteShapeTriangleRightBlack,12],[f.NoteShapeTriangleLeftWhite,12],[f.NoteShapeTriangleLeftBlack,12],[f.NoteShapeDiamondWhite,9],[f.NoteShapeDiamondBlack,9],[f.NoteShapeTriangleUpWhite,12],[f.NoteShapeTriangleUpBlack,12],[f.NoteShapeMoonWhite,12],[f.NoteShapeMoonBlack,12],[f.NoteShapeTriangleRoundWhite,12],[f.NoteShapeTriangleRoundBlack,12],[f.NoteQuarterUp,10],[f.NoteEighthUp,10],[f.TextBlackNoteLongStem,0],[f.TextBlackNoteFrac8thLongStem,0],[f.TextBlackNoteFrac16thLongStem,0],[f.TextBlackNoteFrac32ndLongStem,0],[f.TextCont8thBeamLongStem,0],[f.TextCont16thBeamLongStem,0],[f.TextCont32ndBeamLongStem,0],[f.TextAugmentationDot,0],[f.TextTupletBracketStartLongStem,0],[f.TextTuplet3LongStem,0],[f.TextTupletBracketEndLongStem,0],[f.Tremolo3,12],[f.Tremolo2,12],[f.Tremolo1,12],[f.FlagEighthUp,0],[f.FlagEighthDown,0],[f.FlagSixteenthUp,0],[f.FlagSixteenthDown,0],[f.FlagThirtySecondUp,0],[f.FlagThirtySecondDown,0],[f.FlagSixtyFourthUp,0],[f.FlagSixtyFourthDown,0],[f.FlagOneHundredTwentyEighthUp,0],[f.FlagOneHundredTwentyEighthDown,0],[f.FlagTwoHundredFiftySixthUp,0],[f.FlagTwoHundredFiftySixthDown,0],[f.AccidentalFlat,8],[f.AccidentalNatural,8],[f.AccidentalSharp,8],[f.AccidentalDoubleSharp,8],[f.AccidentalDoubleFlat,18],[f.AccidentalQuarterToneFlatArrowUp,8],[f.AccidentalQuarterToneSharpArrowUp,8],[f.AccidentalQuarterToneNaturalArrowUp,8],[f.Segno,0],[f.Coda,0],[f.ArticAccentAbove,9],[f.ArticAccentBelow,9],[f.ArticStaccatoAbove,9],[f.ArticStaccatoBelow,9],[f.ArticTenutoAbove,9],[f.ArticTenutoBelow,9],[f.ArticMarcatoAbove,9],[f.ArticMarcatoBelow,9],[f.FermataAbove,23],[f.FermataShortAbove,23],[f.FermataLongAbove,23],[f.RestLonga,9],[f.RestDoubleWhole,9],[f.RestWhole,9],[f.RestHalf,9],[f.RestQuarter,9],[f.RestEighth,9],[f.RestSixteenth,9],[f.RestThirtySecond,12],[f.RestSixtyFourth,14],[f.RestOneHundredTwentyEighth,14],[f.RestTwoHundredFiftySixth,14],[f.RestHBarLeft,0],[f.RestHBarMiddle,0],[f.RestHBarRight,0],[f.Repeat1Bar,0],[f.Repeat2Bars,0],[f.Ottava,0],[f.OttavaAlta,32],[f.OttavaBassaVb,29],[f.Quindicesima,23],[f.QuindicesimaAlta,46],[f.DynamicPPPPPP,0],[f.DynamicPPPPP,0],[f.DynamicPPPP,0],[f.DynamicPPP,0],[f.DynamicPP,0],[f.DynamicPiano,0],[f.DynamicMP,0],[f.DynamicMF,0],[f.DynamicPF,0],[f.DynamicForte,0],[f.DynamicFF,0],[f.DynamicFFF,0],[f.DynamicFFFF,0],[f.DynamicFFFFF,0],[f.DynamicFFFFFF,0],[f.DynamicFortePiano,0],[f.DynamicNiente,0],[f.DynamicSforzando1,0],[f.DynamicSforzandoPiano,0],[f.DynamicSforzandoPianissimo,0],[f.DynamicSforzato,0],[f.DynamicSforzatoPiano,0],[f.DynamicSforzatoFF,0],[f.DynamicRinforzando1,0],[f.DynamicRinforzando2,0],[f.DynamicForzando,0],[f.OrnamentTrill,20],[f.OrnamentTurn,26],[f.OrnamentTurnInverted,26],[f.OrnamentShortTrill,0],[f.OrnamentMordent,26],[f.StringsDownBow,9],[f.StringsUpBow,9],[f.KeyboardPedalPed,35],[f.KeyboardPedalUp,16],[f.PictEdgeOfCymbal,44],[f.GuitarString0,20],[f.GuitarString1,20],[f.GuitarString2,20],[f.GuitarString3,20],[f.GuitarString4,20],[f.GuitarString5,20],[f.GuitarString6,20],[f.GuitarString7,20],[f.GuitarString8,20],[f.GuitarString9,20],[f.GuitarOpenPedal,11],[f.GuitarClosePedal,11],[f.GuitarGolpe,13.4],[f.GuitarFadeIn,13],[f.GuitarFadeOut,13],[f.GuitarVolumeSwell,26],[f.FretboardX,0],[f.FretboardO,0],[f.WiggleTrill,9],[f.WiggleVibratoMediumFast,10],[f.OctaveBaselineM,13],[f.OctaveBaselineB,9]]),on.Heights=new Map([[f.Brace,34],[f.BracketTop,0],[f.BracketBottom,0],[f.SystemDivider,0],[f.GClef,0],[f.CClef,0],[f.FClef,0],[f.UnpitchedPercussionClef1,0],[f.SixStringTabClef,0],[f.FourStringTabClef,0],[f.TimeSig0,0],[f.TimeSig1,0],[f.TimeSig2,0],[f.TimeSig3,0],[f.TimeSig4,0],[f.TimeSig5,0],[f.TimeSig6,0],[f.TimeSig7,0],[f.TimeSig8,0],[f.TimeSig9,0],[f.TimeSigCommon,0],[f.TimeSigCutCommon,0],[f.NoteheadDoubleWholeSquare,8],[f.NoteheadDoubleWhole,8],[f.NoteheadWhole,8],[f.NoteheadHalf,8],[f.NoteheadBlack,8],[f.NoteheadNull,8],[f.NoteheadXOrnate,8],[f.NoteheadPlusDoubleWhole,8],[f.NoteheadPlusWhole,8],[f.NoteheadPlusHalf,8],[f.NoteheadPlusBlack,8],[f.NoteheadSquareWhite,8],[f.NoteheadSquareBlack,8],[f.NoteheadTriangleUpDoubleWhole,8],[f.NoteheadTriangleUpWhole,8],[f.NoteheadTriangleUpHalf,8],[f.NoteheadTriangleUpBlack,8],[f.NoteheadTriangleRightWhite,8],[f.NoteheadTriangleRightBlack,8],[f.NoteheadTriangleDownDoubleWhole,8],[f.NoteheadTriangleDownWhole,8],[f.NoteheadTriangleDownHalf,8],[f.NoteheadTriangleDownBlack,8],[f.NoteheadDiamondDoubleWhole,8],[f.NoteheadDiamondWhole,8],[f.NoteheadDiamondHalf,8],[f.NoteheadDiamondBlack,8],[f.NoteheadDiamondBlackWide,9],[f.NoteheadDiamondWhite,9],[f.NoteheadDiamondWhiteWide,9],[f.NoteheadCircleXDoubleWhole,8],[f.NoteheadCircleXWhole,8],[f.NoteheadCircleXHalf,8],[f.NoteheadCircleX,8],[f.NoteheadXDoubleWhole,8],[f.NoteheadXWhole,8],[f.NoteheadXHalf,8],[f.NoteheadXBlack,8],[f.NoteheadParenthesis,8],[f.NoteheadSlashedBlack1,8],[f.NoteheadSlashedBlack2,8],[f.NoteheadSlashedHalf1,8],[f.NoteheadSlashedHalf2,8],[f.NoteheadSlashedWhole1,8],[f.NoteheadSlashedWhole2,8],[f.NoteheadSlashedDoubleWhole1,8],[f.NoteheadSlashedDoubleWhole2,8],[f.NoteheadCircledBlack,8],[f.NoteheadCircledHalf,8],[f.NoteheadCircledWhole,8],[f.NoteheadCircledDoubleWhole,8],[f.NoteheadCircleSlash,8],[f.NoteheadHeavyX,8],[f.NoteheadHeavyXHat,8],[f.NoteheadSlashVerticalEnds,17],[f.NoteheadSlashWhiteWhole,17],[f.NoteheadSlashWhiteHalf,17],[f.NoteheadRoundWhiteWithDot,8],[f.NoteheadSquareBlackLarge,8],[f.NoteheadSquareBlackWhite,8],[f.NoteheadClusterDoubleWhole3rd,8],[f.NoteheadClusterWhole3rd,8],[f.NoteheadClusterHalf3rd,8],[f.NoteheadClusterQuarter3rd,8],[f.NoteShapeRoundWhite,8],[f.NoteShapeRoundBlack,8],[f.NoteShapeSquareWhite,8],[f.NoteShapeSquareBlack,8],[f.NoteShapeTriangleRightWhite,8],[f.NoteShapeTriangleRightBlack,8],[f.NoteShapeTriangleLeftWhite,8],[f.NoteShapeTriangleLeftBlack,8],[f.NoteShapeDiamondWhite,8],[f.NoteShapeDiamondBlack,8],[f.NoteShapeTriangleUpWhite,8],[f.NoteShapeTriangleUpBlack,8],[f.NoteShapeMoonWhite,8],[f.NoteShapeMoonBlack,8],[f.NoteShapeTriangleRoundWhite,8],[f.NoteShapeTriangleRoundBlack,8],[f.NoteQuarterUp,8],[f.NoteEighthUp,8],[f.TextBlackNoteLongStem,0],[f.TextBlackNoteFrac8thLongStem,0],[f.TextBlackNoteFrac16thLongStem,0],[f.TextBlackNoteFrac32ndLongStem,0],[f.TextCont8thBeamLongStem,0],[f.TextCont16thBeamLongStem,0],[f.TextCont32ndBeamLongStem,0],[f.TextAugmentationDot,0],[f.TextTupletBracketStartLongStem,0],[f.TextTuplet3LongStem,0],[f.TextTupletBracketEndLongStem,0],[f.Tremolo3,0],[f.Tremolo2,0],[f.Tremolo1,0],[f.FlagEighthUp,0],[f.FlagEighthDown,0],[f.FlagSixteenthUp,0],[f.FlagSixteenthDown,0],[f.FlagThirtySecondUp,0],[f.FlagThirtySecondDown,0],[f.FlagSixtyFourthUp,0],[f.FlagSixtyFourthDown,0],[f.FlagOneHundredTwentyEighthUp,0],[f.FlagOneHundredTwentyEighthDown,0],[f.FlagTwoHundredFiftySixthUp,0],[f.FlagTwoHundredFiftySixthDown,0],[f.AccidentalFlat,0],[f.AccidentalNatural,0],[f.AccidentalSharp,0],[f.AccidentalDoubleSharp,0],[f.AccidentalDoubleFlat,0],[f.AccidentalQuarterToneFlatArrowUp,0],[f.AccidentalQuarterToneSharpArrowUp,0],[f.AccidentalQuarterToneNaturalArrowUp,0],[f.Segno,0],[f.Coda,0],[f.ArticAccentAbove,9],[f.ArticAccentBelow,9],[f.ArticStaccatoAbove,9],[f.ArticStaccatoBelow,9],[f.ArticTenutoAbove,9],[f.ArticTenutoBelow,9],[f.ArticMarcatoAbove,9],[f.ArticMarcatoBelow,9],[f.FermataAbove,12],[f.FermataShortAbove,12],[f.FermataLongAbove,12],[f.RestLonga,0],[f.RestDoubleWhole,0],[f.RestWhole,0],[f.RestHalf,0],[f.RestQuarter,0],[f.RestEighth,0],[f.RestSixteenth,0],[f.RestThirtySecond,0],[f.RestSixtyFourth,0],[f.RestOneHundredTwentyEighth,0],[f.RestTwoHundredFiftySixth,0],[f.RestHBarLeft,0],[f.RestHBarMiddle,0],[f.RestHBarRight,0],[f.Repeat1Bar,0],[f.Repeat2Bars,0],[f.Ottava,13],[f.OttavaAlta,13],[f.OttavaBassaVb,13],[f.Quindicesima,13],[f.QuindicesimaAlta,13],[f.DynamicPPPPPP,28.4],[f.DynamicPPPPP,28.4],[f.DynamicPPPP,28.4],[f.DynamicPPP,28.4],[f.DynamicPP,28.4],[f.DynamicPiano,28.4],[f.DynamicMP,28.4],[f.DynamicMF,28.4],[f.DynamicPF,28.4],[f.DynamicForte,28.4],[f.DynamicFF,28.4],[f.DynamicFFF,28.4],[f.DynamicFFFF,28.4],[f.DynamicFFFFF,28.4],[f.DynamicFFFFFF,28.4],[f.DynamicFortePiano,28.4],[f.DynamicNiente,28.4],[f.DynamicSforzando1,28.4],[f.DynamicSforzandoPiano,28.4],[f.DynamicSforzandoPianissimo,28.4],[f.DynamicSforzato,28.4],[f.DynamicSforzatoPiano,28.4],[f.DynamicSforzatoFF,28.4],[f.DynamicRinforzando1,28.4],[f.DynamicRinforzando2,28.4],[f.DynamicForzando,28.4],[f.OrnamentTrill,24],[f.OrnamentTurn,18],[f.OrnamentTurnInverted,18],[f.OrnamentShortTrill,18],[f.OrnamentMordent,18],[f.StringsDownBow,13/.75],[f.StringsUpBow,13/.75],[f.KeyboardPedalPed,19],[f.KeyboardPedalUp,16],[f.PictEdgeOfCymbal,30],[f.GuitarString0,20],[f.GuitarString1,20],[f.GuitarString2,20],[f.GuitarString3,20],[f.GuitarString4,20],[f.GuitarString5,20],[f.GuitarString6,20],[f.GuitarString7,20],[f.GuitarString8,20],[f.GuitarString9,20],[f.GuitarOpenPedal,11],[f.GuitarClosePedal,11],[f.GuitarGolpe,13.4],[f.GuitarFadeIn,13],[f.GuitarFadeOut,13],[f.GuitarVolumeSwell,13],[f.FretboardX,0],[f.FretboardO,0],[f.WiggleTrill,6],[f.WiggleVibratoMediumFast,10],[f.OctaveBaselineM,0],[f.OctaveBaselineB,0]]);class Us extends ro{constructor(e,t,n,i){super(e,t),this.glyphScale=0,this.center=!1,this.glyphScale=n,this.symbol=i}doLayout(){this.width=on.Widths.has(this.symbol)?on.Widths.get(this.symbol)*this.glyphScale:0,this.height=on.Heights.has(this.symbol)?on.Heights.get(this.symbol)*this.glyphScale:0}paint(e,t,n){const i=n.color;this.colorOverride&&(n.color=this.colorOverride),n.fillMusicFontSymbol(e+this.x,t+this.y,this.glyphScale,this.symbol,this.center),n.color=i}}let Pn=(()=>{class s extends Us{constructor(t,n,i,r){super(t,n,r?s.GraceScale:1,s.getSymbol(i)),this.centerOnStem=!1,this._isGrace=r}paint(t,n,i){const r=this._isGrace?1:0;this.centerOnStem&&(this.center=!0),super.paint(t,n+r,i)}static getSymbol(t){switch(t){case w.QuadrupleWhole:return f.NoteheadDoubleWholeSquare;case w.DoubleWhole:return f.NoteheadDoubleWhole;case w.Whole:return f.NoteheadWhole;case w.Half:return f.NoteheadHalf;default:return f.NoteheadBlack}}}return s.GraceScale=.75,s})(),Rw=(()=>{class s extends Us{constructor(t,n,i,r,o){super(t,n,o?Pn.GraceScale:1,s.getSymbol(i,r,o))}static getSymbol(t,n,i){if(i&&(t=w.Eighth),n===V.Up)switch(t){case w.Eighth:return f.FlagEighthUp;case w.Sixteenth:return f.FlagSixteenthUp;case w.ThirtySecond:return f.FlagThirtySecondUp;case w.SixtyFourth:return f.FlagSixtyFourthUp;case w.OneHundredTwentyEighth:return f.FlagOneHundredTwentyEighthUp;case w.TwoHundredFiftySixth:return f.FlagTwoHundredFiftySixthUp;default:return f.FlagEighthUp}switch(t){case w.Eighth:return f.FlagEighthDown;case w.Sixteenth:return f.FlagSixteenthDown;case w.ThirtySecond:return f.FlagThirtySecondDown;case w.SixtyFourth:return f.FlagSixtyFourthDown;case w.OneHundredTwentyEighth:case w.TwoHundredFiftySixth:return f.FlagOneHundredTwentyEighthDown;default:return f.FlagEighthDown}}}return s.FlagWidth=11,s})(),za=(()=>{class s extends os{get onTimeX(){return this.onNotes.x+this.onNotes.centerX}constructor(t,n){super(0,0),this.ties=[],this.minWidth=0,this.beat=t,this.ties=[],this.voiceContainer=n}addTie(t){t.renderer=this.renderer,this.ties.push(t)}drawBeamHelperAsFlags(t){return t.hasFlag(!1,void 0)}registerLayoutingInfo(t){const n=this.preNotes.computedWidth+this.onNotes.centerX;let i=this.onNotes.computedWidth-this.onNotes.centerX;const r=this.renderer.helpers.getBeamingHelperForBeat(this.beat);this.beat.graceType!==Ee.None?i+=1===this.beat.graceGroup.beats.length?Rw.FlagWidth*Pn.GraceScale:this.beat.graceIndex<this.beat.graceGroup.beats.length-1?7:s.GraceBeatPadding:r&&this.drawBeamHelperAsFlags(r)&&(i+=Rw.FlagWidth);for(const o of this.ties)i+=o.width;t.addBeatSpring(this.beat,n,i)}applyLayoutingInfo(t){this.onNotes.updateBeamingHelper(),this.updateWidth()}doLayout(){this.preNotes.x=0,this.preNotes.renderer=this.renderer,this.preNotes.container=this,this.preNotes.doLayout(),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.renderer=this.renderer,this.onNotes.container=this,this.onNotes.doLayout();let t=this.beat.notes.length-1;for(;t>=0;)this.createTies(this.beat.notes[t--]);this.renderer.registerTies(this.ties),this.updateWidth()}updateWidth(){if(this.minWidth=this.preNotes.width+this.onNotes.width,!this.beat.isRest)if(1===this.onNotes.beamingHelper.beats.length)this.beat.duration>=w.Eighth&&(this.minWidth+=20);else switch(this.beat.duration){case w.OneHundredTwentyEighth:case w.TwoHundredFiftySixth:this.minWidth+=10}let t=0;for(const n of this.ties)n.width>t&&(t=n.width);this.minWidth+=t,this.width=this.minWidth}scaleToWidth(t){this.onNotes.updateBeamingHelper(),this.width=t}createTies(t){}static getGroupId(t){return`b${t.id}`}paint(t,n,i){if(this.preNotes.isEmpty&&this.onNotes.isEmpty&&0===this.ties.length)return;i.beginGroup(s.getGroupId(this.beat)),this.preNotes.paint(t+this.x,n+this.y,i),this.onNotes.paint(t+this.x,n+this.y,i);const o=t-this.voiceContainer.x-this.renderer.x,a=n-this.voiceContainer.y-this.renderer.y;for(let l=0,c=this.ties.length;l<c;l++){const u=this.ties[l];u.renderer=this.renderer,u.paint(o,a,i)}i.endGroup()}buildBoundingsLookup(t,n,i,r){const o=new JD;if(o.beat=this.beat,this.beat.isEmpty)o.visualBounds=new bi,o.visualBounds.x=n+this.x,o.visualBounds.y=t.visualBounds.y,o.visualBounds.w=this.width,o.visualBounds.h=t.visualBounds.h,o.realBounds=new bi,o.realBounds.x=n+this.x,o.realBounds.y=t.realBounds.y,o.realBounds.w=this.width,o.realBounds.h=t.realBounds.h,o.onNotesX=n+this.x+this.onNotes.centerX;else{o.visualBounds=new bi,o.visualBounds.x=n+this.x,o.visualBounds.x=this.preNotes.isEmpty?this.onNotes.isEmpty?n+this.x:n+this.x+this.onNotes.x:n+this.x+this.preNotes.x;let a=0;a=this.onNotes.isEmpty?this.preNotes.isEmpty?n+this.x+this.width:n+this.x+this.preNotes.x+this.preNotes.width:n+this.x+this.onNotes.x+this.onNotes.width,o.visualBounds.w=a-o.visualBounds.x;const l=this.renderer.helpers.getBeamingHelperForBeat(this.beat);(l&&this.drawBeamHelperAsFlags(l)||this.beat.graceType!==Ee.None)&&(o.visualBounds.w+=Rw.FlagWidth*(this.beat.graceType!==Ee.None?Pn.GraceScale:1)),o.visualBounds.y=t.visualBounds.y,o.visualBounds.h=t.visualBounds.h,o.realBounds=new bi,o.realBounds.x=n+this.x,o.realBounds.y=t.realBounds.y,o.realBounds.w=this.width,o.realBounds.h=t.realBounds.h,o.onNotesX=n+this.x+this.onNotes.x+this.onNotes.centerX}t.addBeat(o),this.renderer.settings.core.includeNoteBounds&&this.onNotes.buildBoundingsLookup(o,n+this.x,i+this.y)}}return s.GraceBeatPadding=3,s})();class Q2{constructor(){this.oldWidth=0,this.newWidth=0,this.settings=null}core(){return this.settings&&this.causeIssue()?this.settings.core:new kx}causeIssue(){return this.settings=null,!0}}class tx{constructor(e){this.activeBeats=e}}class Kne{constructor(){this._midiEventQueue=new zD,this.masterVolume=1,this.metronomeVolume=0,this.outSampleRate=44100,this.currentTempo=120,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.activeVoiceCount=0}noteOffAll(e){}resetSoft(){}resetPresets(){}loadPresets(e,t,n,i){}setupMetronomeChannel(e){}synthesizeSilent(e){this.fakeSynthesize()}processMidiMessage(e){}dispatchEvent(e){this._midiEventQueue.enqueue(e)}synthesize(e,t,n){return this.fakeSynthesize()}fakeSynthesize(){const e=[];for(;!this._midiEventQueue.isEmpty;){const t=this._midiEventQueue.dequeue();t.isMetronome&&this.metronomeVolume>0||t.event&&this.processMidiMessage(t.event),e.push(t)}return e}applyTranspositionPitches(e){}setChannelTranspositionPitch(e,t){}channelSetMute(e,t){}channelSetSolo(e,t){}resetChannelStates(){}channelSetMixVolume(e,t){}hasSamplesForProgram(e){return!0}hasSamplesForPercussion(e){return!0}}class K2 extends $D{constructor(e,t){super(e,new Kne,t),this.synthesizer.output=e,this._backingTrackOutput=e,e.timeUpdate.on(n=>{const i=this.sequencer.mainTimePositionFromBackingTrack(n,e.backingTrackDuration);this.sequencer.fillMidiEventQueueToEndTime(i),this.synthesizer.fakeSynthesize(),this.updateTimePosition(i,!1),this.checkForFinish()})}updateMasterVolume(e){super.updateMasterVolume(e),this._backingTrackOutput.masterVolume=e}updatePlaybackSpeed(e){super.updatePlaybackSpeed(e),this._backingTrackOutput.playbackRate=e}onSampleRequest(){}loadMidiFile(e){this.isSoundFontLoaded||(this.isSoundFontLoaded=!0,this.soundFontLoaded.trigger()),super.loadMidiFile(e)}updateTimePosition(e,t){super.updateTimePosition(e,t),t&&this._backingTrackOutput.seekTo(this.sequencer.mainTimePositionToBackingTrack(e,this._backingTrackOutput.backingTrackDuration))}loadBackingTrack(e){const t=e.backingTrack;t&&(this._backingTrackOutput.loadBackingTrack(t),this.timePosition=0)}updateSyncPoints(e){this.sequencer.mainUpdateSyncPoints(e),this.tickPosition=this.tickPosition}}class ese{constructor(){this.sampleRate=44100,this._seekPosition=0,this.ready=new ks,this.samplesPlayed=new ft,this.timeUpdate=new ft,this.sampleRequest=new ks}get handler(){return this._handler}set handler(e){e&&0!==this._seekPosition&&(e.seekTo(this._seekPosition),this._seekPosition=0),this._handler=e}get backingTrackDuration(){return this.handler?.backingTrackDuration??0}get playbackRate(){return this.handler?.playbackRate??1}set playbackRate(e){const t=this.handler;t&&(t.playbackRate=e)}get masterVolume(){return this.handler?.masterVolume??1}set masterVolume(e){const t=this.handler;t&&(t.masterVolume=e)}seekTo(e){const t=this.handler;t?t.seekTo(e):this._seekPosition=e}loadBackingTrack(e){}open(e){this.ready.trigger()}updatePosition(e){this.timeUpdate.trigger(e)}play(){this.handler?.play()}destroy(){}pause(){this.handler?.pause()}addSamples(e){}resetSamples(){}activate(){}enumerateOutputDevices(){return Ae(function*(){return[]})()}setOutputDevice(e){return Ae(function*(){})()}getOutputDevice(){return Ae(function*(){return null})()}}class tse extends K2{get handler(){return this.output.handler}set handler(e){this.output.handler=e}constructor(e){super(new ese,e)}}class nse{constructor(){this._masterVolume=1,this._metronomeVolume=0,this._countInVolume=0,this._playbackSpeed=1,this._isLooping=!1,this._midiEventsPlayedFilter=[],this.finished=new ks,this.soundFontLoaded=new ks,this.soundFontLoadFailed=new ft,this.midiLoadFailed=new ft,this.midiEventsPlayed=new ft,this.ready=new ks(()=>this.isReady),this.readyForPlayback=new ks(()=>this.isReadyForPlayback),this.midiLoaded=new ft(()=>this._instance?.loadedMidiInfo??null),this.stateChanged=new ft(()=>new Fh(this.state,!1)),this.positionChanged=new ft(()=>this.currentPosition),this.playbackRangeChanged=new ft(()=>{const e=this.playbackRange;return e?new Qg(e):null})}get instance(){return this._instance}set instance(e){this._instance=e;const t=this._instanceEventUnregister;if(t)for(const n of t)n();if(e){const n=[];n.push(e.ready.on(()=>this.ready.trigger())),n.push(e.readyForPlayback.on(()=>this.readyForPlayback.trigger())),n.push(e.finished.on(()=>this.finished.trigger())),n.push(e.soundFontLoaded.on(()=>this.soundFontLoaded.trigger())),n.push(e.soundFontLoadFailed.on(i=>this.soundFontLoadFailed.trigger(i))),n.push(e.midiLoaded.on(i=>{this.midiLoaded.trigger(i)})),n.push(e.midiLoadFailed.on(i=>this.midiLoadFailed.trigger(i))),n.push(e.stateChanged.on(i=>this.stateChanged.trigger(i))),n.push(e.positionChanged.on(i=>{this.positionChanged.trigger(i)})),n.push(e.midiEventsPlayed.on(i=>this.midiEventsPlayed.trigger(i))),n.push(e.playbackRangeChanged.on(i=>this.playbackRangeChanged.trigger(i))),this._instanceEventUnregister=n,this.isReady?(e.masterVolume=this._masterVolume,e.metronomeVolume=this._metronomeVolume,e.countInVolume=this._countInVolume,e.playbackSpeed=this._playbackSpeed,e.isLooping=this._isLooping,e.midiEventsPlayedFilter=this._midiEventsPlayedFilter,this.ready.trigger()):n.push(e.ready.on(()=>{e.masterVolume=this._masterVolume,e.metronomeVolume=this._metronomeVolume,e.countInVolume=this._countInVolume,e.playbackSpeed=this._playbackSpeed,e.isLooping=this._isLooping,e.midiEventsPlayedFilter=this._midiEventsPlayedFilter}))}else this._instanceEventUnregister=void 0}get output(){return this._instance.output}get isReady(){return!!this._instance&&this._instance.isReady}get isReadyForPlayback(){return!!this._instance&&this._instance.isReadyForPlayback}get state(){return this._instance?this._instance.state:wi.Paused}get logLevel(){return F.logLevel}set logLevel(e){F.logLevel=e,this._instance&&(this._instance.logLevel=e)}get masterVolume(){return this._masterVolume}set masterVolume(e){e=Math.max(e,xe.MinVolume),this._masterVolume=e,this._instance&&(this._instance.masterVolume=e)}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,xe.MinVolume),this._metronomeVolume=e,this._instance&&(this._instance.metronomeVolume=e)}get playbackSpeed(){return this._playbackSpeed}set playbackSpeed(e){this._playbackSpeed=e,this._instance&&(this._instance.playbackSpeed=e)}get loadedMidiInfo(){return this._instance?this._instance.loadedMidiInfo:void 0}get currentPosition(){return this._instance?this._instance.currentPosition:new Nl(0,0,0,0,!1,120,120)}get tickPosition(){return this._instance?this._instance.tickPosition:0}set tickPosition(e){this._instance&&(this._instance.tickPosition=e)}get timePosition(){return this._instance?this._instance.timePosition:0}set timePosition(e){this._instance&&(this._instance.timePosition=e)}get playbackRange(){return this._instance?this._instance.playbackRange:null}set playbackRange(e){this._instance&&(this._instance.playbackRange=e)}get isLooping(){return this._isLooping}set isLooping(e){this._isLooping=e,this._instance&&(this._instance.isLooping=e)}get countInVolume(){return this._countInVolume}set countInVolume(e){this._countInVolume=e,this._instance&&(this._instance.countInVolume=e)}get midiEventsPlayedFilter(){return this._midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=e,this._instance&&(this._instance.midiEventsPlayedFilter=e)}destroy(){this._instance&&(this._instance.destroy(),this._instance=void 0)}play(){return!!this._instance&&this._instance.play()}pause(){this._instance&&this._instance.pause()}playPause(){this._instance&&this._instance.playPause()}stop(){this._instance&&this._instance.stop()}playOneTimeMidiFile(e){this._instance&&this._instance.playOneTimeMidiFile(e)}loadSoundFont(e,t){this._instance&&this._instance.loadSoundFont(e,t)}resetSoundFonts(){this._instance&&this._instance.resetSoundFonts()}loadMidiFile(e){this._instance&&this._instance.loadMidiFile(e)}loadBackingTrack(e){this._instance&&this._instance.loadBackingTrack(e)}updateSyncPoints(e){this._instance&&this._instance.updateSyncPoints(e)}applyTranspositionPitches(e){this._instance&&this._instance.applyTranspositionPitches(e)}setChannelTranspositionPitch(e,t){this._instance&&this._instance.setChannelTranspositionPitch(e,t)}setChannelMute(e,t){this._instance&&this._instance.setChannelMute(e,t)}resetChannelStates(){this._instance&&this._instance.resetChannelStates()}setChannelSolo(e,t){this._instance&&this._instance.setChannelSolo(e,t)}setChannelVolume(e,t){this._instance&&this._instance.setChannelVolume(e,t)}}class sse{constructor(){this._width=0,this._score=null,this._trackIndexes=null,this.preRender=new ft,this.renderFinished=new ft,this.partialRenderFinished=new ft,this.partialLayoutFinished=new ft,this.postRenderFinished=new ks,this.error=new ft}get instance(){return this._instance}set instance(e){this._instance=e;const t=this._instanceEventUnregister;if(t)for(const n of t)n();if(e){const n=[];n.push(e.preRender.on(i=>this.preRender.trigger(i))),n.push(e.renderFinished.on(i=>this.renderFinished.trigger(i))),n.push(e.partialRenderFinished.on(i=>this.partialRenderFinished.trigger(i))),n.push(e.partialLayoutFinished.on(i=>this.partialLayoutFinished.trigger(i))),n.push(e.postRenderFinished.on(()=>this.postRenderFinished.trigger())),n.push(e.error.on(i=>this.error.trigger(i))),this._instanceEventUnregister=n,this._settings&&e.updateSettings(this._settings),e.width=this._width,null!==this._score&&e.renderScore(this._score,this._trackIndexes)}else this._instanceEventUnregister=void 0}get boundsLookup(){return this._instance?this._instance.boundsLookup:null}get width(){return this._instance?this._instance.width:0}set width(e){this._width=e,this._instance&&(this._instance.width=e)}render(){this._instance?.render()}resizeRender(){this._instance?.resizeRender()}renderScore(e,t){this._score=e,this._trackIndexes=t,this._instance?.renderScore(e,t)}renderResult(e){this._instance?.renderResult(e)}updateSettings(e){this._settings=e,this._instance?.updateSettings(e)}destroy(){this._instance?.destroy(),this._instance=void 0}}class Fw{constructor(e){this.bounds=null,this.beat=e}}class ise{get actualPlayerMode(){return this._actualPlayerMode}get renderer(){return this._renderer}get score(){return this._score}get tracks(){return this._tracks}constructor(e,t){this._startTime=0,this._trackIndexes=null,this._trackIndexLookup=null,this._isDestroyed=!1,this._score=null,this._tracks=[],this._actualPlayerMode=vr.Disabled,this._tickCache=null,this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null,this._previousTick=0,this._currentBeat=null,this._currentBeatBounds=null,this._isInitialBeatCursorUpdate=!0,this._previousStateForCursor=wi.Paused,this._previousCursorCache=null,this._lastScroll=0,this._beatMouseDown=!1,this._noteMouseDown=!1,this._selectionStart=null,this._selectionEnd=null,this.beatMouseDown=new ft,this.beatMouseMove=new ft,this.beatMouseUp=new ft,this.noteMouseDown=new ft,this.noteMouseMove=new ft,this.noteMouseUp=new ft,this.resize=new ft,this.renderStarted=new ft,this.renderFinished=new ft,this.postRenderFinished=new ks,this.error=new ft,this.midiLoad=new ft,this.settingsUpdated=new ks,this.uiFacade=e,this.container=e.rootContainer,this.activeBeatsChanged=new ft(()=>this._player.state===wi.Playing&&this._currentBeat?new tx(this._currentBeat.beatLookup.highlightedBeats.map(i=>i.beat)):null),this.playedBeatChanged=new ft(()=>this._player.state===wi.Playing&&this._currentBeat?this._currentBeat.beat:null),this.scoreLoaded=new ft(()=>this._score?this._score:null),this.midiLoaded=new ft(()=>this._player.loadedMidiInfo??null),e.initialize(this,t),F.logLevel=this.settings.core.logLevel,this.settings.handleBackwardsCompatibility(),B.printEnvironmentInfo(!1),this.canvasElement=e.createCanvasElement(),this.container.appendChild(this.canvasElement),this._renderer=new sse,this._renderer.instance=this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&B.getRenderEngineFactory(this.settings.core.engine).supportsWorkers?this.uiFacade.createWorkerRenderer():new Mf(this.settings),this.container.resize.on(B.throttle(()=>{this._isDestroyed||this.container.width!==this._renderer.width&&this.triggerResize()},e.resizeThrottle));const n=new Q2;n.oldWidth=this._renderer.width,n.newWidth=0|this.container.width,n.settings=this.settings,this.onResize(n),this._renderer.preRender.on(this.onRenderStarted.bind(this)),this._renderer.renderFinished.on(i=>{this.onRenderFinished(i)}),this._renderer.postRenderFinished.on(()=>{const i=Date.now()-this._startTime;F.debug("rendering",`Rendering completed in ${i}ms`),this.onPostRenderFinished()}),this._renderer.preRender.on(i=>{this._startTime=Date.now()}),this._renderer.partialLayoutFinished.on(i=>this.appendRenderResult(i,!1)),this._renderer.partialRenderFinished.on(this.updateRenderResult.bind(this)),this._renderer.renderFinished.on(i=>{this.appendRenderResult(i,!0)}),this._renderer.error.on(this.onError.bind(this)),this.setupPlayerWrapper(),this.settings.player.playerMode!==vr.Disabled&&this.setupOrDestroyPlayer(),this.setupClickHandling(),this.uiFacade.beginInvoke(()=>{this.uiFacade.initialRender()})}setupPlayerWrapper(){const e=new nse;this._player=e,e.ready.on(()=>{this.loadMidiForScore()}),e.readyForPlayback.on(()=>{if(this.onPlayerReady(),this.tracks)for(const t of this.tracks){const n=t.playbackInfo.volume/16;e.setChannelVolume(t.playbackInfo.primaryChannel,n),e.setChannelVolume(t.playbackInfo.secondaryChannel,n)}}),e.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),e.soundFontLoadFailed.on(t=>{this.onError(t)}),e.midiLoaded.on(this.onMidiLoaded.bind(this)),e.midiLoadFailed.on(t=>{this.onError(t)}),e.stateChanged.on(this.onPlayerStateChanged.bind(this)),e.positionChanged.on(this.onPlayerPositionChanged.bind(this)),e.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),e.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),e.finished.on(this.onPlayerFinished.bind(this))}destroy(){this._isDestroyed=!0,this._player.destroy(),this.uiFacade.destroy(),this._renderer.destroy()}updateSettings(){this.settings.handleBackwardsCompatibility();const e=this.score;e&&ie.applyPitchOffsets(this.settings,e),this.updateRenderer(),this._renderer.updateSettings(this.settings),this.setupOrDestroyPlayer(),this.onSettingsUpdated()}updateRenderer(){const e=this._renderer;this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&B.getRenderEngineFactory(this.settings.core.engine).supportsWorkers?e.instance instanceof Mf&&(e.destroy(),e.instance=this.uiFacade.createWorkerRenderer()):e.instance instanceof Mf||(e.destroy(),e.instance=new Mf(this.settings))}load(e,t){try{return this.uiFacade.load(e,n=>{this.renderScore(n,t)},n=>{this.onError(n)})}catch(n){return this.onError(n),!1}}renderScore(e,t){const n=[];if(t)if(0===t.length)e.tracks.length>0&&n.push(e.tracks[0]);else if(1===t.length&&-1===t[0])for(const i of e.tracks)n.push(i);else for(const i of t)i>=0&&i<=e.tracks.length&&n.push(e.tracks[i]);else e.tracks.length>0&&n.push(e.tracks[0]);this.internalRenderTracks(e,n)}renderTracks(e){if(e.length>0){const t=e[0].score;for(const n of e)if(n.score!==t)return void this.onError(new rn(un.General,"All rendered tracks must belong to the same score."));this.internalRenderTracks(t,e)}}internalRenderTracks(e,t){if(ie.applyPitchOffsets(this.settings,e),e!==this.score){this._score=e,this._tracks=t,this._tickCache=null,this._trackIndexes=[];for(const n of t)this._trackIndexes.push(n.index);this._trackIndexLookup=new Set(this._trackIndexes),this.onScoreLoaded(e),this.loadMidiForScore(),this.render()}else{this._tracks=t;const n=ie.computeFirstDisplayedBarIndex(e,this.settings),i=ie.computeLastDisplayedBarIndex(e,this.settings,n);this._tickCache&&(this._tickCache.multiBarRestInfo=ie.buildMultiBarRestInfo(this.tracks,n,i)),this._trackIndexes=[];for(const r of t)this._trackIndexes.push(r.index);this._trackIndexLookup=new Set(this._trackIndexes),this.render()}}triggerResize(){if(this.container.isVisible){const e=new Q2;e.oldWidth=this._renderer.width,e.newWidth=this.container.width,e.settings=this.settings,this.onResize(e),this._renderer.updateSettings(this.settings),this._renderer.width=this.container.width,this._renderer.resizeRender()}else F.warning("Rendering","AlphaTab container was invisible while autosizing, waiting for element to become visible",null),this.uiFacade.rootContainerBecameVisible.on(()=>{F.debug("Rendering","AlphaTab container became visible, doing autosizing",null),this.triggerResize()})}appendRenderResult(e,t){t&&(this.canvasElement.width=e.totalWidth,this.canvasElement.height=e.totalHeight,this._cursorWrapper&&(this._cursorWrapper.width=e.totalWidth,this._cursorWrapper.height=e.totalHeight)),(e.width>0||e.height>0)&&this.uiFacade.beginAppendRenderResults(e),t&&this.uiFacade.beginAppendRenderResults(null)}updateRenderResult(e){e&&e.renderResult&&this.uiFacade.beginUpdateRenderResults(e)}tex(e,t){try{const n=new nw;n.logErrors=!0,n.initFromString(e,this.settings);const i=n.readScore();this.renderScore(i,t)}catch(n){this.onError(n)}}loadSoundFont(e,t=!1){return this.uiFacade.loadSoundFont(e,t)}resetSoundFonts(){this._player.resetSoundFonts()}render(){this.uiFacade.canRender?(this._renderer.width=this.container.width,this._renderer.renderScore(this.score,this._trackIndexes)):this.uiFacade.canRenderChanged.on(()=>this.render())}get tickCache(){return this._tickCache}get boundsLookup(){return this._renderer.boundsLookup}get player(){return this._player.instance?this._player:null}get isReadyForPlayback(){return this._player.isReadyForPlayback}get playerState(){return this._player.state}get masterVolume(){return this._player.masterVolume}set masterVolume(e){this._player.masterVolume=e}get metronomeVolume(){return this._player.metronomeVolume}set metronomeVolume(e){this._player.metronomeVolume=e}get countInVolume(){return this._player.countInVolume}set countInVolume(e){this._player.countInVolume=e}get midiEventsPlayedFilter(){return this._player.midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._player.midiEventsPlayedFilter=e}get tickPosition(){return this._player.tickPosition}set tickPosition(e){this._player.tickPosition=e}get timePosition(){return this._player.timePosition}set timePosition(e){this._player.timePosition=e}get endTick(){return this._player.currentPosition.endTick}get endTime(){return this._player.currentPosition.endTime}get playbackRange(){return this._player.playbackRange}set playbackRange(e){this._player.playbackRange=e,this.updateSelectionCursor(e)}get playbackSpeed(){return this._player.playbackSpeed}set playbackSpeed(e){this._player.playbackSpeed=e}get isLooping(){return this._player.isLooping}set isLooping(e){this._player.isLooping=e}destroyPlayer(){this._player.destroy(),this._previousTick=0,this.destroyCursors()}setupOrDestroyPlayer(){let e=this.settings.player.playerMode;if(e===vr.EnabledAutomatic){const n=this.score;if(!n)return!1;e=n?.backingTrack?.rawAudioFile?vr.EnabledBackingTrack:vr.EnabledSynthesizer}let t=null;if(e===this._actualPlayerMode)return this.updateCursors(),!1;switch(this.destroyPlayer(),this.updateCursors(),e){case vr.Disabled:t=null;break;case vr.EnabledSynthesizer:t=this.uiFacade.createWorkerPlayer();break;case vr.EnabledBackingTrack:t=this.uiFacade.createBackingTrackPlayer();break;case vr.EnabledExternalMedia:t=new tse(this.settings.player.bufferTimeInMilliseconds)}return this._actualPlayerMode=e,t&&(this._player.instance=t),!1}loadMidiForScore(){if(!this.score)return;const e=this.score;F.debug("AlphaTab","Generating Midi");const t=new xl,n=new da(t),i=new Ye(e,this.settings,n),r=ie.computeFirstDisplayedBarIndex(e,this.settings),o=ie.computeLastDisplayedBarIndex(e,this.settings,r);i.tickLookup.multiBarRestInfo=ie.buildMultiBarRestInfo(this.tracks,r,o),i.applyTranspositionPitches=!1,i.generate(),this._tickCache=i.tickLookup,this.onMidiLoad(t);const a=this._player;a.loadMidiFile(t),a.loadBackingTrack(e),a.updateSyncPoints(i.syncPoints),a.applyTranspositionPitches(i.transpositionPitches)}updateSyncPoints(){this.score&&this._player.updateSyncPoints(Ye.generateSyncPoints(this.score))}changeTrackVolume(e,t){for(const n of e)this._player.setChannelVolume(n.playbackInfo.primaryChannel,t),this._player.setChannelVolume(n.playbackInfo.secondaryChannel,t)}changeTrackSolo(e,t){for(const n of e)this._player.setChannelSolo(n.playbackInfo.primaryChannel,t),this._player.setChannelSolo(n.playbackInfo.secondaryChannel,t)}changeTrackMute(e,t){for(const n of e)this._player.setChannelMute(n.playbackInfo.primaryChannel,t),this._player.setChannelMute(n.playbackInfo.secondaryChannel,t)}changeTrackTranspositionPitch(e,t){for(const n of e)this._player.setChannelTranspositionPitch(n.playbackInfo.primaryChannel,t),this._player.setChannelTranspositionPitch(n.playbackInfo.secondaryChannel,t)}play(){return this._player.play()}pause(){this._player.pause()}playPause(){this._player.playPause()}stop(){this._player.stop()}playBeat(e){const t=new xl,n=new da(t);new Ye(e.voice.bar.staff.track.score,this.settings,n).generateSingleBeat(e),this._player.playOneTimeMidiFile(t)}playNote(e){const t=new xl,n=new da(t);new Ye(e.beat.voice.bar.staff.track.score,this.settings,n).generateSingleNote(e),this._player.playOneTimeMidiFile(t)}destroyCursors(){this._cursorWrapper&&(this.uiFacade.destroyCursors(),this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null)}updateCursors(){const e=this.hasCursor;if(e&&!this._cursorWrapper){const t=this.uiFacade.createCursors();t&&(this._cursorWrapper=t.cursorWrapper,this._barCursor=t.barCursor,this._beatCursor=t.beatCursor,this._selectionWrapper=t.selectionWrapper,this._isInitialBeatCursorUpdate=!0),null!==this._currentBeat&&this.cursorUpdateBeat(this._currentBeat,!1,this._previousTick>10,1,!0)}else!e&&this._cursorWrapper&&this.destroyCursors()}cursorUpdateTick(e,t,n,i=!1,r=!1){this._previousTick=e;const o=this._tickCache;if(o){const a=this._trackIndexLookup;if(null!=a&&a.size>0){const l=o.findBeat(a,e,this._currentBeat);l&&this.cursorUpdateBeat(l,t,i,n,r||this.playerState===wi.Paused)}}}cursorUpdateBeat(e,t,n,i,r=!1){const o=e.beat,a=e.nextBeat?.beat??null,l=e.duration,c=e.beatLookup.highlightedBeats;if(!o)return;const u=this._renderer.boundsLookup;if(!u)return;const h=this._currentBeat,d=this._previousCursorCache,p=this._previousStateForCursor;if(!r&&o===h?.beat&&u===d&&p===this._player.state&&h?.start===e.start)return;const g=u.findBeat(o);g&&(this._currentBeat=e,this._previousCursorCache=u,this._previousStateForCursor=this._player.state,this.uiFacade.beginInvoke(()=>{this.internalCursorUpdateBeat(o,a,l,t,c,u,g,n,e.cursorMode,i)}))}scrollToCursor(){const e=this._currentBeatBounds;e&&this.internalScrollToCursor(e.barBounds.masterBarBounds)}internalScrollToCursor(e){const t=this.uiFacade.getScrollContainer(),n=B.getLayoutEngineFactory(this.settings.display.layoutMode).vertical,i=this.settings.player.scrollMode;if(n){const r=e.realBounds.y+this.settings.player.scrollOffsetY;if(r!==this._lastScroll)switch(this._lastScroll=r,i){case bc.Continuous:const o=this.uiFacade.getOffset(t,this.container);this.uiFacade.scrollToY(t,o.y+r,this.settings.player.scrollSpeed);break;case bc.OffScreen:const a=t.scrollTop+this.uiFacade.getOffset(null,t).h;(e.visualBounds.y+e.visualBounds.h>=a||e.visualBounds.y<t.scrollTop)&&this.uiFacade.scrollToY(t,e.realBounds.y+this.settings.player.scrollOffsetY,this.settings.player.scrollSpeed)}}else{const r=e.visualBounds.x;if(r!==this._lastScroll)switch(this._lastScroll=r,i){case bc.Continuous:const o=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,o,this.settings.player.scrollSpeed);break;case bc.OffScreen:const a=t.scrollLeft+this.uiFacade.getOffset(null,t).w;if(e.visualBounds.x+e.visualBounds.w>=a||e.visualBounds.x<t.scrollLeft){const l=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,l,this.settings.player.scrollSpeed)}}}}internalCursorUpdateBeat(e,t,n,i,r,o,a,l,c,u){const h=this._barCursor,d=this._beatCursor,p=a.barBounds.masterBarBounds,g=p.visualBounds,m=this._currentBeatBounds;this._currentBeatBounds=a,h&&h.setBounds(g.x,g.y,g.w,g.h);const _=this._player.state===wi.Playing&&!i;let y=p.visualBounds.x+p.visualBounds.w;if(t&&c===jo.ToNextBext){const D=o.findBeat(t);D&&D.barBounds.masterBarBounds.staffSystemBounds===p.staffSystemBounds&&(y=D.onNotesX)}let b=a.onNotesX;if(d){if(this.settings.player.enableAnimatedBeatCursor){const C=this._currentBeat.tickDuration>0?(this._previousTick-this._currentBeat.start)/this._currentBeat.tickDuration:0;b=a.onNotesX+(y-a.onNotesX)*C,n-=n*C,_?((!m||this._isInitialBeatCursorUpdate||g.y!==m.barBounds.masterBarBounds.visualBounds.y||b<m.onNotesX||p.index>m.barBounds.masterBarBounds.index+1)&&(d.transitionToX(0,b),d.setBounds(b,g.y,1,g.h)),this.uiFacade.beginInvoke(()=>{const x=c===jo.ToNextBext?2:1;d.transitionToX(n/u*x,b+(y-b)*x)})):(d.transitionToX(0,b),d.setBounds(b,g.y,1,g.h))}else d.transitionToX(0,b),d.setBounds(b,g.y,1,g.h);this._isInitialBeatCursorUpdate=!1}else this._isInitialBeatCursorUpdate=!0;this.uiFacade.removeHighlights();let S=!1;if(_){if(this.settings.player.enableElementHighlighting)for(const D of r){const T=za.getGroupId(D.beat);this.uiFacade.highlightElements(T,e.voice.bar.index)}l=!i,S=!0}l&&!this._beatMouseDown&&this.settings.player.scrollMode!==bc.Off&&this.internalScrollToCursor(p),S&&(this.onPlayedBeatChanged(e),this.onActiveBeatsChanged(new tx(r.map(D=>D.beat))))}onPlayedBeatChanged(e){this._isDestroyed||(this.playedBeatChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playedBeatChanged",e))}onActiveBeatsChanged(e){this._isDestroyed||(this.activeBeatsChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"activeBeatsChanged",e))}get hasCursor(){return this.settings.player.playerMode!==vr.Disabled&&this.settings.player.enableCursor}onBeatMouseDown(e,t){this._isDestroyed||(this.hasCursor&&this.settings.player.enableUserInteraction&&(this._selectionStart=new Fw(t),this._selectionEnd=null),this._beatMouseDown=!0,this.beatMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseDown",t,e))}onNoteMouseDown(e,t){this._isDestroyed||(this._noteMouseDown=!0,this.noteMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseDown",t,e))}onBeatMouseMove(e,t){this._isDestroyed||(this.settings.player.enableUserInteraction&&(!this._selectionEnd||this._selectionEnd.beat!==t)&&(this._selectionEnd=new Fw(t),this.cursorSelectRange(this._selectionStart,this._selectionEnd)),this.beatMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseMove",t,e))}onNoteMouseMove(e,t){this._isDestroyed||(this.noteMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseMove",t,e))}onBeatMouseUp(e,t){if(!this._isDestroyed){if(this.hasCursor&&this.settings.player.enableUserInteraction){if(this._selectionEnd){const n=this._tickCache?.getBeatStart(this._selectionStart.beat)??this._selectionStart.beat.absolutePlaybackStart;if((this._tickCache?.getBeatStart(this._selectionEnd.beat)??this._selectionEnd.beat.absolutePlaybackStart)<n){const r=this._selectionStart;this._selectionStart=this._selectionEnd,this._selectionEnd=r}}if(this._selectionStart&&this._tickCache){const n=this._tickCache,i=n.getMasterBarStart(this._selectionStart.beat.voice.bar.masterBar);if(this._currentBeat=null,this._player.state===wi.Paused&&this.cursorUpdateTick(this._tickCache.getBeatStart(this._selectionStart.beat),!1,1),this.tickPosition=i+this._selectionStart.beat.playbackStart,this._selectionEnd&&this._selectionStart.beat!==this._selectionEnd.beat){const r=n.getMasterBarStart(this._selectionEnd.beat.voice.bar.masterBar),o=new Z2;o.startTick=i+this._selectionStart.beat.playbackStart,o.endTick=r+this._selectionEnd.beat.playbackStart+this._selectionEnd.beat.playbackDuration-50,this.playbackRange=o}else this._selectionStart=null,this.playbackRange=null,this.cursorSelectRange(this._selectionStart,this._selectionEnd)}}this.beatMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseUp",t,e),this._beatMouseDown=!1}}onNoteMouseUp(e,t){this._isDestroyed||(this.noteMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseUp",t,e),this._noteMouseDown=!1)}updateSelectionCursor(e){if(this._tickCache)if(e){const t=this._tickCache.findBeat(this._trackIndexLookup,e.startTick),n=this._tickCache.findBeat(this._trackIndexLookup,e.endTick);if(t&&n){const i=new Fw(t.beat),r=new Fw(n.beat);this.cursorSelectRange(i,r)}}else this.cursorSelectRange(null,null)}setupClickHandling(){this.canvasElement.mouseDown.on(e=>{if(!e.isLeftMouseButton)return;this.settings.player.enableUserInteraction&&e.preventDefault();const t=e.getX(this.canvasElement),n=e.getY(this.canvasElement),i=this._renderer.boundsLookup?.getBeatAtPos(t,n)??null;if(i&&(this.onBeatMouseDown(e,i),this.settings.core.includeNoteBounds)){const r=this._renderer.boundsLookup?.getNoteAtPos(i,t,n);r&&this.onNoteMouseDown(e,r)}}),this.canvasElement.mouseMove.on(e=>{if(!this._beatMouseDown)return;const t=e.getX(this.canvasElement),n=e.getY(this.canvasElement),i=this._renderer.boundsLookup?.getBeatAtPos(t,n)??null;if(i&&(this.onBeatMouseMove(e,i),this._noteMouseDown)){const r=this._renderer.boundsLookup?.getNoteAtPos(i,t,n);r&&this.onNoteMouseMove(e,r)}}),this.canvasElement.mouseUp.on(e=>{if(!this._beatMouseDown)return;this.settings.player.enableUserInteraction&&e.preventDefault();const t=e.getX(this.canvasElement),n=e.getY(this.canvasElement),i=this._renderer.boundsLookup?.getBeatAtPos(t,n)??null;if(this.onBeatMouseUp(e,i),this._noteMouseDown)if(i){const r=this._renderer.boundsLookup?.getNoteAtPos(i,t,n)??null;this.onNoteMouseUp(e,r)}else this.onNoteMouseUp(e,null)}),this._renderer.postRenderFinished.on(()=>{!this._selectionStart||!this.hasCursor||!this.settings.player.enableUserInteraction||this.cursorSelectRange(this._selectionStart,this._selectionEnd)})}cursorSelectRange(e,t){const n=this._renderer.boundsLookup;if(!n)return;const i=this._selectionWrapper;if(!i||(i.clear(),!e||!t||e.beat===t.beat))return;e.bounds||(e.bounds=n.findBeat(e.beat)),t.bounds||(t.bounds=n.findBeat(t.beat));const r=this._tickCache?.getBeatStart(e.beat)??e.beat.absolutePlaybackStart;if((this._tickCache?.getBeatStart(t.beat)??t.beat.absolutePlaybackStart)<r){const c=e;e=t,t=c}const a=e.bounds.realBounds.x;let l=t.bounds.realBounds.x+t.bounds.realBounds.w;if(t.beat.index===t.beat.voice.beats.length-1&&(l=t.bounds.barBounds.masterBarBounds.realBounds.x+t.bounds.barBounds.masterBarBounds.realBounds.w),e.bounds.barBounds.masterBarBounds.staffSystemBounds!==t.bounds.barBounds.masterBarBounds.staffSystemBounds){const c=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x,u=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x+e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.w,h=this.uiFacade.createSelectionElement();h.setBounds(a,e.bounds.barBounds.masterBarBounds.visualBounds.y,u-a,e.bounds.barBounds.masterBarBounds.visualBounds.h),i.appendChild(h);const p=t.bounds.barBounds.masterBarBounds.staffSystemBounds.index;for(let m=e.bounds.barBounds.masterBarBounds.staffSystemBounds.index+1;m<p;m++){const _=n.staffSystems[m],y=this.uiFacade.createSelectionElement();y.setBounds(c,_.visualBounds.y,u-c,_.visualBounds.h),i.appendChild(y)}const g=this.uiFacade.createSelectionElement();g.setBounds(c,t.bounds.barBounds.masterBarBounds.visualBounds.y,l-c,t.bounds.barBounds.masterBarBounds.visualBounds.h),i.appendChild(g)}else{const c=this.uiFacade.createSelectionElement();c.setBounds(a,e.bounds.barBounds.masterBarBounds.visualBounds.y,l-a,e.bounds.barBounds.masterBarBounds.visualBounds.h),i.appendChild(c)}}onScoreLoaded(e){this._isDestroyed||(this.scoreLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"scoreLoaded",e),this.setupOrDestroyPlayer()||this.loadMidiForScore())}onResize(e){this._isDestroyed||(this.resize.trigger(e),this.uiFacade.triggerEvent(this.container,"resize",e))}onRenderStarted(e){this._isDestroyed||(this.renderStarted.trigger(e),this.uiFacade.triggerEvent(this.container,"renderStarted",e))}onRenderFinished(e){this._isDestroyed||(this.renderFinished.trigger(e),this.uiFacade.triggerEvent(this.container,"renderFinished",e))}onPostRenderFinished(){this._isDestroyed||(this._currentBeat=null,this.cursorUpdateTick(this._previousTick,!1,1,!0,!0),this.postRenderFinished.trigger(),this.uiFacade.triggerEvent(this.container,"postRenderFinished",null))}onError(e){this._isDestroyed||(F.error("API","An unexpected error occurred",e),this.error.trigger(e),this.uiFacade.triggerEvent(this.container,"error",e))}get playerReady(){return this._player.readyForPlayback}onPlayerReady(){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"playerReady",null)}get playerFinished(){return this._player.finished}onPlayerFinished(){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"playerFinished",null)}get soundFontLoaded(){return this._player.soundFontLoaded}onSoundFontLoaded(){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"soundFontLoaded",null)}onMidiLoad(e){this._isDestroyed||(this.midiLoad.trigger(e),this.uiFacade.triggerEvent(this.container,"midiLoad",e))}onMidiLoaded(e){this._isDestroyed||(this.midiLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"midiFileLoaded",e))}get playerStateChanged(){return this._player.stateChanged}onPlayerStateChanged(e){if(!this._isDestroyed){if(!e.stopped&&e.state===wi.Paused){const t=this._currentBeat,n=this._tickCache;t&&n&&(this._player.tickPosition=n.getBeatStart(t.beat))}this.uiFacade.triggerEvent(this.container,"playerStateChanged",e)}}get playerPositionChanged(){return this._player.positionChanged}onPlayerPositionChanged(e){this._isDestroyed||(this._previousTick=e.currentTick,this.uiFacade.beginInvoke(()=>{this.cursorUpdateTick(e.currentTick,!1,e.modifiedTempo/e.originalTempo,!1,e.isSeek)}),this.uiFacade.triggerEvent(this.container,"playerPositionChanged",e))}get midiEventsPlayed(){return this._player.midiEventsPlayed}onMidiEventsPlayed(e){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"midiEventsPlayed",e)}get playbackRangeChanged(){return this._player.playbackRangeChanged}onPlaybackRangeChanged(e){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"playbackRangeChanged",e)}onSettingsUpdated(){this._isDestroyed||(this.settingsUpdated.trigger(),this.uiFacade.triggerEvent(this.container,"settingsUpdated",null))}enumerateOutputDevices(){var e=this;return Ae(function*(){return yield e._player.output.enumerateOutputDevices()})()}setOutputDevice(e){var t=this;return Ae(function*(){yield t._player.output.setOutputDevice(e)})()}getOutputDevice(){var e=this;return Ae(function*(){return yield e._player.output.getOutputDevice()})()}exportAudio(e){var t=this;return Ae(function*(){if(!t.score)throw new rn(un.General,"No song loaded");let n;n=t.uiFacade.createWorkerAudioExporter(t._actualPlayerMode===vr.EnabledSynthesizer?t._player.instance:null);const i=t.score,r=new xl,o=new da(r),a=new Ye(i,t.settings,o);a.applyTranspositionPitches=!1,a.generate();const l=new q2;l.soundFonts=e.soundFonts,l.sampleRate=e.sampleRate,l.useSyncPoints=e.useSyncPoints,l.masterVolume=e.masterVolume,l.metronomeVolume=e.metronomeVolume,l.playbackRange=e.playbackRange;for(const[c,u]of e.trackVolume)if(c<t.score.tracks.length){const h=t.score.tracks[c];l.trackVolume.set(h.playbackInfo.primaryChannel,u),l.trackVolume.set(h.playbackInfo.secondaryChannel,u)}for(const[c,u]of e.trackTranspositionPitches)if(c<t.score.tracks.length){const h=t.score.tracks[c];l.trackTranspositionPitches.set(h.playbackInfo.primaryChannel,u),l.trackTranspositionPitches.set(h.playbackInfo.secondaryChannel,u)}return yield n.initialize(l,r,a.syncPoints,a.transpositionPitches),n})()}}class vc extends rn{constructor(e,t){super(un.General,e),this.xhr=t,Object.setPrototypeOf(this,vc.prototype)}}class Vh{static loadAlphaTex(e,t){const n=new nw;return n.logErrors=!0,n.initFromString(e,t??new wc),n.readScore()}static loadScoreAsync(e,t,n,i){const r=new XMLHttpRequest;r.open("GET",e,!0,null,null),r.responseType="arraybuffer",r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE)if(200===r.status||0===r.status&&r.response)try{const l=new Uint8Array(r.response),c=Vh.loadScoreFromBytes(l,i);t(c)}catch(a){n(a)}else n(new vc(0===r.status?"You are offline!!\n Please Check Your Network.":404===r.status?"Requested URL not found.":500===r.status?"Internel Server Error.":"parsererror"===r.statusText?"Error.\nParsing JSON Request failed.":"timeout"===r.statusText?"Request Time out.":`Unknow Error: ${r.responseText}`,r))},r.send()}static loadScoreFromBytes(e,t){t||(t=new wc);const n=B.buildImporters();F.debug("ScoreLoader",`Loading score from ${e.length} bytes using ${n.length} importers`);let i=null;const r=ps.fromBuffer(e);for(const o of n){r.reset();try{F.debug("ScoreLoader",`Importing using importer ${o.name}`),o.init(r,t),i=o.readScore(),F.debug("ScoreLoader",`Score imported using ${o.name}`);break}catch(a){if(!(a instanceof Ts))throw F.error("ScoreLoader","Score import failed due to unexpected error: ",a),a;F.debug("ScoreLoader",`${o.name} does not support the file`)}}if(i)return i;throw new Ts("No compatible importer found for file")}}class nx{get isLeftMouseButton(){return 0===this.mouseEvent.button}getX(e){const t=e.element,i=t.getBoundingClientRect().left+t.ownerDocument.defaultView.pageXOffset;return this.mouseEvent.pageX-i}getY(e){const t=e.element,i=t.getBoundingClientRect().top+t.ownerDocument.defaultView.pageYOffset;return this.mouseEvent.pageY-i}preventDefault(){this.mouseEvent.preventDefault()}constructor(e){this.mouseEvent=e}}class Bl{get width(){return this.element.offsetWidth}set width(e){this.element.style.width=`${e}px`}get scrollLeft(){return this.element.scrollLeft}set scrollLeft(e){this.element.scrollLeft=e}get scrollTop(){return this.element.scrollTop}set scrollTop(e){this.element.scrollTop=e}get height(){return this.element.offsetHeight}set height(e){this.element.style.height=e>=0?`${e}px`:"100%"}get isVisible(){return!!this.element.offsetWidth||!!this.element.offsetHeight||!!this.element.getClientRects().length}constructor(e){this._resizeListeners=0,this.lastBounds=new bi,this.element=e,this.mouseDown={on:n=>{const i=r=>{n(new nx(r))};return this.element.addEventListener("mousedown",i,!0),()=>{this.element.removeEventListener("mousedown",i,!0)}},off:n=>{}},this.mouseUp={on:n=>{const i=r=>{n(new nx(r))};return this.element.addEventListener("mouseup",i,!0),()=>{this.element.removeEventListener("mouseup",i,!0)}},off:n=>{}},this.mouseMove={on:n=>{const i=r=>{n(new nx(r))};return this.element.addEventListener("mousemove",i,!0),()=>{this.element.removeEventListener("mousemove",i,!0)}},off:n=>{}};const t=this;this.resize={on:function(n){return 0===t._resizeListeners&&Bl.resizeObserver.value.observe(t.element),t.element.addEventListener("resize",n,!0),t._resizeListeners++,()=>this.off(n)},off:n=>{this.element.removeEventListener("resize",n,!0),this._resizeListeners--,this._resizeListeners<=0&&(this._resizeListeners=0,Bl.resizeObserver.value.unobserve(this.element))}}}stopAnimation(){this.element.style.transition="none"}transitionToX(e,t){this.element.style.transition=`transform ${e}ms linear`,this.setBounds(t,Number.NaN,Number.NaN,Number.NaN)}setBounds(e,t,n,i){Number.isNaN(e)&&(e=this.lastBounds.x),Number.isNaN(t)&&(t=this.lastBounds.y),Number.isNaN(n)&&(n=this.lastBounds.w),Number.isNaN(i)&&(i=this.lastBounds.h),this.element.style.transform=`translate(${e}px, ${t}px) scale(${n}, ${i})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=n,this.lastBounds.h=i}appendChild(e){this.element.appendChild(e.element)}clear(){this.element.innerHTML=""}}Bl.resizeObserver=new Wg(()=>new ResizeObserver(s=>{for(const e of s){const t=new CustomEvent("resize",{detail:e});e.target.dispatchEvent(t)}}));class eV{constructor(e){this._isStarted=!1,this.isFontLoaded=!1,this.fontLoaded=new ft,this._originalFamilies=e,this._families=e}checkForFontAvailability(){var e=this;if(B.isRunningInWorker)return void(this.isFontLoaded=!1);if(this._isStarted)return;this._isStarted=!0;let t=0;const n=window.setInterval(()=>{F.warning("Rendering",`Could not load font '${this._families[0]}' within ${5*(t+1)} seconds`,null),this._families.length>1?(this._families.shift(),t=0):t++},5e3);F.debug("Font",`Start checking for font availablility: ${this._families.join(", ")}`);const i=a=>{this._families.length>1?(F.debug("Font",`[${this._families[0]}] Loading Failed, switching to ${this._families[1]}`,a),this._families.shift(),window.setTimeout(()=>{o()},0)):(F.error("Font",`[${this._originalFamilies.join(",")}] Loading Failed, rendering cannot start`,a),window.clearInterval(n))},r=a=>{F.debug("Font",`[${a}] Font API signaled available`),this.isFontLoaded=!0,window.clearInterval(n),this.fontLoaded.trigger(this._families[0])},o=function(){var a=Ae(function*(){for(const l of e._families)if(yield e.isFontAvailable(l,!1))return void r(l);try{yield document.fonts.load(`1em ${e._families[0]}`)}catch(l){i(l)}return F.debug("Font",`[${e._families[0]}] Font API signaled loaded`),(yield e.isFontAvailable(e._families[0],!0))?r(e._families[0]):i("Font not available"),!0});return function(){return a.apply(this,arguments)}}();document.fonts.ready.then(()=>{o()})}isFontAvailable(e,t){return new Promise(n=>{const i=`1em ${e}`;if(document.fonts.check(i))n(!0);else if(t){F.debug("Font",`Font ${e} not available, creating test element to trigger load`);const r=document.createElement("div");r.style.font=i,r.style.opacity="0",r.style.position="absolute",r.style.top="0",r.style.left="0",r.innerText=`Trigger ${e} load`,document.body.appendChild(r),setTimeout(()=>{document.body.removeChild(r),document.fonts.check(i)?n(!0):n(!1)},200)}else n(!1)})}}class sx{constructor(e){this._writePosition=0,this._readPosition=0,this.count=0,this._buffer=new Float32Array(e)}clear(){this._readPosition=0,this._writePosition=0,this.count=0,this._buffer=new Float32Array(this._buffer.length)}write(e,t,n){let i=0;n>this._buffer.length-this.count&&(n=this._buffer.length-this.count);const r=Math.min(this._buffer.length-this._writePosition,n);return this._buffer.set(e.subarray(t,t+r),this._writePosition),this._writePosition+=r,this._writePosition%=this._buffer.length,i+=r,i<n&&(this._buffer.set(e.subarray(t+i,t+i+n-i),this._writePosition),this._writePosition+=n-i,i=n),this.count+=i,i}read(e,t,n){n>this.count&&(n=this.count);let i=0;const r=Math.min(this._buffer.length-this._readPosition,n);return e.set(this._buffer.subarray(this._readPosition,this._readPosition+r),t),i+=r,this._readPosition+=r,this._readPosition%=this._buffer.length,i<n&&(e.set(this._buffer.subarray(this._readPosition,this._readPosition+n-i),t+i),this._readPosition+=n-i,i=n),this.count-=i,i}}class rse{constructor(e){this.isDefault=!1,this.device=e}get deviceId(){return this.device.deviceId}get label(){return this.device.label}}let qa=(()=>{class s{static findKnownDevice(t){return s._knownDevices.find(n=>n.deviceId===t)}static createAudioContext(){if("AudioContext"in B.globalThis)return new AudioContext;if("webkitAudioContext"in B.globalThis)return new webkitAudioContext;throw new rn(un.General,"AudioContext not found")}static checkSinkIdSupport(){return Ae(function*(){return"setSinkId"in s.createAudioContext()||(F.warning("WebAudio","Browser does not support changing the output device"),!1)})()}static enumerateOutputDevices(){return Ae(function*(){try{if(!(yield s.checkSinkIdSupport()))return[];try{yield navigator.mediaDevices.getUserMedia({audio:!0})}catch(l){F.warning("WebAudio","Output device permission rejected",l)}const t=yield navigator.mediaDevices.enumerateDevices();let n="",i="";const r=new Map;for(const l of t)"audiooutput"===l.kind&&(r.set(l.groupId,new rse(l)),("default"===l.deviceId||""===l.deviceId)&&(n=l.groupId,i=l.deviceId));const o=Array.from(r.values());let a=o.find(l=>l.deviceId===i);return a||(a=o.find(l=>l.device.groupId===n)),!a&&o.length>0&&(a=o[0]),a&&(a.isDefault=!0),s._knownDevices=o,o}catch(t){return F.error("WebAudio","Failed to enumerate output devices",t),[]}})()}}return s._knownDevices=[],s})(),Hh=(()=>{class s{constructor(){this._context=null,this._buffer=null,this._source=null,this.ready=new ks,this.samplesPlayed=new ft,this.sampleRequest=new ks}get sampleRate(){return this._context?this._context.sampleRate:s.PreferredSampleRate}activate(t){this._context||(this._context=qa.createAudioContext()),("suspended"===this._context.state||"interrupted"===this._context.state)&&(F.debug("WebAudio","Audio Context is suspended, trying resume"),this._context.resume().then(()=>{F.debug("WebAudio",`Audio Context resume success: state=${this._context?.state}, sampleRate:${this._context?.sampleRate}`),t&&t()},n=>{F.warning("WebAudio",`Audio Context resume failed: state=${this._context?.state}, sampleRate:${this._context?.sampleRate}, reason=${n}`)}))}patchIosSampleRate(){const t=navigator.userAgent;if(-1!==t.indexOf("iPhone")||-1!==t.indexOf("iPad")){const n=qa.createAudioContext(),i=n.createBuffer(1,1,s.PreferredSampleRate),r=n.createBufferSource();r.buffer=i,r.connect(n.destination),r.start(0),r.disconnect(0),n.close()}}open(t){this.patchIosSampleRate(),this._context=qa.createAudioContext(),"suspended"===this._context.state&&this.registerResumeHandler()}registerResumeHandler(){this._resumeHandler=(()=>{this.activate(()=>{this.unregisterResumeHandler()})}).bind(this),document.body.addEventListener("touchend",this._resumeHandler,!1),document.body.addEventListener("click",this._resumeHandler,!1)}unregisterResumeHandler(){const t=this._resumeHandler;t&&(document.body.removeEventListener("touchend",t,!1),document.body.removeEventListener("click",t,!1))}play(){const t=this._context;this.activate(),this._buffer=t.createBuffer(2,s.BufferSize,t.sampleRate),this._source=t.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0}pause(){this._source&&(this._source.stop(0),this._source.disconnect()),this._source=null}destroy(){this.pause(),this._context?.close(),this._context=null,this.unregisterResumeHandler()}onSamplesPlayed(t){this.samplesPlayed.trigger(t)}onSampleRequest(){this.sampleRequest.trigger()}onReady(){this.ready.trigger()}enumerateOutputDevices(){return qa.enumerateOutputDevices()}setOutputDevice(t){var n=this;return Ae(function*(){(yield qa.checkSinkIdSupport())&&(t?yield n._context.setSinkId(t.deviceId):yield n._context.setSinkId(""))})()}getOutputDevice(){var t=this;return Ae(function*(){if(!(yield qa.checkSinkIdSupport()))return null;const n=t._context.sinkId;if("string"!=typeof n||""===n||"default"===n)return null;let i=qa.findKnownDevice(n);if(i)return i;const r=yield t.enumerateOutputDevices();return i=r.find(o=>o.deviceId===n),i||(F.warning("WebAudio","Could not find output device in device list",n,r),null)})()}}return s.BufferSize=4096,s.PreferredSampleRate=44100,s})();class tV extends Hh{constructor(){super(...arguments),this._audioNode=null,this._bufferCount=0,this._requestedBufferCount=0,this._outputBuffer=new Float32Array(0)}open(e){super.open(e),this._bufferCount=Math.floor(e*this.sampleRate/1e3/Hh.BufferSize),this._circularBuffer=new sx(Hh.BufferSize*this._bufferCount),this.onReady()}play(){super.play();const e=this._context;this._audioNode=e.createScriptProcessor(4096,0,2),this._audioNode.onaudioprocess=this.generateSound.bind(this),this._circularBuffer.clear(),this.requestBuffers(),this._source=e.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this._source.connect(this._audioNode,0,0),this._source.start(0),this._audioNode.connect(e.destination,0,0)}pause(){super.pause(),this._audioNode&&this._audioNode.disconnect(0),this._audioNode=null}addSamples(e){this._circularBuffer.write(e,0,e.length),this._requestedBufferCount--}resetSamples(){this._circularBuffer.clear()}requestBuffers(){const e=this._bufferCount/2|0;if(this._circularBuffer.count+this._requestedBufferCount*Hh.BufferSize<e*Hh.BufferSize){for(let i=0;i<e;i++)this.onSampleRequest();this._requestedBufferCount+=e}}generateSound(e){const t=e.outputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(1),i=t.length+n.length;let r=this._outputBuffer;r.length!==i&&(r=new Float32Array(i),this._outputBuffer=r);const o=this._circularBuffer.read(r,0,Math.min(r.length,this._circularBuffer.count));let a=0;const l=Math.min(t.length,o);for(let c=0;c<l;c++)t[c]=r[a++],n[c]=r[a++];if(o<t.length)for(let c=o;c<t.length;c++)t[c]=0,n[c]=0;this.onSamplesPlayed(o/xe.AudioChannels),this.requestBuffers()}}class Ow{get output(){return this._output}get isReady(){return this._workerIsReady&&this._outputIsReady}get isReadyForPlayback(){return this._workerIsReadyForPlayback}get state(){return this._state}get logLevel(){return F.logLevel}get worker(){return this._synth}set logLevel(e){F.logLevel=e,this._synth.postMessage({cmd:"alphaSynth.setLogLevel",value:e})}get masterVolume(){return this._masterVolume}set masterVolume(e){e=Math.max(e,xe.MinVolume),this._masterVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMasterVolume",value:e})}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,xe.MinVolume),this._metronomeVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMetronomeVolume",value:e})}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,xe.MinVolume),this._countInVolume=e,this._synth.postMessage({cmd:"alphaSynth.setCountInVolume",value:e})}get midiEventsPlayedFilter(){return this._midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=e,this._synth.postMessage({cmd:"alphaSynth.setMidiEventsPlayedFilter",value:B.prepareForPostMessage(e)})}get playbackSpeed(){return this._playbackSpeed}set playbackSpeed(e){e=ie.clamp(e,xe.MinPlaybackSpeed,xe.MaxPlaybackSpeed),this._playbackSpeed=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackSpeed",value:e})}get loadedMidiInfo(){return this.loadedMidiInfo}get currentPosition(){return this._currentPosition}get tickPosition(){return this._currentPosition.currentTick}set tickPosition(e){e<0&&(e=0),this._currentPosition=new Nl(this._currentPosition.currentTime,this._currentPosition.endTime,e,this._currentPosition.endTick,!0,this._currentPosition.originalTempo,this._currentPosition.modifiedTempo),this._synth.postMessage({cmd:"alphaSynth.setTickPosition",value:e})}get timePosition(){return this._currentPosition.currentTime}set timePosition(e){e<0&&(e=0),this._currentPosition=new Nl(e,this._currentPosition.endTime,this._currentPosition.currentTick,this._currentPosition.endTick,!0,this._currentPosition.originalTempo,this._currentPosition.modifiedTempo),this._synth.postMessage({cmd:"alphaSynth.setTimePosition",value:e})}get isLooping(){return this._isLooping}set isLooping(e){this._isLooping=e,this._synth.postMessage({cmd:"alphaSynth.setIsLooping",value:e})}get playbackRange(){return this._playbackRange}set playbackRange(e){e&&(e.startTick<0&&(e.startTick=0),e.endTick<0&&(e.endTick=0)),this._playbackRange=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackRange",value:B.prepareForPostMessage(e)})}constructor(e,t){this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=wi.Paused,this._masterVolume=0,this._metronomeVolume=0,this._countInVolume=0,this._playbackSpeed=0,this._isLooping=!1,this._playbackRange=null,this._midiEventsPlayedFilter=[],this._currentPosition=new Nl(0,0,0,0,!1,120,120),this.ready=new ks,this.readyForPlayback=new ks,this.finished=new ks,this.soundFontLoaded=new ks,this.soundFontLoadFailed=new ft,this.midiLoaded=new ft,this.midiLoadFailed=new ft,this.stateChanged=new ft,this.positionChanged=new ft,this.midiEventsPlayed=new ft,this.playbackRangeChanged=new ft,this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=wi.Paused,this._masterVolume=0,this._metronomeVolume=0,this._playbackSpeed=0,this._isLooping=!1,this._playbackRange=null,this._output=e,this._output.ready.on(this.onOutputReady.bind(this)),this._output.samplesPlayed.on(this.onOutputSamplesPlayed.bind(this)),this._output.sampleRequest.on(this.onOutputSampleRequest.bind(this)),this._output.open(t.player.bufferTimeInMilliseconds);try{this._synth=B.createWebWorker(t)}catch(n){F.error("AlphaSynth",`Failed to create WebWorker: ${n}`)}this._synth.addEventListener("message",this.handleWorkerMessage.bind(this),!1),this._synth.postMessage({cmd:"alphaSynth.initialize",sampleRate:this._output.sampleRate,logLevel:t.core.logLevel,bufferTimeInMilliseconds:t.player.bufferTimeInMilliseconds}),this.masterVolume=1,this.playbackSpeed=1,this.metronomeVolume=0}destroy(){this._synth.postMessage({cmd:"alphaSynth.destroy"})}play(){return this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.play"}),!0}pause(){this._synth.postMessage({cmd:"alphaSynth.pause"})}playPause(){this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.playPause"})}stop(){this._synth.postMessage({cmd:"alphaSynth.stop"})}playOneTimeMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.playOneTimeMidiFile",midi:Os.midiFileToJsObject(B.prepareForPostMessage(e))})}loadSoundFont(e,t){this._synth.postMessage({cmd:"alphaSynth.loadSoundFontBytes",data:B.prepareForPostMessage(e),append:t})}resetSoundFonts(){this._synth.postMessage({cmd:"alphaSynth.resetSoundFonts"})}loadMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.loadMidi",midi:Os.midiFileToJsObject(B.prepareForPostMessage(e))})}applyTranspositionPitches(e){this._synth.postMessage({cmd:"alphaSynth.applyTranspositionPitches",transpositionPitches:JSON.stringify(Array.from(B.prepareForPostMessage(e).entries()))})}setChannelTranspositionPitch(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelTranspositionPitch",channel:e,semitones:t})}setChannelMute(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelMute",channel:e,mute:t})}resetChannelStates(){this._synth.postMessage({cmd:"alphaSynth.resetChannelStates"})}setChannelSolo(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelSolo",channel:e,solo:t})}setChannelVolume(e,t){t=Math.max(t,xe.MinVolume),this._synth.postMessage({cmd:"alphaSynth.setChannelVolume",channel:e,volume:t})}handleWorkerMessage(e){const t=e.data;switch(t.cmd){case"alphaSynth.ready":this._workerIsReady=!0,this.checkReady();break;case"alphaSynth.destroyed":this._synth.terminate();break;case"alphaSynth.readyForPlayback":this._workerIsReadyForPlayback=!0,this.checkReadyForPlayback();break;case"alphaSynth.positionChanged":this._currentPosition=new Nl(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek,t.originalTempo,t.modifiedTempo),this.positionChanged.trigger(this._currentPosition);break;case"alphaSynth.midiEventsPlayed":this.midiEventsPlayed.trigger(new qD(t.events.map(Os.jsObjectToMidiEvent)));break;case"alphaSynth.playerStateChanged":this._state=t.state,this.stateChanged.trigger(new Fh(t.state,t.stopped));break;case"alphaSynth.playbackRangeChanged":this._playbackRange=t.playbackRange,this.playbackRangeChanged.trigger(new Qg(this._playbackRange));break;case"alphaSynth.finished":this.finished.trigger();break;case"alphaSynth.soundFontLoaded":this.soundFontLoaded.trigger();break;case"alphaSynth.soundFontLoadFailed":this.soundFontLoadFailed.trigger(t.error);break;case"alphaSynth.midiLoaded":this.checkReadyForPlayback(),this._loadedMidiInfo=new Nl(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek,t.originalTempo,t.modifiedTempo),this.midiLoaded.trigger(this._loadedMidiInfo);break;case"alphaSynth.midiLoadFailed":this.checkReadyForPlayback(),this.midiLoadFailed.trigger(t.error);break;case"alphaSynth.output.addSamples":this._output.addSamples(t.samples);break;case"alphaSynth.output.play":this._output.play();break;case"alphaSynth.output.pause":this._output.pause();break;case"alphaSynth.output.destroy":this._output.destroy();break;case"alphaSynth.output.resetSamples":this._output.resetSamples()}}checkReady(){this.isReady&&this.ready.trigger()}checkReadyForPlayback(){this.isReadyForPlayback&&this.readyForPlayback.trigger()}onOutputSampleRequest(){this._synth.postMessage({cmd:"alphaSynth.output.sampleRequest"})}onOutputSamplesPlayed(e){this._synth.postMessage({cmd:"alphaSynth.output.samplesPlayed",samples:e})}onOutputReady(){this._outputIsReady=!0,this.checkReady()}loadBackingTrack(e){}updateSyncPoints(e){}}class ose{constructor(e,t){this._width=0,this.boundsLookup=null,this.preRender=new ft,this.partialRenderFinished=new ft,this.partialLayoutFinished=new ft,this.renderFinished=new ft,this.postRenderFinished=new ks,this.error=new ft,this._api=e;try{this._worker=B.createWebWorker(t)}catch(n){return void F.error("Rendering",`Failed to create WebWorker: ${n}`)}this._worker.postMessage({cmd:"alphaTab.initialize",settings:this.serializeSettingsForWorker(t)}),this._worker.addEventListener("message",this.handleWorkerMessage.bind(this))}destroy(){this._worker.terminate()}updateSettings(e){this._worker.postMessage({cmd:"alphaTab.updateSettings",settings:this.serializeSettingsForWorker(e)})}serializeSettingsForWorker(e){const t=Os.settingsToJsObject(B.prepareForPostMessage(e));return t.delete("player"),t}render(){this._worker.postMessage({cmd:"alphaTab.render"})}resizeRender(){this._worker.postMessage({cmd:"alphaTab.resizeRender"})}renderResult(e){this._worker.postMessage({cmd:"alphaTab.renderResult",resultId:e})}get width(){return this._width}set width(e){this._width=e,this._worker.postMessage({cmd:"alphaTab.setWidth",width:e})}handleWorkerMessage(e){const t=e.data;switch(t.cmd){case"alphaTab.preRender":this.preRender.trigger(t.resize);break;case"alphaTab.partialRenderFinished":this.partialRenderFinished.trigger(t.result);break;case"alphaTab.partialLayoutFinished":this.partialLayoutFinished.trigger(t.result);break;case"alphaTab.renderFinished":this.renderFinished.trigger(t.result);break;case"alphaTab.postRenderFinished":this.boundsLookup=Lr.fromJson(t.boundsLookup,this._api.score),this.boundsLookup.finish(),this.postRenderFinished.trigger();break;case"alphaTab.error":this.error.trigger(t.error)}}renderScore(e,t){const n=null==e?null:Os.scoreToJsObject(B.prepareForPostMessage(e));this._worker.postMessage({cmd:"alphaTab.renderScore",score:n,trackIndexes:B.prepareForPostMessage(t),fontSizes:Ki.FontSizeLookupTables})}}class nV{constructor(e,t,n,i){this.cursorWrapper=e,this.barCursor=t,this.beatCursor=n,this.selectionWrapper=i}}let ase=(()=>{class s{static init(){var t;s._isRegistered||(s._isRegistered=!0,registerProcessor("alphatab",((t=class extends AudioWorkletProcessor{constructor(i){super(i),this._outputBuffer=new Float32Array(0),this._bufferCount=0,this._requestedBufferCount=0,this._isStopped=!1,F.debug("WebAudio","creating processor"),this._bufferCount=Math.floor(i.processorOptions.bufferTimeInMilliseconds*sampleRate/1e3/t.BufferSize),this._circularBuffer=new sx(t.BufferSize*this._bufferCount),this.port.onmessage=this.handleMessage.bind(this)}handleMessage(i){const r=i.data;switch(r.cmd){case ns.CmdOutputAddSamples:const a=r.samples;this._circularBuffer.write(a,0,a.length),this._requestedBufferCount--;break;case ns.CmdOutputResetSamples:this._circularBuffer.clear();break;case ns.CmdOutputStop:this._isStopped=!0}}process(i,r,o){if(1!==r.length&&2!==r[0].length)return!1;const a=r[0][0],l=r[0][1];if(!a||!l)return!0;const c=a.length+l.length;let u=this._outputBuffer;u.length!==c&&(u=new Float32Array(c),this._outputBuffer=u);const h=this._circularBuffer.read(u,0,Math.min(u.length,this._circularBuffer.count));let d=0;const p=Math.min(a.length,h);for(let g=0;g<p;g++)a[g]=u[d++],l[g]=u[d++];if(h<a.length)for(let g=h;g<a.length;g++)a[g]=0,l[g]=0;return this.port.postMessage({cmd:ns.CmdOutputSamplesPlayed,samples:h/xe.AudioChannels}),this.requestBuffers(),this._circularBuffer.count>0||!this._isStopped}requestBuffers(){const i=this._bufferCount/2|0;if(this._circularBuffer.count+this._requestedBufferCount*t.BufferSize<i*t.BufferSize){for(let a=0;a<i;a++)this.port.postMessage({cmd:ns.CmdOutputSampleRequest});this._requestedBufferCount+=i}}}).BufferSize=4096,t)))}}return s._isRegistered=!1,s})();class sV extends Hh{constructor(e){super(),this._worklet=null,this._bufferTimeInMilliseconds=0,this._settings=e}open(e){super.open(e),this._bufferTimeInMilliseconds=e,this.onReady()}play(){super.play();const e=this._context;B.createAudioWorklet(e,this._settings).then(()=>{this._worklet=new AudioWorkletNode(e,"alphatab",{numberOfOutputs:1,outputChannelCount:[2],processorOptions:{bufferTimeInMilliseconds:this._bufferTimeInMilliseconds}}),this._worklet.port.onmessage=this.handleMessage.bind(this),this._source.connect(this._worklet),this._source.start(0),this._worklet.connect(e.destination)},t=>{F.error("WebAudio",`Audio Worklet creation failed: reason=${t}`)})}handleMessage(e){const t=e.data;switch(t.cmd){case ns.CmdOutputSamplesPlayed:this.onSamplesPlayed(t.samples);break;case ns.CmdOutputSampleRequest:this.onSampleRequest()}}pause(){super.pause(),this._worklet&&(this._worklet.port.postMessage({cmd:ns.CmdOutputStop}),this._worklet.port.onmessage=null,this._worklet.disconnect()),this._worklet=null}addSamples(e){this._worklet?.port.postMessage({cmd:ns.CmdOutputAddSamples,samples:B.prepareForPostMessage(e)})}resetSamples(){this._worklet?.port.postMessage({cmd:ns.CmdOutputResetSamples})}}class lse extends Bl{constructor(e,t,n){super(e),this._xscale=t,this._yscale=n}get width(){return this.element.offsetWidth/this._xscale}set width(e){this.element.style.width=e*this._xscale+"px"}get height(){return this.element.offsetHeight/this._yscale}set height(e){this.element.style.height=e>=0?e*this._yscale+"px":"100%"}setBounds(e,t,n,i){Number.isNaN(e)&&(e=this.lastBounds.x),Number.isNaN(t)&&(t=this.lastBounds.y),Number.isNaN(n)?n=this.lastBounds.w:n/=this._xscale,Number.isNaN(i)?i=this.lastBounds.h:i/=this._yscale,this.element.style.transform=`translate(${e}px, ${t}px) scale(${n}, ${i})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=n,this.lastBounds.h=i}}class cse{constructor(){this.sampleRate=44100,this._updateInterval=0,this.ready=new ks,this.samplesPlayed=new ft,this.timeUpdate=new ft,this.sampleRequest=new ks}get backingTrackDuration(){const e=this.audioElement.duration??0;return Number.isFinite(e)?1e3*e:0}get playbackRate(){return this.audioElement.playbackRate}set playbackRate(e){this.audioElement.playbackRate=e}get masterVolume(){return this.audioElement.volume}set masterVolume(e){this.audioElement.volume=e}seekTo(e){this.audioElement.currentTime=e/1e3}loadBackingTrack(e){this.audioElement?.src&&URL.revokeObjectURL(this.audioElement.src);const t=new Blob([e.rawAudioFile]),n=this.audioElement.playbackRate;this.audioElement.src=URL.createObjectURL(t),this.audioElement.playbackRate=n}open(e){const t=document.createElement("audio");t.style.display="none",document.body.appendChild(t),t.addEventListener("seeked",()=>{this.updatePosition()}),t.addEventListener("timeupdate",()=>{this.updatePosition()}),this.audioElement=t,this.ready.trigger()}updatePosition(){this.timeUpdate.trigger(1e3*this.audioElement.currentTime)}play(){this.audioElement.play(),this._updateInterval=window.setInterval(()=>{this.updatePosition()},50)}destroy(){const e=this.audioElement;e&&document.body.removeChild(e)}pause(){this.audioElement.pause(),window.clearInterval(this._updateInterval)}addSamples(e){}resetSamples(){}activate(){}enumerateOutputDevices(){return Ae(function*(){return qa.enumerateOutputDevices()})()}setOutputDevice(e){var t=this;return Ae(function*(){(yield qa.checkSinkIdSupport())&&(e?yield t.audioElement.setSinkId(e.deviceId):yield t.audioElement.setSinkId(""))})()}getOutputDevice(){var e=this;return Ae(function*(){if(!(yield qa.checkSinkIdSupport()))return null;const t=e.audioElement.sinkId;if("string"!=typeof t||""===t||"default"===t)return null;let n=qa.findKnownDevice(t);if(n)return n;const i=yield e.enumerateOutputDevices();return n=i.find(r=>r.deviceId===t),n||(F.warning("WebAudio","Could not find output device in device list",t,i),null)})()}}let use=(()=>{class s{constructor(t,n){this._promise=null,this._exporterId=s._nextExporterId++,this._worker=t,this._ownsWorker=n}initialize(t,n,i,r){var o=this;return Ae(function*(){const a=o.handleWorkerMessage.bind(o);o._worker.worker.addEventListener("message",a,!1),o._unsubscribe=()=>{o._worker.worker.removeEventListener("message",a,!1)},o._promise=Promise.withResolvers(),o._worker.worker.postMessage({cmd:"alphaSynth.exporter.initialize",exporterId:o._exporterId,options:B.prepareForPostMessage(t),midi:Os.midiFileToJsObject(B.prepareForPostMessage(n)),syncPoints:B.prepareForPostMessage(i),transpositionPitches:B.prepareForPostMessage(r)}),yield o._promise.promise})()}handleWorkerMessage(t){const n=t.data;if(n.exporterId===this._exporterId)switch(n.cmd){case"alphaSynth.exporter.initialized":this._promise?.resolve(null),this._promise=null;break;case"alphaSynth.exporter.error":this._promise?.reject(n.error),this._promise=null;break;case"alphaSynth.exporter.rendered":this._promise?.resolve(n.chunk),this._promise=null;break;case"alphaSynth.destroyed":this._promise?.reject(new rn(un.General,"Worker was destroyed")),this._promise=null}}render(t){var n=this;return Ae(function*(){if(n._promise)throw new rn(un.General,"There is already an ongoing operation, wait for initialize to complete before requesting render");return n._promise=Promise.withResolvers(),n._worker.worker.postMessage({cmd:"alphaSynth.exporter.render",exporterId:n._exporterId,milliseconds:t}),yield n._promise.promise})()}destroy(){this._worker.worker.postMessage({cmd:"alphaSynth.exporter.destroy",exporterId:this._exporterId}),this._unsubscribe(),this._ownsWorker&&this._worker.destroy()}[Symbol.dispose](){this.destroy()}}return s._nextExporterId=1,s})();var Tc=function(s){return s[s.LayoutDone=0]="LayoutDone",s[s.RenderRequested=1]="RenderRequested",s[s.RenderDone=2]="RenderDone",s[s.Detached=3]="Detached",s}(Tc||{});class wu{get resizeThrottle(){return 10}get canRender(){return this.areAllFontsLoaded()}areAllFontsLoaded(){let e=!1;for(const t of this._fontCheckers.values())t.isFontLoaded||(e=!0);return!e&&(F.debug("Font",`All fonts loaded: ${this._fontCheckers.size}`),!0)}onFontLoaded(e){Ki.generateFontLookup(e),this.areAllFontsLoaded()&&this.canRenderChanged.trigger()}constructor(e){if(this._fontCheckers=new Map,this._contents=null,this._file=null,this._totalResultCount=0,this._initialTrackIndexes=null,this._barToElementLookup=new Map,this._resultIdToElementLookup=new Map,this.rootContainerBecameVisible=new ks,this.canRenderChanged=new ks,this._highlightedElements=[],this._scrollContainer=null,B.webPlatform!==io.Browser&&B.webPlatform!==io.BrowserModule)throw new rn(un.General,"Usage of AlphaTabApi is only possible in browser environments. For usage in node use the Low Level APIs");e.classList.add("alphaTab"),this.rootContainer=new Bl(e),this.areWorkersSupported="Worker"in window,this._intersectionObserver=new IntersectionObserver(this.onElementVisibilityChanged.bind(this),{threshold:[0,.01,1]}),this._intersectionObserver.observe(e)}onElementVisibilityChanged(e){for(const t of e){const n=t.target;if(n===this.rootContainer.element)t.isIntersecting&&(this.rootContainerBecameVisible.trigger(),this._intersectionObserver.unobserve(this.rootContainer.element));else if("layoutResultId"in n&&this._api.settings.core.enableLazyLoading){const i=n;t.isIntersecting?i.renderedResultId!==i.layoutResultId?this._resultIdToElementLookup.has(i.layoutResultId)?i.resultState!==Tc.RenderRequested&&(i.resultState=Tc.RenderRequested,this._api.renderer.renderResult(i.layoutResultId)):n.replaceChildren():i.resultState===Tc.Detached&&(n.replaceChildren(...i.renderedResult),i.resultState=Tc.RenderDone):i.resultState===Tc.RenderDone&&(i.resultState=Tc.Detached,i.replaceChildren())}}}createWorkerRenderer(){return new ose(this._api,this._api.settings)}initialize(e,t){let n;this._api=e,n=t instanceof wc?t:Os.jsObjectToSettings(t);const i=this.getDataAttributes();_u.fromJson(n,i),n.notation.notationMode===xi.SongBook&&n.setSongBookModeSettings(),e.settings=n,this.setupFontCheckers(n),this._initialTrackIndexes=this.parseTracks(n.core.tracks),this._contents="";const r=e.container;n.core.tex&&(this._contents=r.element.innerHTML,r.element.innerHTML=""),this.createStyleElements(n),this._file=n.core.file}setupFontCheckers(e){this.registerFontChecker(e.display.resources.copyrightFont),this.registerFontChecker(e.display.resources.effectFont),this.registerFontChecker(e.display.resources.fingeringFont),this.registerFontChecker(e.display.resources.graceFont),this.registerFontChecker(e.display.resources.markerFont),this.registerFontChecker(e.display.resources.tablatureFont),this.registerFontChecker(e.display.resources.titleFont),this.registerFontChecker(e.display.resources.wordsFont),this.registerFontChecker(e.display.resources.barNumberFont),this.registerFontChecker(e.display.resources.fretboardNumberFont),this.registerFontChecker(e.display.resources.subTitleFont)}registerFontChecker(e){if(!this._fontCheckers.has(e.families.join(", "))){const t=new eV(e.families);this._fontCheckers.set(e.families.join(", "),t),t.fontLoaded.on(this.onFontLoaded.bind(this)),t.checkForFontAvailability()}}destroy(){this.rootContainer.element.innerHTML="";const e=this._webFont;e.usages--,e.usages<=0&&(e.element.remove(),wu._registeredWebFonts.delete(e.hash))}createCanvasElement(){const e=document.createElement("div");return e.classList.add("at-surface",`at${this._webFont.fontSuffix}`),e.style.fontSize="0",e.style.overflow="hidden",e.style.lineHeight="0",e.style.position="relative",new Bl(e)}triggerEvent(e,t,n=null,i){const r=e.element;t=`alphaTab.${t}`;const o=document.createEvent("CustomEvent"),a=i?i.mouseEvent:null;if(o.initCustomEvent(t,!1,!1,n),a&&(o.originalEvent=a),r.dispatchEvent(o),window&&"jQuery"in window){const l=window.jQuery,c=[];c.push(n),a&&c.push(a),l(r).trigger(t,c)}}load(e,t,n){if(e instanceof Cl)return t(e),!0;if(e instanceof ArrayBuffer){const i=new Uint8Array(e);return t(Vh.loadScoreFromBytes(i,this._api.settings)),!0}return e instanceof Uint8Array?(t(Vh.loadScoreFromBytes(e,this._api.settings)),!0):"string"==typeof e&&(Vh.loadScoreAsync(e,t,n,this._api.settings),!0)}loadSoundFont(e,t){return!(!this._api.player||(e instanceof ArrayBuffer?(this._api.player.loadSoundFont(new Uint8Array(e),t),0):e instanceof Uint8Array?(this._api.player.loadSoundFont(e,t),0):"string"!=typeof e||(this._api.loadSoundFontFromUrl(e,t),0)))}initialRender(){this._api.renderer.preRender.on(t=>{this._totalResultCount=0,this._resultIdToElementLookup.clear(),this._barToElementLookup.clear()});const e=()=>{this._api.renderer.width=0|this.rootContainer.width,this._api.renderer.updateSettings(this._api.settings),this._contents?(this._api.tex(this._contents,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null):this._file&&Vh.loadScoreAsync(this._file,t=>{this._api.renderScore(t,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null},t=>{this._api.onError(t)},this._api.settings)};this.rootContainer.isVisible?e():this.rootContainerBecameVisible.on(e)}createStyleElements(e){const t=this._api.container.element.ownerDocument;wu.createSharedStyleElement(t);const n=e.core.smuflFontSources??kx.buildDefaultSmuflFontSources(e.core.fontDirectory),i=wu.cyrb53(n.values()),r=wu._registeredWebFonts;if(r.has(i)){const p=r.get(i);return p.usages++,p.checker.fontLoaded.on(this.onFontLoaded.bind(this)),void(this._webFont=p)}const o=0===r.size?"":String(r.size),a=`alphaTab${o}`,c=`\n            @font-face {\n                font-display: block;\n                font-family: '${a}';\n                src: ${Array.from(n.entries()).map(p=>`url(${JSON.stringify(p[1])}) format('${wu.cssFormat(p[0])}')`).join(",")};\n                font-weight: normal;\n                font-style: normal;\n            }\n            .at-surface.at${o} .at {\n                font-family: '${a}';\n                speak: none;\n                font-style: normal;\n                font-weight: normal;\n                font-variant: normal;\n                text-transform: none;\n                line-height: 1;\n                line-height: 1;\n                -webkit-font-smoothing: antialiased;\n                -moz-osx-font-smoothing: grayscale;\n                font-size: ${B.MusicFontSize}px;\n                overflow: visible !important;\n            }`,u=t.createElement("style");u.id=`alphaTabStyle${o}`,u.innerHTML=c,t.getElementsByTagName("head").item(0).appendChild(u);const h=new eV([a]);h.fontLoaded.on(this.onFontLoaded.bind(this)),this._fontCheckers.set(a,h),h.checkForFontAvailability(),e.display.resources.smuflFont=new Ke(a,B.MusicFontSize,ts.Plain,Or.Regular);const d={hash:i,element:u,fontSuffix:o,usages:1,checker:h};r.set(i,d),this._webFont=d}static cssFormat(e){switch(e){case Ya.EmbeddedOpenType:return"embedded-opentype";case Ya.Woff:return"woff";case Ya.Woff2:return"woff2";case Ya.OpenType:return"opentype";case Ya.TrueType:return"truetype";case Ya.Svg:return"svg"}}static cyrb53(e,t=0){let n=3735928559^t,i=1103547991^t;for(const r of e)for(let o=0;o<r.length;o++){const a=r.charCodeAt(o);n=Math.imul(n^a,2654435761),i=Math.imul(i^a,1597334677)}return n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(n^n>>>13,3266489909),4294967296*(2097151&i)+(n>>>0)}static createSharedStyleElement(e){let t=e.getElementById("alphaTabStyle");t||(t=document.createElement("style"),t.id="alphaTabStyleShared",t.innerHTML="\n                .at-surface * {\n                    cursor: default;\n                    vertical-align: top;\n                    overflow: visible;\n                }\n                .at-surface-svg text {\n                    dominant-baseline: central;\n                    white-space:pre;\n                }",document.getElementsByTagName("head").item(0).appendChild(t))}parseTracks(e){if(!e)return[];const t=[];if("string"==typeof e)try{if("all"===e)return[-1];e=JSON.parse(e)}catch{e=[0]}if("number"==typeof e)t.push(e);else if("length"in e){const n=e.length,i=e;for(let r=0;r<n;r++){const o=i[r];let a=0;a="number"==typeof o?o:"index"in o?o.index:Number.parseInt(o.toString()),(a>=0||-1===a)&&t.push(a)}}else"index"in e&&t.push(e.index);return t}getDataAttributes(){const e=new Map,t=this._api.container.element;if(t.dataset)for(const n of Object.keys(t.dataset)){let i=t.dataset[n];try{i=JSON.parse(i)}catch{""===i&&(i=null)}e.set(n,i)}else for(let n=0;n<t.attributes.length;n++){const i=t.attributes.item(n),r=i.nodeName;if(r.startsWith("data-")){const o=r.substr(5).split("-");let a=o[0];for(let c=1;c<o.length;c++)a+=o[c].substr(0,1).toUpperCase()+o[c].substr(1);let l=i.nodeValue;try{l=JSON.parse(l)}catch{""===l&&(l=null)}e.set(a,l)}}return e}beginUpdateRenderResults(e){if(!this._resultIdToElementLookup.has(e.id))return;const t=this._resultIdToElementLookup.get(e.id),n=e.renderResult;"string"==typeof n?t.innerHTML=n:"nodeType"in n&&t.replaceChildren(n),t.resultState=Tc.RenderDone,t.renderedResultId=e.id,t.renderedResult=Array.from(t.children)}beginAppendRenderResults(e){const t=this._api.canvasElement.element;if(e){let n;this._totalResultCount<t.childElementCount?n=t.childNodes.item(this._totalResultCount):(n=document.createElement("div"),t.appendChild(n)),n.style.zIndex="1",n.style.position="absolute",n.style.left=`${e.x}px`,n.style.top=`${e.y}px`,n.style.width=`${e.width}px`,n.style.height=`${e.height}px`,n.style.display="inline-block",n.layoutResultId=e.id,n.resultState=Tc.LayoutDone,n.renderedResultId=void 0,n.renderedResult=void 0,this._resultIdToElementLookup.set(e.id,n);for(let i=e.firstMasterBarIndex;i<=e.lastMasterBarIndex;i++)i>=0&&this._barToElementLookup.set(i,n);this._api.settings.core.enableLazyLoading&&(this._intersectionObserver.unobserve(n),this._intersectionObserver.observe(n)),this._totalResultCount++}else for(;t.childElementCount>this._totalResultCount;)this._api.settings.core.enableLazyLoading&&this._intersectionObserver.unobserve(t.lastChild),t.removeChild(t.lastElementChild)}createWorkerPlayer(){let e=null;const t="ScriptProcessorNode"in window;return window.isSecureContext&&"AudioWorkletNode"in window&&this._api.settings.player.outputMode===cw.WebAudioAudioWorklets?(F.debug("Player","Will use webworkers for synthesizing and web audio api with worklets for playback"),e=new Ow(new sV(this._api.settings),this._api.settings)):t&&(F.debug("Player","Will use webworkers for synthesizing and web audio api with ScriptProcessor for playback"),e=new Ow(new tV,this._api.settings)),e?e.ready.on(()=>{this._api.settings.player.soundFont&&this._api.loadSoundFontFromUrl(this._api.settings.player.soundFont,!1)}):F.error("Player","Player requires webworkers and web audio api, browser unsupported",null),e}createWorkerAudioExporter(e){const t=null===e||!(e instanceof Ow);return t&&(e=this.createWorkerPlayer()),new use(e,t)}beginInvoke(e){window.requestAnimationFrame(()=>{e()})}highlightElements(e,t){const n=this._barToElementLookup.get(t);if(n){const i=n.getElementsByClassName(e);for(let r=0;r<i.length;r++)i.item(r).classList.add("at-highlight"),this._highlightedElements.push(i.item(r))}}removeHighlights(){const e=this._highlightedElements;if(e){for(const t of e)t.classList.remove("at-highlight");this._highlightedElements=[]}}destroyCursors(){const e=this._api.container.element,t=e.querySelector(".at-cursors");e.removeChild(t)}createCursors(){const e=this._api.container.element,t=document.createElement("div");t.classList.add("at-cursors");const n=document.createElement("div");n.classList.add("at-selection");const i=this.createScalingElement(),r=this.createScalingElement(),o=i.element;o.classList.add("at-cursor-bar");const a=r.element;return a.classList.add("at-cursor-beat"),e.style.position="relative",e.style.textAlign="left",t.style.position="absolute",t.style.zIndex="1000",t.style.display="inline",t.style.pointerEvents="none",n.style.position="absolute",o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.willChange="transform",i.width=1,i.height=1,i.setBounds(0,0,1,1),a.style.position="absolute",a.style.transition="all 0s linear",a.style.left="0",a.style.top="0",a.style.willChange="transform",r.width=3,r.height=1,r.setBounds(0,0,1,1),e.insertBefore(t,e.firstChild),t.appendChild(n),t.appendChild(o),t.appendChild(a),new nV(new Bl(t),i,r,new Bl(n))}getOffset(e,t){const n=t.element,i=n.getBoundingClientRect();let r=i.top+n.ownerDocument.defaultView.pageYOffset,o=i.left+n.ownerDocument.defaultView.pageXOffset;if(e){const l=e.element,c=l.nodeName.toLowerCase();if("html"!==c&&"body"!==c){const u=this.getOffset(null,e);r=r+l.scrollTop-u.y,o=o+l.scrollLeft-u.x}}const a=new bi;return a.x=o,a.y=r,a.w=i.width,a.h=i.height,a}getScrollContainer(){if(this._scrollContainer)return this._scrollContainer;let e="string"==typeof this._api.settings.player.scrollElement?document.querySelector(this._api.settings.player.scrollElement):this._api.settings.player.scrollElement;const t=e.nodeName.toLowerCase();return("html"===t||"body"===t)&&(e="scrollingElement"in document?document.scrollingElement:-1!==navigator.userAgent.indexOf("WebKit")?document.body:document.documentElement),this._scrollContainer=new Bl(e),this._scrollContainer}createSelectionElement(){return this.createScalingElement()}createScalingElement(){const e=document.createElement("div");e.style.position="absolute";const t=new lse(e,100,100);return t.width=1,t.height=1,t.setBounds(0,0,1,1),t}scrollToY(e,t,n){this.internalScrollToY(e.element,t,n)}scrollToX(e,t,n){this.internalScrollToX(e.element,t,n)}internalScrollToY(e,t,n){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({top:t,behavior:"smooth"});else{const i=e.scrollTop,r=t-i;let o=0;const a=l=>{0===o&&(o=l);const c=l-o,u=Math.min(c/n,1);e.scrollTop=i+r*u|0,c<n&&window.requestAnimationFrame(a)};window.requestAnimationFrame(a)}}internalScrollToX(e,t,n){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({left:t,behavior:"smooth"});else{const i=e.scrollLeft,r=t-i;let o=0;const a=l=>{0===o&&(o=l);const c=l-o,u=Math.min(c/n,1);e.scrollLeft=i+r*u|0,c<n&&window.requestAnimationFrame(a)};window.requestAnimationFrame(a)}}createBackingTrackPlayer(){return new K2(new cse,this._api.settings.player.bufferTimeInMilliseconds)}}wu._registeredWebFonts=new Map;class hse{constructor(e,t){this.loaded=e,this.total=t}}class Lw extends ise{constructor(e,t){super(new wu(e),t),this.soundFontLoad=new ft}tex(e,t){super.tex(e,this.uiFacade.parseTracks(t))}print(e,t=null){const n=window.open("","","width=0,height=0"),i=n.document.createElement("div");i.style.width=e||(this.settings.display.layoutMode===fu.Horizontal?"297mm":"210mm"),n.document.write("\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <style>\n            .at-surface {\n                width: auto !important;\n                height: auto !important;\n            }\n            .at-surface > div {\n                position: relative!important;\n                left: auto !important;\n                top: auto !important;\n                break-inside: avoid;\n            }\n            </style>\n          </head>\n          <body></body>\n        </html>\n        ");const r=this.score;r&&(r.artist&&r.title?n.document.title=`${r.title} - ${r.artist}`:r.title&&(n.document.title=`${r.title}`)),n.document.body.appendChild(i);const o=typeof window.screenLeft<"u"?window.screenLeft:window.left,a=typeof window.screenTop<"u"?window.screenTop:window.top,l="innerWidth"in window?window.innerWidth:"clientWidth"in document.documentElement?document.documentElement.clientWidth:window.screen.width,c="innerHeight"in window?window.innerHeight:"clientHeight"in document.documentElement?document.documentElement.clientHeight:window.screen.height,u=i.offsetWidth+50,h=window.innerHeight,d=(l/2|0)-(u/2|0)+o,p=(c/2|0)-(h/2|0)+a;n.resizeTo(u,h),n.moveTo(d,p),n.focus();const g=Os.jsObjectToSettings(Os.settingsToJsObject(this.settings));g.core.enableLazyLoading=!1,g.core.useWorkers=!0,g.core.file=null,g.core.tracks=null,g.player.enableCursor=!1,g.player.playerMode=vr.Disabled,g.player.enableElementHighlighting=!1,g.player.enableUserInteraction=!1,g.player.soundFont=null,g.display.scale=.8,g.display.stretchForce=.8,_u.fromJson(g,t);const m=new Lw(i,g);n.onunload=()=>{m.destroy()},m.renderer.postRenderFinished.on(()=>{n.print()}),m.renderTracks(this.tracks)}downloadMidi(e=Df.SingleTrackMultiChannel){if(!this.score)return;const t=new xl;t.format=e;const n=new da(t,!0);new Ye(this.score,this.settings,n).generate();const r=t.toBinary(),o=this.score.title?`${this.score.title}.mid`:"File.mid",a=document.createElement("a");a.download=o;const l=new Blob([r],{type:"audio/midi"}),c=URL.createObjectURL(l);a.href=c,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}changeTrackMute(e,t){const n=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackMute(n,t)}changeTrackSolo(e,t){const n=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackSolo(n,t)}changeTrackVolume(e,t){const n=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackVolume(n,t)}trackIndexesToTracks(e){if(!this.score)return[];const t=[];if(1===e.length&&-1===e[0])for(const n of this.score.tracks)t.push(n);else for(const n of e)n>=0&&n<this.score.tracks.length&&t.push(this.score.tracks[n]);return t}loadSoundFontFromUrl(e,t){const n=this.player;if(!n)return;F.debug("AlphaSynth",`Start loading Soundfont from url ${e}`);const i=new XMLHttpRequest;i.open("GET",e,!0,null,null),i.responseType="arraybuffer",i.onload=r=>{const o=new Uint8Array(i.response);this.loadSoundFont(o,t)},i.onerror=r=>{F.error("AlphaSynth",`Loading failed: ${r.message}`),n.soundFontLoadFailed.trigger(new vc(r.message,i))},i.onprogress=r=>{F.debug("AlphaSynth",`Soundfont downloading: ${r.loaded}/${r.total} bytes`);const o=new hse(r.loaded,r.total);this.soundFontLoad.trigger(o),this.uiFacade.triggerEvent(this.container,"soundFontLoad",o)},i.send()}}class iV{constructor(){this._initListeners=[]}exec(e,t,n){if("string"!=typeof t&&(n=[t],t="init"),95===t.charCodeAt(0)||"exec"===t)return null;const i=new jQuery(e),r=i.data("alphaTab");if("destroy"===t&&!r)return null;if("init"!==t&&!r)throw new Error("alphaTab not initialized");const o=this[t];if(o){const a=[i,r].concat(n);return o.apply(this,a)}return F.error("Api",`Method '${t}' does not exist on jQuery.alphaTab`),null}init(e,t,n){if(!t){t=new Lw(e[0],n),e.data("alphaTab",t);for(const i of this._initListeners)i(e,t,n)}}destroy(e,t){e.removeData("alphaTab"),t.destroy()}print(e,t,n,i){t.print(n,i)}load(e,t,n,i){return t.load(n,i)}render(e,t){t.render()}renderScore(e,t,n,i){t.renderScore(n,i)}renderTracks(e,t,n){t.renderTracks(n)}invalidate(e,t){t.render()}tex(e,t,n,i){t.tex(n,i)}muteTrack(e,t,n,i){t.changeTrackMute(n,i)}soloTrack(e,t,n,i){t.changeTrackSolo(n,i)}trackVolume(e,t,n,i){t.changeTrackVolume(n,i)}loadSoundFont(e,t,n,i){t.loadSoundFont(n,i)}resetSoundFonts(e,t){t.resetSoundFonts()}pause(e,t){t.pause()}play(e,t){return t.play()}playPause(e,t){t.playPause()}stop(e,t){t.stop()}api(e,t){return t}player(e,t){return t.player}isReadyForPlayback(e,t){return t.isReadyForPlayback}playerState(e,t){return t.playerState}masterVolume(e,t,n){return"number"==typeof n&&(t.masterVolume=n),t.masterVolume}metronomeVolume(e,t,n){return"number"==typeof n&&(t.metronomeVolume=n),t.metronomeVolume}countInVolume(e,t,n){return"number"==typeof n&&(t.countInVolume=n),t.countInVolume}midiEventsPlayedFilter(e,t,n){return Array.isArray(n)&&(t.midiEventsPlayedFilter=n),t.midiEventsPlayedFilter}playbackSpeed(e,t,n){return"number"==typeof n&&(t.playbackSpeed=n),t.playbackSpeed}tickPosition(e,t,n){return"number"==typeof n&&(t.tickPosition=n),t.tickPosition}timePosition(e,t,n){return"number"==typeof n&&(t.timePosition=n),t.timePosition}loop(e,t,n){return"boolean"==typeof n&&(t.isLooping=n),t.isLooping}renderer(e,t){return t.renderer}score(e,t){return t.score}settings(e,t){return t.settings}tracks(e,t){return t.tracks}_oninit(e){this._initListeners.push(e)}static restore(e){new jQuery(e).empty().removeData("alphaTab")}}class Vw{constructor(){this.buffer="",this._currentPath="",this._currentPathIsEmpty=!0,this.scale=1,this.color=new _n(255,255,255,255),this.lineWidth=1,this.font=new Ke("Arial",10,ts.Plain),this.textAlign=ye.Left,this.textBaseline=qe.Top}destroy(){}beginRender(e,t){this.scale=this.settings.display.scale,this.buffer=`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${0|e}px" height="${0|t}px" class="at-surface-svg">\n`,this._currentPath="",this._currentPathIsEmpty=!0,this.textBaseline=qe.Top}beginGroup(e){this.buffer+=`<g class="${e}">`}endGroup(){this.buffer+="</g>"}endRender(){return this.buffer+="</svg>",this.buffer}fillRect(e,t,n,i){n>0&&(this.buffer+=`<rect x="${e*this.scale|0}" y="${t*this.scale|0}" width="${n*this.scale}" height="${i*this.scale}" fill="${this.color.rgba}" />\n`)}strokeRect(e,t,n,i){const r=this.lineWidth*this.scale%2==0?0:.5;this.buffer+=`<rect x="${(e*this.scale|0)+r}" y="${(t*this.scale|0)+r}" width="${n*this.scale}" height="${i*this.scale}" stroke="${this.color.rgba}"`,1!==this.lineWidth&&(this.buffer+=` stroke-width="${this.lineWidth*this.scale}"`),this.buffer+=' fill="transparent" />\n'}beginPath(){}closePath(){this._currentPath+=" z"}moveTo(e,t){this._currentPath+=` M${e*this.scale},${t*this.scale}`}lineTo(e,t){this._currentPathIsEmpty=!1,this._currentPath+=` L${e*this.scale},${t*this.scale}`}quadraticCurveTo(e,t,n,i){this._currentPathIsEmpty=!1,this._currentPath+=` Q${e*this.scale},${t*this.scale},${n*this.scale},${i*this.scale}`}bezierCurveTo(e,t,n,i,r,o){this._currentPathIsEmpty=!1,this._currentPath+=` C${e*this.scale},${t*this.scale},${n*this.scale},${i*this.scale},${r*this.scale},${o*this.scale}`}fillCircle(e,t,n){this._currentPathIsEmpty=!1,this._currentPath+=` M${(e*=this.scale)-(n*=this.scale)},${t*=this.scale} A1,1 0 0,0 ${e+n},${t} A1,1 0 0,0 ${e-n},${t} z`,this.fill()}strokeCircle(e,t,n){this._currentPathIsEmpty=!1,this._currentPath+=` M${(e*=this.scale)-(n*=this.scale)},${t*=this.scale} A1,1 0 0,0 ${e+n},${t} A1,1 0 0,0 ${e-n},${t} z`,this.stroke()}fill(){this._currentPathIsEmpty||(this.buffer+=`<path d="${this._currentPath}"`,"#000000"!==this.color.rgba&&(this.buffer+=` fill="${this.color.rgba}"`),this.buffer+=' style="stroke: none"/>'),this._currentPath="",this._currentPathIsEmpty=!0}stroke(){if(!this._currentPathIsEmpty){let e=`<path d="${this._currentPath}" stroke="${this.color.rgba}"`;(1!==this.lineWidth||1!==this.scale)&&(e+=` stroke-width="${this.lineWidth*this.scale}"`),e+=' style="fill: none" />',this.buffer+=e}this._currentPath="",this._currentPathIsEmpty=!0}fillText(e,t,n){if(""===e)return;let i=`<text x="${t*this.scale|0}" y="${n*this.scale|0}" style='stroke: none; font:${this.font.toCssString(this.settings.display.scale)}; ${this.getSvgBaseLine()}'`;"#000000"!==this.color.rgba&&(i+=` fill="${this.color.rgba}"`),this.textAlign!==ye.Left&&(i+=` text-anchor="${this.getSvgTextAlignment(this.textAlign)}"`),i+=`>${Vw.escapeText(e)}</text>`,this.buffer+=i}static escapeText(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}getSvgTextAlignment(e){switch(e){case ye.Left:return"start";case ye.Center:return"middle";case ye.Right:return"end"}return""}getSvgBaseLine(){switch(this.textBaseline){case qe.Top:return"dominant-baseline: hanging";case qe.Bottom:return"dominant-baseline: ideographic";default:return""}}measureText(e){return e?Ki.measureString(e,this.font.families,this.font.size*this.scale,this.font.style,this.font.weight):new Ug(0,0)}onRenderFinished(){return null}beginRotate(e,t,n){this.buffer+=`<g transform="translate(${e*this.scale} ,${t*this.scale}) rotate( ${n})">`}endRotate(){this.buffer+="</g>"}}class rV extends Vw{fillMusicFontSymbol(e,t,n,i,r){i!==f.None&&this.fillMusicFontSymbolText(e,t,n,`&#${i};`,r)}fillMusicFontSymbols(e,t,n,i,r){let o="";for(const a of i)a!==f.None&&(o+=`&#${a};`);this.fillMusicFontSymbolText(e,t,n,o,r)}fillMusicFontSymbolText(e,t,n,i,r){this.buffer+=`<g transform="translate(${e*=this.scale} ${t*=this.scale})" class="at" ><text`;const o=this.scale*n;this.buffer+=1!==o?` style="font-size: ${100*o}%; stroke:none"`:' style="stroke:none"',"#000000"!==this.color.rgba&&(this.buffer+=` fill="${this.color.rgba}"`),r&&(this.buffer+=` text-anchor="${this.getSvgTextAlignment(ye.Center)}"`),this.buffer+=`>${i}</text></g>`}}class lm{constructor(){this.isInsideBracket=!0,this.isRelevantForBoundsLookup=!0,this.hideOnMultiTrack=!1,this.hideOnPercussionTrack=!1}canCreate(e,t){return!this.hideOnPercussionTrack||!t.isPercussion}}var St=function(s){return s[s.PreNotes=0]="PreNotes",s[s.OnNotes=1]="OnNotes",s[s.MiddleNotes=2]="MiddleNotes",s[s.Stem=3]="Stem",s[s.PostNotes=4]="PostNotes",s[s.EndBeat=5]="EndBeat",s}(St||{});class $a extends os{constructor(){super(...arguments),this.glyphs=null}get isEmpty(){return!this.glyphs||0===this.glyphs.length}doLayout(){if(!this.glyphs||0===this.glyphs.length)return void(this.width=0);let e=0;for(let t=0,n=this.glyphs.length;t<n;t++){const i=this.glyphs[t];i.renderer=this.renderer,i.doLayout(),e=Math.max(e,i.width)}this.width=e}addGlyph(e){this.glyphs||(this.glyphs=[]),this.renderer&&(e.renderer=this.renderer),this.glyphs.push(e)}paint(e,t,n){const i=this.glyphs;if(i&&0!==i.length)for(const r of i)r.paint(e+this.x,t+this.y,n)}}class Wh extends $a{constructor(){super(0,0),this.glyphs=[]}doLayout(){}addGlyph(e){e.x=this.width,e.renderer=this.renderer,e.doLayout(),this.width=e.x+e.width,super.addGlyph(e)}}class yt{static score(e,t,n,i=!1){if(!n.style&&!i)return;const r=yt.scoreDefaultColor(e.settings.display.resources,t);return new Pf(e,t,n.style,r)}static scoreColor(e,t,n){const i=yt.scoreDefaultColor(e,t);if(n.style&&n.style.colors.has(t))return n.style.colors.get(t)??i}static scoreDefaultColor(e,t){return e.mainGlyphColor}static bar(e,t,n,i=!1){if(!n.style&&!i)return;let r=e.settings.display.resources.mainGlyphColor;switch(t){case Ht.StandardNotationRepeats:case Ht.GuitarTabsRepeats:case Ht.SlashRepeats:case Ht.NumberedRepeats:case Ht.StandardNotationClef:case Ht.GuitarTabsClef:case Ht.StandardNotationKeySignature:case Ht.NumberedKeySignature:case Ht.StandardNotationTimeSignature:case Ht.GuitarTabsTimeSignature:case Ht.SlashTimeSignature:case Ht.NumberedTimeSignature:break;case Ht.StandardNotationBarLines:case Ht.GuitarTabsBarLines:case Ht.SlashBarLines:case Ht.NumberedBarLines:r=e.settings.display.resources.barSeparatorColor;break;case Ht.StandardNotationBarNumber:case Ht.SlashBarNumber:case Ht.NumberedBarNumber:case Ht.GuitarTabsBarNumber:r=e.settings.display.resources.barNumberColor;break;case Ht.StandardNotationStaffLine:case Ht.GuitarTabsStaffLine:case Ht.SlashStaffLine:case Ht.NumberedStaffLine:r=e.settings.display.resources.staffLineColor}return new Pf(e,t,n.style,r)}static voice(e,t,n,i=!1){if(n.style||i)return new Pf(e,t,n.style,0===n.index?e.settings.display.resources.mainGlyphColor:e.settings.display.resources.secondaryGlyphColor)}static trackColor(e,t,n){const i=yt.trackDefaultColor(e,t);if(n.style&&n.style.colors.has(t))return n.style.colors.get(t)??i}static trackDefaultColor(e,t){let n=e.mainGlyphColor;switch(t){case Dl.TrackName:case Dl.SystemSeparator:case Dl.StringTuning:break;case Dl.BracesAndBrackets:n=e.barSeparatorColor}return n}static track(e,t,n,i=!1){if(!n.style&&!i)return;const r=yt.trackDefaultColor(e.settings.display.resources,t);return new Pf(e,t,n.style,r)}static beatColor(e,t,n){const i=yt.beatDefaultColor(e,t,n);if(n.style&&n.style.colors.has(t))return n.style.colors.get(t)??i}static beatDefaultColor(e,t,n){return 0===n.voice.index?e.mainGlyphColor:e.secondaryGlyphColor}static beat(e,t,n,i=!1){if(!n.style&&!i)return;const r=yt.beatDefaultColor(e.settings.display.resources,t,n);return new Pf(e,t,n.style,r)}static noteColor(e,t,n){const i=yt.noteDefaultColor(e,t,n);if(n.style&&n.style.colors.has(t))return n.style.colors.get(t)??i}static noteDefaultColor(e,t,n){return 0===n.beat.voice.index?e.mainGlyphColor:e.secondaryGlyphColor}static note(e,t,n,i=!1){if(n.style||i)return new Pf(e,t,n.style,0===n.beat.voice.index?e.settings.display.resources.mainGlyphColor:e.settings.display.resources.secondaryGlyphColor)}}class Pf{constructor(e,t,n,i){this._canvas=e,n&&n.colors.has(t)?(this._previousColor=e.color,e.color=n.colors.get(t)??i):n||(this._previousColor=e.color,e.color=i)}[Symbol.dispose](){this._previousColor&&(this._canvas.color=this._previousColor)}}let dse=(()=>{class s extends $a{constructor(t,n,i){super(t,n),this.voice=i,this.beatGlyphs=[],this.tupletGroups=[]}scaleToWidth(t){const n=this.renderer.layoutingInfo.spaceToForce(t);this.scaleToForce(n)}scaleToForce(t){this.width=this.renderer.layoutingInfo.calculateVoiceWidth(t);const n=this.renderer.layoutingInfo.buildOnTimePositions(t),i=this.beatGlyphs;for(let r=0,o=i.length;r<o;r++){const a=i[r];if(a.beat.graceType===Ee.None)a.x=n.get(a.beat.absoluteDisplayStart)-a.onTimeX;else{const l=a.beat.graceGroup.beats[0].absoluteDisplayStart,c=a.beat.graceGroup.id;if(a.beat.graceGroup.isComplete&&n.has(l)){a.x=n.get(l)-a.onTimeX;const u=this.renderer.layoutingInfo.allGraceRods.get(c),h=a.beat.graceGroup.beats[a.beat.graceGroup.beats.length-1].nextBeat,d=h?this.renderer.layoutingInfo.getPreBeatSize(h)+za.GraceBeatPadding:0;a.x-=d,a.x-=u[a.beat.graceIndex].postSpringWidth,a.x+=u[a.beat.graceIndex].graceBeatWidth,a.x-=u[a.beat.graceGroup.beats.length-1].graceBeatWidth}else{const u=this.renderer.layoutingInfo.incompleteGraceRods.get(c),h=u[a.beat.graceIndex].postSpringWidth-u[a.beat.graceIndex].preSpringWidth;a.x=r>0?0===a.beat.graceIndex?i[r-1].x+i[r-1].width:i[r-1].x+u[a.beat.graceIndex-1].postSpringWidth-u[a.beat.graceIndex-1].preSpringWidth-h:-h}}r>0&&i[r-1].scaleToWidth(a.x-i[r-1].x),r===o-1&&a.scaleToWidth(this.width-i[i.length-1].x)}}registerLayoutingInfo(t){const n=this.beatGlyphs;for(const i of n)i.registerLayoutingInfo(t)}applyLayoutingInfo(t){const n=this.beatGlyphs;for(const i of n)i.applyLayoutingInfo(t);this.scaleToForce(Math.max(this.renderer.settings.display.stretchForce,t.minStretchForce))}addGlyph(t){const n=t;t.x=0===this.beatGlyphs.length?0:this.beatGlyphs[this.beatGlyphs.length-1].x+this.beatGlyphs[this.beatGlyphs.length-1].width,t.renderer=this.renderer,t.doLayout(),this.beatGlyphs.push(n),this.width=t.x+t.width,n.beat.hasTuplet&&n.beat.tupletGroup.beats[0].id===n.beat.id&&this.tupletGroups.push(n.beat.tupletGroup)}doLayout(){}paint(t,n,i){const r=yt.voice(i,Gg.Glyphs,this.voice,!0);try{for(let o=0,a=this.beatGlyphs.length;o<a;o++)this.beatGlyphs[o].paint(t+this.x,n+this.y,i)}finally{r?.[Symbol.dispose]?.()}}}return s.KeySizeBeat="Beat",s})();class fse{constructor(){this.staffId="",this.up=0,this.down=0}}class pse{constructor(){this.startBeat=null,this.startX=0,this.startY=0,this.endBeat=null,this.endX=0,this.endY=0}calcY(e){return this.startX===this.endX?this.startY:(this.endY-this.startY)/(this.endX-this.startX)*(e-this.startX)+this.startY}}class ja{get isRestBeamHelper(){return 1===this.beats.length&&this.beats[0].isRest}hasLine(e,t){return e&&this.beatHasLine(t)||!e&&1===this.beats.length&&this.beatHasLine(t)}beatHasLine(e){return e.duration>w.Whole}hasFlag(e,t){return e&&this.beatHasFlag(t)||!e&&1===this.beats.length&&this.beatHasFlag(this.beats[0])}beatHasFlag(e){return!e.deadSlapped&&!e.isRest&&(e.duration>w.Quarter||e.graceType!==Ee.None)}constructor(e,t){this._beatLineXPositions=new Map,this._firstNonRestBeat=null,this._lastNonRestBeat=null,this.voice=null,this.beats=[],this.shortestDuration=w.QuadrupleWhole,this.hasTuplet=!1,this.slashBeats=[],this._firstBeatLowestNoteCompareValue=-1,this._firstBeatHighestNoteCompareValue=-1,this._lastBeatLowestNoteCompareValue=-1,this._lastBeatHighestNoteCompareValue=-1,this.lowestNoteInHelper=null,this._lowestNoteCompareValueInHelper=-1,this.highestNoteInHelper=null,this._highestNoteCompareValueInHelper=-1,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isGrace=!1,this.minRestLine=null,this.beatOfMinRestLine=null,this.maxRestLine=null,this.beatOfMaxRestLine=null,this.direction=V.Up,this.drawingInfos=new Map,this._staff=e,this._renderer=t,this.beats=[]}getBeatLineX(e,t){return t=t??this.direction,this.hasBeatLineX(e)?t===V.Up?this._beatLineXPositions.get(e.index).up:this._beatLineXPositions.get(e.index).down:0}hasBeatLineX(e){return this._beatLineXPositions.has(e.index)}registerBeatLineX(e,t,n,i){const r=this.getOrCreateBeatPositions(t);r.staffId=e,r.up=n,r.down=i;for(const o of this.drawingInfos.values())o.startBeat===t?o.startX=this.getBeatLineX(t):o.endBeat===t&&(o.endX=this.getBeatLineX(t))}getOrCreateBeatPositions(e){return this._beatLineXPositions.has(e.index)||this._beatLineXPositions.set(e.index,new fse),this._beatLineXPositions.get(e.index)}finish(){this.direction=this.calculateDirection()}calculateDirection(){let e=null;if(this.voice?null!==this.preferredBeamDirection?e=this.preferredBeamDirection:this.voice.index>0?e=this.invert(V.Down):(this.voice.bar.isMultiVoice||this.beats[0].graceType!==Ee.None)&&(e=this.invert(V.Up)):e=V.Up,this.highestNoteInHelper&&this.lowestNoteInHelper){const t=this._renderer.getNoteY(this.highestNoteInHelper,be.Center),n=this._renderer.getNoteY(this.lowestNoteInHelper,be.Center);null===e&&(e=this.invert(this._renderer.middleYPosition<(t+n)/2?V.Up:V.Down)),this._renderer.completeBeamingHelper(this)}else e=this.invert(V.Up),this._renderer.completeBeamingHelper(this);return e}static computeLineHeightsForRest(e){switch(e){case w.QuadrupleWhole:case w.DoubleWhole:return[2,2];case w.Whole:return[0,1];case w.Half:return[1,0];case w.Quarter:return[3,3];case w.Eighth:return[2,2];case w.Sixteenth:return[2,4];case w.ThirtySecond:return[4,4];case w.SixtyFourth:return[4,6];case w.OneHundredTwentyEighth:return[6,6];case w.TwoHundredFiftySixth:return[6,8]}return[0,0]}applyRest(e,t){if(this._lastNonRestBeat&&e.index>=this._lastNonRestBeat.index||this._firstNonRestBeat&&e.index<=this._firstNonRestBeat.index)return;let n=t,i=t;const r=ja.computeLineHeightsForRest(e.duration);n-=r[0],i+=r[1];const o=this.minRestLine,a=this.maxRestLine;(null===o||o>n)&&(this.minRestLine=n,this.beatOfMinRestLine=e),(null===a||a<i)&&(this.maxRestLine=i,this.beatOfMaxRestLine=e)}invert(e){return this.invertBeamDirection?e===V.Down?V.Up:V.Down:e}checkBeat(e){e.invertBeamDirection&&(this.invertBeamDirection=!0),this.voice||(this.voice=e.voice);let t=!1;if(0===this.beats.length)t=!0;else switch(this.beats[this.beats.length-1].beamingMode){case jn.Auto:case jn.ForceSplitOnSecondaryToNext:t=ja.canJoin(this.beats[this.beats.length-1],e);break;case jn.ForceSplitToNext:t=!1;break;case jn.ForceMergeWithNext:t=!0}return t&&(null==this.preferredBeamDirection&&null!==e.preferredBeamDirection&&(this.preferredBeamDirection=e.preferredBeamDirection),e.hasTuplet&&(this.hasTuplet=!0),e.graceType!==Ee.None&&(this.isGrace=!0),e.isRest?0===this.beats.length&&this.beats.push(e):(this.isRestBeamHelper&&(this.beats=[]),this.beats.push(e),this.checkNote(e.minNote),this.checkNote(e.maxNote),this.shortestDuration<e.duration&&(this.shortestDuration=e.duration),this._firstNonRestBeat||(this._firstNonRestBeat=e),this._lastNonRestBeat=e),e.slashed&&this.slashBeats.push(e)),t}checkNote(e){if(!e)return;let t,n;this.voice&&e.isPercussion?(t=-Ga.getPercussionLine(this.voice.bar,Ga.getNoteValue(e)),n=t):(t=Ga.getNoteValue(e),n=t,e.harmonicType!==Ie.None&&e.harmonicType!==Ie.Natural&&(n=e.realValue-this._staff.displayTranspositionPitch)),1===this.beats.length&&this.beats[0]===e.beat&&((-1===this._firstBeatLowestNoteCompareValue||t<this._firstBeatLowestNoteCompareValue)&&(this._firstBeatLowestNoteCompareValue=t),(-1===this._firstBeatHighestNoteCompareValue||n>this._firstBeatHighestNoteCompareValue)&&(this._firstBeatHighestNoteCompareValue=n)),(-1===this._lastBeatLowestNoteCompareValue||t<this._lastBeatLowestNoteCompareValue)&&(this._lastBeatLowestNoteCompareValue=t),(-1===this._lastBeatHighestNoteCompareValue||n>this._lastBeatHighestNoteCompareValue)&&(this._lastBeatHighestNoteCompareValue=n),(!this.lowestNoteInHelper||t<this._lowestNoteCompareValueInHelper)&&(this.lowestNoteInHelper=e,this._lowestNoteCompareValueInHelper=t),(!this.highestNoteInHelper||n>this._highestNoteCompareValueInHelper)&&(this.highestNoteInHelper=e,this._highestNoteCompareValueInHelper=n)}static canJoin(e,t){if(!e||!t||e.graceType!==t.graceType||e.graceType===Ee.BendGrace||t.graceType===Ee.BendGrace||e.deadSlapped||t.deadSlapped)return!1;if(e.graceType!==Ee.None&&t.graceType!==Ee.None)return!0;const n=e.voice.bar;if(n!==t.voice.bar)return!1;const r=e.playbackStart,o=t.playbackStart;if(!ja.canJoinDuration(e.duration)||!ja.canJoinDuration(t.duration))return r===o;if(e.tupletGroup!==t.tupletGroup)return!1;if(e.hasTuplet&&t.hasTuplet&&e.tupletGroup===t.tupletGroup&&e.tupletGroup.isFull)return!0;let a=G.QuarterTime;return 8===n.masterBar.timeSignatureDenominator&&n.masterBar.timeSignatureNumerator%3==0&&(a+=G.QuarterTime/2|0),((a+r)/a|0)==((a+o)/a|0)}static canJoinDuration(e){switch(e){case w.Whole:case w.Half:case w.Quarter:return!1;default:return!0}}static isFullBarJoin(e,t,n){return ie.getIndex(e.duration)-2-n>0&&ie.getIndex(t.duration)-2-n>0}get beatOfLowestNote(){return this.lowestNoteInHelper.beat}get beatOfHighestNote(){return this.highestNoteInHelper.beat}isPositionFrom(e,t){return!this._beatLineXPositions.has(t.index)||this._beatLineXPositions.get(t.index).staffId===e||!this._beatLineXPositions.get(t.index).staffId}}class gse{constructor(e,t){this.topY=0,this.bottomY=0,this.topY=e,this.bottomY=t}}class mse{constructor(e){this.topY=-1e3,this.bottomY=-1e3,this.slots=[],this.beat=e}addSlot(e,t){if(this.slots.push(new gse(e,t)),-1e3===this.topY)this.topY=e,this.bottomY=t;else{const n=Math.min(e,t),i=Math.max(e,t);n<this.topY&&(this.topY=n),i>this.bottomY&&(this.bottomY=i)}}}class yse{constructor(){this.reservedLayoutAreasByDisplayTime=new Map,this.restDurationsByDisplayTime=new Map}getBeatMinMaxY(){let e=-1e3,t=-1e3;for(const n of this.reservedLayoutAreasByDisplayTime.values())-1e3===e?(e=n.topY,t=n.bottomY):(e>n.topY&&(e=n.topY),t<n.bottomY&&(t=n.bottomY));return-1e3===e?[0,0]:[e,t]}reserveBeatSlot(e,t,n){t!==n&&(this.reservedLayoutAreasByDisplayTime.has(e.displayStart)||this.reservedLayoutAreasByDisplayTime.set(e.displayStart,new mse(e)),this.reservedLayoutAreasByDisplayTime.get(e.displayStart).addSlot(t,n),e.isRest&&this.registerRest(e))}registerRest(e){this.restDurationsByDisplayTime.has(e.displayStart)||this.restDurationsByDisplayTime.set(e.displayStart,new Map),this.restDurationsByDisplayTime.get(e.displayStart).has(e.playbackDuration)||this.restDurationsByDisplayTime.get(e.displayStart).set(e.playbackDuration,e.id)}applyRestCollisionOffset(e,t,n){if(e.voice.index>0&&this.reservedLayoutAreasByDisplayTime.has(e.playbackStart)){const i=ja.computeLineHeightsForRest(e.duration).map(u=>u*n),r=t-i[0],o=t+i[1];let a=r;const l=this.reservedLayoutAreasByDisplayTime.get(e.playbackStart);let c=!1;for(const u of l.slots)if(r>=u.topY&&r<=u.bottomY||o>=u.topY&&o<=u.bottomY){c=!0;break}if(c){a=1===e.voice.index?l.topY-i[1]-i[0]:l.bottomY;const u=a+i[0]+i[1],h=2*n,d=Math.ceil(Math.abs(a-r)/h);return l.addSlot(a,u),a<r?d*-h:d*h}}return 0}}class _se{constructor(e){this.beamHelpers=[],this.beamHelperLookup=[],this.preferredBeamDirection=null,this._renderer=e,this.collisionHelper=new yse}initialize(){const e=this._renderer,t=this._renderer.bar;let n=null,i=null;for(let r=0,o=t.voices.length;r<o;r++){const a=t.voices[r];this.beamHelpers.push([]),this.beamHelperLookup.push(new Map);for(let l=0,c=a.beats.length;l<c;l++){const u=a.beats[l];let h;u.graceType!==Ee.None?h=i:(h=n,i=null),(!h||!h.checkBeat(u))&&(h&&h.finish(),h=new ja(t.staff,e),h.preferredBeamDirection=this.preferredBeamDirection,h.checkBeat(u),u.graceType!==Ee.None?i=h:n=h,this.beamHelpers[a.index].push(h)),this.beamHelperLookup[a.index].set(u.index,h)}n&&n.finish(),i&&i.finish(),n=null,i=null}}getBeamingHelperForBeat(e){return this.beamHelperLookup[e.voice.index].get(e.index)}}let bse=(()=>{class s extends ro{constructor(t,n,i){super(t,n),this._textRow=0,this._fretRow=0,this._firstFretSpacing=0,this._chord=i}doLayout(){super.doLayout();const t=this.renderer.resources;this._textRow=1.5*t.effectFont.size,this._fretRow=1.5*t.effectFont.size,this._firstFretSpacing=this._chord.firstFret>1?s.FretSpacing:0,this.height=this._textRow+this._fretRow+s.Frets*s.FretSpacing+2*s.Padding[1],this.width=this._firstFretSpacing+(this._chord.strings.length-1)*s.StringSpacing+2*s.Padding[0]}paint(t,n,i){t+=this.x+s.Padding[0]+this._firstFretSpacing,n+=this.y;const r=s.StringSpacing,o=s.FretSpacing,a=this.renderer.resources,l=s.CircleRadius,c=this.width-2*s.Padding[0]-this._firstFretSpacing,u=i.textAlign,h=i.textBaseline;i.font=a.effectFont,i.textAlign=ye.Center,i.textBaseline=qe.Top,this._chord.showName&&i.fillText(this._chord.name,t+c/2,n+a.effectFont.size/2),n+=this._textRow,i.font=a.fretboardNumberFont,i.textBaseline=qe.Middle;for(let p=0;p<this._chord.strings.length;p++){const g=t+p*r,m=n+this._fretRow/2;let _=this._chord.strings[this._chord.strings.length-p-1];_<0?i.fillMusicFontSymbol(g,m,1,f.FretboardX,!0):0===_?i.fillMusicFontSymbol(g,m,1,f.FretboardO,!0):(_-=this._chord.firstFret-1,i.fillText(_.toString(),g,m))}n+=this._fretRow;for(let p=0;p<this._chord.strings.length;p++)i.fillRect(t+p*r,n,1,o*s.Frets+1);this._chord.firstFret>1&&(i.textAlign=ye.Left,i.fillText(this._chord.firstFret.toString(),t-this._firstFretSpacing,n+o/2)),i.fillRect(t,n-1,c,2);for(let p=0;p<=s.Frets;p++)i.fillRect(t,n+p*o,c,1);const d=new Map;for(const p of this._chord.barreFrets)d.set(p-this._chord.firstFret,[-1,-1]);for(let p=0;p<this._chord.strings.length;p++){let g=this._chord.strings[p];if(g>0){if(g-=this._chord.firstFret,d.has(g)){const y=d.get(g);(-1===y[0]||p<y[0])&&(y[0]=p),(-1===y[1]||p>y[1])&&(y[1]=p)}i.fillCircle(t+(this._chord.strings.length-p-1)*r,n+g*o+o/2+.5,l)}}for(const[p,g]of d){const _=t+(this._chord.strings.length-g[1]-1)*r;i.fillRect(_,n+p*o+o/2+.5-l,t+(this._chord.strings.length-g[0]-1)*r-_,2*l)}i.textAlign=u,i.textBaseline=h}}return s.Padding=[5,2],s.Frets=5,s.CircleRadius=2.5,s.StringSpacing=10,s.FretSpacing=12,s})();class oV extends $a{constructor(e,t,n=ye.Center){super(e,t),this._glyphWidth=0,this.glyphs=[],this._align=n}doLayout(){let e=0;switch(this._align){case ye.Left:e=0;break;case ye.Center:e=(this.width-this._glyphWidth)/2;break;case ye.Right:e=this.width-this._glyphWidth}for(const t of this.glyphs)t.x=e,e+=t.width}addGlyphToRow(e){this.glyphs.push(e),this._glyphWidth+=e.width,e.height>this.height&&(this.height=e.height)}}let aV=(()=>{class s extends $a{constructor(t,n,i=ye.Center){super(t,n),this._rows=[],this.height=0,this.glyphs=[],this._align=i}doLayout(){let t=0,n=0;const i=s.Padding;this._rows=[];let r=new oV(t,n,this._align);r.width=this.width;for(const o of this.glyphs)t+o.width<this.width?(r.addGlyphToRow(o),t+=o.width):(r.isEmpty||(r.doLayout(),this._rows.push(r),n+=r.height+i),t=0,r=new oV(t,n,this._align),r.width=this.width,r.addGlyphToRow(o),t+=o.width);r.isEmpty||(r.doLayout(),this._rows.push(r),n+=r.height+i),this.height=n}paint(t,n,i){for(const r of this._rows)r.paint(t+this.x,n+this.y,i)}}return s.Padding=3,s})();class wse extends aV{addChord(e){if(e.strings.length>0){const t=new bse(0,0,e);t.renderer=this.renderer,t.doLayout(),this.glyphs.push(t)}}paint(e,t,n){if(this.glyphs.length>0){const i=yt.score(n,re.ChordDiagramList,this.renderer.scoreRenderer.score);try{super.paint(e,t,n)}finally{i?.[Symbol.dispose]?.()}}}}class oo extends ro{constructor(e,t,n,i,r=ye.Left,o=null,a){super(e,t),this._lineHeights=null,this._lines=n.split("\n"),this.font=i,this.textAlign=r,this.textBaseline=o,this.colorOverride=a}doLayout(){super.doLayout(),this._lineHeights=[];const e=this.renderer.scoreRenderer.canvas;for(const t of this._lines){e.font=this.font;const n=e.measureText(t),i=n.height;this._lineHeights.push(i),this.height+=i,this.width=Math.max(this.width,n.width)}}paint(e,t,n){const i=n.color;n.color=this.colorOverride??i,n.font=this.font;const r=n.textAlign,o=n.textBaseline;n.textAlign=this.textAlign,null!==this.textBaseline&&(n.textBaseline=this.textBaseline);let a=t+this.y;for(let l=0;l<this._lines.length;l++)n.fillText(this._lines[l],e+this.x,a),a+=this._lineHeights[l];n.textAlign=r,n.textBaseline=o,n.color=i}}class Sse{get staffId(){return this._factory.staffId}get contentTop(){return this.y+this.staveTop+this.topSpacing+this.topOverflow}get contentBottom(){return this.y+this.topSpacing+this.topOverflow+this.staveBottom}constructor(e,t,n){this._sharedLayoutData=new Map,this.barRenderers=[],this.x=0,this.y=0,this.height=0,this.index=0,this.staffIndex=0,this.isFirstInSystem=!1,this.trackIndex=0,this.staveTop=0,this.topSpacing=0,this.bottomSpacing=0,this.staveBottom=0,this._factory=n,this.trackIndex=e,this.modelStaff=t}getSharedLayoutData(e,t){return this._sharedLayoutData.has(e)?this._sharedLayoutData.get(e):t}setSharedLayoutData(e,t){this._sharedLayoutData.set(e,t)}get isInsideBracket(){return this._factory.isInsideBracket}get isRelevantForBoundsLookup(){return this._factory.isRelevantForBoundsLookup}registerStaffTop(e){this.staveTop=e}registerStaffBottom(e){this.staveBottom=e}addBarRenderer(e){e.staff=this,e.index=this.barRenderers.length,e.reLayout(),this.barRenderers.push(e),this.system.layout.registerBarRenderer(this.staffId,e)}addBar(e,t,n){const i=this._factory.create(this.system.layout.renderer,e);i.additionalMultiRestBars=n,i.staff=this,i.index=this.barRenderers.length,i.layoutingInfo=t,i.doLayout(),i.registerLayoutingInfo();const r=i.barDisplayWidth;r>0&&this.system.layout.systemsLayoutMode===Yo.FromModelWithWidths&&(i.width=r),this.barRenderers.push(i),e&&this.system.layout.registerBarRenderer(this.staffId,i)}revertLastBar(){const e=this.barRenderers[this.barRenderers.length-1];this.barRenderers.splice(this.barRenderers.length-1,1),this.system.layout.unregisterBarRenderer(this.staffId,e);for(const t of this.barRenderers)t.applyLayoutingInfo();return e}scaleToWidth(e){this._sharedLayoutData=new Map;const t=this.topOverflow;let n=0;switch(this.system.layout.systemsLayoutMode){case Yo.Automatic:const r=(e-this.system.computedWidth)/this.barRenderers.length;for(const a of this.barRenderers)a.x=n,a.y=this.topSpacing+t,a.scaleToWidth(a.computedWidth+r),n+=a.width;break;case Yo.FromModelWithScale:e-=this.system.accoladeWidth;const o=this.system.totalBarDisplayScale;for(const a of this.barRenderers)a.x=n,a.y=this.topSpacing+t,a.scaleToWidth(a.barDisplayScale*e/o),n+=a.width;break;case Yo.FromModelWithWidths:for(const a of this.barRenderers){a.x=n,a.y=this.topSpacing+t;const l=a.barDisplayWidth;a.scaleToWidth(l>0?l:a.computedWidth),n+=a.width}}}get topOverflow(){let e=0;for(let t=0,n=this.barRenderers.length;t<n;t++){const i=this.barRenderers[t];i.topOverflow>e&&(e=i.topOverflow)}return e}get bottomOverflow(){let e=0;for(let t=0,n=this.barRenderers.length;t<n;t++){const i=this.barRenderers[t];i.bottomOverflow>e&&(e=i.bottomOverflow)}return e}calculateHeightForAccolade(){this.topSpacing=this._factory.getStaffPaddingTop(this),this.bottomSpacing=this._factory.getStaffPaddingBottom(this),this.height=this.barRenderers.length>0?this.barRenderers[0].height:0,this.height>0&&(this.height+=this.topSpacing+this.topOverflow+this.bottomOverflow+this.bottomSpacing)}finalizeStaff(){this.topSpacing=this._factory.getStaffPaddingTop(this),this.bottomSpacing=this._factory.getStaffPaddingBottom(this),this.height=0;let e=!1,t=this.topOverflow;for(let n=0;n<this.barRenderers.length;n++)this.barRenderers[n].y=this.topSpacing+t,this.height=Math.max(this.height,this.barRenderers[n].height),this.barRenderers[n].finalizeRenderer()&&(e=!0);if(e){t=this.topOverflow;for(let n=0;n<this.barRenderers.length;n++)this.barRenderers[n].y=this.topSpacing+t;for(let n=0;n<this.barRenderers.length;n++)this.barRenderers[n].finalizeRenderer()}this.height>0&&(this.height+=this.topSpacing+t+this.bottomOverflow+this.bottomSpacing)}paint(e,t,n,i,r){if(0!==this.height&&0!==r)for(let o=i,a=Math.min(i+r,this.barRenderers.length);o<a;o++)this.barRenderers[o].paint(e+this.x,t+this.y,n)}}class lV{constructor(){this.timePosition=0,this.longestDuration=0,this.smallestDuration=0,this.force=0,this.springConstant=0,this.preBeatWidth=0,this.graceBeatWidth=0,this.postSpringWidth=0,this.allDurations=new Set}get springWidth(){return this.preSpringWidth+this.postSpringWidth}get preSpringWidth(){return this.preBeatWidth+this.graceBeatWidth}}let vse=(()=>{class s{constructor(){this._timeSortedSprings=[],this._minTime=-1,this._onTimePositionsForce=0,this._onTimePositions=new Map,this._incompleteGraceRodsWidth=0,this._minDuration=s.MinDuration,this.version=0,this.preBeatSize=0,this.postBeatSize=0,this.minStretchForce=0,this.totalSpringConstant=0,this.incompleteGraceRods=new Map,this.allGraceRods=new Map,this.springs=new Map,this.height=0}updateMinStretchForce(t){this.minStretchForce<t&&(this.minStretchForce=t)}getPreBeatSize(t){if(t.graceType!==Ee.None)return this.allGraceRods.get(t.graceGroup.id)[t.graceIndex].preBeatWidth;const n=t.absoluteDisplayStart;return this.springs.has(n)?this.springs.get(n).preBeatWidth:0}getPostBeatSize(t){if(t.graceType!==Ee.None)return this.allGraceRods.get(t.graceGroup.id)[t.graceIndex].postSpringWidth;const n=t.absoluteDisplayStart;return this.springs.has(n)?this.springs.get(n).postSpringWidth:0}addSpring(t,n,i,r,o){let a;if(this.version++,this.springs.has(t))a=this.springs.get(t),a.postSpringWidth<o&&(a.postSpringWidth=o),a.graceBeatWidth<i&&(a.graceBeatWidth=i),a.preBeatWidth<r&&(a.preBeatWidth=r),n<a.smallestDuration&&(a.smallestDuration=n),n>a.longestDuration&&(a.longestDuration=n),a.allDurations.add(n);else{if(a=new lV,a.timePosition=t,a.allDurations.add(n),this._timeSortedSprings.length>0){const u=this._timeSortedSprings[this._timeSortedSprings.length-1];for(const h of u.allDurations);n<this._minDuration&&(this._minDuration=n)}a.longestDuration=n,a.postSpringWidth=o,a.graceBeatWidth=i,a.preBeatWidth=r,this.springs.set(t,a);const l=this._timeSortedSprings;let c=l.length-1;for(;c>0&&l[c].timePosition>t;)c--;this._timeSortedSprings.splice(c+1,0,a)}return(-1===this._minTime||this._minTime>t)&&(this._minTime=t),a}addBeatSpring(t,n,i){const r=t.absoluteDisplayStart;if(t.graceType!==Ee.None){const o=t.graceGroup.id;this.allGraceRods.has(o)||this.allGraceRods.set(o,new Array(t.graceGroup.beats.length)),!t.graceGroup.isComplete&&!this.incompleteGraceRods.has(o)&&this.incompleteGraceRods.set(o,new Array(t.graceGroup.beats.length));const a=this.allGraceRods.get(o)[t.graceIndex];if(a)a.postSpringWidth<i&&(a.postSpringWidth=i),a.preBeatWidth<n&&(a.preBeatWidth=n);else{const l=new lV;l.timePosition=r,l.postSpringWidth=i,l.preBeatWidth=n,t.graceGroup.isComplete||(this.incompleteGraceRods.get(o)[t.graceIndex]=l),this.allGraceRods.get(o)[t.graceIndex]=l}}else{let o=0;if(t.graceGroup&&this.allGraceRods.has(t.graceGroup.id))for(const a of this.allGraceRods.get(t.graceGroup.id))o+=a.springWidth;this.addSpring(r,t.displayDuration,o,n,i)}}finish(){for(const[t,n]of this.allGraceRods){let i=0;for(const r of n)i+=r.preBeatWidth,r.graceBeatWidth=i,i+=r.postSpringWidth}this._incompleteGraceRodsWidth=0;for(const t of this.incompleteGraceRods.values())for(const n of t)this._incompleteGraceRodsWidth+=n.preBeatWidth+n.postSpringWidth;this.calculateSpringConstants(),this.version++}calculateSpringConstants(){let t=0;const n=this._timeSortedSprings;if(0===n.length)return this.totalSpringConstant=-1,void(this.minStretchForce=-1);for(let i=0;i<n.length;i++){const r=n[i];let o=0;o=i===n.length-1?r.longestDuration:Math.abs(n[i+1].timePosition-r.timePosition),r.springConstant=this.calculateSpringConstant(r,o),t+=1/r.springConstant}this.totalSpringConstant=1/t,this.minStretchForce=0;for(let i=0;i<n.length;i++){const r=n[i];let o=0;o=i===n.length-1?r.postSpringWidth:r.postSpringWidth+n[i+1].preSpringWidth,0===i&&(o+=r.preSpringWidth),this.updateMinStretchForce(o*r.springConstant)}}paint(t,n,i){}calculateSpringConstant(t,n){n<=0&&(n=G.toTicks(w.TwoHundredFiftySixth)),0===t.smallestDuration&&(t.smallestDuration=n);const o=s.MinDurationWidth;return t.smallestDuration/n*(1/((1+.85*Math.log2(n/this._minDuration))*o))}spaceToForce(t){return-1!==this.totalSpringConstant?(this._timeSortedSprings.length>0&&(t-=this._timeSortedSprings[0].preSpringWidth),t-=this._incompleteGraceRodsWidth,Math.max(t,0)*this.totalSpringConstant):-1}calculateVoiceWidth(t){let n=0;return-1!==this.totalSpringConstant&&(n=this.calculateWidth(t,this.totalSpringConstant)),this._timeSortedSprings.length>0&&(n+=this._timeSortedSprings[0].preSpringWidth),n+=this._incompleteGraceRodsWidth,n}calculateWidth(t,n){return t/n}buildOnTimePositions(t){if(-1===this.totalSpringConstant)return new Map;if(ie.isAlmostEqualTo(this._onTimePositionsForce,t)&&this._onTimePositions)return this._onTimePositions;this._onTimePositionsForce=t;const n=new Map;this._onTimePositions=n;const i=this._timeSortedSprings;if(0===i.length)return n;let r=i[0].preSpringWidth;for(let o=0;o<i.length;o++)n.set(i[o].timePosition,r),r+=this.calculateWidth(t,i[o].springConstant);return n}}return s.MinDuration=30,s.MinDurationWidth=7,s})();class Tse{constructor(){this.width=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this.additionalMultiBarRestIndexes=null,this.renderers=[]}get lastMasterBarIndex(){return this.additionalMultiBarRestIndexes?this.additionalMultiBarRestIndexes[this.additionalMultiBarRestIndexes.length-1]:this.masterBar.index}}class kse{constructor(e,t){this.staves=[],this.stavesRelevantForBoundsLookup=[],this.firstStaffInBracket=null,this.lastStaffInBracket=null,this.bracket=null,this.staffSystem=e,this.track=t}addStaff(e){this.staves.push(e),e.isRelevantForBoundsLookup&&this.stavesRelevantForBoundsLookup.push(e)}}class Cse{constructor(){this.firstStaffInBracket=null,this.lastStaffInBracket=null,this.drawAsBrace=!1,this.braceScale=1,this.width=0,this.index=0}finalizeBracket(){if(this.firstStaffInBracket===this.lastStaffInBracket)return void(this.width=0);const e=on.Heights.get(f.Brace),t=on.Widths.get(f.Brace);this.width=t,this.drawAsBrace&&this.firstStaffInBracket&&this.lastStaffInBracket&&(this.braceScale=(this.lastStaffInBracket.contentBottom-this.firstStaffInBracket.contentTop)/e,this.width=t*this.braceScale)}}class Hw extends Cse{constructor(e){super(),this.track=e,this.drawAsBrace=Hw.isTrackDrawAsBrace(e)}includesStaff(e){return e.modelStaff.track===this.track}static isTrackDrawAsBrace(e){return e.staves.filter(t=>t.showStandardNotation).length>1}}class Dse extends Hw{includesStaff(e){return e.modelStaff.track===this.track||!this.drawAsBrace&&this.track.playbackInfo.program===e.modelStaff.track.playbackInfo.program}}let xse=(()=>{class s{constructor(t){this._allStaves=[],this._firstStaffInBrackets=null,this._lastStaffInBrackets=null,this._accoladeSpacingCalculated=!1,this._brackets=[],this._hasSystemSeparator=!1,this.x=0,this.y=0,this.index=0,this.accoladeWidth=0,this.isFull=!1,this.width=0,this.computedWidth=0,this.totalBarDisplayScale=0,this.isLast=!1,this.masterBarsRenderers=[],this.staves=[],this.layout=t,this.topPadding=t.renderer.settings.display.systemPaddingTop,this.bottomPadding=t.renderer.settings.display.systemPaddingBottom}get firstBarIndex(){return this.masterBarsRenderers[0].masterBar.index}get lastBarIndex(){return this.masterBarsRenderers[this.masterBarsRenderers.length-1].lastMasterBarIndex}addMasterBarRenderers(t,n){if(0===t.length)return null;this.masterBarsRenderers.push(n),n.layoutingInfo.preBeatSize=0;let i=0;for(let r=0,o=this.staves.length;r<o;r++){const a=this.staves[r];for(let l=0,c=a.staves.length;l<c;l++){const h=n.renderers[i++];a.staves[l].addBarRenderer(h)}}return this.calculateAccoladeSpacing(t),this.updateWidthFromLastBar(),n}addBars(t,n,i){const r=new Tse;r.additionalMultiBarRestIndexes=i,r.layoutingInfo=new vse,r.masterBar=t[0].score.masterBars[n],this.masterBarsRenderers.push(r);const o=r.layoutingInfo;for(const a of this.staves)for(const l of a.staves){const c=a.track.staves[l.modelStaff.index].bars[n],u=null==i?null:i.map(d=>a.track.staves[l.modelStaff.index].bars[d]);l.addBar(c,o,u);const h=l.barRenderers[l.barRenderers.length-1];r.renderers.push(h),h.isLinkedToPrevious&&(r.isLinkedToPrevious=!0),h.canWrap||(r.canWrap=!1)}return this.calculateAccoladeSpacing(t),o.finish(),r.width=this.updateWidthFromLastBar(),r}revertLastBar(){if(this.masterBarsRenderers.length>1){const t=this.masterBarsRenderers[this.masterBarsRenderers.length-1];this.masterBarsRenderers.splice(this.masterBarsRenderers.length-1,1);let n=0,i=0;for(let r=0,o=this._allStaves.length;r<o;r++){const l=this._allStaves[r].revertLastBar(),c=l.computedWidth;c>n&&(n=c);const u=l.barDisplayScale;u>i&&(i=u)}return this.width-=n,this.computedWidth-=n,this.totalBarDisplayScale-=i,t}return null}updateWidthFromLastBar(){let t=0,n=0;for(let i=0,r=this._allStaves.length;i<r;i++){const o=this._allStaves[i],a=o.barRenderers[o.barRenderers.length-1];a.applyLayoutingInfo(),a.computedWidth>t&&(t=a.computedWidth);const l=a.barDisplayScale;l>n&&(n=l)}return this.width+=t,this.computedWidth+=t,this.totalBarDisplayScale+=n,t}calculateAccoladeSpacing(t){const n=this.layout.renderer.settings;if(!this._accoladeSpacingCalculated){this._accoladeSpacingCalculated=!0,this.accoladeWidth=0;const i=this.layout.renderer.score.stylesheet;if(this.layout.renderer.settings.notation.isNotationElementVisible(dt.TrackNames)){const c=0===this.index?i.firstSystemTrackNameMode:i.otherSystemsTrackNameMode,u=0===this.index?i.firstSystemTrackNameOrientation:i.otherSystemsTrackNameOrientation;let h=!1;switch(1===this.layout.renderer.tracks.length?i.singleTrackTrackNamePolicy:i.multiTrackTrackNamePolicy){case rs.Hidden:break;case rs.FirstSystem:h=0===this.index;break;case rs.AllSystems:h=!0}let d=!1;if(h){const p=this.layout.renderer.canvas;p.font=n.display.resources.effectFont;for(const m of t){let _="";switch(c){case Wi.FullName:_=m.name;break;case Wi.ShortName:_=m.shortName}if(_.length>0){d=!0;const y=p.measureText(_);switch(u){case Gi.Horizontal:this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,y.width));break;case Gi.Vertical:this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,y.height))}}}d&&(this.accoladeWidth+=n.display.systemLabelPaddingLeft,this.accoladeWidth+=n.display.systemLabelPaddingRight)}}let o=0;for(const l of this._allStaves)l.y=o,l.calculateHeightForAccolade(),o+=l.height;let a=0;for(const l of this._brackets)l.finalizeBracket(),a=Math.max(a,l.width);this.accoladeWidth+=a,this.width+=this.accoladeWidth,this.computedWidth+=this.accoladeWidth}}getStaffTrackGroup(t){for(let n=0,i=this.staves.length;n<i;n++){const r=this.staves[n];if(r.track===t)return r}return null}addStaff(t,n){let i=this.getStaffTrackGroup(t);if(i||(i=new kse(this,t),this.staves.push(i)),n.staffTrackGroup=i,n.system=this,n.index=this._allStaves.length,this._allStaves.push(n),i.addStaff(n),n.isInsideBracket){this._firstStaffInBrackets||(this._firstStaffInBrackets=n,n.isFirstInSystem=!0),i.firstStaffInBracket||(i.firstStaffInBracket=n),this._lastStaffInBrackets=n,i.lastStaffInBracket=n;let r=this._brackets.find(o=>o.includesStaff(n));if(!r)switch(t.score.stylesheet.bracketExtendMode){case Ha.NoBrackets:break;case Ha.GroupStaves:r=new Hw(t),r.index=this._brackets.length,this._brackets.push(r);break;case Ha.GroupSimilarInstruments:r=new Dse(t),r.index=this._brackets.length,this._brackets.push(r)}r&&(r.firstStaffInBracket||(r.firstStaffInBracket=n),r.lastStaffInBracket=n,i.bracket=r)}}get height(){return 0===this._allStaves.length?0:this._allStaves[this._allStaves.length-1].y+this._allStaves[this._allStaves.length-1].height+this.topPadding+this.bottomPadding}scaleToWidth(t){for(let n=0,i=this._allStaves.length;n<i;n++)this._allStaves[n].scaleToWidth(t);this.width=t}paint(t,n,i){if(this.paintPartial(t+this.x,(n+=this.topPadding)+this.y,i,0,this.masterBarsRenderers.length),this._hasSystemSeparator){const r=yt.track(i,Dl.SystemSeparator,this._allStaves[0].modelStaff.track);try{i.fillMusicFontSymbol(t+this.x,n+this.y+this.height-10,1,f.SystemDivider,!1),i.fillMusicFontSymbol(t+this.x+this.width-s.SystemSignSeparatorWidth,n+this.y+this.height-s.SystemSignSeparatorPadding,1,f.SystemDivider,!1)}finally{r?.[Symbol.dispose]?.()}}}paintPartial(t,n,i,r,o){for(let l=0,c=this._allStaves.length;l<c;l++)this._allStaves[l].paint(t,n,i,r,o);const a=this.layout.renderer.settings.display.resources;if(this.staves.length>0&&0===r){i.color=a.barSeparatorColor;const l=this.layout.renderer.settings,c=this.layout.renderer.settings.notation.isNotationElementVisible(dt.TrackNames);if(i.font=a.effectFont,c){const u=this.layout.renderer.score.stylesheet,d=0===this.index?u.firstSystemTrackNameMode:u.otherSystemsTrackNameMode,p=0===this.index?u.firstSystemTrackNameOrientation:u.otherSystemsTrackNameOrientation;let g=!1;switch(1===this.layout.renderer.tracks.length?u.singleTrackTrackNamePolicy:u.multiTrackTrackNamePolicy){case rs.Hidden:break;case rs.FirstSystem:g=0===this.index;break;case rs.AllSystems:g=!0}if(g){const m=i.textBaseline,_=i.textAlign;for(const y of this.staves)if(y.firstStaffInBracket&&y.lastStaffInBracket){const b=n+y.firstStaffInBracket.contentTop,S=n+y.lastStaffInBracket.contentBottom;let D="";switch(d){case Wi.FullName:D=y.track.name;break;case Wi.ShortName:D=y.track.shortName}const T=yt.track(i,Dl.TrackName,y.track);try{if(D.length>0){const C=t+y.firstStaffInBracket.x-l.display.accoladeBarPaddingRight-(y.bracket?.width??0)-l.display.systemLabelPaddingRight;switch(p){case Gi.Horizontal:i.textBaseline=qe.Middle,i.textAlign=ye.Right,i.fillText(D,C,(b+S)/2);break;case Gi.Vertical:i.textBaseline=qe.Bottom,i.textAlign=ye.Center,i.beginRotate(C,(b+S)/2,-90.1),i.fillText(D,0,0),i.endRotate()}}}finally{T?.[Symbol.dispose]?.()}}i.textBaseline=m,i.textAlign=_}}if(this._allStaves.length>0){let u=null;for(const h of this._allStaves)if(h.isInsideBracket){if(null!==u){const d=u.contentBottom,p=h.contentTop,g=t+u.x,m=u.barRenderers[0],_=yt.bar(i,m.staffLineBarSubElement,m.bar);try{const y=Math.ceil(p-d);i.fillRect(g,n+d,1,y)}finally{_?.[Symbol.dispose]?.()}}u=h}}for(const u of this._brackets)if(u.firstStaffInBracket&&u.lastStaffInBracket){const h=t+u.firstStaffInBracket.x,d=u.width,p=l.display.accoladeBarPaddingRight;let _=n+u.firstStaffInBracket.contentTop,y=n+u.lastStaffInBracket.contentBottom;if(u.drawAsBrace)i.fillMusicFontSymbol(h-p-d,y,u.braceScale,f.Brace);else if(u.firstStaffInBracket!==u.lastStaffInBracket){const b=d/2;_-=b,y+=2*b,i.fillRect(h-p-d,_,d,Math.ceil(y-_));const S=h-p-d-.5;i.fillMusicFontSymbol(S,_,1,f.BracketTop),i.fillMusicFontSymbol(S,Math.floor(y),1,f.BracketBottom)}}}}finalizeSystem(){const t=this.layout.renderer.settings;0===this.index&&(this.topPadding=t.display.firstSystemPaddingTop),this.isLast?this.bottomPadding=t.display.lastSystemPaddingBottom:this.layout.renderer.score.stylesheet.useSystemSignSeparator&&this.layout.renderer.tracks.length>1&&(this.bottomPadding+=s.SystemSignSeparatorHeight,this._hasSystemSeparator=!0);let n=0;for(const i of this._allStaves)i.x=this.accoladeWidth,i.y=n,i.finalizeStaff(),n+=i.height;for(const i of this._brackets)i.finalizeBracket()}buildBoundingsLookup(t,n){if(this.layout.renderer.boundsLookup.isFinished)return;const i=this._firstStaffInBrackets,r=this._lastStaffInBrackets;if(!i||!r)return;const o=this._allStaves[this._allStaves.length-1],a=(n+=this.topPadding)+this.y+i.y,c=n+this.y+this._allStaves[0].y,h=n+this.y+i.y+i.topSpacing+i.topOverflow+(i.barRenderers.length>0?i.barRenderers[0].topPadding:0),p=n+this.y+r.y+r.height-a,g=n+this.y+o.y+o.height-o.bottomSpacing-o.bottomOverflow-(o.barRenderers.length>0?o.barRenderers[0].bottomPadding:0)-h,m=n+this.y+o.y+o.height-c,_=this.x+i.x,y=new QD;y.visualBounds=new bi,y.visualBounds.x=t+this.x,y.visualBounds.y=n+this.y,y.visualBounds.w=this.width,y.visualBounds.h=this.height-this.topPadding-this.bottomPadding,y.realBounds=new bi,y.realBounds.x=t+this.x,y.realBounds.y=n+this.y,y.realBounds.w=this.width,y.realBounds.h=this.height,this.layout.renderer.boundsLookup.addStaffSystem(y);const b=new Map;for(let S=0;S<this.staves.length;S++)for(const D of this.staves[S].stavesRelevantForBoundsLookup)for(const T of D.barRenderers){let C;b.has(T.bar.masterBar.index)?C=b.get(T.bar.masterBar.index):(C=new ZD,C.index=T.bar.masterBar.index,C.isFirstOfLine=T.isFirstOfLine,C.realBounds=new bi,C.realBounds.x=_+T.x,C.realBounds.y=c,C.realBounds.w=T.width,C.realBounds.h=m,C.visualBounds=new bi,C.visualBounds.x=_+T.x,C.visualBounds.y=a,C.visualBounds.w=T.width,C.visualBounds.h=p,C.lineAlignedBounds=new bi,C.lineAlignedBounds.x=_+T.x,C.lineAlignedBounds.y=h,C.lineAlignedBounds.w=T.width,C.lineAlignedBounds.h=g,this.layout.renderer.boundsLookup.addMasterBar(C),b.set(C.index,C)),T.buildBoundingsLookup(C,_,n+this.y+D.y)}}getBarX(t){return this._firstStaffInBrackets&&0!==this.layout.renderer.tracks.length?this.layout.getRendererForBar(this._firstStaffInBrackets.staffId,this.layout.renderer.tracks[0].staves[0].bars[t]).x:0}}return s.SystemSignSeparatorHeight=40,s.SystemSignSeparatorPadding=10,s.SystemSignSeparatorWidth=36,s})();class Nse extends aV{constructor(e,t){super(e,t,ye.Left)}}let Ww=(()=>{class s extends $a{constructor(t,n,i,r){super(t,n),this._tuning=i,this._trackLabel=r,this.glyphs=[]}doLayout(){if(!(this.glyphs.length>0)){this.createGlyphs(this._tuning);for(const t of this.glyphs)t.renderer=this.renderer,t.doLayout()}}paint(t,n,i){i.textBaseline=qe.Middle;const r=i.color;this.colorOverride&&(i.color=this.colorOverride),super.paint(t,n,i),i.color=r}createGlyphs(t){const n=this.renderer.resources;if(this.height=0,this._trackLabel.length>0){this.height+=1;const l=new oo(0,this.height,this._trackLabel,n.effectFont,ye.Left);l.renderer=this.renderer,l.doLayout(),this.height+=l.height+1,l.y+=l.height/2,this.addGlyph(l)}const o=new oo(0,this.height,t.name,n.effectFont,ye.Left);if(o.renderer=this.renderer,o.doLayout(),this.height+=o.height,o.y+=o.height/2,this.addGlyph(o),this.renderer.scoreRenderer.canvas.font=n.effectFont,this.width=Math.max(this.renderer.scoreRenderer.canvas.measureText(this._trackLabel).width,Math.max(this.renderer.scoreRenderer.canvas.measureText(t.name).width,128)),!t.isStandard){this.height+=15;const l=s.CircleNumberScale,c=on.Heights.get(f.GuitarString0)*l,u=0|Math.ceil(t.tunings.length/2);let h=0,d=this.height;for(let p=0,g=t.tunings.length;p<g;p++){this.addGlyph(new Us(h,d+c/2.5,l,f.GuitarString0+(p+1)));const _=`= ${z.getTextForTuning(t.tunings[p],!1)}`;this.addGlyph(new oo(h+c+1,d,_,n.effectFont,ye.Left)),d+=15,p===u-1&&(d=this.height,h+=64)}this.height+=15*u}this.width+=15}}return s.CircleNumberScale=.7,s})();class Ese{constructor(e,t){this.args=e,this.renderCallback=t}}var Yo=function(s){return s[s.Automatic=0]="Automatic",s[s.FromModelWithScale=1]="FromModelWithScale",s[s.FromModelWithWidths=2]="FromModelWithWidths",s}(Yo||{});class kc{get scaledWidth(){return Math.round(this.width/this.renderer.settings.display.scale)}constructor(e){this._barRendererLookup=new Map,this.pagePadding=null,this.width=0,this.height=0,this.multiBarRestInfo=null,this.headerGlyphs=new Map,this.footerGlyphs=new Map,this.chordDiagrams=null,this.tuningGlyph=null,this.systemsLayoutMode=Yo.Automatic,this._lazyPartials=new Map,this.firstBarIndex=0,this.lastBarIndex=0,this.renderer=e}resize(){this._lazyPartials.clear(),this.doResize()}layoutAndRender(){this._lazyPartials.clear();const e=this.renderer.score;this.firstBarIndex=ie.computeFirstDisplayedBarIndex(e,this.renderer.settings),this.lastBarIndex=ie.computeLastDisplayedBarIndex(e,this.renderer.settings,this.firstBarIndex),this.multiBarRestInfo=ie.buildMultiBarRestInfo(this.renderer.tracks,this.firstBarIndex,this.lastBarIndex),this.pagePadding=this.renderer.settings.display.padding.map(t=>t/this.renderer.settings.display.scale),this.pagePadding||(this.pagePadding=[0,0,0,0]),1===this.pagePadding.length?this.pagePadding=[this.pagePadding[0],this.pagePadding[0],this.pagePadding[0],this.pagePadding[0]]:2===this.pagePadding.length&&(this.pagePadding=[this.pagePadding[0],this.pagePadding[1],this.pagePadding[0],this.pagePadding[1]]),this.createScoreInfoGlyphs(),this.doLayoutAndRender()}registerPartial(e,t){if(0===e.height)return;const n=this.renderer.settings.display.scale;e.x*=n,e.y*=n,e.width*=n,e.height*=n,e.totalWidth*=n,e.totalHeight*=n,this.renderer.settings.core.enableLazyLoading?(this._lazyPartials.set(e.id,new Ese(e,t)),this.renderer.partialLayoutFinished.trigger(e)):(this.renderer.partialLayoutFinished.trigger(e),this.internalRenderLazyPartial(e,t))}internalRenderLazyPartial(e,t){const n=this.renderer.canvas;n.beginRender(e.width,e.height),t(n),e.renderResult=n.endRender(),this.renderer.partialRenderFinished.trigger(e)}renderLazyPartial(e){if(this._lazyPartials.has(e)){const t=this._lazyPartials.get(e);this.internalRenderLazyPartial(t.args,t.renderCallback)}}createHeaderFooterGlyph(e,t,n,i){switch(n){case re.WordsAndMusic:if(t.words!==t.music)return;break;case re.Words:case re.Music:if(t.words===t.music)return;break;case re.CopyrightSecondLine:if(!this.headerGlyphs.has(re.Copyright))return}const r=e.display.resources,o=e.notation,l=t.style&&t.style.headerAndFooter.has(n)?t.style.headerAndFooter.get(n):Bh.defaultHeaderAndFooter.get(n);let c=void 0===l.isVisible||l.isVisible;if(void 0!==i&&(c=o.isNotationElementVisible(i)),!c)return;const u=l.buildText(t);return u?new oo(0,0,u,r.getFontForElement(n),l.textAlign,void 0,yt.scoreColor(r,n,t)):void 0}createScoreInfoGlyphs(){F.debug("ScoreLayout","Creating score info glyphs");const e=this.renderer.settings,t=this.renderer.score;this.headerGlyphs=new Map,this.footerGlyphs=new Map;const n=new ss(this.renderer,this.renderer.tracks[0].staves[0].bars[0]);for(const[o,a]of kc.HeaderElements.value){const l=this.createHeaderFooterGlyph(e,t,o,a);l&&(l.renderer=n,l.doLayout(),this.headerGlyphs.set(o,l))}for(const[o,a]of kc.FooterElements.value){const l=this.createHeaderFooterGlyph(e,t,o,a);l&&(l.renderer=n,l.doLayout(),this.footerGlyphs.set(o,l))}const i=e.notation,r=e.display.resources;if(i.isNotationElementVisible(dt.GuitarTuning)){const o=[];for(const a of this.renderer.tracks)for(const l of a.staves){let c=!l.isPercussion&&l.isStringed&&l.tuning.length>0&&l.showTablature;if(t.stylesheet.perTrackDisplayTuning&&t.stylesheet.perTrackDisplayTuning.has(a.index)&&!1===t.stylesheet.perTrackDisplayTuning.get(a.index)&&(c=!1),c){o.push(l);break}}if(o.length>0&&t.stylesheet.globalDisplayTuning){this.tuningGlyph=new Nse(0,0),this.tuningGlyph.renderer=n;for(const a of o)if(a.stringTuning.tunings.length>0){const c=new Ww(0,0,a.stringTuning,o.length>1?a.track.name:"");c.colorOverride=yt.trackColor(r,Dl.StringTuning,a.track),c.renderer=n,c.doLayout(),this.tuningGlyph.addGlyph(c)}}else this.tuningGlyph=null}if(i.isNotationElementVisible(dt.ChordDiagrams)){this.chordDiagrams=new wse(0,0),this.chordDiagrams.renderer=n;const o=new Set;for(const a of this.renderer.tracks)if(t.stylesheet.globalDisplayChordDiagramsOnTop&&(null==t.stylesheet.perTrackChordDiagramsOnTop||!t.stylesheet.perTrackChordDiagramsOnTop.has(a.index)||t.stylesheet.perTrackChordDiagramsOnTop.get(a.index)))for(const c of a.staves){const u=c.chords;if(u)for(const[,h]of u)o.has(h.uniqueId)||h.showDiagram&&(o.add(h.uniqueId),this.chordDiagrams.addChord(h))}this.chordDiagrams.isEmpty&&(this.chordDiagrams=null)}else this.chordDiagrams=null}createEmptyStaffSystem(){const e=new xse(this);for(let t=0;t<this.renderer.tracks.length;t++){const n=this.renderer.tracks[t];for(let i=0;i<n.staves.length;i++){const r=n.staves[i],o=B.staveProfiles.get(this.renderer.settings.display.staveProfile);for(const a of o)a.canCreate(n,r)&&e.addStaff(n,new Sse(t,r,a))}}return e}registerBarRenderer(e,t){if(this._barRendererLookup.has(e)||this._barRendererLookup.set(e,new Map),this._barRendererLookup.get(e).set(t.bar.id,t),t.additionalMultiRestBars)for(const n of t.additionalMultiRestBars)this._barRendererLookup.get(e).set(n.id,t)}unregisterBarRenderer(e,t){if(this._barRendererLookup.has(e)){const n=this._barRendererLookup.get(e);if(n.delete(t.bar.id),t.additionalMultiRestBars)for(const i of t.additionalMultiRestBars)n.delete(i.id)}}getRendererForBar(e,t){const n=t.id;return this._barRendererLookup.has(e)&&this._barRendererLookup.get(e).has(n)?this._barRendererLookup.get(e).get(n):null}layoutAndRenderBottomScoreInfo(e){e=Math.round(e);const t=new Sc;t.x=0,t.y=e;let n=0;const i=this.renderer.settings.display.resources,r=[];let o=0;for(const[a,l]of kc.FooterElements.value)if(this.footerGlyphs.has(a)){const c=this.footerGlyphs.get(a);c.y=n,this.alignScoreInfoGlyph(c),n+=1.2*c.font.size,r.push(c),o=Math.max(o,Math.round(c.x+c.width))}return n=Math.round(n),r.length>0&&(t.width=o,t.height=n,t.totalWidth=this.scaledWidth,t.totalHeight=e+t.height,this.registerPartial(t,a=>{a.color=i.scoreInfoColor,a.textAlign=ye.Left,a.textBaseline=qe.Top;for(const l of r)l.paint(0,0,a)})),e+n}alignScoreInfoGlyph(e){if(B.getLayoutEngineFactory(this.renderer.settings.display.layoutMode).vertical)switch(e.textAlign){case ye.Left:e.x=this.pagePadding[0];break;case ye.Center:e.x=this.scaledWidth/2;break;case ye.Right:e.x=this.scaledWidth-this.pagePadding[2]}else e.x=this.firstBarX,e.textAlign=ye.Left}layoutAndRenderAnnotation(e){const n=this.renderer.settings.display.resources,r=Ke.withFamilyList(n.copyrightFont.families,12,ts.Plain,Or.Bold),o=new ss(this.renderer,this.renderer.tracks[0].staves[0].bars[0]),a=new oo(0,0,"rendered by alphaTab",r,ye.Center,void 0,n.mainGlyphColor);a.renderer=o,a.doLayout(),this.alignScoreInfoGlyph(a);const l=new Sc;return l.width=a.x+a.width,l.x=0,l.height=12,l.y=e,l.totalWidth=this.scaledWidth,l.totalHeight=e+12,l.firstMasterBarIndex=-1,l.lastMasterBarIndex=-1,this.registerPartial(l,c=>{c.color=n.mainGlyphColor,c.font=r,c.textAlign=ye.Left,c.textBaseline=qe.Top,a.paint(0,0,c)}),e+12}}kc.HeaderElements=new Wg(()=>new Map([[re.Title,dt.ScoreTitle],[re.SubTitle,dt.ScoreSubTitle],[re.Artist,dt.ScoreArtist],[re.Album,dt.ScoreAlbum],[re.Words,dt.ScoreWords],[re.Music,dt.ScoreMusic],[re.WordsAndMusic,dt.ScoreWordsAndMusic],[re.Transcriber,void 0]])),kc.FooterElements=new Wg(()=>new Map([[re.Copyright,dt.ScoreCopyright],[re.CopyrightSecondLine,void 0]]));class Su extends $a{constructor(){super(0,0),this._effectGlyphs=[],this._normalGlyphs=[],this.computedWidth=0}doLayout(){let e=0;if(this.glyphs)for(let t=0,n=this.glyphs.length;t<n;t++){const i=this.glyphs[t];i.x=e,i.renderer=this.renderer,i.doLayout(),e+=i.width}this.width=e,this.computedWidth=e}noteLoop(e){for(let t=this.container.beat.notes.length-1;t>=0;t--)e(this.container.beat.notes[t])}addEffect(e){super.addGlyph(e),this._effectGlyphs.push(e)}addNormal(e){super.addGlyph(e),this._normalGlyphs.push(e)}get effectElement(){}paint(e,t,n){this.paintEffects(e,t,n),this.paintNormal(e,t,n)}paintNormal(e,t,n){for(const i of this._normalGlyphs)i.paint(e+this.x,t+this.y,n)}paintEffects(e,t,n){const i=this.effectElement?yt.beat(n,this.effectElement,this.container.beat):void 0;try{for(const r of this._effectGlyphs)r.paint(e+this.x,t+this.y,n)}finally{i?.[Symbol.dispose]?.()}}}class vu extends Su{constructor(){super(...arguments),this.centerX=0}updateBeamingHelper(){}buildBoundingsLookup(e,t,n){}getNoteX(e,t){return 0}getNoteY(e,t){return 0}}let Gw=(()=>{class s extends os{constructor(t,n,i,r=1){super(t,n),this._scale=0,this._symbols=[],this._symbols=s.getSymbols(i),this._scale=r}static getSymbols(t){const n=[];for(;t>0;)n.unshift(s.getSymbol(t%10)),t=t/10|0;return n}static getSymbol(t){switch(t){case 0:return f.TimeSig0;case 1:return f.TimeSig1;case 2:return f.TimeSig2;case 3:return f.TimeSig3;case 4:return f.TimeSig4;case 5:return f.TimeSig5;case 6:return f.TimeSig6;case 7:return f.TimeSig7;case 8:return f.TimeSig8;case 9:return f.TimeSig9;default:return f.None}}doLayout(){let t=0;for(const n of this._symbols)t+=on.Widths.get(n);this.width=t}paint(t,n,i){i.fillMusicFontSymbols(t+this.x,n+this.y,this._scale,this._symbols)}}return s.numberHeight=18,s})(),Ise=(()=>{class s extends os{constructor(){super(0,0),this._numberGlyph=[]}doLayout(){this.width=70,this.renderer.registerOverflowTop(this.renderer.getLineHeight(1)),this._numberGlyph=Gw.getSymbols(this.renderer.additionalMultiRestBars.length+1)}paint(t,n,i){i.fillMusicFontSymbols(t+this.x,n+this.y+this.renderer.height/2,1,[f.RestHBarLeft,f.RestHBarMiddle,f.RestHBarMiddle,f.RestHBarMiddle,f.RestHBarRight]);const r=this.renderer.getLineY(-1.5);i.fillMusicFontSymbols(t+this.x+s.BarWidth/2,n+this.y+r|0,1,this._numberGlyph,!0)}}return s.BarWidth=60,s})();class Uw extends za{constructor(e){super(Uw.getOrCreatePlaceholderBeat(e),e),this.preNotes=new Su,this.onNotes=new vu}doLayout(){this.renderer.showMultiBarRest&&this.onNotes.addNormal(new Ise),super.doLayout()}static getOrCreatePlaceholderBeat(e){if(e.voice.beats.length>1)return e.voice.beats[0];const t=new Ei;return t.voice=e.voice,t}}var be=function(s){return s[s.TopWithStem=0]="TopWithStem",s[s.Top=1]="Top",s[s.Center=2]="Center",s[s.Bottom=3]="Bottom",s[s.BottomWithStem=4]="BottomWithStem",s}(be||{}),Un=function(s){return s[s.Left=0]="Left",s[s.Center=1]="Center",s[s.Right=2]="Right",s}(Un||{});class ss{get nextRenderer(){return this.bar&&this.bar.nextBar?this.scoreRenderer.layout.getRendererForBar(this.staff.staffId,this.bar.nextBar):null}get previousRenderer(){return this.bar&&this.bar.previousBar?this.scoreRenderer.layout.getRendererForBar(this.staff.staffId,this.bar.previousBar):null}get lastBar(){return this.additionalMultiRestBars?this.additionalMultiRestBars[this.additionalMultiRestBars.length-1]:this.bar}get showMultiBarRest(){return!1}constructor(e,t){this._preBeatGlyphs=new Wh,this._voiceContainers=new Map,this._postBeatGlyphs=new Wh,this._ties=[],this.additionalMultiRestBars=null,this.x=0,this.y=0,this.width=0,this.computedWidth=0,this.height=0,this.index=0,this.topOverflow=0,this.bottomOverflow=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this.wasFirstOfLine=!1,this._appliedLayoutingInfo=0,this.isFinalized=!1,this.topPadding=0,this.bottomPadding=0,this.scoreRenderer=e,this.bar=t,t&&(this.helpers=new _se(this))}registerTies(e){this._ties.push(...e)}get middleYPosition(){return 0}registerOverflowTop(e){return e>this.topOverflow&&(this.topOverflow=e,!0)}registerOverflowBottom(e){return e>this.bottomOverflow&&(this.bottomOverflow=e,!0)}scaleToWidth(e){const t=e-this._preBeatGlyphs.width-this._postBeatGlyphs.width;for(const n of this._voiceContainers.values())n.scaleToWidth(t);this._postBeatGlyphs.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width+t,this.width=e}get resources(){return this.settings.display.resources}get settings(){return this.scoreRenderer.settings}get barDisplayScale(){return this.staff.system.staves.length>1?this.bar.masterBar.displayScale:this.bar.displayScale}get barDisplayWidth(){return this.staff.system.staves.length>1?this.bar.masterBar.displayWidth:this.bar.displayWidth}get isFirstOfLine(){return 0===this.index}get isLast(){return!this.bar||this.bar.index===this.scoreRenderer.layout.lastBarIndex}registerLayoutingInfo(){const e=this.layoutingInfo,t=this._preBeatGlyphs.width;e.preBeatSize<t&&(e.preBeatSize=t);for(const i of this._voiceContainers.values())i.registerLayoutingInfo(e);const n=this._postBeatGlyphs.width;e.postBeatSize<n&&(e.postBeatSize=n)}applyLayoutingInfo(){if(this._appliedLayoutingInfo>=this.layoutingInfo.version)return!1;this._appliedLayoutingInfo=this.layoutingInfo.version,this._preBeatGlyphs.width=this.layoutingInfo.preBeatSize;let e=this._preBeatGlyphs.x+this._preBeatGlyphs.width;for(const n of this._voiceContainers.values()){n.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width,n.applyLayoutingInfo(this.layoutingInfo);const i=n.x+n.width;e<i&&(e=i)}this._postBeatGlyphs.x=Math.floor(e),this._postBeatGlyphs.width=this.layoutingInfo.postBeatSize,this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.computedWidth=this.width;const t=this.barDisplayWidth;return t>0&&this.scoreRenderer.layout.systemsLayoutMode===Yo.FromModelWithWidths&&(this.width=t,this.computedWidth=t),!0}finalizeRenderer(){this.isFinalized=!0;let e=!1;const t=this.y-this.staff.topSpacing,n=this.y+this.height+this.staff.bottomSpacing;for(const i of this._ties)if(i.doLayout(),i.height>0){const r=i.y+i.height-n;r>0&&this.registerOverflowBottom(r)&&(e=!0);const o=i.y-t;o<0&&this.registerOverflowTop(-1*o)&&(e=!0)}return e}doLayout(){if(this.bar){this.helpers.initialize(),this._ties=[],this._preBeatGlyphs=new Wh,this._preBeatGlyphs.renderer=this,this._voiceContainers.clear(),this._postBeatGlyphs=new Wh,this._postBeatGlyphs.renderer=this;for(let e=0;e<this.bar.voices.length;e++){const t=this.bar.voices[e];if(this.hasVoiceContainer(t)){const n=new dse(0,0,t);n.renderer=this,this._voiceContainers.set(this.bar.voices[e].index,n)}}if(this.bar.simileMark===ws.SecondOfDouble&&(this.canWrap=!1),this.createPreBeatGlyphs(),this.additionalMultiRestBars){const e=new Uw(this.getVoiceContainer(this.bar.voices[0]));this.addBeatGlyph(e)}else this.createBeatGlyphs();this.createPostBeatGlyphs(),this.updateSizes();for(const e of this.helpers.beamHelpers)for(const t of e)t.finish();this.computedWidth=this.width}}hasVoiceContainer(e){return!(!this.additionalMultiRestBars&&0!==e.index&&e.isEmpty)}updateSizes(){this.staff.registerStaffTop(this.topPadding),this.staff.registerStaffBottom(this.height-this.bottomPadding);const e=this._voiceContainers,t=this.beatGlyphsStart;let n=t;for(const i of e.values()){i.x=t,i.doLayout();const r=i.x+i.width;n<r&&(n=r)}this._postBeatGlyphs.x=Math.floor(n),this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.height+=this.layoutingInfo.height}addPreBeatGlyph(e){e.renderer=this,this._preBeatGlyphs.addGlyph(e)}addBeatGlyph(e){e.renderer=this,e.preNotes.renderer=this,e.onNotes.renderer=this,e.onNotes.beamingHelper=this.helpers.beamHelperLookup[e.beat.voice.index].get(e.beat.index),this.getVoiceContainer(e.beat.voice).addGlyph(e)}getVoiceContainer(e){return this._voiceContainers.has(e.index)?this._voiceContainers.get(e.index):void 0}getBeatContainer(e){return this.getVoiceContainer(e.voice)?.beatGlyphs?.[e.index]}getPreNotesGlyphForBeat(e){return this.getBeatContainer(e)?.preNotes}getOnNotesGlyphForBeat(e){return this.getBeatContainer(e)?.onNotes}paint(e,t,n){this.paintBackground(e,t,n),n.color=this.resources.mainGlyphColor,this._preBeatGlyphs.paint(e+this.x,t+this.y,n);for(const i of this._voiceContainers.values())i.paint(e+this.x,t+this.y,n);n.color=this.resources.mainGlyphColor,this._postBeatGlyphs.paint(e+this.x,t+this.y,n)}paintBackground(e,t,n){this.layoutingInfo.paint(e+this.x+this._preBeatGlyphs.x+this._preBeatGlyphs.width,t+this.y+this.height,n)}buildBoundingsLookup(e,t,n){const i=new XD;i.bar=this.bar,i.visualBounds=new bi,i.visualBounds.x=t+this.x,i.visualBounds.y=n+this.y+this.topPadding,i.visualBounds.w=this.width,i.visualBounds.h=this.height-this.topPadding-this.bottomPadding,i.realBounds=new bi,i.realBounds.x=t+this.x,i.realBounds.y=n+this.y,i.realBounds.w=this.width,i.realBounds.h=this.height,e.addBar(i);for(const[r,o]of this._voiceContainers){const a=this.bar.isEmpty&&0===r;if(!o.voice.isEmpty||a)for(let l=0,c=o.beatGlyphs.length;l<c;l++)o.beatGlyphs[l].buildBoundingsLookup(i,t+this.x+o.x,n+this.y+o.y,a)}}addPostBeatGlyph(e){this._postBeatGlyphs.addGlyph(e)}createPreBeatGlyphs(){this.wasFirstOfLine=this.isFirstOfLine}createBeatGlyphs(){for(const e of this.bar.voices)this.hasVoiceContainer(e)&&this.createVoiceGlyphs(e)}createVoiceGlyphs(e){}createPostBeatGlyphs(){}get beatGlyphsStart(){return this._preBeatGlyphs.x+this._preBeatGlyphs.width}get postBeatGlyphsStart(){return this._postBeatGlyphs.x}getBeatX(e,t=St.PreNotes){const n=this.getBeatContainer(e);if(n)switch(t){case St.PreNotes:return n.voiceContainer.x+n.x;case St.OnNotes:return n.voiceContainer.x+n.x+n.onNotes.x;case St.MiddleNotes:return n.voiceContainer.x+n.x+n.onTimeX;case St.Stem:const i=n.onNotes.beamingHelper?n.onNotes.beamingHelper.getBeatLineX(e):n.onNotes.x+n.onNotes.width/2;return n.voiceContainer.x+i;case St.PostNotes:return n.voiceContainer.x+n.x+n.onNotes.x+n.onNotes.width;case St.EndBeat:return n.voiceContainer.x+n.x+n.width}return 0}getRatioPositionX(e){const t=this.bar.isEmpty?this.beatGlyphsStart:this.getBeatX(this.bar.voices[0].beats[0],St.OnNotes);return t+(this.postBeatGlyphsStart-t)*e}getNoteX(e,t){const n=this.getBeatContainer(e.beat);return n?n.voiceContainer.x+n.x+n.onNotes.x+n.onNotes.getNoteX(e,t):0}getNoteY(e,t){const n=this.getOnNotesGlyphForBeat(e.beat);return n?n.getNoteY(e,t):Number.NaN}reLayout(){(this.wasFirstOfLine&&!this.isFirstOfLine||!this.wasFirstOfLine&&this.isFirstOfLine)&&this.recreatePreBeatGlyphs(),this.updateSizes(),this.registerLayoutingInfo()}recreatePreBeatGlyphs(){this._preBeatGlyphs=new Wh,this._preBeatGlyphs.renderer=this,this.createPreBeatGlyphs()}paintSimileMark(e,t,n){const i=yt.voice(n,Gg.Glyphs,this.bar.voices[0],!0);try{switch(this.bar.simileMark){case ws.Simple:n.beginGroup(za.getGroupId(this.bar.voices[0].beats[0])),n.fillMusicFontSymbol(e+this.x+(this.width-20)/2,t+this.y+this.height/2,1,f.Repeat1Bar,!1),n.endGroup();break;case ws.SecondOfDouble:n.beginGroup(za.getGroupId(this.bar.voices[0].beats[0])),n.beginGroup(za.getGroupId(this.bar.previousBar.voices[0].beats[0])),n.fillMusicFontSymbol(e+this.x-14,t+this.y+this.height/2,1,f.Repeat2Bars,!1),n.endGroup(),n.endGroup()}}finally{i?.[Symbol.dispose]?.()}}completeBeamingHelper(e){}getBeatDirection(e){return this.helpers.getBeamingHelperForBeat(e).direction}}ss.RawLineSpacing=8,ss.StemWidth=.12*ss.RawLineSpacing,ss.StaffLineThickness=.13*ss.RawLineSpacing,ss.BeamThickness=.5*ss.RawLineSpacing,ss.BeamSpacing=.25*ss.RawLineSpacing;var It=function(s){return s[s.SinglePreBeat=0]="SinglePreBeat",s[s.SingleOnBeat=1]="SingleOnBeat",s[s.SingleOnBeatToEnd=2]="SingleOnBeatToEnd",s[s.GroupedOnBeat=3]="GroupedOnBeat",s[s.GroupedOnBeatToEnd=4]="GroupedOnBeatToEnd",s[s.FullBar=5]="FullBar",s}(It||{});class Bse extends os{constructor(e,t){super(0,0),this._uniqueEffectGlyphs=[],this._effectGlyphs=[],this.isEmpty=!0,this.previousBand=null,this.isLinkedToPrevious=!1,this.firstBeat=null,this.lastBeat=null,this.height=0,this.originalHeight=0,this.slot=null,this.voice=e,this.info=t}doLayout(){super.doLayout();for(let e=0;e<this.renderer.bar.voices.length;e++)this._effectGlyphs.push(new Map),this._uniqueEffectGlyphs.push([])}createGlyph(e){if(e.voice===this.voice&&this.info.shouldCreateGlyph(this.renderer.settings,e)&&(!this.info.hideOnMultiTrack||0===this.renderer.staff.trackIndex)){if(this.isEmpty=!1,(!this.firstBeat||e.isBefore(this.firstBeat))&&(this.firstBeat=e),!this.lastBeat||e.isAfter(this.lastBeat))switch(this.lastBeat=e,this.info.sizingMode){case It.SingleOnBeatToEnd:case It.GroupedOnBeatToEnd:this.lastBeat.nextBeat&&(this.lastBeat=this.lastBeat.nextBeat)}const t=this.createOrResizeGlyph(this.info.sizingMode,e);t.height>this.height&&(this.height=t.height,this.originalHeight=t.height)}}resetHeight(){this.height=this.originalHeight}createOrResizeGlyph(e,t){let n;switch(e){case It.FullBar:case It.SinglePreBeat:case It.SingleOnBeat:case It.SingleOnBeatToEnd:return n=this.info.createNewGlyph(this.renderer,t),n.renderer=this.renderer,n.beat=t,n.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,n),this._uniqueEffectGlyphs[t.voice.index].push(n),n;case It.GroupedOnBeat:case It.GroupedOnBeatToEnd:const i=e===It.GroupedOnBeat?It.SingleOnBeat:It.SingleOnBeatToEnd;if(t.index>0||this.renderer.index>0){const r=t.previousBeat;if(this.info.shouldCreateGlyph(this.renderer.settings,r)){let o=null;if(t.index>0&&this._effectGlyphs[t.voice.index].has(r.index))o=this._effectGlyphs[t.voice.index].get(r.index);else if(this.renderer.index>0){const c=this.renderer.previousRenderer.getBand(r.voice,this.info.effectId);if(c){const u=c._effectGlyphs[r.voice.index];u.has(r.index)&&(o=u.get(r.index))}}const a=this.createOrResizeGlyph(i,t);return o&&this.info.canExpand(r,t)&&(o.nextGlyph=a,a.previousGlyph=o,this.isLinkedToPrevious=!0),a}return this.createOrResizeGlyph(i,t)}return this.createOrResizeGlyph(i,t);default:return this.createOrResizeGlyph(It.SingleOnBeat,t)}}paint(e,t,n){super.paint(e,t,n);for(let i=0,r=this._uniqueEffectGlyphs.length;i<r;i++){const o=this._uniqueEffectGlyphs[i];for(let a=0,l=o.length;a<l;a++){const c=o[a],u=yt.beat(n,In.Effects,c.beat,!1);try{c.paint(e+this.x,t+this.y,n)}finally{u?.[Symbol.dispose]?.()}}}}alignGlyphs(){for(let e=0;e<this._effectGlyphs.length;e++)for(const t of this._effectGlyphs[e].keys())this.alignGlyph(this.info.sizingMode,this.renderer.bar.voices[e].beats[t])}alignGlyph(e,t){const n=this._effectGlyphs[t.voice.index].get(t.index),i=this.renderer.getBeatContainer(t);switch(e){case It.SinglePreBeat:const r=this.renderer.layoutingInfo.getPreBeatSize(t);n.x=this.renderer.beatGlyphsStart+i.x-r;break;case It.SingleOnBeat:case It.GroupedOnBeat:n.x=this.renderer.beatGlyphsStart+i.x;break;case It.SingleOnBeatToEnd:case It.GroupedOnBeatToEnd:if(n.x=this.renderer.beatGlyphsStart+i.x,i.beat.isLastOfVoice)n.width=this.renderer.width-n.x;else{const o=this.renderer.layoutingInfo.getPostBeatSize(t);n.width=o}break;case It.FullBar:n.width=this.renderer.width}}}class Mse{constructor(){this.uniqueEffectId=null,this.y=0,this.height=0,this.firstBeat=null,this.lastBeat=null}}class Pse{constructor(){this.bands=[],this.shared=new Mse}update(e){e.info.canShareBand||(this.shared.uniqueEffectId=e.info.effectId),e.slot=this,this.bands.push(e),e.height>this.shared.height&&(this.shared.height=e.height),(!this.shared.firstBeat||e.firstBeat.isBefore(this.shared.firstBeat))&&(this.shared.firstBeat=e.firstBeat),(!this.shared.lastBeat||e.lastBeat.isAfter(this.shared.lastBeat))&&(this.shared.lastBeat=e.lastBeat)}canBeUsed(e){return(!this.shared.uniqueEffectId&&e.info.canShareBand||e.info.effectId===this.shared.uniqueEffectId)&&(!this.shared.firstBeat||this.shared.lastBeat.isBefore(e.firstBeat)||this.shared.lastBeat.isBefore(this.shared.firstBeat))}}class Ase{constructor(){this.slots=[],this._effectSlot=new Map}getOrCreateSlot(e){if(this._effectSlot.has(e.info.effectId)){const n=this._effectSlot.get(e.info.effectId);if(n.canBeUsed(e))return n}for(const n of this.slots)if(n.canBeUsed(e))return n;const t=new Pse;return this.slots.push(t),t}register(e){const t=this.getOrCreateSlot(e);t.update(e),this._effectSlot.set(e.info.effectId,t)}}class Rse extends ss{constructor(e,t,n){super(e,t),this._bands=[],this._bandLookup=new Map,this.sizingInfo=null,this._infos=n}updateSizes(){this.topOverflow=0,this.bottomOverflow=0,this.topPadding=0,this.bottomPadding=0,this.updateHeight(),super.updateSizes()}finalizeRenderer(){let e=super.finalizeRenderer();return this.updateHeight()&&(e=!0),e}updateHeight(){if(!this.sizingInfo)return!1;let e=0;for(const t of this.sizingInfo.slots){t.shared.y=e;for(const n of t.bands)n.y=e,n.height=t.shared.height;e+=t.shared.height}return e!==this.height&&(this.height=e,!0)}applyLayoutingInfo(){const e=!super.applyLayoutingInfo();this.sizingInfo=this.index>0?this.previousRenderer.sizingInfo:new Ase;for(const t of this._bands)t.resetHeight(),t.alignGlyphs(),t.isEmpty||this.sizingInfo.register(t);return this.updateHeight(),e}scaleToWidth(e){super.scaleToWidth(e);for(const t of this._bands)t.alignGlyphs()}createBeatGlyphs(){this._bands=[],this._bandLookup=new Map;for(const e of this.bar.voices)if(this.hasVoiceContainer(e))for(const t of this._infos){const n=new Bse(e,t);n.renderer=this,n.doLayout(),this._bands.push(n),this._bandLookup.set(`${e.index}.${t.effectId}`,n)}super.createBeatGlyphs();for(const e of this._bands)e.isLinkedToPrevious&&(this.isLinkedToPrevious=!0)}createVoiceGlyphs(e){for(const t of e.beats){const n=new za(t,this.getVoiceContainer(e));n.preNotes=new Su,n.onNotes=new vu,this.addBeatGlyph(n);for(const i of this._bands)i.createGlyph(t)}}paint(e,t,n){this.paintBackground(e,t,n);for(const i of this._bands)n.color=0===i.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,i.isEmpty||i.paint(e+this.x,t+this.y,n)}getBand(e,t){const n=`${e.index}.${t}`;return this._bandLookup.has(n)?this._bandLookup.get(n):null}}class Gh extends lm{get staffId(){return this._staffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.effectStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.effectStaffPaddingBottom}constructor(e,t,n=null){super(),this.infos=t,this._staffId=e,this.isInsideBracket=!1,this.isRelevantForBoundsLookup=!1,this.shouldShow=n}canCreate(e,t){const n=this.shouldShow;return super.canCreate(e,t)&&(!n||n(e,t))}create(e,t){return new Rse(e,t,this.infos.filter(n=>e.settings.notation.isNotationElementVisible(n.notationElement)))}}let Fse=(()=>{class s extends ro{constructor(t,n,i,r,o){super(t,n),this._endingsString="",this._endings=ie.getAlternateEndingsList(i),this._openLine=r,this._closeLine=o}doLayout(){super.doLayout(),this.height=this.renderer.resources.wordsFont.size+(s.Padding+2);let t="";for(let n=0,i=this._endings.length;n<i;n++)t+=this._endings[n]+1,t+=". ";this._endingsString=t}paint(t,n,i){const r=this._closeLine?this.width-4:this.width;if(t=.5+(0|t),n=.5+(0|n),this._openLine?(i.moveTo(t+this.x,n+this.y+this.height),i.lineTo(t+this.x,n+this.y)):i.moveTo(t+this.x,n+this.y),i.lineTo(t+this.x+r,n+this.y),this._closeLine&&i.lineTo(t+this.x+r,n+this.y+this.height),i.stroke(),this._openLine){const o=i.textBaseline;i.textBaseline=qe.Top,i.font=this.renderer.resources.wordsFont,i.fillText(this._endingsString,t+this.x+s.Padding,n+this.y),i.textBaseline=o}}}return s.Padding=3,s})();class gs{get effectId(){return this.notationElement.toString()}}class Ose extends gs{get notationElement(){return dt.EffectAlternateEndings}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return It.FullBar}shouldCreateGlyph(e,t){return 0===t.voice.index&&0===t.index&&0!==t.voice.bar.masterBar.alternateEndings}createNewGlyph(e,t){const n=t.voice.bar.masterBar,i=null===n.previousMasterBar||n.alternateEndings!==n.previousMasterBar.alternateEndings;let r=n.isRepeatEnd||null===n.nextMasterBar||n.alternateEndings!==n.nextMasterBar.alternateEndings;return n.repeatGroup.closings.some(o=>o.index>=n.index)||(r=!1),new Fse(0,0,n.alternateEndings,i,r)}canExpand(e,t){return!0}}class Lse extends gs{get notationElement(){return dt.EffectCapo}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return 0===t.index&&0===t.voice.bar.index&&0!==t.voice.bar.staff.capo}createNewGlyph(e,t){return new oo(0,0,`Capo. fret ${t.voice.bar.staff.capo}`,e.resources.effectFont,ye.Left)}canExpand(e,t){return!1}}class Vse extends gs{get notationElement(){return dt.EffectChordNames}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return t.hasChord}createNewGlyph(e,t){return new oo(0,0,t.chord.name,e.resources.effectFont,ye.Center)}canExpand(e,t){return!1}}class Af extends ro{constructor(e){super(),this.forceGroupedRendering=!1,this.endOnBarLine=!1,this.endPosition=e}get isLinkedWithPrevious(){return!!this.previousGlyph&&this.previousGlyph.renderer.staff.system===this.renderer.staff.system}get isLinkedWithNext(){return!!this.nextGlyph&&this.nextGlyph.renderer.isFinalized&&this.nextGlyph.renderer.staff.system===this.renderer.staff.system}paint(e,t,n){if(this.isLinkedWithPrevious)return;if(!this.isLinkedWithNext&&!this.forceGroupedRendering)return void this.paintNonGrouped(e,t,n);let i;if(!this.isLinkedWithNext&&this.forceGroupedRendering)i=this;else for(i=this.nextGlyph;i.isLinkedWithNext;)i=i.nextGlyph;const c=this.calculateEndX(i.renderer,i.beat,e-this.renderer.x,this.endPosition);this.paintGrouped(e,t,c,n)}calculateEndX(e,t,n,i){return t?n+e.x+e.getBeatX(t,i):n+e.x+this.x+this.width}paintNonGrouped(e,t,n){const r=this.calculateEndX(this.renderer,this.beat,e-this.renderer.x,this.endPosition);this.paintGrouped(e,t,r,n)}}class Hse extends Af{constructor(e,t,n){super(St.EndBeat),this._crescendo=Zi.None,this._crescendo=n,this.x=e,this.y=t}doLayout(){super.doLayout(),this.height=17}paintGrouped(e,t,n,i){const r=e+this.x,o=this.height,a=on.Widths.get(f.NoteheadBlack)/2;i.beginPath(),this._crescendo===Zi.Crescendo?(i.moveTo(n-=a,t+this.y),i.lineTo(r,t+this.y+o/2),i.lineTo(n,t+this.y+o)):(n-=a,i.moveTo(r,t+this.y),i.lineTo(n,t+this.y+o/2),i.lineTo(r,t+this.y+o)),i.stroke()}}class Wse extends gs{get notationElement(){return dt.EffectCrescendo}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.crescendo!==Zi.None}createNewGlyph(e,t){return new Hse(0,0,t.crescendo)}canExpand(e,t){return e.crescendo===t.crescendo}}class ix extends Us{constructor(e,t,n){super(e,t,.6,ix.getSymbol(n)),this.center=!0}doLayout(){super.doLayout(),this.y+=this.height/2}static getSymbol(e){switch(e){case Te.PPP:return f.DynamicPPP;case Te.PP:return f.DynamicPP;case Te.P:return f.DynamicPiano;case Te.MP:return f.DynamicMP;case Te.MF:return f.DynamicMF;case Te.F:return f.DynamicForte;case Te.FF:return f.DynamicFF;case Te.FFF:return f.DynamicFFF;case Te.PPPP:return f.DynamicPPPP;case Te.PPPPP:case Te.PPPPPP:return f.DynamicPPPPP;case Te.FFFF:return f.DynamicFFFF;case Te.FFFFF:return f.DynamicFFFFF;case Te.FFFFFF:return f.DynamicFFFFFF;case Te.SF:return f.DynamicSforzando1;case Te.SFP:return f.DynamicSforzandoPiano;case Te.SFPP:return f.DynamicSforzandoPianissimo;case Te.FP:return f.DynamicFortePiano;case Te.RF:return f.DynamicRinforzando1;case Te.RFZ:return f.DynamicRinforzando2;case Te.SFZ:return f.DynamicSforzato;case Te.SFFZ:return f.DynamicSforzatoFF;case Te.FZ:return f.DynamicForzando;case Te.N:return f.DynamicNiente;case Te.PF:return f.DynamicPF;case Te.SFZP:return f.DynamicSforzatoPiano;default:return f.None}}}class Gse extends gs{get notationElement(){return dt.EffectDynamics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return this.internalShouldCreateGlyph(t)}internalShouldCreateGlyph(e){if(e.voice.bar.staff.track.score.stylesheet.hideDynamics||e.isEmpty||e.voice.isEmpty||e.isRest)return!1;const t=this.getPreviousDynamicsBeat(e);let n=0===e.voice.index&&!t||e.dynamics!==t?.dynamics;if(n&&e.voice.index>0)for(const i of e.voice.bar.voices)if(i.index<e.voice.index){const r=i.getBeatAtPlaybackStart(e.playbackStart);r&&e.dynamics===r.dynamics&&this.internalShouldCreateGlyph(r)&&(n=!1)}return n}getPreviousDynamicsBeat(e){let t=e.previousBeat;for(;null!=t;){if(!t.isRest)return t;t=t.previousBeat}return null}createNewGlyph(e,t){return new ix(0,0,t.dynamics)}canExpand(e,t){return!0}}class rx extends Us{constructor(e){super(0,0,1,rx.getSymbol(e)),this.center=!0}static getSymbol(e){switch(e){case Ks.FadeIn:return f.GuitarFadeIn;case Ks.FadeOut:return f.GuitarFadeOut;case Ks.VolumeSwell:return f.GuitarVolumeSwell}return f.None}paint(e,t,n){super.paint(e,t+this.height,n)}}class Use extends gs{get notationElement(){return dt.EffectFadeIn}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return t.fade!==Ks.None}createNewGlyph(e,t){return new rx(t.fade)}canExpand(e,t){return!0}}class ox extends Us{constructor(e,t,n){super(e,t,1,ox.getSymbol(n))}static getSymbol(e){switch(e){case Ui.Short:return f.FermataShortAbove;case Ui.Medium:return f.FermataAbove;case Ui.Long:return f.FermataLongAbove;default:return f.None}}paint(e,t,n){super.paint(e-this.width/2,t+this.height,n)}}class zse extends gs{get notationElement(){return dt.EffectFermata}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return 0===t.voice.index&&!!t.fermata}createNewGlyph(e,t){return new ox(0,0,t.fermata.type)}canExpand(e,t){return!0}}class qse extends gs{get notationElement(){return dt.EffectFingering}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return!(0!==t.voice.index||t.isRest||e.notation.fingeringMode!==vl.SingleNoteEffectBand&&e.notation.fingeringMode!==vl.SingleNoteEffectBandForcePiano||1!==t.notes.length)&&t.notes[0].isFingering}createNewGlyph(e,t){let n=Ne.Unknown,i=!1;const r=t.notes[0];r.leftHandFinger!==Ne.Unknown?(n=r.leftHandFinger,i=!0):r.rightHandFinger!==Ne.Unknown&&(n=r.rightHandFinger);const o=ie.fingerToString(e.settings,t,n,i)??"";return new oo(0,0,o,e.resources.fingeringFont,ye.Left)}canExpand(e,t){return!0}}class Uh extends gs{constructor(){super(...arguments),this.lastCreateInfo=null}shouldCreateGlyph(e,t){this.lastCreateInfo=[];for(let n=0,i=t.notes.length;n<i;n++){const r=t.notes[n];this.shouldCreateGlyphForNote(r)&&this.lastCreateInfo.push(r)}return this.lastCreateInfo.length>0}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}canExpand(e,t){return!0}}let zh=(()=>{class s extends Af{constructor(t,n=!0){super(St.OnNotes),this._label=t,this._dashed=n}doLayout(){this.renderer.settings.notation.extendLineEffectsToBeatEnd&&(this.endPosition=St.EndBeat,this.forceGroupedRendering=!0),super.doLayout(),this.height=this.renderer.resources.effectFont.size}paintNonGrouped(t,n,i){i.font=this.renderer.resources.effectFont;const o=i.textAlign;i.textAlign=ye.Center,i.fillText(this._label,t+this.x,n+this.y),i.textAlign=o}paintGrouped(t,n,i,r){this.paintNonGrouped(t,n,r);const a=r.measureText(this._label).width,l=t+this.x+a/2+3,c=n+this.y+4;if(this._dashed){if(i>l){let h=l;for(;h<i;)r.beginPath(),r.moveTo(h,0|c),r.lineTo(Math.min(h+8,i),0|c),h+=11,r.stroke();r.beginPath(),r.moveTo(i,c-5|0),r.lineTo(i,c+5|0),r.stroke()}}else r.beginPath(),r.moveTo(l,0|c),r.lineTo(i,0|c),r.lineTo(i,c+5|0),r.stroke()}}return s.LineSpacing=3,s.LineTopPadding=4,s.LineTopOffset=5,s.LineSize=8,s})();class Tu extends Uh{get effectId(){return this._effectId}get notationElement(){return dt.EffectHarmonics}constructor(e){switch(super(),this._beat=null,this._harmonicType=e,e){case Ie.None:this._effectId="harmonics-none";break;case Ie.Natural:this._effectId="harmonics-natural";break;case Ie.Artificial:this._effectId="harmonics-artificial";break;case Ie.Pinch:this._effectId="harmonics-pinch";break;case Ie.Tap:this._effectId="harmonics-tap";break;case Ie.Semi:this._effectId="harmonics-semi";break;case Ie.Feedback:this._effectId="harmonics-feedback";break;default:this._effectId=""}}shouldCreateGlyphForNote(e){return!(!e.isHarmonic||e.harmonicType!==this._harmonicType||(e.beat!==this._beat&&(this._beat=e.beat),0))}get sizingMode(){return It.GroupedOnBeat}createNewGlyph(e,t){return new zh(Tu.harmonicToString(this._harmonicType))}static harmonicToString(e){switch(e){case Ie.Natural:return"N.H.";case Ie.Artificial:return"A.H.";case Ie.Pinch:return"P.H.";case Ie.Tap:return"T.H.";case Ie.Semi:return"S.H.";case Ie.Feedback:return"Fdbk."}return""}}class $se extends gs{get notationElement(){return dt.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.isLetRing}get sizingMode(){return It.GroupedOnBeat}createNewGlyph(e,t){return new zh("LetRing")}canExpand(e,t){return!0}}class jse extends ro{constructor(e,t,n,i,r=ye.Center){super(e,t),this._lines=n,this.font=i,this.textAlign=r}doLayout(){super.doLayout(),this.height=this.font.size*this._lines.length}paint(e,t,n){n.font=this.font;const i=n.textAlign;n.textAlign=this.textAlign;for(let r=0;r<this._lines.length;r++)this._lines[r]&&n.fillText(this._lines[r],e+this.x,t+this.y+r*this.font.size);n.textAlign=i}}class Yse extends gs{get notationElement(){return dt.EffectLyrics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.lyrics}createNewGlyph(e,t){return new jse(0,0,t.lyrics,e.resources.effectFont,ye.Center)}canExpand(e,t){return!0}}class Xse extends gs{get notationElement(){return dt.EffectMarker}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return It.SinglePreBeat}shouldCreateGlyph(e,t){return 0===t.voice.bar.staff.index&&0===t.voice.index&&0===t.index&&t.voice.bar.masterBar.isSectionStart}createNewGlyph(e,t){return new oo(0,0,t.voice.bar.masterBar.section.marker?`[${t.voice.bar.masterBar.section.marker}] ${t.voice.bar.masterBar.section.text}`:t.voice.bar.masterBar.section.text,e.resources.markerFont,ye.Left)}canExpand(e,t){return!0}}class Jse extends Af{constructor(e,t){super(St.PostNotes),this._ottava=e,this._aboveStaff=t}doLayout(){super.doLayout(),this.height=on.Heights.get(f.QuindicesimaAlta)}paintNonGrouped(e,t,n){this.paintOttava(e,t,n)}paintOttava(e,t,n){let i=0;switch(this._ottava){case Ze._15ma:i=.8*on.Widths.get(f.QuindicesimaAlta),n.fillMusicFontSymbol(e+this.x-i/2,t+this.y+this.height,.8,f.QuindicesimaAlta,!1);break;case Ze._8va:i=.8*on.Widths.get(f.OttavaAlta),n.fillMusicFontSymbol(e+this.x-i/2,t+this.y+this.height,.8,f.OttavaAlta,!1);break;case Ze._8vb:i=.8*on.Widths.get(f.OttavaBassaVb),n.fillMusicFontSymbol(e+this.x-i/2,t+this.y+this.height,.8,f.OttavaBassaVb,!1);break;case Ze._15mb:i=.8*(on.Widths.get(f.Quindicesima)+on.Widths.get(f.OctaveBaselineM)+on.Widths.get(f.OctaveBaselineB)),n.fillMusicFontSymbols(e+this.x-i/2,t+this.y+this.height,.8,[f.Quindicesima,f.OctaveBaselineM,f.OctaveBaselineB],!1)}return i/2}paintGrouped(e,t,n,i){const r=this.paintOttava(e,t,i),a=e+this.x+r+3;let l=t+this.y;if(l+=this._aboveStaff?2:this.height-2,n>a){let u=a;for(;u<n;)i.beginPath(),i.moveTo(u,0|l),i.lineTo(Math.min(u+8,n),0|l),u+=11,i.stroke();i.beginPath(),this._aboveStaff?(i.moveTo(n,l),i.lineTo(n,t+this.y+this.height)):(i.moveTo(n,l),i.lineTo(n,t+this.y)),i.stroke()}}}class cV extends gs{get effectId(){return"ottavia-"+(this._aboveStaff?"above":"below")}get notationElement(){return dt.EffectOttavia}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.GroupedOnBeat}constructor(e){super(),this._aboveStaff=e}shouldCreateGlyph(e,t){switch(t.ottava){case Ze._15ma:case Ze._8va:return this._aboveStaff;case Ze._8vb:case Ze._15mb:return!this._aboveStaff}return!1}createNewGlyph(e,t){return new Jse(t.ottava,this._aboveStaff)}canExpand(e,t){return e.ottava===t.ottava}}class Zse extends Uh{get notationElement(){return dt.EffectPalmMute}shouldCreateGlyphForNote(e){return e.isPalmMute}get sizingMode(){return It.GroupedOnBeat}createNewGlyph(e,t){return new zh("P.M.")}}class Qse extends Uh{get notationElement(){return dt.EffectPickSlide}shouldCreateGlyphForNote(e){return e.slideOutType===Qe.PickSlideDown||e.slideOutType===Qe.PickSlideUp}get sizingMode(){return It.GroupedOnBeat}createNewGlyph(e,t){return new zh("P.S.")}}class cm extends Us{constructor(e,t,n){super(e,t,Pn.GraceScale,cm.getSymbol(n))}paint(e,t,n){super.paint(e,t+this.height,n)}static getSymbol(e){switch(e){case yi.Up:return f.StringsUpBow;case yi.Down:return f.StringsDownBow;default:return f.None}}}class Kse extends gs{get notationElement(){return dt.EffectPickStroke}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return t.pickStroke!==yi.None}createNewGlyph(e,t){return new cm(0,0,t.pickStroke)}canExpand(e,t){return!0}}class uV extends Af{constructor(e){super(St.EndBeat),this._stepSize=0,this._type=e}doLayout(){switch(super.doLayout(),this._type){case Ft.Slight:this._stepSize=12;break;case Ft.Wide:this._stepSize=23}this.height=18}paintGrouped(e,t,n,i){let r=e+this.x;const a=Math.max(1,(n-r)/this._stepSize);i.beginPath(),i.moveTo(r,t+this.y);for(let l=0;l<a;l++)i.lineTo(r+this._stepSize/2,t+this.y+this.height),i.lineTo(r+this._stepSize,t+this.y),r+=this._stepSize;i.stroke()}}class hV extends gs{get notationElement(){return dt.EffectSlightBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===Ft.Slight}createNewGlyph(e,t){return new uV(Ft.Slight)}canExpand(e,t){return!0}}class ku extends Af{constructor(e,t,n,i=1.2,r=!1){super(St.EndBeat),this._scale=0,this._symbol=f.None,this._symbolSize=0,this._type=n,this._scale=i,this.x=e,this.y=t,this._partialWaves=r}doLayout(){switch(super.doLayout(),this._type){case Ft.Slight:this._symbol=f.WiggleTrill;break;case Ft.Wide:this._symbol=f.WiggleVibratoMediumFast}this._symbolSize=on.Widths.get(this._symbol)*this._scale,this.height=on.Heights.get(this._symbol)*this._scale}paintGrouped(e,t,n,i){const a=this._symbolSize;let l=(n-(e+this.x))/a;this._partialWaves||(l=Math.floor(l)),l<1&&(l=1);let c=0;for(let u=0;u<l;u++)i.fillMusicFontSymbol(e+this.x+c,t+this.y+2*this.height,this._scale,this._symbol,!1),c+=a}}class dV extends Uh{get notationElement(){return dt.EffectSlightNoteVibrato}shouldCreateGlyphForNote(e){let t=e.vibrato===Ft.Slight||e.isTieDestination&&e.tieOrigin.vibrato===Ft.Slight;return this._hideOnTiedBend&&t&&e.isTieDestination&&e.tieOrigin.hasBend&&(t=!1),t}get sizingMode(){return It.GroupedOnBeatToEnd}createNewGlyph(e,t){return new ku(0,0,Ft.Slight,1.2)}constructor(e){super(),this._hideOnTiedBend=e}}class eie extends gs{get notationElement(){return dt.EffectTap}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return t.slap||t.pop||t.tap}createNewGlyph(e,t){return new oo(0,0,t.slap?"S":t.pop?"P":"T",e.resources.effectFont,ye.Left)}canExpand(e,t){return!0}}class tie extends ro{constructor(e){super(0,0),this.tempoAutomations=e}doLayout(){super.doLayout(),this.height=25}paint(e,t,n){for(const i of this.tempoAutomations){let r=e+this.renderer.getRatioPositionX(i.ratioPosition);if(n.font=this.renderer.resources.markerFont,n.textBaseline=qe.Top,i.text){const a=n.measureText(i.text);n.fillText(i.text,r,t+this.y+n.font.size/2),r+=a.width+.7*n.font.size}n.fillMusicFontSymbol(r,t+this.y+.8*this.height,.5,f.NoteQuarterUp,!0),n.fillText(`= ${i.value.toString()}`,r+.5*on.Widths.get(f.NoteQuarterUp)+3,t+this.y+n.font.size/2)}}}class nie extends gs{get notationElement(){return dt.EffectTempo}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return It.SinglePreBeat}shouldCreateGlyph(e,t){return 0===t.voice.bar.staff.index&&0===t.voice.index&&0===t.index&&t.voice.bar.masterBar.tempoAutomations.length>0}createNewGlyph(e,t){return new tie(t.voice.bar.masterBar.tempoAutomations)}canExpand(e,t){return!0}}class sie extends gs{get notationElement(){return dt.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.text}createNewGlyph(e,t){return new oo(0,0,t.text,e.resources.effectFont,ye.Left)}canExpand(e,t){return!0}}class iie extends Af{constructor(e,t){super(St.EndBeat),this.x=e,this.y=t}doLayout(){super.doLayout(),this.height=on.Heights.get(f.OrnamentTrill)/2}paintGrouped(e,t,n,i){let r=e+this.x;i.fillMusicFontSymbol(r,t+this.y+this.height,1,f.OrnamentTrill,!0),r+=on.Widths.get(f.OrnamentTrill)/2;const a=1.2*on.Widths.get(f.WiggleTrill),l=Math.floor((n-r)/a),c=t+this.y+1.37*this.height;let u=r;for(let h=0;h<l;h++)i.fillMusicFontSymbol(u,c,1.2,f.WiggleTrill,!1),u+=a}}class fV extends Uh{get notationElement(){return dt.EffectTrill}shouldCreateGlyphForNote(e){return e.isTrill}get sizingMode(){return It.GroupedOnBeatToEnd}createNewGlyph(e,t){return new iie(0,0)}}let oie=(()=>{class s extends ro{constructor(t){super(0,0),this._tripletFeel=t}doLayout(){super.doLayout(),this.height=25}paint(t,n,i){t+=this.x;const r=(n+=this.y)+this.height*Pn.GraceScale,o=r+8;i.font=this.renderer.resources.effectFont,i.fillText("(",t,n+.3*this.height);const a=t+10,l=t+40;let c=[],u=[],h=[],d=[];switch(this._tripletFeel){case nt.NoTripletFeel:c=[f.TextBlackNoteLongStem,f.TextCont8thBeamLongStem,f.TextBlackNoteFrac8thLongStem],h=[f.TextBlackNoteLongStem,f.TextCont8thBeamLongStem,f.TextBlackNoteFrac8thLongStem];break;case nt.Triplet8th:c=[f.TextBlackNoteLongStem,f.TextCont8thBeamLongStem,f.TextBlackNoteFrac8thLongStem],h=[f.TextBlackNoteLongStem,f.Space,f.NoteEighthUp],d=[f.TextTupletBracketStartLongStem,f.TextTuplet3LongStem,f.TextTupletBracketEndLongStem];break;case nt.Triplet16th:c=[f.TextBlackNoteLongStem,f.TextCont8thBeamLongStem,f.TextBlackNoteFrac8thLongStem],h=[f.TextBlackNoteLongStem,f.TextCont8thBeamLongStem,f.TextBlackNoteFrac16thLongStem],d=[f.TextTupletBracketStartLongStem,f.TextTuplet3LongStem,f.TextTupletBracketEndLongStem];break;case nt.Dotted8th:c=[f.TextBlackNoteLongStem,f.TextCont8thBeamLongStem,f.TextBlackNoteFrac8thLongStem],u=[f.TextAugmentationDot],h=[f.TextBlackNoteLongStem,f.TextCont8thBeamLongStem,f.TextBlackNoteFrac16thLongStem];break;case nt.Dotted16th:c=[f.TextBlackNoteLongStem,f.TextCont16thBeamLongStem,f.TextBlackNoteFrac16thLongStem],u=[f.TextAugmentationDot],h=[f.TextBlackNoteLongStem,f.TextCont16thBeamLongStem,f.TextBlackNoteFrac32ndLongStem],i.fillCircle(l+9,r,1);break;case nt.Scottish8th:c=[f.TextBlackNoteLongStem,f.TextCont8thBeamLongStem,f.TextBlackNoteFrac8thLongStem],h=[f.TextBlackNoteLongStem,f.TextCont16thBeamLongStem,f.TextBlackNoteFrac8thLongStem,f.TextAugmentationDot];break;case nt.Scottish16th:c=[f.TextBlackNoteLongStem,f.TextCont16thBeamLongStem,f.TextBlackNoteFrac16thLongStem],h=[f.TextBlackNoteLongStem,f.TextCont32ndBeamLongStem,f.TextBlackNoteFrac16thLongStem,f.TextAugmentationDot]}i.fillMusicFontSymbols(a,r,s.NoteScale,c,!1),i.fillText("=",t+32,n+5),i.fillMusicFontSymbols(l,r,s.NoteScale,h,!1),u.length>0&&i.fillMusicFontSymbols(l+7,r,s.NoteScale,u,!1),d.length>0&&i.fillMusicFontSymbols(l,o,s.TupletScale,d,!1),i.fillText(")",t+65,n+.3*this.height)}}return s.NoteScale=.5,s.TupletScale=.7,s})();class aie extends gs{get notationElement(){return dt.EffectTripletFeel}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return It.SinglePreBeat}shouldCreateGlyph(e,t){return 0===t.index&&(0===t.voice.bar.masterBar.index&&t.voice.bar.masterBar.tripletFeel!==nt.NoTripletFeel||t.voice.bar.masterBar.index>0&&t.voice.bar.masterBar.tripletFeel!==t.voice.bar.masterBar.previousMasterBar.tripletFeel)}createNewGlyph(e,t){return new oie(t.voice.bar.masterBar.tripletFeel)}canExpand(e,t){return!0}}class lie extends gs{get notationElement(){return dt.EffectWhammyBar}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return It.GroupedOnBeat}shouldCreateGlyph(e,t){return t.hasWhammyBar}createNewGlyph(e,t){return new zh("w/bar")}canExpand(e,t){return!0}}class pV extends gs{get notationElement(){return dt.EffectWideBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===Ft.Wide}createNewGlyph(e,t){return new uV(Ft.Wide)}canExpand(e,t){return!0}}class gV extends Uh{get notationElement(){return dt.EffectWideNoteVibrato}shouldCreateGlyphForNote(e){return e.vibrato===Ft.Wide||e.isTieDestination&&e.tieOrigin.vibrato===Ft.Wide}get sizingMode(){return It.GroupedOnBeatToEnd}createNewGlyph(e,t){return new ku(0,0,Ft.Wide,1.2)}}class mV{constructor(){this.x=0,this.width=0,this.masterBars=[]}}class cie extends kc{constructor(){super(...arguments),this._system=null}get name(){return"HorizontalScreen"}get supportsResize(){return!1}get firstBarX(){let e=this.pagePadding[0];return this._system&&(e+=this._system.accoladeWidth),e}doResize(){}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case Lh.Automatic:this.systemsLayoutMode=Yo.Automatic;break;case Lh.UseModelLayout:this.systemsLayoutMode=Yo.FromModelWithWidths}const e=this.renderer.score;let t=this.renderer.settings.display.startBar;t--,t=Math.min(e.masterBars.length-1,Math.max(0,t));let n=t,i=this.renderer.settings.display.barCount;i<=0&&(i=e.masterBars.length),i=t+i-1,i=Math.min(e.masterBars.length-1,Math.max(0,i)),this._system=this.createEmptyStaffSystem(),this._system.isLast=!0,this._system.x=this.pagePadding[0],this._system.y=this.pagePadding[1];const r=this.renderer.settings.display.barCountPerPartial,o=[];let a=new mV,l=0;for(;n<=i;){const h=this.multiBarRestInfo,d=null!==h&&h.has(n)?h.get(n):null,p=this._system.addBars(this.renderer.tracks,n,d);if(0===a.masterBars.length&&p.isLinkedToPrevious&&o.length>0){const g=o[o.length-1];g.masterBars.push(e.masterBars[n]),g.width+=p.width,l+=p.width,a.x+=l}else a.masterBars.push(e.masterBars[n]),a.width+=p.width,a.masterBars.length>=r&&(0===o.length&&(a.width+=this._system.accoladeWidth+this.pagePadding[0]),l+=a.width,o.push(a),F.debug(this.name,`Finished partial from bar ${a.masterBars[0].index} to ${a.masterBars[a.masterBars.length-1].index}`,null),a=new mV,a.x=l);n++}a.masterBars.length>0&&(0===o.length&&(a.width+=this._system.accoladeWidth+this.pagePadding[0]),o.push(a),F.debug(this.name,`Finished partial from bar ${a.masterBars[0].index} to ${a.masterBars[a.masterBars.length-1].index}`,null)),this.finalizeStaffSystem();const c=this.renderer.settings.display.scale;this.height=Math.floor(this._system.y+this._system.height)*c,this.width=(this._system.x+this._system.width+this.pagePadding[2])*c,n=0;let u=0;for(let h=0;h<o.length;h++){const d=o[h],p=new Sc;p.x=u,p.y=0,p.totalWidth=this.width/c,p.totalHeight=this.height/c,p.width=d.width,p.height=this.height/c,p.firstMasterBarIndex=d.masterBars[0].index,p.lastMasterBarIndex=d.masterBars[d.masterBars.length-1].index,u+=d.width;const g=n,m=h;this._system.buildBoundingsLookup(0,0),this.registerPartial(p,_=>{let y=this._system.getBarX(d.masterBars[0].index)+this._system.accoladeWidth;0===m&&(y-=this._system.x+this._system.accoladeWidth),_.color=this.renderer.settings.display.resources.mainGlyphColor,_.textAlign=ye.Left,F.debug(this.name,`Rendering partial from bar ${d.masterBars[0].index} to ${d.masterBars[d.masterBars.length-1].index}`,null),this._system.paintPartial(-y,this._system.y,_,g,d.masterBars.length)}),n+=d.masterBars.length}this.height=this.layoutAndRenderBottomScoreInfo(this.height),this.height=this.layoutAndRenderAnnotation(this.height),this.height+=this.pagePadding[3]}finalizeStaffSystem(){this._system.scaleToWidth(this._system.width),this._system.finalizeSystem()}}class uie extends kc{constructor(){super(...arguments),this._systems=[],this._allMasterBarRenderers=[],this._barsFromPreviousSystem=[]}get name(){return"PageView"}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case Lh.Automatic:this.systemsLayoutMode=Yo.Automatic;break;case Lh.UseModelLayout:this.systemsLayoutMode=Yo.FromModelWithScale}let e=this.pagePadding[1];this.width=this.renderer.width,this._allMasterBarRenderers=[],e=this.layoutAndRenderScoreInfo(e,-1),e=this.layoutAndRenderTunings(e,-1),e=this.layoutAndRenderChordDiagrams(e,-1),e=this.layoutAndRenderScore(e),e=this.layoutAndRenderBottomScoreInfo(e),e=this.layoutAndRenderAnnotation(e),this.height=(e+this.pagePadding[3])*this.renderer.settings.display.scale}get supportsResize(){return!0}get firstBarX(){let e=this.pagePadding[0];return this._systems.length>0&&(e+=this._systems[0].accoladeWidth),e}doResize(){let e=this.pagePadding[1];this.width=this.renderer.width;const t=this.height;e=this.layoutAndRenderScoreInfo(e,t),e=this.layoutAndRenderTunings(e,t),e=this.layoutAndRenderChordDiagrams(e,t),e=this.resizeAndRenderScore(e,t),e=this.layoutAndRenderBottomScoreInfo(e),e=this.layoutAndRenderAnnotation(e),this.height=(e+this.pagePadding[3])*this.renderer.settings.display.scale}layoutAndRenderTunings(e,t=-1){if(!this.tuningGlyph)return e;const n=this.renderer.settings.display.resources;this.tuningGlyph.x=this.pagePadding[0],this.tuningGlyph.width=this.scaledWidth,this.tuningGlyph.doLayout();const i=Math.round(this.tuningGlyph.height),r=new Sc;return r.x=0,r.y=e,r.width=this.scaledWidth,r.height=i,r.totalWidth=this.scaledWidth,r.totalHeight=t<0?e+r.height:t,this.registerPartial(r,o=>{o.color=n.scoreInfoColor,o.textAlign=ye.Center,this.tuningGlyph.paint(0,0,o)}),e+i}layoutAndRenderChordDiagrams(e,t=-1){if(!this.chordDiagrams)return e;const n=this.renderer.settings.display.resources;this.chordDiagrams.width=this.scaledWidth,this.chordDiagrams.doLayout();const i=Math.round(this.chordDiagrams.height),r=new Sc;return r.x=0,r.y=e,r.width=this.scaledWidth,r.height=i,r.totalWidth=this.scaledWidth,r.totalHeight=t<0?e+i:t,this.registerPartial(r,o=>{o.color=n.scoreInfoColor,o.textAlign=ye.Center,this.chordDiagrams.paint(0,0,o)}),e+i}layoutAndRenderScoreInfo(e,t=-1){F.debug(this.name,"Layouting score info");const n=new Sc;n.x=0,n.y=e;let i=0;const r=this.renderer.settings.display.resources,o=[];for(const[a,l]of kc.HeaderElements.value)if(this.headerGlyphs.has(a)){const c=this.headerGlyphs.get(a);c.y=i,this.alignScoreInfoGlyph(c);let u=c.font.size;a===re.Words&&this.headerGlyphs.has(re.Music)&&this.headerGlyphs.get(re.Music).textAlign!==c.textAlign&&(u=0),i+=u,o.push(c)}return o.length>0&&(i=Math.floor(i+17),n.width=this.scaledWidth,n.height=i,n.totalWidth=this.scaledWidth,n.totalHeight=t<0?e+n.height:t,this.registerPartial(n,a=>{a.color=r.scoreInfoColor,a.textAlign=ye.Center;for(const l of o)l.paint(0,0,a)})),e+i}resizeAndRenderScore(e,t){if(this.renderer.settings.display.barsPerRow>0||this.systemsLayoutMode===Yo.FromModelWithScale)for(let i=0;i<this._systems.length;i++){const r=this._systems[i];this.fitSystem(r),e+=this.paintSystem(r,t)}else{this._systems=[];let i=0;const r=this.maxWidth;let o=this.createEmptyStaffSystem();for(o.index=this._systems.length,o.x=this.pagePadding[0],o.y=e;i<this._allMasterBarRenderers.length;){let a=this._allMasterBarRenderers[i];if(o.width+a.width<=r||0===o.masterBarsRenderers.length)o.addMasterBarRenderers(this.renderer.tracks,a),i++;else{for(;a&&!a.canWrap&&o.masterBarsRenderers.length>1;)a=o.revertLastBar(),i--;o.isFull=!0,o.isLast=this.lastBarIndex===o.lastBarIndex,this._systems.push(o),this.fitSystem(o),e+=this.paintSystem(o,t),o=this.createEmptyStaffSystem(),o.index=this._systems.length,o.x=this.pagePadding[0],o.y=e}}o.isLast=this.lastBarIndex===o.lastBarIndex,this.fitSystem(o),e+=this.paintSystem(o,t)}return e}layoutAndRenderScore(e){let n=this.firstBarIndex;const i=this.lastBarIndex;for(this._systems=[];n<=i;){const r=this.createStaffSystem(n,i);this._systems.push(r),r.x=this.pagePadding[0],r.y=e,n=r.lastBarIndex+1,this.fitSystem(r),F.debug(this.name,`Rendering partial from bar ${r.firstBarIndex} to ${r.lastBarIndex}`,null),e+=this.paintSystem(r,e)}return e}paintSystem(e,t){const n=Math.floor(e.height),i=new Sc;return i.x=0,i.y=e.y,i.totalWidth=this.scaledWidth,i.totalHeight=t,i.width=this.scaledWidth,i.height=n,i.firstMasterBarIndex=e.firstBarIndex,i.lastMasterBarIndex=e.lastBarIndex,e.buildBoundingsLookup(0,0),this.registerPartial(i,r=>{this.renderer.canvas.color=this.renderer.settings.display.resources.mainGlyphColor,this.renderer.canvas.textAlign=ye.Left,e.paint(0,-i.y/this.renderer.settings.display.scale,r)}),n}fitSystem(e){e.scaleToWidth(e.isFull||e.width>this.maxWidth||this.renderer.settings.display.justifyLastSystem?this.maxWidth:e.width),e.finalizeSystem()}getBarsPerSystem(e){let t=this.renderer.settings.display.barsPerRow;if(this.systemsLayoutMode===Yo.FromModelWithScale){let n,i;this.renderer.tracks.length>1?(n=this.renderer.score.defaultSystemsLayout,i=this.renderer.score.systemsLayout):(n=this.renderer.tracks[0].defaultSystemsLayout,i=this.renderer.tracks[0].systemsLayout),t=e<i.length?i[e]:n}return t}createStaffSystem(e,t){const n=this.createEmptyStaffSystem();n.index=this._systems.length;const i=this.getBarsPerSystem(n.index),r=this.maxWidth,o=t+1;let a=e;for(;a<o;){if(this._barsFromPreviousSystem.length>0)for(const h of this._barsFromPreviousSystem)n.addMasterBarRenderers(this.renderer.tracks,h),a=h.lastMasterBarIndex;else{const h=this.multiBarRestInfo,d=null!==h&&h.has(a)?h.get(a):null,p=n.addBars(this.renderer.tracks,a,d);this._allMasterBarRenderers.push(p),a=p.lastMasterBarIndex}this._barsFromPreviousSystem=[];let l=!1;if((-1===i&&n.width>=r&&0!==n.masterBarsRenderers.length||n.masterBarsRenderers.length===i+1)&&(l=!0),l){let h=n.revertLastBar();if(h)for(this._barsFromPreviousSystem.push(h);h&&!h.canWrap&&n.masterBarsRenderers.length>1;)h=n.revertLastBar(),h&&this._barsFromPreviousSystem.push(h);return n.isFull=!0,n.isLast=!1,this._barsFromPreviousSystem.reverse(),n}let c=!1,u=!0;for(const h of this.renderer.tracks)h.lineBreaks&&h.lineBreaks.has(a+1)?c=!0:u=!1;if(c&&u)return n.isFull=!0,n.isLast=!1,n;n.x=0,a++}return n.isLast=t===n.lastBarIndex,n}get maxWidth(){return this.scaledWidth-this.pagePadding[0]-this.pagePadding[2]}}class Ml extends Us{constructor(e,t,n,i){super(e,t,i,Ml.getMusicSymbol(n))}static getMusicSymbol(e){switch(e){case Be.Natural:return f.AccidentalNatural;case Be.Sharp:return f.AccidentalSharp;case Be.Flat:return f.AccidentalFlat;case Be.NaturalQuarterNoteUp:return f.AccidentalQuarterToneNaturalArrowUp;case Be.SharpQuarterNoteUp:return f.AccidentalQuarterToneSharpArrowUp;case Be.FlatQuarterNoteUp:return f.AccidentalQuarterToneFlatArrowUp;case Be.DoubleSharp:return f.AccidentalDoubleSharp;case Be.DoubleFlat:return f.AccidentalDoubleFlat}return f.None}}class ax extends Us{constructor(e,t,n,i){super(e,t,1,ax.getSymbol(n)),this._clef=n,this._clefOttava=i}static getSymbol(e){switch(e){case Et.Neutral:return f.UnpitchedPercussionClef1;case Et.C3:case Et.C4:return f.CClef;case Et.F4:return f.FClef;case Et.G2:return f.GClef;default:return f.None}}paint(e,t,n){const i=yt.bar(n,Ht.StandardNotationClef,this.renderer.bar);try{super.paint(e,t,n);let r,o=!1;switch(this._clefOttava){case Ze._15ma:r=new Us(-4,0,.5,f.Quindicesima),o=!0;break;case Ze._8va:r=new Us(-2,0,.5,f.Ottava),o=!0;break;case Ze._8vb:r=new Us(-6,0,.5,f.Ottava);break;case Ze._15mb:r=new Us(-8,0,.5,f.Quindicesima);break;default:return}let a=0,l=0;switch(this._clef){case Et.Neutral:a=o?-12:15,l=0;break;case Et.C3:case Et.C4:a=o?-19:27,l=0;break;case Et.F4:a=o?-9:27,l=-4;break;case Et.G2:a=o?-37:30,l=0;break;default:return}r.renderer=this.renderer,r.doLayout(),r.paint(e+this.x+this.width/2+l,t+this.y+a,n)}finally{i?.[Symbol.dispose]?.()}}}class um extends ro{constructor(e,t,n){super(e,t),this._note=n}static getSymbol(e,t){switch(e){case Ss.None:return f.None;case Ss.Normal:return t?f.ArticAccentAbove:f.ArticAccentBelow;case Ss.Heavy:return t?f.ArticMarcatoAbove:f.ArticMarcatoBelow;case Ss.Tenuto:return t?f.ArticTenutoAbove:f.ArticTenutoBelow;default:return f.None}}doLayout(){this.width=on.Widths.get(f.ArticAccentAbove),this.height=on.Heights.get(f.ArticAccentAbove)}paint(e,t,n){const i=this.renderer.getBeatDirection(this._note.beat),r=um.getSymbol(this._note.accentuated,i===V.Down);n.fillMusicFontSymbol(e+this.x-2,i===V.Up?t+this.y:t+this.y+this.height-2,1,r,!1)}}class hm extends os{constructor(e,t,n){super(e,t),this._size=0,this._size=n}doLayout(){this.width=this._size+3}paint(e,t,n){const i=n.color;this.colorOverride&&(n.color=this.colorOverride),n.fillCircle(e+this.x,t+this.y,this._size),n.color=i}}class hie extends Us{constructor(e,t,n){super(e,t,n?Pn.GraceScale:1,f.NoteheadXOrnate)}}class zw extends Us{constructor(e,t,n,i){super(e,t,i?Pn.GraceScale:1,zw.getSymbol(n))}static getSymbol(e){switch(e){case w.QuadrupleWhole:case w.DoubleWhole:case w.Whole:case w.Half:return f.NoteheadDiamondWhiteWide;default:return f.NoteheadDiamondBlackWide}}}let Xo=(()=>{class s extends os{constructor(t,n,i){super(0,0),this.yOffset=0,this.startNoteRenderer=null,this.endNoteRenderer=null,this.tieDirection=V.Up,this._startX=0,this._startY=0,this._endX=0,this._endY=0,this._tieHeight=0,this._shouldDraw=!1,this.startBeat=t,this.endBeat=n,this.forEnd=i}doLayout(){if(this.width=0,!this.endBeat)return void(this._shouldDraw=!1);const t=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar);this.startNoteRenderer=t;const n=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.endBeat.voice.bar);if(this.endNoteRenderer=n,this._startX=0,this._endX=0,this._startY=0,this._endY=0,this.height=0,this._shouldDraw=!1,this.tieDirection=t?this.getBeamDirection(this.startBeat,t):this.getBeamDirection(this.endBeat,n),!this.forEnd&&t?(t!==n?(this._startX=t.x+this.getStartX(),this._startY=t.y+this.getStartY()+this.yOffset,n&&t.staff===n.staff?(this._endX=n.x+this.getEndX(),this._endY=n.y+this.getEndY()+this.yOffset):(this._endX=t.x+t.width,this._endY=this._startY)):(this._startX=t.x+this.getStartX(),this._endX=n.x+this.getEndX(),this._startY=t.y+this.getStartY()+this.yOffset,this._endY=n.y+this.getEndY()+this.yOffset),this._shouldDraw=!0):(!t||t.staff!==n.staff)&&(this._startX=n.x,this._endX=n.x+this.getEndX(),this._startY=n.y+this.getEndY()+this.yOffset,this._endY=this._startY,this._shouldDraw=!0),this._shouldDraw)if(this.y=Math.min(this._startY,this._endY),this.shouldDrawBendSlur())this._tieHeight=0;else{this._tieHeight=this.getTieHeight(this._startX,this._startY,this._endX,this._endY);const i=s.calculateActualTieHeight(1,this._startX,this._startY,this._endX,this._endY,this.tieDirection===V.Down,this._tieHeight,4);if(this.height=i.h,this.tieDirection===V.Up){const r=this.y-i.y;r>0&&(this.y-=r)}}}paint(t,n,i){this._shouldDraw&&(this.shouldDrawBendSlur()?s.drawBendSlur(i,t+this._startX,n+this._startY,t+this._endX,n+this._endY,this.tieDirection===V.Down,1):s.paintTie(i,1,t+this._startX,n+this._startY,t+this._endX,n+this._endY,this.tieDirection===V.Down,this._tieHeight,4))}shouldDrawBendSlur(){return!1}getTieHeight(t,n,i,r){return 22}getBeamDirection(t,n){return V.Down}getStartY(){return 0}getEndY(){return 0}getStartX(){return 0}getEndX(){return 0}static calculateActualTieHeight(t,n,i,r,o,a,l,c){const u=s.computeBezierControlPoints(t,n,i,r,o,a,l,c),h=u[2],d=u[3],g=s.calculateExtrema(n=u[0],i=u[1],h,d,r=u[6],o=u[7],(n-h)/(n-2*h+r)),m=g.length>0?Math.min(n,r,g[0]):Math.min(n,r),_=g.length>0?Math.max(n,r,g[0]):Math.max(n,r),b=s.calculateExtrema(n,i,h,d,r,o,(i-d)/(i-2*d+o)),S=b.length>0?Math.min(i,o,b[1]):Math.min(i,o),D=b.length>0?Math.max(i,o,b[1]):Math.max(i,o),T=new bi;return T.x=m,T.y=S,T.w=_-m,T.h=D-S,T}static calculateExtrema(t,n,i,r,o,a,l){if(l<=0||1<=l)return[];const c=t+(i-t)*l,u=n+(r-n)*l;return[c+(i+(o-i)*l-c)*l,u+(r+(a-r)*l-u)*l]}static computeBezierControlPoints(t,n,i,r,o,a,l,c){if(n===r&&i===o)return[];if(r<n){let S=n;n=r,r=S,S=i,i=o,o=S}l*=t,c*=t;let u=o-i,h=r-n;const d=Math.sqrt(u*u+h*h);a?u*=-1:h*=-1,u/=d,h/=d;const p=(r+n)/2,g=(o+i)/2;return[n,i,p+l*u,g+l*h,p+(l-c)*u,g+(l-c)*h,r,o]}static paintTie(t,n,i,r,o,a,l=!1,c=22,u=4){const h=s.computeBezierControlPoints(n,i,r,o,a,l,c,u);t.beginPath(),t.moveTo(h[0],h[1]),t.quadraticCurveTo(h[2],h[3],h[6],h[7]),t.quadraticCurveTo(h[4],h[5],h[0],h[1]),t.closePath(),t.fill()}static drawBendSlur(t,n,i,r,o,a,l,c){let u=o-i,h=r-n;const d=Math.sqrt(u*u+h*h);a?u*=-1:h*=-1,u/=d,h/=d;let m=s.BendSlurHeight*l;r-n<20&&(m/=2);const _=(r+n)/2+m*u,y=(o+i)/2+m*h;if(t.beginPath(),t.moveTo(n,i),t.lineTo(_,y),t.lineTo(r,o),t.stroke(),c){const b=t.measureText(c).width;t.fillText(c,_-b/2,y+(a?0:-t.font.size))}}}return s.BendSlurHeight=11,s})(),lx=(()=>{class s extends os{constructor(t){super(0,0),this._isOpen=t}doLayout(){super.doLayout(),this.width=s.Size}paint(t,n,i){const r=i.color;this.colorOverride&&(i.color=this.colorOverride),this._isOpen?Xo.paintTie(i,1,t+this.x+this.width,n+this.y+this.height,t+this.x+this.width,n+this.y,!1,6,3):Xo.paintTie(i,1,t+this.x,n+this.y,t+this.x,n+this.y+this.height,!1,6,3),i.color=r}}return s.Size=6,s})();class yV{constructor(e,t,n){this.line=0,this.line=e,this.isGhost=t,this.color=n}}class qw extends os{constructor(e){super(0,0),this._infos=[],this._glyphs=[],this.isEmpty=!0,this._isOpen=e}addParenthesis(e){const t=this.renderer,n=t.getNoteLine(e),i=e.isGhost||this.isTiedBend(e)&&t.settings.notation.isNotationElementVisible(dt.ParenthesisOnTiedBends),r=yt.noteColor(t.resources,Qi.Effects,e);this.add(new yV(n,i,r))}addParenthesisOnLine(e,t){const n=new yV(e,t,void 0);this.add(n)}add(e){this._infos.push(e),e.isGhost&&(this.isEmpty=!1)}isTiedBend(e){return!!e.isTieDestination&&(!!e.tieOrigin.hasBend||this.isTiedBend(e.tieOrigin))}doLayout(){const e=this.renderer;this._infos.sort((i,r)=>i.line-r.line);let t=null;const n=e.getScoreHeight(1);for(let i=0,r=this._infos.length;i<r;i++){let o;if(this._infos[i].isGhost)if(t){const a=e.getScoreY(this._infos[i].line)+n;t.height=a-t.y}else o=new lx(this._isOpen),o.colorOverride=this._infos[i].color,o.renderer=this.renderer,o.y=e.getScoreY(this._infos[i].line)-n,o.height=2*n,o.doLayout(),this._glyphs.push(o),t=o;else t=null}this.width=this._glyphs.length>0?this._glyphs[0].width:0}paint(e,t,n){super.paint(e,t,n);for(const i of this._glyphs)i.paint(e+this.x,t+this.y,n)}}class die{constructor(e,t){this.steps=0,this.glyph=e,this.steps=t}}class _V extends os{constructor(){super(0,0),this._infos=[],this._noteHeadPadding=0,this.minNote=null,this.maxNote=null,this.spacingChanged=new ks,this.upLineX=0,this.downLineX=0,this.displacedX=0,this.noteStartX=0}add(e,t){const n=new die(e,t);this._infos.push(n),(!this.minNote||this.minNote.steps>n.steps)&&(this.minNote=n),(!this.maxNote||this.maxNote.steps<n.steps)&&(this.maxNote=n)}doLayout(){this._infos.sort((a,l)=>l.steps-a.steps);let e=0,t=!1,n=0,i=!1;const r=this.direction;let o=0;for(let a=0,l=this._infos.length;a<l;a++){const c=this._infos[a].glyph;c.renderer=this.renderer,c.doLayout();let u=!1;0===a?e=c.width:Math.abs(n-this._infos[a].steps)<=1?t?t=!1:(u=!0,c.x=e,i=!0,t=!0):t=!1,c.x=r===V.Down?u?0:e:u?e:0,c.x+=this.noteStartX,n=this._infos[a].steps,o=Math.max(o,c.x+c.width),c instanceof Pn&&c.centerOnStem&&(c.x=e)}i?(this._noteHeadPadding=0,this.upLineX=e,this.downLineX=e):(this._noteHeadPadding=r===V.Down?-e:0,o+=this._noteHeadPadding,this.upLineX=o,this.downLineX=0),this.displacedX=e,this.width=o}paint(e,t,n){this.paintLedgerLines(e+=this.x,t+=this.y,n);const i=this._infos,r=e+this._noteHeadPadding;for(const o of i)o.glyph.renderer=this.renderer,o.glyph.paint(r,t,n)}paintLedgerLines(e,t,n){if(!this.minNote)return;const i=this.renderer,r=yt.bar(n,Ht.StandardNotationStaffLine,i.bar,!0);try{const a=this.width-this.noteStartX+6,l=i.getLineHeight(1),c=i.getLineY(-1),u=i.getLineY(i.drawnLineCount),h=i.getLineY(this.minNote.steps/2),d=i.getLineY(this.maxNote.steps/2);let p=c;for(;p>=h;)n.fillRect(e-3+this.noteStartX,t+p|0,a,ss.StaffLineThickness),p-=l;for(p=u;p<=d;)n.fillRect(e-3+this.noteStartX,t+p|0,a,ss.StaffLineThickness),p+=l}finally{r?.[Symbol.dispose]?.()}}}class $w extends Us{constructor(e,t,n){super(e,t,1,$w.getSymbol(n))}static getSymbol(e){switch(e){case w.ThirtySecond:return f.Tremolo3;case w.Sixteenth:return f.Tremolo2;case w.Eighth:return f.Tremolo1;default:return f.None}}}class jw extends os{constructor(){super(0,0)}doLayout(){this.width=26}paint(e,t,n){const i=this.renderer,r=i.getLineHeight(i.heightLineCount-1),l=i.getLineY(0)+i.getLineHeight(i.drawnLineCount-1)/2-r/2,c=n.lineWidth;n.lineWidth=2,n.moveTo(e+this.x,t+l),n.lineTo(e+this.x+this.width,t+l+r),n.moveTo(e+this.x,t+l+r),n.lineTo(e+this.x+this.width,t+l),n.stroke(),n.lineWidth=c}}class fie extends _V{constructor(){super(...arguments),this._noteGlyphLookup=new Map,this._notes=[],this._deadSlapped=null,this._tremoloPicking=null,this.aboveBeatEffects=new Map,this.belowBeatEffects=new Map}get direction(){return this.beamingHelper.direction}getNoteX(e,t){if(this._noteGlyphLookup.has(e.id)){const n=this._noteGlyphLookup.get(e.id);let i=this.x+n.x+this._noteHeadPadding;switch(t){case Un.Left:break;case Un.Center:i+=n.width/2;break;case Un.Right:i+=n.width}return i}return 0}getNoteY(e,t){if(this._noteGlyphLookup.has(e.id)){const n=this._noteGlyphLookup.get(e.id);let i=this.y+n.y;switch(t){case be.TopWithStem:i-=this.renderer.getStemSize(this.beamingHelper);break;case be.Top:i-=n.height/2;break;case be.Center:break;case be.Bottom:i+=n.height/2;break;case be.BottomWithStem:i+=this.renderer.getStemSize(this.beamingHelper)}return i}return 0}addNoteGlyph(e,t,n){super.add(e,n),this._noteGlyphLookup.set(t.id,e),this._notes.push(t)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.upLineX,e+this.x+this.downLineX)}doLayout(){super.doLayout();const e=this.renderer;this.beat.deadSlapped&&(this._deadSlapped=new jw,this._deadSlapped.renderer=this.renderer,this._deadSlapped.doLayout(),this.width=this._deadSlapped.width);const t=this.direction;let n=0,i=0,r=1,o=-r,a=!1,l=!1;this.beat.deadSlapped?(i=e.getScoreY(0),n=e.getScoreY(e.heightLineCount)):this.direction===V.Up?(a=!1,l=!0,i=e.getScoreY(this.maxNote.steps+2),n=e.getScoreY(this.minNote.steps)-e.getStemSize(this.beamingHelper,!0)):(a=!0,l=!1,i=e.getScoreY(this.minNote.steps-1),r*=-1,o*=-1,n=e.getScoreY(this.maxNote.steps)+e.getStemSize(this.beamingHelper,!0));let c=null,u=null;for(const h of this.aboveBeatEffects.values())h.renderer=this.renderer,h.doLayout(),l&&(n+=o*h.height),h.y=n,(null===c||c>n)&&(c=n),(null===u||u<n)&&(u=n),l||(n+=o*h.height);for(const h of this.belowBeatEffects.values())h.renderer=this.renderer,h.doLayout(),a&&(i+=r*h.height),h.y=i,(null===c||c>i)&&(c=i),(null===u||u<i)&&(u=i),a||(i+=r*h.height);if(null!==c&&e.registerBeatEffectOverflows(c,u??0),this.beat.isTremolo&&!this.beat.deadSlapped){let h=0;const d=t===V.Up?this.minNote:this.maxNote;let p=t===V.Up?this.upLineX:this.downLineX;const g=this.beat.tremoloSpeed;switch(g){case w.ThirtySecond:h=t===V.Up?-15:15;break;case w.Sixteenth:h=t===V.Up?-12:15;break;case w.Eighth:h=t===V.Up?-10:10;break;default:h=t===V.Up?-10:15}this.beat.duration<w.Half&&(p=this.width/2),this._tremoloPicking=new $w(p,d.glyph.y+h,g),this._tremoloPicking.renderer=this.renderer,this._tremoloPicking.doLayout()}}buildBoundingsLookup(e,t,n){for(const i of this._notes)if(this._noteGlyphLookup.has(i.id)){const r=this._noteGlyphLookup.get(i.id),o=new Bf;o.note=i,o.noteHeadBounds=new bi,o.noteHeadBounds.x=t+this.x+this._noteHeadPadding+r.x,o.noteHeadBounds.y=n+this.y+r.y-r.height/2,o.noteHeadBounds.w=r.width,o.noteHeadBounds.h=r.height,e.addNote(o)}}paint(e,t,n){this.paintEffects(e,t,n),super.paint(e,t,n)}paintEffects(e,t,n){const i=yt.beat(n,In.StandardNotationEffects,this.beat);try{for(const r of this.aboveBeatEffects.values())r.paint(e+this.x+2,t+this.y,n);for(const r of this.belowBeatEffects.values())r.paint(e+this.x+2,t+this.y,n);this._tremoloPicking&&this._tremoloPicking.paint(e,t,n),this._deadSlapped&&this._deadSlapped.paint(e,t,n)}finally{i?.[Symbol.dispose]?.()}}}class dm extends Us{constructor(e,t,n){super(e,t,1,dm.getSymbol(n))}static getSymbol(e){switch(e){case w.QuadrupleWhole:return f.RestLonga;case w.DoubleWhole:return f.RestDoubleWhole;case w.Whole:return f.RestWhole;case w.Half:return f.RestHalf;case w.Quarter:return f.RestQuarter;case w.Eighth:return f.RestEighth;case w.Sixteenth:return f.RestSixteenth;case w.ThirtySecond:return f.RestThirtySecond;case w.SixtyFourth:return f.RestSixtyFourth;case w.OneHundredTwentyEighth:return f.RestOneHundredTwentyEighth;case w.TwoHundredFiftySixth:return f.RestTwoHundredFiftySixth;default:return f.None}}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,n){this.internalPaint(e,t,n,In.StandardNotationRests)}internalPaint(e,t,n,i){const r=yt.beat(n,i,this.beat);try{super.paint(e,t,n)}finally{r?.[Symbol.dispose]?.()}}}class bV{constructor(){this.x=0,this.y=-3e3,this.width=0}}class cx extends $a{constructor(){super(0,0)}doLayout(){if(!this.glyphs||0===this.glyphs.length)return void(this.width=0);this.glyphs.sort((n,i)=>n.y<i.y?-1:n.y>i.y?1:0);const e=[];e.push(new bV);for(let n=0,i=this.glyphs.length;n<i;n++){const r=this.glyphs[n];r.renderer=this.renderer,r.doLayout();let o=0;for(;e[o].y>r.y;)o++,o===e.length&&e.push(new bV);r.x=o,e[o].y=r.y+21,e[o].width<r.width&&(e[o].width=r.width)}this.width=0;for(const n of e)this.width+=n.width,n.x=this.width;for(let n=0,i=this.glyphs.length;n<i;n++){const r=this.glyphs[n];r.x=this.width-e[r.x].x}}}let Cu=(()=>{class s extends _V{get direction(){return V.Up}constructor(t,n=!1){super(),this._showParenthesis=!1,this._noteValueLookup=new Map,this._accidentals=new cx,this._preNoteParenthesis=null,this._postNoteParenthesis=null,this.isEmpty=!0,this.noteHeadOffset=0,this._beat=t,this._showParenthesis=n,n&&(this._preNoteParenthesis=new qw(!0),this._postNoteParenthesis=new qw(!1))}containsNoteValue(t){return this._noteValueLookup.has(t)}getNoteValueY(t){return this._noteValueLookup.has(t)?this.y+this._noteValueLookup.get(t).y:0}addGlyph(t,n,i){const r=this.renderer,o=new Pn(0,0,w.Quarter,!0),a=r.accidentalHelper.applyAccidentalForValue(this._beat,t,n,!0),l=r.accidentalHelper.getNoteLineForValue(t,!1);if(o.y=r.getScoreY(l),this._showParenthesis&&(this._preNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.addParenthesisOnLine(l,!0),this._postNoteParenthesis.addParenthesisOnLine(l,!0)),a!==Be.None){const c=new Ml(0,o.y,a,Pn.GraceScale);c.renderer=this.renderer,this._accidentals.renderer=this.renderer,this._accidentals.addGlyph(c)}this._noteValueLookup.set(t,o),this.add(o,l),this.isEmpty=!1}doLayout(){let t=0;this._showParenthesis&&(this._preNoteParenthesis.x=t,this._preNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.doLayout(),t+=this._preNoteParenthesis.width+s.ElementPadding),this._accidentals.isEmpty||(t+=this._accidentals.width+s.ElementPadding,this._accidentals.x=t,this._accidentals.renderer=this.renderer,this._accidentals.doLayout(),t+=this._accidentals.width+s.ElementPadding),this.noteStartX=t,super.doLayout(),this.noteHeadOffset=this.noteStartX+(this.width-this.noteStartX)/2,this._showParenthesis&&(this._postNoteParenthesis.x=this.width+s.ElementPadding,this._postNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.doLayout(),this.width+=this._postNoteParenthesis.width+s.ElementPadding)}paint(t,n,i){this._accidentals.isEmpty||this._accidentals.paint(t+this.x,n+this.y,i),this._showParenthesis&&(this._preNoteParenthesis.paint(t+this.x,n+this.y,i),this._postNoteParenthesis.paint(t+this.x,n+this.y,i)),super.paint(t,n,i)}}return s.ElementPadding=2,s})(),wV=(()=>{class s extends os{constructor(){super(...arguments),this.BendNoteHeads=[]}drawBendSlur(t,n,i,r,o,a,l,c){Xo.drawBendSlur(t,n,i,r,o,a,l,c)}doLayout(){super.doLayout(),this.width=0;for(const t of this.BendNoteHeads)t.doLayout(),this.width+=t.width+10}getTieDirection(t,n){return n.getBeatDirection(t)===V.Up?V.Down:V.Up}}return s.EndPadding=8,s})();class Du extends se{constructor(e=0,t=0){super(e,t),this.lineValue=0,this.lineValue=t}}let SV=(()=>{class s extends os{constructor(){super(0,0),this._notes=[],this._renderPoints=new Map,this._preBendMinValue=-1,this._bendMiddleMinValue=-1,this._bendEndMinValue=-1,this._bendEndContinuedMinValue=-1,this._releaseMinValue=-1,this._releaseContinuedMinValue=-1,this._maxBendValue=-1}addBends(t){this._notes.push(t);const n=this.createRenderingPoints(t);this._renderPoints.set(t.id,n),(-1===this._maxBendValue||this._maxBendValue<t.maxBendPoint.value)&&(this._maxBendValue=t.maxBendPoint.value);let i=0;switch(t.bendType){case me.Bend:i=n[1].value,t.isTieOrigin?(-1===this._bendEndContinuedMinValue||i<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=i):(-1===this._bendEndMinValue||i<this._bendEndMinValue)&&(this._bendEndMinValue=i);break;case me.Release:i=n[1].value,t.isTieOrigin?(-1===this._releaseContinuedMinValue||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(-1===this._releaseMinValue||i<this._releaseMinValue)&&(this._releaseMinValue=i);break;case me.BendRelease:i=n[1].value,(-1===this._bendMiddleMinValue||i<this._bendMiddleMinValue)&&(this._bendMiddleMinValue=i),i=n[2].value,t.isTieOrigin?(-1===this._releaseContinuedMinValue||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(-1===this._releaseMinValue||i<this._releaseMinValue)&&(this._releaseMinValue=i);break;case me.Prebend:i=n[0].value,(-1===this._preBendMinValue||i<this._preBendMinValue)&&(this._preBendMinValue=i);break;case me.PrebendBend:i=n[0].value,(-1===this._preBendMinValue||i<this._preBendMinValue)&&(this._preBendMinValue=i),i=n[1].value,t.isTieOrigin?(-1===this._bendEndContinuedMinValue||i<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=i):(-1===this._bendEndMinValue||i<this._bendEndMinValue)&&(this._bendEndMinValue=i);break;case me.PrebendRelease:i=n[0].value,(-1===this._preBendMinValue||i<this._preBendMinValue)&&(this._preBendMinValue=i),i=n[1].value,t.isTieOrigin?(-1===this._releaseContinuedMinValue||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(-1===this._releaseMinValue||i<this._releaseMinValue)&&(this._releaseMinValue=i)}}doLayout(){super.doLayout(),this.renderer.registerOverflowTop(this._maxBendValue*s.BendValueHeight);let n=0;for(const i of this._notes){const r=this._renderPoints.get(i.id);switch(i.bendType){case me.Bend:r[1].lineValue=i.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case me.Release:n=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,n>=0&&(r[1].lineValue=n);break;case me.BendRelease:r[1].lineValue=this._bendMiddleMinValue,n=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,n>=0&&(r[2].lineValue=n);break;case me.Prebend:r[0].lineValue=this._preBendMinValue;break;case me.PrebendBend:r[0].lineValue=this._preBendMinValue,r[1].lineValue=i.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case me.PrebendRelease:r[0].lineValue=this._preBendMinValue,n=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,n>=0&&(r[1].lineValue=n)}}this.width=0,this._notes.sort((i,r)=>i.isStringed?i.string-r.string:i.realValue-r.realValue)}createRenderingPoints(t){const n=[];switch(t.bendType){case me.Custom:for(const i of t.bendPoints)n.push(new Du(i.offset,i.value));break;case me.BendRelease:n.push(new Du(0,t.bendPoints[0].value)),n.push(new Du(se.MaxPosition/2|0,t.bendPoints[1].value)),n.push(new Du(se.MaxPosition,t.bendPoints[3].value));break;case me.Bend:case me.Hold:case me.Prebend:case me.PrebendBend:case me.PrebendRelease:case me.Release:n.push(new Du(0,t.bendPoints[0].value)),n.push(new Du(se.MaxPosition,t.bendPoints[1].value))}return n}paint(t,n,i){const r=i.color;this._notes.length>1&&(i.color=this.renderer.resources.secondaryGlyphColor);for(const o of this._notes){const a=this._renderPoints.get(o.id),l=this.renderer;let c=o,u=!1,h=null,d=!1;const p=o.bendStyle===Cn.Gradual?"grad.":"";let g=null;for(;c.isTieOrigin;){const D=c.tieDestination;if(h=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,D.beat.voice.bar),!h||l.staff!==h.staff)break;if(c=D,u=!0,c.hasBend||!this.renderer.settings.notation.extendBendArrowsOnTiedNotes||c.vibrato!==Ft.None){d=!0;break}}g=c.beat,h=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,g.voice.bar),g.isLastOfVoice&&!c.hasBend&&this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&(g=null);let m=0,_=0;const y=n+l.y;m=t+l.x,m+=a[0].value>0||o.isContinuedBend?l.getBeatX(o.beat,St.MiddleNotes):l.getNoteX(o,Un.Right),_=!g||g.isLastOfVoice&&!d?t+h.x+h.postBeatGlyphsStart:d||!g.nextBeat?t+h.x+h.getBeatX(g,St.MiddleNotes):o.bendType===me.Hold?t+h.x+h.getBeatX(g.nextBeat,St.OnNotes):t+h.x+h.getBeatX(g.nextBeat,St.PreNotes),u||(_-=s.ArrowSize);const S=(_-m)/se.MaxPosition;i.beginPath();for(let D=0,T=a.length-1;D<T;D++){const C=a[D];let v=a[D+1];0===D&&0!==C.value&&!o.isTieDestination&&this.paintBend(o,new Du(0,0),C,m,y,S,p,i),o.bendType!==me.Prebend?(0===D&&(m+=2),this.paintBend(o,C,v,m,y,S,p,i)):o.isTieOrigin&&o.tieDestination.hasBend&&(v=new Du(se.MaxPosition,C.value),v.lineValue=C.lineValue,this.paintBend(o,C,v,m,y,S,p,i))}if(c.vibrato!==Ft.None){const C=new ku(_-t+s.ArrowSize-h.x,y-n-s.BendValueHeight*a[a.length-1].lineValue,c.vibrato,1.2);C.beat=c.beat,C.renderer=h,C.doLayout(),C.paint(t+h.x,n,i)}i.color=r}}paintBend(t,n,i,r,o,a,l,c){const u=this.renderer,h=this.renderer.resources,d=u.lineOffset/2,p=r+a*n.offset,g=s.BendValueHeight;let m=o-g*n.lineValue;m+=0===n.value?i.offset===n.offset?u.getNoteY(t.beat.maxStringNote,be.Top):u.getNoteY(t,be.Center):d;const _=r+a*i.offset;let y=o-g*i.lineValue;y+=0===i.lineValue?u.getNoteY(t,be.Center):d;let b=0;const S=s.ArrowSize;if(i.value>n.value?(y+S>m&&(y=m-S),c.beginPath(),c.moveTo(_,y),c.lineTo(_-.5*S,y+S),c.lineTo(_+.5*S,y+S),c.closePath(),c.fill(),b=S):i.value!==n.value&&(y<m&&(y=m+S),c.beginPath(),c.moveTo(_,y),c.lineTo(_-.5*S,y-S),c.lineTo(_+.5*S,y-S),c.closePath(),c.fill(),b=-S),c.beginPath(),n.value===i.value){if(n.lineValue>0){let D=_;const T=s.DashSize,C=p+T;if((D-p)/(2*T)<1)c.moveTo(D,m),c.lineTo(p,m);else for(;D>C;)c.moveTo(D,m),c.lineTo(D-T,m),D-=2*T;c.stroke()}}else _>p?(c.moveTo(p,m),c.bezierCurveTo((p+_)/2,m,_,m,_,y+b),c.stroke()):(c.moveTo(p,m),c.lineTo(_,y),c.stroke());if(l&&n.offset<i.offset){c.font=h.graceFont;const D=c.measureText(l).width;let T=0,C=0;if(m>y){const v=Math.abs(m-y);T=v>1.3*c.font.size?m-v/2:m,C=(p+_-D)/2}else T=m,C=_-D;c.fillText(l,C,T)}if(0!==i.value&&n.value!==i.value){let D=i.value;const T=i.value>n.value;D=Math.abs(D);let C="";if(4===D)C="full",D-=4;else if(D>=4||D<=-4){const v=D/4|0;C+=v,D-=4*v}if(D>0&&(C+=s.getFractionSign(D)),""!==C){y=o-g*i.value;let v=y;T||(v=m+1*Math.abs(y-m)/3),c.font=h.tablatureFont;const x=c.measureText(C).width;c.fillText(C,_-x/2,v-.5*h.tablatureFont.size-2)}}}static getFractionSign(t){switch(t){case 1:return"\xbc";case 2:return"\xbd";case 3:return"\xbe";default:return`${t}/ 4`}}}return s.ArrowSize=6,s.DashSize=3,s.BendValueHeight=6,s})(),vV=(()=>{class s extends os{constructor(t){super(0,0),this._isSimpleDip=!1,this._beat=t,this._renderPoints=this.createRenderingPoints(t)}createRenderingPoints(t){if(t.whammyBarType===Wt.Custom)return t.whammyBarPoints;const n=[];switch(t.whammyBarType){case Wt.Dive:case Wt.Hold:case Wt.PrediveDive:case Wt.Predive:n.push(new se(0,t.whammyBarPoints[0].value)),n.push(new se(se.MaxPosition,t.whammyBarPoints[1].value));break;case Wt.Dip:n.push(new se(0,t.whammyBarPoints[0].value)),n.push(new se(se.MaxPosition/2|0,t.whammyBarPoints[1].value)),n.push(new se(se.MaxPosition,t.whammyBarPoints[t.whammyBarPoints.length-1].value))}return n}doLayout(){super.doLayout(),this._isSimpleDip=this.renderer.settings.notation.notationMode===xi.SongBook&&this._beat.whammyBarType===Wt.Dip;let t=null,n=null,i=this._beat;for(;i&&i.hasWhammyBar;)(!t||t.value>i.minWhammyPoint.value)&&(t=i.minWhammyPoint),(!n||n.value<i.maxWhammyPoint.value)&&(n=i.maxWhammyPoint),i=i.nextBeat;let r=n.value>0?Math.abs(this.getOffset(n.value)):0;(r>0||0!==this._beat.whammyBarPoints[0].value||this.renderer.settings.notation.isNotationElementVisible(dt.ZerosOnDiveWhammys))&&(r+=2*this.renderer.resources.tablatureFont.size);const o=t.value<0?Math.abs(this.getOffset(t.value)):0;this.renderer.registerOverflowTop(r+o),r>this.renderer.staff.getSharedLayoutData(s.TopOffsetSharedDataKey,-1)&&this.renderer.staff.setSharedLayoutData(s.TopOffsetSharedDataKey,r)}getOffset(t){if(0===t)return 0;let n=s.PerHalfSize+Math.log2(Math.abs(t)/2)*s.PerHalfSize;return t<0&&(n=-n),n}paint(t,n,i){const r=yt.beat(i,In.StandardNotationEffects,this._beat);try{const o=this.renderer;let a=this._beat.nextBeat,l=null,c=St.PreNotes;a&&(l=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,a.voice.bar),!l||l.staff!==o.staff||l!==o&&!a.hasWhammyBar?(a=null,l=null):c=!a.hasWhammyBar||o.settings.notation.notationMode===xi.SongBook&&a.whammyBarType===Wt.Dip?St.PreNotes:St.MiddleNotes);let u=0,h=0;this._isSimpleDip?(u=t+o.x+o.getBeatX(this._beat,St.OnNotes)-2,h=t+o.x+o.getBeatX(this._beat,St.PostNotes)+2):(u=t+o.x+o.getBeatX(this._beat,St.MiddleNotes),h=l?t+l.x+l.getBeatX(a,c):t+o.x+o.width-2);const d=i.textAlign;if(i.textAlign=ye.Center,this._renderPoints.length>=2){const p=(h-u)/se.MaxPosition;i.beginPath();const g=n+this.renderer.staff.getSharedLayoutData(s.TopOffsetSharedDataKey,0);let m=this._beat.whammyStyle===Cn.Gradual?"grad.":"";for(let _=0,y=this._renderPoints.length-1;_<y;_++){const b=this._renderPoints[_],S=this._renderPoints[_+1],D=_<y-2?this._renderPoints[_+2]:null;let T=0===_;0===_&&0!==b.value&&!this._beat.isContinuedWhammy&&(this.paintWhammy(!1,new se(0,0),b,S,u,g,p,i),T=!1),this.paintWhammy(T,b,S,D,u,g,p,i,m),m=""}i.stroke()}i.textAlign=d}finally{r?.[Symbol.dispose]?.()}}paintWhammy(t,n,i,r,o,a,l,c,u){const h=o+l*n.offset,d=o+l*i.offset,p=a-this.getOffset(n.value),g=a-this.getOffset(i.value);if(n.offset===i.offset){const y=s.DashSize;if(Math.abs(g-p)/(2*y)<1)c.moveTo(h,p),c.lineTo(d,g);else{const S=Math.max(p,g);let D=Math.min(p,g);for(;S>D;)c.moveTo(h,D),c.lineTo(h,D+y),D+=2*y}c.stroke()}else if(n.value===i.value){const y=s.DashSize;if(Math.abs(d-h)/(2*y)<1)c.moveTo(h,p),c.lineTo(d,g);else{let S=Math.max(h,d);const D=Math.min(h,d);for(;S>D;)c.moveTo(S,p),c.lineTo(S-y,p),S-=2*y}c.stroke()}else c.moveTo(h,p),c.lineTo(d,g);const m=this.renderer.resources;if(t&&!this._beat.isContinuedWhammy&&!this._isSimpleDip){let y=p;y-=m.tablatureFont.size+2,this.renderer.settings.notation.isNotationElementVisible(dt.ZerosOnDiveWhammys)&&c.fillText("0",h,y),u&&(y-=m.tablatureFont.size+2,c.fillText(u,h,y))}let _=Math.abs(i.value);if((0!==_||this.renderer.settings.notation.isNotationElementVisible(dt.ZerosOnDiveWhammys)&&!this._isSimpleDip)&&n.value!==i.value){let y="";if(i.value<0&&(y+="-"),_>=4){const D=_/4|0;y+=D,_-=4*D}else 0===_&&(y+="0");_>0&&(y+=SV.getFractionSign(_));let b=0;this._isSimpleDip?b=Math.min(p,g)-m.tablatureFont.size-2:(b=n.offset===i.offset?Math.min(p,g):g,b-=m.tablatureFont.size+2,r&&r.value>i.value&&(b-=2)),c.fillText(y,d,b)}}}return s.TopOffsetSharedDataKey="tab.whammy.topoffset",s.PerHalfSize=6,s.DashSize=3,s})();class qh extends wV{constructor(e){super(0,0),this._beat=e}doLayout(){const e=this.renderer.settings.notation.notationMode;switch(this._beat.whammyBarType){case Wt.None:case Wt.Custom:case Wt.Hold:return;case Wt.Dive:case Wt.PrediveDive:{const t=new Cu(this._beat,!1);t.renderer=this.renderer;const n=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(const i of this._beat.notes)i.isTieOrigin||t.addGlyph(this.getBendNoteValue(i,n),n.value%2!=0,void 0);t.doLayout(),this.BendNoteHeads.push(t)}break;case Wt.Dip:if(e===xi.SongBook)this.renderer.simpleWhammyOverflow=1.5*this.renderer.resources.tablatureFont.size+qh.SimpleDipHeight+qh.SimpleDipPadding;else{const t=new Cu(this._beat,!1);if(t.renderer=this.renderer,this.renderer.settings.notation.notationMode===xi.GuitarPro){const i=this._beat.whammyBarPoints[1];for(const r of this._beat.notes)t.addGlyph(this.getBendNoteValue(r,this._beat.whammyBarPoints[1]),i.value%2!=0,void 0)}t.doLayout(),this.BendNoteHeads.push(t);const n=new Cu(this._beat,!1);if(n.renderer=this.renderer,this.renderer.settings.notation.notationMode===xi.GuitarPro){const i=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(const r of this._beat.notes)n.addGlyph(this.getBendNoteValue(r,i),i.value%2!=0,void 0)}n.doLayout(),this.BendNoteHeads.push(n)}}super.doLayout()}paint(e,t,n){const i=this._beat;switch(i.whammyBarType){case Wt.None:case Wt.Custom:return}const r=this.renderer.settings.notation.notationMode,o=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,i.voice.bar),a=yt.beat(n,In.StandardNotationEffects,i);try{const l=e+o.x+o.getBeatX(i,St.MiddleNotes),c=this.getTieDirection(i,o);let u=1===this._beat.notes.length?c:V.Up;const h=n.textAlign,d=on.Heights.get(f.NoteheadBlack);for(let p=0;p<i.notes.length;p++){const g=i.notes[p],m=yt.note(n,Qi.StandardNotationEffects,g);try{let _=t+o.y;p>0&&p>=(this._beat.notes.length/2|0)&&(u=V.Down),_+=o.getNoteY(g,u===V.Down?be.Bottom:be.Top);let y=e+o.x;y+=i.isLastOfVoice?o.width:o.getBeatX(i,St.EndBeat),y-=8;const b=i.whammyStyle===Cn.Gradual&&0===p?"grad.":"";let S=null;g.isTieOrigin&&(S=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,g.tieDestination.beat.voice.bar),S&&S.staff===o.staff?y=e+S.x+S.getBeatX(g.tieDestination.beat,St.MiddleNotes):S=null);let D=d*Pn.GraceScale*.5;u===V.Up&&(D=-D);const T=i.whammyBarPoints.length>0?this.getBendNoteValue(g,i.whammyBarPoints[i.whammyBarPoints.length-1]):0;let C=0,v=!1;switch(this.BendNoteHeads.length>0&&this.BendNoteHeads[0].containsNoteValue(T)?(C=this.BendNoteHeads[0].getNoteValueY(T)+D,v=!0):S&&(g.isTieOrigin&&g.tieDestination.beat.hasWhammyBar||g.beat.isContinuedWhammy)?(C=t+S.y+S.getNoteY(g.tieDestination,be.Top),v=!0,u===V.Down&&(C+=d)):g.isTieOrigin&&(C=S?t+S.y+S.getNoteY(g.tieDestination,be.Top):_,u===V.Down&&(C+=d)),i.whammyBarType){case Wt.Hold:g.isTieOrigin&&Xo.paintTie(n,1,l,_,y,C,c===V.Down,22,4);break;case Wt.Dive:if(0===p){this.BendNoteHeads[0].x=y-this.BendNoteHeads[0].noteHeadOffset;const W=this.BendNoteHeads[0].y;this.BendNoteHeads[0].y=t+o.y,this.BendNoteHeads[0].paint(0,0,n),this.BendNoteHeads[0].containsNoteValue(T)&&(C-=W,C+=this.BendNoteHeads[0].y)}v?this.drawBendSlur(n,l,_,y,C,u===V.Down,1,b):g.isTieOrigin&&Xo.paintTie(n,1,l,_,y,C,c===V.Down,22,4);break;case Wt.Dip:if(r===xi.SongBook){if(0===p){const W=e+o.x+o.getBeatX(this._beat,St.OnNotes)-2,L=e+o.x+o.getBeatX(this._beat,St.PostNotes)+2,H=(W+L)/2,Ce=((this._beat.whammyBarPoints[1].value-this._beat.whammyBarPoints[0].value)/4|0).toString();n.font=this.renderer.resources.tablatureFont,n.fillText(Ce,H,t+this.y);const Re=t+this.y+n.font.size+2,Fe=Re+qh.SimpleDipHeight;this._beat.whammyBarPoints[1].value>this._beat.whammyBarPoints[0].value?(n.moveTo(W,Fe),n.lineTo(H,Re),n.lineTo(L,Fe)):(n.moveTo(W,Re),n.lineTo(H,Fe),n.lineTo(L,Re)),n.stroke()}g.isTieOrigin&&Xo.paintTie(n,1,l,_,y,C,c===V.Down,22,4)}else{const W=(l+y)/2;this.BendNoteHeads[0].x=W-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+o.y,this.BendNoteHeads[0].paint(0,0,n);const L=this.getBendNoteValue(g,i.whammyBarPoints[1]),H=this.BendNoteHeads[0].getNoteValueY(L)+D;this.drawBendSlur(n,l,_,W,H,u===V.Down,1,b),this.BendNoteHeads[1].x=y-this.BendNoteHeads[1].noteHeadOffset,this.BendNoteHeads[1].y=t+o.y,this.BendNoteHeads[1].paint(0,0,n),C=this.BendNoteHeads[1].getNoteValueY(T)+D,this.drawBendSlur(n,W,H,y,C,u===V.Down,1,b)}break;case Wt.PrediveDive:case Wt.Predive:let x=e+o.x+o.getBeatX(g.beat,St.PreNotes);x+=o.getPreNotesGlyphForBeat(g.beat).prebendNoteHeadOffset;const q=t+o.y+o.getScoreY(o.accidentalHelper.getNoteLineForValue(g.displayValue-(g.beat.whammyBarPoints[0].value/2|0),!1))+D;this.drawBendSlur(n,x,q,l,_,u===V.Down,1,b),this.BendNoteHeads.length>0&&(this.BendNoteHeads[0].x=y-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+o.y,this.BendNoteHeads[0].paint(0,0,n),this.drawBendSlur(n,l,_,y,C,u===V.Down,1,b))}}finally{m?.[Symbol.dispose]?.()}}n.textAlign=h}finally{a?.[Symbol.dispose]?.()}}getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}qh.SimpleDipHeight=2*vV.PerHalfSize,qh.SimpleDipPadding=2;class Ii extends os{constructor(e,t,n){super(e,t),this.width=n}}class pie extends Us{constructor(e,t,n,i,r){super(e,t,r?Pn.GraceScale:1,n.getSymbol(i)),this._isGrace=r,this._articulation=n}paint(e,t,n){const i=n.color;this.colorOverride&&(n.color=this.colorOverride);const r=this._isGrace?1:0;n.fillMusicFontSymbol(e+this.x,t+this.y+r,this.glyphScale,this.symbol,!1),this._articulation.techniqueSymbol!==f.None&&this._articulation.techniqueSymbolPlacement===qe.Middle&&n.fillMusicFontSymbol(e+this.x,t+this.y+r,this.glyphScale,this._articulation.techniqueSymbol,!1),n.color=i}doLayout(){super.doLayout(),0===this.width&&(this.height=on.Widths.get(f.NoteheadBlack)),0===this.height&&(this.height=on.Heights.get(f.NoteheadBlack))}}class TV extends Us{constructor(e,t){super(e,t,Pn.GraceScale,f.ArticStaccatoAbove)}paint(e,t,n){super.paint(e+3,t+5,n)}}class gie extends Us{constructor(e,t){super(e,t,.5,f.PictEdgeOfCymbal)}paint(e,t,n){super.paint(e-3,t+this.height,n)}}class kV extends Us{constructor(e,t,n=!1){super(e,t,Pn.GraceScale,f.GuitarGolpe),this.center=n}paint(e,t,n){super.paint(e,t+this.height,n)}}class mie extends ro{constructor(){super(...arguments),this._strings=new Set}addString(e){this._strings.add(e)}doLayout(){const e=on.Widths.get(f.GuitarString0)*Ww.CircleNumberScale;this.height=(e+3)*this._strings.size,this.width=e}paint(e,t,n){const i=this.renderer.bar.staff.tuning.length;let r=0;const o=on.Widths.get(f.GuitarString0)*Ww.CircleNumberScale,a=on.Heights.get(f.NoteheadBlack);for(const l of this._strings)n.fillMusicFontSymbol(e+this.x+a/2,t+this.y+o+r,Ww.CircleNumberScale,f.GuitarString1+(i-l),!0),r+=o+3}}class fm extends ro{constructor(e,t,n,i,r){super(e,t),this.beatEffects=new Map,this.noteHeadElement=Qi.SlashNoteHead,this.effectElement=In.SlashEffects,this._isGrace=i,this._symbol=fm.getSymbol(n),this.beat=r}paint(e,t,n){const i=0===this.beat.notes.length?void 0:yt.note(n,this.noteHeadElement,this.beat.notes[0]);try{n.fillMusicFontSymbol(e+this.x,t+this.y+(this._isGrace?1:0),this._isGrace?Pn.GraceScale:1,this._symbol,!1),this.paintEffects(e,t,n)}finally{i?.[Symbol.dispose]?.()}}paintEffects(e,t,n){const i=yt.beat(n,this.effectElement,this.beat);try{for(const r of this.beatEffects.values())r.paint(e+this.x,t+this.y,n)}finally{i?.[Symbol.dispose]?.()}}doLayout(){const e=this._isGrace?Pn.GraceScale:1;this.width=on.Widths.get(this._symbol)*e,this.height=on.Heights.get(this._symbol)*e;let n=on.Heights.get(this._symbol);for(const i of this.beatEffects.values())i.y+=n,i.x+=this.width/2,i.renderer=this.renderer,n+=7,i.doLayout()}static getSymbol(e){switch(e){case w.QuadrupleWhole:case w.DoubleWhole:case w.Whole:return f.NoteheadSlashWhiteWhole;case w.Half:return f.NoteheadSlashWhiteHalf;default:return f.NoteheadSlashVerticalEnds}}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+this.width,e+this.x)}}class yie extends vu{constructor(){super(...arguments),this._collisionOffset=-1e3,this._skipPaint=!1,this.slash=null,this.noteHeads=null,this.restGlyph=null}get effectElement(){return In.StandardNotationEffects}getNoteX(e,t){return this.noteHeads?this.noteHeads.getNoteX(e,t):0}buildBoundingsLookup(e,t,n){this.noteHeads&&this.noteHeads.buildBoundingsLookup(e,t+this.x,n+this.y)}getNoteY(e,t){return this.noteHeads?this.noteHeads.getNoteY(e,t):0}updateBeamingHelper(){if(this.noteHeads)this.noteHeads.updateBeamingHelper(this.container.x+this.x);else if(this.restGlyph){if(this.restGlyph.updateBeamingHelper(this.container.x+this.x),this.renderer.bar.isMultiVoice&&-1e3===this._collisionOffset){this._collisionOffset=this.renderer.helpers.collisionHelper.applyRestCollisionOffset(this.container.beat,this.restGlyph.y,this.renderer.getScoreHeight(1)),this.y+=this._collisionOffset;const e=this.renderer.helpers.collisionHelper.restDurationsByDisplayTime;e.has(this.container.beat.playbackStart)&&e.get(this.container.beat.playbackStart).has(this.container.beat.playbackDuration)&&e.get(this.container.beat.playbackStart).get(this.container.beat.playbackDuration)!==this.container.beat.id&&(this._skipPaint=!0)}}else this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}paint(e,t,n){this._skipPaint||super.paint(e,t,n)}doLayout(){const e=this.renderer;if(!this.container.beat.isEmpty)if(this.container.beat.isRest){let t=2*Math.ceil((this.renderer.bar.staff.standardNotationLineCount-1)/2);this.container.beat.duration===w.Whole&&1!==this.renderer.bar.staff.standardNotationLineCount&&3!==this.renderer.bar.staff.standardNotationLineCount&&(t-=2);const n=new dm(0,e.getScoreY(t),this.container.beat.duration);if(this.restGlyph=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addNormal(n),this.renderer.bar.isMultiVoice)if(0===this.container.beat.voice.index){const i=ja.computeLineHeightsForRest(this.container.beat.duration),r=n.y-e.getScoreHeight(i[0]),o=n.y+e.getScoreHeight(i[1]);this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,r,o)}else this.renderer.helpers.collisionHelper.registerRest(this.container.beat);if(this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,t),this.container.beat.dots>0){this.addNormal(new Ii(0,0,5));for(let i=0;i<this.container.beat.dots;i++){const r=new $a(0,0);r.renderer=this.renderer,this.createBeatDot(t,r),this.addEffect(r)}}}else{if(this.container.beat.slashed){const t=this.container.beat.graceType!==Ee.None,i=e.getLineY((e.heightLineCount-1)/2),r=new fm(0,i,this.container.beat.duration,t,this.container.beat);r.noteHeadElement=Qi.StandardNotationNoteHead,r.effectElement=In.StandardNotationEffects,this.slash=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper,this.addNormal(r)}else{const t=new fie;this.noteHeads=t,t.beat=this.container.beat,t.beamingHelper=this.beamingHelper;const n=new qw(!1);n.renderer=this.renderer;for(const i of this.container.beat.notes)i.isVisible&&(this.createNoteGlyph(i),n.addParenthesis(i));this.addNormal(t),n.isEmpty||(this.addNormal(new Ii(0,0,4*(this.container.beat.graceType!==Ee.None?Pn.GraceScale:1))),this.addEffect(n))}if(this.container.beat.hasWhammyBar){const t=new qh(this.container.beat);t.renderer=this.renderer,t.doLayout(),this.container.ties.push(t)}if(this.container.beat.dots>0){this.addNormal(new Ii(0,0,5));for(let t=0;t<this.container.beat.dots;t++){const n=new $a(0,0);n.renderer=this.renderer;for(const i of this.container.beat.notes)this.createBeatDot(e.getNoteLine(i),n).colorOverride=yt.noteColor(e.resources,Qi.StandardNotationEffects,i);this.addEffect(n)}}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2)}createBeatDot(e,t){const i=new hm(0,this.renderer.getScoreY(e),1.5);return t.addGlyph(i),i}createNoteHeadGlyph(e){const t=this.container.beat.graceType!==Ee.None,n=e.style;if(void 0!==n?.noteHead){const i=new Pn(0,0,e.beat.duration,t);return i.symbol=n.noteHead,n.noteHeadCenterOnStem&&(i.centerOnStem=!0),i}if(e.beat.voice.bar.staff.isPercussion){const i=Gs.getArticulation(e);if(i)return new pie(0,0,i,e.beat.duration,t);F.warning("Rendering",`No articulation found for percussion instrument ${e.percussionArticulation}`)}return e.isDead?new hie(0,0,t):e.beat.graceType===Ee.BendGrace?new Pn(0,0,w.Quarter,!0):e.harmonicType===Ie.Natural?new zw(0,0,e.beat.duration,t):new Pn(0,0,e.beat.duration,t)}createNoteGlyph(e){if(e.beat.graceType===Ee.BendGrace&&!e.hasBend)return;const t=this.renderer,n=this.createNoteHeadGlyph(e);n.colorOverride=yt.noteColor(t.resources,Qi.StandardNotationNoteHead,e);let i=t.getNoteLine(e);if(n.y=t.getScoreY(i),this.noteHeads.addNoteGlyph(n,e,i),e.harmonicType!==Ie.None&&e.harmonicType!==Ie.Natural){const a=e.displayValue+e.harmonicPitch,l=new zw(0,0,e.beat.duration,this.container.beat.graceType!==Ee.None);l.colorOverride=n.colorOverride,i=t.accidentalHelper.getNoteLineForValue(a,!1),l.y=t.getScoreY(i),this.noteHeads.addNoteGlyph(l,e,i)}const r=this.noteHeads.belowBeatEffects,o=this.noteHeads.aboveBeatEffects;if(e.isStaccato&&!r.has("Staccato")&&r.set("Staccato",new TV(0,0)),e.accentuated===Ss.Normal&&!r.has("Accent")&&r.set("Accent",new um(0,0,e)),e.accentuated===Ss.Heavy&&!r.has("HAccent")&&r.set("HAccent",new um(0,0,e)),e.accentuated===Ss.Tenuto&&!r.has("Tenuto")&&r.set("Tenuto",new um(0,0,e)),e.showStringNumber&&e.isStringed){let a;o.has("StringNumber")?a=o.get("StringNumber"):(a=new mie(0,0),o.set("StringNumber",a)),a.addString(e.string)}if(e.isPercussion){const a=Gs.getArticulation(e);if(a&&a.techniqueSymbolPlacement!==qe.Middle){const l=a.techniqueSymbolPlacement===qe.Top?this.noteHeads.aboveBeatEffects:this.noteHeads.belowBeatEffects;switch(a.techniqueSymbol){case f.PictEdgeOfCymbal:l.set("PictEdgeOfCymbal",new gie(0,0));break;case f.ArticStaccatoAbove:l.set("ArticStaccatoAbove",new TV(0,0));break;case f.StringsUpBow:l.set("StringsUpBow",new cm(0,0,yi.Up));break;case f.StringsDownBow:l.set("StringsDownBow",new cm(0,0,yi.Down));break;case f.GuitarGolpe:l.set("GuitarGolpe",new kV(0,0))}}}}}class _ie extends os{constructor(e){super(0,0),this._beat=e}doLayout(){this.width=this._beat.brushType===fe.ArpeggioUp||this._beat.brushType===fe.ArpeggioDown?10:0}paint(e,t,n){if(this._beat.brushType===fe.ArpeggioUp||this._beat.brushType===fe.ArpeggioDown){const i=this.renderer,r=i.lineOffset,o=t+this.y+(i.getNoteY(this._beat.maxNote,be.Bottom)-r),a=t+this.y+i.getNoteY(this._beat.minNote,be.Top)+r,l=e+this.x+this.width/2,c=8,u=new ku(0,0,Ft.Slight,1.2,!0);u.renderer=this.renderer,u.doLayout();const h=-u.height/2;if(this._beat.brushType===fe.ArpeggioUp){const p=a-c;u.width=Math.abs(p-(o+c)),n.beginRotate(e+this.x+5,p,-90),u.paint(0,h,n),n.endRotate(),n.beginPath(),n.moveTo(l,a),n.lineTo(l+c/2,a-c),n.lineTo(l-c/2,a-c),n.closePath(),n.fill()}else if(this._beat.brushType===fe.ArpeggioDown){const d=o+c;u.width=Math.abs(a-d),n.beginRotate(e+this.x+5,d,90),u.paint(0,h,n),n.endRotate(),n.beginPath(),n.moveTo(l,o),n.lineTo(l+c/2,o+c),n.lineTo(l-c/2,o+c),n.closePath(),n.fill()}}}}class bie{constructor(e,t){this.line=0,this.line=e,this.text=t}}class wie extends $a{constructor(){super(0,0),this._infos=new Map}get isEmpty(){return 0===this._infos.size}addFingers(e){const t=this.renderer.settings;if(t.notation.fingeringMode!==vl.ScoreDefault&&t.notation.fingeringMode!==vl.ScoreForcePiano)return;const n=ie.fingerToString(this.renderer.settings,e.beat,e.leftHandFinger,!0);n&&this.addFinger(e,n);const i=ie.fingerToString(this.renderer.settings,e.beat,e.rightHandFinger,!1);i&&this.addFinger(e,i)}addFinger(e,t){const n=this.renderer,i=n.getNoteLine(e);if(this._infos.has(i))this._infos.get(i).text+=t;else{const r=new bie(i,t);r.color=yt.noteColor(n.resources,Qi.StandardNotationEffects,e),this._infos.set(i,r)}}doLayout(){const e=this.renderer;for(const[t,n]of this._infos){const i=new oo(0,0,n.text,e.resources.inlineFingeringFont,ye.Left,qe.Middle);i.colorOverride=n.color,i.renderer=e,i.y=e.getScoreY(n.line),i.doLayout(),this.addGlyph(i),this.width=Math.max(this.width,i.width)}}}class Sie extends Su{constructor(){super(...arguments),this._prebends=null,this.accidentals=null}get prebendNoteHeadOffset(){return this._prebends?this._prebends.x+this._prebends.noteHeadOffset:0}get effectElement(){return In.StandardNotationEffects}doLayout(){if(!this.container.beat.isRest){const e=new cx;e.renderer=this.renderer;const t=new wie;t.renderer=this.renderer;const n=new qw(!0);n.renderer=this.renderer;const i=new Cu(this.container.beat,!0);this._prebends=i,i.renderer=this.renderer;for(const r of this.container.beat.notes){const o=yt.noteColor(this.renderer.resources,Qi.StandardNotationEffects,r);if(r.isVisible){if(r.hasBend)switch(r.bendType){case me.PrebendBend:case me.Prebend:case me.PrebendRelease:i.addGlyph(r.displayValue-(r.bendPoints[0].value/2|0),!1,o)}else if(r.beat.hasWhammyBar)switch(r.beat.whammyBarType){case Wt.PrediveDive:case Wt.Predive:this._prebends.addGlyph(r.displayValue-(r.beat.whammyBarPoints[0].value/2|0),!1,o)}this.createAccidentalGlyph(r,e),n.addParenthesis(r),t.addFingers(r)}}i.isEmpty||(this.addEffect(i),this.addNormal(new Ii(0,0,4*(this.container.beat.graceType!==Ee.None?Pn.GraceScale:1)))),this.container.beat.brushType!==fe.None&&(this.addEffect(new _ie(this.container.beat)),this.addNormal(new Ii(0,0,4))),t.isEmpty||(this.isEmpty||this.addNormal(new Ii(0,0,2*(this.container.beat.graceType!==Ee.None?Pn.GraceScale:1))),this.addEffect(t),this.addNormal(new Ii(0,0,2*(this.container.beat.graceType!==Ee.None?Pn.GraceScale:1)))),n.isEmpty||(this.addEffect(n),this.addNormal(new Ii(0,0,4*(this.container.beat.graceType!==Ee.None?Pn.GraceScale:1)))),e.isEmpty||(this.accidentals=e,this.isEmpty||this.addNormal(new Ii(0,0,2*(this.container.beat.graceType!==Ee.None?Pn.GraceScale:1))),this.addNormal(e),this.addNormal(new Ii(0,0,2*(this.container.beat.graceType!==Ee.None?Pn.GraceScale:1))))}super.doLayout()}createAccidentalGlyph(e,t){const n=this.renderer;let i=n.accidentalHelper.applyAccidental(e),r=n.getNoteLine(e);const o=this.container.beat.graceType!==Ee.None,a=yt.noteColor(n.resources,Qi.StandardNotationAccidentals,e),l=o?Pn.GraceScale:1;if(i!==Be.None){const c=new Ml(0,n.getScoreY(r),i,l);c.colorOverride=a,c.renderer=this.renderer,t.addGlyph(c)}if(e.harmonicType!==Ie.None&&e.harmonicType!==Ie.Natural){const c=e.displayValue+e.harmonicPitch;i=n.accidentalHelper.applyAccidentalForValue(e.beat,c,o,!1),r=n.accidentalHelper.getNoteLineForValue(c,!1);const u=new Ml(0,n.getScoreY(r),i,l);u.colorOverride=a,u.renderer=this.renderer,t.addGlyph(u)}}}class CV extends $a{constructor(e,t,n,i,r,o){super(e,t),this._numerator=0,this._denominator=0,this.barSubElement=Ht.StandardNotationTimeSignature,this._numerator=n,this._denominator=i,this._isCommon=r,this._isFreeTime=o}paint(e,t,n){const i=yt.bar(n,this.barSubElement,this.renderer.bar);try{super.paint(e,t,n)}finally{i?.[Symbol.dispose]?.()}}doLayout(){let e=0;const t=Gw.numberHeight;if(this._isFreeTime){const n=new lx(!0);n.renderer=this.renderer,n.y=-t,n.height=2*t,n.doLayout(),this.addGlyph(n),e+=n.width+10}if(this._isCommon&&2===this._numerator&&2===this._denominator){const n=new Us(e,0,this.commonScale,f.TimeSigCutCommon);this.addGlyph(n),super.doLayout()}else if(this._isCommon&&4===this._numerator&&4===this._denominator){const n=new Us(e,0,this.commonScale,f.TimeSigCommon);this.addGlyph(n),super.doLayout()}else{const n=new Gw(e,-t/2,this._numerator,this.numberScale),i=new Gw(e,t/2,this._denominator,this.numberScale);this.addGlyph(n),this.addGlyph(i),super.doLayout();const r=this.width-e;n.x=e+(r-n.width)/2,i.x=e+(r-i.width)/2}if(this._isFreeTime){const n=new lx(!1);n.renderer=this.renderer,n.x=this.width+13,n.y=-t,n.height=2*t,n.doLayout(),this.addGlyph(n),this.width=n.x+n.width}}}class ux extends CV{get commonScale(){return 1}get numberScale(){return 1}}class vie extends wV{constructor(e){super(0,0),this._notes=[],this._endNoteGlyph=null,this._middleNoteGlyph=null,this._beat=e}addBends(e){if(this._notes.push(e),e.isTieOrigin)return;const t=yt.noteColor(this.renderer.resources,Qi.StandardNotationEffects,e);switch(e.bendType){case me.Bend:case me.PrebendRelease:case me.PrebendBend:{let n=this._endNoteGlyph;n||(n=new Cu(e.beat,!1),n.renderer=this.renderer,this._endNoteGlyph=n,this.BendNoteHeads.push(n));const i=e.bendPoints[e.bendPoints.length-1];n.addGlyph(this.getBendNoteValue(e,i),i.value%2!=0,t)}break;case me.Release:if(!e.isTieOrigin){let n=this._endNoteGlyph;n||(n=new Cu(e.beat,!1),n.renderer=this.renderer,this._endNoteGlyph=n,this.BendNoteHeads.push(n));const i=e.bendPoints[e.bendPoints.length-1];n.addGlyph(this.getBendNoteValue(e,i),i.value%2!=0,t)}break;case me.BendRelease:{let n=this._middleNoteGlyph;n||(n=new Cu(e.beat,!1),this._middleNoteGlyph=n,n.renderer=this.renderer,this.BendNoteHeads.push(n));const i=e.bendPoints[1];n.addGlyph(this.getBendNoteValue(e,e.bendPoints[1]),i.value%2!=0,t);let r=this._endNoteGlyph;r||(r=new Cu(e.beat,!1),r.renderer=this.renderer,this._endNoteGlyph=r,this.BendNoteHeads.push(r));const o=e.bendPoints[e.bendPoints.length-1];r.addGlyph(this.getBendNoteValue(e,o),o.value%2!=0,t)}}}paint(e,t,n){const i=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._beat.voice.bar),r=e+i.x+i.getBeatX(this._beat,St.MiddleNotes);let o=e+i.x;o+=this._beat.isLastOfVoice?i.postBeatGlyphsStart:i.getBeatX(this._beat.nextBeat,St.PreNotes),o-=8;const a=(r+o)/2;this._middleNoteGlyph&&(this._middleNoteGlyph.x=a-this._middleNoteGlyph.noteHeadOffset,this._middleNoteGlyph.y=t+i.y,this._middleNoteGlyph.paint(0,0,n)),this._endNoteGlyph&&(this._endNoteGlyph.x=o-this._endNoteGlyph.noteHeadOffset,this._endNoteGlyph.y=t+i.y,this._endNoteGlyph.paint(0,0,n)),this._notes.sort((h,d)=>d.displayValue-h.displayValue);let c=1===this._notes.length?this.getTieDirection(this._beat.graceType===Ee.BendGrace?this._beat.nextBeat:this._beat,i):V.Up;const u=on.Heights.get(f.NoteheadBlack);for(let h=0;h<this._notes.length;h++){const d=this._notes[h],p=yt.note(n,Qi.StandardNotationEffects,d);try{h>0&&h>=(this._notes.length/2|0)&&(c=V.Down);let g=t+i.y+i.getNoteY(d,be.Top),m=u*Pn.GraceScale*.5;c===V.Down&&(g+=u);const _=d.bendStyle===Cn.Gradual?"grad.":"";if(d.isTieOrigin){const y=d.tieDestination,b=y?this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,y.beat.voice.bar):null;if(b&&b.staff===i.staff){const S=e+b.x+b.getBeatX(y.beat,St.MiddleNotes);let D=t+b.y+b.getNoteY(y,be.Top);c===V.Down&&(D+=u),d.bendType===me.Hold||d.bendType===me.Prebend?Xo.paintTie(n,1,r,g,S,D,c===V.Down,22,4):this.drawBendSlur(n,r,g,S,D,c===V.Down,1,_)}else{const S=e+i.x+i.width,D=d.tieDestination.realValue;i.accidentalHelper.applyAccidentalForValue(d.beat,D,!1,!0);const T=t+i.y+i.getScoreY(i.accidentalHelper.getNoteLineForValue(D,!1));d.bendType===me.Hold||d.bendType===me.Prebend?Xo.paintTie(n,1,r,g,S,T,c===V.Down,22,4):this.drawBendSlur(n,r,g,S,T,c===V.Down,1,_)}switch(d.bendType){case me.Prebend:case me.PrebendBend:case me.PrebendRelease:let S=e+i.x+i.getBeatX(d.beat,St.PreNotes);S+=i.getPreNotesGlyphForBeat(d.beat).prebendNoteHeadOffset;const D=t+i.y+i.getScoreY(i.accidentalHelper.getNoteLineForValue(d.displayValue-(d.bendPoints[0].value/2|0),!1))+m;this.drawBendSlur(n,S,D,r,g,c===V.Down,1)}}else{c===V.Up&&(m=-m);let y=0,b=0;switch(d.bendType){case me.Bend:y=this.getBendNoteValue(d,d.bendPoints[d.bendPoints.length-1]),b=this._endNoteGlyph.getNoteValueY(y)+m,this.drawBendSlur(n,r,g,o,b,c===V.Down,1,_);break;case me.BendRelease:const S=this.getBendNoteValue(d,d.bendPoints[1]),D=this._middleNoteGlyph.getNoteValueY(S)+m;this.drawBendSlur(n,r,g,a,D,c===V.Down,1,_),y=this.getBendNoteValue(d,d.bendPoints[d.bendPoints.length-1]),b=this._endNoteGlyph.getNoteValueY(y)+m,this.drawBendSlur(n,a,D,o,b,c===V.Down,1,_);break;case me.Release:this.BendNoteHeads.length>0&&(y=this.getBendNoteValue(d,d.bendPoints[d.bendPoints.length-1]),b=this.BendNoteHeads[0].getNoteValueY(y)+m,this.drawBendSlur(n,r,g,o,b,c===V.Down,1,_));break;case me.Prebend:case me.PrebendBend:case me.PrebendRelease:let T=e+i.x+i.getBeatX(d.beat,St.PreNotes);T+=i.getPreNotesGlyphForBeat(d.beat).prebendNoteHeadOffset;const C=t+i.y+i.getScoreY(i.accidentalHelper.getNoteLineForValue(d.displayValue-(d.bendPoints[0].value/2|0),!1))+m;this.drawBendSlur(n,T,C,r,g,c===V.Down,1),this.BendNoteHeads.length>0&&(y=this.getBendNoteValue(d,d.bendPoints[d.bendPoints.length-1]),b=this.BendNoteHeads[0].getNoteValueY(y)+m,this.drawBendSlur(n,r,g,o,b,c===V.Down,1,_))}}}finally{p?.[Symbol.dispose]?.()}}}getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}class hx extends Xo{constructor(e,t,n=!1){super(e,t,n)}doLayout(){super.doLayout()}getBeamDirection(e,t){return e.isRest?V.Up:t.getBeatDirection(e)===V.Up?V.Down:V.Up}getStartY(){return this.startBeat.isRest?this.startNoteRenderer.getScoreY(9):this.tieDirection===V.Up?this.startNoteRenderer.getNoteY(this.startBeat.maxNote,be.Top):this.startNoteRenderer.getNoteY(this.startBeat.minNote,be.Bottom)}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)return e.getScoreY(this.tieDirection===V.Up?9:0);const t=this.startNoteRenderer.getBeatDirection(this.startBeat),n=e.getBeatDirection(this.endBeat);return t!==n&&this.startBeat.graceType===Ee.None?n===this.tieDirection?this.tieDirection===V.Up?e.getNoteY(this.endBeat.maxNote,be.TopWithStem):e.getNoteY(this.endBeat.minNote,be.BottomWithStem):this.tieDirection===V.Up?e.getNoteY(this.endBeat.maxNote,be.BottomWithStem):e.getNoteY(this.endBeat.minNote,be.TopWithStem):this.tieDirection===V.Up?e.getNoteY(this.endBeat.maxNote,be.Top):e.getNoteY(this.endBeat.minNote,be.Bottom)}getStartX(){return this.startNoteRenderer.getBeatX(this.startBeat,St.MiddleNotes)}getEndX(){const e=this.endNoteRenderer.getBeatDirection(this.endBeat);return this.endNoteRenderer.getBeatX(this.endBeat,this.endBeat.duration>w.Whole&&e===this.tieDirection?St.Stem:St.MiddleNotes)}}class Tie extends os{constructor(e,t,n,i){super(0,0),this._outType=t,this._inType=e,this._startNote=n,this._parent=i}doLayout(){this.width=0}paint(e,t,n){this.paintSlideIn(e,t,n),this.drawSlideOut(e,t,n)}paintSlideIn(e,t,n){const i=this.renderer;let o=e+i.x+i.getNoteX(this._startNote,Un.Left)-2;const a=t+i.y+i.getNoteY(this._startNote,be.Center);let l=o-12,c=t+i.y;switch(this._inType){case ri.IntoFromBelow:c+=i.getNoteY(this._startNote,be.Bottom);break;case ri.IntoFromAbove:c+=i.getNoteY(this._startNote,be.Top);break;default:return}const u=this.getAccidentalsWidth(i,this._startNote.beat);l-=u,o-=u,this.paintSlideLine(n,!1,l,o,c,a)}getAccidentalsWidth(e,t){const n=e.getPreNotesGlyphForBeat(t);return n&&n.accidentals?n.accidentals.width:0}drawSlideOut(e,t,n){const i=this.renderer;let l=0,c=0,u=0,h=0,d=!1;switch(this._outType){case Qe.Shift:case Qe.Legato:if(l=e+i.x+i.getBeatX(this._startNote.beat,St.PostNotes)+2,c=t+i.y+i.getNoteY(this._startNote,be.Center),this._startNote.slideTarget){const p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._startNote.slideTarget.beat.voice.bar);p&&p.staff===i.staff?(u=e+p.x+p.getBeatX(this._startNote.slideTarget.beat,St.PreNotes)-2,h=t+p.y+p.getNoteY(this._startNote.slideTarget,be.Center)):(u=e+i.x+i.width,h=c),this._startNote.slideTarget.realValue>this._startNote.realValue?(c+=2,h-=2):(c-=2,h+=2)}else u=e+i.x+this._parent.x,h=c;break;case Qe.OutUp:l=e+i.x+i.getNoteX(this._startNote,Un.Right)+2,c=t+i.y+i.getNoteY(this._startNote,be.Center),u=l+12,h=t+i.y+i.getNoteY(this._startNote,be.Top);break;case Qe.OutDown:l=e+i.x+i.getNoteX(this._startNote,Un.Right)+2,c=t+i.y+i.getNoteY(this._startNote,be.Center),u=l+12,h=t+i.y+i.getNoteY(this._startNote,be.Bottom);break;case Qe.PickSlideUp:l=e+i.x+i.getNoteX(this._startNote,Un.Right)+4,c=t+i.y+i.getNoteY(this._startNote,be.Center),h=t+i.y+i.getNoteY(this._startNote,be.Top),u=e+i.x+i.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(u=e+i.x+i.getBeatX(this._startNote.beat.nextBeat,St.PreNotes)),d=!0;break;case Qe.PickSlideDown:l=e+i.x+i.getNoteX(this._startNote,Un.Right)+4,c=t+i.y+i.getNoteY(this._startNote,be.Center),h=t+i.y+i.getNoteY(this._startNote,be.Bottom),u=e+i.x+i.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(u=e+i.x+i.getBeatX(this._startNote.beat.nextBeat,St.PreNotes)),d=!0;break;default:return}this.paintSlideLine(n,d,l,u,c,h)}paintSlideLine(e,t,n,i,r,o){if(t){const a=new ku(0,0,Ft.Slight,1.2);a.renderer=this.renderer,a.doLayout();const l=i-n,c=(o-=a.height/2)-(r-=a.height/2),u=Math.sqrt(Math.pow(c,2)+Math.pow(l,2));a.width=l;const h=Math.asin(c/u)*(180/Math.PI);e.beginRotate(n,r,h),a.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(n,r),e.lineTo(i,o),e.stroke()}}class Yw extends hx{constructor(e,t,n=!1){super(e.beat,t.beat,n),this._startNote=e,this._endNote=t}getTieHeight(e,t,n,i){return Math.log2(n-e+1)*this.renderer.settings.notation.slurHeight}getStartY(){return this.isStartCentered()?this.startNoteRenderer.getNoteY(this._startNote,this.tieDirection===V.Up?be.Top:be.Bottom):this.startNoteRenderer.getNoteY(this._startNote,be.Center)}getEndY(){return this.isEndCentered()?this.isEndOnStem()?this.endNoteRenderer.getNoteY(this._endNote,this.tieDirection===V.Up?be.TopWithStem:be.BottomWithStem):this.endNoteRenderer.getNoteY(this._endNote,this.tieDirection===V.Up?be.Top:be.Bottom):this.endNoteRenderer.getNoteY(this._endNote,be.Center)}isStartCentered(){return this._startNote===this._startNote.beat.maxNote&&this.tieDirection===V.Up||this._startNote===this._startNote.beat.minNote&&this.tieDirection===V.Down}isEndCentered(){return this._startNote.beat.graceType===Ee.None&&(this._endNote===this._endNote.beat.maxNote&&this.tieDirection===V.Up||this._endNote===this._endNote.beat.minNote&&this.tieDirection===V.Down)}isEndOnStem(){const e=this.endNoteRenderer;return this.startNoteRenderer.getBeatDirection(this.startBeat)!==e.getBeatDirection(this.endBeat)&&this.startBeat.graceType===Ee.None}getStartX(){return this.isStartCentered()?this.startNoteRenderer.getBeatX(this._startNote.beat,St.MiddleNotes):this.startNoteRenderer.getNoteX(this._startNote,Un.Right)}getEndX(){return this.isEndCentered()?this.isEndOnStem()?this.endNoteRenderer.getBeatX(this._endNote.beat,St.Stem):this.endNoteRenderer.getNoteX(this._endNote,Un.Center):this.endNoteRenderer.getBeatX(this._endNote.beat,St.PreNotes)}}class DV extends Xo{constructor(e,t,n=!1){super(e?e.beat:null,t?t.beat:null,n),this.startNote=e,this.endNote=t}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){return t.getBeatDirection(e)===V.Up?V.Down:V.Up}getStartY(){return this.startBeat.isRest?this.startNoteRenderer.getScoreY(9):this.startNoteRenderer.getNoteY(this.startNote,this.tieDirection===V.Up?be.Top:be.Bottom)}getEndY(){const e=this.endNoteRenderer;return this.endBeat.isRest?e.getScoreY(this.tieDirection===V.Up?9:0):e.getNoteY(this.endNote,this.tieDirection===V.Up?be.Top:be.Bottom)}getStartX(){return this.startNoteRenderer.getBeatX(this.startNote.beat,St.PostNotes)}getEndX(){return this.endNoteRenderer.getBeatX(this.endNote.beat,St.PreNotes)}}class kie extends za{constructor(){super(...arguments),this._bend=null,this._effectSlur=null,this._effectEndSlur=null}doLayout(){this._effectSlur=null,this._effectEndSlur=null,super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(e.isVisible){if(e.isTieOrigin&&!e.hasBend&&!e.beat.hasWhammyBar&&e.beat.graceType!==Ee.BendGrace&&e.tieDestination&&e.tieDestination.isVisible){const t=new DV(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination&&!e.tieOrigin.hasBend&&!e.beat.hasWhammyBar){const t=new DV(e.tieOrigin,e,!0);this.addTie(t)}if(e.slideInType!==ri.None||e.slideOutType!==Qe.None){const t=new Tie(e.slideInType,e.slideOutType,e,this);this.addTie(t)}if(e.isSlurOrigin&&e.slurDestination&&e.slurDestination.isVisible){const t=new Yw(e,e.slurDestination,!1);this.addTie(t)}if(e.isSlurDestination){const t=new Yw(e.slurOrigin,e,!0);this.addTie(t)}if(!this._effectSlur&&e.isEffectSlurOrigin&&e.effectSlurDestination){const t=new Yw(e,e.effectSlurDestination,!1);this._effectSlur=t,this.addTie(t)}if(!this._effectEndSlur&&e.beat.isEffectSlurDestination&&e.beat.effectSlurOrigin){const t=this.onNotes.beamingHelper.direction,r=new Yw(t===V.Up?e.beat.effectSlurOrigin.minNote:e.beat.effectSlurOrigin.maxNote,t===V.Up?e.beat.minNote:e.beat.maxNote,!0);this._effectEndSlur=r,this.addTie(r)}if(e.hasBend){if(!this._bend){const t=new vie(e.beat);this._bend=t,t.renderer=this.renderer,this.addTie(t)}this._bend.addBends(e)}if(this.beat.isLegatoOrigin){if(!this.beat.previousBeat||!this.beat.previousBeat.isLegatoOrigin){let t=this.beat.nextBeat;for(;t.nextBeat&&t.nextBeat.isLegatoDestination;)t=t.nextBeat;this.addTie(new hx(this.beat,t,!1))}}else if(this.beat.isLegatoDestination&&!this.beat.isLegatoOrigin){let t=this.beat.previousBeat;for(;t.previousBeat&&t.previousBeat.isLegatoOrigin;)t=t.previousBeat;this.addTie(new hx(t,this.beat,!0))}}}}class $h extends os{doLayout(){this.width=1}paint(e,t,n){const r=t+this.y+this.renderer.topPadding;this.paintInternal(e+this.x,r,t+this.y+this.renderer.height-this.renderer.bottomPadding-r,n)}}class pm extends $h{paintInternal(e,t,n,i){i.fillRect(e,t,1,n)}}class Cie extends $h{paintInternal(e,t,n,i){const o=e,a=this.renderer.getLineHeight(1);let l=t+.5*a+1;const c=t+n;for(;l<c;)i.fillCircle(o,l,1),l+=a}}let Die=(()=>{class s extends $h{paintInternal(t,n,i,r){const o=s.DashSize,a=t+.5,l=Math.ceil(i/2/o),c=n+i;if(r.beginPath(),l<1)r.moveTo(a,n),r.lineTo(a,c);else{let u=n;const d=(i-l*o)/(l-1);for(;u<c;)r.moveTo(a,u),r.lineTo(a,u+o),u+=o+d}r.stroke()}}return s.DashSize=4,s})();class gm extends $h{doLayout(){this.width=4}paintInternal(e,t,n,i){i.fillRect(e,t,this.width,n)}}class xV extends $h{paintInternal(e,t,n,i){const a=(t+(t+n))/2;i.fillCircle(e,a-4.5,1.5),i.fillCircle(e,a+4.5,1.5)}}class xie extends $h{paintInternal(e,t,n,i){const r=this.renderer,a=r.drawnLineCount-1;if(a<=2)return;const l=r.getLineHeight(1),c=2*l;i.fillRect(e,t+(a/2*l-c/2),1,c)}}class Nie extends $h{paintInternal(e,t,n,i){const o=this.renderer.getLineHeight(1);i.fillRect(e,t+(-o/2+1),1,o)}}class dx extends Wh{constructor(e){super(),this._isRight=e}doLayout(){const e=this.renderer.bar,t=e.masterBar,n=this._isRight?e.getActualBarLineRight():e.getActualBarLineLeft(0===this.renderer.index);let i=We.Automatic;if(!this._isRight){const o=this.renderer.previousRenderer;if(o&&o.staff===this.renderer.staff&&(i=o.bar.getActualBarLineRight(),n===i))return}switch(this._isRight&&t.isRepeatEnd&&(this.addGlyph(new xV(0,0)),this.width+=3),n){case We.Dashed:this.addGlyph(new Die(0,0));break;case We.Dotted:this.addGlyph(new Cie(0,0));break;case We.Heavy:i!==We.LightHeavy&&i!==We.HeavyHeavy&&this.addGlyph(new gm(0,0));break;case We.HeavyHeavy:i!==We.LightHeavy&&i!==We.Heavy&&this.addGlyph(new gm(0,0)),this.width+=3,this.addGlyph(new gm(0,0));break;case We.HeavyLight:i!==We.LightHeavy&&i!==We.Heavy&&i!==We.HeavyHeavy&&this.addGlyph(new gm(0,0)),this.width+=3,this.addGlyph(new pm(0,0));break;case We.LightHeavy:i!==We.HeavyLight&&i!==We.Regular&&i!==We.LightLight&&this.addGlyph(new pm(0,0)),this.width+=3,this.addGlyph(new gm(0,0));break;case We.LightLight:i!==We.HeavyLight&&i!==We.Regular&&this.addGlyph(new pm(0,0)),this.width+=3,this.addGlyph(new pm(0,0));break;case We.None:break;case We.Regular:i!==We.HeavyLight&&i!==We.LightLight&&this.addGlyph(new pm(0,0));break;case We.Short:this.addGlyph(new xie(0,0));break;case We.Tick:this.addGlyph(new Nie(0,0))}this._isRight||t.isRepeatStart&&(this.width+=3,this.addGlyph(new xV(0,0)))}paint(e,t,n){const r=yt.bar(n,this.renderer.barLineBarSubElement,this.renderer.bar,!0);try{super.paint(e,t,n)}finally{r?.[Symbol.dispose]?.()}}}class Eie extends os{constructor(e,t,n){super(e,t),this._count=0,this._count=0,this._count=n}doLayout(){this.width=0}paint(e,t,n){const i=yt.bar(n,this.renderer.repeatsBarSubElement,this.renderer.bar);try{const o=n.textAlign;n.font=this.renderer.resources.barNumberFont,n.textAlign=ye.Right;const a=`x${this._count}`,l=n.measureText(a).width/1.5;n.fillText(a,e+this.x-l,t+this.y),n.textAlign=o}finally{i?.[Symbol.dispose]?.()}}}class NV extends os{constructor(e,t,n){super(e,t),this._number=0,this._number=n}doLayout(){this.renderer.scoreRenderer.canvas.font=this.renderer.resources.barNumberFont,this.width=this.renderer.scoreRenderer.canvas.measureText(this._number.toString()).width+5}paint(e,t,n){if(!this.renderer.staff.isFirstInSystem)return;const i=yt.bar(n,this.renderer.barNumberBarSubElement,this.renderer.bar,!0);try{const r=this.renderer.resources,o=n.textBaseline;n.textBaseline=qe.Top,n.font=r.barNumberFont,n.fillText(this._number.toString(),e+this.x,t+this.y),n.textBaseline=o}finally{i?.[Symbol.dispose]?.()}}}class Pl extends ss{constructor(){super(...arguments),this.firstLineY=0,this._startSpacing=!1,this.tupletSize=0}get lineOffset(){return this.lineSpacing+1}get tupletOffset(){return 10}get topGlyphOverflow(){const e=this.resources;return e.tablatureFont.size/2+.2*e.tablatureFont.size}get bottomGlyphOverflow(){const e=this.resources;return e.tablatureFont.size/2+.2*e.tablatureFont.size}initLineBasedSizes(){this.topPadding=this.topGlyphOverflow,this.bottomPadding=this.bottomGlyphOverflow,this.height=this.lineOffset*(this.heightLineCount-1)+this.topPadding+this.bottomPadding}updateSizes(){this.initLineBasedSizes(),this.adjustSizes(),this.updateFirstLineY(),super.updateSizes()}adjustSizes(){}updateFirstLineY(){this.firstLineY=this.topPadding+(this.lineOffset*(this.heightLineCount-1)-(this.drawnLineCount-1)*this.lineOffset)/2}doLayout(){this.initLineBasedSizes(),this.updateFirstLineY(),this.tupletSize=15+.3*this.resources.effectFont.size,super.doLayout()}getLineY(e){return this.firstLineY+this.getLineHeight(e)}getLineHeight(e){return this.lineOffset*e}paintBackground(e,t,n){super.paintBackground(e,t,n),this.paintStaffLines(e,t,n),this.paintSimileMark(e,t,n)}paintStaffLines(e,t,n){const i=yt.bar(n,this.staffLineBarSubElement,this.bar,!0);try{const r=[];for(let a=0,l=this.drawnLineCount;a<l;a++)r.push([]);this.additionalMultiRestBars||this.collectSpaces(r);for(const a of r)a.sort((l,c)=>l[0]>c[0]?1:l[0]<c[0]?-1:0);const o=Math.ceil(this.width);for(let a=0;a<this.drawnLineCount;a++){const l=this.getLineY(a);let c=0;for(const u of r[a])n.fillRect(e+this.x+c,t+this.y+l|0,u[0]-c,ss.StaffLineThickness),c=u[0]+u[1];n.fillRect(e+this.x+c,t+this.y+l|0,o-c,ss.StaffLineThickness)}}finally{i?.[Symbol.dispose]?.()}}collectSpaces(e){}createStartSpacing(){this._startSpacing||(this.addPreBeatGlyph(new Ii(0,0,0===this.index?this.settings.display.firstStaffPaddingLeft:this.settings.display.staffPaddingLeft)),this._startSpacing=!0)}paintTuplets(e,t,n,i,r=!1){for(const o of this.bar.voices)if(this.hasVoiceContainer(o)){const a=this.getVoiceContainer(o);for(const l of a.tupletGroups)this.paintTupletHelper(e+this.beatGlyphsStart,t,n,l,i,r)}}getTupletBeamDirection(e){return this.getBeamDirection(e)}paintTupletHelper(e,t,n,i,r,o){const a=this.resources,l=n.textAlign,c=n.textBaseline;let u;n.color=0===i.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,n.textAlign=ye.Center,n.textBaseline=qe.Middle;const h=i.beats[0].tupletNumerator,d=i.beats[0].tupletDenominator;u=2===h&&3===d?"2":3===h&&2===d?"3":4===h&&6===d?"4":5===h&&4===d?"5":6===h&&4===d?"6":7===h&&4===d?"7":9===h&&8===d?"9":10===h&&8===d?"10":11===h&&8===d?"11":12===h&&8===d?"12":13===h&&8===d?"13":`${h}:${d}`;let p=this.tupletOffset,g=5;const m=yt.beat(n,r,i.beats[0]);try{if(1!==i.beats.length&&i.isFull){const _=i.beats[0],y=i.beats[i.beats.length-1];let b=null,S=null;for(let En=0;En<i.beats.length;En++)if(!i.beats[En].isRest){b=i.beats[En];break}for(let En=i.beats.length-1;En>=0;En--)if(!i.beats[En].isRest){S=i.beats[En];break}let D=!1;b||(b=_,D=!0),S||(S=y);const T=this.helpers.beamHelperLookup[i.voice.index].get(_.index),C=this.helpers.beamHelperLookup[i.voice.index].get(y.index),v=T.getBeatLineX(_),x=C.getBeatLineX(y),q=this.helpers.beamHelperLookup[i.voice.index].get(b.index),W=this.helpers.beamHelperLookup[i.voice.index].get(S.index),L=this.getTupletBeamDirection(T);let H=this.calculateBeamYWithDirection(q,v,L),Ce=this.calculateBeamYWithDirection(W,x,L);D&&(H=Math.max(H,Ce),Ce=H),n.font=a.effectFont;const Re=n.measureText(u).width,Fe=3,De=(v+x)/2,Ve=De-Re/2-Fe,Dt=De+Re/2+Fe,at=(Ce-H)/(x-v),Bt=H-at*v,tt=at*Ve+Bt,Xn=at*De+Bt,as=at*Dt+Bt;L===V.Down&&(p*=-1,g*=-1),n.beginPath(),n.moveTo(e+this.x+v,t+this.y+H-p|0),o?n.quadraticCurveTo(e+this.x+(Ve+v)/2,t+this.y+tt-p-g|0,e+this.x+Ve,t+this.y+tt-p-g|0):(n.lineTo(e+this.x+v,t+this.y+H-p-g|0),n.lineTo(e+this.x+Ve,t+this.y+tt-p-g|0)),n.stroke(),n.beginPath(),n.moveTo(e+this.x+Dt,t+this.y+as-p-g|0),o?n.quadraticCurveTo(e+this.x+(x+Dt)/2,t+this.y+as-p-g|0,e+this.x+x,t+this.y+Ce-p|0):(n.lineTo(e+this.x+x,t+this.y+Ce-p-g|0),n.lineTo(e+this.x+x,t+this.y+Ce-p|0)),n.stroke(),n.fillText(u,e+this.x+De,t+this.y+Xn-p-g)}else for(const _ of i.beats){const y=this.helpers.beamHelperLookup[i.voice.index].get(_.index);if(!y)continue;const b=this.getTupletBeamDirection(y),S=y.getBeatLineX(_);let D=this.calculateBeamYWithDirection(y,S,b);b===V.Down?D+=p+g:D-=p+g,n.font=a.effectFont,n.fillText(u,e+this.x+S,t+this.y+D)}n.textAlign=l,n.textBaseline=c}finally{m?.[Symbol.dispose]?.()}}paintBeams(e,t,n,i,r){for(const o of this.helpers.beamHelpers)for(const a of o)this.paintBeamHelper(e+this.beatGlyphsStart,t,n,a,i,r)}drawBeamHelperAsFlags(e){return 1===e.beats.length}paintBeamHelper(e,t,n,i,r,o){n.color=0===i.voice.index?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,i.isRestBeamHelper||(this.drawBeamHelperAsFlags(i)?this.paintFlag(e,t,n,i,r):this.paintBar(e,t,n,i,o))}shouldPaintFlag(e,t){return!(e.graceType===Ee.BendGrace||e.deadSlapped||!t.hasBeatLineX(e)||e.graceType!==Ee.None&&this.settings.notation.notationMode===xi.SongBook||e.duration===w.Whole||e.duration===w.DoubleWhole||e.duration===w.QuadrupleWhole)}paintFlag(e,t,n,i,r){for(const o of i.beats){if(!this.shouldPaintFlag(o,i))continue;const a=o.graceType!==Ee.None,l=a?Pn.GraceScale:1,c=this.getFlagStemSize(i.shortestDuration),u=i.getBeatLineX(o),h=this.getBeamDirection(i);let d=this.getFlagTopY(o,h),p=this.getFlagBottomY(o,h),g=0;if(h===V.Down?(p+=c*l,g=p):(d-=c*l,g=d),!i.hasLine(!0,o))continue;this.paintBeamingStem(o,t+this.y,e+this.x+u,t+this.y+d,t+this.y+p,n);const m=yt.beat(n,r,o);try{if(o.graceType===Ee.BeforeBeat&&(n.beginPath(),h===V.Down?(n.moveTo(e+this.x+u-6,t+this.y+p-15),n.lineTo(e+this.x+u+6,t+this.y+p)):(n.moveTo(e+this.x+u-6,t+this.y+d+15),n.lineTo(e+this.x+u+6,t+this.y+d)),n.stroke()),i.hasFlag(!0,o)){const _=new Rw(u-.5,g,o.duration,h,a);_.renderer=this,_.doLayout(),_.paint(e+this.x,t+this.y,n)}}finally{m?.[Symbol.dispose]?.()}}}getFlagStemSize(e,t=!1){let n=0;switch(e){case w.QuadrupleWhole:case w.Half:case w.Quarter:case w.Eighth:case w.Sixteenth:case w.ThirtySecond:case w.SixtyFourth:case w.OneHundredTwentyEighth:case w.TwoHundredFiftySixth:n=3;break;default:n=t?3:0}return this.getLineHeight(n)}recreatePreBeatGlyphs(){this._startSpacing=!1,super.recreatePreBeatGlyphs()}calculateBeamY(e,t){return this.calculateBeamYWithDirection(e,t,this.getBeamDirection(e))}createPreBeatGlyphs(){super.createPreBeatGlyphs(),this.addPreBeatGlyph(new dx(!1)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new NV(0,this.getLineHeight(-.25),this.bar.index+1))}createPostBeatGlyphs(){super.createPostBeatGlyphs();const e=this.lastBar;this.addPostBeatGlyph(new dx(!0)),e.masterBar.isRepeatEnd&&e.masterBar.repeatCount>2&&this.addPostBeatGlyph(new Eie(0,this.getLineHeight(-.25),this.bar.masterBar.repeatCount))}paintBar(e,t,n,i,r){for(let o=0,a=i.beats.length;o<a;o++){const l=i.beats[o];if(!i.hasBeatLineX(l)||l.deadSlapped)continue;const u=l.graceType!==Ee.None?Pn.GraceScale:1,h=i.getBeatLineX(l),d=this.getBeamDirection(i),p=t+this.y+this.getBarLineStart(l,d),g=t+this.y+this.calculateBeamY(i,h);this.paintBeamingStem(l,t+this.y,e+this.x+h,p,g,n);const m=yt.beat(n,r,l);try{let _=g;d===V.Down?_+=2*n.font.size:0!==o&&(_-=1.5*n.font.size);const y=6*u;let b=(ss.BeamSpacing+ss.BeamThickness)*u,S=ss.BeamThickness*u;const D=ie.getIndex(l.duration)-2,T=t+this.y;d===V.Down&&(b=-b,S=-S);for(let C=0;C<D;C++){let v=0,x=0,q=0,W=0;const L=T+C*b;if(o<i.beats.length-1){const H=ja.isFullBarJoin(l,i.beats[o+1],C);if(C===D-1&&H&&l.beamingMode===jn.ForceSplitOnSecondaryToNext)v=h,x=v+y,q=L+this.calculateBeamY(i,v),W=L+this.calculateBeamY(i,x),Pl.paintSingleBar(n,e+this.x+v,q,e+this.x+x,W,S),x=i.getBeatLineX(i.beats[o+1]),v=x-y,q=L+this.calculateBeamY(i,v),W=L+this.calculateBeamY(i,x),Pl.paintSingleBar(n,e+this.x+v,q,e+this.x+x,W,S);else{if(H)v=h,x=i.getBeatLineX(i.beats[o+1]);else{if(0!==o&&ja.isFullBarJoin(i.beats[o-1],l,C))continue;v=h,x=v+y}q=L+this.calculateBeamY(i,v),W=L+this.calculateBeamY(i,x),Pl.paintSingleBar(n,e+this.x+v,q,e+this.x+x,W,S)}}else o>0&&!ja.isFullBarJoin(l,i.beats[o-1],C)&&(v=h-y,x=h,q=L+this.calculateBeamY(i,v),W=L+this.calculateBeamY(i,x),Pl.paintSingleBar(n,e+this.x+v,q,e+this.x+x,W,S))}}finally{m?.[Symbol.dispose]?.()}}}static paintSingleBar(e,t,n,i,r,o){e.beginPath(),e.moveTo(t,n),e.lineTo(i,r),e.lineTo(i,r+o),e.lineTo(t,n+o),e.closePath(),e.fill()}}class Iie extends Wh{paint(e,t,n){const i=yt.bar(n,Ht.StandardNotationKeySignature,this.renderer.bar);try{super.paint(e,t,n)}finally{i?.[Symbol.dispose]?.()}}}let fx=(()=>{class s extends Pl{constructor(t,n){super(t,n),this.simpleWhammyOverflow=0,this.beatEffectsMinY=null,this.beatEffectsMaxY=null,this.accidentalHelper=new Ga(this)}get repeatsBarSubElement(){return Ht.StandardNotationRepeats}get barNumberBarSubElement(){return Ht.StandardNotationBarNumber}get barLineBarSubElement(){return Ht.StandardNotationBarLines}get staffLineBarSubElement(){return Ht.StandardNotationStaffLine}get showMultiBarRest(){return!0}get lineSpacing(){return ss.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return this.bar.staff.standardNotationLineCount}registerBeatEffectOverflows(t,n){const i=this.beatEffectsMinY;(null==i||t<i)&&(this.beatEffectsMinY=t);const r=this.beatEffectsMaxY;(null==r||n>r)&&(this.beatEffectsMaxY=n)}getScoreY(t){return super.getLineY(t/2)}getScoreHeight(t){return super.getLineHeight(t/2)}doLayout(){if(super.doLayout(),!this.bar.isEmpty&&this.accidentalHelper.maxLineBeat){const t=this.getScoreY(-2),n=this.getScoreY(10),i=this.simpleWhammyOverflow,r=this.beatEffectsMinY;if(null!==r){const h=t-r;h>0&&this.registerOverflowTop(h)}const o=this.beatEffectsMaxY;if(null!==o){const h=o-n;h>0&&this.registerOverflowBottom(h)}this.registerOverflowTop(i);let a=this.getScoreY(this.accidentalHelper.maxLine);const l=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.maxLineBeat);l.direction===V.Up&&(a-=this.getStemSize(l),l.hasTuplet&&(a-=this.tupletSize)),a<t&&this.registerOverflowTop(Math.abs(a)+i);let c=this.getScoreY(this.accidentalHelper.minLine);const u=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.minLineBeat);u.direction===V.Down&&(c+=this.getStemSize(u),u.hasTuplet&&(c+=this.tupletSize)),c>n&&this.registerOverflowBottom(Math.abs(c)-n)}}paint(t,n,i){super.paint(t,n,i),this.paintBeams(t,n,i,In.StandardNotationFlags,In.StandardNotationBeams),this.paintTuplets(t,n,i,In.StandardNotationTuplet)}getSlashFlagY(t,n){let i=(this.heightLineCount-1)/2,r=0;switch(t){case w.QuadrupleWhole:case w.DoubleWhole:case w.Whole:r+=2;break;default:r+=1}return n===V.Down?i+=r:i-=r,this.getLineY(i)}getFlagTopY(t,n){return t.slashed?this.getSlashFlagY(t.duration,n):this.getScoreY(this.accidentalHelper.getMinLine(t))}getFlagBottomY(t,n){return t.slashed?this.getSlashFlagY(t.duration,n):this.getScoreY(this.accidentalHelper.getMaxLine(t))}getBeamDirection(t){return t.direction}getStemSize(t,n=!1){let i=1===t.beats.length?this.getFlagStemSize(t.shortestDuration,n):this.getBarStemSize(t.shortestDuration);return t.isGrace&&(i*=Pn.GraceScale),i}getBarStemSize(t){let n=0;switch(t){case w.QuadrupleWhole:case w.Half:case w.Quarter:case w.Eighth:case w.Sixteenth:n=6;break;case w.ThirtySecond:n=8;break;case w.SixtyFourth:case w.OneHundredTwentyEighth:n=9;break;case w.TwoHundredFiftySixth:n=10;break;default:n=0}return this.getScoreHeight(n)}get middleYPosition(){return this.getScoreY(this.bar.staff.standardNotationLineCount-1)}getNoteY(t,n){if(t.beat.slashed)return this.getLineY((this.heightLineCount-1)/2);let i=super.getNoteY(t,n);if(Number.isNaN(i)){const r=Ga.computeLineWithoutAccidentals(this.bar,t);i=this.getScoreY(r)}return i}applyLayoutingInfo(){const t=super.applyLayoutingInfo();if(t&&this.bar.isMultiVoice){const n=this.getScoreY(-2),i=this.getScoreY(10),r=this.helpers.collisionHelper.getBeatMinMaxY();r[0]<n&&this.registerOverflowTop(Math.abs(r[0])),r[1]>i&&this.registerOverflowBottom(Math.abs(r[1])-i)}return t}calculateBeamYWithDirection(t,n,i){const r=this.getStemSize(t);if(!t.drawingInfos.has(i)){const o=new pse;t.drawingInfos.set(i,o);const a=t.beats[0],l=t.beats[t.beats.length-1],c=t.isRestBeamHelper;o.startBeat=a,o.startX=t.getBeatLineX(a),o.startY=c?this.getScoreY(i===V.Up?t.minRestLine:t.maxRestLine):i===V.Up?this.getFlagTopY(a,i)-r:this.getFlagBottomY(a,i)+r,o.endBeat=l,o.endX=t.getBeatLineX(l),o.endY=c?this.getScoreY(i===V.Up?t.minRestLine:t.maxRestLine):i===V.Up?this.getFlagTopY(l,i)-r:this.getFlagBottomY(l,i)+r;const u=10;if(i===V.Down&&o.startY>o.endY&&o.startY-o.endY>u&&(o.endY=o.startY-u),i===V.Down&&o.endY>o.startY&&o.endY-o.startY>u&&(o.startY=o.endY-u),i===V.Up&&o.startY<o.endY&&o.endY-o.startY>u&&(o.endY=o.startY+u),i===V.Up&&o.endY<o.startY&&o.startY-o.endY>u&&(o.startY=o.endY+u),t.beats.length>1){if(i===V.Up){const h=this.getScoreY(this.accidentalHelper.getMinLine(t.beatOfHighestNote))-r,p=o.calcY(t.getBeatLineX(t.beatOfHighestNote))-h;p>0&&(o.startY-=p,o.endY-=p)}else{const p=this.getScoreY(this.accidentalHelper.getMaxLine(t.beatOfLowestNote))+r-o.calcY(t.getBeatLineX(t.beatOfLowestNote));p>0&&(o.startY+=p,o.endY+=p)}if(null!==t.minRestLine||null!==t.maxRestLine){let p=(ie.getIndex(t.shortestDuration)-2)*(ss.BeamSpacing+ss.BeamThickness)*(t.isGrace?Pn.GraceScale:1);if(p+=ss.BeamSpacing,i===V.Up&&null!==t.minRestLine){const g=this.getScoreY(t.minRestLine)-p,_=o.calcY(t.getBeatLineX(t.beatOfMinRestLine))-g;_>0&&(o.startY-=_,o.endY-=_)}else if(i===V.Down&&null!==t.maxRestLine){const _=this.getScoreY(t.maxRestLine)+p-o.calcY(t.getBeatLineX(t.beatOfMaxRestLine));_>0&&(o.startY+=_,o.endY+=_)}}if(t.slashBeats.length>0)for(const h of t.slashBeats){const d=o.calcY(t.getBeatLineX(h));let p=this.getSlashFlagY(h.duration,i);i===V.Up?p-=r:i===V.Down&&(p+=r);const g=p-d;g>0&&(o.startY+=g,o.endY+=g)}}}return t.drawingInfos.get(i).calcY(n)}getBarLineStart(t,n){return t.slashed?this.getSlashFlagY(t.duration,n):this.getScoreY(n===V.Up?this.accidentalHelper.getMaxLine(t):this.accidentalHelper.getMinLine(t))}createLinePreBeatGlyphs(){let t=!1;if(this.isFirstOfLine||this.bar.clef!==this.bar.previousBar.clef||this.bar.clefOttava!==this.bar.previousBar.clefOttava){let n=0;switch(this.bar.clef){case Et.Neutral:n=this.bar.staff.standardNotationLineCount-1;break;case Et.F4:n=2;break;case Et.C3:n=4;break;case Et.C4:n=2;break;case Et.G2:n=6}this.createStartSpacing(),this.addPreBeatGlyph(new ax(0,this.getScoreY(n)+.5*ss.StaffLineThickness,this.bar.clef,this.bar.clefOttava)),t=!0}(t||0===this.index&&this.bar.keySignature!==wt.C||this.bar.previousBar&&this.bar.keySignature!==this.bar.previousBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){let t=0;const n=this.bar.keySignature,i=this.bar.previousBar?this.bar.previousBar.keySignature:0;switch(this.bar.clef){case Et.Neutral:t=0;break;case Et.G2:t=1;break;case Et.F4:t=3;break;case Et.C3:t=2;break;case Et.C4:t=0}const r=new Iie;r.renderer=this;const o=new Map,a=[];if(ie.keySignatureIsSharp(n))for(let l=0;l<Math.abs(n);l++){const c=s.SharpKsSteps[l]+t;a.push(new Ml(0,this.getScoreY(c),Be.Sharp,1)),o.set(c,!0)}else for(let l=0;l<Math.abs(n);l++){const c=s.FlatKsSteps[l]+t;a.push(new Ml(0,this.getScoreY(c),Be.Flat,1)),o.set(c,!0)}if(this.bar.keySignature===wt.C){const l=Math.abs(i),c=ie.keySignatureIsSharp(i)?s.SharpKsSteps:s.FlatKsSteps;for(let u=0;u<l;u++)o.has(c[u]+t)||r.addGlyph(new Ml(0,this.getScoreY(c[u]+t),Be.Natural,1))}for(const l of a)r.addGlyph(l);this.addPreBeatGlyph(r)}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Ii(0,0,5)),this.addPreBeatGlyph(new ux(0,this.getScoreY(this.bar.staff.standardNotationLineCount-1),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(t){for(const n of t.beats){const i=new kie(n,this.getVoiceContainer(t));i.preNotes=new Sie,i.onNotes=new yie,this.addBeatGlyph(i)}}getNoteLine(t){return this.accidentalHelper.getNoteLine(t)}completeBeamingHelper(t){if(this.bar.isMultiVoice&&t.highestNoteInHelper&&t.lowestNoteInHelper){let n=this.getNoteY(t.highestNoteInHelper,be.Center),i=this.getNoteY(t.lowestNoteInHelper,be.Center),r=this.getStemSize(t);t.hasTuplet&&(r+=2*this.resources.effectFont.size),t.direction===V.Up?n-=r:i+=r;for(const o of t.beats)this.helpers.collisionHelper.reserveBeatSlot(o,n,i)}}paintBeamingStem(t,n,i,r,o,a){const l=yt.beat(a,In.StandardNotationStem,t);try{a.lineWidth=ss.StemWidth,a.beginPath(),a.moveTo(i,r),a.lineTo(i,o),a.stroke(),a.lineWidth=1}finally{l?.[Symbol.dispose]?.()}}}return s.StaffId="score",s.SharpKsSteps=[-1,2,-2,1,4,0,3],s.FlatKsSteps=[3,0,4,1,5,2,6],s})();class Bie extends lm{get staffId(){return fx.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new fx(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showStandardNotation}}class Mie extends os{constructor(e,t,n,i){super(0,0),this._inType=e,this._outType=t,this._startNote=n,this._parent=i}doLayout(){this.width=0}paint(e,t,n){this.paintSlideIn(e,t,n),this.paintSlideOut(e,t,n)}paintSlideIn(e,t,n){const i=this.renderer;let a=0,l=0,c=0,u=0;switch(this._inType){case ri.IntoFromBelow:c=e+i.x+i.getNoteX(this._startNote,Un.Left)-2,u=t+i.y+i.getNoteY(this._startNote,be.Center),a=c-12,l=t+i.y+i.getNoteY(this._startNote,be.Center)+3;break;case ri.IntoFromAbove:c=e+i.x+i.getNoteX(this._startNote,Un.Left)-2,u=t+i.y+i.getNoteY(this._startNote,be.Center),a=c-12,l=t+i.y+i.getNoteY(this._startNote,be.Center)-3;break;default:return}this.paintSlideLine(n,!1,a,c,l,u)}paintSlideOut(e,t,n){const i=this.renderer;let a=0,l=0,c=0,u=0,h=!1;switch(this._outType){case Qe.Shift:case Qe.Legato:if(a=e+i.x+i.getBeatX(this._startNote.beat,St.PostNotes)+2,l=t+i.y+i.getNoteY(this._startNote,be.Center),this._startNote.slideTarget){const p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._startNote.slideTarget.beat.voice.bar);p&&p.staff===i.staff?(c=e+p.x+p.getBeatX(this._startNote.slideTarget.beat,St.OnNotes)-2,u=t+p.y+p.getNoteY(this._startNote.slideTarget,be.Center)):(c=e+i.x+i.width,u=l),this._startNote.slideTarget.fret>this._startNote.fret?(l+=3,u-=3):(l-=3,u+=3)}else c=e+i.x+this._parent.x,u=l;break;case Qe.OutUp:a=e+i.x+i.getNoteX(this._startNote,Un.Right)+2,l=t+i.y+i.getNoteY(this._startNote,be.Center),c=a+12,u=t+i.y+i.getNoteY(this._startNote,be.Center)-3;break;case Qe.OutDown:a=e+i.x+i.getNoteX(this._startNote,Un.Right)+2,l=t+i.y+i.getNoteY(this._startNote,be.Center),c=a+12,u=t+i.y+i.getNoteY(this._startNote,be.Center)+3;break;case Qe.PickSlideDown:a=e+i.x+i.getNoteX(this._startNote,Un.Right)+4,l=t+i.y+i.getNoteY(this._startNote,be.Center),c=e+i.x+i.width,u=l+9,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(c=e+i.x+i.getBeatX(this._startNote.beat.nextBeat,St.PreNotes)),h=!0;break;case Qe.PickSlideUp:a=e+i.x+i.getNoteX(this._startNote,Un.Right)+4,l=t+i.y+i.getNoteY(this._startNote,be.Center),c=e+i.x+i.width,u=l-9,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(c=e+i.x+i.getBeatX(this._startNote.beat.nextBeat,St.PreNotes)),h=!0;break;default:return}this.paintSlideLine(n,h,a,c,l,u)}paintSlideLine(e,t,n,i,r,o){if(t){const a=new ku(0,0,Ft.Slight,1.2);a.renderer=this.renderer,a.doLayout();const l=i-n,c=(o-=a.height/2)-(r-=a.height/2),u=Math.sqrt(Math.pow(c,2)+Math.pow(l,2));a.width=l;const h=Math.asin(c/u)*(180/Math.PI);e.beginRotate(n,r,h),a.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(n,r),e.lineTo(i,o),e.stroke()}}class Cc extends Xo{constructor(e,t,n=!1){super(e.beat,t.beat,n),this.startNote=e,this.endNote=t}getTieHeight(e,t,n,i){return this.startNote===this.endNote?15:super.getTieHeight(e,t,n,i)}getBeamDirection(e,t){return this.startNote===this.endNote?V.Up:Cc.getBeamDirectionForNote(this.startNote)}static getBeamDirectionForNote(e){return e.string>3?V.Up:V.Down}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,this.startNote===this.endNote?be.Center:this.tieDirection===V.Up?be.Top:be.Bottom)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20:this.startNoteRenderer.getNoteX(this.startNote,Un.Center)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,this.startNote===this.endNote?Un.Left:Un.Center)}}class EV extends Cc{constructor(e,t,n,i=!1){super(e,t,i),this._direction=Cc.getBeamDirectionForNote(e),this._forSlide=n}getTieHeight(e,t,n,i){return Math.log(n-e+1)*this.renderer.settings.notation.slurHeight}tryExpand(e,t,n,i){if(this._forSlide!==n||this.forEnd!==i||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id||this._direction!==Cc.getBeamDirectionForNote(e))return!1;switch(this._direction){case V.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case V.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat)}return!0}paint(e,t,n){const i=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar),r=this.getBeamDirection(this.startBeat,i),o=`tab.slur.${this.startNote.beat.id}.${this.endNote.beat.id}.${r}`,a=this.renderer;a.staff.getSharedLayoutData(o,!1)||(a.staff.setSharedLayoutData(o,!0),super.paint(e,t,n))}}class Pie extends za{constructor(){super(...arguments),this._bend=null,this._effectSlurs=[]}drawBeamHelperAsFlags(e){return e.hasFlag(this.renderer.drawBeamHelperAsFlags(e),this.beat)}doLayout(){this._effectSlurs=[],super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(!e.isVisible)return;const t=this.renderer;if(e.isTieOrigin&&t.showTiedNotes&&e.tieDestination.isVisible){const n=new Cc(e,e.tieDestination,!1);this.addTie(n)}if(e.isTieDestination&&t.showTiedNotes){const n=new Cc(e.tieOrigin,e,!0);this.addTie(n)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){const n=new Cc(e,e,!1);this.addTie(n)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let n=!1;for(const i of this._effectSlurs)if(i.tryExpand(e,e.effectSlurDestination,!1,!1)){n=!0;break}if(!n){const i=new EV(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(i),this.addTie(i)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let n=!1;for(const i of this._effectSlurs)if(i.tryExpand(e.effectSlurOrigin,e,!1,!0)){n=!0;break}if(!n){const i=new EV(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(i),this.addTie(i)}}if(e.slideInType!==ri.None||e.slideOutType!==Qe.None){const n=new Mie(e.slideInType,e.slideOutType,e,this);this.addTie(n)}if(e.hasBend){if(!this._bend){const n=new SV;this._bend=n,n.renderer=this.renderer,this.addTie(n)}this._bend.addBends(e)}}}class Aie extends os{constructor(e,t,n){super(e,t),this._noteString=null,this._trillNoteString=null,this._trillNoteStringWidth=0,this.isEmpty=!1,this.noteStringWidth=0,this._note=n}doLayout(){const e=this._note;let t=e.fret-e.beat.voice.bar.staff.transpositionPitch;if(e.harmonicType===Ie.Natural&&0!==e.harmonicValue&&(t=e.harmonicValue-e.beat.voice.bar.staff.transpositionPitch),e.isTieDestination)this._noteString=0===e.beat.index&&this.renderer.settings.notation.notationMode===xi.GuitarPro||(e.bendType===me.Bend||e.bendType===me.BendRelease)&&this.renderer.settings.notation.isNotationElementVisible(dt.TabNotesOnTiedBends)?`(${(e.tieOrigin.fret-e.beat.voice.bar.staff.transpositionPitch).toString()})`:"";else if(this._noteString=e.isDead?"x":t.toString(),e.isGhost)this._noteString=`(${this._noteString})`;else if(e.harmonicType===Ie.Natural){const n=this._noteString.indexOf(".");n>=0&&(this._noteString=this._noteString.substr(0,n+2)),this._noteString=`<${this._noteString}>`}if(e.isTrill)this._trillNoteString=`(${(e.trillFret-e.beat.voice.bar.staff.transpositionPitch).toString()})`;else if(ie.isAlmostEqualTo(e.harmonicValue,0))this._trillNoteString="";else switch(e.harmonicType){case Ie.Artificial:case Ie.Pinch:case Ie.Tap:case Ie.Semi:case Ie.Feedback:let n=(t+e.harmonicValue).toString();const i=n.indexOf(".");i>=0&&(n=n.substr(0,i+2)),this._trillNoteString=`<${n}>`;break;default:this._trillNoteString=""}this.isEmpty=!this._noteString,this.isEmpty||(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.tablatureFont,this.noteStringWidth=this.renderer.scoreRenderer.canvas.measureText(this._noteString).width,this.width=this.noteStringWidth,this.height=this.renderer.scoreRenderer.canvas.font.size,this._trillNoteString&&(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,this._trillNoteStringWidth=3+this.renderer.scoreRenderer.canvas.measureText(this._trillNoteString).width,this.width+=this._trillNoteStringWidth))}paint(e,t,n){if(this.isEmpty)return;const r=e+this.x+(this.width-(this.noteStringWidth+this._trillNoteStringWidth))/2;this.paintTrill(r,t,n);const o=yt.note(n,Qi.GuitarTabFretNumber,this._note);try{n.fillText(this._noteString,r,t+this.y)}finally{o?.[Symbol.dispose]?.()}}paintTrill(e,t,n){const i=yt.note(n,Qi.GuitarTabFretNumber,this._note);try{const r=this.renderer.scoreRenderer.canvas.font;this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,n.fillText(this._trillNoteString,e+this.noteStringWidth+3,t+this.y),this.renderer.scoreRenderer.canvas.font=r}finally{i?.[Symbol.dispose]?.()}}buildBoundingsLookup(e,t,n){const i=new Bf;i.note=this._note,i.noteHeadBounds=new bi,i.noteHeadBounds.x=t+this.x,i.noteHeadBounds.y=n+this.y-this.height/2,i.noteHeadBounds.w=this.width,i.noteHeadBounds.h=this.height,e.addNote(i)}}class Rie extends os{constructor(e,t,n){super(e,t),this._notes=[],this._deadSlapped=null,this.minStringNote=null,this.beatEffects=new Map,this.notesPerString=new Map,this.noteStringWidth=0,this._isGrace=n}buildBoundingsLookup(e,t,n){for(const i of this._notes)i.buildBoundingsLookup(e,t+this.x,n+this.y)}getNoteX(e,t){if(this.notesPerString.has(e.string)){const n=this.notesPerString.get(e.string);let i=this.x+n.x;switch(t){case Un.Left:break;case Un.Center:i+=n.noteStringWidth/2;break;case Un.Right:i+=n.width}return i}return 0}getNoteY(e,t){if(this.notesPerString.has(e.string)){const n=this.notesPerString.get(e.string);let i=this.y+n.y;switch(t){case be.Top:case be.TopWithStem:i-=n.height/2+2;break;case be.Center:break;case be.Bottom:case be.BottomWithStem:i+=n.height/2}return i}return 0}doLayout(){let e=0;if(this.beat.deadSlapped)this._deadSlapped=new jw,this._deadSlapped.renderer=this.renderer,this._deadSlapped.doLayout(),e=this._deadSlapped.width,this.noteStringWidth=e;else{let t=0;for(let o=0,a=this._notes.length;o<a;o++){const l=this._notes[o];l.renderer=this.renderer,l.doLayout(),l.width>e&&(e=l.width),l.noteStringWidth>t&&(t=l.noteStringWidth)}this.noteStringWidth=t;const n=this.renderer.resources.tablatureFont.size;let i=this.getNoteY(this.minStringNote,be.Center)+n/2;const r=7;for(const o of this.beatEffects.values())o.y+=i,o.x+=this.width/2,o.renderer=this.renderer,i+=r,o.doLayout()}this.width=e}addNoteGlyph(e,t){this._notes.push(e),this.notesPerString.set(t.string,e),(!this.minStringNote||t.string<this.minStringNote.string)&&(this.minStringNote=t)}paint(e,t,n){if(e+=this.x,t+=this.y,this.beat.deadSlapped)this._deadSlapped?.paint(e,t,n);else{const i=this.renderer.resources,r=n.textBaseline;n.textBaseline=qe.Middle,n.font=this._isGrace?i.graceFont:i.tablatureFont;const o=this._notes,a=this.width;for(const c of o)c.renderer=this.renderer,c.width=a,c.paint(e,t,n);n.textBaseline=r;const l=yt.beat(n,In.GuitarTabEffects,this.beat);try{for(const c of this.beatEffects.values())c.paint(e,t,n)}finally{l?.[Symbol.dispose]?.()}}}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class Fie extends Us{constructor(e,t,n,i){super(e,t,1,dm.getSymbol(i)),this._isVisibleRest=n}doLayout(){super.doLayout(),this._isVisibleRest||(this.width=10)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,n){if(this._isVisibleRest){const i=yt.beat(n,In.GuitarTabRests,this.beat);try{super.paint(e,t,n)}finally{i?.[Symbol.dispose]?.()}}}}class Oie extends vu{constructor(){super(...arguments),this.slash=null,this.noteNumbers=null,this.restGlyph=null}get effectElement(){return In.GuitarTabEffects}getNoteX(e,t){return this.noteNumbers?this.noteNumbers.getNoteX(e,t):0}getNoteY(e,t){return this.noteNumbers?this.noteNumbers.getNoteY(e,t):0}buildBoundingsLookup(e,t,n){this.noteNumbers&&this.noteNumbers.buildBoundingsLookup(e,t+this.x,n+this.y)}doLayout(){const e=this.renderer;if(this.container.beat.isRest){const n=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),i=e.getTabY(n),r=new Fie(0,i,e.showRests,this.container.beat.duration);if(this.restGlyph=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper,this.addNormal(r),this.container.beat.dots>0&&e.showRests){this.addNormal(new Ii(0,0,5));for(let o=0;o<this.container.beat.dots;o++)this.addEffect(new hm(0,i,1.5))}}else{const n=this.renderer.settings.notation.smallGraceTabNotes&&this.container.beat.graceType!==Ee.None;let i;if(this.container.beat.slashed&&!this.container.beat.notes.some(r=>r.isTieDestination)){const r=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),o=e.getLineY(r),a=new fm(0,o,this.container.beat.duration,n,this.container.beat);a.noteHeadElement=Qi.GuitarTabFretNumber,a.effectElement=In.GuitarTabEffects,this.slash=a,a.beat=this.container.beat,a.beamingHelper=this.beamingHelper,this.addNormal(a),i=a.beatEffects}else{const r=new Rie(0,0,n);this.noteNumbers=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper;for(const o of this.container.beat.notes)o.isVisible&&this.createNoteGlyph(o);this.addNormal(r),i=r.beatEffects}if(this.container.beat.hasWhammyBar){const r=new vV(this.container.beat);r.renderer=this.renderer,r.doLayout(),this.container.ties.push(r)}if(this.container.beat.isTremolo&&!i.has("tremolo")){let r=0;const o=this.container.beat.tremoloSpeed;let a=5;switch(o){case w.ThirtySecond:r=10;break;case w.Sixteenth:r=5;break;case w.Eighth:r=0}this.container.beat.duration<w.Half&&(a=0),i.set("tremolo",new $w(a,r,o))}if(this.container.beat.dots>0&&e.rhythmMode!==Wa.Hidden){this.addNormal(new Ii(0,0,5));for(let r=0;r<this.container.beat.dots;r++)this.addEffect(new hm(0,e.lineOffset*e.bar.staff.tuning.length+e.settings.notation.rhythmHeight,1.5))}}if(this.isEmpty)return;let t=0;for(let n=0,i=this.glyphs.length;n<i;n++){const r=this.glyphs[n];r.x=t,r.renderer=this.renderer,r.doLayout(),t+=r.width}this.width=t,this.computedWidth=t,this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteNumbers?this.centerX=this.noteNumbers.x+this.noteNumbers.noteStringWidth/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2)}updateBeamingHelper(){this.noteNumbers?this.noteNumbers.updateBeamingHelper(this.container.x+this.x):this.restGlyph?this.restGlyph.updateBeamingHelper(this.container.x+this.x):this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}createNoteGlyph(e){const t=this.renderer,n=new Aie(0,0,e);n.y=t.getTabY(e.beat.voice.bar.staff.tuning.length-e.string),n.renderer=this.renderer,n.doLayout(),this.noteNumbers.addNoteGlyph(n,e);const r=n.y-n.height/2;this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,r,r+n.height)}}class Lie extends os{constructor(e){super(0,0),this._beat=e}doLayout(){this.width=10}paint(e,t,n){const i=this.renderer,r=t+this.x+i.getNoteY(this._beat.maxStringNote,be.Top),o=t+this.y+i.getNoteY(this._beat.minStringNote,be.Bottom),a=e+this.x+this.width/2|0;if(this._beat.brushType!==fe.None){if(this._beat.brushType===fe.BrushUp||this._beat.brushType===fe.BrushDown)n.beginPath(),n.moveTo(a,r),n.lineTo(a,o),n.stroke();else if(this._beat.brushType===fe.ArpeggioUp){const c=new ku(0,0,Ft.Slight,1.2,!0);c.renderer=this.renderer,c.doLayout();const h=o-8;c.width=Math.abs(h-r),n.beginRotate(e+this.x+4,h,-90),c.paint(0,-c.height/2,n),n.endRotate()}else if(this._beat.brushType===fe.ArpeggioDown){const c=new ku(0,0,Ft.Slight,1.2,!0);c.renderer=this.renderer,c.doLayout();const u=r+8;c.width=Math.abs(o-u),n.beginRotate(e+this.x+4,u,90),c.paint(0,-c.height/2,n),n.endRotate()}this._beat.brushType===fe.BrushUp||this._beat.brushType===fe.ArpeggioUp?(n.beginPath(),n.moveTo(a,o),n.lineTo(a+4,o-8),n.lineTo(a-4,o-8),n.closePath(),n.fill()):(n.beginPath(),n.moveTo(a,r),n.lineTo(a+4,r+8),n.lineTo(a-4,r+8),n.closePath(),n.fill())}}}class Vie extends Su{doLayout(){this.container.beat.brushType!==fe.None&&!this.container.beat.isRest&&(this.addEffect(new Lie(this.container.beat)),this.addNormal(new Ii(0,0,4))),super.doLayout()}get effectElement(){return In.GuitarTabEffects}}class Hie extends os{doLayout(){this.width=on.Widths.get(f.SixStringTabClef)}paint(e,t,n){const i=yt.bar(n,Ht.GuitarTabsClef,this.renderer.bar);try{const r=this.renderer.bar.staff.tuning.length;n.fillMusicFontSymbol(e+this.x+5,t+this.y,r<=4?r/4.5:r/6.5,r<=4?f.FourStringTabClef:f.SixStringTabClef,!1)}finally{i?.[Symbol.dispose]?.()}}}class Wie extends CV{doLayout(){this.barSubElement=Ht.GuitarTabsTimeSignature,super.doLayout()}get commonScale(){return 1}get numberScale(){return this.renderer.bar.staff.tuning.length<=4?Pn.GraceScale:1}}let px=(()=>{class s extends Pl{get showMultiBarRest(){return this._showMultiBarRest}get repeatsBarSubElement(){return Ht.GuitarTabsRepeats}get barNumberBarSubElement(){return Ht.GuitarTabsBarNumber}get barLineBarSubElement(){return Ht.GuitarTabsBarLines}get staffLineBarSubElement(){return Ht.GuitarTabsStaffLine}constructor(t,n){super(t,n),this._hasTuplets=!1,this.showTimeSignature=!1,this.showRests=!1,this.showTiedNotes=!1,this._showMultiBarRest=!1,n.staff.showStandardNotation||(this.showTimeSignature=!0,this.showRests=!0,this.showTiedNotes=!0,this._showMultiBarRest=!0)}get lineSpacing(){return s.TabLineSpacing}get heightLineCount(){return this.bar.staff.tuning.length}get drawnLineCount(){return this.bar.staff.tuning.length}get rhythmMode(){let t=this.settings.notation.rhythmMode;return t===Wa.Automatic&&(t=this.bar.staff.showStandardNotation?Wa.Hidden:Wa.ShowWithBars),t}getTabY(t){return super.getLineY(t)}getTabHeight(t){return super.getLineHeight(t)}collectSpaces(t){for(const i of this.bar.voices)if(this.hasVoiceContainer(i)){const r=this.getVoiceContainer(i);for(const o of r.beatGlyphs){const a=o.onNotes,l=a.noteNumbers;if(l)for(const[c,u]of l.notesPerString)u.isEmpty||t[this.bar.staff.tuning.length-c].push(new Float32Array([r.x+o.x+a.x+l.x,l.width+1]))}}}adjustSizes(){this.rhythmMode!==Wa.Hidden&&(this.height+=this.settings.notation.rhythmHeight,this.bottomPadding+=this.settings.notation.rhythmHeight)}doLayout(){if(super.doLayout(),this.rhythmMode!==Wa.Hidden){this._hasTuplets=!1;for(const t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){this._hasTuplets=!0;break}this._hasTuplets&&this.registerOverflowBottom(this.tupletSize)}}createLinePreBeatGlyphs(){this.isFirstOfLine&&this.addPreBeatGlyph(new Hie(5,this.getTabY((this.bar.staff.tuning.length-1)/2))),this.showTimeSignature&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Ii(0,0,5)),this.addPreBeatGlyph(new Wie(0,this.getTabY((this.bar.staff.tuning.length+1)/2-1),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(t){if(this.additionalMultiRestBars){const n=new Uw(this.getVoiceContainer(t));this.addBeatGlyph(n)}else for(const n of t.beats){const i=new Pie(n,this.getVoiceContainer(t));i.preNotes=new Vie,i.onNotes=new Oie,this.addBeatGlyph(i)}}paint(t,n,i){super.paint(t,n,i),this.rhythmMode!==Wa.Hidden&&(this.paintBeams(t,n,i,In.GuitarTabFlags,In.GuitarTabBeams),this.paintTuplets(t,n,i,In.GuitarTabTuplet))}drawBeamHelperAsFlags(t){return super.drawBeamHelperAsFlags(t)||this.rhythmMode===Wa.ShowWithBeams}getFlagTopY(t,n){const i=this.getOnNotesGlyphForBeat(t);return i.noteNumbers&&t.duration!==w.Half?i.noteNumbers.getNoteY(i.noteNumbers.minStringNote,be.Bottom):this.height-this.settings.notation.rhythmHeight-this.tupletSize}getFlagBottomY(t,n){return this.getFlagAndBarPos()}getFlagStemSize(t,n=!1){return 0}getBarLineStart(t,n){const i=this.getOnNotesGlyphForBeat(t);return i.noteNumbers&&t.duration!==w.Half?i.noteNumbers.getNoteY(i.noteNumbers.minStringNote,be.Bottom)+this.lineOffset/2:this.height-this.settings.notation.rhythmHeight-this.tupletSize}getBeamDirection(t){return V.Down}getFlagAndBarPos(){return this.height-(this._hasTuplets?this.tupletSize/2:0)}calculateBeamYWithDirection(t,n,i){return this.getFlagAndBarPos()}shouldPaintFlag(t,n){return!(!super.shouldPaintFlag(t,n)||t.graceType!==Ee.None)&&this.drawBeamHelperAsFlags(n)}paintBeamingStem(t,n,i,r,o,a){if(o<r){const c=o;o=r,r=c}const l=yt.beat(a,In.GuitarTabStem,t);try{a.lineWidth=ss.StemWidth,a.beginPath();let c=[];this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.has(t.displayStart)&&(c=this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.get(t.displayStart).slots.slice(),c.sort((h,d)=>h.topY-d.topY));let u=o;for(;u>r;){a.moveTo(i,u);let h=r;if(!(c.length>0&&c[c.length-1].bottomY>h)){a.lineTo(i,h);break}{const d=c.pop();h=n+d.bottomY,a.lineTo(i,h),u=n+d.topY}}a.stroke(),a.lineWidth=1}finally{l?.[Symbol.dispose]?.()}}}return s.StaffId="tab",s.TabLineSpacing=10,s})();class gx extends lm{get staffId(){return px.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}constructor(){super(),this.showTimeSignature=null,this.showRests=null,this.showTiedNotes=null,this.hideOnPercussionTrack=!0}canCreate(e,t){return t.showTablature&&t.tuning.length>0&&super.canCreate(e,t)}create(e,t){const n=new px(e,t);return null!==this.showRests&&(n.showRests=this.showRests),null!==this.showTimeSignature&&(n.showTimeSignature=this.showTimeSignature),null!==this.showTiedNotes&&(n.showTiedNotes=this.showTiedNotes),n}}let Gie=(()=>{class s extends ro{constructor(){super(0,0)}doLayout(){super.doLayout(),this.height=this.renderer.resources.effectFont.size+s.Padding}paint(t,n,i){i.font=this.renderer.resources.effectFont;const o=i.textAlign;i.textAlign=ye.Center,i.fillText("T",t+this.x,n+this.y+i.font.size/2),i.textAlign=o,i.strokeCircle(t+this.x,n+this.y+i.font.size/2+(s.Padding-1),i.font.size/1.6)}}return s.Padding=4,s})();class IV extends Uh{get notationElement(){return dt.EffectTap}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyphForNote(e){return e.isLeftHandTapped}createNewGlyph(e,t){return new Gie}}class Dc{constructor(){this.noteRange=1,this.x=0,this.y=0}}var Rf=function(s){return s[s.None=0]="None",s[s.Rectangle=1]="Rectangle",s[s.Ellipse=2]="Ellipse",s[s.Circle=3]="Circle",s}(Rf||{});class mx extends Dc{constructor(){super(...arguments),this.align=ye.Left,this.frame=Rf.None,this.text="",this.fontFace="",this.weight=0,this.height=0}}class BV extends Dc{constructor(){super(...arguments),this.chord=new gc}}class MV extends Dc{}class PV extends Dc{}class Uie extends Dc{constructor(){super(...arguments),this.number=0}}class AV extends Dc{constructor(){super(...arguments),this.decrescendo=!1}}class yx extends Dc{constructor(){super(...arguments),this.allNumbers=!1,this.firstNumber=0,this.lastNumber=0}}class zie extends Dc{constructor(){super(...arguments),this.octave=1}}class qie extends Dc{}class $ie{constructor(){this.defaultClef=Et.G2,this.description="",this.percussion=!1,this.instrument=0,this.volume=0,this.transpose=0,this.index=0}}class jie{constructor(){this.from=0,this.to=0,this.curly=!1}}class Yie{constructor(){this.currentBarIndex=-1,this.currentBarComplete=!0,this.currentBarDuration=0,this.currentPosition=0,this.voiceStemDir=null,this.repeatCount=0,this.repeatEnd=null}}class Xw{constructor(){this._trackChannel=0,this._beamingMode=jn.Auto,this._isFirstSystem=!0,this._staffLookup=new Map,this._brackets=[],this._staffLayoutLookup=new Map,this._staffLayouts=[],this._timeSignature=new kl,this._voiceStates=new Map}parseXml(e,t){this._galleryObjects=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._voiceCounts=new Map,this._slurs=new Map,this._crescendo=new Map,this._isFirstSystem=!0;const n=new qg;try{n.parse(e)}catch(i){throw new Ts("Could not parse XML",i)}this.parseDom(n),this.consolidate(),this.score.finish(t)}consolidate(){ie.consolidate(this.score),Xw.applyEffectRange(this._slurs,(e,t)=>{t.isLegatoOrigin=!0}),Xw.applyEffectRange(this._crescendo,(e,t)=>{t.crescendo=e.decrescendo?Zi.Decrescendo:Zi.Crescendo})}static applyEffectRange(e,t){for(const[n,i]of e){const r=i.noteRange;let o=n;for(let a=0;a<r;a++)if(t(i,o),o.index+1<o.voice.beats.length)o=o.voice.beats[o.index+1];else{if(!(o.voice.bar.index+1<o.voice.bar.staff.bars.length))break;o=o.voice.bar.staff.bars[o.voice.bar.index+1].voices[o.voice.index].beats[0]}}}parseDom(e){const t=e.firstElement;if(!t)throw new Ts("No valid XML");if("score"!==t.localName)throw new Ts('Root node of XML was not "score"');this.score=new Cl,this.score.tempo=120;for(const n of t.childElements())switch(n.localName){case"info":this.parseInfo(n);break;case"layout":this.parseLayout(n);break;case"gallery":this.parseGallery(n);break;case"pageObjects":this.parsePageObjects(n);break;case"systems":this.parseSystems(n)}}parseLayout(e){for(const r of e.childElements())switch(r.localName){case"staves":this.parseLayoutStaves(r);break;case"brackets":this.parseBrackets(r)}const t=this._brackets.filter(r=>!!r.curly);t.sort((r,o)=>r.from-o.from);let n=0,i=null;for(let r=0;r<this._staffLayouts.length;r++){const o=this._staffLayouts[r];for(;n<t.length&&r>t[n].to;)n++;i&&n<t.length&&r>t[n].from&&r<=t[n].to?i.ensureStaveCount(i.staves.length+1):(i=new Ph,i.ensureStaveCount(1),i.name=o.description,i.playbackInfo.volume=Math.floor(o.volume/128*16),i.playbackInfo.program=o.instrument,o.percussion?(i.playbackInfo.primaryChannel=9,i.playbackInfo.secondaryChannel=9):(i.playbackInfo.primaryChannel=this._trackChannel++,i.playbackInfo.secondaryChannel=this._trackChannel++),this.score.addTrack(i));const a=i.staves[i.staves.length-1];a.isPercussion=o.percussion,a.transpositionPitch=o.transpose,a.displayTranspositionPitch=0,a.showTablature=!1,this._staffLookup.set(o.index,a)}}parseBrackets(e){for(const t of e.childElements())"bracket"===t.localName&&this.parseBracket(t)}parseBracket(e){const t=new jie;t.from=Number.parseInt(e.getAttribute("from")),t.to=Number.parseInt(e.getAttribute("to")),e.attributes.has("curly")&&(t.curly="true"===e.attributes.get("curly")),this._brackets.push(t)}parseLayoutStaves(e){for(const t of e.childElements())"staffLayout"===t.localName&&this.parseStaffLayout(t)}parseStaffLayout(e){const t=new $ie;t.description=e.getAttribute("description");for(const n of e.childElements())switch(n.localName){case"notation":n.attributes.has("defaultClef")&&(t.defaultClef=this.parseClef(n.attributes.get("defaultClef")));break;case"sound":n.attributes.has("percussion")&&(t.percussion="true"===n.attributes.get("percussion")),n.attributes.has("instr")&&(t.instrument=Number.parseInt(n.attributes.get("instr"))),n.attributes.has("volume")&&(t.volume=Number.parseInt(n.attributes.get("volume"))),n.attributes.has("transpose")&&(t.transpose=Number.parseInt(n.attributes.get("transpose")))}this._staffLayoutLookup.set(t.description,t),t.index=this._staffLayouts.length,this._staffLayouts.push(t)}parseClef(e){switch(e){case"treble":return Et.G2;case"bass":return Et.F4;case"alto":case"tenor":return Et.C4}return Et.G2}parseClefOttava(e){return e.endsWith("-")?Ze._8vb:e.endsWith("+")?Ze._8va:Ze.Regular}parseSystems(e){for(const t of e.childElements())"system"===t.localName&&this.parseSystem(t)}parseSystem(e){e.attributes.has("tempo")&&0===this.score.masterBars.length&&(this.score.tempo=Number.parseInt(e.attributes.get("tempo"))),"0"===e.getAttribute("beamGrouping")&&(this._beamingMode=jn.ForceSplitToNext);for(const t of e.childElements())"staves"===t.localName&&this.parseStaves(e,t);this._isFirstSystem=!1}parseStaves(e,t){const n=this.score.masterBars.length;for(const i of t.childElements())"staff"===i.localName&&this.parseStaff(e,n,i)}parseStaff(e,t,n){const i=n.getAttribute("layout");this._currentStaffLayout=this._staffLayoutLookup.get(i),this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!1,this.parseTime(n.getAttribute("defaultTime"));const r=this._staffLookup.get(this._currentStaffLayout.index);for(;r.bars.length<t;)this.addNewBar(r);for(const o of n.childElements())"voices"===o.localName&&this.parseVoices(i,r,e,t,o)}parseTime(e){switch(e){case"allaBreve":case"C":this._timeSignature.timeSignatureNumerator=2,this._timeSignature.timeSignatureDenominator=2,this._timeSignature.timeSignatureCommon=!0;break;case"longAllaBreve":this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!0;break;default:if(e.indexOf("/")>0){const t=e.split("/");this._timeSignature.timeSignatureNumerator=Number.parseInt(t[0]),this._timeSignature.timeSignatureDenominator=Number.parseInt(t[1]),this._timeSignature.timeSignatureCommon=!1}}}parseVoices(e,t,n,i,r){let o=0;for(const a of r.childElements())"voice"===a.localName&&(this.parseVoice(e,t,n,o,i,a),o++)}getOrCreateBar(e,t){return t<e.bars.length?e.bars[t]:this.addNewBar(e)}addNewBar(e){const t=new Sl;if(e.bars.length>0?(t.clef=e.bars[e.bars.length-1].clef,t.clefOttava=e.bars[e.bars.length-1].clefOttava,t.keySignature=e.bars[e.bars.length-1].keySignature,t.keySignatureType=e.bars[e.bars.length-1].keySignatureType):t.clef=this._currentStaffLayout.defaultClef,e.addBar(t),e.bars.length>this.score.masterBars.length){const n=new kl;this.score.addMasterBar(n),n.index>0&&(n.tripletFeel=n.previousMasterBar.tripletFeel),n.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,n.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,n.timeSignatureCommon=this._timeSignature.timeSignatureCommon}return t}newBar(e,t){this._currentVoiceState.currentBarIndex++,this._currentBar=this.getOrCreateBar(e,this._currentVoiceState.currentBarIndex),this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1),this._currentVoiceState.currentBarComplete=!1,this._currentVoiceState.currentPosition=0,this.ensureVoice(e,t)}parseVoice(e,t,n,i,r,o){const a=`${e}_${i}`;if(this._currentVoiceState&&!this._currentVoiceState.currentBarComplete&&(this._currentBar.masterBar.isAnacrusis=!0),this._voiceStates.has(a)?(this._currentVoiceState=this._voiceStates.get(a),this._currentBar=this.getOrCreateBar(t,this._currentVoiceState.currentBarIndex),this.ensureVoice(t,i)):(this._currentVoiceState=new Yie,this._currentVoiceState.currentBarIndex=r-1,this._voiceStates.set(a,this._currentVoiceState),this.newBar(t,i)),o.attributes.has("stemDir"))switch(o.attributes.get("stemDir")){case"up":this._currentVoiceState.voiceStemDir=V.Up;break;case"down":this._currentVoiceState.voiceStemDir=V.Down;break;default:this._currentVoiceState.voiceStemDir=null}else this._currentVoiceState.voiceStemDir=null;const l=o.findChildElement("noteObjects");if(n.attributes.has("tempo")){const c=new fs;c.isLinear=!0,c.type=$n.Tempo,c.value=Number.parseInt(n.attributes.get("tempo")),c.ratioPosition=this._currentVoiceState.currentPosition/this._currentVoiceState.currentBarDuration,this._currentBar.masterBar.tempoAutomations.push(c)}if(l)for(const c of l.childElements())switch(this._currentVoiceState.currentBarComplete&&"barline"!==c.localName&&this.newBar(t,i),c.localName){case"clefSign":this._currentBar.clef=this.parseClef(c.getAttribute("clef")),this._currentBar.clefOttava=this.parseClefOttava(c.getAttribute("clef"));break;case"keySign":this._currentBar.keySignature=Number.parseInt(c.getAttribute("fifths"));break;case"timeSign":this.parseTime(c.getAttribute("time")),this._currentBar.masterBar.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,this._currentBar.masterBar.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,this._currentBar.masterBar.timeSignatureCommon=this._timeSignature.timeSignatureCommon,this._currentVoiceState.currentPosition=0,this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1);break;case"barline":switch(c.getAttribute("type")){case"double":this._currentBar.barLineRight=We.LightLight,this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"end":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0);break;case"repEnd":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(c),this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"repBegin":this.newBar(t,i),this._currentBar.masterBar.isRepeatStart=!0,this._currentVoiceState.repeatEnd=null,this._currentVoiceState.repeatCount=0;break;case"repEndBegin":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(c),this.newBar(t,i),this._currentBar.masterBar.isRepeatStart=!0;break;default:this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0}break;case"chord":const u=new Ei;this.initFromPreviousBeat(u,this._currentVoice),u.beamingMode=this._beamingMode,this._currentVoiceState.voiceStemDir&&(u.preferredBeamDirection=this._currentVoiceState.voiceStemDir),this.parseDuration(this._currentBar,u,c.findChildElement("duration")),u.updateDurations(),this._currentVoiceState.currentPosition+=u.playbackDuration,this._currentVoice.addBeat(u),this.parseChord(u,c),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0);break;case"rest":const h=this.parseRestDurations(this._currentBar,c.findChildElement("duration"));h&&(this.initFromPreviousBeat(h,this._currentVoice),h.updateDurations(),this._currentVoiceState.currentPosition+=h.playbackDuration,this._currentVoice.addBeat(h),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0))}}initFromPreviousBeat(e,t){const n=this.getLastBeat(t);n&&(e.dynamics=n.dynamics)}getLastBeat(e){if(e.beats.length>0)return e.beats[e.beats.length-1];if(e.bar.index>0){const t=e.bar.staff.bars[e.bar.index-1];if(e.index<t.voices.length)return this.getLastBeat(t.voices[e.index])}return null}ensureVoice(e,t){for(;this._currentBar.voices.length<t+1;)this._currentBar.addVoice(new ko);(!this._voiceCounts.has(e.track.index)||this._voiceCounts.get(e.track.index)<this._currentBar.voices.length)&&this._voiceCounts.set(e.track.index,this._currentBar.voices.length),this._currentVoice=this._currentBar.voices[t]}parseChord(e,t){const n=new Co;for(const i of t.childElements())switch(i.localName){case"stem":switch(i.getAttribute("dir")){case"up":e.preferredBeamDirection=V.Up;break;case"down":e.preferredBeamDirection=V.Down}break;case"articulation":switch(i.getAttribute("type")){case"staccato":n.isStaccato=!0;break;case"normalAccent":n.accentuated=Ss.Normal;break;case"strongAccent":n.accentuated=Ss.Heavy}break;case"lyric":this.parseLyric(e,i);break;case"drawObjects":this.parseBeatDrawObject(e,i);break;case"heads":this.parseHeads(e,n,i);break;case"beam":switch(i.getAttribute("group")){case"force":e.beamingMode=jn.ForceMergeWithNext;break;case"divide":e.beamingMode=jn.ForceSplitToNext}}}parseHeads(e,t,n){for(const i of n.childElements())"head"===i.localName&&this.parseHead(e,t,i)}parseHead(e,t,n){const i=new Co,r=ie.parseTuning(n.getAttribute("pitch"));i.octave=r.octave-1,i.tone=r.tone.noteValue,i.isStaccato=t.isStaccato,i.accentuated=t.accentuated,e.addNote(i);for(const o of n.childElements())switch(o.localName){case"alter":o.attributes.has("step")&&(i.tone+=Number.parseInt(o.attributes.get("step")));break;case"tie":o.attributes.has("begin")?this._tieStartIds.has(i.id)||(this._tieStartIds.set(i.id,!0),this._tieStarts.push(i)):o.attributes.has("end")&&this._tieStarts.length>0&&!i.isTieDestination&&(i.isTieDestination=!0,i.tieOrigin=this._tieStarts[0],this._tieStarts.splice(0,1),this._tieStartIds.delete(i.id))}}parseBeatDrawObject(e,t){for(const n of t.childElements())if("drawObj"===n.localName){const i=this.parseDrawObj(n);i&&(i instanceof mx?i.fontFace.startsWith("capella")?"u"===i.text?(e.fermata=new Cf,e.fermata.type=Ui.Medium):"f"===i.text?e.dynamics=Te.F:"j"===i.text&&(e.dynamics=Te.MF):this._isFirstSystem&&""===this.score.title&&i.align===ye.Center&&i.height>16&&i.weight>400?this.score.title=i.text:this._isFirstSystem&&""===this.score.artist&&i.align===ye.Center&&i.y<0?this.score.artist=i.text:this._isFirstSystem&&""===this.score.music&&i.align===ye.Right&&i.y<0?this.score.music=i.text:i.text.startsWith("by capella")||(e.text=i.text):i instanceof BV||(i instanceof PV?e.vibrato=Ft.Slight:i instanceof AV?(e.crescendo=i.decrescendo?Zi.Decrescendo:Zi.Crescendo,i.noteRange++,this._crescendo.set(e,i)):i instanceof MV?this._slurs.set(e,i):i instanceof yx&&this.applyVolta(i)))}}parseBarDrawObject(e){for(const t of e.childElements())if("drawObj"===t.localName){const n=this.parseDrawObj(t);n&&n instanceof yx&&this.applyVolta(n)}}applyVolta(e){if(e.lastNumber>0?(this._currentVoiceState.repeatCount=e.lastNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)):e.firstNumber>0&&(this._currentVoiceState.repeatCount=e.firstNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)),e.lastNumber>0&&e.firstNumber>0){let t=0;for(let n=e.firstNumber;n<=e.lastNumber;n++)t|=1<<n-1;this._currentBar.masterBar.alternateEndings=t}else e.lastNumber>0?this._currentBar.masterBar.alternateEndings=1<<e.lastNumber-1:e.firstNumber>0&&(this._currentBar.masterBar.alternateEndings=1<<e.firstNumber-1)}parseLyric(e,t){for(const n of t.childElements())if("verse"===n.localName){e.lyrics||(e.lyrics=[]);let i=n.innerText;"true"===n.getAttribute("hyphen")&&(i+="-"),e.lyrics.push(i)}}parseRestDurations(e,t){const n=t.getAttribute("base");if(-1!==n.indexOf("/")){const r=new Ei;return r.beamingMode=this._beamingMode,this.parseDuration(e,r,t),r}if(1===Number.parseInt(n)){const r=new Ei;return r.beamingMode=this._beamingMode,r.duration=w.Whole,r}return F.warning("Importer","Multi-Bar rests are not supported"),null}parseDurationValue(e){switch(e){case"2/1":return w.DoubleWhole;case"1/1":return w.Whole;case"1/2":return w.Half;case"1/4":return w.Quarter;case"1/8":return w.Eighth;case"1/16":return w.Sixteenth;case"1/32":return w.ThirtySecond;case"1/64":return w.SixtyFourth;case"1/128":return w.OneHundredTwentyEighth;default:return F.warning("Importer","Unsupported duration"),w.Quarter}}parseDuration(e,t,n){const i=n.getAttribute("base");t.duration=this.parseDurationValue(i),n.attributes.has("dots")&&(t.dots=Number.parseInt(n.attributes.get("dots")));const r=n.findChildElement("tuplet");if(r){t.tupletNumerator=Number.parseInt(r.getAttribute("count"));const o="true"===r.getAttribute("tripartite")?3:1,a="true"===r.getAttribute("prolong")?0:1;let l=0;for(;o*Math.pow(2,l+a)<t.tupletNumerator;)l++;t.tupletDenominator=o*Math.pow(2,l)}}parsePageObjects(e){for(const t of e.childElements())if("drawObj"===t.localName){const n=this.parseDrawObj(t);if(n&&n instanceof mx)switch(n.align){case ye.Center:this.score.title?this.score.subTitle||(this.score.subTitle=t.innerText):this.score.title=t.innerText;break;case ye.Right:this.score.artist||(this.score.artist=t.innerText)}}}parseGallery(e){for(const t of e.childElements())if("drawObj"===t.localName){const n=this.parseDrawObj(t);n&&this._galleryObjects.set(t.getAttribute("name"),n)}}parseDrawObj(e){let t=null,n=1;for(const i of e.childElements())switch(i.localName){case"text":t=this.parseText(i);break;case"guitar":t=this.parseGuitar(i);break;case"slur":t=this.parseSlur(i);break;case"wavyLine":t=this.parseWavyLine(i);break;case"bracket":t=this.parseTupletBracket(i);break;case"wedge":t=this.parseWedge(i);break;case"volta":t=this.parseVolta(i);break;case"octaveClef":t=this.parseOctaveClef(i);break;case"trill":t=this.parseTrill(i);break;case"basic":i.attributes.has("noteRange")&&(n=Number.parseInt(i.attributes.get("noteRange")))}return t&&(t.noteRange=n),t}parseTrill(e){return new qie}parseOctaveClef(e){const t=new zie;return e.attributes.has("octave")&&(t.octave=Number.parseInt(e.attributes.get("octave"))),t}parseVolta(e){const t=new yx;return t.allNumbers="true"===e.attributes.get("allNumbers"),e.attributes.has("firstNumber")&&(t.firstNumber=Number.parseInt(e.attributes.get("firstNumber"))),e.attributes.has("lastNumber")&&(t.lastNumber=Number.parseInt(e.attributes.get("lastNumber"))),t}parseWedge(e){const t=new AV;return t.decrescendo="true"===e.attributes.get("decrescendo"),t}parseTupletBracket(e){const t=new Uie;return e.attributes.has("number")&&(t.number=Number.parseInt(e.attributes.get("number"))),t}parseWavyLine(e){return new PV}parseSlur(e){return new MV}parseGuitar(e){const t=new BV,n=e.innerText.trim();for(let i=0;i<n.length;i++)"/"===n.charAt(i)?t.chord.strings.push(0):t.chord.strings.push(Number.parseInt(n.charAt(i)));return t}parseText(e){const t=new mx;switch(e.attributes.has("x")&&(t.x=Number.parseFloat(e.attributes.get("x"))),e.attributes.has("x")&&(t.y=Number.parseFloat(e.attributes.get("y"))),e.getAttribute("align")){case"left":t.align=ye.Left;break;case"center":t.align=ye.Center;break;case"right":t.align=ye.Right}switch(e.getAttribute("frame")){case"rectangle":t.frame=Rf.Rectangle;break;case"ellipse":t.frame=Rf.Ellipse;break;case"circle":t.frame=Rf.Circle;break;case"none":t.frame=Rf.None}if(e.firstElement)for(const n of e.childElements())switch(n.localName){case"font":t.fontFace=n.getAttribute("face"),n.attributes.has("weight")&&(t.weight=Number.parseInt(n.attributes.get("weight"))),n.attributes.has("height")&&(t.height=Number.parseInt(n.attributes.get("height")));break;case"content":t.text=n.innerText}else t.text=e.innerText;return t}parseInfo(e){for(const t of e.childElements())switch(t.localName){case"author":this.score.tab=t.firstChild.innerText;break;case"comment":this.score.notices=t.firstChild.innerText}}}class Xie extends Mh{get name(){return"Capella"}readScore(){F.debug(this.name,"Loading ZIP entries");let t,n=null;if(t=new DD(this.data).read(),F.debug(this.name,"Zip entries loaded"),t.length>0)for(const i of t)"score.xml"===i.fileName&&(n=N.toString(i.data,this.settings.importer.encoding));else this.data.reset(),n=N.toString(this.data.readAll(),this.settings.importer.encoding);if(!n)throw new Ts("No valid capella file");F.debug(this.name,"Start Parsing score.xml");try{const i=new Xw;return i.parseXml(n,this.settings),F.debug(this.name,"score.xml parsed"),i.score}catch(i){throw new Ts("Failed to parse CapXML",i)}}}var Zie="function"==typeof SuppressedError?SuppressedError:function(s,e,t){var n=new Error(t);return n.name="SuppressedError",n.error=s,n.suppressed=e,n};let _x=(()=>{class s{static enable(t,n){s.alphaSkia=n,s.initializeMusicFont(s.alphaSkia.AlphaSkiaTypeface.register(t))}static initializeMusicFont(t){s.musicTextStyle=new s.alphaSkia.AlphaSkiaTextStyle([t.familyName],t.weight,t.isItalic)}static registerFont(t,n){const i=s.alphaSkia.AlphaSkiaTypeface.register(t.buffer);return n||(n=Ke.withFamilyList([i.familyName],12,i.isItalic?ts.Italic:ts.Plain,i.weight>400?Or.Bold:Or.Regular)),n}get font(){return this._font}set font(t){if(this._font===t)return;this._font=t;const n=this.textStyleKey(t);if(this._textStyles.has(n))this._textStyle=this._textStyles.get(n);else{const i=new s.alphaSkia.AlphaSkiaTextStyle(t.families,t.weight===Or.Bold?700:400,t.isItalic);this._textStyles.set(n,i),this._textStyle=i}}textStyleKey(t){return[...t.families,t.weight.toString(),t.isItalic?"italic":"upright"].join("_")}constructor(){this._color=new _n(0,0,0,0),this._lineWidth=0,this._textStyle=null,this._scale=1,this._textStyles=new Map,this._font=new Ke("Arial",10,ts.Plain),this.textAlign=ye.Left,this.textBaseline=qe.Top,this._canvas=new s.alphaSkia.AlphaSkiaCanvas,this.color=new _n(0,0,0,255)}destroy(){this._canvas[Symbol.dispose]();for(const t of this._textStyles.values())t[Symbol.dispose]()}onRenderFinished(){return null}beginRender(t,n){this._scale=this.settings.display.scale,this._canvas.beginRender(t,n,B.HighDpiFactor)}endRender(){return this._canvas.endRender()}get color(){return this._color}set color(t){this._color.rgba!==t.rgba&&(this._color=t,this._canvas.color=s.alphaSkia.AlphaSkiaCanvas.rgbaToColor(t.r,t.g,t.b,t.a))}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this._canvas.lineWidth=t}fillRect(t,n,i,r){i>0&&this._canvas.fillRect(t*this._scale|0,n*this._scale|0,i*this._scale,r*this._scale)}strokeRect(t,n,i,r){const o=this.lineWidth%2==0?0:.5;this._canvas.strokeRect((t*this._scale|0)+o,(n*this._scale|0)+o,i*this._scale,r*this._scale)}beginPath(){this._canvas.beginPath()}closePath(){this._canvas.closePath()}moveTo(t,n){this._canvas.moveTo(t*this._scale,n*this._scale)}lineTo(t,n){this._canvas.lineTo(t*this._scale,n*this._scale)}quadraticCurveTo(t,n,i,r){this._canvas.quadraticCurveTo(t*this._scale,n*this._scale,i*this._scale,r*this._scale)}bezierCurveTo(t,n,i,r,o,a){this._canvas.bezierCurveTo(t*this._scale,n*this._scale,i*this._scale,r*this._scale,o*this._scale,a*this._scale)}fillCircle(t,n,i){this._canvas.fillCircle(t*this._scale,n*this._scale,i*this._scale)}strokeCircle(t,n,i){this._canvas.strokeCircle(t*this._scale,n*this._scale,i*this._scale)}fill(){this._canvas.fill()}stroke(){this._canvas.stroke()}beginGroup(t){}endGroup(){}fillText(t,n,i){if(0===t.length)return;let r=s.alphaSkia.AlphaSkiaTextAlign.Left;switch(this.textAlign){case ye.Left:r=s.alphaSkia.AlphaSkiaTextAlign.Left;break;case ye.Center:r=s.alphaSkia.AlphaSkiaTextAlign.Center;break;case ye.Right:r=s.alphaSkia.AlphaSkiaTextAlign.Right}let o=s.alphaSkia.AlphaSkiaTextBaseline.Top;switch(this.textBaseline){case qe.Top:o=s.alphaSkia.AlphaSkiaTextBaseline.Top;break;case qe.Middle:o=s.alphaSkia.AlphaSkiaTextBaseline.Middle;break;case qe.Bottom:o=s.alphaSkia.AlphaSkiaTextBaseline.Bottom}this._canvas.fillText(t,this._textStyle,this._font.size*this._scale,n*this._scale|0,i*this._scale|0,r,o)}measureText(t){const n={stack:[],error:void 0,hasError:!1};try{const i=function Jie(s,e,t){if(null!=e){if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object expected.");var n,i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=e[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=e[Symbol.dispose],t&&(i=n)}if("function"!=typeof n)throw new TypeError("Object not disposable.");i&&(n=function(){try{i.call(this)}catch(r){return Promise.reject(r)}}),s.stack.push({value:e,dispose:n,async:t})}else t&&s.stack.push({async:!0});return e}(n,this._canvas.measureText(t,this._textStyle,this._font.size,s.alphaSkia.AlphaSkiaTextAlign.Left,s.alphaSkia.AlphaSkiaTextBaseline.Alphabetic),!1);return new Ug(i.width,i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}catch(i){n.error=i,n.hasError=!0}finally{!function Qie(s){function e(r){s.error=s.hasError?new Zie(r,s.error,"An error was suppressed during disposal."):r,s.hasError=!0}var t,n=0;(function i(){for(;t=s.stack.pop();)try{if(!t.async&&1===n)return n=0,s.stack.push(t),Promise.resolve().then(i);if(t.dispose){var r=t.dispose.call(t.value);if(t.async)return n|=2,Promise.resolve(r).then(i,function(o){return e(o),i()})}else n|=1}catch(o){e(o)}if(1===n)return s.hasError?Promise.reject(s.error):Promise.resolve();if(s.hasError)throw s.error})()}(n)}}fillMusicFontSymbol(t,n,i,r,o){r!==f.None&&this.fillMusicFontSymbolText(t,n,i,String.fromCharCode(r),o)}fillMusicFontSymbols(t,n,i,r,o){let a="";for(const l of r)l!==f.None&&(a+=String.fromCharCode(l));this.fillMusicFontSymbolText(t,n,i,a,o)}fillMusicFontSymbolText(t,n,i,r,o){this._canvas.fillText(r,s.musicTextStyle,B.MusicFontSize*this._scale*i,t*this._scale,n*this._scale,o?s.alphaSkia.AlphaSkiaTextAlign.Center:s.alphaSkia.AlphaSkiaTextAlign.Left,s.alphaSkia.AlphaSkiaTextBaseline.Alphabetic)}beginRotate(t,n,i){this._canvas.beginRotate(t*this._scale,n*this._scale,i)}endRotate(){this._canvas.endRotate()}}return s.musicTextStyle=null,s})();class RV extends Xo{constructor(e,t,n=!1){super(e.beat,t.beat,n),this.startNote=e,this.endNote=t}getTieHeight(e,t,n,i){return this.startNote===this.endNote?15:super.getTieHeight(e,t,n,i)}getBeamDirection(e,t){return V.Down}static getBeamDirectionForNote(e){return V.Down}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,be.Center)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20:this.startNoteRenderer.getNoteX(this.startNote,Un.Right)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,Un.Left)}}class Kie extends za{constructor(){super(...arguments),this._tiedNoteTie=null}createTies(e){if(e.isVisible){if(!this._tiedNoteTie&&e.isTieOrigin&&e.tieDestination.isVisible){const t=new RV(e,e.tieDestination,!1);this._tiedNoteTie=t,this.addTie(t)}if(!this._tiedNoteTie&&e.isTieDestination){const t=new RV(e.tieOrigin,e,!0);this._tiedNoteTie=t,this.addTie(t)}}}}class ere extends dm{updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,n){super.internalPaint(e,t,n,In.SlashRests)}}class tre extends vu{constructor(){super(...arguments),this.noteHeads=null,this.deadSlapped=null,this.restGlyph=null}get effectElement(){return In.SlashEffects}getNoteX(e,t){let n=null;if(this.noteHeads?n=this.noteHeads:this.deadSlapped&&(n=this.deadSlapped),n){let i=n.x;switch(t){case Un.Left:break;case Un.Center:i+=n.width/2;break;case Un.Right:i+=n.width}return i}return 0}buildBoundingsLookup(e,t,n){if(this.noteHeads&&this.container.beat.notes.length>0){const i=new Bf;i.note=this.container.beat.notes[0],i.noteHeadBounds=new bi,i.noteHeadBounds.x=t+this.x+this.noteHeads.x,i.noteHeadBounds.y=n+this.y+this.noteHeads.y-this.noteHeads.height/2,i.noteHeadBounds.w=this.width,i.noteHeadBounds.h=this.height,e.addNote(i)}}getNoteY(e,t){let n=null;if(this.noteHeads?n=this.noteHeads:this.deadSlapped&&(n=this.deadSlapped),n){let i=this.y+n.y;switch(t){case be.Top:case be.TopWithStem:i-=n.height/2+2;break;case be.Center:break;case be.Bottom:case be.BottomWithStem:i+=n.height/2}return i}return 0}updateBeamingHelper(){this.noteHeads?this.noteHeads.updateBeamingHelper(this.container.x+this.x):this.deadSlapped?this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.container.beat,this.container.x+this.x+this.deadSlapped.x+this.width,this.container.x+this.x+this.deadSlapped.x):this.restGlyph&&this.restGlyph.updateBeamingHelper(this.container.x+this.x)}doLayout(){const e=this.renderer,t=e.getNoteLine(),n=e.getLineY(t);if(this.container.beat.deadSlapped){const i=new jw;i.renderer=this.renderer,i.doLayout(),this.deadSlapped=i,this.addEffect(i)}else if(!this.container.beat.isEmpty)if(this.container.beat.isRest){const i=new ere(0,n,this.container.beat.duration);this.restGlyph=i,i.beat=this.container.beat,i.beamingHelper=this.beamingHelper,this.addNormal(i),this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,0)}else{const r=new fm(0,n,this.container.beat.duration,this.container.beat.graceType!==Ee.None,this.container.beat);this.noteHeads=r,r.beat=this.container.beat,r.beamingHelper=this.beamingHelper,this.addNormal(r)}if(this.container.beat.dots>0){this.addNormal(new Ii(0,0,5));for(let i=0;i<this.container.beat.dots;i++)this.addEffect(new hm(0,e.getLineY(e.getNoteLine())-e.getLineHeight(.5),1.5))}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.deadSlapped&&(this.centerX=this.deadSlapped.x+this.deadSlapped.width/2)}}let FV=(()=>{class s extends Pl{constructor(t,n){super(t,n),this.simpleWhammyOverflow=0,this._isOnlySlash=!n.staff.showTablature&&!n.staff.showStandardNotation,this.helpers.preferredBeamDirection=V.Up}get repeatsBarSubElement(){return Ht.SlashRepeats}get barNumberBarSubElement(){return Ht.SlashBarNumber}get barLineBarSubElement(){return Ht.SlashBarLines}get staffLineBarSubElement(){return Ht.SlashStaffLine}get lineSpacing(){return ss.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 1}get bottomGlyphOverflow(){return 0}paint(t,n,i){super.paint(t,n,i),this.paintBeams(t,n,i,In.SlashFlags,In.SlashBeams),this.paintTuplets(t,n,i,In.SlashTuplet)}doLayout(){super.doLayout();let t=!1;for(const n of this.bar.voices)if(this.hasVoiceContainer(n)&&this.getVoiceContainer(n).tupletGroups.length>0){t=!0;break}t&&this.registerOverflowTop(this.tupletSize)}getNoteLine(){return 0}getFlagTopY(t,n){const i=on.Heights.get(f.NoteheadSlashWhiteHalf);return this.getLineY(0)-i/2}getFlagBottomY(t,n){const i=on.Heights.get(f.NoteheadSlashWhiteHalf);return this.getLineY(0)-i/2}getBeamDirection(t){return V.Up}getNoteY(t,n){let i=super.getNoteY(t,n);return Number.isNaN(i)&&(i=this.getLineY(0)),i}calculateBeamYWithDirection(t,n,i){return this.getLineY(0)-this.getFlagStemSize(t.shortestDuration)}getBarLineStart(t,n){const i=on.Heights.get(f.NoteheadSlashWhiteHalf);return this.getLineY(0)-i/2}createLinePreBeatGlyphs(){this._isOnlySlash&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Ii(0,0,5));const t=this.bar.masterBar,n=new ux(0,this.getLineY(0),t.timeSignatureNumerator,t.timeSignatureDenominator,t.timeSignatureCommon,t.isFreeTime&&(null==t.previousMasterBar||t.isFreeTime!==t.previousMasterBar.isFreeTime));n.barSubElement=Ht.SlashTimeSignature,this.addPreBeatGlyph(n)}createVoiceGlyphs(t){for(const n of t.beats){const i=new Kie(n,this.getVoiceContainer(t));i.preNotes=new Su,i.onNotes=0===t.index?new tre:new vu,this.addBeatGlyph(i)}}paintBeamingStem(t,n,i,r,o,a){const l=yt.beat(a,In.SlashStem,t);try{a.lineWidth=ss.StemWidth,a.beginPath(),a.moveTo(i,r),a.lineTo(i,o),a.stroke(),a.lineWidth=1}finally{l?.[Symbol.dispose]?.()}}}return s.StaffId="slash",s})();class nre extends lm{get staffId(){return FV.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new FV(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showSlash}}class bx extends Xo{constructor(e,t,n=!1){super(e?e.beat:null,t?t.beat:null,n),this.startNote=e,this.endNote=t}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){return V.Up}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,be.Top)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20:this.startNoteRenderer.getNoteX(this.startNote,Un.Center)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,this.startNote===this.endNote?Un.Left:Un.Center)}}class OV extends Cc{constructor(e,t,n,i=!1){super(e,t,i),this._direction=V.Up,this._forSlide=n}getTieHeight(e,t,n,i){return Math.log(n-e+1)*this.renderer.settings.notation.slurHeight}tryExpand(e,t,n,i){if(this._forSlide!==n||this.forEnd!==i||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id)return!1;switch(this._direction){case V.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case V.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat)}return!0}paint(e,t,n){const i=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar),r=this.getBeamDirection(this.startBeat,i),o=`numbered.slur.${this.startNote.beat.id}.${this.endNote.beat.id}.${r}`,a=this.renderer;a.staff.getSharedLayoutData(o,!1)||(a.staff.setSharedLayoutData(o,!0),super.paint(e,t,n))}}class sre extends za{constructor(){super(...arguments),this._effectSlurs=[]}createTies(e){if(e.isVisible){if(e.isTieOrigin&&e.tieDestination.isVisible){const t=new bx(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination){const t=new bx(e.tieOrigin,e,!0);this.addTie(t)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){const t=new bx(e,e,!1);this.addTie(t)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let t=!1;for(const n of this._effectSlurs)if(n.tryExpand(e,e.effectSlurDestination,!1,!1)){t=!0;break}if(!t){const n=new OV(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(n),this.addTie(n)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let t=!1;for(const n of this._effectSlurs)if(n.tryExpand(e.effectSlurOrigin,e,!1,!0)){t=!0;break}if(!t){const n=new OV(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(n),this.addTie(n)}}}}}let ire=(()=>{class s extends os{constructor(t,n,i,r,o){super(t,n),this._isGrace=r,this._number=i,this._beat=o}paint(t,n,i){const r=this._beat.isRest?yt.beat(i,In.NumberedRests,this._beat):this._beat.notes.length>0?yt.note(i,Qi.NumberedNumber,this._beat.notes[0]):void 0;try{const o=this.renderer.resources;i.font=this._isGrace?o.numberedNotationGraceFont:o.numberedNotationFont,i.textBaseline=qe.Middle,i.textAlign=ye.Left,i.fillText(this._number.toString(),t+this.x,n+this.y)}finally{r?.[Symbol.dispose]?.()}}doLayout(){const t=this._isGrace?Pn.GraceScale:1;this.width=s.NoteHeadWidth*t,this.height=s.NoteHeadHeight*t}}return s.NoteHeadHeight=17,s.NoteHeadWidth=12,s})(),rre=(()=>{class s extends os{constructor(t,n,i){super(t,n),this._beat=i}doLayout(){this.width=14+s.Padding,this.height=qi.BarSize}paint(t,n,i){const r=yt.beat(i,In.NumberedDuration,this._beat);try{i.fillRect(t+this.x,n+this.y,this.width-s.Padding,this.height)}finally{r?.[Symbol.dispose]?.()}}}return s.Padding=3,s})();class ore extends Su{constructor(){super(...arguments),this.isNaturalizeAccidental=!1,this.accidental=Be.None}get effectElement(){return In.NumberedEffects}doLayout(){if(!this.container.beat.isRest&&!this.container.beat.isEmpty){const e=new cx;if(e.renderer=this.renderer,this.container.beat.notes.length>0){const t=this.container.beat.notes[0],n=t?t.accidentalMode:mt.Default,i=Ga.getNoteValue(t);let r=Ga.computeAccidental(this.renderer.bar.keySignature,n,i,t.hasQuarterToneOffset);if(r===Be.Natural&&(r=this.renderer.bar.keySignature+7<7?Be.Sharp:Be.Flat,this.isNaturalizeAccidental=!0),r!==Be.None){this.accidental=r;const o=this.renderer,a=yt.noteColor(o.resources,Qi.NumberedAccidentals,t),l=new Ml(0,o.getLineY(0),r,t.beat.graceType!==Ee.None?Pn.GraceScale*Pn.GraceScale:Pn.GraceScale);l.colorOverride=a,l.renderer=this.renderer,e.addGlyph(l),this.addNormal(e),this.addNormal(new Ii(0,0,4))}}}super.doLayout()}}let LV=(()=>{class s extends vu{constructor(){super(...arguments),this.noteHeads=null,this.deadSlapped=null,this.octaveDots=0}get effectElement(){return In.NumberedEffects}getNoteX(t,n){let i=null;if(this.noteHeads?i=this.noteHeads:this.deadSlapped&&(i=this.deadSlapped),i){let r=i.x;switch(n){case Un.Left:break;case Un.Center:r+=i.width/2;break;case Un.Right:r+=i.width}return r}return 0}buildBoundingsLookup(t,n,i){if(this.noteHeads&&this.container.beat.notes.length>0){const r=new Bf;r.note=this.container.beat.notes[0],r.noteHeadBounds=new bi,r.noteHeadBounds.x=n+this.x+this.noteHeads.x,r.noteHeadBounds.y=i+this.y+this.noteHeads.y-this.noteHeads.height/2,r.noteHeadBounds.w=this.width,r.noteHeadBounds.h=this.height,t.addNote(r)}}getNoteY(t,n){let i=null;if(this.noteHeads?i=this.noteHeads:this.deadSlapped&&(i=this.deadSlapped),i){let r=this.y+i.y;switch(n){case be.Top:case be.TopWithStem:r-=i.height/2+2;break;case be.Center:break;case be.Bottom:case be.BottomWithStem:r+=i.height/2}return r}return 0}updateBeamingHelper(){if(this.beamingHelper){let t=null;this.noteHeads?t=this.noteHeads:this.deadSlapped&&(t=this.deadSlapped),t&&this.beamingHelper.registerBeatLineX("numbered",this.container.beat,this.container.x+this.x+t.x,this.container.x+this.x+t.x+t.width)}}doLayout(){const t=this.renderer;t.shortestDuration<this.container.beat.duration&&(t.shortestDuration=this.container.beat.duration);const n=t.getLineY(t.getNoteLine());if(!this.container.beat.isEmpty){let i="0";if(this.container.beat.notes.length>0){const l=this.renderer.bar.keySignature,c=l+7,d=this.container.beat.notes[0];if(d.isDead)i="X";else{const p=d.displayValue-(this.renderer.bar.keySignatureType===dr.Minor?s.MinorKeySignatureOneValues:s.MajorKeySignatureOneValues)[c],g=p<0?(p%12+12)%12:p%12;let m=p<0?(Math.abs(p)+12)/12|0:p/12|0;p<0&&(m*=-1),this.octaveDots=m,t.registerOctave(m);let y=(ie.keySignatureIsSharp(l)||ie.keySignatureIsNatural(l)?Ga.FlatNoteSteps:Ga.SharpNoteSteps)[g]+1;Ga.AccidentalNotes[g]&&!this.container.preNotes.isNaturalizeAccidental&&(c<7?y++:y--),i=y.toString()}}if(this.container.beat.deadSlapped){const a=new jw;a.renderer=this.renderer,a.doLayout(),this.deadSlapped=a,this.addEffect(a)}else{const l=new ire(0,n,i,this.container.beat.graceType!==Ee.None,this.container.beat);this.noteHeads=l,this.addNormal(l)}if(this.container.beat.dots>0&&this.container.beat.duration>=w.Quarter){this.addNormal(new Ii(0,0,5));for(let a=0;a<this.container.beat.dots;a++){const l=new hm(0,t.getLineY(0),1.5);l.renderer=this.renderer,this.addEffect(l)}}let r=0;switch(this.container.beat.duration){case w.QuadrupleWhole:r=16;break;case w.DoubleWhole:r=8;break;case w.Whole:r=4;break;case w.Half:r=2}let o=r;for(let a=0;a<this.container.beat.dots;a++)o=o/2|0,r+=o;for(let a=0;a<r-1;a++){const l=new rre(0,t.getLineY(0),this.container.beat);l.renderer=this.renderer,this.addNormal(l)}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.deadSlapped&&(this.centerX=this.deadSlapped.x+this.deadSlapped.width/2)}}return s.MajorKeySignatureOneValues=[59,66,61,68,63,58,65,60,67,62,69,64,71,66,61],s.MinorKeySignatureOneValues=[71,66,73,68,63,70,65,72,67,74,69,64,71,66,73],s})();class are extends os{constructor(e,t,n,i){super(e,t),this._text="",this._accidental=Be.None,this._accidentalOffset=0,this._keySignature=n,this._keySignatureType=i}doLayout(){super.doLayout();const e="1 = ";let t="",n=Be.None;switch(this._keySignatureType){case dr.Major:switch(this._keySignature){case wt.Cb:t="  C",n=Be.Flat;break;case wt.Gb:t="  G",n=Be.Flat;break;case wt.Db:t="  D",n=Be.Flat;break;case wt.Ab:t="  A",n=Be.Flat;break;case wt.Eb:t="  E",n=Be.Flat;break;case wt.Bb:t="  B",n=Be.Flat;break;case wt.F:t="F";break;case wt.C:t="C",n=Be.None;break;case wt.G:t="G",n=Be.None;break;case wt.D:t="D",n=Be.None;break;case wt.A:t="A",n=Be.None;break;case wt.E:t="E",n=Be.None;break;case wt.B:t="B",n=Be.None;break;case wt.FSharp:t="  F",n=Be.Sharp;break;case wt.CSharp:t="  C",n=Be.Sharp}break;case dr.Minor:switch(this._keySignature){case wt.Cb:t="  a",n=Be.Flat;break;case wt.Gb:t="  e",n=Be.Flat;break;case wt.Db:t="  b",n=Be.Flat;break;case wt.Ab:t="f",n=Be.None;break;case wt.Eb:t="c",n=Be.None;break;case wt.Bb:t="g",n=Be.None;break;case wt.F:t="d";break;case wt.C:t="a",n=Be.None;break;case wt.G:t="e",n=Be.None;break;case wt.D:t="b",n=Be.None;break;case wt.A:t="  f",n=Be.Sharp;break;case wt.E:t="  c",n=Be.Sharp;break;case wt.B:t="  g",n=Be.Sharp;break;case wt.FSharp:t="  d",n=Be.Sharp;break;case wt.CSharp:t="  a",n=Be.Sharp}}this._text=e+t,this._accidental=n;const i=this.renderer.scoreRenderer.canvas;i.font=this.renderer.resources.numberedNotationFont,this._accidentalOffset=i.measureText(e).width,this.width=i.measureText(e+t).width}paint(e,t,n){const i=yt.bar(n,Ht.NumberedKeySignature,this.renderer.bar);try{n.font=this.renderer.resources.numberedNotationFont,n.textBaseline=qe.Middle,n.fillText(this._text,e+this.x,t+this.y),this._accidental!==Be.None&&n.fillMusicFontSymbol(e+this.x+this._accidentalOffset,t+this.y,.7,Ml.getMusicSymbol(this._accidental),!1)}finally{i?.[Symbol.dispose]?.()}}}class qi extends Pl{registerOctave(e){null===this.lowestOctave?(this.lowestOctave=e,this.highestOctave=e):(e<this.lowestOctave&&(this.lowestOctave=e),e>this.highestOctave&&(this.highestOctave=e))}get repeatsBarSubElement(){return Ht.NumberedRepeats}get barNumberBarSubElement(){return Ht.NumberedBarNumber}get barLineBarSubElement(){return Ht.NumberedBarLines}get staffLineBarSubElement(){return Ht.NumberedStaffLine}constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this.shortestDuration=w.QuadrupleWhole,this.lowestOctave=null,this.highestOctave=null,this._isOnlyNumbered=!t.staff.showSlash&&!t.staff.showTablature&&!t.staff.showStandardNotation}get lineSpacing(){return ss.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 0}get bottomGlyphOverflow(){return 0}paint(e,t,n){super.paint(e,t,n),this.paintBeams(e,t,n,In.NumberedDuration,In.NumberedDuration),this.paintTuplets(e,t,n,In.NumberedTuplet,!0)}doLayout(){super.doLayout();let e=!1;for(const t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){e=!0;break}if(e&&this.registerOverflowTop(this.tupletSize),!this.bar.isEmpty){const t=ie.getIndex(this.shortestDuration)-2;if(t>0){const o=(t-1)*qi.BarSpacing+qi.BarSize;let a=0;const l=this.lowestOctave;null!==l&&(a=Math.abs(l)*qi.DotSpacing+qi.DotSize),this.registerOverflowBottom(o+a)}const n=this.highestOctave;if(null!==n){const i=Math.abs(n)*qi.DotSpacing+qi.DotSize;this.registerOverflowTop(i)}}}paintFlag(e,t,n,i,r){this.paintBar(e,t,n,i,r)}paintBar(e,t,n,i,r){if(0===i.beats.length)return;const o=this.resources;for(let a=0,l=i.beats.length;a<l;a++){const c=i.beats[a],u=yt.beat(n,r,c);try{const h=qi.BarSpacing,d=qi.BarSize,p=ie.getIndex(c.duration)-2,g=t+this.y,m=this.getBeatX(c,St.PreNotes)-this.beatGlyphsStart,_=this.calculateBeamY(i,m);for(let C=0;C<p;C++){let v=0,x=0,q=0;const W=g+C*h;a===i.beats.length-1?(v=m,x=this.getBeatX(c,St.PostNotes)-this.beatGlyphsStart):(v=m,x=this.getBeatX(i.beats[a+1],St.PreNotes)-this.beatGlyphsStart),q=W+_|0,Pl.paintSingleBar(n,e+this.x+v,q,e+this.x+x,q,d)}const y=this.getBeatContainer(c).onNotes;let b=y instanceof LV?y.octaveDots:0,S=0,D=0;b>0?(S=g+this.getLineY(0)-o.numberedNotationFont.size/1.5,D=-1*qi.DotSpacing):b<0&&(S=g+_+p*h,D=qi.DotSpacing);const T=this.getBeatX(c,St.OnNotes)+4-this.beatGlyphsStart;b=Math.abs(b);for(let C=0;C<b;C++)n.fillCircle(e+this.x+T,S,qi.DotSize),S+=D}finally{u?.[Symbol.dispose]?.()}}}getNoteLine(){return 0}get tupletOffset(){return super.tupletOffset+this.resources.numberedNotationFont.size}getFlagTopY(e,t){const n=on.Heights.get(f.NoteheadBlack);return this.getLineY(0)-n/2}getFlagBottomY(e,t){const n=on.Heights.get(f.NoteheadBlack);return this.getLineY(0)-n/2}getBeamDirection(e){return V.Down}getTupletBeamDirection(e){return V.Up}getNoteY(e,t){let n=super.getNoteY(e,t);return Number.isNaN(n)&&(n=this.getLineY(0)),n}calculateBeamYWithDirection(e,t,n){const i=this.resources.numberedNotationFont;return this.getLineY(0)+i.size}getBarLineStart(e,t){const n=on.Heights.get(f.NoteheadBlack);return this.getLineY(0)-n/2}createPreBeatGlyphs(){this.wasFirstOfLine=this.isFirstOfLine,(0===this.index||this.bar.masterBar.isRepeatStart&&this._isOnlyNumbered)&&this.addPreBeatGlyph(new dx(!1)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new NV(0,this.getLineHeight(-.25),this.bar.index+1))}createLinePreBeatGlyphs(){(!this.bar.previousBar||this.bar.keySignature!==this.bar.previousBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),this._isOnlyNumbered&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){this.addPreBeatGlyph(new are(0,this.getLineY(0),this.bar.keySignature,this.bar.keySignatureType))}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new Ii(0,0,5));const e=this.bar.masterBar,t=new ux(0,this.getLineY(0),e.timeSignatureNumerator,e.timeSignatureDenominator,e.timeSignatureCommon,e.isFreeTime&&(null==e.previousMasterBar||e.isFreeTime!==e.previousMasterBar.isFreeTime));t.barSubElement=Ht.NumberedTimeSignature,this.addPreBeatGlyph(t)}createPostBeatGlyphs(){this._isOnlyNumbered&&super.createPostBeatGlyphs()}createVoiceGlyphs(e){for(const t of e.beats){const n=new sre(t,this.getVoiceContainer(e));n.preNotes=0===e.index?new ore:new Su,n.onNotes=0===e.index?new LV:new vu,this.addBeatGlyph(n)}}paintBeamingStem(e,t,n,i,r,o){}}qi.StaffId="numbered",qi.BarSpacing=ss.BeamSpacing+ss.BeamThickness,qi.BarSize=2,qi.DotSpacing=5,qi.DotSize=2;class lre extends lm{get staffId(){return qi.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new qi(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showNumbered}}class cre extends gs{get notationElement(){return dt.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.SinglePreBeat}shouldCreateGlyph(e,t){const n=t.voice.bar.masterBar;return 0===t.voice.bar.staff.index&&0===t.voice.index&&0===t.index&&n.isFreeTime&&(0===n.index||n.isFreeTime!==n.previousMasterBar.isFreeTime)}createNewGlyph(e,t){return new oo(0,0,"Free time",e.resources.effectFont,ye.Left)}canExpand(e,t){return!0}}let ure=(()=>{class s extends ro{constructor(){super(0,0)}doLayout(){super.doLayout(),this.height=on.Heights.get(f.KeyboardPedalPed)}paint(t,n,i){const o=n+this.y,a=this.height,l=this.renderer.bar.sustainPedals,c=on.Widths.get(f.KeyboardPedalPed),u=on.Widths.get(f.KeyboardPedalUp);let h=0;for(;h<l.length;){let d=l[h];for(;null!=d;){const p=t+this.renderer.getRatioPositionX(d.ratioPosition);let g=0;if(d.pedalType===Ms.Down?(i.fillMusicFontSymbol(p,o+a,1,f.KeyboardPedalPed,!0),g=c/2+s.TextLinePadding):d.pedalType===Ms.Up&&(i.fillMusicFontSymbol(p,o+a,1,f.KeyboardPedalUp,!0),g=u/2+s.StarLinePadding),d.nextPedalMarker)if(d.nextPedalMarker.bar===d.bar){let m=t+this.renderer.getRatioPositionX(d.nextPedalMarker.ratioPosition);switch(d.nextPedalMarker.pedalType){case Ms.Down:m-=c/2;break;case Ms.Hold:break;case Ms.Up:m-=u/2}const _=p+g;m>_&&i.fillRect(_,o+a-1,m-_,1)}else{const _=p+g;i.fillRect(_,o+a-1,t+this.x+this.width-_,1)}if(0===h&&d.previousPedalMarker){const m=t+this.x;i.fillRect(m,o+a-1,p-g-m,1)}h++,null!=d.nextPedalMarker&&d.nextPedalMarker.bar!==d.bar?(d=null,h=l.length):d=d.nextPedalMarker}}}}return s.TextLinePadding=3,s.StarLinePadding=3,s})();class hre extends gs{get notationElement(){return dt.EffectSustainPedal}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return It.FullBar}shouldCreateGlyph(e,t){return 0===t.voice.index&&0===t.index&&t.voice.bar.sustainPedals.length>0}createNewGlyph(e,t){return new ure}canExpand(e,t){return!0}}class Jw extends gs{constructor(e,t){super(),this._type=e,this._shouldCreate=t}get notationElement(){return dt.EffectGolpe}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){const n=this._shouldCreate;return t.golpe===this._type&&(!n||n(e,t))}createNewGlyph(e,t){return new kV(0,0,!0)}canExpand(e,t){return!1}}class wx extends Us{constructor(e){super(0,0,1,wx.getSymbol(e)),this.center=!0}static getSymbol(e){switch(e){case eo.Open:return f.GuitarOpenPedal;case eo.Closed:return f.GuitarClosePedal}return f.None}paint(e,t,n){super.paint(e,t+this.height,n)}}class dre extends gs{get notationElement(){return dt.EffectWahPedal}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return t.wahPedal!==eo.None}createNewGlyph(e,t){return new wx(t.wahPedal)}canExpand(e,t){return!1}}class mm extends gs{get notationElement(){return dt.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.isBarre}get sizingMode(){return It.GroupedOnBeat}createNewGlyph(e,t){let n="";switch(t.barreShape){case to.None:case to.Full:break;case to.Half:n+="1/2"}return n+=`B ${mm.toRoman(t.barreFret)}`,new zh(n,!1)}static toRoman(e){let t="";if(e>0)for(const[n,i]of mm.RomanLetters){const r=Math.floor(e/i);e-=r*i,t+=n.repeat(r)}return t}canExpand(e,t){return e.barreFret===t.barreFret&&e.barreShape===t.barreShape}}mm.RomanLetters=new Map([["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]]);class Sx extends Us{constructor(e){super(0,0,1,Sx.getSymbol(e)),this.center=!0}static getSymbol(e){switch(e){case vs.InvertedTurn:return f.OrnamentTurnInverted;case vs.Turn:return f.OrnamentTurn;case vs.UpperMordent:return f.OrnamentShortTrill;case vs.LowerMordent:return f.OrnamentMordent}return f.None}paint(e,t,n){super.paint(e,t+this.height-4,n)}}class fre extends gs{get notationElement(){return dt.EffectNoteOrnament}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return t.notes.some(n=>n.ornament!==vs.None)}createNewGlyph(e,t){return new Sx(t.notes.find(n=>n.ornament!==vs.None).ornament)}canExpand(e,t){return!1}}class pre extends gs{get notationElement(){return dt.EffectRasgueado}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.hasRasgueado}get sizingMode(){return It.GroupedOnBeat}createNewGlyph(e,t){return new zh("rasg.")}canExpand(e,t){return!0}}class Zw extends os{constructor(e){super(0,0),this._symbols=e}doLayout(){this.height=27}paint(e,t,n){n.fillMusicFontSymbols(e+this.x,t+this.y+this.height,.8,this._symbols,!0)}}class ao extends os{constructor(e){super(0,0),this._text=e}doLayout(){this.height=1.5*this.renderer.resources.directionsFont.size}paint(e,t,n){const i=n.font,r=n.textBaseline,o=n.textAlign;n.font=this.renderer.resources.directionsFont,n.textBaseline=qe.Middle,n.textAlign=ye.Right,n.fillText(this._text,e+this.x,t+this.y+this.height/2),n.font=i,n.textBaseline=r,n.textAlign=o}}class gre extends ro{constructor(e,t,n){super(e,t),this._barBeginGlyphs=[],this._barEndGlyphs=[],this._directions=n}doLayout(){const e=this._directions;e.has(j.TargetSegnoSegno)&&this._barBeginGlyphs.push(new Zw([f.Segno,f.Segno])),e.has(j.TargetSegno)&&this._barBeginGlyphs.push(new Zw([f.Segno])),e.has(j.TargetDoubleCoda)&&this._barBeginGlyphs.push(new Zw([f.Coda,f.Coda])),e.has(j.TargetCoda)&&this._barBeginGlyphs.push(new Zw([f.Coda])),e.has(j.TargetFine)&&this._barEndGlyphs.push(new ao("Fine")),e.has(j.JumpDaDoubleCoda)&&this._barEndGlyphs.push(new ao("To Double Coda")),e.has(j.JumpDaCoda)&&this._barEndGlyphs.push(new ao("To Coda")),e.has(j.JumpDalSegnoSegno)&&this._barEndGlyphs.push(new ao("D.S.S.")),e.has(j.JumpDalSegnoSegnoAlCoda)&&this._barEndGlyphs.push(new ao("D.S.S. al Coda")),e.has(j.JumpDalSegnoSegnoAlDoubleCoda)&&this._barEndGlyphs.push(new ao("D.S.S. al Double Coda")),e.has(j.JumpDalSegnoSegnoAlFine)&&this._barEndGlyphs.push(new ao("D.S.S. al Fine")),e.has(j.JumpDalSegno)&&this._barEndGlyphs.push(new ao("D.S.")),e.has(j.JumpDalSegnoAlCoda)&&this._barEndGlyphs.push(new ao("D.S. al Coda")),e.has(j.JumpDalSegnoAlDoubleCoda)&&this._barEndGlyphs.push(new ao("D.S. al Double Coda")),e.has(j.JumpDalSegnoAlFine)&&this._barEndGlyphs.push(new ao("D.S. al Fine")),e.has(j.JumpDaCapo)&&this._barEndGlyphs.push(new ao("D.C.")),e.has(j.JumpDaCapoAlCoda)&&this._barEndGlyphs.push(new ao("D.C. al Coda")),e.has(j.JumpDaCapoAlDoubleCoda)&&this._barEndGlyphs.push(new ao("D.C. al Double Coda")),e.has(j.JumpDaCapoAlFine)&&this._barEndGlyphs.push(new ao("D.C. al Fine"));const t=this.doSideLayout(this._barBeginGlyphs),n=this.doSideLayout(this._barEndGlyphs);this.height=Math.max(t,n)}doSideLayout(e){let t=0;for(const i of e)i.y=t,i.renderer=this.renderer,i.doLayout(),t+=i.height+3;return t}paint(e,t,n){for(const i of this._barBeginGlyphs)i.paint(e+this.x,t+this.y,n);for(const i of this._barEndGlyphs)i.paint(e+this.x+this.width,t+this.y,n)}}class mre extends gs{get notationElement(){return dt.EffectDirections}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return It.FullBar}shouldCreateGlyph(e,t){return 0===t.voice.index&&0===t.index&&null!==t.voice.bar.masterBar.directions&&t.voice.bar.masterBar.directions.size>0}createNewGlyph(e,t){return new gre(0,0,t.voice.bar.masterBar.directions)}canExpand(e,t){return!0}}let yre=(()=>{class s extends ro{constructor(t){super(0,0),this._text="",this._textWidth=0,this._textHeight=0,this._timer=t}doLayout(){const t=this._timer/6e4|0;this._text=`${t}:${((this._timer-6e4*t)/1e3|0).toString().padStart(2,"0")}`;const i=this.renderer.scoreRenderer.canvas;i.font=this.renderer.resources.timerFont;const r=i.measureText(this._text);this._textHeight=i.font.size+2*s.PaddingY,this._textWidth=r.width+2*s.PaddingX,this.height=this._textHeight+2*s.MarginY}paint(t,n,i){i.strokeRect(t+this.x-(this._textWidth/2|0),n+this.y+s.MarginY,this._textWidth,this._textHeight);const o=i.font,a=i.textBaseline,l=i.textAlign;i.font=this.renderer.resources.timerFont,i.textBaseline=qe.Middle,i.textAlign=ye.Center,i.fillText(this._text,t+this.x,n+this.y+this.height/2),i.font=o,i.textBaseline=a,i.textAlign=l}}return s.PaddingX=2,s.PaddingY=2,s.MarginY=2,s})();class _re extends gs{get notationElement(){return dt.EffectBeatTimer}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return It.SingleOnBeat}shouldCreateGlyph(e,t){return t.showTimer}createNewGlyph(e,t){return new yre(t.timer??0)}canExpand(e,t){return!0}}let vx=(()=>{class s{static print(t){t(`alphaTab ${s.version}`),t(`commit: ${s.commit}`),t(`build date: ${s.date}`)}}return s.version="1.6.3",s.date="2025-08-30T14:34:56.310Z",s.commit="bf30fbbbf85e7c31fe99ed4c5a8f71814bb007e3",s})();class VV{constructor(e,t){this.vertical=e,this.createLayout=t}}class Tx{constructor(e,t){this.supportsWorkers=e,this.createCanvas=t}}class B{static get globalThis(){if(void 0===B._globalThis){try{B._globalThis=globalThis}catch{}typeof B._globalThis>"u"&&(B._globalThis=self),typeof B._globalThis>"u"&&(B._globalThis=global),typeof B._globalThis>"u"&&(B._globalThis=window),typeof B._globalThis>"u"&&(B._globalThis=Function("return this")())}return B._globalThis}static get isRunningInWorker(){return"WorkerGlobalScope"in B.globalThis}static get isRunningInAudioWorklet(){return"AudioWorkletGlobalScope"in B.globalThis}static throttle(e,t){let n=0;return()=>{B.globalThis.clearTimeout(n),n=B.globalThis.setTimeout(e,t)}}static detectScriptFile(){if(!B.isRunningInWorker&&B.globalThis.ALPHATAB_ROOT){let e=B.globalThis.ALPHATAB_ROOT;return e=B.ensureFullUrl(e),e=B.appendScriptName(e),e}try{const e="file:///C:/Users/elkaf/workspaces/fretboard/node_modules/@coderline/alphatab/dist/alphaTab.core.mjs";if(e&&-1===e.indexOf("file://"))return e}catch{}return"document"in B.globalThis&&document.currentScript&&document.currentScript instanceof HTMLScriptElement?document.currentScript.src:null}static ensureFullUrl(e){if(!e)return"";if(!e.startsWith("http")&&!e.startsWith("https")&&!e.startsWith("file")){let t="";const n=B.globalThis.location;if(t+=n.protocol?.toString(),t+="//",n.hostname&&(t+=n.hostname?.toString()),n.port&&(t+=":",t+=n.port?.toString()),!e.startsWith("/")){const i=n.pathname.split("/").slice(0,-1).join("/");i.length>0&&(i.startsWith("/")||(t+="/"),t+=i?.toString())}return e.startsWith("/")||(t+="/"),t+=e?.toString(),t}return e}static appendScriptName(e){return e&&!e.endsWith(".js")&&(e.endsWith("/")||(e+="/"),e+="alphaTab.js"),e}static detectFontDirectory(){if(!B.isRunningInWorker&&B.globalThis.ALPHATAB_FONT)return B.ensureFullUrl(B.globalThis.ALPHATAB_FONT);const e=B.scriptFile;if(e){const t=e.lastIndexOf("/");if(t>=0)return`${e.substr(0,t)}/font/`}return null}static registerJQueryPlugin(){if(!B.isRunningInWorker&&B.globalThis&&"jQuery"in B.globalThis){const e=B.globalThis.jQuery,t=new iV;e.fn.alphaTab=function(n){const i=Array.prototype.slice.call(arguments,1);return 1===this.length?t.exec(this[0],n,i):this.each((r,o)=>{t.exec(o,n,i)})},e.alphaTab={restore:iV.restore},e.fn.alphaTab.fn=t}}static getRenderEngineFactory(e){return e&&B.renderEngines.has(e)?B.renderEngines.get(e):B.renderEngines.get("default")}static getLayoutEngineFactory(e){return e&&B.layoutEngines.has(e)?B.layoutEngines.get(e):B.layoutEngines.get(fu.Page)}static buildImporters(){return[new Jte,new ane,new sne,new bn,new Xie,new nw]}static createDefaultRenderEngines(){const e=new Map;return e.set("svg",new Tx(!0,()=>new rV)),e.set("default",e.get("svg")),e.set("skia",new Tx(!1,()=>new _x)),B.createPlatformSpecificRenderEngines(e),e}static enableAlphaSkia(e,t){_x.enable(e,t)}static registerAlphaSkiaCustomFont(e){return _x.registerFont(e)}static createPlatformSpecificRenderEngines(e){e.set("html5",new Tx(!1,()=>new $ne))}static createDefaultRenderers(){return[new Gh(B.StaffIdBeforeSlashAlways,[new nie,new aie,new Xse,new mre,new Ose,new cre,new sie,new _re,new Vse]),new nre,new Gh(B.StaffIdBeforeScoreAlways,[new zse,new mm,new fre,new pre,new dre]),new Gh(B.StaffIdBeforeScoreHideable,[new lie,new fV,new cV(!0),new pV,new hV,new gV,new dV(!1),new IV,new Jw(Rr.Finger)],(e,t)=>t.showStandardNotation),new Bie,new Gh(B.StaffIdBeforeNumberedAlways,[new Wse,new cV(!1),new Gse,new Jw(Rr.Thumb,(e,t)=>t.voice.bar.staff.showStandardNotation),new hre]),new lre,new Gh(B.StaffIdBeforeTabAlways,[new Yse]),new Gh(B.StaffIdBeforeTabHideable,[new fV,new pV,new hV,new gV,new dV(!0),new eie,new Use,new Tu(Ie.Natural),new Tu(Ie.Artificial),new Tu(Ie.Pinch),new Tu(Ie.Tap),new Tu(Ie.Semi),new Tu(Ie.Feedback),new $se,new Lse,new qse,new Zse,new Kse,new Qse,new IV,new Jw(Rr.Finger,(e,t)=>!t.voice.bar.staff.showStandardNotation)],(e,t)=>t.showTablature),new gx,new Gh(B.StaffIdBeforeEndAlways,[new Jw(Rr.Thumb,(e,t)=>!t.voice.bar.staff.showStandardNotation)])]}static createDefaultStaveProfiles(){const e=new Map,t=B.createDefaultRenderers();e.set(pu.Default,t),e.set(pu.ScoreTab,t);const n=new Set([B.StaffIdBeforeSlashAlways,B.StaffIdBeforeScoreAlways,B.StaffIdBeforeNumberedAlways,B.StaffIdBeforeTabAlways,fx.StaffId,B.StaffIdBeforeEndAlways]);e.set(pu.Score,t.filter(r=>n.has(r.staffId)));const i=new Set([B.StaffIdBeforeSlashAlways,B.StaffIdBeforeScoreAlways,B.StaffIdBeforeNumberedAlways,B.StaffIdBeforeTabAlways,px.StaffId,B.StaffIdBeforeEndAlways]);return e.set(pu.Tab,B.createDefaultRenderers().filter(r=>{if(r instanceof gx){const o=r;o.showTimeSignature=!0,o.showRests=!0,o.showTiedNotes=!0}return i.has(r.staffId)})),e.set(pu.TabMixed,B.createDefaultRenderers().filter(r=>{if(r instanceof gx){const o=r;o.showTimeSignature=!1,o.showRests=!1,o.showTiedNotes=!1}return i.has(r.staffId)})),e}static createDefaultLayoutEngines(){const e=new Map;return e.set(fu.Page,new VV(!0,t=>new uie(t))),e.set(fu.Horizontal,new VV(!1,t=>new cie(t))),e}static initializeMain(e,t){B.isRunningInWorker||B.isRunningInAudioWorklet||((B.webPlatform===io.Browser||B.webPlatform===io.BrowserModule)&&(B.registerJQueryPlugin(),B.HighDpiFactor=window.devicePixelRatio),B.createWebWorker=e,B.createAudioWorklet=t)}static get alphaTabWorker(){return B.globalThis.Worker}static get alphaTabUrl(){return B.globalThis.URL}static initializeWorker(){if(!B.isRunningInWorker)throw new rn(un.General,"Not running in worker, cannot run worker initialization");KD.init(),jD.init(),B.createWebWorker=e=>{throw new rn(un.General,"Nested workers are not supported")}}static initializeAudioWorklet(){if(!B.isRunningInAudioWorklet)throw new rn(un.General,"Not running in audio worklet, cannot run worklet initialization");ase.init()}static detectWebPack(){try{return!0}catch{}return!1}static detectVite(){try{if("string"==typeof __BASE__)return!0}catch{}return!1}static detectWebPlatform(){if(!(typeof B.globalThis.Window<"u"&&B.globalThis instanceof B.globalThis.Window))try{if("[object process]"===Object.prototype.toString.call(typeof process<"u"?process:0))return io.NodeJs}catch{}try{const t="file:///C:/Users/elkaf/workspaces/fretboard/node_modules/@coderline/alphatab/dist/alphaTab.core.mjs";if(t&&"string"==typeof t&&!t.startsWith("file://"))return io.BrowserModule}catch{}return io.Browser}static printEnvironmentInfo(e=!0){const t=e?n=>{F.log.debug("VersionInfo",n)}:n=>{F.debug("VersionInfo",n)};vx.print(t),t(`High DPI: ${B.HighDpiFactor}`),B.printPlatformInfo(t)}static printPlatformInfo(e){e(`Browser: ${navigator.userAgent}`),e(`Platform: ${io[B.webPlatform]}`),e(`WebPack: ${B.isWebPackBundled}`),e(`Vite: ${B.isViteBundled}`),B.webPlatform!==io.NodeJs&&(e(`Window Size: ${window.outerWidth}x${window.outerHeight}`),e(`Screen Size: ${window.screen.width}x${window.screen.height}`))}static prepareForPostMessage(e){if(!e)return e;if("object"==typeof e){const t=e.__v_raw;if(t)return B.prepareForPostMessage(t)}return e}}B.StaffIdBeforeSlashAlways="before-slash-always",B.StaffIdBeforeScoreAlways="before-score-always",B.StaffIdBeforeScoreHideable="before-score-hideable",B.StaffIdBeforeNumberedAlways="before-numbered-always",B.StaffIdBeforeTabAlways="before-tab-always",B.StaffIdBeforeTabHideable="before-tab-hideable",B.StaffIdBeforeEndAlways="before-end-always",B.MusicFontSize=34,B.HighDpiFactor=1,B._globalThis=void 0,B.webPlatform=B.detectWebPlatform(),B.isWebPackBundled=B.detectWebPack(),B.isViteBundled=B.detectVite(),B.scriptFile=B.detectScriptFile(),B.fontDirectory=B.detectFontDirectory(),B.renderEngines=B.createDefaultRenderEngines(),B.layoutEngines=B.createDefaultLayoutEngines(),B.staveProfiles=B.createDefaultStaveProfiles();var Ya=function(s){return s[s.EmbeddedOpenType=0]="EmbeddedOpenType",s[s.Woff=1]="Woff",s[s.Woff2=2]="Woff2",s[s.OpenType=3]="OpenType",s[s.TrueType=4]="TrueType",s[s.Svg=5]="Svg",s}(Ya||{});class kx{static buildDefaultSmuflFontSources(e){const t=new Map,n=e??"";return t.set(Ya.Woff2,`${n}Bravura.woff2`),t.set(Ya.Woff,`${n}Bravura.woff`),t.set(Ya.OpenType,`${n}Bravura.otf`),t}constructor(){this.scriptFile=null,this.fontDirectory=null,this.smuflFontSources=null,this.file=null,this.tex=!1,this.tracks=null,this.enableLazyLoading=!0,this.engine="default",this.logLevel=Tl.Info,this.useWorkers=!0,this.includeNoteBounds=!1,this.scriptFile=B.scriptFile,this.fontDirectory=B.fontDirectory}}Symbol,Symbol;var $=function(s){return s[s.SteelGuitar=1]="SteelGuitar",s[s.AcousticGuitar=2]="AcousticGuitar",s[s.TwelveStringGuitar=3]="TwelveStringGuitar",s[s.ElectricGuitar=4]="ElectricGuitar",s[s.Bass=5]="Bass",s[s.ClassicalGuitar=23]="ClassicalGuitar",s[s.UprightBass=6]="UprightBass",s[s.Ukulele=7]="Ukulele",s[s.Banjo=8]="Banjo",s[s.Mandolin=9]="Mandolin",s[s.Piano=10]="Piano",s[s.Synth=12]="Synth",s[s.Strings=11]="Strings",s[s.Brass=13]="Brass",s[s.Reed=14]="Reed",s[s.Woodwind=15]="Woodwind",s[s.Vocal=16]="Vocal",s[s.PitchedIdiophone=17]="PitchedIdiophone",s[s.Fx=21]="Fx",s[s.PercussionKit=18]="PercussionKit",s[s.Idiophone=19]="Idiophone",s[s.Membraphone=20]="Membraphone",s}($||{});class Z{constructor(e,t,n=null){if(this.icon=$.Piano,this.icon=e,this.instrumentSetName=t,n)this.instrumentSetType=n;else{const i=t.split(" ");i[0]=i[0].substr(0,1).toLowerCase()+i[0].substr(1),this.instrumentSetType=i.join("")}}}class Vr{constructor(){this._rhythmIdLookup=new Map}writeXml(e){const t=new qg;return this._rhythmIdLookup=new Map,this.writeDom(t,e),t.toFormattedString("",!0)}writeDom(e,t){const n=e.addElement("GPIF");n.addElement("GPVersion").innerText="8.1.3";const i=n.addElement("GPRevision");i.attributes.set("required","12024"),i.attributes.set("recommended","13000"),i.innerText="13007";const r=n.addElement("Encoding");r.addElement("EncodingDescription").innerText="GP8";const o=new qo;o.nodeType=es.Comment,o.value=`Written by alphaTab ${vx.version} (${vx.commit})`,r.addChild(o),this.writeScoreNode(n,t),this.writeMasterTrackNode(n,t),this.writeBackingTrackNode(n,t),this.writeAudioTracksNode(n,t),this.writeTracksNode(n,t),this.writeMasterBarsNode(n,t),this.writeAssets(n,t);const a=n.addElement("Bars"),l=n.addElement("Voices"),c=n.addElement("Beats"),u=n.addElement("Notes"),h=n.addElement("Rhythms");for(const d of t.tracks)for(const p of d.staves)for(const g of p.bars){this.writeBarNode(a,g);for(const m of g.voices){this.writeVoiceNode(l,m);for(const _ of m.beats){this.writeBeatNode(c,_,h);for(const y of _.notes)this.writeNoteNode(u,y)}}}}writeAssets(e,t){if(!t.backingTrack?.rawAudioFile)return;const i=e.addElement("Assets").addElement("Asset");i.attributes.set("id",this.backingTrackAssetId),this.backingTrackAssetFileName="Content/Assets/backing-track",i.addElement("EmbeddedFilePath").setCData(this.backingTrackAssetFileName)}writeBackingTrackNode(e,t){if(!t.backingTrack?.rawAudioFile)return;const n=e.addElement("BackingTrack");this.backingTrackAssetId="0",n.addElement("IconId").innerText="21",n.addElement("Color").innerText="0 0 0",n.addElement("Name").setCData("Audio Track"),n.addElement("ShortName").setCData("a.track"),n.addElement("PlaybackState").innerText="Default",n.addElement("Enabled").innerText="true",n.addElement("Source").innerText="Local",n.addElement("AssetId").innerText="0";const r=n.addElement("ChannelStrip");r.addElement("Parameters").innerText="0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.000000 0.500000 0.500000 0.800000 0.500000 0.500000 0.500000",r.addElement("YouTubeVideoUrl").innerText="",r.addElement("Filter").innerText="6",r.addElement("FramesPerPixel").innerText="400";const o=void 0!==this.backingTrackFramePadding?this.backingTrackFramePadding:0;n.addElement("FramePadding").innerText=`${o}`,n.addElement("Semitones").innerText="0",n.addElement("Cents").innerText="0"}writeNoteNode(e,t){const n=e.addElement("Note");n.attributes.set("id",t.id.toString()),this.writeNoteProperties(n,t),t.isGhost&&(n.addElement("AntiAccent").innerText="normal"),t.isLetRing&&n.addElement("LetRing"),t.isTrill&&(n.addElement("Trill").innerText=t.trillValue.toString());let i=0;switch(t.isStaccato&&(i|=1),t.accentuated){case Ss.Normal:i|=8;break;case Ss.Heavy:i|=4;break;case Ss.Tenuto:i|=16}if(i>0&&(n.addElement("Accent").innerText=i.toString()),t.isTieOrigin||t.isTieDestination){const r=n.addElement("Tie");r.attributes.set("origin",t.isTieOrigin?"true":"false"),r.attributes.set("destination",t.isTieDestination?"true":"false")}switch(t.vibrato){case Ft.Slight:n.addElement("Vibrato").innerText="Slight";break;case Ft.Wide:n.addElement("Vibrato").innerText="Wide"}if(t.isFingering){switch(t.leftHandFinger){case Ne.Thumb:n.addElement("LeftFingering").innerText="P";break;case Ne.IndexFinger:n.addElement("LeftFingering").innerText="I";break;case Ne.MiddleFinger:n.addElement("LeftFingering").innerText="M";break;case Ne.AnnularFinger:n.addElement("LeftFingering").innerText="A";break;case Ne.LittleFinger:n.addElement("LeftFingering").innerText="C"}switch(t.rightHandFinger){case Ne.Thumb:n.addElement("RightFingering").innerText="P";break;case Ne.IndexFinger:n.addElement("RightFingering").innerText="I";break;case Ne.MiddleFinger:n.addElement("RightFingering").innerText="M";break;case Ne.AnnularFinger:n.addElement("RightFingering").innerText="A";break;case Ne.LittleFinger:n.addElement("RightFingering").innerText="C"}}n.addElement("InstrumentArticulation").innerText=t.percussionArticulation>=0?t.percussionArticulation.toString():"0",t.ornament!==vs.None&&(n.addElement("Ornament").innerText=vs[t.ornament])}writeNoteProperties(e,t){const n=e.addElement("Properties");if(this.writeConcertPitch(n,t),this.writeTransposedPitch(n,t),t.isStringed&&(this.writeSimplePropertyNode(n,"String","String",(t.string-1).toString()),this.writeSimplePropertyNode(n,"Fret","Fret",t.fret.toString()),this.writeSimplePropertyNode(n,"Midi","Number",t.realValue.toString()),t.showStringNumber&&this.writeSimplePropertyNode(n,"ShowStringNumber","Enable",null)),t.isPiano&&(this.writeSimplePropertyNode(n,"Octave","Number",t.octave.toString()),this.writeSimplePropertyNode(n,"Tone","Step",t.tone.toString()),this.writeSimplePropertyNode(n,"Midi","Number",t.realValue.toString())),t.beat.tap&&this.writeSimplePropertyNode(n,"Tapped","Enable",null),t.harmonicType!==Ie.None){switch(t.harmonicType){case Ie.Natural:this.writeSimplePropertyNode(n,"HarmonicType","HType","Natural");break;case Ie.Artificial:this.writeSimplePropertyNode(n,"HarmonicType","HType","Artificial");break;case Ie.Pinch:this.writeSimplePropertyNode(n,"HarmonicType","HType","Pinch");break;case Ie.Tap:this.writeSimplePropertyNode(n,"HarmonicType","HType","Tap");break;case Ie.Semi:this.writeSimplePropertyNode(n,"HarmonicType","HType","Semi");break;case Ie.Feedback:this.writeSimplePropertyNode(n,"HarmonicType","HType","Feedback")}0!==t.harmonicValue&&this.writeSimplePropertyNode(n,"HarmonicFret","HFret",t.harmonicValue.toString())}t.isDead&&this.writeSimplePropertyNode(n,"Muted","Enable",null),t.isPalmMute&&this.writeSimplePropertyNode(n,"PalmMuted","Enable",null),t.hasBend&&this.writeBend(n,t),t.isHammerPullOrigin&&this.writeSimplePropertyNode(n,"HopoOrigin","Enable",null),t.isHammerPullDestination&&this.writeSimplePropertyNode(n,"HopoDestination","Enable",null),t.isLeftHandTapped&&this.writeSimplePropertyNode(n,"LeftHandTapped","Enable",null);let i=0;switch(t.slideInType){case ri.IntoFromAbove:i|=32;break;case ri.IntoFromBelow:i|=16}switch(t.slideOutType){case Qe.Shift:i|=1;break;case Qe.Legato:i|=2;break;case Qe.OutDown:i|=4;break;case Qe.OutUp:i|=8;break;case Qe.PickSlideDown:i|=64;break;case Qe.PickSlideUp:i|=128}i>0&&this.writeSimplePropertyNode(n,"Slide","Flags",i.toString())}writeTransposedPitch(e,t){t.isPercussion?this.writePitch(e,"ConcertPitch","C","-1",""):this.writePitchForValue(e,"TransposedPitch",t.displayValueWithoutBend,t.accidentalMode)}writeConcertPitch(e,t){t.isPercussion?this.writePitch(e,"ConcertPitch","C","-1",""):this.writePitchForValue(e,"ConcertPitch",t.realValueWithoutHarmonic,t.accidentalMode)}writePitchForValue(e,t,n,i){let r=0,o=0,a="",l="";const c=()=>{r=n%12,o=n/12|0,a=z.defaultSteps[r],l=z.defaultAccidentals[r]};switch(c(),i){case mt.Default:break;case mt.ForceNone:case mt.ForceNatural:l="";break;case mt.ForceSharp:l="#";break;case mt.ForceDoubleSharp:"#"===l&&(n-=2,c()),l="x";break;case mt.ForceFlat:"#"===l&&(n+=1,c()),l="b";break;case mt.ForceDoubleFlat:"#"===l&&(n+=2,c()),l="bb"}this.writePitch(e,t,a,o.toString(),l)}writePitch(e,t,n,i,r){const o=e.addElement("Property");o.attributes.set("name",t);const a=o.addElement("Pitch");a.addElement("Step").innerText=n,a.addElement("Accidental").innerText=r,a.addElement("Octave").innerText=i}writeBend(e,t){t.hasBend&&t.bendPoints.length<=4&&this.writeStandardBend(e,t.bendPoints)}writeStandardBend(e,t){this.writeSimplePropertyNode(e,"Bended","Enable",null);const n=t[0],i=t[t.length-1];let r,o;switch(t.length){case 4:r=t[1],o=t[2];break;case 3:r=t[1],o=t[1];break;default:r=new se((n.offset+i.offset)/2,(n.value+i.value)/2),o=r}this.writeSimplePropertyNode(e,"BendDestinationOffset","Float",this.toBendOffset(i.offset).toString()),this.writeSimplePropertyNode(e,"BendDestinationValue","Float",this.toBendValue(i.value).toString()),this.writeSimplePropertyNode(e,"BendMiddleOffset1","Float",this.toBendOffset(r.offset).toString()),this.writeSimplePropertyNode(e,"BendMiddleOffset2","Float",this.toBendOffset(o.offset).toString()),this.writeSimplePropertyNode(e,"BendMiddleValue","Float",this.toBendValue(r.value).toString()),this.writeSimplePropertyNode(e,"BendOriginOffset","Float",this.toBendOffset(n.offset).toString()),this.writeSimplePropertyNode(e,"BendOriginValue","Float",this.toBendValue(n.value).toString())}toBendValue(e){return 25*e}toBendOffset(e){return e/se.MaxPosition*100}writeBeatNode(e,t,n){const i=e.addElement("Beat");if(i.attributes.set("id",t.id.toString()),i.addElement("Dynamic").innerText=Te[t.dynamics],t.fade!==Ks.None&&(i.addElement("Fadding").innerText=Ks[t.fade]),t.isTremolo)switch(t.tremoloSpeed){case w.Eighth:i.addElement("Tremolo").innerText="1/2";break;case w.Sixteenth:i.addElement("Tremolo").innerText="1/4";break;case w.ThirtySecond:i.addElement("Tremolo").innerText="1/8"}switch(t.hasChord&&i.addElement("Chord").setCData(t.chordId),t.crescendo!==Zi.None&&(i.addElement("Hairpin").innerText=Zi[t.crescendo]),t.brushType){case fe.ArpeggioUp:i.addElement("Arpeggio").innerText="Up";break;case fe.ArpeggioDown:i.addElement("Arpeggio").innerText="Down"}switch(t.text&&i.addElement("FreeText").setCData(t.text),t.graceType){case Ee.OnBeat:case Ee.BeforeBeat:i.addElement("GraceNotes").innerText=Ee[t.graceType]}if(t.ottava!==Ze.Regular&&(i.addElement("Ottavia").innerText=Ze[t.ottava].substr(1)),t.hasWhammyBar&&this.writeWhammyNode(i,t),t.isLegatoOrigin||t.isLegatoDestination){const r=i.addElement("Legato");r.attributes.set("origin",t.isLegatoOrigin?"true":"false"),r.attributes.set("destination",t.isLegatoDestination?"true":"false")}if(this.writeRhythm(i,t,n),null!==t.preferredBeamDirection)switch(t.preferredBeamDirection){case V.Up:i.addElement("TransposedPitchStemOrientation").innerText="Upward",i.addElement("UserTransposedPitchStemOrientation").innerText="Upward";break;case V.Down:i.addElement("TransposedPitchStemOrientation").innerText="Downward",i.addElement("UserTransposedPitchStemOrientation").innerText="Downward"}i.addElement("ConcertPitchStemOrientation").innerText="Undefined",t.slashed&&i.addElement("Slashed"),t.deadSlapped&&i.addElement("DeadSlapped"),t.notes.length>0&&(i.addElement("Notes").innerText=t.notes.map(r=>r.id).join(" ")),t.golpe!==Rr.None&&(i.addElement("Golpe").innerText=Rr[t.golpe]),t.wahPedal!==eo.None&&(i.addElement("Wah").innerText=eo[t.wahPedal]),t.showTimer&&(i.addElement("Timer").innerText=(t.timer??0).toString()),this.writeBeatProperties(i,t),this.writeBeatXProperties(i,t),t.lyrics&&t.lyrics.length>0&&this.writeBeatLyrics(i,t.lyrics)}writeBeatLyrics(e,t){const n=e.addElement("Lyrics");for(const i of t)n.addElement("Line").setCData(i)}writeBeatXProperties(e,t){const n=e.addElement("XProperties");switch(t.brushDuration>0&&this.writeSimpleXPropertyNode(n,"687935489","Int",t.brushDuration.toString()),t.beamingMode){case jn.ForceSplitToNext:this.writeSimpleXPropertyNode(n,"1124204546","Int","2");break;case jn.ForceMergeWithNext:this.writeSimpleXPropertyNode(n,"1124204546","Int","1");break;case jn.ForceSplitOnSecondaryToNext:this.writeSimpleXPropertyNode(n,"1124204552","Int","1")}}writeBeatProperties(e,t){const n=e.addElement("Properties");switch(t.brushType){case fe.BrushUp:this.writeSimplePropertyNode(n,"Brush","Direction","Up");break;case fe.BrushDown:this.writeSimplePropertyNode(n,"Brush","Direction","Down")}switch(t.pickStroke){case yi.Up:this.writeSimplePropertyNode(n,"PickStroke","Direction","Up");break;case yi.Down:this.writeSimplePropertyNode(n,"PickStroke","Direction","Down")}switch(t.slap&&this.writeSimplePropertyNode(n,"Slapped","Enable",null),t.pop&&this.writeSimplePropertyNode(n,"Popped","Enable",null),t.vibrato){case Ft.Wide:this.writeSimplePropertyNode(n,"VibratoWTremBar","Strength","Wide");break;case Ft.Slight:this.writeSimplePropertyNode(n,"VibratoWTremBar","Strength","Slight")}if(t.isBarre)switch(this.writeSimplePropertyNode(n,"BarreFret","Fret",t.barreFret.toString()),t.barreShape){case to.Full:this.writeSimplePropertyNode(n,"BarreString","String","0");break;case to.Half:this.writeSimplePropertyNode(n,"BarreString","String","1")}if(t.rasgueado!==ge.None){let i="";switch(t.rasgueado){case ge.Ii:i="ii_1";break;case ge.Mi:i="mi_1";break;case ge.MiiTriplet:i="mii_1";break;case ge.MiiAnapaest:i="mii_2";break;case ge.PmpTriplet:i="pmp_1";break;case ge.PmpAnapaest:i="pmp_2";break;case ge.PeiTriplet:i="pei_1";break;case ge.PeiAnapaest:i="pei_2";break;case ge.PaiTriplet:i="pai_1";break;case ge.PaiAnapaest:i="pai_2";break;case ge.AmiTriplet:i="ami_1";break;case ge.AmiAnapaest:i="ami_2";break;case ge.Ppp:i="ppp_1";break;case ge.Amii:i="amii_1";break;case ge.Amip:i="amip_1";break;case ge.Eami:i="eami_1";break;case ge.Eamii:i="eamii_1";break;case ge.Peami:i="peami_1"}this.writeSimplePropertyNode(n,"Rasgueado","Rasgueado",i)}}writeRhythm(e,t,n){const i=`${t.duration}_${t.dots}_${t.tupletNumerator}_${t.tupletDenominator}';`;let r;if(this._rhythmIdLookup.has(i))r=this._rhythmIdLookup.get(i);else{r=this._rhythmIdLookup.size.toString(),this._rhythmIdLookup.set(i,r);const o=n.addElement("Rhythm");if(o.attributes.set("id",r),t.hasTuplet){const l=o.addElement("PrimaryTuplet");l.attributes.set("num",t.tupletNumerator.toString()),l.attributes.set("den",t.tupletDenominator.toString())}t.dots>0&&o.addElement("AugmentationDot").attributes.set("count",t.dots.toString());let a="Quarter";switch(t.duration){case w.QuadrupleWhole:a="Long";break;case w.DoubleWhole:a="DoubleWhole";break;case w.Whole:a="Whole";break;case w.Half:a="Half";break;case w.Quarter:a="Quarter";break;case w.Eighth:a="Eighth";break;case w.Sixteenth:a="16th";break;case w.ThirtySecond:a="32nd";break;case w.SixtyFourth:a="64th";break;case w.OneHundredTwentyEighth:a="128th";break;case w.TwoHundredFiftySixth:a="256th"}o.addElement("NoteValue").innerText=a}e.addElement("Rhythm").attributes.set("ref",r)}writeWhammyNode(e,t){t.hasWhammyBar&&t.whammyBarPoints.length<=4&&this.writeStandardWhammy(e,t.whammyBarPoints)}writeStandardWhammy(e,t){const n=e.addElement("Whammy"),i=t[0],r=t[t.length-1];let o,a;switch(t.length){case 4:o=t[1],a=t[2];break;case 3:o=t[1],a=t[1];break;default:o=new se((i.offset+r.offset)/2,(i.value+r.value)/2),a=o}n.attributes.set("destinationOffset",this.toBendOffset(r.offset).toString()),n.attributes.set("destinationValue",this.toBendValue(r.value).toString()),n.attributes.set("middleOffset1",this.toBendOffset(o.offset).toString()),n.attributes.set("middleOffset2",this.toBendOffset(a.offset).toString()),n.attributes.set("middleValue",this.toBendValue(o.value).toString()),n.attributes.set("originOffset",this.toBendOffset(i.offset).toString()),n.attributes.set("originValue",this.toBendValue(i.value).toString())}writeScoreNode(e,t){const n=e.addElement("Score");n.addElement("Title").setCData(t.title),n.addElement("SubTitle").setCData(t.subTitle),n.addElement("Artist").setCData(t.artist),n.addElement("Album").setCData(t.album),n.addElement("Words").setCData(t.words),n.addElement("Music").setCData(t.music),n.addElement("WordsAndMusic").setCData(t.words===t.music?t.words:""),n.addElement("Copyright").setCData(t.copyright),n.addElement("Tabber").setCData(t.tab),n.addElement("Instructions").setCData(t.instructions),n.addElement("Notices").setCData(t.notices),n.addElement("FirstPageHeader").setCData(""),n.addElement("FirstPageFooter").setCData(""),n.addElement("PageHeader").setCData(""),n.addElement("PageFooter").setCData(""),n.addElement("ScoreSystemsDefaultLayout").setCData(t.defaultSystemsLayout.toString()),n.addElement("ScoreSystemsLayout").setCData(t.systemsLayout.join(" ")),n.addElement("ScoreZoomPolicy").innerText="Value",n.addElement("ScoreZoom").innerText="1",n.addElement("MultiVoice").innerText="1>"}writeMasterTrackNode(e,t){const n=e.addElement("MasterTrack");n.addElement("Tracks").innerText=t.tracks.map(l=>l.index).join(" ");const i=n.addElement("Automations");if(t.masterBars.length>0&&t.masterBars[0].isAnacrusis&&n.addElement("Anacrusis"),0===t.masterBars[0].tempoAutomations.length){const l=i.addElement("Automation");l.addElement("Type").innerText="Tempo",l.addElement("Linear").innerText="false",l.addElement("Bar").innerText="0",l.addElement("Position").innerText="0",l.addElement("Visible").innerText="true",l.addElement("Value").innerText=`${t.tempo} 2`,t.tempoLabel&&(l.addElement("Text").innerText=t.tempoLabel)}const r=t.masterBars[0].syncPoints?t.masterBars[0].syncPoints.find(l=>0===l.ratioPosition&&0===l.syncPointValue.barOccurence):void 0,o=r?r.syncPointValue.millisecondOffset:0;this.backingTrackFramePadding=o/1e3*Vr.SampleRate*-1|0;const a=new Wg(()=>Ye.buildModifiedTempoLookup(t));for(const l of t.masterBars){for(const c of l.tempoAutomations){const u=i.addElement("Automation");u.addElement("Type").innerText="Tempo",u.addElement("Linear").innerText=c.isLinear?"true":"false",u.addElement("Bar").innerText=l.index.toString(),u.addElement("Position").innerText=c.ratioPosition.toString(),u.addElement("Visible").innerText="true",u.addElement("Value").innerText=`${c.value} 2`,c.text&&(u.addElement("Text").innerText=c.text)}if(l.syncPoints)for(const c of l.syncPoints){const u=i.addElement("Automation");u.addElement("Type").innerText="SyncPoint",u.addElement("Linear").innerText="false",u.addElement("Bar").innerText=l.index.toString(),u.addElement("Position").innerText=c.ratioPosition.toString(),u.addElement("Visible").innerText="true";const h=u.addElement("Value");h.addElement("BarIndex").innerText=l.index.toString(),h.addElement("BarOccurrence").innerText=c.syncPointValue.barOccurence.toString(),h.addElement("ModifiedTempo").innerText=a.value.get(c).syncBpm.toString(),h.addElement("OriginalTempo").innerText=t.tempo.toString();let d=(c.syncPointValue.millisecondOffset-o)/1e3*Vr.SampleRate;d=Math.floor(d+.5),h.addElement("FrameOffset").innerText=d.toString()}}}writeAudioTracksNode(e,t){e.addElement("AudioTracks")}writeTracksNode(e,t){const n=e.addElement("Tracks");for(const i of t.tracks)this.writeTrackNode(n,i)}writeTrackNode(e,t){const n=e.addElement("Track");n.attributes.set("id",t.index.toString()),n.addElement("Name").setCData(t.name),n.addElement("ShortName").setCData(t.shortName),n.addElement("Color").innerText=`${t.color.r} ${t.color.g} ${t.color.b}`,n.addElement("SystemsDefautLayout").innerText=t.defaultSystemsLayout.toString(),n.addElement("SystemsLayout").innerText=t.systemsLayout.join(" "),n.addElement("AutoBrush"),n.addElement("PalmMute").innerText="0",n.addElement("PlayingStyle").innerText=Va.isGuitar(t.playbackInfo.program)?"StringedPick":"Default",n.addElement("UseOneChannelPerString"),n.addElement("IconId").innerText=Vr.getIconId(t.playbackInfo).toString(),this.writeInstrumentSetNode(n,t),this.writeTransposeNode(n,t),this.writeRseNode(n,t),n.addElement("ForcedSound").innerText="-1",this.writeMidiConnectionNode(n,t),n.addElement("PlaybackState").innerText=t.playbackInfo.isSolo?"Solo":t.playbackInfo.isMute?"Mute":"Default",n.addElement("AudioEngineState").innerText="MIDI",this.writeLyricsNode(n,t),this.writeStavesNode(n,t),this.writeSoundsAndAutomations(n,t)}static getIconId(e){return 9===e.primaryChannel?Vr.DrumKitProgramInfo.icon:Vr.MidiProgramInfoLookup.has(e.program)?Vr.MidiProgramInfoLookup.get(e.program).icon:$.SteelGuitar}writeSoundAndAutomation(e,t,n,i,r,o,a,l=0){const c=e.addElement("Sound");c.addElement("Name").setCData(n),c.addElement("Label").setCData(n),c.addElement("Path").setCData(i),c.addElement("Role").setCData(r);const u=c.addElement("MIDI");u.addElement("LSB").innerText="0",u.addElement("MSB").innerText="0",u.addElement("Program").innerText=a.toString();const h=t.addElement("Automation");h.addElement("Type").innerText="Sound",h.addElement("Linear").innerText="false",h.addElement("Bar").innerText=o.toString(),h.addElement("Position").innerText=l.toString(),h.addElement("Visible").innerText="true",h.addElement("Value").setCData(`${i};${n};${r}`)}writeSoundsAndAutomations(e,t){const n=e.addElement("Sounds"),i=e.addElement("Automations");if(t.staves.length>0&&t.staves[0].bars.length>0){const r=`Track_${t.index}_Initial`,o=`Midi/${t.playbackInfo.program}`,a="Factory";let l=!1;for(const c of t.staves)for(const u of c.bars)for(const h of u.voices)for(const d of h.beats){const p=d.getAutomation($n.Instrument),g=0===u.index&&0===d.index;if(p){const m=g?r:`ProgramChange_${d.id}`,_=g?o:`Midi/${p.value}`,y=g?a:"User";!g&&!l&&(this.writeSoundAndAutomation(n,i,r,o,a,t.staves[0].bars[0].index,t.playbackInfo.program),l=!0),this.writeSoundAndAutomation(n,i,m,_,y,u.index,p.value,p.ratioPosition),g&&(l=!0)}}}for(const r of t.staves)for(const o of r.bars)for(const a of o.sustainPedals)if(a.pedalType!==Ms.Hold){const l=i.addElement("Automation");switch(l.addElement("Type").innerText="SustainPedal",l.addElement("Linear").innerText="false",l.addElement("Bar").innerText=o.index.toString(),l.addElement("Position").innerText=a.ratioPosition.toString(),l.addElement("Visible").innerText="true",a.pedalType){case Ms.Down:l.addElement("Value").innerText="0 1";break;case Ms.Up:l.addElement("Value").innerText="0 3"}}}writeMidiConnectionNode(e,t){const n=e.addElement("MidiConnection");n.addElement("Port").innerText=t.playbackInfo.port.toString(),n.addElement("PrimaryChannel").innerText=t.playbackInfo.primaryChannel.toString(),n.addElement("SecondaryChannel").innerText=t.playbackInfo.secondaryChannel.toString(),n.addElement("ForeOneChannelPerString").innerText="false"}writeRseNode(e,t){const i=e.addElement("RSE").addElement("ChannelStrip");i.attributes.set("version","E56"),i.addElement("Parameters").innerText=`0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 1 0.5 ${t.playbackInfo.balance/16} ${t.playbackInfo.volume/16} 0.5 0.5 0.5`}writeStavesNode(e,t){const n=e.addElement("Staves");for(const i of t.staves)this.writeStaffNode(n,i)}writeStaffNode(e,t){const i=e.addElement("Staff").addElement("Properties");if(this.writeSimplePropertyNode(i,"CapoFret","Fret",t.capo.toString()),this.writeSimplePropertyNode(i,"FretCount","Fret","24"),t.tuning.length>0){const r=i.addElement("Property");switch(r.attributes.set("name","Tuning"),r.addElement("Pitches").innerText=t.tuning.slice().reverse().join(" "),r.addElement("Label").setCData(t.tuningName),r.addElement("LabelVisible").innerText=t.tuningName?"true":"false",r.addElement("Flat"),t.tuning.length){case 3:r.addElement("Instrument").innerText="Shamisen";break;case 4:r.addElement("Instrument").innerText=105===t.track.playbackInfo.program?"Banjo":42===t.track.playbackInfo.program?"Cello":43===t.track.playbackInfo.program?"Contrabass":40===t.track.playbackInfo.program?"Violin":41===t.track.playbackInfo.program?"Viola":"Bass";break;case 5:r.addElement("Instrument").innerText=105===t.track.playbackInfo.program?"Banjo":"Bass";break;case 6:r.addElement("Instrument").innerText=105===t.track.playbackInfo.program?"Banjo":t.track.playbackInfo.program<=39?"Bass":"Guitar";break;case 7:r.addElement("Instrument").innerText=t.track.playbackInfo.program<=39?"Bass":"Guitar";break;default:r.addElement("Instrument").innerText="Guitar"}}this.writeSimplePropertyNode(i,"PartialCapoFret","Fret","0"),this.writeSimplePropertyNode(i,"PartialCapoStringFlags","Bitset",t.tuning.map(r=>"0").join("")),this.writeSimplePropertyNode(i,"TuningFlat","Enable",null),this.writeDiagramCollection(i,t,"DiagramCollection"),this.writeDiagramCollection(i,t,"DiagramWorkingSet")}writeDiagramCollection(e,t,n){const i=e.addElement("Property");i.attributes.set("name",n);const r=i.addElement("Items"),o=t.chords;if(o)for(const[a,l]of o){const c=r.addElement("Item");c.attributes.set("id",a),c.attributes.set("name",l.name);const u=c.addElement("Diagram");u.attributes.set("stringCount",l.strings.length.toString()),u.attributes.set("fretCount","5"),u.attributes.set("baseFret",(l.firstFret-1).toString()),u.attributes.set("barStates",l.strings.map(C=>"1").join(" "));const h=[],d=new Map;for(let C=0;C<l.strings.length;C++){const v=l.strings[C];if(-1!==v){const x=u.addElement("Fret"),q=l.strings.length-1-C;x.attributes.set("string",q.toString()),x.attributes.set("fret",(v-l.firstFret+1).toString()),d.has(v)||(d.set(v,[]),h.push(v)),d.get(v).push(q)}}h.sort();const p=u.addElement("Fingering");if(l.barreFrets.length>0){const C=[Ne.LittleFinger,Ne.AnnularFinger,Ne.MiddleFinger,Ne.IndexFinger];for(const v of h){const x=d.get(v);if(x.length>1&&l.barreFrets.indexOf(v)>=0){const q=C.length>0?C.pop():Ne.IndexFinger;for(const W of x){const L=p.addElement("Position");switch(q){case Ne.LittleFinger:L.attributes.set("finger","Pinky");break;case Ne.AnnularFinger:L.attributes.set("finger","Ring");break;case Ne.MiddleFinger:L.attributes.set("finger","Middle");break;case Ne.IndexFinger:L.attributes.set("finger","Index")}L.attributes.set("fret",(v-l.firstFret+1).toString()),L.attributes.set("string",W.toString())}}}}const g=u.addElement("Property");g.attributes.set("name","ShowName"),g.attributes.set("type","bool"),g.attributes.set("value",l.showName?"true":"false");const m=u.addElement("Property");m.attributes.set("name","ShowDiagram"),m.attributes.set("type","bool"),m.attributes.set("value",l.showDiagram?"true":"false");const _=u.addElement("Property");_.attributes.set("name","ShowFingering"),_.attributes.set("type","bool"),_.attributes.set("value",l.showFingering?"true":"false");const y=u.addElement("Chord"),b=y.addElement("KeyNote");b.attributes.set("step","C"),b.attributes.set("accidental","Natural");const S=y.addElement("BassNote");S.attributes.set("step","C"),S.attributes.set("accidental","Natural");const D=y.addElement("Degree");D.attributes.set("interval","Third"),D.attributes.set("alteration","Major"),D.attributes.set("omitted","false");const T=y.addElement("Degree");T.attributes.set("interval","Fifth"),T.attributes.set("alteration","Perfect"),T.attributes.set("omitted","false")}}writeSimplePropertyNode(e,t,n,i){const r=e.addElement("Property");r.attributes.set("name",t);const o=r.addElement(n);return null!==i&&(o.innerText=i),r}writeSimpleXPropertyNode(e,t,n,i){const r=e.addElement("XProperty");r.attributes.set("id",t);const o=r.addElement(n);return null!==i&&(o.innerText=i),r}writeLyricsNode(e,t){const n=e.addElement("Lyrics");n.attributes.set("dispatched","true");const i=[];for(const r of t.staves[0].bars)for(const o of r.voices)if(!o.isEmpty)for(const a of o.beats)if(a.lyrics)for(let l=0;l<a.lyrics.length;l++){for(;l>=i.length;){const u=new Tf;u.startBar=r.index,u.text="[Empty]",i.push(u)}const c=i[l];c.text="[Empty]"===c.text?a.lyrics[l]:`${c.text} ${a.lyrics[l].split(" ").join("+")}`}for(let r=0;r<i.length;r++){const o=n.addElement("Line");o.addElement("Text").setCData(i[r].text),o.addElement("Offset").innerText=i[r].startBar.toString()}}writeTransposeNode(e,t){const n=e.addElement("Transpose"),i=Math.floor(t.staves[0].displayTranspositionPitch/12),r=t.staves[0].displayTranspositionPitch-12*i;n.addElement("Chromatic").innerText=r.toString(),n.addElement("Octave").innerText=i.toString()}writeInstrumentSetNode(e,t){const n=e.addElement("InstrumentSet"),i=t.staves[0];if(n.addElement("LineCount").innerText=i.standardNotationLineCount.toString(),t.percussionArticulations.length>0||i.isPercussion){const r=t.percussionArticulations.length>0?t.percussionArticulations:Array.from(Gs.instrumentArticulations.values());n.addElement("Name").innerText=Vr.DrumKitProgramInfo.instrumentSetName,n.addElement("Type").innerText=Vr.DrumKitProgramInfo.instrumentSetType;let o="",a=new qo;const l=new Map,c=n.addElement("Elements");for(const u of r){{const d=c.addElement("Element");let p=u.elementType;if(l.has(p)){const g=l.get(p);p+=` ${g}`,l.set(p,g+1)}else l.set(p,1);o=p,d.addElement("Name").innerText=p,d.addElement("Type").innerText=u.elementType,a=d.addElement("Articulations")}const h=a.addElement("Articulation");switch(h.addElement("Name").innerText=`${o} ${a.childNodes.length}`,h.addElement("StaffLine").innerText=u.staffLine.toString(),h.addElement("Noteheads").innerText=[this.mapMusicSymbol(u.noteHeadDefault),this.mapMusicSymbol(u.noteHeadHalf),this.mapMusicSymbol(u.noteHeadWhole)].join(" "),u.techniqueSymbolPlacement){case qe.Top:h.addElement("TechniquePlacement").innerText="below";break;case qe.Middle:h.addElement("TechniquePlacement").innerText="inside";break;case qe.Bottom:h.addElement("TechniquePlacement").innerText="above"}h.addElement("TechniqueSymbol").innerText=this.mapMusicSymbol(u.techniqueSymbol),h.addElement("InputMidiNumbers").innerText="",h.addElement("OutputMidiNumber").innerText=u.outputMidiNumber.toString()}}else{const r=Vr.MidiProgramInfoLookup.has(t.playbackInfo.program)?Vr.MidiProgramInfoLookup.get(t.playbackInfo.program):Vr.MidiProgramInfoLookup.get(0);n.addElement("Name").innerText=r.instrumentSetName,n.addElement("Type").innerText=r.instrumentSetType;const a=n.addElement("Elements").addElement("Element");a.addElement("Pitched").innerText="Pitched",a.addElement("Type").innerText="pitched",a.addElement("SoundbankName").innerText="";const c=a.addElement("Articulations").addElement("Articulation");c.addElement("Name").innerText="",c.addElement("StaffLine").innerText="0",c.addElement("Noteheads").innerText="noteheadBlack noteheadHalf noteheadWhole",c.addElement("TechniquePlacement").innerText="outside",c.addElement("TechniqueSymbol").innerText="",c.addElement("InputMidiNumbers").innerText="",c.addElement("OutputRSESound").innerText="",c.addElement("OutputMidiNumber").innerText="0"}}mapMusicSymbol(e){if(e===f.None)return"";const t=f[e];return t.substring(0,1).toLowerCase()+t.substring(1)}writeMasterBarsNode(e,t){const n=e.addElement("MasterBars");for(const i of t.masterBars)this.writeMasterBarNode(n,i)}writeMasterBarNode(e,t){const n=e.addElement("MasterBar"),i=n.addElement("Key");i.addElement("AccidentalCount").innerText=t.keySignature.toString(),i.addElement("Mode").innerText=dr[t.keySignatureType],i.addElement("Sharps").innerText="Sharps",n.addElement("Time").innerText=`${t.timeSignatureNumerator}/${t.timeSignatureDenominator}`,t.isFreeTime&&n.addElement("FreeTime");const r=[];for(const o of t.score.tracks)for(const a of o.staves)r.push(a.bars[t.index].id.toString());if(n.addElement("Bars").innerText=r.join(" "),t.isDoubleBar&&n.addElement("DoubleBar"),t.isSectionStart){const o=n.addElement("Section");o.addElement("Letter").setCData(t.section.marker),o.addElement("Text").setCData(t.section.text)}if(t.isRepeatStart||t.isRepeatEnd){const o=n.addElement("Repeat");o.attributes.set("start",t.isRepeatStart?"true":"false"),o.attributes.set("end",t.isRepeatEnd?"true":"false"),t.isRepeatEnd&&o.attributes.set("count",t.repeatCount.toString())}if(t.alternateEndings>0){let o=t.alternateEndings;const a=[];let l=0;for(;o>0;)1==(o>>l&1)&&(a.push(l+1),o&=~(1<<l)),l++;n.addElement("AlternateEndings").innerText=a.join(" ")}if(t.tripletFeel!==nt.NoTripletFeel&&(n.addElement("TripletFeel").innerText=nt[t.tripletFeel]),t.directions&&t.directions.size>0){const o=n.addElement("Directions");for(const a of t.directions)switch(a){case j.TargetFine:o.addElement("Target").innerText="Fine";break;case j.TargetSegno:o.addElement("Target").innerText="Segno";break;case j.TargetSegnoSegno:o.addElement("Target").innerText="SegnoSegno";break;case j.TargetCoda:o.addElement("Target").innerText="Coda";break;case j.TargetDoubleCoda:o.addElement("Target").innerText="DoubleCoda";break;case j.JumpDaCapo:o.addElement("Jump").innerText="DaCapo";break;case j.JumpDaCapoAlCoda:o.addElement("Jump").innerText="DaCapoAlCoda";break;case j.JumpDaCapoAlDoubleCoda:o.addElement("Jump").innerText="DaCapoAlDoubleCoda";break;case j.JumpDaCapoAlFine:o.addElement("Jump").innerText="DaCapoAlFine";break;case j.JumpDalSegno:o.addElement("Jump").innerText="DaSegno";break;case j.JumpDalSegnoAlCoda:o.addElement("Jump").innerText="DaSegnoAlCoda";break;case j.JumpDalSegnoAlDoubleCoda:o.addElement("Jump").innerText="DaSegnoAlDoubleCoda";break;case j.JumpDalSegnoAlFine:o.addElement("Jump").innerText="DaSegnoAlFine";break;case j.JumpDalSegnoSegno:o.addElement("Jump").innerText="DaSegnoSegno";break;case j.JumpDalSegnoSegnoAlCoda:o.addElement("Jump").innerText="DaSegnoSegnoAlCoda";break;case j.JumpDalSegnoSegnoAlDoubleCoda:o.addElement("Jump").innerText="DaSegnoSegnoAlDoubleCoda";break;case j.JumpDalSegnoSegnoAlFine:o.addElement("Jump").innerText="DaSegnoSegnoAlFine";break;case j.JumpDaCoda:o.addElement("Jump").innerText="DaCoda";break;case j.JumpDaDoubleCoda:o.addElement("Jump").innerText="DaDoubleCoda"}}this.writeFermatas(n,t)}writeFermatas(e,t){const n=t.fermata?.size??0;if(0!==n&&n>0){const i=e.addElement("Fermatas");for(const[r,o]of t.fermata)this.writeFermata(i,r,o)}}writeFermata(e,t,n){let i=-1,r=1;if(t>0)for(;r<10&&(i=t/G.QuarterTime*r,i!==Math.floor(i));)i=-1,r++;else i=0,r=1;if(-1===i)return;const o=e.addElement("Fermata");o.addElement("Type").innerText=Ui[n.type],o.addElement("Length").innerText=n.length.toString(),o.addElement("Offset").innerText=`${i}/${r}`}writeBarNode(e,t){const n=e.addElement("Bar");n.attributes.set("id",t.id.toString()),n.addElement("Voices").innerText=t.voices.map(i=>i.isEmpty?"-1":i.id.toString()).join(" "),n.addElement("Clef").innerText=Et[t.clef],t.clefOttava!==Ze.Regular&&(n.addElement("Ottavia").innerText=Ze[t.clefOttava].substr(1)),t.simileMark!==ws.None&&(n.addElement("SimileMark").innerText=ws[t.simileMark])}writeVoiceNode(e,t){if(t.isEmpty)return;const n=e.addElement("Voice");n.attributes.set("id",t.id.toString()),n.addElement("Beats").innerText=t.beats.map(i=>i.id).join(" ")}}Vr.SampleRate=44100,Vr.MidiProgramInfoLookup=new Map([[0,new Z($.Piano,"Acoustic Piano")],[1,new Z($.Piano,"Acoustic Piano")],[2,new Z($.Piano,"Electric Piano")],[3,new Z($.Piano,"Acoustic Piano")],[4,new Z($.Piano,"Electric Piano")],[5,new Z($.Piano,"Electric Piano")],[6,new Z($.Piano,"Harpsichord")],[7,new Z($.Piano,"Harpsichord")],[8,new Z($.PitchedIdiophone,"Celesta")],[9,new Z($.PitchedIdiophone,"Vibraphone")],[10,new Z($.PitchedIdiophone,"Vibraphone")],[11,new Z($.PitchedIdiophone,"Vibraphone")],[12,new Z($.PitchedIdiophone,"Xylophone")],[13,new Z($.PitchedIdiophone,"Xylophone")],[14,new Z($.PitchedIdiophone,"Vibraphone")],[15,new Z($.Banjo,"Banjo")],[16,new Z($.Piano,"Electric Organ")],[17,new Z($.Piano,"Electric Organ")],[18,new Z($.Piano,"Electric Organ")],[19,new Z($.Piano,"Electric Organ")],[20,new Z($.Piano,"Electric Organ")],[21,new Z($.Piano,"Electric Organ")],[22,new Z($.Woodwind,"Recorder")],[23,new Z($.Piano,"Electric Organ")],[24,new Z($.ClassicalGuitar,"Nylon Guitar")],[25,new Z($.SteelGuitar,"Steel Guitar")],[26,new Z($.SteelGuitar,"Electric Guitar")],[27,new Z($.ElectricGuitar,"Electric Guitar")],[28,new Z($.ElectricGuitar,"Electric Guitar")],[29,new Z($.ElectricGuitar,"Electric Guitar")],[30,new Z($.SteelGuitar,"Electric Guitar")],[31,new Z($.SteelGuitar,"Electric Guitar")],[32,new Z($.Bass,"Acoustic Bass")],[33,new Z($.Bass,"Electric Bass")],[34,new Z($.Bass,"Electric Bass")],[35,new Z($.Bass,"Acoustic Bass")],[36,new Z($.Bass,"Electric Bass")],[37,new Z($.Bass,"Electric Bass")],[38,new Z($.Synth,"Synth Bass")],[39,new Z($.Synth,"Synth Bass")],[40,new Z($.Strings,"Violin")],[41,new Z($.Strings,"Viola")],[42,new Z($.Strings,"Cello")],[43,new Z($.Strings,"Contrabass")],[44,new Z($.Strings,"Violin")],[45,new Z($.Strings,"Violin")],[46,new Z($.Piano,"Harp")],[47,new Z($.Membraphone,"Timpani")],[48,new Z($.Strings,"Violin")],[49,new Z($.Strings,"Violin")],[50,new Z($.Strings,"Violin")],[51,new Z($.Strings,"Violin")],[52,new Z($.Vocal,"Voice")],[53,new Z($.Vocal,"Voice")],[54,new Z($.Vocal,"Voice")],[55,new Z($.Synth,"Pad Synthesizer")],[56,new Z($.Brass,"Trumpet")],[57,new Z($.Brass,"Trombone")],[58,new Z($.Brass,"Tuba")],[59,new Z($.Brass,"Trumpet")],[60,new Z($.Brass,"French Horn")],[61,new Z($.Brass,"Trumpet")],[62,new Z($.Brass,"Trumpet")],[63,new Z($.Brass,"Trumpet")],[64,new Z($.Reed,"Saxophone")],[65,new Z($.Reed,"Saxophone")],[66,new Z($.Reed,"Saxophone")],[67,new Z($.Reed,"Saxophone")],[68,new Z($.Reed,"Oboe")],[69,new Z($.Reed,"English Horn")],[70,new Z($.Reed,"Bassoon")],[71,new Z($.Reed,"Clarinet")],[72,new Z($.Reed,"Piccolo")],[73,new Z($.Woodwind,"Flute")],[74,new Z($.Woodwind,"Recorder")],[75,new Z($.Woodwind,"Flute")],[76,new Z($.Woodwind,"Recorder")],[77,new Z($.Woodwind,"Flute")],[78,new Z($.Woodwind,"Recorder")],[79,new Z($.Woodwind,"Flute")],[80,new Z($.Synth,"Lead Synthesizer")],[81,new Z($.Synth,"Lead Synthesizer")],[82,new Z($.Synth,"Lead Synthesizer")],[83,new Z($.Synth,"Lead Synthesizer")],[84,new Z($.Synth,"Lead Synthesizer")],[85,new Z($.Synth,"Lead Synthesizer")],[86,new Z($.Synth,"Lead Synthesizer")],[87,new Z($.Synth,"Lead Synthesizer")],[88,new Z($.Synth,"Pad Synthesizer")],[89,new Z($.Synth,"Pad Synthesizer")],[90,new Z($.Synth,"Pad Synthesizer")],[91,new Z($.Synth,"Pad Synthesizer")],[92,new Z($.Synth,"Pad Synthesizer")],[93,new Z($.Synth,"Pad Synthesizer")],[94,new Z($.Synth,"Pad Synthesizer")],[95,new Z($.Synth,"Pad Synthesizer")],[96,new Z($.Fx,"Pad Synthesizer")],[97,new Z($.Fx,"Pad Synthesizer")],[98,new Z($.Fx,"Pad Synthesizer")],[99,new Z($.Fx,"Pad Synthesizer")],[100,new Z($.Fx,"Lead Synthesizer")],[101,new Z($.Fx,"Lead Synthesizer")],[102,new Z($.Fx,"Lead Synthesizer")],[103,new Z($.Fx,"Trumpet")],[104,new Z($.ElectricGuitar,"Banjo")],[105,new Z($.Banjo,"Banjo")],[106,new Z($.Ukulele,"Ukulele")],[107,new Z($.Banjo,"Banjo")],[108,new Z($.PitchedIdiophone,"Xylophone")],[109,new Z($.Reed,"Bassoon")],[110,new Z($.Strings,"Violin")],[111,new Z($.Woodwind,"Flute")],[112,new Z($.PitchedIdiophone,"Xylophone")],[113,new Z($.Idiophone,"Celesta")],[114,new Z($.PitchedIdiophone,"Vibraphone")],[115,new Z($.Idiophone,"Xylophone")],[116,new Z($.Membraphone,"Xylophone")],[117,new Z($.Membraphone,"Xylophone")],[118,new Z($.Membraphone,"Xylophone")],[119,new Z($.Idiophone,"Celesta")],[120,new Z($.Fx,"Steel Guitar")],[121,new Z($.Fx,"Recorder")],[122,new Z($.Fx,"Recorder")],[123,new Z($.Fx,"Recorder")],[124,new Z($.Fx,"Recorder")],[125,new Z($.Fx,"Recorder")],[126,new Z($.Fx,"Recorder")],[127,new Z($.Fx,"Timpani")]]),Vr.DrumKitProgramInfo=new Z($.PercussionKit,"Drums","drumKit");class xc{static buildCrc32Lookup(){const t=new Uint32Array(256);for(let n=0;n<t.length;n++){let i=n;for(let r=0;r<8;r++)i=1&~i?i>>>1:i>>>1^3988292384;t[n]=i}return t}get value(){return~this._checkValue}constructor(){this._checkValue=xc.CrcInit,this.reset()}update(e,t,n){for(let i=0;i<n;i++)this._checkValue=xc.Crc32Lookup[255&(this._checkValue^e[t+i])]^this._checkValue>>>8}reset(){this._checkValue=xc.CrcInit}}xc.Crc32Lookup=xc.buildCrc32Lookup(),xc.CrcInit=4294967295;class Ge{}Ge.MAX_WBITS=15,Ge.WSIZE=1<<Ge.MAX_WBITS,Ge.WMASK=Ge.WSIZE-1,Ge.MIN_MATCH=3,Ge.MAX_MATCH=258,Ge.DEFAULT_MEM_LEVEL=8,Ge.PENDING_BUF_SIZE=1<<Ge.DEFAULT_MEM_LEVEL+8,Ge.HASH_BITS=Ge.DEFAULT_MEM_LEVEL+7,Ge.HASH_SIZE=1<<Ge.HASH_BITS,Ge.HASH_SHIFT=(Ge.HASH_BITS+Ge.MIN_MATCH-1)/Ge.MIN_MATCH,Ge.HASH_MASK=Ge.HASH_SIZE-1,Ge.MIN_LOOKAHEAD=Ge.MAX_MATCH+Ge.MIN_MATCH+1,Ge.MAX_DIST=Ge.WSIZE-Ge.MIN_LOOKAHEAD;let Cx=(()=>{class s{constructor(t,n,i,r){this.length=null,this.numCodes=0,this.codes=null,this.huffman=t,this.minNumCodes=i,this.maxLength=r,this.freqs=new Int16Array(n),this.bitLengthCounts=new Int32Array(r)}reset(){for(let t=0;t<this.freqs.length;t++)this.freqs[t]=0;this.codes=null,this.length=null}buildTree(){const t=this.freqs.length,n=new Int32Array(t);let i=0,r=0;for(let u=0;u<t;u++){const h=this.freqs[u];if(0!==h){let d=i++;for(;d>0;){const p=Math.floor((d-1)/2);if(!(this.freqs[n[p]]>h))break;n[d]=n[p],d=p}n[d]=u,r=u}}for(;i<2;){const u=r<2?++r:0;n[i++]=u}this.numCodes=Math.max(r+1,this.minNumCodes);const o=i,a=new Int32Array(4*i-2),l=new Int32Array(2*i-1);let c=o;for(let u=0;u<i;u++){const h=n[u];a[2*u]=h,a[2*u+1]=-1,l[u]=this.freqs[h]<<8,n[u]=u}do{const u=n[0];let h=n[--i],d=0,p=1;for(;p<i;)p+1<i&&l[n[p]]>l[n[p+1]]&&p++,n[d]=n[p],d=p,p=2*p+1;let g=l[h];for(;p=d,d>0&&(d=Math.floor((p-1)/2),l[n[d]]>g);)n[p]=n[d];n[p]=h;const m=n[0];h=c++,a[2*h]=u,a[2*h+1]=m;const _=Math.min(255&l[u],255&l[m]);for(g=l[u]+l[m]-_+1,l[h]=g,d=0,p=1;p<i;)p+1<i&&l[n[p]]>l[n[p+1]]&&p++,n[d]=n[p],d=p,p=2*d+1;for(;p=d,p>0&&(d=Math.floor((p-1)/2),l[n[d]]>g);)n[p]=n[d];n[p]=h}while(i>1);this.buildLength(a)}buildLength(t){this.length=new Uint8Array(this.freqs.length);const n=Math.floor(t.length/2),i=Math.floor((n+1)/2);let r=0;for(let c=0;c<this.maxLength;c++)this.bitLengthCounts[c]=0;const o=new Int32Array(n);o[n-1]=0;for(let c=n-1;c>=0;c--)if(-1!==t[2*c+1]){let u=o[c]+1;u>this.maxLength&&(u=this.maxLength,r++),o[t[2*c]]=u,o[t[2*c+1]]=u}else this.bitLengthCounts[o[c]-1]++,this.length[t[2*c]]=o[c];if(0===r)return;let a=this.maxLength-1;do{for(;0===this.bitLengthCounts[--a];);do{this.bitLengthCounts[a]--,this.bitLengthCounts[++a]++,r-=1<<this.maxLength-1-a}while(r>0&&a<this.maxLength-1)}while(r>0);this.bitLengthCounts[this.maxLength-1]+=r,this.bitLengthCounts[this.maxLength-2]-=r;let l=2*i;for(let c=this.maxLength;0!==c;c--){let u=this.bitLengthCounts[c-1];for(;u>0;){const h=2*t[l++];-1===t[h+1]&&(this.length[t[h]]=c,u--)}}}getEncodedLength(){let t=0;for(let n=0;n<this.freqs.length;n++)t+=this.freqs[n]*this.length[n];return t}calcBLFreq(t){let n,i,r,o=-1,a=0;for(;a<this.numCodes;){r=1;const l=this.length[a];for(0===l?(n=138,i=3):(n=6,i=3,o!==l&&(t.freqs[l]++,r=0)),o=l,a++;a<this.numCodes&&o===this.length[a]&&(a++,!(++r>=n)););r<i?t.freqs[o]+=r:0!==o?t.freqs[s.Repeat3To6]++:r<=10?t.freqs[s.Repeat3To10]++:t.freqs[s.Repeat11To138]++}}setStaticCodes(t,n){this.codes=t,this.length=n}buildCodes(){const t=new Int32Array(this.maxLength);let n=0;this.codes=new Int16Array(this.freqs.length);for(let i=0;i<this.maxLength;i++)t[i]=n,n+=this.bitLengthCounts[i]<<15-i;for(let i=0;i<this.numCodes;i++){const r=this.length[i];r>0&&(this.codes[i]=$e.bitReverse(t[r-1]),t[r-1]+=1<<16-r)}}writeTree(t){let n,i,r,o=-1,a=0;for(;a<this.numCodes;){r=1;const l=this.length[a];for(0===l?(n=138,i=3):(n=6,i=3,o!==l&&(t.writeSymbol(l),r=0)),o=l,a++;a<this.numCodes&&o===this.length[a]&&(a++,!(++r>=n)););if(r<i)for(;r-- >0;)t.writeSymbol(o);else 0!==o?(t.writeSymbol(s.Repeat3To6),this.huffman.pending.writeBits(r-3,2)):r<=10?(t.writeSymbol(s.Repeat3To10),this.huffman.pending.writeBits(r-3,3)):(t.writeSymbol(s.Repeat11To138),this.huffman.pending.writeBits(r-11,7))}}writeSymbol(t){this.huffman.pending.writeBits(65535&this.codes[t],this.length[t])}}return s.Repeat3To6=16,s.Repeat3To10=17,s.Repeat11To138=18,s})();class $e{static staticInit(){let e=0;for(;e<144;)$e.staticLCodes[e]=$e.bitReverse(48+e<<8),$e.staticLLength[e++]=8;for(;e<256;)$e.staticLCodes[e]=$e.bitReverse(256+e<<7),$e.staticLLength[e++]=9;for(;e<280;)$e.staticLCodes[e]=$e.bitReverse(-256+e<<9),$e.staticLLength[e++]=7;for(;e<$e.LITERAL_NUM;)$e.staticLCodes[e]=$e.bitReverse(-88+e<<8),$e.staticLLength[e++]=8;for(e=0;e<$e.DIST_NUM;e++)$e.staticDCodes[e]=$e.bitReverse(e<<11),$e.staticDLength[e]=5}static bitReverse(e){return $e.bit4Reverse[15&e]<<12|$e.bit4Reverse[e>>4&15]<<8|$e.bit4Reverse[e>>8&15]<<4|$e.bit4Reverse[e>>12]}constructor(e){this.last_lit=0,this.extra_bits=0,this.pending=e,this.literalTree=new Cx(this,$e.LITERAL_NUM,257,15),this.distTree=new Cx(this,$e.DIST_NUM,1,15),this.blTree=new Cx(this,$e.BITLEN_NUM,4,7),this.d_buf=new Int16Array($e.BUFSIZE),this.l_buf=new Uint8Array($e.BUFSIZE)}isFull(){return this.last_lit>=$e.BUFSIZE}reset(){this.last_lit=0,this.extra_bits=0,this.literalTree.reset(),this.distTree.reset(),this.blTree.reset()}flushStoredBlock(e,t,n,i){this.pending.writeBits(($e.STORED_BLOCK<<1)+(i?1:0),3),this.pending.alignToByte(),this.pending.writeShort(n),this.pending.writeShort(~n),this.pending.writeBlock(e,t,n),this.reset()}flushBlock(e,t,n,i){this.literalTree.freqs[$e.EOF_SYMBOL]++,this.literalTree.buildTree(),this.distTree.buildTree(),this.literalTree.calcBLFreq(this.blTree),this.distTree.calcBLFreq(this.blTree),this.blTree.buildTree();let r=4;for(let l=18;l>r;l--)this.blTree.length[$e.BL_ORDER[l]]>0&&(r=l+1);let o=14+3*r+this.blTree.getEncodedLength()+this.literalTree.getEncodedLength()+this.distTree.getEncodedLength()+this.extra_bits,a=this.extra_bits;for(let l=0;l<$e.LITERAL_NUM;l++)a+=this.literalTree.freqs[l]*$e.staticLLength[l];for(let l=0;l<$e.DIST_NUM;l++)a+=this.distTree.freqs[l]*$e.staticDLength[l];o>=a&&(o=a),t>=0&&n+4<o>>3?this.flushStoredBlock(e,t,n,i):o===a?(this.pending.writeBits(($e.STATIC_TREES<<1)+(i?1:0),3),this.literalTree.setStaticCodes($e.staticLCodes,$e.staticLLength),this.distTree.setStaticCodes($e.staticDCodes,$e.staticDLength),this.compressBlock(),this.reset()):(this.pending.writeBits(($e.DYN_TREES<<1)+(i?1:0),3),this.sendAllTrees(r),this.compressBlock(),this.reset())}sendAllTrees(e){this.blTree.buildCodes(),this.literalTree.buildCodes(),this.distTree.buildCodes(),this.pending.writeBits(this.literalTree.numCodes-257,5),this.pending.writeBits(this.distTree.numCodes-1,5),this.pending.writeBits(e-4,4);for(let t=0;t<e;t++)this.pending.writeBits(this.blTree.length[$e.BL_ORDER[t]],3);this.literalTree.writeTree(this.blTree),this.distTree.writeTree(this.blTree)}compressBlock(){for(let e=0;e<this.last_lit;e++){const t=255&this.l_buf[e];let n=this.d_buf[e];if(0!==n--){const i=$e.Lcode(t);this.literalTree.writeSymbol(i);let r=Math.floor((i-261)/4);r>0&&r<=5&&this.pending.writeBits(t&(1<<r)-1,r);const o=$e.Dcode(n);this.distTree.writeSymbol(o),r=Math.floor(o/2)-1,r>0&&this.pending.writeBits(n&(1<<r)-1,r)}else this.literalTree.writeSymbol(t)}this.literalTree.writeSymbol($e.EOF_SYMBOL)}tallyDist(e,t){this.d_buf[this.last_lit]=e,this.l_buf[this.last_lit++]=t-3;const n=$e.Lcode(t-3);this.literalTree.freqs[n]++,n>=265&&n<285&&(this.extra_bits+=Math.floor((n-261)/4));const i=$e.Dcode(e-1);return this.distTree.freqs[i]++,i>=4&&(this.extra_bits+=Math.floor(i/2)-1),this.isFull()}tallyLit(e){return this.d_buf[this.last_lit]=0,this.l_buf[this.last_lit++]=e,this.literalTree.freqs[e]++,this.isFull()}static Lcode(e){if(255===e)return 285;let t=257;for(;e>=8;)t+=4,e>>=1;return t+e}static Dcode(e){let t=0;for(;e>=4;)t+=2,e>>=1;return t+e}}$e.BUFSIZE=1<<Ge.DEFAULT_MEM_LEVEL+6,$e.LITERAL_NUM=286,$e.STORED_BLOCK=0,$e.STATIC_TREES=1,$e.DYN_TREES=2,$e.DIST_NUM=30,$e.staticLCodes=new Int16Array($e.LITERAL_NUM),$e.staticLLength=new Uint8Array($e.LITERAL_NUM),$e.staticDCodes=new Int16Array($e.DIST_NUM),$e.staticDLength=new Uint8Array($e.DIST_NUM),$e.BL_ORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$e.bit4Reverse=new Uint8Array([0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15]),$e.BITLEN_NUM=19,$e.EOF_SYMBOL=256,$e.staticInit();Symbol;class Qw extends Ua{constructor(){super(0,0,jt.EndOfTrack)}writeTo(e){throw new rn(un.General,"Deprecated event, serialization not supported")}}var Dx=function(s){return s[s.SequenceNumber=0]="SequenceNumber",s[s.TextEvent=1]="TextEvent",s[s.CopyrightNotice=2]="CopyrightNotice",s[s.SequenceOrTrackName=3]="SequenceOrTrackName",s[s.InstrumentName=4]="InstrumentName",s[s.LyricText=5]="LyricText",s[s.MarkerText=6]="MarkerText",s[s.CuePoint=7]="CuePoint",s[s.PatchName=8]="PatchName",s[s.PortName=9]="PortName",s[s.MidiChannel=32]="MidiChannel",s[s.MidiPort=33]="MidiPort",s[s.EndOfTrack=47]="EndOfTrack",s[s.Tempo=81]="Tempo",s[s.SmpteOffset=84]="SmpteOffset",s[s.TimeSignature=88]="TimeSignature",s[s.KeySignature=89]="KeySignature",s[s.SequencerSpecific=127]="SequencerSpecific",s}(Dx||{});class xx extends Qw{get metaStatus(){return Dx.EndOfTrack}}var WV=function(s){return s[s.SystemExclusive=240]="SystemExclusive",s[s.MtcQuarterFrame=241]="MtcQuarterFrame",s[s.SongPosition=242]="SongPosition",s[s.SongSelect=243]="SongSelect",s[s.TuneRequest=246]="TuneRequest",s[s.SystemExclusive2=247]="SystemExclusive2",s}(WV||{});class GV extends Qw{}var UV=function(s){return s[s.MetronomeTick=0]="MetronomeTick",s[s.Rest=1]="Rest",s}(UV||{});const zV=Object.freeze(Object.defineProperty({__proto__:null,AlphaSynthMidiFileHandler:da,AlphaTabMetronomeEvent:ID,AlphaTabRestEvent:BD,AlphaTabSysExEvent:jg,get AlphaTabSystemExclusiveEvents(){return UV},BeatTickLookup:$o,BeatTickLookupItem:Y2,ControlChangeEvent:RD,get ControllerType(){return Gn},DeprecatedMidiEvent:Qw,EndOfTrackEvent:HD,MasterBarTickLookup:ex,MasterBarTickLookupTempoChange:am,MetaDataEvent:class Cre extends xx{constructor(){super(...arguments),this.data=new Uint8Array}},MetaEvent:xx,get MetaEventType(){return Dx},MetaNumberEvent:class Dre extends xx{constructor(){super(...arguments),this.value=0}},Midi20PerNotePitchBendEvent:class xre extends Qw{constructor(){super(...arguments),this.noteKey=0,this.pitch=0}},MidiEvent:Ua,get MidiEventType(){return jt},MidiFile:xl,get MidiFileFormat(){return Df},MidiFileGenerator:Ye,MidiTickLookup:J2,MidiTickLookupFindBeatResult:X2,get MidiTickLookupFindBeatResultCursorMode(){return jo},MidiTrack:ND,NoteBendEvent:VD,NoteEvent:MD,NoteOffEvent:AD,NoteOnEvent:PD,PitchBendEvent:LD,ProgramChangeEvent:FD,SystemCommonEvent:GV,get SystemCommonType(){return WV},SystemExclusiveEvent:(()=>{class s extends GV{constructor(){super(...arguments),this.data=new Uint8Array}get isMetronome(){return!1}get metronomeNumerator(){return-1}get metronomeDurationInTicks(){return-1}get metronomeDurationInMilliseconds(){return-1}get isRest(){return!1}get manufacturerId(){return 0}}return s.AlphaTabManufacturerId=125,s})(),TempoChangeEvent:OD,TimeSignatureEvent:ED},Symbol.toStringTag,{value:"Module"}));Symbol,Symbol,Symbol,Symbol,Symbol,B.isRunningInWorker?B.initializeWorker():B.isRunningInAudioWorklet?B.initializeAudioWorklet():B.initializeMain(s=>{if(B.webPlatform===io.NodeJs)throw new rn(un.General,"Workers not yet supported in Node.js");if(B.webPlatform===io.BrowserModule||B.isWebPackBundled||B.isViteBundled){F.debug("AlphaTab","Creating webworker");try{return new B.alphaTabWorker(new B.alphaTabUrl(nn.p+nn.u(193),nn.b),{type:void 0})}catch(t){F.debug("AlphaTab","ESM webworker construction with direct URL failed",t)}let e="";try{e=new B.alphaTabUrl("./alphaTab.worker.mjs","file:///C:/Users/elkaf/workspaces/fretboard/node_modules/@coderline/alphatab/dist/alphaTab.mjs");const t=`import ${JSON.stringify(e)}`,n=new Blob([t],{type:"application/javascript"});return new Worker(URL.createObjectURL(n),{type:"module"})}catch(t){F.debug("AlphaTab","ESM webworker construction with blob import failed",e,t)}try{if(!s.core.scriptFile)throw new Error("Could not detect alphaTab script file");e=s.core.scriptFile;const t=`import ${JSON.stringify(s.core.scriptFile)}`,n=new Blob([t],{type:"application/javascript"});return new Worker(URL.createObjectURL(n),{type:"module"})}catch(t){F.debug("AlphaTab","ESM webworker construction with blob import failed",s.core.scriptFile,t)}}if(!s.core.scriptFile)throw new rn(un.General,"Could not detect alphaTab script file, cannot initialize renderer");try{F.debug("AlphaTab","Creating Blob worker");const e=`importScripts('${s.core.scriptFile}')`,t=new Blob([e],{type:"application/javascript"});return new Worker(URL.createObjectURL(t))}catch{return F.warning("Rendering","Could not create inline worker, fallback to normal worker"),new Worker(s.core.scriptFile)}},(s,e)=>{if(B.webPlatform===io.NodeJs)throw new rn(un.General,"Audio Worklets not yet supported in Node.js");return B.webPlatform===io.BrowserModule||B.isWebPackBundled||B.isViteBundled?(F.debug("AlphaTab","Creating Module worklet"),async function(n){await n.addModule(URL.createObjectURL(new Blob([`\n\t                globalThis.self = globalThis.self || globalThis;\n\t                globalThis.location = ${JSON.stringify(nn.b)};\n\t                globalThis.importScripts = (url) => { throw new Error("importScripts not available, dynamic loading of chunks not supported in this context", url) };\n\t            `],{type:"application/javascript; charset=utf-8"})));for(const i of nn.wsc(415))await n.addModule(new URL(nn.p+i,nn.b))}(s.audioWorklet)):(F.debug("AlphaTab","Creating Script worklet"),s.audioWorklet.addModule(e.core.scriptFile))});class Nre extends rr{constructor(e,t){super()}schedule(e,t=0){return this}}const Kw={setInterval(s,e,...t){const{delegate:n}=Kw;return n?.setInterval?n.setInterval(s,e,...t):setInterval(s,e,...t)},clearInterval(s){const{delegate:e}=Kw;return(e?.clearInterval||clearInterval)(s)},delegate:void 0},qV={now:()=>(qV.delegate||Date).now(),delegate:void 0};class ym{constructor(e,t=ym.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,n){return new this.schedulerActionCtor(this,e).schedule(n,t)}}ym.now=qV.now;const e0=new class Ire extends ym{constructor(e,t=ym.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}(class Ere extends Nre{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var n;if(this.closed)return this;this.state=e;const i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(r,this.id,t),this}requestAsyncId(e,t,n=0){return Kw.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&Kw.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let i,n=!1;try{this.work(e)}catch(r){n=!0,i=r||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Lc(n,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}),Bre=e0;class Pre{constructor(e,t){this.value=e,this.interval=t}}function $V(s,e){return e?t=>nb(e.pipe(lu(1),function Rre(){return Oi((s,e)=>{s.subscribe(pi(e,Uu))})}()),t.pipe($V(s))):Mr((t,n)=>Pa(s(t,n)).pipe(lu(1),function Fre(s){return Kn(()=>s)}(t)))}function Vre(s,e=e0){const t=function Lre(s=0,e,t=Bre){let n=-1;return null!=e&&(qF(e)?t=e:n=e),new Lt(i=>{let r=function Ore(s){return s instanceof Date&&!isNaN(s)}(s)?+s-t.now():s;r<0&&(r=0);let o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=n?this.schedule(void 0,n):i.complete())},r)})}(s,e);return $V(()=>t)}let jV=(()=>{class s{bluetoothDevices=[];connectedDevice=null;server=null;serialServiceUUID="0000ffe0-0000-1000-8000-00805f9b34fb";serialCharacteristicUUID="0000ffe1-0000-1000-8000-00805f9b34fb";serialCharacteristic=null;_connectedDevice=new lt(null);connectedDevice$=this._connectedDevice.asObservable();setConnectedDevice(t){this.connectedDevice=t,this._connectedDevice.next(t)}constructor(){}discoverDevices(){var t=this;return Ae(function*(){t.bluetoothDevices=[];try{const n=yield navigator.bluetooth.requestDevice({acceptAllDevices:!1,optionalServices:[t.serialServiceUUID],filters:[{namePrefix:"BT05"}]});n&&(t.bluetoothDevices.push(n),console.log("Found device HM-10:",n))}catch(n){console.error("Error discovering Bluetooth devices:",n)}return t.bluetoothDevices})()}connectToDevice(t){var n=this;return Ae(function*(){try{if(!t.gatt)throw new Error("GATT server not available on device");if(n.server=yield t.gatt.connect(),n.server){const i=yield n.server.getPrimaryService(n.serialServiceUUID);n.serialCharacteristic=yield i.getCharacteristic(n.serialCharacteristicUUID),n.setConnectedDevice(t),console.log("Connected to device: ",t.name),console.log("UUID : "+n.serialCharacteristic.uuid),n.reset()}}catch(i){console.error("Error connecting to device:",i)}})()}disconnectDevice(){this.connectedDevice?.gatt?.connected&&(this.connectedDevice.gatt.disconnect(),console.log("Disconnected from device:",this.connectedDevice.name),this.setConnectedDevice(null))}sendSelectedNoteIfConnected(t){var n=this;return Ae(function*(){n.connectedDevice&&n.connectedDevice.gatt?.connected&&n.serialCharacteristic?yield n.setLedByNote(t,!0):console.warn("Bluetooth not connected. Cannot send note.")})()}octaves=[[0,0,0,0,0,1],[0,0,0,0,0,1],[0,1,2,1,0,1],[1,1,2,1,1,2],[1,1,2,2,1,2],[2,2,3,2,3,3],[2,2,3,2,3,3],[3,4,4,3,3,4],[3,4,4,3,4,4],[3,4,5,5,4,4],[4,5,5,5,5,5],[4,5,5,5,5,5],[6,6,6,6,6,7],[6,6,6,6,6,7],[6,7,8,7,6,7],[7,7,8,7,7,8],[7,7,8,8,7,8],[8,8,9,8,9,9],[8,8,9,8,9,9],[9,10,10,9,9,10],[9,10,10,9,10,10],[9,10,11,11,10,10]];Notes=[[7,0,5,10,2,7],[8,1,6,11,3,8],[9,2,7,0,4,9],[10,3,8,1,5,10],[11,4,9,2,6,11],[0,5,10,3,7,0],[1,6,11,4,8,1],[2,7,0,5,9,2],[3,8,1,6,10,3],[4,9,2,7,11,4],[5,10,3,8,0,5],[6,11,4,9,1,6],[7,0,5,10,2,7],[8,1,6,11,3,8],[9,2,7,0,4,9],[10,3,8,1,5,10],[11,4,9,2,6,11],[0,5,10,3,7,0],[1,6,11,4,8,1],[2,7,0,5,9,2],[3,8,1,6,10,3],[4,9,2,7,11,4],[5,10,3,8,0,5],[6,11,4,9,1,6],[7,0,5,10,2,7]];getOctave(t,n){return this.octaves[t][n]}getNote(t,n){return this.Notes[t][n]}setLedByNote(t,n){var i=this;return Ae(function*(){const o={C:3,"C#":4,Db:4,D:5,"D#":6,Eb:6,E:7,F:8,"F#":9,Gb:9,G:10,"G#":11,Ab:11,A:0,"A#":1,Bb:1,B:2}[t];if(void 0===o)throw new Error("Invalid note name");const a=[0,1,2,3,4,5,6,7,8,9,10,11];if(n)for(let l of a)yield i.sendSerialData([69,o,l]);else for(let l of a)yield i.sendSerialData([68,o,l])})()}sendDataSet(t){var n=this;return Ae(function*(){const i=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],r=[];for(let o of i)t.includes(o)?(r.push(63),r.push(63)):(r.push(0),r.push(0));console.log("Resulting byte array:",r),yield n.sendSerialData([65]);for(let o=0;o<r.length;o++)yield n.sendSerialData([r[o]])})()}sendSerialData(t){var n=this;return Ae(function*(){if(!n.serialCharacteristic)throw new Error("Not connected to serial characteristic");const i=new Uint8Array(t);try{yield n.serialCharacteristic.writeValueWithoutResponse(i),yield n.readSerialData().then(r=>{})}catch{}})()}readSerialData(){var t=this;return Ae(function*(){if(!t.serialCharacteristic)throw new Error("Not connected to serial characteristic");const n=yield t.serialCharacteristic.readValue(),i=[];for(let r=0;r<n.byteLength;r++)i.push(n.getUint8(r));return i})()}setLedByfretAndString(t,n,i){var r=this;return Ae(function*(){const o=r.getNote(t,n-1),a=r.getOctave(t,n-1);r.connectedDevice&&r.connectedDevice.gatt?.connected&&r.serialCharacteristic&&(i?(console.log("Turning on LED for fret",t,"string",n),r.sendSerialData([69,o,a])):(console.log("Turning off LED for fret",t,"string",n),r.sendSerialData([68,o,a])))})()}reset(){var t=this;return Ae(function*(){console.log("Resetting the device"),yield t.sendSerialData([64])})()}sendSerialNotes(t){var n=this;return Ae(function*(i,r=3,o=50,a=!0){if(!n.serialCharacteristic)throw new Error("Not connected to serial characteristic");const l=[];for(const c of i){const u=n.getNote(c.fret,c.gstring-1),h=n.getOctave(c.fret,c.gstring-1);l.push(a?69:68),l.push(u),l.push(h)}if(n.connectedDevice&&n.connectedDevice.gatt?.connected&&n.serialCharacteristic){const c=new Uint8Array(l);try{const u=[];for(let h=0;h<c.length;h+=r)u.push(c.slice(h,h+r));console.log(`Sending data in ${u.length} chunks...`);for(const h of u)yield n.serialCharacteristic.writeValueWithoutResponse(h),Vre(o);console.log("All chunks sent successfully.")}catch(u){console.error("Failed to send serial data:",u)}}}).apply(this,arguments)}static \u0275fac=function(n){return new(n||s)};static \u0275prov=ut({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const Hre=["alphaTabContainer"];function Wre(s,e){1&s&&(K(0,"div"),Xi(1,"div",17),K(2,"p"),we(3,"Loading, please wait..."),J()())}function Gre(s,e){if(1&s){const t=Ys();K(0,"li",18)(1,"span",19),we(2),J(),K(3,"button",7),ht("click",function(){const i=xt(t).$implicit;return Nt(_e(2).connectToDevice(i))}),we(4," Connect "),J()()}if(2&s){const t=e.$implicit;Q(2),vo(t.name||"Unnamed Device")}}function Ure(s,e){if(1&s&&(K(0,"ul",14),qn(1,Wre,4,0,"div",15)(2,Gre,5,1,"li",16),J()),2&s){const t=_e();Q(),gt("ngIf",t.isLoading),Q(),gt("ngForOf",t.bluetoothDevices)}}function zre(s,e){if(1&s){const t=Ys();K(0,"div",20)(1,"p"),we(2),K(3,"button",7),ht("click",function(){return xt(t),Nt(_e().disconnectDevice())}),we(4,"Disconnect"),J(),K(5,"button",7),ht("click",function(){return xt(t),Nt(_e().reset())}),we(6," Reset "),J()()()}if(2&s){const t=_e();Q(2),hr("Connected to: ",t.connectedDevice.name," ")}}function qre(s,e){if(1&s&&(K(0,"div",32)(1,"span",33),we(2),J()()),2&s){const t=_e(2);Q(2),vo(t.formatPosition(t.playbackPosition))}}function $re(s,e){if(1&s){const t=Ys();K(0,"div",21)(1,"button",22),ht("click",function(){return xt(t),Nt(_e().togglePlayback())}),we(2),J(),K(3,"button",23),ht("click",function(){return xt(t),Nt(_e().stop())}),we(4,"\u23f9\ufe0f"),J(),K(5,"div",24)(6,"label"),we(7),J(),K(8,"input",25),ht("input",function(i){return xt(t),Nt(_e().setTempo(i))}),J()(),K(9,"div",26)(10,"label",27)(11,"input",28),Go("ngModelChange",function(i){xt(t);const r=_e();return aa(r.autoScrollEnabled,i)||(r.autoScrollEnabled=i),Nt(i)}),ht("change",function(){return xt(t),Nt(_e().toggleAutoScroll())}),J(),we(12," Auto Scroll "),J()(),K(13,"div",29)(14,"label",30)(15,"input",28),Go("ngModelChange",function(i){xt(t);const r=_e();return aa(r.loopEnabled,i)||(r.loopEnabled=i),Nt(i)}),ht("change",function(){return xt(t),Nt(_e().toggleLoop())}),J(),we(16," Loop Selection "),J()(),qn(17,qre,3,1,"div",31),J()}if(2&s){const t=_e();Q(2),hr(" ",t.isPlaying?"\u23f8\ufe0f":"\u25b6\ufe0f"," "),Q(5),hr("Tempo: ",t.currentTempo,"%"),Q(),gt("value",t.currentTempo),Q(3),Wo("ngModel",t.autoScrollEnabled),Q(4),Wo("ngModel",t.loopEnabled),Q(2),gt("ngIf",t.playbackPosition)}}function jre(s,e){if(1&s&&(K(0,"div",57)(1,"small"),we(2),J()()),2&s){const t=_e().$implicit;Q(2),hr("Channel: ",(null==t.channel?null:t.channel.channel1)||"N/A")}}function Yre(s,e){if(1&s){const t=Ys();K(0,"div",47)(1,"div",48),ht("click",function(){const i=xt(t).$implicit;return Nt(_e(2).toggleTrackSelection(i.index))}),K(2,"div",49),Xi(3,"div",50),K(4,"span",51),we(5),J()(),K(6,"div",52),ht("click",function(i){return xt(t),Nt(i.stopPropagation())}),K(7,"button",53),ht("click",function(){const i=xt(t).$implicit;return Nt(_e(2).toggleMute(i.index))}),we(8," \u{1f507} "),J(),K(9,"button",54),ht("click",function(){const i=xt(t).$implicit;return Nt(_e(2).toggleSolo(i.index))}),we(10," \u{1f3af} "),J(),K(11,"button",55),ht("click",function(){const i=xt(t).$implicit;return Nt(_e(2).toggleTrackVisibility(i.index))}),we(12," \u{1f441}\ufe0f "),J()()(),qn(13,jre,3,1,"div",56),J()}if(2&s){const t=e.$implicit,n=_e(2);br("selected",n.selectedTracks.includes(t.index)),Q(3),yk("background-color",t.color),Q(2),vo(t.name||t.shortName||"Track "+(t.index+1)),Q(2),br("active",t.isMute),Q(2),br("active",t.isSolo),Q(2),br("active",t.isVisible),Q(2),gt("ngIf",n.selectedTracks.includes(t.index))}}function Xre(s,e){if(1&s){const t=Ys();K(0,"div",34)(1,"div",35)(2,"h3"),we(3),J(),K(4,"div",36),qn(5,Yre,14,12,"div",37),J(),K(6,"div",38)(7,"button",39),ht("click",function(){return xt(t),Nt(_e().selectAllTracks())}),we(8,"Select All"),J(),K(9,"button",39),ht("click",function(){return xt(t),Nt(_e().deselectAllTracks())}),we(10,"Deselect All"),J(),K(11,"button",39),ht("click",function(){return xt(t),Nt(_e().muteAllTracks())}),we(12,"Mute All"),J(),K(13,"button",39),ht("click",function(){return xt(t),Nt(_e().unmuteAllTracks())}),we(14,"Unmute All"),J()()(),K(15,"div",40)(16,"div",41,1)(18,"div",42)(19,"div",43),we(20," Music sheet is loading "),J()(),K(21,"div",44)(22,"div",45),Xi(23,"div",46),J()()()()()}if(2&s){const t=_e();Q(3),hr("Tracks (",t.tracks.length,")"),Q(2),gt("ngForOf",t.tracks)("ngForTrackBy",t.trackByIndex)}}function Jre(s,e){1&s&&(K(0,"div",58),Xi(1,"div",17),K(2,"p"),we(3,"Loading Guitar Pro file..."),J()())}function Zre(s,e){1&s&&(K(0,"div",59)(1,"h2"),we(2,"Welcome to Guitar Pro Player!"),J(),K(3,"p"),we(4,"Load a Guitar Pro file (.gp, .gp3, .gp4, .gp5, .gpx, .gp6) to get started."),J(),K(5,"ul")(6,"li"),we(7,"\u2728 Multi-track support with individual controls"),J(),K(8,"li"),we(9,"\u{1f3b5} Playback with tempo control"),J(),K(10,"li"),we(11,"\u{1f3bc} Interactive score visualization"),J(),K(12,"li"),we(13,"\u{1f507} Mute/Solo individual tracks"),J(),K(14,"li"),we(15,"\u{1f441}\ufe0f Show/Hide tracks in the score"),J()()())}let Qre=(()=>{class s{smartLightBluetoothService;ngZone;alphaTabContainer;api;score;arrayBuffer;isLoading=!1;isLoaded=!1;isPlaying=!1;currentTempo=100;tracks=[];selectedTracks=[];currentSelectedTrackIndex=0;autoScrollEnabled=!0;playbackPosition=null;loopEnabled=!1;bluetoothDevices=[];connectedDevice=null;deviceSubscription;_onOffNote=new lt(null);onOffNote$=this._onOffNote.asObservable().pipe(function Mre(s=e0){return Oi((e,t)=>{let n=s.now();e.subscribe(pi(t,i=>{const r=s.now(),o=r-n;n=r,t.next(new Pre(i,o))}))})}(),Kn(t=>({...t.value,timeInterval:t.interval})));onOffNoteSubscription;currentValue=null;lastInterval=null;constructor(t,n){this.smartLightBluetoothService=t,this.ngZone=n,this.isLoading=!1}ngAfterViewInit(){}ngOnInit(){this.deviceSubscription=this.smartLightBluetoothService.connectedDevice$.subscribe(t=>{this.connectedDevice=t}),this.onOffNoteSubscription=this.onOffNote$.pipe(function Are(s,e=e0){return Oi((t,n)=>{let i=null,r=null,o=null;const a=()=>{if(i){i.unsubscribe(),i=null;const c=r;r=null,n.next(c)}};function l(){const c=o+s,u=e.now();if(u<c)return i=this.schedule(void 0,c-u),void n.add(i);a()}t.subscribe(pi(n,c=>{r=c,o=e.now(),i||(i=e.schedule(l,s),n.add(i))},()=>{a(),n.complete()},void 0,()=>{r=i=null}))})}(10)).subscribe(t=>{null!==t?.timeInterval?console.log(` occurred after ${t?.timeInterval}ms  and at  ${new Date(Date.now()).toLocaleString()}`):console.log(`Initial state: ${t?.on}`),console.log(`note emitted, OnOff: ${t?.on},   Fret: ${t?.fret}, String: ${t?.string}`),t&&this.sendToBluetooth(t?.fret,t?.string,t.on??!0)})}ngOnDestroy(){this.api&&this.api.destroy(),this.deviceSubscription.unsubscribe(),this.onOffNoteSubscription.unsubscribe()}initializeAlphaTab(){this.api&&this.api.destroy(),this.api=new Lw(this.alphaTabContainer.nativeElement,{core:{engine:"html5",logLevel:1,fontDirectory:"assets/fonts/"},display:{staveProfile:"Default",resources:{}},notation:{notationMode:"GuitarPro",fingeringMode:"SingleNoteEffectBand"},player:{enablePlayer:!0,soundFont:"assets/sound_fonts/sonivox.sf2",scrollMode:bc.OffScreen,enableCursor:!0,scrollElement:this.alphaTabContainer.nativeElement,enableElementHighlighting:!0,enableUserInteraction:!0,enableAnimatedBeatCursor:!0,scrollSpeed:400}}),this.api.midiEventsPlayedFilter=[zV.MidiEventType.NoteOn,zV.MidiEventType.NoteOff],this.api.load(this.arrayBuffer),this.api.beatMouseDown.on(i=>{console.log("Beat clicked:   ",i),this.startSelectionOnBeat(i)});const t=this.alphaTabContainer.nativeElement.querySelector(".at-overlay");this.api.renderStarted.on(()=>{t.style.display="flex"}),this.api.renderFinished.on(()=>{t.style.display="none"}),this.api.scoreLoaded.on(i=>{console.log("Score loaded:",i),this.onScoreLoaded(i)}),this.api.playerReady.on(()=>{console.log("Player ready")}),this.api.playerStateChanged.on(i=>{this.isPlaying=1===i.state}),this.api.playerPositionChanged.on(i=>{this.playbackPosition=i?{currentTick:i.currentTick,endTick:i.endTick,currentTimeMillis:i.currentTime,endTimeMillis:i.endTime,isLooping:i.isLooping||!1}:null}),this.api.playbackRangeChanged.on(i=>{console.log("Playback range changed:",i),this.autoScrollEnabled&&this.isPlaying&&this.scrollToCurrentPosition(i)}),this.api.activeBeatsChanged.on(i=>{if(i.activeBeats[this.currentSelectedTrackIndex])for(const r of i.activeBeats[this.currentSelectedTrackIndex].notes)for(const o of r.beat.notes){const a=o;a.on=!1,console.log(`Note off: Fret ${a.fret}, String ${a.string}`),setTimeout(()=>{this._onOffNote.next(a)},50)}}),this.api.playedBeatChanged.on(i=>{this.autoScrollEnabled&&this.isPlaying&&this.highlightCurrentBeat(i),i&&i.notes&&i.notes.forEach(o=>{const a=o;a.on=!0,console.log(`Note on: Fret ${a.fret}, String ${a.string}`),this._onOffNote.next(a)})})}onFileSelected(t){const n=t.target.files[0];n&&this.loadFile(n)}loadFile(t){this.isLoading=!0,this.isLoaded=!1;const n=new FileReader;n.readAsArrayBuffer(t),n.onload=i=>{this.arrayBuffer=i.target?.result;try{this.isLoaded=!0,setTimeout(()=>{this.alphaTabContainer&&this.alphaTabContainer.nativeElement&&(console.log("Element is now in the DOM:",this.alphaTabContainer.nativeElement),this.initializeAlphaTab())},10)}catch(r){console.error("Error loading file:",r),alert("Error loading file. Please make sure it's a valid Guitar Pro file."),this.isLoading=!1,this.isLoaded=!1}},n.onerror=()=>{alert("Error reading file."),this.isLoading=!1,this.isLoaded=!1}}onScoreLoaded(t){this.score=t,this.isLoading=!1,this.isLoaded=!0,this.initializeTracks()}initializeTracks(){this.tracks=this.score.tracks.map((t,n)=>({index:n,name:t.name,shortName:t.shortName,color:this.getTrackColor(n),channel:t.playbackInfo,isVisible:!0,isMute:!1,isSolo:!1,score:t.score,playbackInfo:t.playbackInfo,fretCount:t,tuning:t.tuning})),console.log("Initialized tracks:",this.tracks),this.updateTrackVisibility(),this.toggleTrackSelection(0)}getTrackColor(t){const n=["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#e67e22","#34495e","#f1c40f","#e91e63"];return n[t%n.length]}togglePlayback(){this.isPlaying?this.api.pause():this.api.play()}stop(){this.api.stop(),this.playbackPosition=null}setTempo(t){const n=parseInt(t.target.value);this.currentTempo=n,this.api.playbackSpeed=n/100}toggleAutoScroll(){this.autoScrollEnabled||this.resetScrollPosition()}formatPosition(t){const n=Math.floor(t.currentTimeMillis/6e4),i=Math.floor(t.currentTimeMillis%6e4/1e3),r=Math.floor(t.endTimeMillis/6e4),o=Math.floor(t.endTimeMillis%6e4/1e3),a=(l,c)=>`${l}:${c.toString().padStart(2,"0")}`;return`${a(n,i)} / ${a(r,o)}`}scrollToCurrentPosition(t){const i=this.alphaTabContainer.nativeElement.querySelectorAll(".at-cursor-beat");if(i.length>0){const r=i[0];r&&r.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}}highlightCurrentBeat(t){const n=this.alphaTabContainer.nativeElement;n.querySelectorAll(".current-beat-highlight").forEach(o=>{o.classList.remove("current-beat-highlight")}),n.querySelectorAll(`[data-beat-id="${t.id}"]`).forEach(o=>{o.classList.add("current-beat-highlight")})}resetScrollPosition(){const t=this.alphaTabContainer.nativeElement;t&&t.scrollTo({top:0,left:0,behavior:"smooth"})}toggleTrackSelection(t){this.currentSelectedTrackIndex=t,this.selectedTracks=[t],this.tracks.forEach((n,i)=>{n.isVisible=i===t}),this.updateTrackVisibility(),this.updateTrackPlayback()}toggleMute(t){const n=this.tracks[t];n.isMute=!n.isMute,n.isSolo&&(n.isSolo=!1),this.updateTrackPlayback()}toggleSolo(t){const n=this.tracks[t];n.isSolo=!n.isSolo,n.isMute&&(n.isMute=!1);const i=this.tracks.some(r=>r.isSolo);this.tracks.forEach(r=>{r.index!==t&&i?r.isMute=!r.isSolo:i||(r.isMute=!1)}),this.updateTrackPlayback()}toggleTrackVisibility(t){const n=this.tracks[t];n.isVisible=!n.isVisible,this.updateTrackVisibility()}updateTrackPlayback(){this.tracks.forEach((t,n)=>{const i=!this.selectedTracks.includes(n);t.isMute=i;try{console.log(`Updating track ${n} mute state to ${i}`),this.api.changeTrackMute([n],i)}catch(r){console.warn(`Could not mute track ${n}:`,r)}})}updateTrackVisibility(){const t=this.tracks.filter(n=>n.isVisible);try{console.log("successfully updated track visibility:",this.tracks),this.api.renderTracks(t)}catch(n){console.warn("Could not update track visibility:",n)}}selectAllTracks(){this.selectedTracks=this.tracks.map(t=>t.index)}deselectAllTracks(){this.selectedTracks=[]}muteAllTracks(){this.tracks.forEach(t=>{t.isMute=!0,t.isSolo=!1}),this.updateTrackPlayback()}unmuteAllTracks(){this.tracks.forEach(t=>{t.isMute=!1,t.isSolo=!1}),this.updateTrackPlayback()}trackByIndex(t,n){return n.index}startSelectionOnBeat(t){this.api.selection&&t&&(this.api.selection.clear(),this.api.selection.add(t.masterBar.score.tracks[0],t.voice,t),this.api.render())}toggleLoop(){this.api&&this.api.player&&(this.api.player.isLooping=this.loopEnabled)}discoverDevices(){var t=this;return Ae(function*(){t.isLoading=!0,t.bluetoothDevices=[];try{(yield t.smartLightBluetoothService.discoverDevices()).map(n=>{t.ngZone.run(()=>{t.bluetoothDevices.push(n),t.isLoading=!1})})}catch{t.bluetoothDevices=[]}finally{t.isLoading=!1}})()}connectToDevice(t){var n=this;return Ae(function*(){n.isLoading=!0,n.connectedDevice=null;try{yield n.smartLightBluetoothService.connectToDevice(t),n.ngZone.run(()=>{n.connectedDevice=t,n.isLoading=!1})}catch{n.connectedDevice=null}finally{n.isLoading=!1}})()}disconnectDevice(){this.smartLightBluetoothService.disconnectDevice(),this.connectedDevice?console.log("Disconnected from device:",this.connectedDevice.name):console.log("Disconnected from device: (no device was connected)"),this.connectedDevice=null}sendToBluetooth(t,n,i){var r=this;return Ae(function*(){console.log(`Sending to Bluetooth - Fret: ${t}, String: ${n}, On: ${i}`),yield r.smartLightBluetoothService.setLedByfretAndString(t,n,i)})()}reset(){var t=this;return Ae(function*(){yield t.smartLightBluetoothService.reset()})()}static \u0275fac=function(n){return new(n||s)(ue(jV),ue(Jn))};static \u0275cmp=eg({type:s,selectors:[["guitar-pro"]],viewQuery:function(n,i){if(1&n&&function _A(s,e,t){hM(s,e,t)}(Hre,5),2&n){let r;(function dk(s){const e=ee(),t=yn(),n=OS();dy(n+1);const i=kT(t,n);if(s.dirty&&function j5(s){return!(4&~s[2])}(e)===!(2&~i.metadata.flags)){if(null===i.matches)s.reset([]);else{const r=pM(e,n);s.reset(r,y1),s.notifyOnChanges()}return!0}return!1})(r=function fk(){return function TT(s,e){return s[18].queries[e].queryList}(ee(),OS())}())&&(i.alphaTabContainer=r.first)}},decls:20,vars:6,consts:[["fileInput",""],["alphaTabContainer",""],[1,"guitar-pro-player"],[1,"header"],[1,"controls-section"],[1,"file-controls"],["type","file","accept",".gp,.gp3,.gp4,.gp5,.gpx,.gp6",1,"file-input",3,"change"],[1,"load-btn",3,"click"],["class","device-list","style","list-style: none; padding: 0; margin: 0 auto; display: flex; flex-direction: column; align-items: center; width: fit-content;",4,"ngIf"],["class","connected-device",4,"ngIf"],["class","playback-controls",4,"ngIf"],["class","main-content",4,"ngIf"],["class","loading",4,"ngIf"],["class","welcome",4,"ngIf"],[1,"device-list",2,"list-style","none","padding","0","margin","0 auto","display","flex","flex-direction","column","align-items","center","width","fit-content"],[4,"ngIf"],["style","display: flex; align-items: center; justify-content: space-between; \n      padding: 10px 16px; margin: 8px 0px; \n      border: 1px solid #ddd; border-radius: 8px; background: #fafbfc;",4,"ngFor","ngForOf"],[1,"spinner"],[2,"display","flex","align-items","center","justify-content","space-between","padding","10px 16px","margin","8px 0px","border","1px solid #ddd","border-radius","8px","background","#fafbfc"],[2,"font-size","16px","font-weight","500"],[1,"connected-device"],[1,"playback-controls"],[1,"play-btn",3,"click"],[1,"stop-btn",3,"click"],[1,"tempo-control"],["type","range","min","25","max","200","step","5",1,"tempo-slider",3,"input","value"],[1,"scroll-control"],[1,"scroll-label"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"loop-control"],[1,"loop-label"],["class","position-info",4,"ngIf"],[1,"position-info"],[1,"position-text"],[1,"main-content"],[1,"tracks-panel"],[1,"track-list"],["class","track-item",3,"selected",4,"ngFor","ngForOf","ngForTrackBy"],[1,"track-actions"],[1,"action-btn",3,"click"],[1,"score-container"],[1,"alphatab-container"],[1,"at-overlay"],[1,"at-overlay-content"],[1,"at-content"],[1,"at-viewport"],[1,"at-main"],[1,"track-item"],[1,"track-header",3,"click"],[1,"track-info"],[1,"track-color"],[1,"track-name"],[1,"track-controls",3,"click"],["title","Mute",1,"track-btn","mute-btn",3,"click"],["title","Solo",1,"track-btn","solo-btn",3,"click"],["title","Show/Hide",1,"track-btn","visibility-btn",3,"click"],["class","track-details",4,"ngIf"],[1,"track-details"],[1,"loading"],[1,"welcome"]],template:function(n,i){if(1&n){const r=Ys();K(0,"div",2)(1,"header",3)(2,"h1"),we(3,"\u{1f3b8} Guitar Pro Player"),J(),K(4,"p"),we(5,"Load and play Guitar Pro files with multiple track support"),J()(),K(6,"div",4)(7,"div",5)(8,"input",6,0),ht("change",function(a){return xt(r),Nt(i.onFileSelected(a))}),J(),K(10,"button",7),ht("click",function(){return xt(r),Nt(bA(9).click())}),we(11," \u{1f4c1} Load Guitar Pro File "),J(),K(12,"button",7),ht("click",function(){return xt(r),Nt(i.discoverDevices())}),we(13,"Discover Devices"),J(),qn(14,Ure,3,2,"ul",8)(15,zre,7,1,"div",9),J(),qn(16,$re,18,6,"div",10),J(),qn(17,Xre,24,3,"div",11)(18,Jre,4,0,"div",12)(19,Zre,16,0,"div",13),J()}2&n&&(Q(14),gt("ngIf",!i.connectedDevice),Q(),gt("ngIf",null!=i.connectedDevice),Q(),gt("ngIf",i.isLoaded),Q(),gt("ngIf",i.isLoaded),Q(),gt("ngIf",i.isLoading),Q(),gt("ngIf",!i.isLoaded&&!i.isLoading))},dependencies:[m2,uD,hD,KL,Tb,OC,Vb],styles:["body[_ngcontent-%COMP%]{margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;background:#f5f5f5}*[_ngcontent-%COMP%]{box-sizing:border-box}#loading[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.2rem;z-index:9999}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid rgba(255,255,255,.3);border-left:4px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-right:1rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.at-surface[_ngcontent-%COMP%]{background:#fff!important}.at-track-name[_ngcontent-%COMP%]{font-weight:600!important}.at-bar-number[_ngcontent-%COMP%]{color:#666!important}.at-cursor[_ngcontent-%COMP%], .at-cursor-beat[_ngcontent-%COMP%]{background:#ff5722!important;opacity:1!important;z-index:1000!important}.at-selection[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{background:#4040ff1a}.at-cursor-bar[_ngcontent-%COMP%]{background:#fff20040}.at-highlight[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{fill:#2781e2;stroke:#2781e2}@media (max-width: 768px){.mobile-hidden[_ngcontent-%COMP%]{display:none!important}.main-content[_ngcontent-%COMP%]{flex-direction:column;height:auto}.tracks-panel[_ngcontent-%COMP%]{width:100%;max-height:300px}.controls-section[_ngcontent-%COMP%]{flex-direction:column;align-items:center}}.guitar-pro-player[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif}.header[_ngcontent-%COMP%]{background:#ffffff1a;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);padding:2rem;text-align:center;border-bottom:1px solid rgba(255,255,255,.2)}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;color:#fff;font-size:2.5rem;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,.3)}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0 0;color:#fffc;font-size:1.1rem}.controls-section[_ngcontent-%COMP%]{background:#fffffff2;padding:1.5rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;box-shadow:0 2px 10px #0000001a}.file-input[_ngcontent-%COMP%]{display:none}.load-btn[_ngcontent-%COMP%]{background:#4caf50;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-size:1rem;cursor:pointer;transition:all .3s ease;font-weight:600;margin:10px}.load-btn[_ngcontent-%COMP%]:hover{background:#45a049;transform:translateY(-1px)}.playback-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.play-btn[_ngcontent-%COMP%], .stop-btn[_ngcontent-%COMP%]{background:#2196f3;color:#fff;border:none;width:50px;height:50px;border-radius:50%;font-size:1.2rem;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center}.stop-btn[_ngcontent-%COMP%]{background:#f44336}.play-btn[_ngcontent-%COMP%]:hover, .stop-btn[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.tempo-control[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:.5rem}.tempo-control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333}.tempo-slider[_ngcontent-%COMP%]{width:150px}.main-content[_ngcontent-%COMP%]{display:flex;height:calc(100vh - 220px);background:#fff}.tracks-panel[_ngcontent-%COMP%]{width:350px;background:#f8f9fa;border-right:1px solid #dee2e6;padding:1rem;overflow-y:auto}.tracks-panel[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:#333;font-size:1.2rem}.track-list[_ngcontent-%COMP%]{max-height:calc(100vh - 350px);overflow-y:auto}.track-item[_ngcontent-%COMP%]{background:#fff;border:1px solid #dee2e6;border-radius:8px;margin-bottom:.5rem;overflow:hidden;transition:all .2s ease}.track-item[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #0000001a}.track-item.selected[_ngcontent-%COMP%]{border-color:#2196f3;background:#e3f2fd}.track-header[_ngcontent-%COMP%]{padding:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}.track-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex:1}.track-color[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;border:1px solid #ccc}.track-name[_ngcontent-%COMP%]{font-weight:500;color:#333}.track-controls[_ngcontent-%COMP%]{display:flex;gap:4px}.track-btn[_ngcontent-%COMP%]{background:#f8f9fa;border:1px solid #dee2e6;width:28px;height:28px;border-radius:4px;cursor:pointer;transition:all .2s ease;font-size:12px}.track-btn[_ngcontent-%COMP%]:hover{background:#e9ecef}.track-btn.active[_ngcontent-%COMP%]{background:#2196f3;color:#fff;border-color:#2196f3}.mute-btn.active[_ngcontent-%COMP%]{background:#f44336;border-color:#f44336}.solo-btn.active[_ngcontent-%COMP%]{background:#ff9800;border-color:#ff9800}.track-details[_ngcontent-%COMP%]{padding:8px 12px;background:#00000005;border-top:1px solid #dee2e6;color:#666}.track-actions[_ngcontent-%COMP%]{margin-top:1rem;display:flex;flex-wrap:wrap;gap:.5rem}.action-btn[_ngcontent-%COMP%]{background:#6c757d;color:#fff;border:none;padding:6px 12px;border-radius:4px;font-size:.8rem;cursor:pointer;transition:background .2s ease}.action-btn[_ngcontent-%COMP%]:hover{background:#5a6268}.score-container[_ngcontent-%COMP%]{flex:1;overflow:hidden}.alphatab-container[_ngcontent-%COMP%]{width:100%;height:100%;border:1px solid #764ba2;overflow:auto}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:300px;color:#fff}.spinner[_ngcontent-%COMP%]{width:50px;height:50px;border:4px solid rgba(255,255,255,.3);border-left:4px solid white;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}.welcome[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;color:#fff;max-width:600px;margin:0 auto}.welcome[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:1rem}.welcome[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem;margin-bottom:2rem;opacity:.9}.welcome[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{text-align:left;display:inline-block;background:#ffffff1a;padding:1.5rem;border-radius:12px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.welcome[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.5rem;font-size:1rem}.at-overlay[_ngcontent-%COMP%]{position:absolute;display:flex;inset:0;z-index:1010;-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);background:#00000080;justify-content:center;align-items:flex-start}.at-overlay-content[_ngcontent-%COMP%]{margin-top:20px;background:#fff;box-shadow:0 5px 10px #0000004d;padding:10px}.at-overlay-content[_ngcontent-%COMP%] > .spinner-border[_ngcontent-%COMP%]{color:#4972a1}.at-time-position[_ngcontent-%COMP%]{font-weight:700}.at-time-slider[_ngcontent-%COMP%]{height:4px;background:#d9d9d9}.at-time-slider-value[_ngcontent-%COMP%]{height:4px;background:#6ba5e4;width:0}.at-speed-value[_ngcontent-%COMP%]{font-size:.8rem;margin:0 .5em}.progress[_ngcontent-%COMP%]{position:relative;height:40px;padding-top:4px}.progress[_ngcontent-%COMP%]   .progress-value[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-weight:700;position:absolute;top:0;left:0;font-size:8px}@media screen and (max-width: 920px){.at-player-right[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.at-logo){display:none!important}.at-wrap[_ngcontent-%COMP%]{height:60vh}}@media screen and (max-width: 1100px){.at-footer[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{font-size:12px!important}.at-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:18px}.at-sidebar[_ngcontent-%COMP%]{display:none}.at-viewport[_ngcontent-%COMP%]{left:0!important}}[_nghost-%COMP%]     .at-cursor-bar{background:#fff20040}[_nghost-%COMP%]     .at-selection div{background:#4040ff33}[_nghost-%COMP%]     .at-cursor-beat{background:#4040ffbf;width:3px}[_nghost-%COMP%]     .at-highlight *{fill:#0078ff;stroke:#0078ff}"]})}return s})();const Nx="15.1.22";var xu=nn(582);const Ff=new WeakSet,YV=new WeakMap,Ex=new WeakMap,XV=new WeakMap,Ix=new WeakMap,t0=new WeakMap,JV=new WeakMap,Bx=new WeakMap,Mx=new WeakMap,Px=new WeakMap,ZV={construct:()=>ZV},QV=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,KV=(s,e)=>{const t=[];let n=s.replace(/^[\s]+/,""),i=n.match(QV);for(;null!==i;){const r=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(r,new URL(r,e).toString());t.push(o),n=n.slice(i[0].length).replace(/^[\s]+/,""),i=n.match(QV)}return[t.join(";"),n]},eH=s=>{if(void 0!==s&&!Array.isArray(s))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},tH=s=>{if(!(s=>{try{new new Proxy(s,ZV)}catch{return!1}return!0})(s))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===s.prototype||"object"!=typeof s.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},Xa=(s,e)=>{const t=s.get(e);if(void 0===t)throw new Error("A value with the given key could not be found.");return t},n0=(s,e)=>{const t=Array.from(s).filter(e);if(t.length>1)throw Error("More than one element was found.");if(0===t.length)throw Error("No element was found.");const[n]=t;return s.delete(n),n},nH=(s,e,t,n)=>{const i=Xa(s,e),r=n0(i,o=>o[0]===t&&o[1]===n);return 0===i.size&&s.delete(e),r},_m=s=>Xa(JV,s),Of=s=>{if(Ff.has(s))throw new Error("The AudioNode is already stored.");Ff.add(s),_m(s).forEach(e=>e(!0))},sH=s=>"port"in s,bm=s=>{if(!Ff.has(s))throw new Error("The AudioNode is not stored.");Ff.delete(s),_m(s).forEach(e=>e(!1))},Ax=(s,e)=>{!sH(s)&&e.every(t=>0===t.size)&&bm(s)},coe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Hr=(s,e)=>s.context===e,s0=s=>{try{s.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Al=()=>new DOMException("","IndexSizeError"),Rx=s=>{s.getChannelData=(e=>t=>{try{return e.call(s,t)}catch(n){throw 12===n.code?Al():n}})(s.getChannelData)},doe={numberOfChannels:1},Do=-34028234663852886e22,lo=-Do,Nc=s=>Ff.has(s),poe={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},co=s=>Xa(YV,s),wm=s=>Xa(XV,s),Fx=(s,e)=>{const{activeInputs:t}=co(s);t.forEach(i=>i.forEach(([r])=>{e.includes(s)||Fx(r,[...e,s])}));const n=(s=>"playbackRate"in s)(s)?[s.playbackRate]:sH(s)?Array.from(s.parameters.values()):(s=>"frequency"in s&&"gain"in s)(s)?[s.Q,s.detune,s.frequency,s.gain]:(s=>"offset"in s)(s)?[s.offset]:(s=>!("frequency"in s)&&"gain"in s)(s)?[s.gain]:(s=>"detune"in s&&"frequency"in s&&!("gain"in s))(s)?[s.detune,s.frequency]:(s=>"pan"in s)(s)?[s.pan]:[];for(const i of n){const r=wm(i);void 0!==r&&r.activeInputs.forEach(([o])=>Fx(o,e))}Nc(s)&&bm(s)},r0=s=>{Fx(s.destination,[])},o0=s=>"context"in s,Sm=s=>o0(s[0]),jh=(s,e,t,n)=>{for(const i of s)if(t(i)){if(n)return!1;throw Error("The set contains at least one similar element.")}return s.add(e),!0},rH=(s,e,[t,n],i)=>{jh(s,[e,t,n],r=>r[0]===e&&r[1]===t,i)},oH=(s,[e,t,n],i)=>{const r=s.get(e);void 0===r?s.set(e,new Set([[t,n]])):jh(r,[t,n],o=>o[0]===t,i)},Lf=s=>"inputs"in s,a0=(s,e,t,n)=>{if(Lf(e)){const i=e.inputs[n];return s.connect(i,t,0),[i,t,0]}return s.connect(e,t,n),[e,t,n]},aH=(s,e,t)=>{for(const n of s)if(n[0]===e&&n[1]===t)return s.delete(n),n;return null},lH=(s,e)=>{if(!_m(s).delete(e))throw new Error("Missing the expected event listener.")},cH=(s,e,t)=>{const n=Xa(s,e),i=n0(n,r=>r[0]===t);return 0===n.size&&s.delete(e),i},l0=(s,e,t,n)=>{Lf(e)?s.disconnect(e.inputs[n],t,0):s.disconnect(e,t,n)},Js=s=>Xa(Ex,s),vm=s=>Xa(Ix,s),Yh=s=>Bx.has(s),c0=s=>!Ff.has(s),uH=(s,e)=>new Promise(t=>{if(null!==e)t(!0);else{const n=s.createScriptProcessor(256,1,1),i=s.createGain(),r=s.createBuffer(1,2,44100),o=r.getChannelData(0);o[0]=1,o[1]=1;const a=s.createBufferSource();a.buffer=r,a.loop=!0,a.connect(n).connect(s.destination),a.connect(i),a.disconnect(i),n.onaudioprocess=l=>{const c=l.inputBuffer.getChannelData(0);Array.prototype.some.call(c,u=>1===u)?t(!0):t(!1),a.stop(),n.onaudioprocess=null,a.disconnect(n),n.disconnect(s.destination)},a.start()}}),Ox=(s,e)=>{const t=new Map;for(const n of s)for(const i of n){const r=t.get(i);t.set(i,void 0===r?1:r+1)}t.forEach((n,i)=>e(i,n))},u0=s=>"context"in s,Lx=(s,e,t,n,i)=>{const[r,o]=((s,e,t,n)=>{const{activeInputs:i,passiveInputs:r}=co(e),o=aH(i[n],s,t);return null===o?[nH(r,s,t,n)[2],!1]:[o[2],!0]})(s,t,n,i);if(null!==r&&(lH(s,r),o&&!e&&!Yh(s)&&l0(Js(s),Js(t),n,i)),Nc(t)){const{activeInputs:a}=co(t);Ax(t,a)}},Vx=(s,e,t,n)=>{const[i,r]=((s,e,t)=>{const{activeInputs:n,passiveInputs:i}=wm(e),r=aH(n,s,t);return null===r?[cH(i,s,t)[1],!1]:[r[2],!0]})(s,t,n);null!==i&&(lH(s,i),r&&!e&&!Yh(s)&&Js(s).disconnect(vm(t),n))};class hH{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((n,i)=>e.call(t,n,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const Loe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function h0(s,e,t,n,i){if("function"==typeof s.copyFromChannel)0===e[t].byteLength&&(e[t]=new Float32Array(128)),s.copyFromChannel(e[t],n,i);else{const r=s.getChannelData(n);if(0===e[t].byteLength)e[t]=r.slice(i,i+128);else{const o=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const dH=(s,e,t,n,i)=>{"function"==typeof s.copyToChannel?0!==e[t].byteLength&&s.copyToChannel(e[t],n,i):0!==e[t].byteLength&&s.getChannelData(n).set(e[t],i)},d0=(s,e)=>{const t=[];for(let n=0;n<s;n+=1){const i=[],r="number"==typeof e?e:e[n];for(let o=0;o<r;o+=1)i.push(new Float32Array(128));t.push(i)}return t},Woe=function(){var s=Ae(function*(e,t,n,i,r,o,a){const l=null===t?128*Math.ceil(e.context.length/128):t.length,c=i.channelCount*i.numberOfInputs,u=r.reduce((y,b)=>y+b,0),h=0===u?null:n.createBuffer(u,l,n.sampleRate);if(void 0===o)throw new Error("Missing the processor constructor.");const d=co(e),p=yield((s,e)=>{const t=Xa(Px,s),n=Js(e);return Xa(t,n)})(n,e),g=d0(i.numberOfInputs,i.channelCount),m=d0(i.numberOfOutputs,r),_=Array.from(e.parameters.keys()).reduce((y,b)=>({...y,[b]:new Float32Array(128)}),{});for(let y=0;y<l;y+=128){if(i.numberOfInputs>0&&null!==t)for(let b=0;b<i.numberOfInputs;b+=1)for(let S=0;S<i.channelCount;S+=1)h0(t,g[b],S,S,y);void 0!==o.parameterDescriptors&&null!==t&&o.parameterDescriptors.forEach(({name:b},S)=>{h0(t,_,b,c+S,y)});for(let b=0;b<i.numberOfInputs;b+=1)for(let S=0;S<r[b];S+=1)0===m[b][S].byteLength&&(m[b][S]=new Float32Array(128));try{const b=g.map((D,T)=>0===d.activeInputs[T].size?[]:D),S=a(y/n.sampleRate,n.sampleRate,()=>p.process(b,m,_));if(null!==h)for(let D=0,T=0;D<i.numberOfOutputs;D+=1){for(let C=0;C<r[D];C+=1)dH(h,m[D],C,T+C,y);T+=r[D]}if(!S)break}catch(b){e.dispatchEvent(new ErrorEvent("processorerror",{colno:b.colno,filename:b.filename,lineno:b.lineno,message:b.message}));break}}return h});return function(t,n,i,r,o,a,l){return s.apply(this,arguments)}}(),zoe={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Yoe={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Zoe={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},sae={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},aae={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},fH=s=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(n=>{const i=()=>{t.onmessage=null,e.close(),t.close(),n()};t.onmessage=()=>i();try{e.postMessage(s,[s])}catch{}finally{i()}})},pae={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},f0=(s,e,t)=>{const n=e[t];if(void 0===n)throw s();return n},vae={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Iae={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},$i=()=>new DOMException("","InvalidStateError"),p0=()=>new DOMException("","InvalidAccessError"),Gae={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},pH=(s,e,t,n,i,r,o,a,l,c,u)=>{const h=c.length;let d=a;for(let p=0;p<h;p+=1){let g=t[0]*c[p];for(let m=1;m<i;m+=1){const _=d-m&l-1;g+=t[m]*r[_],g-=s[m]*o[_]}for(let m=i;m<n;m+=1)g+=t[m]*r[d-m&l-1];for(let m=i;m<e;m+=1)g-=s[m]*o[d-m&l-1];r[d]=c[p],o[d]=g,d=d+1&l-1,u[p]=g}return d},ile={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Xh=s=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=s.decodeAudioData(e.buffer,()=>{});return void 0!==t&&(t.catch(()=>{}),!0)}catch{}return!1},ei=(s,e,t)=>{const n=e[t];void 0!==n&&n!==s[t]&&(s[t]=n)},er=(s,e)=>{ei(s,e,"channelCount"),ei(s,e,"channelCountMode"),ei(s,e,"channelInterpretation")},gH=s=>"function"==typeof s.getFloatTimeDomainData,vi=(s,e,t)=>{const n=e[t];void 0!==n&&n!==s[t].value&&(s[t].value=n)},Hx=s=>{s.start=(e=>(t=0,n=0,i)=>{if("number"==typeof i&&i<0||n<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(s,t,n,i)})(s.start)},Wx=s=>{s.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(s,t)})(s.stop)},mH=(s,e)=>null===s?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(s*e))))),kle=function(){var s=Ae(function*(e,t){const n=yield(s=>new Promise((e,t)=>{const{port1:n,port2:i}=new MessageChannel;n.onmessage=({data:r})=>{n.close(),i.close(),e(r)},n.onmessageerror=({data:r})=>{n.close(),i.close(),t(r)},i.postMessage(s)}))(t);return new e(n)});return function(t,n){return s.apply(this,arguments)}}(),yH=(s,e)=>{const t=s.createBiquadFilter();return er(t,e),vi(t,e,"Q"),vi(t,e,"detune"),vi(t,e,"frequency"),vi(t,e,"gain"),ei(t,e,"type"),t},Tm=(s,e)=>{const t=s.createChannelSplitter(e.numberOfOutputs);return er(t,e),(s=>{const e=s.numberOfOutputs;Object.defineProperty(s,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw $i()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw $i()}}),Object.defineProperty(s,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw $i()}})})(t),t},Vf=(s,e)=>(s.connect=e.connect.bind(e),s.disconnect=e.disconnect.bind(e),s),_H=(s,e)=>{const t=s.createDelay(e.maxDelayTime);return er(t,e),vi(t,e,"delayTime"),t},xo=(s,e)=>{const t=s.createGain();return er(t,e),vi(t,e,"gain"),t};function Ale(s,e){const t=e[0]*e[0]+e[1]*e[1];return[(s[0]*e[0]+s[1]*e[1])/t,(s[1]*e[0]-s[0]*e[1])/t]}function Rle(s,e){return[s[0]*e[0]-s[1]*e[1],s[0]*e[1]+s[1]*e[0]]}function bH(s,e){let t=[0,0];for(let n=s.length-1;n>=0;n-=1)t=Rle(t,e),t[0]+=s[n];return t}const km=(s,e,t,n)=>s.createScriptProcessor(e,t,n),Wr=()=>new DOMException("","NotSupportedError"),Jle={numberOfChannels:1},Qle={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},tce={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},ice={disableNormalization:!1},fce={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},wH=()=>new DOMException("","UnknownError"),bce={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},SH=(s,e,t)=>void 0===s.copyFromChannel?s.getChannelData(t)[0]:(s.copyFromChannel(e,t),e[0]),vH=s=>{if(null===s)return!1;const e=s.length;return e%2!=0?0!==s[Math.floor(e/2)]:s[e/2-1]+s[e/2]!==0},Cm=(s,e,t,n)=>{let i=s;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(s,e,{get:t(r),set:n(o)})},TH=(s,e,t)=>{try{s.setValueAtTime(e,t)}catch(n){if(9!==n.code)throw n;TH(s,e,t+1e-7)}},Gx=s=>{const e=s.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},kH=s=>{const e=s.createBuffer(1,1,44100),t=s.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},Ux=s=>{const e=s.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},CH=(s,e)=>{const t=e.createGain();s.connect(t);const n=(i=>()=>{i.call(s,t),s.removeEventListener("ended",n)})(s.disconnect);s.addEventListener("ended",n),Vf(s,t),s.stop=(i=>{let r=!1;return(o=0)=>{if(r)try{i.call(s,o)}catch{t.gain.setValueAtTime(0,o)}else i.call(s,o),r=!0}})(s.stop)},Hf=(s,e)=>t=>{const n={value:s};return Object.defineProperties(t,{currentTarget:n,target:n}),"function"==typeof e?e.call(s,t):e.handleEvent.call(s,t)},Rce=(s=jh,(e,t,[n,i,r],o)=>{s(e[i],[t,n,r],a=>a[0]===t&&a[1]===n,o)}),Fce=(s=>(e,t,[n,i,r],o)=>{const a=e.get(n);void 0===a?e.set(n,new Set([[i,t,r]])):s(a,[i,t,r],l=>l[0]===i&&l[1]===t,o)})(jh),Oce=(s=>(e,t,n,i)=>s(e[i],r=>r[0]===t&&r[1]===n))(n0),DH=new WeakMap,Lce=(s=>e=>{var t;return null!==(t=s.get(e))&&void 0!==t?t:0})(DH),Jo=((s,e)=>(t,n)=>{const i=e.get(t);if(void 0!==i)return i;const r=s.get(t);if(void 0!==r)return r;try{const o=n();return o instanceof Promise?(s.set(t,o),o.catch(()=>!1).then(a=>(s.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}})(new Map,new WeakMap),Ja=typeof window>"u"?null:window,xH=((s,e)=>(t,n)=>{const i=t.createAnalyser();if(er(i,n),!(n.maxDecibels>n.minDecibels))throw e();return ei(i,n,"fftSize"),ei(i,n,"maxDecibels"),ei(i,n,"minDecibels"),ei(i,n,"smoothingTimeConstant"),s(gH,()=>gH(i))||(s=>{s.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);s.getByteTimeDomainData(t);const n=Math.max(t.length,s.fftSize);for(let i=0;i<n;i+=1)e[i]=.0078125*(t[i]-128);return e}})(i),i})(Jo,Al),zx=(s=>e=>{const t=s(e);if(null===t.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer})(co),Tr=((s,e,t)=>function(){var n=Ae(function*(i,r,o){const a=s(i);yield Promise.all(a.activeInputs.map((l,c)=>Array.from(l).map(function(){var u=Ae(function*([h,d]){const g=yield e(h).render(h,r),m=i.context.destination;!t(h)&&(i!==m||!t(i))&&g.connect(o,d,c)});return function(h){return u.apply(this,arguments)}}())).reduce((l,c)=>[...l,...c],[]))});return function(i,r,o){return n.apply(this,arguments)}}())(co,zx,Yh),Vce=((s,e,t)=>()=>{const n=new WeakMap,i=function(){var r=Ae(function*(o,a){let l=e(o);return Hr(l,a)||(l=s(a,{channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,fftSize:l.fftSize,maxDecibels:l.maxDecibels,minDecibels:l.minDecibels,smoothingTimeConstant:l.smoothingTimeConstant})),n.set(a,l),yield t(o,a,l),l});return function(a,l){return r.apply(this,arguments)}}();return{render(r,o){const a=n.get(o);return void 0!==a?Promise.resolve(a):i(r,o)}}})(xH,Js,Tr),zs=(s=>e=>{const t=s.get(e);if(void 0===t)throw $i();return t})(t0),fr=(s=>null===s?null:s.hasOwnProperty("OfflineAudioContext")?s.OfflineAudioContext:s.hasOwnProperty("webkitOfflineAudioContext")?s.webkitOfflineAudioContext:null)(Ja),Ps=(s=>e=>null!==s&&e instanceof s)(fr),NH=new WeakMap,EH=(s=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,n,i){if(null!==n){let r=this._listeners.get(n);void 0===r&&(r=s(this,n),"function"==typeof n&&this._listeners.set(n,r)),this._nativeEventTarget.addEventListener(t,r,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,n,i){const r=null===n?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(t,void 0===r?null:r,i)}})(Hf),Ec=(s=>null===s?null:s.hasOwnProperty("AudioContext")?s.AudioContext:s.hasOwnProperty("webkitAudioContext")?s.webkitAudioContext:null)(Ja),qx=(s=>e=>null!==s&&e instanceof s)(Ec),$x=(s=>e=>null!==s&&"function"==typeof s.AudioNode&&e instanceof s.AudioNode)(Ja),IH=(s=>e=>null!==s&&"function"==typeof s.AudioParam&&e instanceof s.AudioParam)(Ja),Wf=(s=>null===s?null:s.hasOwnProperty("AudioWorkletNode")?s.AudioWorkletNode:null)(Ja),Bi=((s,e,t,n,i,r,o,a,l,c,u,h,d,p,g,m)=>class extends c{constructor(y,b,S,D){super(S),this._context=y,this._nativeAudioNode=S;const T=u(y);h(T)&&!0!==t(uH,()=>uH(T,m))&&(s=>{const e=new Map;s.connect=(t=>(n,i=0,r=0)=>{const o=u0(n)?t(n,i,r):t(n,i),a=e.get(n);return void 0===a?e.set(n,[{input:r,output:i}]):a.every(l=>l.input!==r||l.output!==i)&&a.push({input:r,output:i}),o})(s.connect.bind(s)),s.disconnect=(t=>(n,i,r)=>{if(t.apply(s),void 0===n)e.clear();else if("number"==typeof n)for(const[o,a]of e){const l=a.filter(c=>c.output!==n);0===l.length?e.delete(o):e.set(o,l)}else if(e.has(n))if(void 0===i)e.delete(n);else{const o=e.get(n);if(void 0!==o){const a=o.filter(l=>l.output!==i&&(l.input!==r||void 0===r));0===a.length?e.delete(n):e.set(n,a)}}for(const[o,a]of e)a.forEach(l=>{u0(o)?s.connect(o,l.output,l.input):s.connect(o,l.output)})})(s.disconnect)})(S),Ex.set(this,S),JV.set(this,new Set),"closed"!==y.state&&b&&Of(this),s(this,D,S)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,b=0,S=0){if(b<0||b>=this._nativeAudioNode.numberOfOutputs)throw i();const D=u(this._context),T=g(D);if(d(y)||p(y))throw r();if(o0(y)){const x=Js(y);try{const W=a0(this._nativeAudioNode,x,b,S),L=c0(this);(T||L)&&this._nativeAudioNode.disconnect(...W),"closed"!==this.context.state&&!L&&c0(y)&&Of(y)}catch(W){throw 12===W.code?r():W}if(e(this,y,b,S,T)){const W=l([this],y);Ox(W,n(T))}return y}const C=vm(y);if("playbackRate"===C.name&&1024===C.maxValue)throw o();try{this._nativeAudioNode.connect(C,b),(T||c0(this))&&this._nativeAudioNode.disconnect(C,b)}catch(x){throw 12===x.code?r():x}if(((s,e,t,n)=>{const{activeInputs:i,passiveInputs:r}=wm(e),{outputs:o}=co(s),a=_m(s),l=c=>{const u=Js(s),h=vm(e);if(c){const d=cH(r,s,t);rH(i,s,d,!1),!n&&!Yh(s)&&u.connect(h,t)}else{const d=((s,e,t)=>n0(s,n=>n[0]===e&&n[1]===t))(i,s,t);oH(r,d,!1),!n&&!Yh(s)&&u.disconnect(h,t)}};return!!jh(o,[e,t],c=>c[0]===e&&c[1]===t,!0)&&(a.add(l),Nc(s)?rH(i,s,[t,l],!0):oH(r,[s,t,l],!0),!0)})(this,y,b,T)){const x=l([this],y);Ox(x,n(T))}}disconnect(y,b,S){let D;const T=u(this._context),C=g(T);if(void 0===y)D=((s,e)=>{const t=co(s),n=[];for(const i of t.outputs)Sm(i)?Lx(s,e,...i):Vx(s,e,...i),n.push(i[0]);return t.outputs.clear(),n})(this,C);else if("number"==typeof y){if(y<0||y>=this.numberOfOutputs)throw i();D=((s,e,t)=>{const n=co(s),i=[];for(const r of n.outputs)r[1]===t&&(Sm(r)?Lx(s,e,...r):Vx(s,e,...r),i.push(r[0]),n.outputs.delete(r));return i})(this,C,y)}else{if(void 0!==b&&(b<0||b>=this.numberOfOutputs)||o0(y)&&void 0!==S&&(S<0||S>=y.numberOfInputs))throw i();if(D=((s,e,t,n,i)=>{const r=co(s);return Array.from(r.outputs).filter(o=>!(o[0]!==t||void 0!==n&&o[1]!==n||void 0!==i&&o[2]!==i)).map(o=>(Sm(o)?Lx(s,e,...o):Vx(s,e,...o),r.outputs.delete(o),o[0]))})(this,C,y,b,S),0===D.length)throw r()}for(const v of D){const x=l([this],v);Ox(x,a)}}})((s=>(e,t,n)=>{const i=[];for(let r=0;r<n.numberOfInputs;r+=1)i.push(new Set);s.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})})(YV),((s,e,t,n,i,r,o,a,l,c,u,h,d)=>{const p=new WeakMap;return(g,m,_,y,b)=>{const{activeInputs:S,passiveInputs:D}=r(m),{outputs:T}=r(g),C=a(g),v=x=>{const q=l(m),W=l(g);if(x){const L=nH(D,g,_,y);s(S,g,L,!1),!b&&!h(g)&&t(W,q,_,y),d(m)&&Of(m)}else{const L=n(S,g,_,y);e(D,y,L,!1),!b&&!h(g)&&i(W,q,_,y);const H=o(m);if(0===H)u(m)&&Ax(m,S);else{const Ce=p.get(m);void 0!==Ce&&clearTimeout(Ce),p.set(m,setTimeout(()=>{u(m)&&Ax(m,S)},1e3*H))}}};return!!c(T,[m,_,y],x=>x[0]===m&&x[1]===_&&x[2]===y,!0)&&(C.add(v),u(g)?s(S,g,[_,y,v],!0):e(D,y,[g,_,v],!0),!0)}})(Rce,Fce,a0,Oce,l0,co,Lce,_m,Js,jh,Nc,Yh,c0),Jo,((s,e,t,n,i,r)=>o=>(a,l)=>{const c=s.get(a);if(void 0===c){if(!o&&r(a)){const u=n(a),{outputs:h}=t(a);for(const d of h)if(Sm(d)){const p=n(d[0]);e(u,p,d[1],d[2])}else{const p=i(d[0]);u.disconnect(p,d[1])}}s.set(a,l)}else s.set(a,c+l)})(Bx,l0,co,Js,vm,Nc),Al,p0,Wr,((s,e,t,n,i,r,o,a)=>(l,c)=>{const u=e.get(l);if(void 0===u)throw new Error("Missing the expected cycle count.");const h=r(l.context),d=a(h);if(u===c){if(e.delete(l),!d&&o(l)){const p=n(l),{outputs:g}=t(l);for(const m of g)if(Sm(m)){const _=n(m[0]);s(p,_,m[1],m[2])}else{const _=i(m[0]);p.connect(_,m[1])}}}else e.set(l,u-c)})(a0,Bx,co,Js,vm,zs,Nc,Ps),((s,e,t)=>function n(i,r){const o=o0(r)?r:t(s,r);if((s=>"delayTime"in s)(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(l=>n([...i,o],l[0])).reduce((l,c)=>l.concat(c),[])})(NH,co,Xa),EH,zs,qx,$x,IH,Ps,Wf),Hce=((s,e,t,n,i,r)=>class extends s{constructor(a,l){const c=i(a),u={...coe,...l},h=n(c,u);super(a,!1,h,r(c)?e():null),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const l=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=l,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const l=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=l,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}})(Bi,Vce,Al,xH,zs,Ps),jx=new WeakSet,BH=(s=>null===s?null:s.hasOwnProperty("AudioBuffer")?s.AudioBuffer:null)(Ja),MH=(s=>e=>(s[0]=e,s[0]))(new Uint32Array(1)),Yx=((s,e)=>t=>{t.copyFromChannel=(n,i,r=0)=>{const o=s(r),a=s(i);if(a>=t.numberOfChannels)throw e();const l=t.length,c=t.getChannelData(a),u=n.length;for(let h=o<0?-o:0;h+o<l&&h<u;h+=1)n[h]=c[h+o]},t.copyToChannel=(n,i,r=0)=>{const o=s(r),a=s(i);if(a>=t.numberOfChannels)throw e();const l=t.length,c=t.getChannelData(a),u=n.length;for(let h=o<0?-o:0;h+o<l&&h<u;h+=1)c[h+o]=n[h]}})(MH,Al),Xx=(s=>e=>{e.copyFromChannel=(t=>(n,i,r=0)=>{const o=s(r),a=s(i);if(o<e.length)return t.call(e,n,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(n,i,r=0)=>{const o=s(r),a=s(i);if(o<e.length)return t.call(e,n,a,o)})(e.copyToChannel)})(MH),PH=((s,e,t,n,i,r,o,a)=>{let l=null;return class p5{constructor(u){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:d,sampleRate:p}={...doe,...u};null===l&&(l=new i(1,1,44100));const g=null!==n&&e(r,r)?new n({length:h,numberOfChannels:d,sampleRate:p}):l.createBuffer(d,h,p);if(0===g.numberOfChannels)throw t();return"function"!=typeof g.copyFromChannel?(o(g),Rx(g)):e(s0,()=>s0(g))||a(g),s.add(g),g}static[Symbol.hasInstance](u){return null!==u&&"object"==typeof u&&Object.getPrototypeOf(u)===p5.prototype||s.has(u)}}})(jx,Jo,Wr,BH,fr,(s=>()=>{if(null===s)return!1;try{new s({length:1,sampleRate:44100})}catch{return!1}return!0})(BH),Yx,Xx),g0=(s=>(e,t)=>{const n=s(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(n),n.disconnect()};t.addEventListener("ended",i)})(xo),AH=((s,e,t)=>function(){var n=Ae(function*(i,r,o){const a=e(i);yield Promise.all(Array.from(a.activeInputs).map(function(){var l=Ae(function*([c,u]){const d=yield s(c).render(c,r);t(c)||d.connect(o,u)});return function(c){return l.apply(this,arguments)}}()))});return function(i,r,o){return n.apply(this,arguments)}}())(zx,wm,Yh),Rl=(s=>(e,t,n)=>s(t,e,n))(AH),Gf=((s,e,t,n,i,r,o,a,l,c,u)=>(h,d)=>{const p=h.createBufferSource();return er(p,d),vi(p,d,"playbackRate"),ei(p,d,"buffer"),ei(p,d,"loop"),ei(p,d,"loopEnd"),ei(p,d,"loopStart"),e(t,()=>t(h))||(s=>{s.start=(e=>{let t=!1;return(n=0,i=0,r)=>{if(t)throw $i();e.call(s,n,i,r),t=!0}})(s.start)})(p),e(n,()=>n(h))||(s=>{s.start=(e=>(t=0,n=0,i)=>{const r=s.buffer,o=null===r?n:Math.min(r.duration,n);null!==r&&o>r.duration-.5/s.context.sampleRate?e.call(s,t,0,0):e.call(s,t,o,i)})(s.start)})(p),e(i,()=>i(h))||c(p,h),e(r,()=>r(h))||Hx(p),e(o,()=>o(h))||u(p,h),e(a,()=>a(h))||Wx(p),s(h,p),p})(g0,Jo,s=>{const e=s.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},s=>{const e=s.createBufferSource(),t=s.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},s=>{const e=s.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},Gx,kH,Ux,0,(s=>(e,t)=>{const n=t.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=n),s(e,"buffer",i=>()=>{const r=i.call(e);return r===n?null:r},i=>r=>i.call(e,null===r?n:r))})(Cm),CH),Fl=((s,e)=>(t,n,i)=>(s(n).replay(i),e(n,t,i)))((s=>e=>{const t=s(e);if(null===t.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer})(wm),AH),Wce=((s,e,t,n,i)=>()=>{const r=new WeakMap;let o=null,a=null;const l=function(){var c=Ae(function*(u,h){let d=t(u);const p=Hr(d,h);return p||(d=e(h,{buffer:d.buffer,channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,loop:d.loop,loopEnd:d.loopEnd,loopStart:d.loopStart,playbackRate:d.playbackRate.value}),null!==o&&d.start(...o),null!==a&&d.stop(a)),r.set(h,d),p?yield s(h,u.playbackRate,d.playbackRate):yield n(h,u.playbackRate,d.playbackRate),yield i(u,h,d),d});return function(h,d){return c.apply(this,arguments)}}();return{set start(c){o=c},set stop(c){a=c},render(c,u){const h=r.get(u);return void 0!==h?Promise.resolve(h):l(c,u)}}})(Rl,Gf,Js,Fl,Tr),Za=((s,e,t,n,i,r,o,a,l,c,u,h,d)=>(p,g,m,_=null,y=null)=>{const b=m.value,S=new xu.AutomationEventList(b),D=g?(s=>({replay(e){for(const t of s)if("exponentialRampToValue"===t.type){const{endTime:n,value:i}=t;e.exponentialRampToValueAtTime(i,n)}else if("linearRampToValue"===t.type){const{endTime:n,value:i}=t;e.linearRampToValueAtTime(i,n)}else if("setTarget"===t.type){const{startTime:n,target:i,timeConstant:r}=t;e.setTargetAtTime(i,n,r)}else if("setValue"===t.type){const{startTime:n,value:i}=t;e.setValueAtTime(i,n)}else{if("setValueCurve"!==t.type)throw new Error("Can't apply an unknown automation.");{const{duration:n,startTime:i,values:r}=t;e.setValueCurveAtTime(r,i,n)}}}}))(S):null,T={get defaultValue(){return b},get maxValue(){return null===_?m.maxValue:_},get minValue(){return null===y?m.minValue:y},get value(){return m.value},set value(C){m.value=C,T.setValueAtTime(C,p.context.currentTime)},cancelAndHoldAtTime(C){if("function"==typeof m.cancelAndHoldAtTime)null===D&&S.flush(p.context.currentTime),S.add(i(C)),m.cancelAndHoldAtTime(C);else{const v=Array.from(S).pop();null===D&&S.flush(p.context.currentTime),S.add(i(C));const x=Array.from(S).pop();m.cancelScheduledValues(C),v!==x&&void 0!==x&&("exponentialRampToValue"===x.type?m.exponentialRampToValueAtTime(x.value,x.endTime):"linearRampToValue"===x.type?m.linearRampToValueAtTime(x.value,x.endTime):"setValue"===x.type?m.setValueAtTime(x.value,x.startTime):"setValueCurve"===x.type&&m.setValueCurveAtTime(x.values,x.startTime,x.duration))}return T},cancelScheduledValues:C=>(null===D&&S.flush(p.context.currentTime),S.add(r(C)),m.cancelScheduledValues(C),T),exponentialRampToValueAtTime(C,v){if(0===C)throw new RangeError;if(!Number.isFinite(v)||v<0)throw new RangeError;const x=p.context.currentTime;return null===D&&S.flush(x),0===Array.from(S).length&&(S.add(c(b,x)),m.setValueAtTime(b,x)),S.add(o(C,v)),m.exponentialRampToValueAtTime(C,v),T},linearRampToValueAtTime(C,v){const x=p.context.currentTime;return null===D&&S.flush(x),0===Array.from(S).length&&(S.add(c(b,x)),m.setValueAtTime(b,x)),S.add(a(C,v)),m.linearRampToValueAtTime(C,v),T},setTargetAtTime:(C,v,x)=>(null===D&&S.flush(p.context.currentTime),S.add(l(C,v,x)),m.setTargetAtTime(C,v,x),T),setValueAtTime:(C,v)=>(null===D&&S.flush(p.context.currentTime),S.add(c(C,v)),m.setValueAtTime(C,v),T),setValueCurveAtTime(C,v,x){const q=C instanceof Float32Array?C:new Float32Array(C);if(null!==h&&"webkitAudioContext"===h.name){const W=v+x,L=p.context.sampleRate,H=Math.ceil(v*L),Ce=Math.floor(W*L),Re=Ce-H,Fe=new Float32Array(Re);for(let Ve=0;Ve<Re;Ve+=1){const Dt=(q.length-1)/x*((H+Ve)/L-v),at=Math.floor(Dt),Bt=Math.ceil(Dt);Fe[Ve]=at===Bt?q[at]:(1-(Dt-at))*q[at]+(1-(Bt-Dt))*q[Bt]}null===D&&S.flush(p.context.currentTime),S.add(u(Fe,v,x)),m.setValueCurveAtTime(Fe,v,x);const De=Ce/L;De<W&&d(T,Fe[Fe.length-1],De),d(T,q[q.length-1],W)}else null===D&&S.flush(p.context.currentTime),S.add(u(q,v,x)),m.setValueCurveAtTime(q,v,x);return T}};return t.set(T,m),e.set(T,p),s(T,D),T})((s=>(e,t)=>{s.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})})(XV),NH,Ix,0,xu.createCancelAndHoldAutomationEvent,xu.createCancelScheduledValuesAutomationEvent,xu.createExponentialRampToValueAutomationEvent,xu.createLinearRampToValueAutomationEvent,xu.createSetTargetAutomationEvent,xu.createSetValueAutomationEvent,xu.createSetValueCurveAutomationEvent,Ec,TH),Gce=((s,e,t,n,i,r,o,a)=>class extends s{constructor(c,u){const h=r(c),d={...poe,...u},p=i(h,d),g=o(h),m=g?e():null;super(c,!1,p,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=null!==d.buffer,this._nativeAudioBufferSourceNode=p,this._onended=null,this._playbackRate=t(this,g,p.playbackRate,lo,Do)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(c){if(this._nativeAudioBufferSourceNode.buffer=c,null!==c){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(c){this._nativeAudioBufferSourceNode.loop=c}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(c){this._nativeAudioBufferSourceNode.loopEnd=c}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(c){this._nativeAudioBufferSourceNode.loopStart=c}get onended(){return this._onended}set onended(c){const u="function"==typeof c?a(this,c):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=null!==h&&h===u?c:h}get playbackRate(){return this._playbackRate}start(c=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(c,u,h),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===h?[c,u]:[c,u,h]),"closed"!==this.context.state){Of(this);const d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),Nc(this)&&bm(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(c=0){this._nativeAudioBufferSourceNode.stop(c),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=c)}})(Bi,Wce,Za,$i,Gf,zs,Ps,Hf),Uce=((s,e,t,n,i,r,o,a)=>class extends s{constructor(c,u){const h=r(c),d=o(h),p=i(h,u,d);super(c,!1,p,d?e(a):null),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=p}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(c){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(c>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=c}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(c){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=c}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Bi,s=>{const e=new WeakMap,t=function(){var n=Ae(function*(i,r){const o=r.destination;return e.set(r,o),yield s(i,r,o),o});return function(r,o){return n.apply(this,arguments)}}();return{render(n,i){const r=e.get(i);return void 0!==r?Promise.resolve(r):t(n,i)}}},Al,$i,((s,e)=>(t,n,i)=>{const r=t.destination;if(r.channelCount!==n)try{r.channelCount=n}catch{}i&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:n});const o=s(t,{channelCount:n,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>l=>{a.call(o,l);try{r.channelCount=l}catch(c){if(l>r.maxChannelCount)throw c}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>l=>{a.call(o,l),r.channelCountMode=l}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>l=>{a.call(o,l),r.channelInterpretation=l}),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(xo,Cm),zs,Ps,Tr),zce=((s,e,t,n,i)=>()=>{const r=new WeakMap,o=function(){var a=Ae(function*(l,c){let u=t(l);const h=Hr(u,c);return h||(u=e(c,{Q:u.Q.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,gain:u.gain.value,type:u.type})),r.set(c,u),h?(yield s(c,l.Q,u.Q),yield s(c,l.detune,u.detune),yield s(c,l.frequency,u.frequency),yield s(c,l.gain,u.gain)):(yield n(c,l.Q,u.Q),yield n(c,l.detune,u.detune),yield n(c,l.frequency,u.frequency),yield n(c,l.gain,u.gain)),yield i(l,c,u),u});return function(c,u){return a.apply(this,arguments)}}();return{render(a,l){const c=r.get(l);return void 0!==c?Promise.resolve(c):o(a,l)}}})(Rl,yH,Js,Fl,Tr),Jh=(s=>(e,t)=>s.set(e,t))(DH),qce=((s,e,t,n,i,r,o,a)=>class extends s{constructor(c,u){const h=r(c),d={...zoe,...u},p=i(h,d),g=o(h);super(c,!1,p,g?t():null),this._Q=e(this,g,p.Q,lo,Do),this._detune=e(this,g,p.detune,1200*Math.log2(lo),-1200*Math.log2(lo)),this._frequency=e(this,g,p.frequency,c.sampleRate/2,0),this._gain=e(this,g,p.gain,40*Math.log10(lo),Do),this._nativeBiquadFilterNode=p,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(c){this._nativeBiquadFilterNode.type=c}getFrequencyResponse(c,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(c,u,h)}catch(d){throw 11===d.code?n():d}if(c.length!==u.length||u.length!==h.length)throw n()}})(Bi,Za,zce,p0,yH,zs,Ps,Jh),Nu=((s,e)=>(t,n,i)=>{const r=new Set;return t.connect=(o=>(a,l=0,c=0)=>{const u=0===r.size;if(e(a))return o.call(t,a,l,c),s(r,[a,l,c],h=>h[0]===a&&h[1]===l&&h[2]===c,!0),u&&n(),a;o.call(t,a,l),s(r,[a,l],h=>h[0]===a&&h[1]===l,!0),u&&n()})(t.connect),t.disconnect=(o=>(a,l,c)=>{const u=r.size>0;if(void 0===a)o.apply(t),r.clear();else if("number"==typeof a){o.call(t,a);for(const d of r)d[1]===a&&r.delete(d)}else{e(a)?o.call(t,a,l,c):o.call(t,a,l);for(const d of r)d[0]===a&&(void 0===l||d[1]===l)&&(void 0===c||d[2]===c)&&r.delete(d)}u&&0===r.size&&i()})(t.disconnect),t})(jh,$x),$ce=((s,e)=>(t,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw s()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw s()}});const i=t.createBufferSource();e(n,()=>{const a=n.numberOfInputs;for(let l=0;l<a;l+=1)i.connect(n,0,l)},()=>i.disconnect(n))})($i,Nu),Eu=((s,e)=>(t,n)=>{const i=t.createChannelMerger(n.numberOfInputs);return null!==s&&"webkitAudioContext"===s.name&&e(t,i),er(i,n),i})(Ec,$ce),jce=((s,e,t)=>()=>{const n=new WeakMap,i=function(){var r=Ae(function*(o,a){let l=e(o);return Hr(l,a)||(l=s(a,{channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,numberOfInputs:l.numberOfInputs})),n.set(a,l),yield t(o,a,l),l});return function(a,l){return r.apply(this,arguments)}}();return{render(r,o){const a=n.get(o);return void 0!==a?Promise.resolve(a):i(r,o)}}})(Eu,Js,Tr),Yce=((s,e,t,n,i)=>class extends s{constructor(o,a){const l=n(o),c={...Yoe,...a};super(o,!1,t(l,c),i(l)?e():null)}})(Bi,jce,Eu,zs,Ps),Xce=((s,e,t)=>()=>{const n=new WeakMap,i=function(){var r=Ae(function*(o,a){let l=e(o);return Hr(l,a)||(l=s(a,{channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,numberOfOutputs:l.numberOfOutputs})),n.set(a,l),yield t(o,a,l),l});return function(a,l){return r.apply(this,arguments)}}();return{render(r,o){const a=n.get(o);return void 0!==a?Promise.resolve(a):i(r,o)}}})(Tm,Js,Tr),Jce=((s,e,t,n,i)=>class extends s{constructor(a,l){const c=n(a),u=(s=>({...s,channelCount:s.numberOfOutputs}))({...Zoe,...l});super(a,!1,t(c,u),i(c)?e():null)}})(Bi,Xce,Tm,zs,Ps),Zce=((s,e,t,n)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),l=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=t(i,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,l.buffer=a,l.loop=!0;const h={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(g){c.channelCount=g},get channelCountMode(){return c.channelCountMode},set channelCountMode(g){c.channelCountMode=g},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(g){c.channelInterpretation=g},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return l.onended},set onended(g){l.onended=g},addEventListener:(...g)=>l.addEventListener(g[0],g[1],g[2]),dispatchEvent:(...g)=>l.dispatchEvent(g[0]),removeEventListener:(...g)=>l.removeEventListener(g[0],g[1],g[2]),start(g=0){l.start.call(l,g)},stop(g=0){l.stop.call(l,g)}};return s(i,l),n(Vf(h,c),()=>l.connect(c),()=>l.disconnect(c))})(g0,Gf,xo,Nu),Uf=((s,e,t,n,i)=>(r,o)=>{if(void 0===r.createConstantSource)return t(r,o);const a=r.createConstantSource();return er(a,o),vi(a,o,"offset"),e(n,()=>n(r))||Hx(a),e(i,()=>i(r))||Wx(a),s(r,a),a})(g0,Jo,Zce,Gx,Ux),Qce=((s,e,t,n,i)=>()=>{const r=new WeakMap;let o=null,a=null;const l=function(){var c=Ae(function*(u,h){let d=t(u);const p=Hr(d,h);return p||(d=e(h,{channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,offset:d.offset.value}),null!==o&&d.start(o),null!==a&&d.stop(a)),r.set(h,d),p?yield s(h,u.offset,d.offset):yield n(h,u.offset,d.offset),yield i(u,h,d),d});return function(h,d){return c.apply(this,arguments)}}();return{set start(c){o=c},set stop(c){a=c},render(c,u){const h=r.get(u);return void 0!==h?Promise.resolve(h):l(c,u)}}})(Rl,Uf,Js,Fl,Tr),Kce=((s,e,t,n,i,r,o)=>class extends s{constructor(l,c){const u=i(l),h={...sae,...c},d=n(u,h),p=r(u),g=p?t():null;super(l,!1,d,g),this._constantSourceNodeRenderer=g,this._nativeConstantSourceNode=d,this._offset=e(this,p,d.offset,lo,Do),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(l){const c="function"==typeof l?o(this,l):null;this._nativeConstantSourceNode.onended=c;const u=this._nativeConstantSourceNode.onended;this._onended=null!==u&&u===c?l:u}start(l=0){if(this._nativeConstantSourceNode.start(l),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=l),"closed"!==this.context.state){Of(this);const c=()=>{this._nativeConstantSourceNode.removeEventListener("ended",c),Nc(this)&&bm(this)};this._nativeConstantSourceNode.addEventListener("ended",c)}}stop(l=0){this._nativeConstantSourceNode.stop(l),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=l)}})(Bi,Za,Qce,Uf,zs,Ps,Hf),RH=((s,e)=>(t,n)=>{const i=t.createConvolver();if(er(i,n),n.disableNormalization===i.normalize&&(i.normalize=!n.disableNormalization),ei(i,n,"buffer"),n.channelCount>2||(e(i,"channelCount",r=>()=>r.call(i),r=>o=>{if(o>2)throw s();return r.call(i,o)}),"max"===n.channelCountMode))throw s();return e(i,"channelCountMode",r=>()=>r.call(i),r=>o=>{if("max"===o)throw s();return r.call(i,o)}),i})(Wr,Cm),eue=((s,e,t)=>()=>{const n=new WeakMap,i=function(){var r=Ae(function*(o,a){let l=e(o);return Hr(l,a)||(l=s(a,{buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,disableNormalization:!l.normalize})),n.set(a,l),Lf(l)?yield t(o,a,l.inputs[0]):yield t(o,a,l),l});return function(a,l){return r.apply(this,arguments)}}();return{render(r,o){const a=n.get(o);return void 0!==a?Promise.resolve(a):i(r,o)}}})(RH,Js,Tr),tue=((s,e,t,n,i,r)=>class extends s{constructor(a,l){const c=n(a),u={...aae,...l},h=t(c,u);super(a,!1,h,i(c)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=h,null!==u.buffer&&r(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,null===a&&null!==this._nativeConvolverNode.buffer){const l=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=l.createBuffer(1,1,l.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}})(Bi,eue,RH,zs,Ps,Jh),nue=((s,e,t,n,i)=>r=>{const o=new WeakMap,a=function(){var l=Ae(function*(c,u){let h=t(c);const d=Hr(h,u);return d||(h=e(u,{channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,delayTime:h.delayTime.value,maxDelayTime:r})),o.set(u,h),d?yield s(u,c.delayTime,h.delayTime):yield n(u,c.delayTime,h.delayTime),yield i(c,u,h),h});return function(u,h){return l.apply(this,arguments)}}();return{render(l,c){const u=o.get(c);return void 0!==u?Promise.resolve(u):a(l,c)}}})(Rl,_H,Js,Fl,Tr),sue=((s,e,t,n,i,r,o)=>class extends s{constructor(l,c){const u=i(l),h={...pae,...c},d=n(u,h),p=r(u);super(l,!1,d,p?t(h.maxDelayTime):null),this._delayTime=e(this,p,d.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}})(Bi,Za,nue,_H,zs,Ps,Jh),FH=(s=>(e,t)=>{const n=e.createDynamicsCompressor();if(er(n,t),t.channelCount>2||"max"===t.channelCountMode)throw s();return vi(n,t,"attack"),vi(n,t,"knee"),vi(n,t,"ratio"),vi(n,t,"release"),vi(n,t,"threshold"),n})(Wr),iue=((s,e,t,n,i)=>()=>{const r=new WeakMap,o=function(){var a=Ae(function*(l,c){let u=t(l);const h=Hr(u,c);return h||(u=e(c,{attack:u.attack.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,knee:u.knee.value,ratio:u.ratio.value,release:u.release.value,threshold:u.threshold.value})),r.set(c,u),h?(yield s(c,l.attack,u.attack),yield s(c,l.knee,u.knee),yield s(c,l.ratio,u.ratio),yield s(c,l.release,u.release),yield s(c,l.threshold,u.threshold)):(yield n(c,l.attack,u.attack),yield n(c,l.knee,u.knee),yield n(c,l.ratio,u.ratio),yield n(c,l.release,u.release),yield n(c,l.threshold,u.threshold)),yield i(l,c,u),u});return function(c,u){return a.apply(this,arguments)}}();return{render(a,l){const c=r.get(l);return void 0!==c?Promise.resolve(c):o(a,l)}}})(Rl,FH,Js,Fl,Tr),rue=((s,e,t,n,i,r,o,a)=>class extends s{constructor(c,u){const h=r(c),d={...vae,...u},p=n(h,d),g=o(h);super(c,!1,p,g?t():null),this._attack=e(this,g,p.attack),this._knee=e(this,g,p.knee),this._nativeDynamicsCompressorNode=p,this._ratio=e(this,g,p.ratio),this._release=e(this,g,p.release),this._threshold=e(this,g,p.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(c){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=c,c>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(c){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=c,"max"===c)throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Bi,Za,iue,FH,Wr,zs,Ps,Jh),oue=((s,e,t,n,i)=>()=>{const r=new WeakMap,o=function(){var a=Ae(function*(l,c){let u=t(l);const h=Hr(u,c);return h||(u=e(c,{channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,gain:u.gain.value})),r.set(c,u),h?yield s(c,l.gain,u.gain):yield n(c,l.gain,u.gain),yield i(l,c,u),u});return function(c,u){return a.apply(this,arguments)}}();return{render(a,l){const c=r.get(l);return void 0!==c?Promise.resolve(c):o(a,l)}}})(Rl,xo,Js,Fl,Tr),aue=((s,e,t,n,i,r)=>class extends s{constructor(a,l){const c=i(a),u={...Iae,...l},h=n(c,u),d=r(c);super(a,!1,h,d?t():null),this._gain=e(this,d,h.gain,lo,Do)}get gain(){return this._gain}})(Bi,Za,oue,xo,zs,Ps),lue=((s,e,t,n)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:l,feedback:c,feedforward:u})=>{const h=mH(r,i.sampleRate),d=c instanceof Float64Array?c:new Float64Array(c),p=u instanceof Float64Array?u:new Float64Array(u),g=d.length,m=p.length,_=Math.min(g,m);if(0===g||g>20)throw n();if(0===d[0])throw e();if(0===m||m>20)throw n();if(0===p[0])throw e();if(1!==d[0]){for(let x=0;x<m;x+=1)p[x]/=d[0];for(let x=1;x<g;x+=1)d[x]/=d[0]}const y=t(i,h,o,o);y.channelCount=o,y.channelCountMode=a,y.channelInterpretation=l;const S=[],D=[],T=[];for(let x=0;x<o;x+=1){S.push(0);const q=new Float32Array(32),W=new Float32Array(32);q.fill(0),W.fill(0),D.push(q),T.push(W)}y.onaudioprocess=x=>{const q=x.inputBuffer,W=x.outputBuffer,L=q.numberOfChannels;for(let H=0;H<L;H+=1){const Ce=q.getChannelData(H),Re=W.getChannelData(H);S[H]=pH(d,g,p,m,_,D[H],T[H],S[H],32,Ce,Re)}};const C=i.sampleRate/2;return Vf({get bufferSize(){return h},get channelCount(){return y.channelCount},set channelCount(x){y.channelCount=x},get channelCountMode(){return y.channelCountMode},set channelCountMode(x){y.channelCountMode=x},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(x){y.channelInterpretation=x},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener:(...x)=>y.addEventListener(x[0],x[1],x[2]),dispatchEvent:(...x)=>y.dispatchEvent(x[0]),getFrequencyResponse(x,q,W){if(x.length!==q.length||q.length!==W.length)throw s();const L=x.length;for(let H=0;H<L;H+=1){const Ce=-Math.PI*(x[H]/C),Re=[Math.cos(Ce),Math.sin(Ce)],Ve=Ale(bH(p,Re),bH(d,Re));q[H]=Math.sqrt(Ve[0]*Ve[0]+Ve[1]*Ve[1]),W[H]=Math.atan2(Ve[1],Ve[0])}},removeEventListener:(...x)=>y.removeEventListener(x[0],x[1],x[2])},y)})(p0,$i,km,Wr),m0=((s,e,t,n)=>i=>s(Xh,()=>Xh(i))?Promise.resolve(s(n,n)).then(r=>{if(!r){const o=t(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(r=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),r(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}))(Jo,xo,km,((s,e)=>()=>{if(null===e)return Promise.resolve(!1);const t=new e(1,1,44100),n=s(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{n.disconnect(),i(0!==t.currentTime)},t.startRendering()})})(xo,fr)),cue=((s,e,t,n,i)=>(r,o)=>{const a=new WeakMap;let l=null;const c=function(){var u=Ae(function*(h,d){let p=null,g=e(h);const m=Hr(g,d);if(void 0===d.createIIRFilter?p=s(d,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):m||(g=d.createIIRFilter(o,r)),a.set(d,null===p?g:p),null!==p){if(null===l){if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");const y=new t(h.context.destination.channelCount,h.context.length,d.sampleRate);l=Ae(function*(){return yield n(h,y,y.destination),((s,e,t,n)=>{const i=t instanceof Float64Array?t:new Float64Array(t),r=n instanceof Float64Array?n:new Float64Array(n),o=i.length,a=r.length,l=Math.min(o,a);if(1!==i[0]){for(let g=0;g<o;g+=1)r[g]/=i[0];for(let g=1;g<a;g+=1)i[g]/=i[0]}const u=new Float32Array(32),h=new Float32Array(32),d=e.createBuffer(s.numberOfChannels,s.length,s.sampleRate),p=s.numberOfChannels;for(let g=0;g<p;g+=1){const m=s.getChannelData(g),_=d.getChannelData(g);u.fill(0),h.fill(0),pH(i,o,r,a,l,u,h,0,32,m,_)}return d})(yield i(y),d,r,o)})()}const _=yield l;return p.buffer=_,p.start(0),p}return yield n(h,d,g),g});return function(d,p){return u.apply(this,arguments)}}();return{render(u,h){const d=a.get(h);return void 0!==d?Promise.resolve(d):c(u,h)}}})(Gf,Js,fr,Tr,m0),uue=(s=>(e,t,n)=>{if(void 0===e.createIIRFilter)return s(e,t,n);const i=e.createIIRFilter(n.feedforward,n.feedback);return er(i,n),i})(lue),hue=((s,e,t,n,i,r)=>class extends s{constructor(a,l){const c=n(a),u=i(c),h={...Gae,...l},d=e(c,u?null:a.baseLatency,h);super(a,!1,d,u?t(h.feedback,h.feedforward):null),(s=>{s.getFrequencyResponse=(e=>(t,n,i)=>{if(t.length!==n.length||n.length!==i.length)throw p0();return e.call(s,t,n,i)})(s.getFrequencyResponse)})(d),this._nativeIIRFilterNode=d,r(this,1)}getFrequencyResponse(a,l,c){return this._nativeIIRFilterNode.getFrequencyResponse(a,l,c)}})(Bi,uue,cue,zs,Ps,Jh),due=((s,e,t,n,i,r,o,a)=>(l,c)=>{const u=c.listener,{forwardX:d,forwardY:p,forwardZ:g,positionX:m,positionY:_,positionZ:y,upX:b,upY:S,upZ:D}=void 0===u.forwardX?(()=>{const T=new Float32Array(1),C=e(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),v=o(c);let x=!1,q=[0,0,-1,0,1,0],W=[0,0,0];const L=()=>{if(x)return;x=!0;const Fe=n(c,256,9,0);Fe.onaudioprocess=({inputBuffer:De})=>{const Ve=[r(De,T,0),r(De,T,1),r(De,T,2),r(De,T,3),r(De,T,4),r(De,T,5)];Ve.some((at,Bt)=>at!==q[Bt])&&(u.setOrientation(...Ve),q=Ve);const Dt=[r(De,T,6),r(De,T,7),r(De,T,8)];Dt.some((at,Bt)=>at!==W[Bt])&&(u.setPosition(...Dt),W=Dt)},C.connect(Fe)},H=Fe=>De=>{De!==q[Fe]&&(q[Fe]=De,u.setOrientation(...q))},Ce=Fe=>De=>{De!==W[Fe]&&(W[Fe]=De,u.setPosition(...W))},Re=(Fe,De,Ve)=>{const Dt=t(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:De});Dt.connect(C,0,Fe),Dt.start(),Object.defineProperty(Dt.offset,"defaultValue",{get:()=>De});const at=s({context:l},v,Dt.offset,lo,Do);return a(at,"value",Bt=>()=>Bt.call(at),Bt=>tt=>{try{Bt.call(at,tt)}catch(Xn){if(9!==Xn.code)throw Xn}L(),v&&Ve(tt)}),at.cancelAndHoldAtTime=(Bt=>v?()=>{throw i()}:(...tt)=>{const Xn=Bt.apply(at,tt);return L(),Xn})(at.cancelAndHoldAtTime),at.cancelScheduledValues=(Bt=>v?()=>{throw i()}:(...tt)=>{const Xn=Bt.apply(at,tt);return L(),Xn})(at.cancelScheduledValues),at.exponentialRampToValueAtTime=(Bt=>v?()=>{throw i()}:(...tt)=>{const Xn=Bt.apply(at,tt);return L(),Xn})(at.exponentialRampToValueAtTime),at.linearRampToValueAtTime=(Bt=>v?()=>{throw i()}:(...tt)=>{const Xn=Bt.apply(at,tt);return L(),Xn})(at.linearRampToValueAtTime),at.setTargetAtTime=(Bt=>v?()=>{throw i()}:(...tt)=>{const Xn=Bt.apply(at,tt);return L(),Xn})(at.setTargetAtTime),at.setValueAtTime=(Bt=>v?()=>{throw i()}:(...tt)=>{const Xn=Bt.apply(at,tt);return L(),Xn})(at.setValueAtTime),at.setValueCurveAtTime=(Bt=>v?()=>{throw i()}:(...tt)=>{const Xn=Bt.apply(at,tt);return L(),Xn})(at.setValueCurveAtTime),at};return{forwardX:Re(0,0,H(0)),forwardY:Re(1,0,H(1)),forwardZ:Re(2,-1,H(2)),positionX:Re(6,0,Ce(0)),positionY:Re(7,0,Ce(1)),positionZ:Re(8,0,Ce(2)),upX:Re(3,0,H(3)),upY:Re(4,1,H(4)),upZ:Re(5,0,H(5))}})():u;return{get forwardX(){return d},get forwardY(){return p},get forwardZ(){return g},get positionX(){return m},get positionY(){return _},get positionZ(){return y},get upX(){return b},get upY(){return S},get upZ(){return D}}})(Za,Eu,Uf,km,Wr,SH,Ps,Cm),OH=new WeakMap,Jx=((s,e,t,n,i,r)=>class extends t{constructor(a,l){super(a),this._nativeContext=a,t0.set(this,a),n(a)&&i.set(a,new Set),this._destination=new s(this,l),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const l="function"==typeof a?r(this,a):null;this._nativeContext.onstatechange=l;const c=this._nativeContext.onstatechange;this._onstatechange=null!==c&&c===l?a:c}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(Uce,due,EH,Ps,OH,Hf),LH=((s,e,t,n,i,r)=>(o,a)=>{const l=o.createOscillator();return er(l,a),vi(l,a,"detune"),vi(l,a,"frequency"),void 0!==a.periodicWave?l.setPeriodicWave(a.periodicWave):ei(l,a,"type"),e(t,()=>t(o))||Hx(l),e(n,()=>n(o))||r(l,o),e(i,()=>i(o))||Wx(l),s(o,l),l})(g0,Jo,Gx,kH,Ux,CH),fue=((s,e,t,n,i)=>()=>{const r=new WeakMap;let o=null,a=null,l=null;const c=function(){var u=Ae(function*(h,d){let p=t(h);const g=Hr(p,d);return g||(p=e(d,{channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,detune:p.detune.value,frequency:p.frequency.value,periodicWave:null===o?void 0:o,type:p.type}),null!==a&&p.start(a),null!==l&&p.stop(l)),r.set(d,p),g?(yield s(d,h.detune,p.detune),yield s(d,h.frequency,p.frequency)):(yield n(d,h.detune,p.detune),yield n(d,h.frequency,p.frequency)),yield i(h,d,p),p});return function(d,p){return u.apply(this,arguments)}}();return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){l=u},render(u,h){const d=r.get(h);return void 0!==d?Promise.resolve(d):c(u,h)}}})(Rl,LH,Js,Fl,Tr),pue=((s,e,t,n,i,r,o)=>class extends s{constructor(l,c){const u=i(l),h={...Qle,...c},d=t(u,h),p=r(u),g=p?n():null,m=l.sampleRate/2;super(l,!1,d,g),this._detune=e(this,p,d.detune,153600,-153600),this._frequency=e(this,p,d.frequency,m,-m),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=g,null!==this._oscillatorNodeRenderer&&void 0!==h.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(l){const c="function"==typeof l?o(this,l):null;this._nativeOscillatorNode.onended=c;const u=this._nativeOscillatorNode.onended;this._onended=null!==u&&u===c?l:u}get type(){return this._nativeOscillatorNode.type}set type(l){this._nativeOscillatorNode.type=l,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(l){this._nativeOscillatorNode.setPeriodicWave(l),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=l)}start(l=0){if(this._nativeOscillatorNode.start(l),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=l),"closed"!==this.context.state){Of(this);const c=()=>{this._nativeOscillatorNode.removeEventListener("ended",c),Nc(this)&&bm(this)};this._nativeOscillatorNode.addEventListener("ended",c)}}stop(l=0){this._nativeOscillatorNode.stop(l),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=l)}})(Bi,Za,LH,fue,zs,Ps,Hf),VH=(s=>(e,t)=>{const n=s(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return n.buffer=i,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}})(Gf),gue=((s,e,t,n,i)=>(r,{curve:o,oversample:a,...l})=>{const c=r.createWaveShaper(),u=r.createWaveShaper();er(c,l),er(u,l);const h=t(r,{...l,gain:1}),d=t(r,{...l,gain:-1}),p=t(r,{...l,gain:1}),g=t(r,{...l,gain:-1});let m=null,_=!1,y=null;const b={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(T){h.channelCount=T,d.channelCount=T,c.channelCount=T,p.channelCount=T,u.channelCount=T,g.channelCount=T},get channelCountMode(){return c.channelCountMode},set channelCountMode(T){h.channelCountMode=T,d.channelCountMode=T,c.channelCountMode=T,p.channelCountMode=T,u.channelCountMode=T,g.channelCountMode=T},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(T){h.channelInterpretation=T,d.channelInterpretation=T,c.channelInterpretation=T,p.channelInterpretation=T,u.channelInterpretation=T,g.channelInterpretation=T},get context(){return c.context},get curve(){return y},set curve(T){if(null!==T&&T.length<2)throw e();if(null===T)c.curve=T,u.curve=T;else{const C=T.length,v=new Float32Array(C+2-C%2),x=new Float32Array(C+2-C%2);v[0]=T[0],x[0]=-T[C-1];const q=Math.ceil((C+1)/2),W=(C+1)/2-1;for(let L=1;L<q;L+=1){const H=L/q*W,Ce=Math.floor(H),Re=Math.ceil(H);v[L]=Ce===Re?T[Ce]:(1-(H-Ce))*T[Ce]+(1-(Re-H))*T[Re],x[L]=Ce===Re?-T[C-1-Ce]:-(1-(H-Ce))*T[C-1-Ce]-(1-(Re-H))*T[C-1-Re]}v[q]=C%2==1?T[q-1]:(T[q-2]+T[q-1])/2,c.curve=v,u.curve=x}y=T,_&&(n(y)&&null===m?m=s(r,h):null!==m&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(T){c.oversample=T,u.oversample=T},addEventListener:(...T)=>h.addEventListener(T[0],T[1],T[2]),dispatchEvent:(...T)=>h.dispatchEvent(T[0]),removeEventListener:(...T)=>h.removeEventListener(T[0],T[1],T[2])};return null!==o&&(b.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==b.oversample&&(b.oversample=a),i(Vf(b,p),()=>{h.connect(c).connect(p),h.connect(d).connect(u).connect(g).connect(p),_=!0,n(y)&&(m=s(r,h))},()=>{h.disconnect(c),c.disconnect(p),h.disconnect(d),d.disconnect(u),u.disconnect(g),g.disconnect(p),_=!1,null!==m&&(m(),m=null)})})(VH,$i,xo,vH,Nu),y0=((s,e,t,n,i,r,o)=>(a,l)=>{const c=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return t(a,l);er(c,l);const u=null===l.curve||l.curve instanceof Float32Array?l.curve:new Float32Array(l.curve);if(null!==u&&u.length<2)throw e();ei(c,{curve:u},"curve"),ei(c,l,"oversample");let h=null,d=!1;return o(c,"curve",m=>()=>m.call(c),m=>_=>(m.call(c,_),d&&(n(_)&&null===h?h=s(a,c):!n(_)&&null!==h&&(h(),h=null)),_)),i(c,()=>{d=!0,n(c.curve)&&(h=s(a,c))},()=>{d=!1,null!==h&&(h(),h=null)})})(VH,$i,gue,vH,Nu,Ec,Cm),mue=((s,e,t,n,i,r,o,a,l,c)=>(u,{coneInnerAngle:h,coneOuterAngle:d,coneOuterGain:p,distanceModel:g,maxDistance:m,orientationX:_,orientationY:y,orientationZ:b,panningModel:S,positionX:D,positionY:T,positionZ:C,refDistance:v,rolloffFactor:x,...q})=>{const W=u.createPanner();if(q.channelCount>2||"max"===q.channelCountMode)throw o();er(W,q);const L={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},H=t(u,{...L,channelInterpretation:"speakers",numberOfInputs:6}),Ce=n(u,{...q,gain:1}),Re=n(u,{...L,gain:1}),Fe=n(u,{...L,gain:0}),De=n(u,{...L,gain:0}),Ve=n(u,{...L,gain:0}),Dt=n(u,{...L,gain:0}),at=n(u,{...L,gain:0}),Bt=i(u,256,6,1),tt=r(u,{...L,curve:new Float32Array([1,1]),oversample:"none"});let Xn=[_,y,b],as=[D,T,C];const En=new Float32Array(1);Bt.onaudioprocess=({inputBuffer:ze})=>{const sr=[l(ze,En,0),l(ze,En,1),l(ze,En,2)];sr.some((ep,tp)=>ep!==Xn[tp])&&(W.setOrientation(...sr),Xn=sr);const Wl=[l(ze,En,3),l(ze,En,4),l(ze,En,5)];Wl.some((ep,tp)=>ep!==as[tp])&&(W.setPosition(...Wl),as=Wl)},Object.defineProperty(Fe.gain,"defaultValue",{get:()=>0}),Object.defineProperty(De.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Ve.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Dt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(at.gain,"defaultValue",{get:()=>0});const On={get bufferSize(){},get channelCount(){return W.channelCount},set channelCount(ze){if(ze>2)throw o();Ce.channelCount=ze,W.channelCount=ze},get channelCountMode(){return W.channelCountMode},set channelCountMode(ze){if("max"===ze)throw o();Ce.channelCountMode=ze,W.channelCountMode=ze},get channelInterpretation(){return W.channelInterpretation},set channelInterpretation(ze){Ce.channelInterpretation=ze,W.channelInterpretation=ze},get coneInnerAngle(){return W.coneInnerAngle},set coneInnerAngle(ze){W.coneInnerAngle=ze},get coneOuterAngle(){return W.coneOuterAngle},set coneOuterAngle(ze){W.coneOuterAngle=ze},get coneOuterGain(){return W.coneOuterGain},set coneOuterGain(ze){if(ze<0||ze>1)throw e();W.coneOuterGain=ze},get context(){return W.context},get distanceModel(){return W.distanceModel},set distanceModel(ze){W.distanceModel=ze},get inputs(){return[Ce]},get maxDistance(){return W.maxDistance},set maxDistance(ze){if(ze<0)throw new RangeError;W.maxDistance=ze},get numberOfInputs(){return W.numberOfInputs},get numberOfOutputs(){return W.numberOfOutputs},get orientationX(){return Re.gain},get orientationY(){return Fe.gain},get orientationZ(){return De.gain},get panningModel(){return W.panningModel},set panningModel(ze){W.panningModel=ze},get positionX(){return Ve.gain},get positionY(){return Dt.gain},get positionZ(){return at.gain},get refDistance(){return W.refDistance},set refDistance(ze){if(ze<0)throw new RangeError;W.refDistance=ze},get rolloffFactor(){return W.rolloffFactor},set rolloffFactor(ze){if(ze<0)throw new RangeError;W.rolloffFactor=ze},addEventListener:(...ze)=>Ce.addEventListener(ze[0],ze[1],ze[2]),dispatchEvent:(...ze)=>Ce.dispatchEvent(ze[0]),removeEventListener:(...ze)=>Ce.removeEventListener(ze[0],ze[1],ze[2])};return h!==On.coneInnerAngle&&(On.coneInnerAngle=h),d!==On.coneOuterAngle&&(On.coneOuterAngle=d),p!==On.coneOuterGain&&(On.coneOuterGain=p),g!==On.distanceModel&&(On.distanceModel=g),m!==On.maxDistance&&(On.maxDistance=m),_!==On.orientationX.value&&(On.orientationX.value=_),y!==On.orientationY.value&&(On.orientationY.value=y),b!==On.orientationZ.value&&(On.orientationZ.value=b),S!==On.panningModel&&(On.panningModel=S),D!==On.positionX.value&&(On.positionX.value=D),T!==On.positionY.value&&(On.positionY.value=T),C!==On.positionZ.value&&(On.positionZ.value=C),v!==On.refDistance&&(On.refDistance=v),x!==On.rolloffFactor&&(On.rolloffFactor=x),(1!==Xn[0]||0!==Xn[1]||0!==Xn[2])&&W.setOrientation(...Xn),(0!==as[0]||0!==as[1]||0!==as[2])&&W.setPosition(...as),c(Vf(On,W),()=>{Ce.connect(W),s(Ce,tt,0,0),tt.connect(Re).connect(H,0,0),tt.connect(Fe).connect(H,0,1),tt.connect(De).connect(H,0,2),tt.connect(Ve).connect(H,0,3),tt.connect(Dt).connect(H,0,4),tt.connect(at).connect(H,0,5),H.connect(Bt).connect(u.destination)},()=>{Ce.disconnect(W),a(Ce,tt,0,0),tt.disconnect(Re),Re.disconnect(H),tt.disconnect(Fe),Fe.disconnect(H),tt.disconnect(De),De.disconnect(H),tt.disconnect(Ve),Ve.disconnect(H),tt.disconnect(Dt),Dt.disconnect(H),tt.disconnect(at),at.disconnect(H),H.disconnect(Bt),Bt.disconnect(u.destination)})})(a0,$i,Eu,xo,km,y0,Wr,l0,SH,Nu),HH=(s=>(e,t)=>{const n=e.createPanner();return void 0===n.orientationX?s(e,t):(er(n,t),vi(n,t,"orientationX"),vi(n,t,"orientationY"),vi(n,t,"orientationZ"),vi(n,t,"positionX"),vi(n,t,"positionY"),vi(n,t,"positionZ"),ei(n,t,"coneInnerAngle"),ei(n,t,"coneOuterAngle"),ei(n,t,"coneOuterGain"),ei(n,t,"distanceModel"),ei(n,t,"maxDistance"),ei(n,t,"panningModel"),ei(n,t,"refDistance"),ei(n,t,"rolloffFactor"),n)})(mue),yue=((s,e,t,n,i,r,o,a,l,c)=>()=>{const u=new WeakMap;let h=null;const d=function(){var p=Ae(function*(g,m){let _=null,y=r(g);const b={channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation},S={...b,coneInnerAngle:y.coneInnerAngle,coneOuterAngle:y.coneOuterAngle,coneOuterGain:y.coneOuterGain,distanceModel:y.distanceModel,maxDistance:y.maxDistance,panningModel:y.panningModel,refDistance:y.refDistance,rolloffFactor:y.rolloffFactor},D=Hr(y,m);if("bufferSize"in y)_=n(m,{...b,gain:1});else if(!D){const T={...S,orientationX:y.orientationX.value,orientationY:y.orientationY.value,orientationZ:y.orientationZ.value,positionX:y.positionX.value,positionY:y.positionY.value,positionZ:y.positionZ.value};y=i(m,T)}if(u.set(m,null===_?y:_),null!==_){if(null===h){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const H=new o(6,g.context.length,m.sampleRate),Ce=e(H,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});Ce.connect(H.destination),h=Ae(function*(){const Re=yield Promise.all([g.orientationX,g.orientationY,g.orientationZ,g.positionX,g.positionY,g.positionZ].map(function(){var Fe=Ae(function*(De,Ve){const Dt=t(H,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===Ve?1:0});return yield a(H,De,Dt.offset),Dt});return function(De,Ve){return Fe.apply(this,arguments)}}()));for(let Fe=0;Fe<6;Fe+=1)Re[Fe].connect(Ce,0,Fe),Re[Fe].start(0);return c(H)})()}const T=yield h,C=n(m,{...b,gain:1});yield l(g,m,C);const v=[];for(let H=0;H<T.numberOfChannels;H+=1)v.push(T.getChannelData(H));let x=[v[0][0],v[1][0],v[2][0]],q=[v[3][0],v[4][0],v[5][0]],W=n(m,{...b,gain:1}),L=i(m,{...S,orientationX:x[0],orientationY:x[1],orientationZ:x[2],positionX:q[0],positionY:q[1],positionZ:q[2]});C.connect(W).connect(L.inputs[0]),L.connect(_);for(let H=128;H<T.length;H+=128){const Ce=[v[0][H],v[1][H],v[2][H]],Re=[v[3][H],v[4][H],v[5][H]];if(Ce.some((Fe,De)=>Fe!==x[De])||Re.some((Fe,De)=>Fe!==q[De])){x=Ce,q=Re;const Fe=H/m.sampleRate;W.gain.setValueAtTime(0,Fe),W=n(m,{...b,gain:0}),L=i(m,{...S,orientationX:x[0],orientationY:x[1],orientationZ:x[2],positionX:q[0],positionY:q[1],positionZ:q[2]}),W.gain.setValueAtTime(1,Fe),C.connect(W).connect(L.inputs[0]),L.connect(_)}}return _}return D?(yield s(m,g.orientationX,y.orientationX),yield s(m,g.orientationY,y.orientationY),yield s(m,g.orientationZ,y.orientationZ),yield s(m,g.positionX,y.positionX),yield s(m,g.positionY,y.positionY),yield s(m,g.positionZ,y.positionZ)):(yield a(m,g.orientationX,y.orientationX),yield a(m,g.orientationY,y.orientationY),yield a(m,g.orientationZ,y.orientationZ),yield a(m,g.positionX,y.positionX),yield a(m,g.positionY,y.positionY),yield a(m,g.positionZ,y.positionZ)),Lf(y)?yield l(g,m,y.inputs[0]):yield l(g,m,y),y});return function(m,_){return p.apply(this,arguments)}}();return{render(p,g){const m=u.get(g);return void 0!==m?Promise.resolve(m):d(p,g)}}})(Rl,Eu,Uf,xo,HH,Js,fr,Fl,Tr,m0),_ue=((s,e,t,n,i,r,o)=>class extends s{constructor(l,c){const u=i(l),h={...tce,...c},d=t(u,h),p=r(u);super(l,!1,d,p?n():null),this._nativePannerNode=d,this._orientationX=e(this,p,d.orientationX,lo,Do),this._orientationY=e(this,p,d.orientationY,lo,Do),this._orientationZ=e(this,p,d.orientationZ,lo,Do),this._positionX=e(this,p,d.positionX,lo,Do),this._positionY=e(this,p,d.positionY,lo,Do),this._positionZ=e(this,p,d.positionZ,lo,Do),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(l){this._nativePannerNode.coneInnerAngle=l}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(l){this._nativePannerNode.coneOuterAngle=l}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(l){this._nativePannerNode.coneOuterGain=l}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(l){this._nativePannerNode.distanceModel=l}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(l){this._nativePannerNode.maxDistance=l}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(l){this._nativePannerNode.panningModel=l}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(l){this._nativePannerNode.refDistance=l}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(l){this._nativePannerNode.rolloffFactor=l}})(Bi,Za,HH,yue,zs,Ps,Jh),bue=(s=>(e,{disableNormalization:t,imag:n,real:i})=>{const r=n instanceof Float32Array?n:new Float32Array(n),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:t});if(Array.from(n).length<2)throw s();return a})(Al),wue=((s,e,t)=>class g5{constructor(r,o){const a=e(r),l=(s=>{const{imag:e,real:t}=s;return void 0===e?void 0===t?{...s,imag:[0,0],real:[0,0]}:{...s,imag:Array.from(t,()=>0),real:t}:void 0===t?{...s,imag:e,real:Array.from(e,()=>0)}:{...s,imag:e,real:t}})({...ice,...o}),c=s(a,l);return t.add(c),c}static[Symbol.hasInstance](r){return null!==r&&"object"==typeof r&&Object.getPrototypeOf(r)===g5.prototype||t.has(r)}})(bue,zs,new WeakSet),Sue=((s,e,t,n,i,r)=>{const a=new Float32Array([1,1]),l=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...c,oversample:"none"},p=(g,m,_,y,b)=>{if(1===m)return((g,m,_,y)=>{const b=new Float32Array(16385),S=new Float32Array(16385);for(let q=0;q<16385;q+=1){const W=q/16384*l;b[q]=Math.cos(W),S[q]=Math.sin(W)}const D=t(g,{...c,gain:0}),T=n(g,{...u,curve:b}),C=n(g,{...u,curve:a}),v=t(g,{...c,gain:0}),x=n(g,{...u,curve:S});return{connectGraph(){m.connect(D),m.connect(void 0===C.inputs?C:C.inputs[0]),m.connect(v),C.connect(_),_.connect(void 0===T.inputs?T:T.inputs[0]),_.connect(void 0===x.inputs?x:x.inputs[0]),T.connect(D.gain),x.connect(v.gain),D.connect(y,0,0),v.connect(y,0,1)},disconnectGraph(){m.disconnect(D),m.disconnect(void 0===C.inputs?C:C.inputs[0]),m.disconnect(v),C.disconnect(_),_.disconnect(void 0===T.inputs?T:T.inputs[0]),_.disconnect(void 0===x.inputs?x:x.inputs[0]),T.disconnect(D.gain),x.disconnect(v.gain),D.disconnect(y,0,0),v.disconnect(y,0,1)}}})(g,_,y,b);if(2===m)return((g,m,_,y)=>{const b=new Float32Array(16385),S=new Float32Array(16385),D=new Float32Array(16385),T=new Float32Array(16385),C=Math.floor(8192.5);for(let Ve=0;Ve<16385;Ve+=1)if(Ve>C){const Dt=(Ve-C)/(16384-C)*l;b[Ve]=Math.cos(Dt),S[Ve]=Math.sin(Dt),D[Ve]=0,T[Ve]=1}else{const Dt=Ve/(16384-C)*l;b[Ve]=1,S[Ve]=0,D[Ve]=Math.cos(Dt),T[Ve]=Math.sin(Dt)}const v=e(g,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),x=t(g,{...c,gain:0}),q=n(g,{...u,curve:b}),W=t(g,{...c,gain:0}),L=n(g,{...u,curve:S}),H=n(g,{...u,curve:a}),Ce=t(g,{...c,gain:0}),Re=n(g,{...u,curve:D}),Fe=t(g,{...c,gain:0}),De=n(g,{...u,curve:T});return{connectGraph(){m.connect(v),m.connect(void 0===H.inputs?H:H.inputs[0]),v.connect(x,0),v.connect(W,0),v.connect(Ce,1),v.connect(Fe,1),H.connect(_),_.connect(void 0===q.inputs?q:q.inputs[0]),_.connect(void 0===L.inputs?L:L.inputs[0]),_.connect(void 0===Re.inputs?Re:Re.inputs[0]),_.connect(void 0===De.inputs?De:De.inputs[0]),q.connect(x.gain),L.connect(W.gain),Re.connect(Ce.gain),De.connect(Fe.gain),x.connect(y,0,0),Ce.connect(y,0,0),W.connect(y,0,1),Fe.connect(y,0,1)},disconnectGraph(){m.disconnect(v),m.disconnect(void 0===H.inputs?H:H.inputs[0]),v.disconnect(x,0),v.disconnect(W,0),v.disconnect(Ce,1),v.disconnect(Fe,1),H.disconnect(_),_.disconnect(void 0===q.inputs?q:q.inputs[0]),_.disconnect(void 0===L.inputs?L:L.inputs[0]),_.disconnect(void 0===Re.inputs?Re:Re.inputs[0]),_.disconnect(void 0===De.inputs?De:De.inputs[0]),q.disconnect(x.gain),L.disconnect(W.gain),Re.disconnect(Ce.gain),De.disconnect(Fe.gain),x.disconnect(y,0,0),Ce.disconnect(y,0,0),W.disconnect(y,0,1),Fe.disconnect(y,0,1)}}})(g,_,y,b);throw i()};return(g,{channelCount:m,channelCountMode:_,pan:y,...b})=>{if("max"===_)throw i();const S=s(g,{...b,channelCount:1,channelCountMode:_,numberOfInputs:2}),D=t(g,{...b,channelCount:m,channelCountMode:_,gain:1}),T=t(g,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y});let{connectGraph:C,disconnectGraph:v}=p(g,m,D,T,S);Object.defineProperty(T.gain,"defaultValue",{get:()=>0}),Object.defineProperty(T.gain,"maxValue",{get:()=>1}),Object.defineProperty(T.gain,"minValue",{get:()=>-1});const x={get bufferSize(){},get channelCount(){return D.channelCount},set channelCount(H){D.channelCount!==H&&(q&&v(),({connectGraph:C,disconnectGraph:v}=p(g,H,D,T,S)),q&&C()),D.channelCount=H},get channelCountMode(){return D.channelCountMode},set channelCountMode(H){if("clamped-max"===H||"max"===H)throw i();D.channelCountMode=H},get channelInterpretation(){return D.channelInterpretation},set channelInterpretation(H){D.channelInterpretation=H},get context(){return D.context},get inputs(){return[D]},get numberOfInputs(){return D.numberOfInputs},get numberOfOutputs(){return D.numberOfOutputs},get pan(){return T.gain},addEventListener:(...H)=>D.addEventListener(H[0],H[1],H[2]),dispatchEvent:(...H)=>D.dispatchEvent(H[0]),removeEventListener:(...H)=>D.removeEventListener(H[0],H[1],H[2])};let q=!1;return r(Vf(x,S),()=>{C(),q=!0},()=>{v(),q=!1})}})(Eu,Tm,xo,y0,Wr,Nu),WH=((s,e)=>(t,n)=>{const i=n.channelCountMode;if("clamped-max"===i)throw e();if(void 0===t.createStereoPanner)return s(t,n);const r=t.createStereoPanner();return er(r,n),vi(r,n,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),r})(Sue,Wr),vue=((s,e,t,n,i)=>()=>{const r=new WeakMap,o=function(){var a=Ae(function*(l,c){let u=t(l);const h=Hr(u,c);return h||(u=e(c,{channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,pan:u.pan.value})),r.set(c,u),h?yield s(c,l.pan,u.pan):yield n(c,l.pan,u.pan),Lf(u)?yield i(l,c,u.inputs[0]):yield i(l,c,u),u});return function(c,u){return a.apply(this,arguments)}}();return{render(a,l){const c=r.get(l);return void 0!==c?Promise.resolve(c):o(a,l)}}})(Rl,WH,Js,Fl,Tr),Tue=((s,e,t,n,i,r)=>class extends s{constructor(a,l){const c=i(a),u={...fce,...l},h=t(c,u),d=r(c);super(a,!1,h,d?n():null),this._pan=e(this,d,h.pan)}get pan(){return this._pan}})(Bi,Za,WH,vue,zs,Ps),kue=((s,e,t)=>()=>{const n=new WeakMap,i=function(){var r=Ae(function*(o,a){let l=e(o);return Hr(l,a)||(l=s(a,{channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,curve:l.curve,oversample:l.oversample})),n.set(a,l),Lf(l)?yield t(o,a,l.inputs[0]):yield t(o,a,l),l});return function(a,l){return r.apply(this,arguments)}}();return{render(r,o){const a=n.get(o);return void 0!==a?Promise.resolve(a):i(r,o)}}})(y0,Js,Tr),Cue=((s,e,t,n,i,r,o)=>class extends s{constructor(l,c){const u=i(l),h={...bce,...c},d=t(u,h);super(l,!0,d,r(u)?n():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(l){if(null===l)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(l.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=l}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(l){this._nativeWaveShaperNode.oversample=l}})(Bi,$i,y0,kue,zs,Ps,Jh),GH=(s=>null!==s&&s.isSecureContext)(Ja),Zx=(s=>(e,t,n)=>{Object.defineProperties(s,{currentFrame:{configurable:!0,get:()=>Math.round(e*t)},currentTime:{configurable:!0,get:()=>e}});try{return n()}finally{null!==s&&(delete s.currentFrame,delete s.currentTime)}})(Ja),UH=new WeakMap,Due=((s,e)=>t=>{let n=s.get(t);if(void 0!==n)return n;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),s.set(t,n),n})(UH,fr),xue=GH?((s,e,t,n,i,r,o,a,l,c,u,h,d)=>{let p=0;return(g,m,_={credentials:"omit"})=>{const y=u.get(g);if(void 0!==y&&y.has(m))return Promise.resolve();const b=c.get(g);if(void 0!==b){const T=b.get(m);if(void 0!==T)return T}const S=r(g),D=void 0===S.audioWorklet?i(m).then(([T,C])=>{const[v,x]=KV(T,C);return t(`${v};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${x}\n})})(window,'_AWGS')`)}).then(()=>{const T=d._AWGS.pop();if(void 0===T)throw new SyntaxError;n(S.currentTime,S.sampleRate,()=>T(class{},void 0,(C,v)=>{if(""===C.trim())throw e();const x=Mx.get(S);if(void 0!==x){if(x.has(C))throw e();tH(v),eH(v.parameterDescriptors),x.set(C,v)}else tH(v),eH(v.parameterDescriptors),Mx.set(S,new Map([[C,v]]))},S.sampleRate,void 0,void 0))}):Promise.all([i(m),Promise.resolve(s(h,h))]).then(([[T,C],v])=>{const x=p+1;p=x;const[q,W]=KV(T,C),Fe=new Blob([`${q};((AudioWorkletProcessor,registerProcessor)=>{${W}\n})(${v?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${v?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${v?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${x}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),De=URL.createObjectURL(Fe);return S.audioWorklet.addModule(De,_).then(()=>{if(a(S))return S;const Ve=o(S);return Ve.audioWorklet.addModule(De,_).then(()=>Ve)}).then(Ve=>{if(null===l)throw new SyntaxError;try{new l(Ve,`__sac${x}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(De))});return void 0===b?c.set(g,new Map([[m,D]])):b.set(m,D),D.then(()=>{const T=u.get(g);void 0===T?u.set(g,new Set([m])):T.add(m)}).finally(()=>{const T=c.get(g);void 0!==T&&T.delete(m)}),D}})(Jo,Wr,(s=>e=>new Promise((t,n)=>{if(null===s)return void n(new SyntaxError);const i=s.document.head;if(null===i)n(new SyntaxError);else{const r=s.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),l=s.onerror,c=()=>{s.onerror=l,URL.revokeObjectURL(a)};s.onerror=(u,h,d,p,g)=>h===a||h===s.location.href&&1===d&&1===p?(c(),n(g),!1):null!==l?l(u,h,d,p,g):void 0,r.onerror=()=>{c(),n(new SyntaxError)},r.onload=()=>{c(),t()},r.src=a,r.type="module",i.appendChild(r)}}))(Ja),Zx,function(){var e=Ae(function*(t){try{const n=yield fetch(t);if(n.ok)return[yield n.text(),n.url]}catch{}throw new DOMException("","AbortError")});return function(t){return e.apply(this,arguments)}}(),zs,Due,Ps,Wf,new WeakMap,new WeakMap,((s,e)=>Ae(function*(){if(null===s)return!0;if(null===e)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),i=URL.createObjectURL(t);let r=!1,o=!1;try{yield n.audioWorklet.addModule(i);const a=new s(n,"a",{numberOfOutputs:0}),l=n.createOscillator();a.port.onmessage=()=>r=!0,a.onprocessorerror=()=>o=!0,l.connect(a),l.start(0),yield n.startRendering(),yield new Promise(c=>setTimeout(c))}catch{}finally{URL.revokeObjectURL(i)}return r&&!o}))(Wf,fr),Ja):void 0,Nue=((s,e)=>t=>s(t)||e(t))(qx,Ps),Eue=((s,e,t,n,i,r,o,a,l,c,u)=>(h,d)=>{const p=o(h)?h:r(h);if(i.has(d)){const g=new DOMException("","DataCloneError");return Promise.reject(g)}try{i.add(d)}catch{}return e(l,()=>l(p))?p.decodeAudioData(d).then(g=>(fH(d).catch(()=>{}),e(a,()=>a(g))||u(g),s.add(g),g)):new Promise((g,m)=>{const _=function(){var b=Ae(function*(){try{yield fH(d)}catch{}});return function(){return b.apply(this,arguments)}}(),y=b=>{m(b),_()};try{p.decodeAudioData(d,b=>{"function"!=typeof b.copyFromChannel&&(c(b),Rx(b)),s.add(b),_().then(()=>g(b))},b=>{y(null===b?new DOMException("","EncodingError"):b)})}catch(b){y(b)}})})(jx,Jo,0,0,new WeakSet,zs,Nue,s0,Xh,Yx,Xx),zH=((s,e,t,n,i,r,o,a,l,c,u,h,d,p,g,m,_,y,b,S)=>class extends g{constructor(T,C){super(T,C),this._nativeContext=T,this._audioWorklet=void 0===s?void 0:{addModule:(v,x)=>s(this,v,x)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(T,C,v){return new t({length:C,numberOfChannels:T,sampleRate:v})}createBufferSource(){return new n(this)}createChannelMerger(T=6){return new r(this,{numberOfInputs:T})}createChannelSplitter(T=6){return new o(this,{numberOfOutputs:T})}createConstantSource(){return new a(this)}createConvolver(){return new l(this)}createDelay(T=1){return new u(this,{maxDelayTime:T})}createDynamicsCompressor(){return new h(this)}createGain(){return new d(this)}createIIRFilter(T,C){return new p(this,{feedback:C,feedforward:T})}createOscillator(){return new m(this)}createPanner(){return new _(this)}createPeriodicWave(T,C,v={disableNormalization:!1}){return new y(this,{...v,imag:C,real:T})}createStereoPanner(){return new b(this)}createWaveShaper(){return new S(this)}decodeAudioData(T,C,v){return c(this._nativeContext,T).then(x=>("function"==typeof C&&C(x),x),x=>{throw"function"==typeof v&&v(x),x})}})(xue,Hce,PH,Gce,qce,Yce,Jce,Kce,tue,Eue,sue,rue,aue,hue,Jx,pue,_ue,wue,Tue,Cue),Iue=((s,e,t,n)=>class extends s{constructor(r,o){const a=t(r),l=((s,e)=>s.createMediaElementSource(e.mediaElement))(a,o);if(n(a))throw TypeError();super(r,!0,l,null),this._nativeMediaElementAudioSourceNode=l}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Bi,0,zs,Ps),Bue=((s,e,t,n)=>class extends s{constructor(r,o){const a=t(r);if(n(a))throw new TypeError;const c=((s,e)=>{const t=s.createMediaStreamDestination();return er(t,e),1===t.numberOfOutputs&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t})(a,{...ile,...o});super(r,!1,c,null),this._nativeMediaStreamAudioDestinationNode=c}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Bi,0,zs,Ps),Mue=((s,e,t,n)=>class extends s{constructor(r,o){const a=t(r),l=((s,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((r,o)=>r.id<o.id?-1:r.id>o.id?1:0);const n=t.slice(0,1),i=s.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(i,"mediaStream",{value:e}),i})(a,o);if(n(a))throw new TypeError;super(r,!0,l,null),this._nativeMediaStreamAudioSourceNode=l}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Bi,0,zs,Ps),Pue=((s,e)=>(t,{mediaStreamTrack:n})=>{if("function"==typeof t.createMediaStreamTrackSource)return t.createMediaStreamTrackSource(n);const i=new MediaStream([n]),r=t.createMediaStreamSource(i);if("audio"!==n.kind)throw s();if(e(t))throw new TypeError;return r})($i,Ps),Aue=((s,e,t)=>class extends s{constructor(i,r){const o=t(i);super(i,!0,e(o,r),null)}})(Bi,Pue,zs),Rue=((s,e,t,n,i,r,o,a,l)=>class extends s{constructor(u={}){if(null===l)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new l(u)}catch(g){throw 12===g.code&&"sampleRate is not in range"===g.message?t():g}if(null===h)throw n();if(!(s=>void 0===s||"number"==typeof s||"string"==typeof s&&("balanced"===s||"interactive"===s||"playback"===s))(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==u.sampleRate&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:d}=u,{sampleRate:p}=h;if(this._baseLatency="number"==typeof h.baseLatency?h.baseLatency:"balanced"===d?512/p:"interactive"===d||void 0===d?256/p:"playback"===d?1024/p:128*Math.max(2,Math.min(128,Math.round(d*p/128)))/p,this._nativeAudioContext=h,"webkitAudioContext"===l.name?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===h.state){this._state="suspended";const g=()=>{"suspended"===this._state&&(this._state=null),h.removeEventListener("statechange",g)};h.addEventListener("statechange",g)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then(()=>{throw e()}):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then(()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),r0(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return"suspended"===this._state?new Promise((u,h)=>{const d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),"running"===this._nativeAudioContext.state?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw void 0===u||15===u.code?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw void 0===u?e():u})}})(zH,$i,Wr,wH,Iue,Bue,Mue,Aue,Ec),Qx=(s=>e=>{const t=s.get(e);if(void 0===t)throw new Error("The context has no set of AudioWorkletNodes.");return t})(OH),Fue=(s=>(e,t)=>{s(e).add(t)})(Qx),qH=(s=>(e,t,n=0,i=0)=>{const r=e[n];if(void 0===r)throw s();return u0(t)?r.connect(t,0,i):r.connect(t,0)})(Al),Oue=(s=>(e,t)=>{s(e).delete(t)})(Qx),$H=(s=>(e,t=void 0,n=void 0,i=0)=>void 0===t?e.forEach(r=>r.disconnect()):"number"==typeof t?f0(s,e,t).disconnect():u0(t)?void 0===n?e.forEach(r=>r.disconnect(t)):void 0===i?f0(s,e,n).disconnect(t,0):f0(s,e,n).disconnect(t,0,i):void 0===n?e.forEach(r=>r.disconnect(t)):f0(s,e,n).disconnect(t,0))(Al),jH=new WeakMap,Lue=((s,e)=>t=>e(s,t))(jH,Xa),Vue=((s,e,t,n,i,r,o,a,l,c,u,h,d)=>(p,g,m,_)=>{if(0===_.numberOfInputs&&0===_.numberOfOutputs)throw l();const y=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(y.some(je=>je<1))throw l();if(y.length!==_.numberOfOutputs)throw e();if("explicit"!==_.channelCountMode)throw l();const b=_.channelCount*_.numberOfInputs,S=y.reduce((je,tn)=>je+tn,0),D=void 0===m.parameterDescriptors?0:m.parameterDescriptors.length;if(b+D>6||S>6)throw l();const T=new MessageChannel,C=[],v=[];for(let je=0;je<_.numberOfInputs;je+=1)C.push(o(p,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),v.push(i(p,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const x=[];if(void 0!==m.parameterDescriptors)for(const{defaultValue:je,maxValue:tn,minValue:ir,name:hi}of m.parameterDescriptors){const ls=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==_.parameterData[hi]?_.parameterData[hi]:void 0===je?0:je});Object.defineProperties(ls.offset,{defaultValue:{get:()=>void 0===je?0:je},maxValue:{get:()=>void 0===tn?lo:tn},minValue:{get:()=>void 0===ir?Do:ir}}),x.push(ls)}const q=n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,b+D)}),W=mH(g,p.sampleRate),L=a(p,W,b+D,Math.max(1,S)),H=i(p,{channelCount:Math.max(1,S),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,S)}),Ce=[];for(let je=0;je<_.numberOfOutputs;je+=1)Ce.push(n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[je]}));for(let je=0;je<_.numberOfInputs;je+=1){C[je].connect(v[je]);for(let tn=0;tn<_.channelCount;tn+=1)v[je].connect(q,tn,je*_.channelCount+tn)}const Re=new hH(void 0===m.parameterDescriptors?[]:m.parameterDescriptors.map(({name:je},tn)=>{const ir=x[tn];return ir.connect(q,0,b+tn),ir.start(0),[je,ir.offset]}));q.connect(L);let Fe=_.channelInterpretation,De=null;const Ve=0===_.numberOfOutputs?[L]:Ce,Dt={get bufferSize(){return W},get channelCount(){return _.channelCount},set channelCount(je){throw t()},get channelCountMode(){return _.channelCountMode},set channelCountMode(je){throw t()},get channelInterpretation(){return Fe},set channelInterpretation(je){for(const tn of C)tn.channelInterpretation=je;Fe=je},get context(){return L.context},get inputs(){return C},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},get onprocessorerror(){return De},set onprocessorerror(je){"function"==typeof De&&Dt.removeEventListener("processorerror",De),De="function"==typeof je?je:null,"function"==typeof De&&Dt.addEventListener("processorerror",De)},get parameters(){return Re},get port(){return T.port2},addEventListener:(...je)=>L.addEventListener(je[0],je[1],je[2]),connect:s.bind(null,Ve),disconnect:c.bind(null,Ve),dispatchEvent:(...je)=>L.dispatchEvent(je[0]),removeEventListener:(...je)=>L.removeEventListener(je[0],je[1],je[2])},at=new Map;T.port1.addEventListener=(je=>(...tn)=>{if("message"===tn[0]){const ir="function"==typeof tn[1]?tn[1]:"object"==typeof tn[1]&&null!==tn[1]&&"function"==typeof tn[1].handleEvent?tn[1].handleEvent:null;if(null!==ir){const hi=at.get(tn[1]);void 0!==hi?tn[1]=hi:(tn[1]=ls=>{u(p.currentTime,p.sampleRate,()=>ir(ls))},at.set(ir,tn[1]))}}return je.call(T.port1,tn[0],tn[1],tn[2])})(T.port1.addEventListener),T.port1.removeEventListener=(je=>(...tn)=>{if("message"===tn[0]){const ir=at.get(tn[1]);void 0!==ir&&(at.delete(tn[1]),tn[1]=ir)}return je.call(T.port1,tn[0],tn[1],tn[2])})(T.port1.removeEventListener);let Bt=null;Object.defineProperty(T.port1,"onmessage",{get:()=>Bt,set:je=>{"function"==typeof Bt&&T.port1.removeEventListener("message",Bt),Bt="function"==typeof je?je:null,"function"==typeof Bt&&(T.port1.addEventListener("message",Bt),T.port1.start())}}),m.prototype.port=T.port1;let tt=null;((s,e,t,n)=>{let i=Px.get(s);void 0===i&&(i=new WeakMap,Px.set(s,i));const r=kle(t,n);return i.set(e,r),r})(p,Dt,m,_).then(je=>tt=je);const as=d0(_.numberOfInputs,_.channelCount),En=d0(_.numberOfOutputs,y),On=void 0===m.parameterDescriptors?[]:m.parameterDescriptors.reduce((je,{name:tn})=>({...je,[tn]:new Float32Array(128)}),{});let Pc=!0;const Lu=()=>{_.numberOfOutputs>0&&L.disconnect(H);for(let je=0,tn=0;je<_.numberOfOutputs;je+=1){const ir=Ce[je];for(let hi=0;hi<y[je];hi+=1)H.disconnect(ir,tn+hi,hi);tn+=y[je]}},ze=new Map;L.onaudioprocess=({inputBuffer:je,outputBuffer:tn})=>{if(null!==tt){const ir=h(Dt);for(let hi=0;hi<W;hi+=128){for(let ls=0;ls<_.numberOfInputs;ls+=1)for(let ki=0;ki<_.channelCount;ki+=1)h0(je,as[ls],ki,ki,hi);void 0!==m.parameterDescriptors&&m.parameterDescriptors.forEach(({name:ls},ki)=>{h0(je,On,ls,b+ki,hi)});for(let ls=0;ls<_.numberOfInputs;ls+=1)for(let ki=0;ki<y[ls];ki+=1)0===En[ls][ki].byteLength&&(En[ls][ki]=new Float32Array(128));try{const ls=as.map((va,Vu)=>{if(ir[Vu].size>0)return ze.set(Vu,W/128),va;const SN=ze.get(Vu);return void 0===SN?[]:(va.every(mde=>mde.every(yde=>0===yde))&&(1===SN?ze.delete(Vu):ze.set(Vu,SN-1)),va)});Pc=u(p.currentTime+hi/p.sampleRate,p.sampleRate,()=>tt.process(ls,En,On));for(let va=0,Vu=0;va<_.numberOfOutputs;va+=1){for(let Um=0;Um<y[va];Um+=1)dH(tn,En[va],Um,Vu+Um,hi);Vu+=y[va]}}catch(ls){Pc=!1,Dt.dispatchEvent(new ErrorEvent("processorerror",{colno:ls.colno,filename:ls.filename,lineno:ls.lineno,message:ls.message}))}if(!Pc){for(let ls=0;ls<_.numberOfInputs;ls+=1){C[ls].disconnect(v[ls]);for(let ki=0;ki<_.channelCount;ki+=1)v[hi].disconnect(q,ki,ls*_.channelCount+ki)}if(void 0!==m.parameterDescriptors){const ls=m.parameterDescriptors.length;for(let ki=0;ki<ls;ki+=1){const va=x[ki];va.disconnect(q,0,b+ki),va.stop()}}q.disconnect(L),L.onaudioprocess=null,sr?Lu():tp();break}}}};let sr=!1;const Wl=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),ep=()=>L.connect(Wl).connect(p.destination),tp=()=>{L.disconnect(Wl),Wl.disconnect()};return ep(),d(Dt,()=>{if(Pc){tp(),_.numberOfOutputs>0&&L.connect(H);for(let je=0,tn=0;je<_.numberOfOutputs;je+=1){const ir=Ce[je];for(let hi=0;hi<y[je];hi+=1)H.connect(ir,tn+hi,hi);tn+=y[je]}}sr=!0},()=>{Pc&&(ep(),Lu()),sr=!1})})(qH,Al,$i,Eu,Tm,Uf,xo,km,Wr,$H,Zx,Lue,Nu),Hue=((s,e,t,n,i)=>(r,o,a,l,c,u)=>{if(null!==a)try{const h=new a(r,l,u),d=new Map;let p=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw s()}},channelCountMode:{get:()=>"explicit",set:()=>{throw s()}},onprocessorerror:{get:()=>p,set:g=>{"function"==typeof p&&h.removeEventListener("processorerror",p),p="function"==typeof g?g:null,"function"==typeof p&&h.addEventListener("processorerror",p)}}}),h.addEventListener=(g=>(...m)=>{if("processorerror"===m[0]){const _="function"==typeof m[1]?m[1]:"object"==typeof m[1]&&null!==m[1]&&"function"==typeof m[1].handleEvent?m[1].handleEvent:null;if(null!==_){const y=d.get(m[1]);void 0!==y?m[1]=y:(m[1]=b=>{"error"===b.type?(Object.defineProperties(b,{type:{value:"processorerror"}}),_(b)):_(new ErrorEvent(m[0],{...b}))},d.set(_,m[1]))}}return g.call(h,"error",m[1],m[2]),g.call(h,...m)})(h.addEventListener),h.removeEventListener=(g=>(...m)=>{if("processorerror"===m[0]){const _=d.get(m[1]);void 0!==_&&(d.delete(m[1]),m[1]=_)}return g.call(h,"error",m[1],m[2]),g.call(h,m[0],m[1],m[2])})(h.removeEventListener),0!==u.numberOfOutputs){const g=t(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(g).connect(r.destination),i(h,()=>g.disconnect(),()=>g.connect(r.destination))}return h}catch(h){throw 11===h.code?n():h}if(void 0===c)throw n();return(s=>{const{port1:e}=new MessageChannel;try{e.postMessage(s)}finally{e.close()}})(u),e(r,o,c,u)})($i,Vue,xo,Wr,Nu),Wue=((s,e,t,n,i,r,o,a,l,c,u,h,d,p,g,m)=>(_,y,b)=>{const S=new WeakMap;let D=null;const T=function(){var C=Ae(function*(v,x){let q=u(v),W=null;const L=Hr(q,x),H=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(null===h){const Ce=H.reduce((Ve,Dt)=>Ve+Dt,0),Re=i(x,{channelCount:Math.max(1,Ce),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,Ce)}),Fe=[];for(let Ve=0;Ve<v.numberOfOutputs;Ve+=1)Fe.push(n(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:H[Ve]}));const De=o(x,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});De.connect=e.bind(null,Fe),De.disconnect=l.bind(null,Fe),W=[Re,Fe,De]}else L||(q=new h(x,_));if(S.set(x,null===W?q:W[2]),null!==W){if(null===D){if(void 0===b)throw new Error("Missing the processor constructor.");if(null===d)throw new Error("Missing the native OfflineAudioContext constructor.");const Dt=v.channelCount*v.numberOfInputs,at=void 0===b.parameterDescriptors?0:b.parameterDescriptors.length,Bt=Dt+at;D=Woe(v,0===Bt?null:yield function(){var Xn=Ae(function*(){const as=new d(Bt,128*Math.ceil(v.context.length/128),x.sampleRate),En=[],On=[];for(let ze=0;ze<y.numberOfInputs;ze+=1)En.push(o(as,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),On.push(i(as,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const Pc=yield Promise.all(Array.from(v.parameters.values()).map(function(){var ze=Ae(function*(sr){const Wl=r(as,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:sr.value});return yield p(as,sr,Wl.offset),Wl});return function(sr){return ze.apply(this,arguments)}}())),Lu=n(as,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,Dt+at)});for(let ze=0;ze<y.numberOfInputs;ze+=1){En[ze].connect(On[ze]);for(let sr=0;sr<y.channelCount;sr+=1)On[ze].connect(Lu,sr,ze*y.channelCount+sr)}for(const[ze,sr]of Pc.entries())sr.connect(Lu,0,Dt+ze),sr.start(0);return Lu.connect(as.destination),yield Promise.all(En.map(ze=>g(v,as,ze))),m(as)});return function(){return Xn.apply(this,arguments)}}()(),x,y,H,b,c)}const Ce=yield D,Re=t(x,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[Fe,De,Ve]=W;null!==Ce&&(Re.buffer=Ce,Re.start(0)),Re.connect(Fe);for(let Dt=0,at=0;Dt<v.numberOfOutputs;Dt+=1){const Bt=De[Dt];for(let tt=0;tt<H[Dt];tt+=1)Fe.connect(Bt,at+tt,tt);at+=H[Dt]}return Ve}if(L)for(const[Ce,Re]of v.parameters.entries())yield s(x,Re,q.parameters.get(Ce));else for(const[Ce,Re]of v.parameters.entries())yield p(x,Re,q.parameters.get(Ce));return yield g(v,x,q),q});return function(x,q){return C.apply(this,arguments)}}();return{render(C,v){a(v,C);const x=S.get(v);return void 0!==x?Promise.resolve(x):T(C,v)}}})(Rl,qH,Gf,Eu,Tm,Uf,xo,Oue,$H,Zx,Js,Wf,fr,Fl,Tr,m0),Gue=(s=>e=>s.get(e))(UH),Uue=(s=>(e,t)=>{s.set(e,t)})(jH),YH=GH?((s,e,t,n,i,r,o,a,l,c,u,h,d,p)=>class extends e{constructor(m,_,y){var b;const S=a(m),D=l(S),T=(s=>({...s,outputChannelCount:void 0!==s.outputChannelCount?s.outputChannelCount:1===s.numberOfInputs&&1===s.numberOfOutputs?[s.channelCount]:Array.from({length:s.numberOfOutputs},()=>1)}))({...Loe,...y});(s=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(s)}finally{e.close(),t.close()}})(T);const C=Mx.get(S),v=C?.get(_),x=D||"closed"!==S.state?S:null!==(b=o(S))&&void 0!==b?b:S,q=i(x,D?null:m.baseLatency,c,_,v,T);super(m,!0,q,D?n(_,T,v):null);const L=[];q.parameters.forEach((Ce,Re)=>{const Fe=t(this,D,Ce);L.push([Re,Fe])}),this._nativeAudioWorkletNode=q,this._onprocessorerror=null,this._parameters=new hH(L),D&&s(S,this);const{activeInputs:H}=r(this);h(q,H)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const _="function"==typeof m?p(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=_;const y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==y&&y===_?m:y}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(Fue,Bi,Za,Wue,Hue,co,Gue,zs,Ps,Wf,0,Uue,0,Hf):void 0,XH=((s,e)=>(t,n,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,n,i)}catch(r){throw"SyntaxError"===r.name?s():r}})(Wr,fr),JH=((s,e,t,n,i,r,o,a)=>(l,c)=>t(l).render(l,c).then(()=>Promise.all(Array.from(n(c)).map(u=>t(u).render(u,c)))).then(()=>i(c)).then(u=>("function"!=typeof u.copyFromChannel?(o(u),Rx(u)):e(r,()=>r(u))||a(u),s.add(u),u)))(jx,Jo,zx,Qx,m0,s0,Yx,Xx),zue=((s,e,t,n,i)=>class extends s{constructor(o,a,l){let c;if("number"==typeof o&&void 0!==a&&void 0!==l)c={length:a,numberOfChannels:o,sampleRate:l};else{if("object"!=typeof o)throw new Error("The given parameters are not valid.");c=o}const{length:u,numberOfChannels:h,sampleRate:d}={...Jle,...c},p=n(h,u,d);e(Xh,()=>Xh(p))||p.addEventListener("statechange",(()=>{let g=0;const m=_=>{"running"===this._state&&(g>0?(p.removeEventListener("statechange",m),_.stopImmediatePropagation(),this._waitForThePromiseToSettle(_)):g+=1)};return m})()),super(p,h),this._length=u,this._nativeOfflineAudioContext=p,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(t()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,r0(this)}))}_waitForThePromiseToSettle(o){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}})(zH,Jo,$i,XH,JH),que=((s,e)=>t=>{const n=s.get(t);return e(n)||e(t)})(t0,qx),$ue=((s,e)=>t=>s.has(t)||e(t))(Ex,$x),jue=((s,e)=>t=>s.has(t)||e(t))(Ix,IH),Yue=((s,e)=>t=>{const n=s.get(t);return e(n)||e(t)})(t0,Ps);var s;function Zo(s){return void 0===s}function wn(s){return void 0!==s}function fa(s){return"number"==typeof s}function Iu(s){return"[object Object]"===Object.prototype.toString.call(s)&&s.constructor===Object}function Gr(s){return Array.isArray(s)}function Ol(s){return"string"==typeof s}function _0(s){return Ol(s)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(s)}function st(s,e){if(!s)throw new Error(e)}function pr(s,e,t=1/0){if(!(e<=s&&s<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${s}`)}function QH(s){!s.isOffline&&"running"!==s.state&&Dm('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let KH=!1,e3=!1;function t3(s){KH=s}let Kx=console;function Dm(...s){Kx.warn(...s)}function Kue(s,e,t){return new zue(s,e,t)}const uo="object"==typeof self?self:null,ehe=uo&&(uo.hasOwnProperty("AudioContext")||uo.hasOwnProperty("webkitAudioContext"));class nhe{constructor(e,t,n,i){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch{this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),"worker"===this._type&&(null===(t=this._worker)||void 0===t||t.postMessage(1e3*this._updateInterval))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function Zh(s){return jue(s)}function Bu(s){return $ue(s)}function b0(s){return Yue(s)}function zf(s){return que(s)}function ihe(s,e){return"value"===s||Zh(e)||Bu(e)||function she(s){return s instanceof PH}(e)}function pa(s,...e){if(!e.length)return s;const t=e.shift();if(Iu(s)&&Iu(t))for(const n in t)ihe(n,t[n])?s[n]=t[n]:Iu(t[n])?(s[n]||Object.assign(s,{[n]:{}}),pa(s[n],t[n])):Object.assign(s,{[n]:t[n]});return pa(s,...e)}function ne(s,e,t=[],n){const i={},r=Array.from(e);if(Iu(r[0])&&n&&!Reflect.has(r[0],n)&&(Object.keys(r[0]).some(a=>Reflect.has(s,a))||(pa(i,{[n]:r[0]}),t.splice(t.indexOf(n),1),r.shift())),1===r.length&&Iu(r[0]))pa(i,r[0]);else for(let o=0;o<t.length;o++)wn(r[o])&&(i[t[o]]=r[o]);return pa(s,i)}function Qa(s,e){return Zo(s)?e:s}function kr(s,e){return e.forEach(t=>{Reflect.has(s,t)&&delete s[t]}),s}let Mu=(()=>{class s{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||uo&&this.toString()===uo.TONE_DEBUG_CLASS)&&function Zue(...s){Kx.log(...s)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}return s.version=Nx,s})();const eN=1e-6;function qf(s,e){return s>e+eN}function tN(s,e){return qf(s,e)||Ka(s,e)}function w0(s,e){return s+eN<e}function Ka(s,e){return Math.abs(s-e)<eN}class ga extends Mu{constructor(){super(),this.name="Timeline",this._timeline=[];const e=ne(ga.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(st(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length)st(tN(e.time,this._timeline[this.length-1].time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e);else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}return this.length>this.memory&&this._timeline.splice(0,this.length-this.memory),this}remove(e){const t=this._timeline.indexOf(e);return-1!==t&&this._timeline.splice(t,1),this}get(e,t="time"){const n=this._search(e,t);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(Ka(this._timeline[t].time,e)){for(let n=t;n>=0&&Ka(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else 1===this._timeline.length&&tN(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(0===this._timeline.length)return-1;let n=0;const i=this._timeline.length;let r=i;if(i>0&&this._timeline[i-1][t]<=e)return i-1;for(;n<r;){let o=Math.floor(n+(r-n)/2);const a=this._timeline[o],l=this._timeline[o+1];if(Ka(a[t],e)){for(let c=o;c<this._timeline.length&&Ka(this._timeline[c][t],e);c++)o=c;return o}if(w0(a[t],e)&&qf(l[t],e))return o;qf(a[t],e)?r=o:n=o+1}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return-1!==n&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let i=this._search(e),r=this._search(t);return-1!==i&&-1!==r?(this._timeline[i].time!==e&&(i+=1),this._timeline[r].time===t&&(r-=1),this._iterate(n,i,r)):-1===i&&this._iterate(n,0,r),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(-1!==n&&Ka(this._timeline[n].time,e)){let i=n;for(let r=n;r>=0&&Ka(this._timeline[r].time,e);r--)i=r;this._iterate(r=>{t(r)},i,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const n3=[];function S0(s){n3.push(s)}const s3=[];function v0(s){s3.push(s)}class xm extends Mu{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(i=>{Zo(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}),this}once(e,t){const n=(...i)=>{t(...i),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach(i=>{if(Zo(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(Zo(t))this._events[i]=[];else{const r=this._events[i];for(let o=r.length-1;o>=0;o--)r[o]===t&&r.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let i=0,r=n.length;i<r;i++)n[i].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const n=Object.getOwnPropertyDescriptor(xm.prototype,t);Object.defineProperty(e.prototype,t,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class i3 extends xm{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Nm extends i3{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new ga,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const n=ne(Nm.getDefaults(),arguments,["context"]);n.context?(this._context=n.context,this._latencyHint=(null===(e=arguments[0])||void 0===e?void 0:e.latencyHint)||""):(this._context=function Que(s){return new Rue(s)}({latencyHint:n.latencyHint}),this._latencyHint=n.latencyHint),this._ticker=new nhe(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[null!==(t=arguments[0])&&void 0!==t&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=n.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(function ahe(s){n3.forEach(e=>e(s))}(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return st(zf(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return st(zf(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return st(zf(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){st(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){st(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){st(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){st(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return function the(s,e,t){return st(wn(YH),"AudioWorkletNode only works in a secure context (https or localhost)"),new(s instanceof uo?.BaseAudioContext?uo?.AudioWorkletNode:YH)(s,e,t)}(this.rawContext,e,t)}addAudioWorkletModule(e){return Is(this,void 0,void 0,function*(){st(wn(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return Is(this,void 0,void 0,function*(){(yield this._workletPromise)||Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return zf(this._context)?this._context.resume():Promise.resolve()}close(){return Is(this,void 0,void 0,function*(){zf(this._context)&&"closed"!==this.state&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&function lhe(s){s3.forEach(e=>e(s))}(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let r=0;r<n.length;r++)n[r]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();this._timeouts.forEachBefore(e,t=>{t.callback(),this._timeouts.remove(t)})}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,i=()=>{const r=this.now();this._timeouts.add({callback:()=>{e(),i()},id:n,time:r+t})};return i(),n}}function Ct(s,e){Gr(e)?e.forEach(t=>Ct(s,t)):Object.defineProperty(s,e,{enumerable:!0,writable:!1})}function Em(s,e){Gr(e)?e.forEach(t=>Em(s,t)):Object.defineProperty(s,e,{writable:!0})}const Nn=()=>{};let el=(()=>{class s extends Mu{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Nn;const t=ne(s.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,Ol(t.url)?this.load(t.url).catch(t.onerror):t.url&&this.set(t.url)}static getDefaults(){return{onerror:Nn,onload:Nn,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:ma().sampleRate}set(t){return t instanceof s?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return Is(this,void 0,void 0,function*(){const n=s.load(t).then(i=>{this.set(i),this.onload(this)});s.downloads.push(n);try{yield n}finally{const i=s.downloads.indexOf(n);s.downloads.splice(i,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const n=Gr(t)&&t[0].length>0,i=n?t.length:1,r=n?t[0].length:t.length,o=ma(),a=o.createBuffer(i,r,o.sampleRate),l=n||1!==i?t:[t];for(let c=0;c<i;c++)a.copyToChannel(l[c],c);return this._buffer=a,this}toMono(t){if(fa(t))this.fromArray(this.toArray(t));else{let n=new Float32Array(this.length);const i=this.numberOfChannels;for(let r=0;r<i;r++){const o=this.toArray(r);for(let a=0;a<o.length;a++)n[a]+=o[a]}n=n.map(r=>r/i),this.fromArray(n)}return this}toArray(t){if(fa(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const n=[];for(let i=0;i<this.numberOfChannels;i++)n[i]=this.getChannelData(i);return n}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,n=this.duration){st(this.loaded,"Buffer is not loaded");const i=Math.floor(t*this.sampleRate),r=Math.floor(n*this.sampleRate);st(i<r,"The start time must be less than the end time");const o=r-i,a=ma().createBuffer(this.numberOfChannels,o,this.sampleRate);for(let l=0;l<this.numberOfChannels;l++)a.copyToChannel(this.getChannelData(l).subarray(i,r),l);return new s(a)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new s).fromArray(t)}static fromUrl(t){return Is(this,void 0,void 0,function*(){return yield(new s).load(t)})}static load(t){return Is(this,void 0,void 0,function*(){const n=""===s.baseUrl||s.baseUrl.endsWith("/")?s.baseUrl:s.baseUrl+"/",i=yield fetch(n+t);if(!i.ok)throw new Error(`could not load url: ${t}`);const r=yield i.arrayBuffer();return yield ma().decodeAudioData(r)})}static supportsType(t){const n=t.split("."),i=n[n.length-1];return""!==document.createElement("audio").canPlayType("audio/"+i)}static loaded(){return Is(this,void 0,void 0,function*(){for(yield Promise.resolve();s.downloads.length;)yield s.downloads[0]})}}return s.baseUrl="",s.downloads=[],s})();class T0 extends Nm{constructor(){super({clockSource:"offline",context:b0(arguments[0])?arguments[0]:Kue(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:b0(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=b0(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Is(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return Is(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new el(t)})}close(){return Promise.resolve()}}const r3=new class che extends i3{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return Is(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}};let Kh=r3;function ma(){return Kh===r3&&ehe&&function uhe(s,e=!1){e&&Kh.dispose(),Kh=zf(s)?new Nm(s):b0(s)?new T0(s):s}(new Nm),Kh}if(uo&&!uo.TONE_SILENCE_LOGGING){console.log(`%c * Tone.js ${"v"}${Nx} * `,"background: #000; color: #fff")}function Bm(s){return Math.pow(2,s/12)}let C0=440;function ed(s){return Math.round(o3(s))}function o3(s){return 69+12*Math.log2(s/C0)}class nN extends Mu{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),i="."===t?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/n)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(3*Math.floor(t)))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let i=0;return e&&"0"!==e&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(i+=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(i+=this._beatsToUnits(parseFloat(n)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof nN&&this.fromType(this._val),Zo(this._val))return this._noArg();if(Ol(this._val)&&Zo(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Iu(this._val)){let e=0;for(const t in this._val)if(wn(this._val[t])){const n=this._val[t];e+=new this.constructor(this.context,t).valueOf()*n}return e}if(wn(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}return Ol(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class ya extends nN{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new ya(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const n=new this.constructor(this.context,e).valueOf(),i=this.valueOf();return i+(Math.round(i/n)*n-i)*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let r=1;r<9;r++){const o=Math.pow(2,r);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let n=t[0],i=new ya(this.context,t[0]).toSeconds();return t.forEach(r=>{const o=new ya(this.context,r).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(n=r,i=o)}),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let i=t%1*4;t=Math.floor(t)%this._getTimeSignature();const r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[n,t,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return ed(this.toFrequency())}_now(){return this.context.now()}}class No extends ya{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return function hhe(){return C0}()}static set A4(e){!function dhe(s){C0=s}(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return"midi"===this.defaultUnits?e:No.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const i=fhe[e.toLowerCase()]+12*(parseInt(t,10)+1);return"midi"===this.defaultUnits?i:No.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let i=1;return e&&"0"!==e&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(i*=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(i*=this._beatsToUnits(parseFloat(n)/4)),i}}})}transpose(e){return new No(this.context,this.valueOf()*Bm(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return ed(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/No.A4);let n=Math.round(12*t)+57;const i=Math.floor(n/12);return i<0&&(n+=-12*i),phe[n%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(60*e/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return function a3(s){return C0*Math.pow(2,(s-69)/12)}(e)}static ftom(e){return ed(e)}}const fhe={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},phe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class tr extends ya{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class gr extends Mu{constructor(){super();const e=ne(gr.getDefaults(),arguments,["context"]);this.context=this.defaultContext?this.defaultContext:e.context}static getDefaults(){return{context:ma()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return function Jue(s){Zo(s)&&KH&&!e3&&(e3=!0,Dm("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}(e),new ya(this.context,e).toSeconds()}toFrequency(e){return new No(this.context,e).toFrequency()}toTicks(e){return new tr(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(n=>{Zo(e[n])&&delete t[n]}),t}get(){const e=function ohe(s){return s.constructor.getDefaults()}(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const n=this[t];wn(n)&&wn(n.value)&&wn(n.setValueAtTime)?e[t]=n.value:n instanceof gr?e[t]=n._getPartialProperties(e[t]):Gr(n)||fa(n)||Ol(n)||function ZH(s){return"boolean"==typeof s}(n)?e[t]=n:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&wn(this[t])&&(this[t]&&wn(this[t].value)&&wn(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof gr?this[t].set(e[t]):this[t]=e[t])}),this}}class Mm extends ga{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return null!==t?t.state:this._initial}setStateAtTime(e,t,n){return pr(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){for(let i=this._search(t);i>=0;i--){const r=this._timeline[i];if(r.state===e)return r}}getNextState(e,t){const n=this._search(t);if(-1!==n)for(let i=n;i<this._timeline.length;i++){const r=this._timeline[i];if(r.state===e)return r}}}class en extends gr{constructor(){const e=ne(en.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,st(wn(e.param)&&(Zh(e.param)||e.param instanceof en),"param must be an AudioParam");!Zh(e.param);)e.param=e.param._param;this._swappable=!!wn(e.swappable)&&e.swappable,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new ga(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,wn(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(gr.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return wn(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return wn(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return wn(this.maxValue)&&wn(this.minValue)&&pr(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?function Im(s){return Math.pow(10,s/20)}(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&"decibels"===this.units?function k0(s){return Math.log(s)/Math.LN10*20}(e):e}setValueAtTime(e,t){const n=this.toSeconds(t),i=this._fromType(e);return st(isFinite(i)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),i=this._events.get(t);let r=this._initialValue;if(null===i)r=this._initialValue;else if("setTargetAtTime"!==i.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)r=i.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let o=i.value;if("setTargetAtTime"===i.type){const a=this._events.getBefore(i.time);o=null===a?this._initialValue:a.value}r="linearRampToValueAtTime"===n.type?this._linearInterpolate(i.time,o,n.time,n.value,t):this._exponentialInterpolate(i.time,o,n.time,n.value,t)}else r=i.value;else{const o=this._events.getBefore(i.time);let a;a=null===o?this._initialValue:o.value,"setTargetAtTime"===i.type&&(r=this._exponentialApproach(i.time,a,i.value,i.constant,t))}return this._toType(r)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),0===this._fromType(t)&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),i=this.toSeconds(t);return st(isFinite(n)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:i,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(n,i),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=Ka(n,0)?this._minOutput:n,this._assertRange(n);const i=this.toSeconds(t);return st(isFinite(n)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(n,i),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const i=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,i),this.cancelAndHoldAtTime(t+.9*n),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const i=this._fromType(e);st(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const r=this.toSeconds(t);return this._assertRange(i),st(isFinite(i)&&isFinite(r),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,r,n),this._param.setTargetAtTime(i,r,n),this}setValueCurveAtTime(e,t,n,i=1){n=this.toSeconds(n),t=this.toSeconds(t);const r=this._fromType(e[0])*i;this.setValueAtTime(this._toType(r),t);const o=n/(e.length-1);for(let a=1;a<e.length;a++){const l=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(l),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return st(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));st(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const i=this._events.get(t),r=this._events.getAfter(t);return i&&Ka(i.time,t)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),"linearRampToValueAtTime"===r.type?this.linearRampToValueAtTime(this._toType(n),t):"exponentialRampToValueAtTime"===r.type&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&"setTargetAtTime"===n.type){const i=this._events.getAfter(n.time),r=i?i.time:t+2,o=(r-t)/10;for(let a=t;a<r;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{"cancelScheduledValues"===i.type?e.cancelScheduledValues(i.time):"setTargetAtTime"===i.type?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){st(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,i,r){return n+(t-n)*Math.exp(-(r-e)/i)}_linearInterpolate(e,t,n,i,r){return t+(r-e)/(n-e)*(i-t)}_exponentialInterpolate(e,t,n,i,r){return t*Math.pow(i/t,(r-e)/(n-e))}}class de extends gr{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return wn(this.input)?Zh(this.input)||this.input instanceof en?1:this.input.numberOfInputs:0}get numberOfOutputs(){return wn(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return wn(e)&&(e instanceof de||Bu(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();st(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return Eo(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Dm("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return function l3(s,e,t=0,n=0){if(wn(e))for(;e instanceof de;)e=e.input;for(;!Bu(s);)wn(s.output)&&(s=s.output);Zh(e)?s.disconnect(e,t):Bu(e)?s.disconnect(e,t,n):s.disconnect()}(this,e,t,n),this}chain(...e){return _a(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),wn(this.input)&&(this.input instanceof de?this.input.dispose():Bu(this.input)&&this.input.disconnect()),wn(this.output)&&(this.output instanceof de?this.output.dispose():Bu(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function _a(...s){const e=s.shift();s.reduce((t,n)=>(t instanceof de?t.connect(n):Bu(t)&&Eo(t,n),n),e)}function Eo(s,e,t=0,n=0){for(st(wn(s),"Cannot connect from undefined node"),st(wn(e),"Cannot connect to undefined node"),(e instanceof de||Bu(e))&&st(e.numberOfInputs>0,"Cannot connect to node with no inputs"),st(s.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof de||e instanceof en;)wn(e.input)&&(e=e.input);for(;s instanceof de;)wn(s.output)&&(s=s.output);Zh(e)?s.connect(e,t):s.connect(e,t,n)}class et extends de{constructor(){const e=ne(et.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new en({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Ct(this,"gain")}static getDefaults(){return Object.assign(de.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class $f extends de{constructor(e){super(e),this.onended=Nn,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new et({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const n=this.toSeconds(t);return-1!==this._startTime&&n>=this._startTime&&(-1===this._stopTime||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(de.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Nn})}_startGain(e,t=1){st(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){st(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const n="exponential"===this._curve?2*t:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Nn&&(this.onended(this),this.onended=Nn,!this.context.isOffline)){const e=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(e):setTimeout(e,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),st(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Nn,this}}class D0 extends $f{constructor(){const e=ne(D0.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),Eo(this._source,this._gainNode),this.offset=new en({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign($f.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Gt extends de{constructor(){const e=ne(Gt.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new D0({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(de.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return x0(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,i){return this._param.setValueCurveAtTime(e,t,n,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function x0(s,e,t,n){(e instanceof en||Zh(e)||e instanceof Gt&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Gt&&(e.overridden=!0)),Eo(s,e,t,n)}class sN extends en{constructor(){const e=ne(sN.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new ga(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(en.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const i=this._fromType(e),r=this._events.get(t),o=Math.round(Math.max(1/n,1));for(let a=0;a<=o;a++){const l=n*a+t,c=this._exponentialApproach(r.time,r.value,i,n,l);this.linearRampToValueAtTime(this._toType(c),l)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const i=this._events.get(n),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const i=this._events.get(n),r=this._events.previousEvent(i),o=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),i=this._events.get(t),r=Math.round(Math.max(10*(t-i.time),1)),o=(t-i.time)/r;for(let a=0;a<=r;a++){const l=o*a+i.time,c=this._exponentialInterpolate(i.time,i.value,t,n,l);this.linearRampToValueAtTime(this._toType(c),l)}return this}_getTicksUntilEvent(e,t){if(null===e)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Zo(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));const r=this._events.get(t);return r&&r.time===t&&"setValueAtTime"===r.type&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+i)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),i=this.getTicksAtTime(t);return this.getTimeOfTick(i+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&"linearRampToValueAtTime"===n.type&&t.value!==n.value){const i=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(n.time))-i)/(n.time-t.time),a=Math.sqrt(Math.pow(i,2)-2*o*(t.ticks-e)),l=(-i+a)/o;return(l>0?l:(-i-a)/o)+t.time}return t?0===t.value?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),i=this.toSeconds(e),r=this.getTicksAtTime(n);return this.getTicksAtTime(n+i)-r}_fromType(e){return"bpm"===this.units&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return"bpm"===this.units&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class iN extends Gt{constructor(){const e=ne(iN.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new sN({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Gt.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class rN extends gr{constructor(){const e=ne(rN.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new Mm,this._tickOffset=new ga,this._ticksAtTime=new ga,this._secondsAtTime=new ga,this.frequency=new iN({context:this.context,units:e.units,value:e.frequency}),Ct(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},gr.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),wn(t)&&this.setTicksAtTime(t,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}stop(e){const t=this.toSeconds(e);if("stopped"===this._state.getValueAtTime(t)){const n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),i=this._ticksAtTime.get(t),r={state:"paused",time:t};this._state.add(r);let o=i||n,a=i?i.ticks:0,l=null;return this._state.forEachBetween(o.time,t+this.sampleTime,c=>{let u=o.time;const h=this._tickOffset.get(c.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),"started"===o.state&&"started"!==c.state&&(a+=this.frequency.getTicksAtTime(c.time)-this.frequency.getTicksAtTime(u),c.time!==r.time&&(l={state:c.state,time:c.time,ticks:a})),o=c}),this._state.remove(r),l&&this._ticksAtTime.add(l),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);const i=this._secondsAtTime.get(e);let r=i||t,o=i?i.seconds:0,a=null;return this._state.forEachBetween(r.time,e+this.sampleTime,l=>{let c=r.time;const u=this._tickOffset.get(l.time);u&&u.time>=r.time&&(o=u.seconds,c=u.time),"started"===r.state&&"started"!==l.state&&(o+=l.time-c,l.time!==n.time&&(a={state:l.state,time:l.time,seconds:o})),r=l}),this._state.remove(n),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const n=this._tickOffset.get(t),i=this._state.get(t),r=Math.max(n.time,i.time),o=this.frequency.getTicksAtTime(r)+e-n.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,n){let i=this._state.get(e);this._state.forEachBetween(e,t,o=>{i&&"started"===i.state&&"started"!==o.state&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,n),i=o});let r=null;if(i&&"started"===i.state){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=a-this.frequency.getTicksAtTime(i.time);let u=Math.ceil(c)-c;u=Ka(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{n(h,Math.round(this.getTicksAtTime(h)))}catch(d){r=d;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class Pm extends gr{constructor(){const e=ne(Pm.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=Nn,this._lastUpdate=0,this._state=new Mm("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new rN({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Ct(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(gr.getDefaults(),{callback:Nn,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){QH(this.context);const n=this.toSeconds(e);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),i=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(i+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,n=>{switch(n.state){case"started":const i=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,i);break;case"stopped":0!==n.time&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time)}}),this._tickSource.forEachTickBetween(e,t,(n,i)=>{this.callback(n,i)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}xm.mixin(Pm);class Pu extends de{constructor(){const e=ne(Pu.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new et({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Ct(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(de.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class oN extends de{constructor(){const e=ne(oN.getDefaults(),arguments);super(e),this.name="Destination",this.input=new Pu({context:this.context}),this.output=new et({context:this.context}),this.volume=this.input.volume,_a(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(de.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),_a(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}S0(s=>{s.destination=new oN({context:s})}),v0(s=>{s.destination.dispose()});class ghe extends de{constructor(){super(...arguments),this.name="Listener",this.positionX=new en({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new en({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new en({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new en({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new en({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new en({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new en({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new en({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new en({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(de.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}S0(s=>{s.listener=new ghe({context:s})}),v0(s=>{s.listener.dispose()});class N0 extends Mu{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=ne(N0.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++,this.add(t,e.urls[t],this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Nn,onload:Nn,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return st(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,0===this._loadingCount&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,n=Nn,i=Nn){return Ol(t)?(this.baseUrl&&"data:audio/"===t.trim().substring(0,11).toLowerCase()&&(this.baseUrl=""),this._buffers.set(e.toString(),new el(this.baseUrl+t,n,i))):this._buffers.set(e.toString(),new el(t,n,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class ci extends tr{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class mhe extends gr{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new ga,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;this._events.forEachBefore(e+this.anticipation,t=>{e-t.time<=this.expiration&&t.callback(),this._events.remove(t)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}S0(s=>{s.draw=new mhe({context:s})}),v0(s=>{s.draw.dispose()});class yhe extends Mu{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){st(wn(e.time),"Events must have a time property"),st(wn(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new _he(e.time,e.time+e.duration,e);for(null===this._root?this._root=t:this._root.insert(t),this._length++;null!==t;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(null!==this._root){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(e,t){null!==e.parent?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(null===e.left&&null===e.right)this._replaceNodeInParent(e,null);else if(null===e.right)this._replaceNodeInParent(e,e.left);else if(null===e.left)this._replaceNodeInParent(e,e.right);else{let n,i=null;if(e.getBalance()>0)if(null===e.left.right)n=e.left,n.right=e.right,i=n;else{for(n=e.left.right;null!==n.right;)n=n.right;n.parent&&(n.parent.right=n.left,i=n.parent,n.left=e.left,n.right=e.right)}else if(null===e.right.left)n=e.right,n.left=e.left,i=n;else{for(n=e.right.left;null!==n.left;)n=n.left;n.parent&&(n.parent.left=n.right,i=n.parent,n.left=e.left,n.right=e.right)}null!==e.parent?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),null!==t?n?t.left=i:t.right=i:this._setRoot(i)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),null!==t?n?t.left=i:t.right=i:this._setRoot(i)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(null!==this._root){const t=[];if(this._root.search(e,t),t.length>0){let n=t[0];for(let i=1;i<t.length;i++)t[i].low>n.low&&(n=t[i]);return n.event}}return null}forEach(e){if(null!==this._root){const t=[];this._root.traverse(n=>t.push(n)),t.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,t){if(null!==this._root){const n=[];this._root.search(e,n),n.forEach(i=>{i.event&&t(i.event)})}return this}forEachFrom(e,t){if(null!==this._root){const n=[];this._root.searchAfter(e,n),n.forEach(i=>{i.event&&t(i.event)})}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class _he{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?null===this.left?this.left=e:this.left.insert(e):null===this.right?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(null!==this.left&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&null!==this.right&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),null!==this.left&&this.left.searchAfter(e,t)),null!==this.right&&this.right.searchAfter(e,t)}traverse(e){e(this),null!==this.left&&this.left.traverse(e),null!==this.right&&this.right.traverse(e)}updateHeight(){this.height=null!==this.left&&null!==this.right?Math.max(this.left.height,this.right.height)+1:null!==this.right?this.right.height+1:null!==this.left?this.left.height+1:0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return null!==this.left&&null!==this.right?e=this.left.height-this.right.height:null!==this.left?e=this.left.height+1:null!==this.right&&(e=-(this.right.height+1)),e}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class bhe extends Mu{constructor(e){super(),this.name="TimelineValue",this._timeline=new ga({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class Qo extends de{constructor(){super(ne(Qo.getDefaults(),arguments,["context"]))}connect(e,t=0,n=0){return x0(this,e,t,n),this}}class Ll extends Qo{constructor(){const e=ne(Ll.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,Gr(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):function Xue(s){return"function"==typeof s}(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Gt.getDefaults(),{length:1024})}setMap(e,t=1024){const n=new Float32Array(t);for(let i=0,r=t;i<r;i++)n[i]=e(i/(r-1)*2-1,i);return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){st(["none","2x","4x"].some(n=>n.includes(e)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Rm extends Qo{constructor(){const e=ne(Rm.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new Ll({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Qo.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}let E0=(()=>{class s{constructor(t,n){this.id=s._eventId++,this._remainderTime=0;const i=Object.assign(s.getDefaults(),n);this.transport=t,this.callback=i.callback,this._once=i.once,this.time=Math.floor(i.time),this._remainderTime=i.time-this.time}static getDefaults(){return{callback:Nn,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(t){if(this.callback){const n=this.transport.bpm.getDurationOfTicks(1,t);this.callback(t+this._remainderTime*n),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}return s._eventId=0,s})();class aN extends E0{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(aN.getDefaults(),t);this.duration=n.duration,this._interval=n.interval,this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},E0.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return w0(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new ci(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){w0(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new ci(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);qf(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class I0 extends gr{constructor(){const e=ne(I0.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new bhe(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new ga,this._repeatedEvents=new yhe,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new Pm({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),Ct(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(gr.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(2*this._swingTicks)!=0){const i=Math.sin(t%(2*this._swingTicks)/(2*this._swingTicks)*Math.PI)*this._swingAmount;e+=new ci(this.context,2*this._swingTicks/3).toSeconds()*i}t3(!0),this._timeline.forEachAtTime(t,n=>n.invoke(e)),t3(!1)}schedule(e,t){const n=new E0(this,{callback:e,time:new tr(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,i=1/0){const r=new aN(this,{callback:e,duration:new ya(this.context,i).toTicks(),interval:new ya(this.context,t).toTicks(),time:new tr(this.context,n).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(e,t){const n=new E0(this,{callback:e,once:!0,time:new tr(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(t,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new ci(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let n;return this.context.resume(),wn(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),"started"!==this._clock.getStateAtTime(e)?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Gr(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new ya(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new ya(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new ci(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new ci(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(t),r=t+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t);this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),"started"!==this.state)return 0;{const t=this.now(),n=this.getTicksAtTime(t);return this._clock.nextTickTime(e-n%e,t)}}syncSignal(e,t){const n=this.now();let i=this.bpm,r=1/(60/i.getValueAtTime(n)/this.PPQ),o=[];if("time"===e.units){const l=.015625/r,c=new et(l),u=new Rm(-1),h=new et(l);i.chain(c,u,h),i=h,r=1/r,o=[c,u,h]}t||(t=0!==e.getValueAtTime(n)?e.getValueAtTime(n)/r:0);const a=new et(t);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.nodes.forEach(i=>i.dispose()),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Em(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}xm.mixin(I0),S0(s=>{s.transport=new I0({context:s})}),v0(s=>{s.transport.dispose()});class Ti extends de{constructor(e){super(e),this.input=void 0,this._state=new Mm("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Nn,this._syncedStop=Nn,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Pu({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Ct(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(de.getDefaults(),{mute:!1,onstop:Nn,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let i=Zo(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),this._synced||"started"!==this._state.getValueAtTime(i))if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const r=this._state.get(i);r&&(r.offset=this.toSeconds(Qa(t,0)),r.duration=n?this.toSeconds(n):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,n)},i);this._scheduled.push(o),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else QH(this.context),this._start(i,t,n);else st(qf(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,t,n);return this}stop(e){let t=Zo(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),"started"===this._state.getValueAtTime(t)||wn(this._state.getNextState("started",t))){if(this.log("stop",t),this._synced){const n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}else this._stop(t);this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),"started"===this._state.getValueAtTime(e)&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(qf(t,0)){const n=this._state.get(t);if(n&&"started"===n.state&&n.time!==t){const i=t-this.toSeconds(n.time);let r;n.duration&&(r=this.toSeconds(n.duration)-i),this._start(e,this.toSeconds(n.offset)+i,r)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));"started"===this._state.getValueAtTime(t)&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Nn,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class jf extends $f{constructor(){const e=ne(jf.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,Eo(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new en({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new el(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign($f.getDefaults(),{url:new el,loop:!1,loopEnd:0,loopStart:0,onload:Nn,onerror:Nn,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,i=1){st(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(e);this._startGain(r,i),t=Qa(t,this.loop?this.loopStart:0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,l=this.toSeconds(this.loopStart),c=a-l;tN(o,a)&&(o=(o-l)%c+l),Ka(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,w0(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,o)),wn(n)){let a=this.toSeconds(n);a=Math.max(a,0),this.stop(r+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function nd(s,e){return Is(this,void 0,void 0,function*(){const t=e/s.context.sampleRate,n=new T0(1,t,s.context.sampleRate);return new s.constructor(Object.assign(s.get(),{frequency:2/t,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}class M0 extends $f{constructor(){const e=ne(M0.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],Eo(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new en({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new en({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Ct(this,["frequency","detune"])}static getDefaults(){return Object.assign($f.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}let ho=(()=>{class s extends Ti{constructor(){const t=ne(s.getDefaults(),arguments,["frequency","type"]);super(t),this.name="Oscillator",this._oscillator=null,this.frequency=new Gt({context:this.context,units:"frequency",value:t.frequency}),Ct(this,"frequency"),this.detune=new Gt({context:this.context,units:"cents",value:t.detune}),Ct(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(Ti.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const n=this.toSeconds(t),i=new M0({context:this.context,onended:()=>this.onstop(this)});this._oscillator=i,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(n)}_stop(t){const n=this.toSeconds(t);this._oscillator&&this._oscillator.stop(n)}_restart(t){const n=this.toSeconds(t);return this.log("restart",n),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(n),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type)return s._periodicWaveCache.find(n=>n.phase===this._phase&&function rhe(s,e){return s.length===e.length&&s.every((t,n)=>e[n]===t)}(n.partials,this._partials));{const t=s._periodicWaveCache.find(n=>n.type===this._type&&n.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const n=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&n)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const i=this._getCachedPeriodicWave();if(wn(i)){const{partials:r,wave:o}=i;this._wave=o,this._partials=r,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[r,o]=this._getRealImaginary(t,this._phase),a=this.context.createPeriodicWave(r,o);this._wave=a,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),s._periodicWaveCache.push({imag:o,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:r,type:this._type,wave:this._wave}),s._periodicWaveCache.length>100&&s._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.type=this.partialCount&&"custom"!==this._type&&"custom"!==t?t+this.partialCount:t}get partialCount(){return this._partialCount}set partialCount(t){pr(t,0);let n=this._type;const i=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(i&&(n=i[1]),"custom"!==this._type)this.type=0===t?n:n+t.toString();else{const r=new Float32Array(t);this._partials.forEach((o,a)=>r[a]=o),this._partials=Array.from(r),this.type=this._type}}_getRealImaginary(t,n){let r=2048;const o=new Float32Array(r),a=new Float32Array(r);let l=1;if("custom"===t){if(l=this._partials.length+1,this._partialCount=this._partials.length,r=l,0===this._partials.length)return[o,a]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);c?(l=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),t=c[1],l=Math.max(l,2),r=l):this._partialCount=0,this._partials=[]}for(let c=1;c<r;++c){const u=2/(c*Math.PI);let h;switch(t){case"sine":h=c<=l?1:0,this._partials[c-1]=h;break;case"square":h=1&c?2*u:0,this._partials[c-1]=h;break;case"sawtooth":h=u*(1&c?1:-1),this._partials[c-1]=h;break;case"triangle":h=1&c?u*u*2*(c-1>>1&1?-1:1):0,this._partials[c-1]=h;break;case"custom":h=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==h?(o[c]=-h*Math.sin(n*c),a[c]=h*Math.cos(n*c)):(o[c]=0,a[c]=0)}return[o,a]}_inverseFFT(t,n,i){let r=0;const o=t.length;for(let a=0;a<o;a++)r+=t[a]*Math.cos(a*i)+n[a]*Math.sin(a*i);return r}getInitialValue(){const[t,n]=this._getRealImaginary(this._type,0);let i=0;const r=2*Math.PI;for(let a=0;a<32;a++)i=Math.max(this._inverseFFT(t,n,a/32*r),i);return function Qh(s,e,t){return Math.max(Math.min(s,t),e)}(-this._inverseFFT(t,n,this._phase)/i,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(){return Is(this,arguments,void 0,function*(t=1024){return nd(this,t)})}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}return s._periodicWaveCache=[],s})();class cN extends Qo{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Ll({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class ui extends Gt{constructor(){const e=ne(ui.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new et({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Gt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class P0 extends Ti{constructor(){const e=ne(P0.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new cN({context:this.context}),this._modulationNode=new et({context:this.context}),this._carrier=new ho({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ho({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new ui({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Ct(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ho.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Is(this,arguments,void 0,function*(e=1024){return nd(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Fm extends Ti{constructor(){const e=ne(Fm.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new et({context:this.context,gain:0}),this._carrier=new ho({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Gt({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new ho({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new ui({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new ui({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Ct(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ho.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Is(this,arguments,void 0,function*(e=1024){return nd(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Om extends Ti{constructor(){const e=ne(Om.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new et({context:this.context,gain:0}),this._thresh=new Ll({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new Gt({context:this.context,units:"audioRange",value:e.width}),this._triangle=new ho({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Ct(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Ti.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return Is(this,arguments,void 0,function*(e=1024){return nd(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class A0 extends Ti{constructor(){const e=ne(A0.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new Gt({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Gt({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,Ct(this,["frequency","detune"])}static getDefaults(){return Object.assign(ho.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,n=e/(this._oscillators.length-1);this._forEach((i,r)=>i.detune.value=t+n*r)}}get count(){return this._oscillators.length}set count(e){if(pr(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const n=new ho({context:this.context,volume:-6-1.1*e,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:0===t?()=>this.onstop(this):Nn});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,"started"===this.state&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,n)=>t.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(){return Is(this,arguments,void 0,function*(e=1024){return nd(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class R0 extends Ti{constructor(){const e=ne(R0.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new ui({context:this.context,value:2}),this._pulse=new Om({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ho({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Ct(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Ti.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return Is(this,arguments,void 0,function*(e=1024){return nd(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const u3={am:P0,fat:A0,fm:Fm,oscillator:ho,pulse:Om,pwm:R0};class Au extends Ti{constructor(){const e=ne(Au.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new Gt({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Gt({context:this.context,units:"cents",value:e.detune}),Ct(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(ho.getDefaults(),Fm.getDefaults(),P0.getDefaults(),A0.getDefaults(),Om.getDefaults(),R0.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){"fm"===e.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"am"===e.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"fat"===e.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):"pwm"===e?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===e?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=u3[e],n=this.now();if(this._oscillator){const i=this._oscillator;i.stop(n),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(t=this._oscillator.type),"fm"===e?this.type="fm"+t:"am"===e?this.type="am"+t:"fat"===e?this.type="fat"+t:"oscillator"===e?this.type=t:"pulse"===e?this.type="pulse":"pwm"===e&&(this.type="pwm")}_getOscType(e,t){return e instanceof u3[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&"pulse"!==e&&"pwm"!==e&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&fa(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&fa(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Ol(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return Is(this,arguments,void 0,function*(e=1024){return nd(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function h3(s,e=1/0){const t=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){pr(r,s,e),t.set(this,r)}})}}function Bc(s,e=1/0){const t=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(r){pr(this.toSeconds(r),s,e),t.set(this,r)}})}}class Lm extends Ti{constructor(){const e=ne(Lm.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new el({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Ti.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Nn,onerror:Nn,playbackRate:1,reverse:!1})}load(e){return Is(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=Nn){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),0===this._activeSources.size&&!this._synced&&"started"===this._state.getValueAtTime(this.now())&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){t=Qa(t,this._loop?this._loopStart:0);const i=this.toSeconds(t),r=n;n=Qa(n,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(n);o/=this._playbackRate,e=this.toSeconds(e);const a=new jf({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&Zo(r)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(t))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){var i;null===(i=[...this._activeSources].pop())||void 0===i||i.stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if("started"===this._state.getValueAtTime(n)){const i=this.toSeconds(e);this._stop(n),this._start(n,i)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&pr(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&pr(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}la([Bc(0)],Lm.prototype,"fadeIn",void 0),la([Bc(0)],Lm.prototype,"fadeOut",void 0);class Ur extends de{constructor(){const e=ne(Ur.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new Gt({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(de.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(Ol(e))return e;{let n;for(n in F0)if(F0[n][t]===e)return n;return e}}_setCurve(e,t,n){if(Ol(n)&&Reflect.has(F0,n)){const i=F0[n];Iu(i)?"_decayCurve"!==e&&(this[e]=i[t]):this[e]=i}else{if(!Gr(n)||"_decayCurve"===e)throw new Error("Envelope: invalid curve: "+n);this[e]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0&&(i=(1-o)/(1/i)),i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if("linear"===this._attackCurve)this._sig.linearRampTo(t,i,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let l=1;l<a.length;l++)if(a[l-1]<=o&&o<=a[l]){a=this._attackCurve.slice(l),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,t)}if(r&&this.sustain<1){const a=t*this.sustain,l=e+i;this.log("decay",l),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(a,r+l):this._sig.exponentialApproachValueAtTime(a,l,r)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,e):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,e):(st(Gr(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return x0(this,e,t,n),this}asArray(){return Is(this,arguments,void 0,function*(e=1024){const t=e/this.context.sampleRate,n=new T0(1,t,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),o=.1*r,a=r+o,l=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:n}));return l._sig.toDestination(),l.triggerAttackRelease(t*(i+o)/a,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}la([Bc(0)],Ur.prototype,"attack",void 0),la([Bc(0)],Ur.prototype,"decay",void 0),la([h3(0,1)],Ur.prototype,"sustain",void 0),la([Bc(0)],Ur.prototype,"release",void 0);const F0=(()=>{let e,t;const n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/127*(Math.PI/2));const i=[];for(e=0;e<127;e++){t=e/127;const d=Math.sin(t*(2*Math.PI)*6.4-Math.PI/2)+1;i[e]=d/10+.83*t}i[127]=1;const o=[];for(e=0;e<128;e++)o[e]=Math.ceil(e/127*5)/5;const l=[];for(e=0;e<128;e++)t=e/127,l[e]=.5*(1-Math.cos(Math.PI*t));const c=[];for(e=0;e<128;e++){t=e/127;const d=4*Math.pow(t,3)+.2,p=Math.cos(d*Math.PI*2*t);c[e]=Math.abs(p*(1-t))}function u(d){const p=new Array(d.length);for(let g=0;g<d.length;g++)p[g]=1-d[g];return p}return{bounce:{In:u(c),Out:c},cosine:{In:n,Out:function h(d){return d.slice(0).reverse()}(n)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:l,Out:u(l)},step:{In:o,Out:u(o)}}})();class wa extends de{constructor(){const e=ne(wa.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new Pu({context:this.context,volume:e.volume}),this.volume=this._volume.volume,Ct(this,"volume")}static getDefaults(){return Object.assign(de.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const n=this["_original_"+e]=this[e];this[e]=(...i)=>{const o=this.context.transport.schedule(a=>{i[t]=a,n.apply(this,i)},i[t]);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,n,i){const r=this.toSeconds(n),o=this.toSeconds(t);return this.triggerAttack(e,r,i),this.triggerRelease(r+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Cr extends wa{constructor(){const e=ne(Cr.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(wa.getDefaults(),{detune:0,onsilence:Nn,portamento:0})}triggerAttack(e,t,n=1){this.log("triggerAttack",e,t,n);const i=this.toSeconds(t);return this._triggerEnvelopeAttack(i,n),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const n=this.toSeconds(t),i=e instanceof No?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const r=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,r,n)}else this.frequency.setValueAtTime(i,n);return this}}la([Bc(0)],Cr.prototype,"portamento",void 0);class Vm extends Ur{constructor(){super(ne(Vm.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new et({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Vl extends Cr{constructor(){const e=ne(Vl.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new Au(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Vm(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),Ct(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Cr.getDefaults(),{envelope:Object.assign(kr(Ur.getDefaults(),Object.keys(de.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(kr(Au.getDefaults(),[...Object.keys(Ti.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),0===this.envelope.sustain){const n=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class V0 extends Vl{constructor(){const e=ne(V0.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,Ct(this,["oscillator","envelope"])}static getDefaults(){return pa(Cr.getDefaults(),Vl.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const n=this.toSeconds(t),i=this.toFrequency(e instanceof No?e.toFrequency():e);return this.oscillator.frequency.setValueAtTime(i*this.octaves,n),this.oscillator.frequency.exponentialRampToValueAtTime(i,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}la([h3(0)],V0.prototype,"octaves",void 0),la([Bc(0)],V0.prototype,"pitchDecay",void 0);const pN=new Set;function gN(s){pN.add(s)}function S3(s,e){pN.add(`registerProcessor("${s}", ${e})`)}gN('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n'),gN("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n"),gN("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");S3("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class U0 extends wa{constructor(){const e=ne(U0.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const t={};Object.keys(e.urls).forEach(n=>{const i=parseInt(n,10);if(st(_0(n)||fa(i)&&isFinite(i),`url key is neither a note or midi pitch: ${n}`),_0(n)){const r=new No(this.context,n).toMidi();t[r]=e.urls[n]}else fa(i)&&isFinite(i)&&(t[i]=e.urls[i])}),this._buffers=new N0({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(wa.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Nn,onerror:Nn,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach(i=>{const r=o3(new No(this.context,i).toFrequency()),o=Math.round(r),a=r-o,l=this._findClosest(o),u=this._buffers.get(o-l),h=Bm(l+a),d=new jf({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);d.start(t,0,u.duration/h,n),Gr(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const p=this._activeSources.get(o),g=p.indexOf(d);-1!==g&&p.splice(g,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(n=>{const i=new No(this.context,n).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const r=this._activeSources.get(i);t=this.toSeconds(t),r.forEach(o=>{o.stop(t)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,i=1){const r=this.toSeconds(n);return this.triggerAttack(e,r,i),Gr(t)?(st(Gr(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const l=t[Math.min(a,t.length-1)];this.triggerRelease(o,r+this.toSeconds(l))})):this.triggerRelease(e,r+this.toSeconds(t)),this}add(e,t,n){if(st(_0(e)||isFinite(e),`note must be a pitch or midi: ${e}`),_0(e)){const i=new No(this.context,e).toMidi();this._buffers.add(i,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}la([Bc(0)],U0.prototype,"attack",void 0),la([Bc(0)],U0.prototype,"release",void 0);class j0 extends de{constructor(){const e=ne(j0.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new en({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Ct(this,"pan")}static getDefaults(){return Object.assign(de.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}S3("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class ji extends de{constructor(){const e=ne(ji.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new et({context:this.context}),ji._allSolos.has(this.context)||ji._allSolos.set(this.context,new Set),ji._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(de.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),ji._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return 0===this.input.gain.value}_addSolo(){ji._soloed.has(this.context)||ji._soloed.set(this.context,new Set),ji._soloed.get(this.context).add(this)}_removeSolo(){ji._soloed.has(this.context)&&ji._soloed.get(this.context).delete(this)}_isSoloed(){return ji._soloed.has(this.context)&&ji._soloed.get(this.context).has(this)}_noSolos(){return!ji._soloed.has(this.context)||ji._soloed.has(this.context)&&0===ji._soloed.get(this.context).size}_updateSolo(){this.input.gain.value=this._isSoloed()||this._noSolos()?1:0}dispose(){return super.dispose(),ji._allSolos.get(this.context).delete(this),this._removeSolo(),this}}ji._allSolos=new Map,ji._soloed=new Map;class bN extends de{constructor(){const e=ne(bN.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new j0({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Pu({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Ct(this,["pan","volume"])}static getDefaults(){return Object.assign(de.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Kf extends de{constructor(){const e=ne(Kf.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new ji({solo:e.solo,context:this.context}),this._panVol=this.output=new bN({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Ct(this,["pan","volume"])}static getDefaults(){return Object.assign(de.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Kf.buses.has(e)||Kf.buses.set(e,new et({context:this.context})),Kf.buses.get(e)}send(e,t=0){const n=this._getBus(e),i=new et({context:this.context,units:"decibels",gain:t});return this.connect(i),i.connect(n),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}function h5(){return ma().now()}Kf.buses=new Map,ma(),ma(),ma(),ma(),ma(),ma();const d5=()=>({background:"#0d1a4a",color:"#fff",border:"2px solid #0d1a4a"}),f5=()=>({background:"#f9f9f9",color:"#111",border:"1px solid #bbb"}),Phe=()=>[];function Ahe(s,e){if(1&s){const t=Ys();Jr(),K(0,"rect",20),ht("click",function(){xt(t);const i=_e().$implicit;return Nt(_e(2).onCircleChordClick(i,"Diminished"))}),J()}if(2&s){const t=_e().index,n=_e(2);Fn("x",n.getCircleLabelPosition(t,180).x-18)("y",n.getCircleLabelPosition(t,180).y-18)("fill",n.diminishedCircle[t]===n.clickedCircleNote&&"Diminished"===n.getChordTypeForKey(n.clickedCircleNote)?"#0d1a4a":"#efefef")("stroke",n.diminishedCircle[t]===n.clickedCircleNote&&"Diminished"===n.getChordTypeForKey(n.clickedCircleNote)?"#fff":n.selectedFifthCircleColor)("transform","rotate("+n.getCircleRotation(t)+" "+n.getCircleLabelPosition(t,180).x+" "+n.getCircleLabelPosition(t,180).y+")")}}function Rhe(s,e){if(1&s){const t=Ys();Jr(),_h(0),qn(1,Ahe,1,5,"rect",18),K(2,"text",19),ht("click",function(){const i=xt(t).$implicit,r=_e(2);return Nt(r.isDiminishedChordInSequence(r.normalizeNote(i))?r.onCircleChordClick(i,"Diminished"):null)}),we(3),J(),iu()}if(2&s){const t=e.$implicit,n=e.index,i=_e(2);Q(),gt("ngIf",i.isDiminishedChordInSequence(i.normalizeNote(t))),Q(),Fn("x",i.getCircleLabelPosition(n,180).x)("y",i.getCircleLabelPosition(n,180).y)("fill",i.diminishedCircle[n]===i.clickedCircleNote&&"Diminished"===i.getChordTypeForKey(i.clickedCircleNote)?"#fff":"#0d1a4a")("stroke",i.diminishedCircle[n]===i.clickedCircleNote&&"Diminished"===i.getChordTypeForKey(i.clickedCircleNote)?"#fff":i.selectedFifthCircleColor),Q(),hr("",t,"\xb0")}}function Fhe(s,e){if(1&s){const t=Ys();Jr(),K(0,"rect",24),ht("click",function(){xt(t);const i=_e().index,r=_e(2);return Nt(r.onCircleChordClick(r.circleOfFifthsMinors[i],"Minor"))}),J()}if(2&s){const t=_e().index,n=_e(2);Fn("x",n.getCircleLabelPosition(t,80).x-18)("y",n.getCircleLabelPosition(t,80).y-18)("fill",n.circleOfFifthsMinors[t]===n.clickedCircleNote&&"Minor"===n.getChordTypeForKey(n.clickedCircleNote)?"#0d1a4a":"#efefef")("stroke",n.circleOfFifthsMinors[t]===n.clickedCircleNote&&"Minor"===n.getChordTypeForKey(n.clickedCircleNote)?"#0d1a4a":n.selectedFifthCircleColor)("transform","rotate("+n.getCircleRotation(t)+" "+n.getCircleLabelPosition(t,80).x+" "+n.getCircleLabelPosition(t,80).y+")")}}function Ohe(s,e){if(1&s){const t=Ys();Jr(),K(0,"rect",25),ht("click",function(){xt(t);const i=_e().$implicit,r=_e(2);return Nt(r.onCircleChordClick(r.normalizeNote(i)))}),J()}if(2&s){const t=_e(),n=t.$implicit,i=t.index,r=_e(2);Fn("x",r.getCircleLabelPosition(i,135).x-(r.normalizeNote(n)===r.selectedNote?28:22))("y",r.getCircleLabelPosition(i,135).y-(r.normalizeNote(n)===r.selectedNote?28:22))("width",r.normalizeNote(n)===r.selectedNote?56:44)("height",r.normalizeNote(n)===r.selectedNote?56:44)("fill",r.normalizeNote(n)===r.clickedCircleNote&&"Minor"!==r.getChordTypeForKey(r.clickedCircleNote)?"#0d1a4a":"#efefef")("stroke",r.normalizeNote(n)===r.clickedCircleNote&&"Minor"!==r.getChordTypeForKey(r.clickedCircleNote)?"#0d1a4a":r.selectedFifthCircleColor)("stroke-width",n===r.selectedNote?4:2)("transform","rotate("+r.getCircleRotation(i)+" "+r.getCircleLabelPosition(i,135).x+" "+r.getCircleLabelPosition(i,135).y+")")}}function Lhe(s,e){if(1&s&&(Jr(),_h(0),qn(1,Fhe,1,5,"rect",21),Xi(2,"line",22),qn(3,Ohe,1,8,"rect",23),iu()),2&s){const t=e.$implicit,n=e.index,i=_e(2);Q(),gt("ngIf",i.isMinorChordInSequence(i.circleOfFifthsMinors[n])||i.circleOfFifthsMinors[n]===i.clickedCircleNote&&"Minor"===i.getChordTypeForKey(i.clickedCircleNote)),Q(),Fn("x1",200)("y1",200)("x2",i.getCircleLabelPosition(n+.5,200).x)("y2",i.getCircleLabelPosition(n+.5,200).y),Q(),gt("ngIf",i.normalizeNote(t)===i.selectedNote||i.isChordSequenceKey(t)||i.normalizeNote(t)===i.clickedCircleNote&&"Minor"!==i.getChordTypeForKey(i.clickedCircleNote))}}function Vhe(s,e){if(1&s&&(Jr(),_h(0),Xi(1,"line",26),iu()),2&s){const t=e.index,n=_e(2);Q(),Fn("x1",n.getCircleLabelPosition(t).x)("y1",n.getCircleLabelPosition(t).y)("x2",n.getCircleLabelPosition(t,110).x)("y2",n.getCircleLabelPosition(t,110).y)}}function Hhe(s,e){if(1&s&&(Jr(),K(0,"text",30),we(1),J()),2&s){const t=_e(),n=t.$implicit,i=t.index,r=_e(2);Fn("x",r.getCircleLabelPosition(i,135).x)("y",r.getCircleLabelPosition(i,135).y+20),Q(),hr("",r.getChordTypeForKey(r.normalizeNote(n))," ")}}function Whe(s,e){if(1&s){const t=Ys();Jr(),_h(0),K(1,"text",27),ht("click",function(){const i=xt(t).$implicit,r=_e(2);return Nt(r.onCircleChordClick(r.normalizeNote(i)))}),we(2),J(),qn(3,Hhe,2,3,"text",28),K(4,"text",29),ht("click",function(){const i=xt(t).index,r=_e(2);return Nt(r.onCircleChordClick(r.normalizeNote(r.circleOfFifthsMinors[i]),"Minor"))}),we(5),J(),iu()}if(2&s){const t=e.$implicit,n=e.index,i=_e(2);Q(),Fn("x",i.getCircleLabelPosition(n,135).x)("y",i.getCircleLabelPosition(n,135).y)("font-size",i.normalizeNote(t)===i.selectedNote?36:i.isChordSequenceKey(t)?28:20)("fill",i.normalizeNote(t)===i.clickedCircleNote&&"Minor"!==i.getChordTypeForKey(i.clickedCircleNote)?"#fff":i.normalizeNote(t)===i.selectedNote?i.selectedFifthCircleColor:i.isChordSequenceKey(i.normalizeNote(t))?"#e91e63":"#333")("font-weight",i.normalizeNote(t)===i.selectedNote||i.isChordSequenceKey(i.normalizeNote(t))?"900":"bold")("stroke",i.normalizeNote(t)===i.clickedCircleNote&&"Minor"!==i.getChordTypeForKey(i.clickedCircleNote)?"#fff":i.normalizeNote(t)===i.selectedNote?i.selectedFifthCircleColor:i.isChordSequenceKey(i.normalizeNote(t))?"#fff":"none")("stroke-width",i.normalizeNote(t)===i.selectedNote?2:i.isChordSequenceKey(i.normalizeNote(t))?1:0),Q(),vo(t),Q(),gt("ngIf",i.isChordSequenceKey(i.normalizeNote(t))),Q(),Fn("x",i.getCircleLabelPosition(n,80).x)("y",i.getCircleLabelPosition(n,80).y)("fill",i.circleOfFifthsMinors[n]===i.clickedCircleNote&&"Minor"===i.getChordTypeForKey(i.clickedCircleNote)?"#fff":i.chordSequenceNotes.includes(i.circleOfFifthsMinors[n])?i.selectedFifthCircleColor:"#0077aa")("font-weight",i.chordSequenceNotes.includes(i.circleOfFifthsMinors[n])?"900":"normal")("stroke",i.circleOfFifthsMinors[n]===i.clickedCircleNote&&"Minor"===i.getChordTypeForKey(i.clickedCircleNote)||i.chordSequenceNotes.includes(i.circleOfFifthsMinors[n])?"#fff":"none")("stroke-width",i.circleOfFifthsMinors[n]===i.clickedCircleNote&&"Minor"===i.getChordTypeForKey(i.clickedCircleNote)||i.chordSequenceNotes.includes(i.circleOfFifthsMinors[n])?1:0),Q(),vo(i.circleOfFifthsMinors[n])}}function Ghe(s,e){if(1&s){const t=Ys();K(0,"div",8)(1,"div",9)(2,"button",10),ht("click",function(){return xt(t),Nt(_e().advanceSelectedNoteInNotesArray(-1))}),we(3,"\u2190 Previous Note"),J(),K(4,"span",11),we(5),J(),K(6,"button",10),ht("click",function(){return xt(t),Nt(_e().advanceSelectedNoteInNotesArray(1))}),we(7,"Next Note \u2192"),J()(),K(8,"div",12),Jr(),K(9,"svg",13)(10,"g"),qn(11,Rhe,4,6,"ng-container",14),J(),Xi(12,"circle",15)(13,"circle",16)(14,"circle",17),K(15,"g"),qn(16,Lhe,4,6,"ng-container",14),J(),K(17,"g"),qn(18,Vhe,2,4,"ng-container",14),J(),K(19,"g"),qn(20,Whe,6,16,"ng-container",14),J()()()()}if(2&s){const t=_e();Q(5),vo(t.selectedNote),Q(6),gt("ngForOf",t.diminishedCircle),Q(5),gt("ngForOf",t.circleOfFifths),Q(2),gt("ngForOf",t.circleOfFifths),Q(2),gt("ngForOf",t.circleOfFifths)}}function Uhe(s,e){if(1&s&&(K(0,"option",45),we(1),J()),2&s){const t=e.$implicit;gt("value",t),Q(),vo(t)}}function zhe(s,e){if(1&s&&(K(0,"option",45),we(1),J()),2&s){const t=e.$implicit;gt("value",t.key),Q(),vo(t.key)}}function qhe(s,e){if(1&s){const t=Ys();K(0,"div",32)(1,"label",46),we(2,"Chord:"),J(),K(3,"select",47),Go("ngModelChange",function(i){xt(t);const r=_e(2);return aa(r.selectedChord,i)||(r.selectedChord=i),Nt(i)}),qn(4,zhe,2,2,"option",39),Tk(5,"keyvalue"),J()()}if(2&s){const t=_e(2);Q(3),Wo("ngModel",t.selectedChord),Q(),gt("ngForOf",kk(5,2,t.chordFormulas))}}function $he(s,e){if(1&s&&(K(0,"option",45),we(1),J()),2&s){const t=e.$implicit;gt("value",t.key),Q(),vo(t.key)}}function jhe(s,e){if(1&s){const t=Ys();K(0,"div",32)(1,"label",48),we(2,"Scale:"),J(),K(3,"select",49),Go("ngModelChange",function(i){xt(t);const r=_e(2);return aa(r.selectedScale,i)||(r.selectedScale=i),Nt(i)}),qn(4,$he,2,2,"option",39),Tk(5,"keyvalue"),J()()}if(2&s){const t=_e(2);Q(3),Wo("ngModel",t.selectedScale),Q(),gt("ngForOf",kk(5,2,t.scaleFormulas))}}function Yhe(s,e){if(1&s){const t=Ys();K(0,"label")(1,"input",50),ht("change",function(){const i=xt(t).$implicit;return Nt(_e(2).toggleCAGEDShape(i))}),J(),we(2),J()}if(2&s){const t=e.$implicit,n=_e(2);Q(),gt("checked",n.selectedCAGEDShapes.includes(t)),Q(),hr(" ",t," Shape ")}}function Xhe(s,e){if(1&s){const t=Ys();K(0,"div",31)(1,"div",32)(2,"label")(3,"input",33),Go("ngModelChange",function(i){xt(t);const r=_e();return aa(r.showOtherNotes,i)||(r.showOtherNotes=i),Nt(i)}),J(),we(4," All Notes "),J()(),K(5,"div",34)(6,"label")(7,"input",35),Go("ngModelChange",function(i){xt(t);const r=_e();return aa(r.handedness,i)||(r.handedness=i),Nt(i)}),J(),we(8," Right-handed "),J(),K(9,"label")(10,"input",36),Go("ngModelChange",function(i){xt(t);const r=_e();return aa(r.handedness,i)||(r.handedness=i),Nt(i)}),J(),we(11," Left-handed "),J()(),K(12,"div",32)(13,"label",37),we(14,"Note:"),J(),K(15,"select",38),Go("ngModelChange",function(i){xt(t);const r=_e();return aa(r.selectedNote,i)||(r.selectedNote=i),Nt(i)}),qn(16,Uhe,2,2,"option",39),J()(),K(17,"div",34)(18,"label")(19,"input",40),Go("ngModelChange",function(i){xt(t);const r=_e();return aa(r.displayMode,i)||(r.displayMode=i),Nt(i)}),J(),we(20," Chord "),J(),K(21,"label")(22,"input",41),Go("ngModelChange",function(i){xt(t);const r=_e();return aa(r.displayMode,i)||(r.displayMode=i),Nt(i)}),J(),we(23," Scale "),J()(),qn(24,qhe,6,4,"div",42)(25,jhe,6,4,"div",42),K(26,"button",43),ht("click",function(){return xt(t),Nt(_e().play())}),we(27),J(),K(28,"div",44),qn(29,Yhe,3,2,"label",14),J()()}if(2&s){const t=_e();Q(3),Wo("ngModel",t.showOtherNotes),Q(4),Wo("ngModel",t.handedness),Q(3),Wo("ngModel",t.handedness),Q(5),Wo("ngModel",t.selectedNote),Q(),gt("ngForOf",t.notes),Q(3),Wo("ngModel",t.displayMode),Q(3),Wo("ngModel",t.displayMode),Q(2),gt("ngIf","Chord"===t.displayMode),Q(),gt("ngIf","Scale"===t.displayMode),Q(2),hr("Play ",t.displayMode),Q(2),gt("ngForOf",t.cagedShapes)}}function Jhe(s,e){if(1&s&&(K(0,"th",53),we(1),J()),2&s){const t=e.index;Q(),hr(" ",t+1," ")}}function Zhe(s,e){if(1&s){const t=Ys();K(0,"td",55)(1,"button",64),ht("click",function(){const i=xt(t),r=i.$implicit,o=i.index,a=_e(2);return a.toggleChordOnFretboard(r),Nt(a.activeChordIndex=o)}),K(2,"strong"),we(3),J(),we(4),J()()}if(2&s){const t=e.$implicit,n=e.index,i=_e(2);Q(),br("active",i.activeChordIndex===n),gt("ngStyle",i.activeChordIndex===n?nf(5,d5):nf(6,f5)),Q(2),vo(t.note),Q(),hr(" ",t.chord," ")}}function Qhe(s,e){if(1&s){const t=Ys();K(0,"td",55)(1,"button",64),ht("click",function(){const i=xt(t),r=i.$implicit,o=i.index,a=_e(2);return a.toggleBorrowedChordOnFretboard(r),Nt(a.activeBorrowedChordIndex=o)}),K(2,"strong"),we(3),J(),we(4),J()()}if(2&s){const t=e.$implicit,n=e.index,i=_e(2);Q(),br("active",i.activeBorrowedChordIndex===n),gt("ngStyle",i.activeBorrowedChordIndex===n?nf(5,d5):nf(6,f5)),Q(2),vo(t.note),Q(),hr(" ",t.chord," ")}}function Khe(s,e){if(1&s){const t=Ys();K(0,"button",65),ht("click",function(){return xt(t),Nt(_e(2).stopChordSequence())}),we(1,"Stop Sequence"),J()}}function ede(s,e){if(1&s&&(K(0,"div",66)(1,"span"),we(2),J()()),2&s){const t=_e(2);Q(2),hr("Next chord in: ",t.countdown,"s")}}function tde(s,e){if(1&s){const t=Ys();K(0,"div")(1,"div",51)(2,"table",52)(3,"thead")(4,"tr")(5,"th",53),we(6,"Reset"),J(),Xi(7,"th",53),qn(8,Jhe,2,1,"th",54),J()(),K(9,"tbody")(10,"tr")(11,"td",55)(12,"button",56),ht("click",function(){return xt(t),Nt(_e().resetChordSequence())}),K(13,"strong"),we(14,"Reset"),J()()(),K(15,"td"),we(16),J(),qn(17,Zhe,5,7,"td",57),J(),K(18,"tr")(19,"td",55)(20,"button",56),ht("click",function(){return xt(t),Nt(_e().resetBorrowedChordSequence())}),K(21,"strong"),we(22,"Reset"),J()()(),K(23,"td"),we(24),J(),qn(25,Qhe,5,7,"td",57),J()()(),K(26,"div",58)(27,"label",59),we(28,"Sequence Interval:"),J(),K(29,"select",60),Go("ngModelChange",function(i){xt(t);const r=_e();return aa(r.sequenceInterval,i)||(r.sequenceInterval=i),Nt(i)}),K(30,"option",45),we(31,"5 second"),J(),K(32,"option",45),we(33,"10 seconds"),J(),K(34,"option",45),we(35,"30 seconds"),J(),K(36,"option",45),we(37,"1 minute"),J()(),K(38,"button",61),ht("click",function(){return xt(t),Nt(_e().playChordSequence())}),we(39,"Play Sequence"),J(),qn(40,Khe,2,0,"button",62)(41,ede,3,1,"div",63),J()()()}if(2&s){const t=_e();Q(8),gt("ngForOf",t.getChordSequence()),Q(4),br("active",null===t.activeChordIndex),Q(4),H_("",t.selectedNote,"-",t.selectedScale),Q(),gt("ngForOf",t.getChordSequence()),Q(3),br("active",null===t.activeBorrowedChordIndex),Q(4),H_("",t.selectedNote,"-",t.parallelScales[t.selectedScale]),Q(),gt("ngForOf",t.getBorrowedChordSequence()),Q(4),Wo("ngModel",t.sequenceInterval),Q(),gt("value",5e3),Q(2),gt("value",1e4),Q(2),gt("value",3e4),Q(2),gt("value",6e4),Q(2),gt("disabled",t.isSequencePlaying),Q(2),gt("ngIf",t.isSequencePlaying),Q(),gt("ngIf",t.isSequencePlaying)}}function nde(s,e){1&s&&(K(0,"div"),Xi(1,"div",73),K(2,"p"),we(3,"Loading, please wait..."),J()())}function sde(s,e){if(1&s){const t=Ys();K(0,"li",74)(1,"span",75),we(2),J(),K(3,"button",76),ht("click",function(){const i=xt(t).$implicit;return Nt(_e(3).connectToDevice(i))}),we(4," Connect "),J()()}if(2&s){const t=e.$implicit;Q(2),vo(t.name||"Unnamed Device")}}function ide(s,e){if(1&s&&(K(0,"ul",71),qn(1,nde,4,0,"div",5)(2,sde,5,1,"li",72),J()),2&s){const t=_e(2);Q(),gt("ngIf",t.isLoading),Q(),gt("ngForOf",t.bluetoothDevices)}}function rde(s,e){if(1&s){const t=Ys();K(0,"div",77)(1,"p"),we(2),K(3,"button",68),ht("click",function(){return xt(t),Nt(_e(2).disconnectDevice())}),we(4,"Disconnect"),J()(),K(5,"button",78),ht("click",function(){return xt(t),Nt(_e(2).sendDisplayedNotesToBluetooth())}),we(6," Send Displayed Notes to Guitar "),J(),K(7,"button",78),ht("click",function(){return xt(t),Nt(_e(2).sendDisplayedNotesToBluetoothUsingDataset())}),we(8," Send Displayed Notes to Guitar (Dataset) "),J(),K(9,"button",78),ht("click",function(){return xt(t),Nt(_e(2).reset())}),we(10," reset "),J()()}if(2&s){const t=_e(2);Q(2),hr("Connected to: ",t.connectedDevice.name," ")}}function ode(s,e){if(1&s){const t=Ys();K(0,"div",67)(1,"button",68),ht("click",function(){return xt(t),Nt(_e().discoverDevices())}),we(2,"Discover Devices"),J(),qn(3,ide,3,2,"ul",69)(4,rde,11,1,"div",70),J()}if(2&s){const t=_e();Q(3),gt("ngIf",!t.connectedDevice),Q(),gt("ngIf",null!=t.connectedDevice)}}function ade(s,e){1&s&&(K(0,"div"),Xi(1,"guitar-pro"),J())}function lde(s,e){if(1&s&&(Jr(),Xi(0,"line",85)),2&s){const t=_e().index,n=_e(2);Fn("x1",45*t)("y1",0)("x2",45*t)("y2",n.fretboardHeight)}}function cde(s,e){if(1&s&&(Jr(),K(0,"g"),qn(1,lde,1,4,"line",84),J()),2&s){const t=e.index;Q(),gt("ngIf",t>0)}}function ude(s,e){if(1&s){const t=Ys();Jr(),K(0,"g")(1,"g",87),ht("click",function(){const i=xt(t),r=i.$implicit,o=i.index,a=_e().index;return Nt(_e(2).playNote(r.note,a,o))}),Xi(2,"circle"),K(3,"text",88),we(4),J()()()}if(2&s){const t=e.$implicit,n=e.index,i=_e().index,r=_e(2);Q(2),Fn("cx",45*n+22)("cy",50*i+25)("r",t.isPartOfChordOrScale?18:12)("fill",t.isAnimated?"#00ff00":t.isPartOfSelectedChord?"#001199":t.isPartOfSelectedBorrowedChord?"green":t.isPartOfCAGEDShape?"rgba(0,0,255,0.1)":t.isRootNote?"#ff5733":t.isPartOfChordOrScale?"#ffcc00":"#eee")("stroke",t.isAnimated?"#00ff00":t.isPartOfSelectedChord?"#001199":t.isPartOfSelectedBorrowedChord?"green":t.isPartOfCAGEDShape?"rgba(0,0,255,0.1)":t.isRootNote?"#ff5733":t.isPartOfChordOrScale?"#ffcc00":"#fff")("stroke-width",2)("opacity",t.isPartOfSelectedChord||t.isPartOfSelectedChord||t.isPartOfChordOrScale||r.showOtherNotes?1:0),Q(),Fn("x",45*n+22)("y",50*i+30)("font-size",t.isPartOfChordOrScale?14:12)("font-family","Helvetica")("fill",t.isRootNote||t.isPartOfSelectedChord?"#fff":"#333")("opacity",t.isPartOfChordOrScale||t.isPartOfSelectedChord?1:r.showOtherNotes?.3:0),Q(),hr(" ",t.note," ")}}function hde(s,e){if(1&s&&(Jr(),K(0,"g"),Xi(1,"line",86),qn(2,ude,5,14,"g",14),J()),2&s){const t=e.$implicit,n=e.index,i=_e(2);Q(),Fn("x1",0)("y1",50*n+25)("x2",45*i.renderFretboard()[0].length)("y2",50*n+25),Q(),gt("ngForOf",t)}}function dde(s,e){if(1&s&&(K(0,"div",79),Jr(),K(1,"svg",80),Xi(2,"rect",81)(3,"rect",82)(4,"circle",83)(5,"circle",83)(6,"circle",83)(7,"circle",83)(8,"circle",83)(9,"circle",83)(10,"circle",83)(11,"circle",83)(12,"circle",83)(13,"circle",83),qn(14,cde,2,1,"g",14)(15,hde,3,5,"g",14),J()()),2&s){const t=_e();Q(),Fn("width",t.fretboardWidth)("height",t.fretboardHeight)("viewBox","0 0 "+t.fretboardWidth+" "+t.fretboardHeight),Q(),Fn("width",t.fretboardWidth)("height",t.fretboardHeight),Q(),Fn("height",t.fretboardHeight),Q(),Fn("cx",157)("cy",t.fretboardHeight/2),Q(),Fn("cx",247)("cy",t.fretboardHeight/2),Q(),Fn("cx",337)("cy",t.fretboardHeight/2),Q(),Fn("cx",427)("cy",t.fretboardHeight/2),Q(),Fn("cx",562)("cy",t.fretboardHeight/2-14),Q(),Fn("cx",562)("cy",t.fretboardHeight/2+14),Q(),Fn("cx",697)("cy",t.fretboardHeight/2),Q(),Fn("cx",787)("cy",t.fretboardHeight/2),Q(),Fn("cx",877)("cy",t.fretboardHeight/2),Q(),Fn("cx",967)("cy",t.fretboardHeight/2),Q(),gt("ngForOf",nf(28,Phe).constructor(t.renderFretboard()[0].length)),Q(),gt("ngForOf",t.renderFretboard())}}let fde=(()=>{class s{smartLightBluetoothService;ngZone;cdr;isLoading;bluetoothDevices=[];connectedDevice=null;subscription;sendDisplayedNotesToBluetooth(){var t=this;return Ae(function*(){const n=t.getDisplayedNotes(),i=t.notes;for(const r of i){const o=n.includes(r);console.log("Sending note to Bluetooth:",r,"isOn:",o),yield t.smartLightBluetoothService.setLedByNote(r,o)}})()}sendDisplayedNotesToBluetoothUsingDataset(){var t=this;return Ae(function*(){const n=t.getDisplayedNotes();yield t.smartLightBluetoothService.sendDataSet(n)})()}constructor(t,n,i){this.smartLightBluetoothService=t,this.ngZone=n,this.cdr=i,this.isLoading=!1}discoverDevices(){var t=this;return Ae(function*(){t.isLoading=!0,t.bluetoothDevices=[];try{(yield t.smartLightBluetoothService.discoverDevices()).map(n=>{t.ngZone.run(()=>{t.bluetoothDevices.push(n),t.isLoading=!1})})}catch{t.bluetoothDevices=[]}finally{t.isLoading=!1}})()}connectToDevice(t){var n=this;return Ae(function*(){n.isLoading=!0,n.connectedDevice=null;try{yield n.smartLightBluetoothService.connectToDevice(t),n.ngZone.run(()=>{n.connectedDevice=t,n.isLoading=!1})}catch{n.connectedDevice=null}finally{n.isLoading=!1}})()}disconnectDevice(){this.smartLightBluetoothService.disconnectDevice(),this.connectedDevice?console.log("Disconnected from device:",this.connectedDevice.name):console.log("Disconnected from device: (no device was connected)"),this.connectedDevice=null}advanceSelectedNoteInNotesArray(t=1){let i=(this.notes.indexOf(this.selectedNote)+t+this.notes.length)%this.notes.length;this.selectedNote=this.notes[i],this.sendDisplayedNotesToBluetooth()}getCircleRotation(t){return 30*(t-this.circleOfFifths.indexOf(this.normalizeNote(this.selectedNote)))-90}parallelScales={Major:"Minor",Minor:"Major",PentatonicMajor:"PentatonicMinor",PentatonicMinor:"PentatonicMajor",Blues:"Blues",HarmonicMinor:"Major",MelodicMinor:"Major",Dorian:"Mixolydian",Mixolydian:"Dorian",Phrygian:"Lydian",Lydian:"Phrygian",Locrian:"Locrian",Chromatic:"Chromatic"};isDiminishedChordInSequence(t){return this.chordSequenceFull.some(n=>this.normalizeNote(n.note)===this.normalizeNote(t)&&n.chord&&n.chord.toLowerCase().includes("diminished"))}diminishedCircle=["B","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E"];clickedCircleNote=null;ngOnInit(){this.subscription=this.smartLightBluetoothService.connectedDevice$.subscribe(t=>{this.connectedDevice=t})}ngOnChanges(){"circlefifths"===this.activeTab&&(this.displayMode="Scale",this.selectedScale="Major")}isMinorChordInSequence(t){return this.chordSequenceFull.some(n=>this.normalizeNote(n.note)===t&&n.chord&&n.chord.toLowerCase().includes("minor"))}onCircleChordClick(t,n){if(this.clickedCircleNote===t&&(!n||n===this.getChordTypeForKey(t)))return this.clickedCircleNote=null,void this.clearChordOnFretboard();const i=n||this.getChordTypeForKey(t)||"Major";this.displayChordOnFretboard({note:t,chord:i}),this.clickedCircleNote=t}clearChordOnFretboard(){this.selectedChordNotes=[]}circleOfFifthsMinors=["A","E","B","Gb","Db","Ab","Eb","Bb","F","C","G","D"];circleOfFifths=["C","G","D","A","E","B","Gb","Db","Ab","Eb","Bb","F"];normalizeNote(t){return{Db:"C#","C#":"Db",Eb:"D#","D#":"Eb",Gb:"F#","F#":"Gb",Ab:"G#","G#":"Ab",Bb:"A#","A#":"Bb"}[t]||t}isChordSequenceKey(t){return this.chordSequenceFull.some(n=>this.normalizeNote(n.note)===t)}getChordTypeForKey(t){const n=this.chordSequenceFull.find(i=>this.normalizeNote(i.note)===t);return n?n.chord:""}get chordSequenceFull(){return this.getChordSequence()}get chordSequenceNotes(){return this.getChordSequence().map(t=>t.note)}getCircleLabelPosition(t,n=140){const i=this.circleOfFifths.indexOf(this.normalizeNote(this.selectedNote)),o=(30*(t-(i>=0?i:0))-90)*Math.PI/180;return{x:200+n*Math.cos(o),y:200+n*Math.sin(o)}}showOtherNotes=!1;sequenceIntervalId=null;countdown=0;sequenceInterval=5e3;_activeTab="controls";get activeTab(){return this._activeTab}set activeTab(t){this._activeTab=t,"circlefifths"===t&&(this.displayMode="Scale",this.selectedScale="Major"),"chordseq"===t&&(this.displayMode="Scale")}fretMarkers=[1,3,5,7,9,12,15,17,19,21,23];handedness="right";notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];_selectedNote="C";_selectedChord="Major";_selectedScale="Major";get selectedNote(){return this._selectedNote}set selectedNote(t){this._selectedNote=t,this.sendDisplayedNotesToBluetoothUsingDataset()}get selectedChord(){return this._selectedChord}set selectedChord(t){this._selectedChord=t,this.sendDisplayedNotesToBluetoothUsingDataset()}get selectedScale(){return this._selectedScale}set selectedScale(t){this._selectedScale=t,this.sendDisplayedNotesToBluetoothUsingDataset()}displayMode="Chord";animatedNotes=[];clickedNote=null;cagedShapes=["C","A","G","E","D"];selectedCAGEDShapes=[];displayedChordNotes=[];selectedChordNotes=[];selectedBorrowedChordNotes=[];isSequencePlaying=!1;activeChordIndex=null;activeBorrowedChordIndex=null;ischordActive=!1;selectedFifthCircleColor="#c47e7eff";strings=[this.generateString("E"),this.generateString("A"),this.generateString("D"),this.generateString("G"),this.generateString("B"),this.generateString("E")];getDisplayedNotes(){return"Chord"===this.displayMode?this.getChordNotes():this.getScaleNotes()}getCAGEDShapes(){return this.notes.indexOf(this.selectedNote),this.getDisplayedNotes(),[{shape:"C",intervals:[-1,3,2,0,1,0],rootString:5},{shape:"A",intervals:[0,0,2,2,2,0],rootString:2},{shape:"G",intervals:[3,2,0,0,0,3],rootString:4},{shape:"E",intervals:[0,2,2,1,0,0],rootString:6},{shape:"D",intervals:[-1,0,0,2,3,2],rootString:3}].map(r=>{const o=this.selectedNote,l=this.strings[r.rootString-1].findIndex(h=>h===o),c=l>=0&&"C"!==r.shape?l:l-1,u=r.intervals.map(h=>-1===h?-1:h+c);return{shape:r.shape,frets:u}})}getFilteredCAGEDShapes(){return this.getCAGEDShapes().filter(n=>this.selectedCAGEDShapes.includes(n.shape))}toggleCAGEDShape(t){this.selectedCAGEDShapes.includes(t)?this.selectedCAGEDShapes=this.selectedCAGEDShapes.filter(n=>n!==t):this.selectedCAGEDShapes.push(t)}generateString(t){const n=this.notes.indexOf(t),i=[];for(let r=0;r<24;r++)i.push(this.notes[(n+r)%12]);return i}chordFormulas={Major:[0,4,7],Minor:[0,3,7],Seventh:[0,4,7,10],MinorSeventh:[0,3,7,10],MajorSeventh:[0,4,7,11],Augmented:[0,4,8],Diminished:[0,3,6],Suspended2:[0,2,7],Suspended4:[0,5,7],Dim7:[0,3,6,9],HalfDim7:[0,3,6,10],Augmented7:[0,4,8,10],MinorMajor7:[0,3,7,11],Add9:[0,4,7,14],MinorAdd9:[0,3,7,14],Sixth:[0,4,7,9],MinorSixth:[0,3,7,9]};scaleFormulas={Major:[0,2,4,5,7,9,11],Minor:[0,2,3,5,7,8,10],PentatonicMajor:[0,2,4,7,9],PentatonicMinor:[0,3,5,7,10],Blues:[0,3,5,6,7,10],HarmonicMinor:[0,2,3,5,7,8,11],MelodicMinor:[0,2,3,5,7,9,11],Dorian:[0,2,3,5,7,9,10],Phrygian:[0,1,3,5,7,8,10],Lydian:[0,2,4,6,7,9,11],Mixolydian:[0,2,4,5,7,9,10],Locrian:[0,1,3,5,6,8,10],Chromatic:[0,1,2,3,4,5,6,7,8,9,10,11]};chordMappings={Major:["Major","Minor","Minor","Major","Major","Minor","Diminished","sus2","sus4","add9","add7","Major7","Minor7"],Minor:["Minor","Diminished","Major","Minor","Minor","Major","Major","sus2","sus4","add9","add7","Minor7","Diminished7"],PentatonicMajor:["Major","Major","Major","Major","Major"],PentatonicMinor:["Minor","Minor","Minor","Minor","Minor"],Blues:["Minor","Minor","Minor","Minor","Minor","Minor"],HarmonicMinor:["Minor","Diminished","Augmented","Minor","Major","Major","Diminished"],MelodicMinor:["Minor","Minor","Augmented","Major","Major","Diminished","Diminished"],Dorian:["Minor","Minor","Major","Major","Minor","Diminished","Major"],Phrygian:["Minor","Minor","Major","Major","Minor","Major","Major"],Lydian:["Major","Major","Minor","Diminished","Major","Minor","Minor"],Mixolydian:["Major","Minor","Diminished","Major","Minor","Minor","Major"],Locrian:["Diminished","Minor","Major","Minor","Major","Major","Major"],Chromatic:["Unknown"]};playChord(t){(new Vl).toDestination().triggerAttackRelease(`${t.note}4`,"1s"),console.log(`Playing chord: ${t.note} ${t.chord}`)}displayChordOnFretboard(t){const n=this.notes.indexOf(t.note);console.log("root: "+n);const i=this.chordFormulas[t.chord]||[];console.log("formula "+i),this.selectedChordNotes=i.map(r=>this.notes[(n+r)%12]),console.log(this.selectedChordNotes[0])}getChordSequence(){const t=this.scaleFormulas[this.selectedScale],n=this.notes.indexOf(this.selectedNote),i=t.map(o=>this.notes[(n+Number(o))%12]),r=this.chordMappings[this.selectedScale]||[];return i.map((o,a)=>({note:o,chord:r[a]||"Unknown"}))}getBorrowedChordSequence(){const t=this.parallelScales[this.selectedScale],n=this.scaleFormulas[t],i=this.notes.indexOf(this.selectedNote),r=n.map(a=>this.notes[(i+Number(a))%12]),o=this.chordMappings[t]||[];return r.map((a,l)=>({note:a,chord:o[l]||"Unknown"}))}toggleChordOnFretboard(t){this.resetBorrowedChordSequence();const n=this.notes.indexOf(t.note),r=(this.chordFormulas[t.chord]||[]).map(o=>this.notes[(n+Number(o))%12]);this.selectedChordNotes=this.selectedChordNotes.length>0&&this.selectedChordNotes.every(o=>r.includes(o))?[]:r}toggleBorrowedChordOnFretboard(t){this.resetChordSequence();const n=this.notes.indexOf(t.note),r=(this.chordFormulas[t.chord]||[]).map(o=>this.notes[(n+Number(o))%12]);this.selectedBorrowedChordNotes=this.selectedBorrowedChordNotes.length>0&&this.selectedBorrowedChordNotes.every(o=>r.includes(o))?[]:r}playChordSequence(){const t=this.getChordSequence();this.isSequencePlaying=!0;let n=0;const i=()=>{if(this.activeChordIndex=n,this.toggleChordOnFretboard(t[n]),n<t.length-1){let r=Math.floor(this.sequenceInterval/1e3);this.countdown=r,this.sequenceIntervalId=setInterval(()=>{r--,this.countdown=r,r<=0&&(clearInterval(this.sequenceIntervalId),n++,i())},1e3)}else setTimeout(()=>{this.isSequencePlaying=!1,this.activeChordIndex=null,this.countdown=0,this.resetChordSequence()},this.sequenceInterval)};i()}stopChordSequence(){this.isSequencePlaying=!1,this.activeChordIndex=null,this.countdown=0,this.sequenceIntervalId&&(clearInterval(this.sequenceIntervalId),this.sequenceIntervalId=null)}blinkChordOnFretboard(t){const n=this.getChordNotesForRoot(t);this.animatedNotes=n,setTimeout(()=>this.animatedNotes=[],1e3)}getChordNotesForRoot(t){const n=this.notes.indexOf(t);return(this.chordMappings[this.selectedScale]||[]).map(r=>this.notes[(n+Number(r))%12])}getFretboardForChord(){const t=this.chordFormulas[this.selectedChord],n=this.notes.indexOf(this.selectedNote);return this.strings.map(r=>r.map(o=>{const a=this.notes.indexOf(o);return t.some(l=>(n+l)%12===a)?o:""}))}getFretboardForScale(){const t=this.scaleFormulas[this.selectedScale],n=this.notes.indexOf(this.selectedNote);return this.strings.map(r=>r.map(o=>{const a=this.notes.indexOf(o);return t.some(l=>(n+l)%12===a)?o:""}))}getFretboard(){return"Chord"===this.displayMode?this.getFretboardForChord():this.getFretboardForScale()}isRootNote(t){return t===this.selectedNote}getChordNotes(){const t=this.chordFormulas[this.selectedChord],n=this.notes.indexOf(this.selectedNote);return t.map(i=>this.notes[(n+i)%12])}getScaleNotes(){const t=this.scaleFormulas[this.selectedScale],n=this.notes.indexOf(this.selectedNote);return t.map(i=>this.notes[(n+i)%12])}isPartOfChordOrScale(t){const n=this.getChordNotes(),i=this.getScaleNotes();return"Chord"===this.displayMode?n.includes(t):i.includes(t)}renderFretboard(){const t=this.getFilteredCAGEDShapes();let n=this.strings.map((i,r)=>i.map((o,a)=>{const l=t.some(u=>u.frets[r]===a&&o===this.selectedNote),c=t.some(u=>u.frets[r]===a&&-1!==u.frets[r]);return{note:o,isPartOfChordOrScale:this.isPartOfChordOrScale(o),isPartOfCAGEDShape:c,isPartOfSelectedChord:this.selectedChordNotes.includes(o),isPartOfSelectedBorrowedChord:this.selectedBorrowedChordNotes.includes(o),isAnimated:this.isAnimated(o),isRootNote:this.isRootNote(o)||l}}));return"right"===this.handedness&&(n=[...n].reverse()),n}get fretboardWidth(){return 45*this.strings[0].length}get fretboardHeight(){return 50*this.strings.length}play(){var t=this;return Ae(function*(){console.log("Playing in mode:",t.displayMode);const n=(new Vl).toDestination(),i="Chord"===t.displayMode?t.getChordNotes():t.getScaleNotes();if(t.animatedNotes=[],"Chord"===t.displayMode){let r=h5();i.forEach((o,a)=>{n.triggerAttackRelease(`${o}4`,"0.5s",r),setTimeout(()=>{t.animatedNotes=[o]},500*a),r+=.5}),setTimeout(()=>t.animatedNotes=[],500*i.length)}else{let r=h5();i.forEach((o,a)=>{n.triggerAttackRelease(`${o}4`,"0.5s",r),setTimeout(()=>{t.animatedNotes=[o]},500*a),r+=.5}),setTimeout(()=>t.animatedNotes=[],500*i.length)}})()}isAnimated(t){return this.animatedNotes.includes(t)}on=!0;playNote(t,n,i){(new Vl).toDestination().triggerAttackRelease(`${t}4`,"0.5s"),this.animatedNotes=[t],this.clickedNote=`String ${6-n}, Fret ${i}: ${t}`,setTimeout(()=>this.animatedNotes=[],500),this.on=!this.on,console.log("Toggling LED for String "+(6-n)+", Fret "+i+" to "+(this.on?"ON":"OFF")),this.smartLightBluetoothService.setLedByfretAndString(i,6-n,this.on)}reset(){this.smartLightBluetoothService.reset()}resetChordSequence(){this.activeChordIndex=null,this.selectedChordNotes=[],this.displayedChordNotes=[],this.isSequencePlaying=!1,this.ischordActive=!1}resetBorrowedChordSequence(){this.activeBorrowedChordIndex=null,this.selectedBorrowedChordNotes=[],this.displayedChordNotes=[],this.isSequencePlaying=!1,this.ischordActive=!1}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(n){return new(n||s)(ue(jV),ue(Jn),ue(lf))};static \u0275cmp=eg({type:s,selectors:[["guitar-app"]],features:[ra],decls:19,vars:16,consts:[[1,"tabs-row"],[1,"tab-btn",3,"click"],["class","circle-fifths-section",4,"ngIf"],[1,"container"],["class","controls-row",4,"ngIf"],[4,"ngIf"],["class","bluetooth-section",4,"ngIf"],["class","fretboard-wrapper",4,"ngIf"],[1,"circle-fifths-section"],[2,"display","flex","justify-content","center","align-items","center","gap","16px","margin-bottom","12px"],[2,"padding","8px 16px","font-size","16px","border-radius","6px","border","1px solid #bbb","background","#f9f9f9","cursor","pointer","color","#a80000",3,"click"],[2,"font-size","20px","font-weight","bold","min-width","48px","text-align","center"],[2,"display","flex","justify-content","center","align-items","center","margin","32px 0"],["width","450","height","450","viewBox","-10 -10 450 450"],[4,"ngFor","ngForOf"],["cx","200","cy","200","r","200","fill","none","stroke","#bbb","stroke-width","5"],["cx","200","cy","200","r","160","fill","#f9f9f9","stroke","#bbb","stroke-width","4"],["cx","200","cy","200","r","110","fill","none","stroke","#bbb","stroke-width","3"],["width","36","height","36","rx","7","ry","7","fill","#f3e5f5","stroke","#8e24aa","stroke-width","3","style","cursor:pointer;",3,"click",4,"ngIf"],["text-anchor","middle","alignment-baseline","middle","font-size","14","font-family","Helvetica","font-weight","bold","stroke-width","0.5",2,"cursor","pointer",3,"click"],["width","36","height","36","rx","7","ry","7","fill","#f3e5f5","stroke","#8e24aa","stroke-width","3",2,"cursor","pointer",3,"click"],["width","36","height","36","rx","7","ry","7","stroke-width","2","style","cursor:pointer;",3,"click",4,"ngIf"],["stroke","#bbb","stroke-width","1.5"],["rx","12","ry","12","style","cursor:pointer;",3,"click",4,"ngIf"],["width","36","height","36","rx","7","ry","7","stroke-width","2",2,"cursor","pointer",3,"click"],["rx","12","ry","12",2,"cursor","pointer",3,"click"],["stroke","#aaa","stroke-width","2"],["text-anchor","middle","alignment-baseline","middle","font-family","Helvetica",2,"cursor","pointer",3,"click"],["text-anchor","middle","alignment-baseline","middle","font-size","14","font-family","Helvetica","fill","#e91e63","font-weight","bold","stroke","#fff","stroke-width","0.5",4,"ngIf"],["text-anchor","middle","alignment-baseline","middle","font-size","16","font-family","Helvetica","font-style","italic",2,"cursor","pointer",3,"click"],["text-anchor","middle","alignment-baseline","middle","font-size","14","font-family","Helvetica","fill","#e91e63","font-weight","bold","stroke","#fff","stroke-width","0.5"],[1,"controls-row"],[1,"control-block"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"control-block","radio-group"],["type","radio","name","handedness","value","right",3,"ngModelChange","ngModel"],["type","radio","name","handedness","value","left",3,"ngModelChange","ngModel"],["for","note"],["id","note",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","radio","name","displayMode","value","Chord",3,"ngModelChange","ngModel"],["type","radio","name","displayMode","value","Scale",3,"ngModelChange","ngModel"],["class","control-block",4,"ngIf"],[1,"play-btn",3,"click"],[1,"caged-shapes"],[3,"value"],["for","chord"],["id","chord",3,"ngModelChange","ngModel"],["for","scale"],["id","scale",3,"ngModelChange","ngModel"],["type","checkbox",3,"change","checked"],[1,"chord-sequence-wrapper"],[1,"chord-sequence-table",2,"margin","0 auto","border-collapse","separate","border-spacing","8px"],[2,"text-align","center","font-size","16px","font-weight","bold","padding","8px"],["style","text-align:center; font-size:16px; font-weight:bold; padding:8px;",4,"ngFor","ngForOf"],[2,"padding","8px"],[1,"chord-card","reset-card",2,"width","100%","height","100%","font-size","15px","padding","10px","border-radius","8px","border","1px solid #bbb","background","#f9f9f9","cursor","pointer",3,"click"],["style","padding:8px;",4,"ngFor","ngForOf"],[1,"interval-select-row",2,"display","flex","align-items","center","gap","16px","justify-content","center","margin-top","12px"],["for","sequenceInterval"],["id","sequenceInterval",3,"ngModelChange","ngModel"],[3,"click","disabled"],["style","background:#d9534f;color:#fff;border:none;border-radius:6px;padding:8px 18px;font-weight:600;cursor:pointer;",3,"click",4,"ngIf"],["class","countdown-timer","style","margin-left: 12px;",4,"ngIf"],[1,"chord-card",2,"width","100%","height","100%","font-size","15px","padding","10px","border-radius","8px","cursor","pointer",3,"click","ngStyle"],[2,"background","#d9534f","color","#fff","border","none","border-radius","6px","padding","8px 18px","font-weight","600","cursor","pointer",3,"click"],[1,"countdown-timer",2,"margin-left","12px"],[1,"bluetooth-section"],[3,"click"],["class","device-list","style","list-style: none; padding: 0; margin: 0 auto; display: flex; flex-direction: column; align-items: center; width: fit-content;",4,"ngIf"],["class","connected-device",4,"ngIf"],[1,"device-list",2,"list-style","none","padding","0","margin","0 auto","display","flex","flex-direction","column","align-items","center","width","fit-content"],["style","display: flex; align-items: center; justify-content: space-between; \n      padding: 10px 16px; margin: 8px 0px; \n      border: 1px solid #ddd; border-radius: 8px; background: #fafbfc;",4,"ngFor","ngForOf"],[1,"spinner"],[2,"display","flex","align-items","center","justify-content","space-between","padding","10px 16px","margin","8px 0px","border","1px solid #ddd","border-radius","8px","background","#fafbfc"],[2,"font-size","16px","font-weight","500"],[2,"margin-left","16px","padding","6px 18px","border-radius","6px","border","1px solid #bbb","background","#1a0202","cursor","pointer","color","#fff",3,"click"],[1,"connected-device"],[2,"margin","10px",3,"click"],[1,"fretboard-wrapper"],[1,"fretboard-svg",2,"max-width","100%","height","auto","display","block","margin","0 auto"],["x","0","y","0","fill","#fff","stroke","#eee","stroke-width","4"],["x","0","y","0","width","8","fill","#222","rx","4"],["r","7","fill","#bbb","stroke","#888","stroke-width","1"],["stroke","#888","stroke-width","1.5",4,"ngIf"],["stroke","#888","stroke-width","1.5"],["stroke","#333","stroke-width","2"],[2,"cursor","pointer",3,"click"],["text-anchor","middle","alignment-baseline","middle",2,"pointer-events","none"]],template:function(n,i){1&n&&(K(0,"div",0)(1,"button",1),ht("click",function(){return i.activeTab="controls"}),we(2,"Main"),J(),K(3,"button",1),ht("click",function(){return i.activeTab="chordseq"}),we(4,"Progression"),J(),K(5,"button",1),ht("click",function(){return i.activeTab="circlefifths"}),we(6,"Circle of Fifths"),J(),K(7,"button",1),ht("click",function(){return i.activeTab="bluetooth"}),we(8,"Bluetooth"),J(),K(9,"button",1),ht("click",function(){return i.activeTab="guitarpro"}),we(10,"Guitar Pro"),J()(),qn(11,Ghe,21,5,"div",2),K(12,"div",3),qn(13,Xhe,30,11,"div",4)(14,tde,42,19,"div",5)(15,ode,5,2,"div",6)(16,ade,2,0,"div",5),Xi(17,"br"),qn(18,dde,16,29,"div",7),J()),2&n&&(Q(),br("active-tab","controls"===i.activeTab),Q(2),br("active-tab","chordseq"===i.activeTab),Q(2),br("active-tab","circlefifths"===i.activeTab),Q(2),br("active-tab","bluetooth"===i.activeTab),Q(2),br("active-tab","guitarpro"===i.activeTab),Q(2),gt("ngIf","circlefifths"===i.activeTab),Q(2),gt("ngIf","controls"===i.activeTab),Q(),gt("ngIf","chordseq"===i.activeTab),Q(),gt("ngIf","bluetooth"===i.activeTab),Q(),gt("ngIf","guitarpro"===i.activeTab),Q(2),gt("ngIf","guitarpro"!==i.activeTab))},dependencies:[KL,WL,UL,kb,Tb,Gb,ZC,OC,Vb,m2,uD,hD,f2,Qre,p2],styles:['.tabs-row[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:8px;margin-bottom:10px}.tab-btn[_ngcontent-%COMP%]{background:#e9e9f0;color:#333;border:none;border-radius:8px 8px 0 0;padding:8px 24px;font-size:1rem;font-weight:500;cursor:pointer;box-shadow:0 1px 4px #0000000f;transition:background .2s}.tab-btn.active-tab[_ngcontent-%COMP%]{background:#007bff;color:#fff;font-weight:600}.controls-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:18px;background:#f8f8fa;border-radius:12px;box-shadow:0 2px 8px #00000012;padding:16px 12px;margin-bottom:18px}.controls-row[_ngcontent-%COMP%]   .control-block[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.controls-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;margin-right:4px}.controls-row[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .controls-row[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{font-size:1rem;padding:4px 8px;border-radius:6px;border:1px solid #ccc}.controls-row[_ngcontent-%COMP%]   .play-btn[_ngcontent-%COMP%]{background:#007bff;color:#fff;border:none;border-radius:6px;padding:8px 18px;font-size:1rem;font-weight:600;cursor:pointer;box-shadow:0 1px 4px #00000014;transition:background .2s}.controls-row[_ngcontent-%COMP%]   .play-btn[_ngcontent-%COMP%]:hover{background:#0056b3}.container[_ngcontent-%COMP%]{max-width:90%;margin:0 auto;text-align:center;padding:10px}select[_ngcontent-%COMP%]{margin:10px;padding:5px}.fretboard[_ngcontent-%COMP%]{display:flex;flex-direction:column-reverse;margin:20px auto;border:5px solid #333;padding:10px;background-color:#f4f4f4;position:relative;overflow-x:auto}.string[_ngcontent-%COMP%]{display:flex;margin:0;position:relative}.fret[_ngcontent-%COMP%]{width:60px;height:40px;border-right:2px solid #000;display:flex;align-items:center;justify-content:center;font-size:12px;position:relative}.fret[_ngcontent-%COMP%]:last-child{border-right:none}.fret.highlight[_ngcontent-%COMP%]{background-color:#fc0;font-weight:700;border-radius:50%;border:2px solid #000;min-width:30px;width:30px;height:30px;margin:0 10px}.fret.root[_ngcontent-%COMP%]{background-color:#ff5733;color:#fff;font-weight:700;border-radius:50%}.string[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:0;right:0;height:2px;background-color:#333}.string-numbers[_ngcontent-%COMP%]{display:flex;margin:20px auto;padding:10px;background-color:#f4f4f4;position:relative}.string-numbers[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-weight:700;border:2px solid #000;min-width:30px;width:50px;height:30px;margin:0 10px}@media (max-width: 768px){.container[_ngcontent-%COMP%]{max-width:100%;padding:5px}.fretboard[_ngcontent-%COMP%]{border:1px solid #333;padding:5px}.fret[_ngcontent-%COMP%]{width:50px;height:30px;font-size:10px}select[_ngcontent-%COMP%]{font-size:.9rem}.string-numbers[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}}@media (max-width: 480px){.container[_ngcontent-%COMP%]{max-width:100%;padding:5px}.fretboard[_ngcontent-%COMP%]{border:1px solid #333;padding:5px;overflow-x:scroll}.fret[_ngcontent-%COMP%]{width:40px;height:25px;font-size:8px}select[_ngcontent-%COMP%]{font-size:.8rem}.string-numbers[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:10px}}.fret.animated[_ngcontent-%COMP%]{background-color:#0f0;color:#fff;font-weight:700;border-radius:50%;animation:_ngcontent-%COMP%_pulse .5s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}.clicked-note[_ngcontent-%COMP%]{margin:20px auto;font-size:1.2rem;font-weight:700;color:#333}.fret.small[_ngcontent-%COMP%]{font-size:.8rem;color:#aaa}.caged-box[_ngcontent-%COMP%]{position:absolute;top:0;height:100%;background-color:#0000ff1a;border:3px solid #00f;border-radius:57px;text-align:center;font-size:.9rem;color:#00f;border-top:3px dotted rgba(0,0,255,.1)}.caged-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{position:relative;bottom:-100px;color:#333;z-index:1000;font-size:20px;border:0px solid #000}.fret.caged[_ngcontent-%COMP%]{border:2px solid #00f;border-radius:5px;background-color:#0000ff1a;z-index:2000}@keyframes _ngcontent-%COMP%_blink{0%{opacity:1}50%{opacity:.5}to{opacity:1}}.fret.selected-chord[_ngcontent-%COMP%]{font-weight:700;border-radius:20%;box-shadow:0 0 10px #ff5733cc;opacity:.5;width:20px;height:20px;border:1px solid white}.chord-sequence[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin:20px 0;justify-content:center}.chord-card[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:5px;padding:10px;background-color:#f9f9f9;box-shadow:0 2px 4px #0000001a;text-align:center;width:150px;cursor:pointer;transition:transform .2s,box-shadow .2s}.chord-card[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 8px #0003}.chord-card.active[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;font-weight:700;box-shadow:0 0 10px #007bffcc}.chord-card.reset-card[_ngcontent-%COMP%]{background:#ffeaea;color:#d00;border:2px solid #ffd6d6;font-weight:700;box-shadow:0 2px 8px #dc000012}.fret.selected-chord[_ngcontent-%COMP%]{background-color:#ff5733;color:#fff;font-weight:700;border-radius:50%;box-shadow:0 0 10px #ff5733cc}.clicked-note[_ngcontent-%COMP%]{margin-top:20px;font-size:1.2rem;font-weight:700}button[_ngcontent-%COMP%]{margin-top:10px;padding:5px 10px;font-size:.9rem;background-color:#007bff;color:#fff;border:none;border-radius:5px;cursor:pointer}button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.spinner[_ngcontent-%COMP%]{border:4px solid rgba(0,0,0,.1);border-left-color:#333;border-radius:50%;width:30px;height:30px;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}']})}return s})();(function LX(s,e,t){return $Y({rootComponent:s,platformRef:t?.platformRef,...wF(e)})})((()=>{class s{title="guitar-app";static \u0275fac=function(n){return new(n||s)};static \u0275cmp=eg({type:s,selectors:[["app-root"]],decls:2,vars:0,template:function(n,i){1&n&&Xi(0,"guitar-app")(1,"router-outlet")},dependencies:[bC,fde],encapsulation:2})}return s})(),MK).catch(s=>console.error(s))},935:()=>{"use strict";const Oe=globalThis;function An(P){return(Oe.__Zone_symbol_prefix||"__zone_symbol__")+P}const Dn=Object.getOwnPropertyDescriptor,Bn=Object.defineProperty,zn=Object.getPrototypeOf,cs=Object.create,Zs=Array.prototype.slice,ti="addEventListener",zr="removeEventListener",Bo=An(ti),ms=An(zr),Mi="true",di="false",Mo=An("");function Zn(P,A){return Zone.current.wrap(P,A)}function vt(P,A,oe,I,Y){return Zone.current.scheduleMacroTask(P,A,oe,I,Y)}const Mn=An,Gl=typeof window<"u",tl=Gl?window:void 0,Ln=Gl&&tl||globalThis;function Ac(P,A){for(let oe=P.length-1;oe>=0;oe--)"function"==typeof P[oe]&&(P[oe]=Zn(P[oe],A+"_"+oe));return P}function Hu(P){return!P||!1!==P.writable&&!("function"==typeof P.get&&typeof P.set>"u")}const sl=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Rc=!("nw"in Ln)&&typeof Ln.process<"u"&&"[object process]"===Ln.process.toString(),il=!Rc&&!sl&&!(!Gl||!tl.HTMLElement),Ta=typeof Ln.process<"u"&&"[object process]"===Ln.process.toString()&&!sl&&!(!Gl||!tl.HTMLElement),Fc={},zl=Mn("enable_beforeunload"),id=function(P){if(!(P=P||Ln.event))return;let A=Fc[P.type];A||(A=Fc[P.type]=Mn("ON_PROPERTY"+P.type));const oe=this||P.target||Ln,I=oe[A];let Y;return il&&oe===tl&&"error"===P.type?(Y=I&&I.call(this,P.message,P.filename,P.lineno,P.colno,P.error),!0===Y&&P.preventDefault()):(Y=I&&I.apply(this,arguments),"beforeunload"===P.type&&Ln[zl]&&"string"==typeof Y?P.returnValue=Y:null!=Y&&!Y&&P.preventDefault()),Y};function Vn(P,A,oe){let I=Dn(P,A);if(!I&&oe&&Dn(oe,A)&&(I={enumerable:!0,configurable:!0}),!I||!I.configurable)return;const Y=Mn("on"+A+"patched");if(P.hasOwnProperty(Y)&&P[Y])return;delete I.writable,delete I.value;const ke=I.get,pt=I.set,rt=A.slice(2);let Tt=Fc[rt];Tt||(Tt=Fc[rt]=Mn("ON_PROPERTY"+rt)),I.set=function(Yt){let ot=this;!ot&&P===Ln&&(ot=Ln),ot&&("function"==typeof ot[Tt]&&ot.removeEventListener(rt,id),pt?.call(ot,null),ot[Tt]=Yt,"function"==typeof Yt&&ot.addEventListener(rt,id,!1))},I.get=function(){let Yt=this;if(!Yt&&P===Ln&&(Yt=Ln),!Yt)return null;const ot=Yt[Tt];if(ot)return ot;if(ke){let zt=ke.call(this);if(zt)return I.set.call(this,zt),"function"==typeof Yt.removeAttribute&&Yt.removeAttribute(A),zt}return null},Bn(P,A,I),P[Y]=!0}function Le(P,A,oe){if(A)for(let I=0;I<A.length;I++)Vn(P,"on"+A[I],oe);else{const I=[];for(const Y in P)"on"==Y.slice(0,2)&&I.push(Y);for(let Y=0;Y<I.length;Y++)Vn(P,I[Y],oe)}}const Pe=Mn("originalInstance");function Me(P){const A=Ln[P];if(!A)return;Ln[Mn(P)]=A,Ln[P]=function(){const Y=Ac(arguments,P);switch(Y.length){case 0:this[Pe]=new A;break;case 1:this[Pe]=new A(Y[0]);break;case 2:this[Pe]=new A(Y[0],Y[1]);break;case 3:this[Pe]=new A(Y[0],Y[1],Y[2]);break;case 4:this[Pe]=new A(Y[0],Y[1],Y[2],Y[3]);break;default:throw new Error("Arg list too long.")}},He(Ln[P],A);const oe=new A(function(){});let I;for(I in oe)"XMLHttpRequest"===P&&"responseBlob"===I||function(Y){"function"==typeof oe[Y]?Ln[P].prototype[Y]=function(){return this[Pe][Y].apply(this[Pe],arguments)}:Bn(Ln[P].prototype,Y,{set:function(ke){"function"==typeof ke?(this[Pe][Y]=Zn(ke,P+"."+Y),He(this[Pe][Y],ke)):this[Pe][Y]=ke},get:function(){return this[Pe][Y]}})}(I);for(I in A)"prototype"!==I&&A.hasOwnProperty(I)&&(Ln[P][I]=A[I])}function it(P,A,oe){let I=P;for(;I&&!I.hasOwnProperty(A);)I=zn(I);!I&&P[A]&&(I=P);const Y=Mn(A);let ke=null;if(I&&(!(ke=I[Y])||!I.hasOwnProperty(Y))&&(ke=I[Y]=I[A],Hu(I&&Dn(I,A)))){const rt=oe(ke,Y,A);I[A]=function(){return rt(this,arguments)},He(I[A],ke)}return ke}function an(P,A,oe){let I=null;function Y(ke){const pt=ke.data;return pt.args[pt.cbIdx]=function(){ke.invoke.apply(this,arguments)},I.apply(pt.target,pt.args),ke}I=it(P,A,ke=>function(pt,rt){const Tt=oe(pt,rt);return Tt.cbIdx>=0&&"function"==typeof rt[Tt.cbIdx]?vt(Tt.name,rt[Tt.cbIdx],Tt,Y):ke.apply(pt,rt)})}function He(P,A){P[Mn("OriginalDelegate")]=A}let ql=!1,ka=!1;function fo(){if(ql)return ka;ql=!0;try{const P=tl.navigator.userAgent;(-1!==P.indexOf("MSIE ")||-1!==P.indexOf("Trident/")||-1!==P.indexOf("Edge/"))&&(ka=!0)}catch{}return ka}function Po(P){return"function"==typeof P}function mr(P){return"number"==typeof P}const $l={useG:!0},Pi={},rl={},ol=new RegExp("^"+Mo+"(\\w+)(true|false)$"),Ca=Mn("propagationStopped");function al(P,A){const oe=(A?A(P):P)+di,I=(A?A(P):P)+Mi,Y=Mo+oe,ke=Mo+I;Pi[P]={},Pi[P][di]=Y,Pi[P][Mi]=ke}function jl(P,A,oe,I){const Y=I&&I.add||ti,ke=I&&I.rm||zr,pt=I&&I.listeners||"eventListeners",rt=I&&I.rmAll||"removeAllListeners",Tt=Mn(Y),Yt="."+Y+":",ot="prependListener",zt="."+ot+":",gn=function(Mt,Ue,Lt){if(Mt.isRemoved)return;const is=Mt.callback;let ni;"object"==typeof is&&is.handleEvent&&(Mt.callback=_t=>is.handleEvent(_t),Mt.originalDelegate=is);try{Mt.invoke(Mt,Ue,[Lt])}catch(_t){ni=_t}const Ds=Mt.options;return Ds&&"object"==typeof Ds&&Ds.once&&Ue[ke].call(Ue,Lt.type,Mt.originalDelegate?Mt.originalDelegate:Mt.callback,Ds),ni};function us(Mt,Ue,Lt){if(!(Ue=Ue||P.event))return;const is=Mt||Ue.target||P,ni=is[Pi[Ue.type][Lt?Mi:di]];if(ni){const Ds=[];if(1===ni.length){const _t=gn(ni[0],is,Ue);_t&&Ds.push(_t)}else{const _t=ni.slice();for(let xn=0;xn<_t.length&&(!Ue||!0!==Ue[Ca]);xn++){const mn=gn(_t[xn],is,Ue);mn&&Ds.push(mn)}}if(1===Ds.length)throw Ds[0];for(let _t=0;_t<Ds.length;_t++){const xn=Ds[_t];A.nativeScheduleMicroTask(()=>{throw xn})}}}const Cs=function(Mt){return us(this,Mt,!1)},or=function(Mt){return us(this,Mt,!0)};function Ai(Mt,Ue){if(!Mt)return!1;let Lt=!0;Ue&&void 0!==Ue.useG&&(Lt=Ue.useG);const is=Ue&&Ue.vh;let ni=!0;Ue&&void 0!==Ue.chkDup&&(ni=Ue.chkDup);let Ds=!1;Ue&&void 0!==Ue.rt&&(Ds=Ue.rt);let _t=Mt;for(;_t&&!_t.hasOwnProperty(Y);)_t=zn(_t);if(!_t&&Mt[Y]&&(_t=Mt),!_t||_t[Tt])return!1;const xn=Ue&&Ue.eventNameToString,mn={},lt=_t[Tt]=_t[Y],Pt=_t[Mn(ke)]=_t[ke],ln=_t[Mn(pt)]=_t[pt],Dr=_t[Mn(rt)]=_t[rt];let qs;Ue&&Ue.prepend&&(qs=_t[Mn(Ue.prepend)]=_t[Ue.prepend]);const Rt=Lt?function(U){if(!mn.isExisting)return lt.call(mn.target,mn.eventName,mn.capture?or:Cs,mn.options)}:function(U){return lt.call(mn.target,mn.eventName,U.invoke,mn.options)},Rn=Lt?function(U){if(!U.isRemoved){const pe=Pi[U.eventName];let Ot;pe&&(Ot=pe[U.capture?Mi:di]);const Jt=Ot&&U.target[Ot];if(Jt)for(let kt=0;kt<Jt.length;kt++)if(Jt[kt]===U){Jt.splice(kt,1),U.isRemoved=!0,U.removeAbortListener&&(U.removeAbortListener(),U.removeAbortListener=null),0===Jt.length&&(U.allRemoved=!0,U.target[Ot]=null);break}}if(U.allRemoved)return Pt.call(U.target,U.eventName,U.capture?or:Cs,U.options)}:function(U){return Pt.call(U.target,U.eventName,U.invoke,U.options)},Ro=Ue?.diff||function(U,pe){const Ot=typeof pe;return"function"===Ot&&U.callback===pe||"object"===Ot&&U.originalDelegate===pe},ll=Zone[Mn("UNPATCHED_EVENTS")],Fo=P[Mn("PASSIVE_EVENTS")],X=function(U,pe,Ot,Jt,kt=!1,qt=!1){return function(){const Tn=this||P;let kn=arguments[0];Ue&&Ue.transferEventName&&(kn=Ue.transferEventName(kn));let Rs=arguments[1];if(!Rs)return U.apply(this,arguments);if(Rc&&"uncaughtException"===kn)return U.apply(this,arguments);let xs=!1;if("function"!=typeof Rs){if(!Rs.handleEvent)return U.apply(this,arguments);xs=!0}if(is&&!is(U,Rs,Tn,arguments))return;const cl=!!Fo&&-1!==Fo.indexOf(kn),Da=function ae(U){if("object"==typeof U&&null!==U){const pe={...U};return U.signal&&(pe.signal=U.signal),pe}return U}(function R(U,pe){return pe?"boolean"==typeof U?{capture:U,passive:!0}:U?"object"==typeof U&&!1!==U.passive?{...U,passive:!0}:U:{passive:!0}:U}(arguments[2],cl)),Vc=Da?.signal;if(Vc?.aborted)return;if(ll)for(let ea=0;ea<ll.length;ea++)if(kn===ll[ea])return cl?U.call(Tn,kn,Rs,Da):U.apply(this,arguments);const Ym=!!Da&&("boolean"==typeof Da||Da.capture),Yi=!(!Da||"object"!=typeof Da)&&Da.once,bt=Zone.current;let Xm=Pi[kn];Xm||(al(kn,xn),Xm=Pi[kn]);const tS=Xm[Ym?Mi:di];let sp,Hc=Tn[tS],nS=!1;if(Hc){if(nS=!0,ni)for(let ea=0;ea<Hc.length;ea++)if(Ro(Hc[ea],Rs))return}else Hc=Tn[tS]=[];const ut=Tn.constructor.name,sS=rl[ut];sS&&(sp=sS[kn]),sp||(sp=ut+pe+(xn?xn(kn):kn)),mn.options=Da,Yi&&(mn.options.once=!1),mn.target=Tn,mn.capture=Ym,mn.eventName=kn,mn.isExisting=nS;const Ko=Lt?$l:void 0;Ko&&(Ko.taskData=mn),Vc&&(mn.options.signal=void 0);const xr=bt.scheduleEventTask(sp,Rs,Ko,Ot,Jt);if(Vc){mn.options.signal=Vc;const ea=()=>xr.zone.cancelTask(xr);U.call(Vc,"abort",ea,{once:!0}),xr.removeAbortListener=()=>Vc.removeEventListener("abort",ea)}return mn.target=null,Ko&&(Ko.taskData=null),Yi&&(mn.options.once=!0),"boolean"!=typeof xr.options&&(xr.options=Da),xr.target=Tn,xr.capture=Ym,xr.eventName=kn,xs&&(xr.originalDelegate=Rs),qt?Hc.unshift(xr):Hc.push(xr),kt?Tn:void 0}};return _t[Y]=X(lt,Yt,Rt,Rn,Ds),qs&&(_t[ot]=X(qs,zt,function(U){return qs.call(mn.target,mn.eventName,U.invoke,mn.options)},Rn,Ds,!0)),_t[ke]=function(){const U=this||P;let pe=arguments[0];Ue&&Ue.transferEventName&&(pe=Ue.transferEventName(pe));const Ot=arguments[2],Jt=!!Ot&&("boolean"==typeof Ot||Ot.capture),kt=arguments[1];if(!kt)return Pt.apply(this,arguments);if(is&&!is(Pt,kt,U,arguments))return;const qt=Pi[pe];let Tn;qt&&(Tn=qt[Jt?Mi:di]);const kn=Tn&&U[Tn];if(kn)for(let Rs=0;Rs<kn.length;Rs++){const xs=kn[Rs];if(Ro(xs,kt))return kn.splice(Rs,1),xs.isRemoved=!0,0!==kn.length||(xs.allRemoved=!0,U[Tn]=null,Jt||"string"!=typeof pe)||(U[Mo+"ON_PROPERTY"+pe]=null),xs.zone.cancelTask(xs),Ds?U:void 0}return Pt.apply(this,arguments)},_t[pt]=function(){const U=this||P;let pe=arguments[0];Ue&&Ue.transferEventName&&(pe=Ue.transferEventName(pe));const Ot=[],Jt=Oc(U,xn?xn(pe):pe);for(let kt=0;kt<Jt.length;kt++){const qt=Jt[kt];Ot.push(qt.originalDelegate?qt.originalDelegate:qt.callback)}return Ot},_t[rt]=function(){const U=this||P;let pe=arguments[0];if(pe){Ue&&Ue.transferEventName&&(pe=Ue.transferEventName(pe));const Ot=Pi[pe];if(Ot){const qt=U[Ot[di]],Tn=U[Ot[Mi]];if(qt){const kn=qt.slice();for(let Rs=0;Rs<kn.length;Rs++){const xs=kn[Rs];this[ke].call(this,pe,xs.originalDelegate?xs.originalDelegate:xs.callback,xs.options)}}if(Tn){const kn=Tn.slice();for(let Rs=0;Rs<kn.length;Rs++){const xs=kn[Rs];this[ke].call(this,pe,xs.originalDelegate?xs.originalDelegate:xs.callback,xs.options)}}}}else{const Ot=Object.keys(U);for(let Jt=0;Jt<Ot.length;Jt++){const qt=ol.exec(Ot[Jt]);let Tn=qt&&qt[1];Tn&&"removeListener"!==Tn&&this[rt].call(this,Tn)}this[rt].call(this,"removeListener")}if(Ds)return this},He(_t[Y],lt),He(_t[ke],Pt),Dr&&He(_t[rt],Dr),ln&&He(_t[pt],ln),!0}let ys=[];for(let Mt=0;Mt<oe.length;Mt++)ys[Mt]=Ai(oe[Mt],I);return ys}function Oc(P,A){if(!A){const ke=[];for(let pt in P){const rt=ol.exec(pt);let Tt=rt&&rt[1];if(Tt&&(!A||Tt===A)){const Yt=P[pt];if(Yt)for(let ot=0;ot<Yt.length;ot++)ke.push(Yt[ot])}}return ke}let oe=Pi[A];oe||(al(A),oe=Pi[A]);const I=P[oe[di]],Y=P[oe[Mi]];return I?Y?I.concat(Y):I.slice():Y?Y.slice():[]}function rd(P,A){const oe=P.Event;oe&&oe.prototype&&A.patchMethod(oe.prototype,"stopImmediatePropagation",I=>function(Y,ke){Y[Ca]=!0,I&&I.apply(Y,ke)})}const Wu=Mn("zoneTask");function Gu(P,A,oe,I){let Y=null,ke=null;oe+=I;const pt={};function rt(Yt){const ot=Yt.data;ot.args[0]=function(){return Yt.invoke.apply(this,arguments)};const zt=Y.apply(P,ot.args);return mr(zt)?ot.handleId=zt:(ot.handle=zt,ot.isRefreshable=Po(zt.refresh)),Yt}function Tt(Yt){const{handle:ot,handleId:zt}=Yt.data;return ke.call(P,ot??zt)}Y=it(P,A+=I,Yt=>function(ot,zt){if(Po(zt[0])){const gn={isRefreshable:!1,isPeriodic:"Interval"===I,delay:"Timeout"===I||"Interval"===I?zt[1]||0:void 0,args:zt},us=zt[0];zt[0]=function(){try{return us.apply(this,arguments)}finally{const{handle:Lt,handleId:is,isPeriodic:ni,isRefreshable:Ds}=gn;!ni&&!Ds&&(is?delete pt[is]:Lt&&(Lt[Wu]=null))}};const Cs=vt(A,zt[0],gn,rt,Tt);if(!Cs)return Cs;const{handleId:or,handle:Ai,isRefreshable:ys,isPeriodic:Mt}=Cs.data;if(or)pt[or]=Cs;else if(Ai&&(Ai[Wu]=Cs,ys&&!Mt)){const Ue=Ai.refresh;Ai.refresh=function(){const{zone:Lt,state:is}=Cs;return"notScheduled"===is?(Cs._state="scheduled",Lt._updateTaskCount(Cs,1)):"running"===is&&(Cs._state="scheduling"),Ue.call(this)}}return Ai??or??Cs}return Yt.apply(P,zt)}),ke=it(P,oe,Yt=>function(ot,zt){const gn=zt[0];let us;mr(gn)?(us=pt[gn],delete pt[gn]):(us=gn?.[Wu],us?gn[Wu]=null:us=gn),us?.type?us.cancelFn&&us.zone.cancelTask(us):Yt.apply(P,zt)})}function od(P,A,oe){if(!oe||0===oe.length)return A;const I=oe.filter(ke=>ke.target===P);if(0===I.length)return A;const Y=I[0].ignoreProperties;return A.filter(ke=>-1===Y.indexOf(ke))}function ad(P,A,oe,I){P&&Le(P,od(P,A,oe),I)}function Lc(P){return Object.getOwnPropertyNames(P).filter(A=>A.startsWith("on")&&A.length>2).map(A=>A.substring(2))}function Yl(P,A,oe,I,Y){const ke=Zone.__symbol__(I);if(A[ke])return;const pt=A[ke]=A[I];A[I]=function(rt,Tt,Yt){return Tt&&Tt.prototype&&Y.forEach(function(ot){const zt=`${oe}.${I}::`+ot,gn=Tt.prototype;try{if(gn.hasOwnProperty(ot)){const us=P.ObjectGetOwnPropertyDescriptor(gn,ot);us&&us.value?(us.value=P.wrapWithCurrentZone(us.value,zt),P._redefineProperty(Tt.prototype,ot,us)):gn[ot]&&(gn[ot]=P.wrapWithCurrentZone(gn[ot],zt))}else gn[ot]&&(gn[ot]=P.wrapWithCurrentZone(gn[ot],zt))}catch{}}),pt.call(A,rt,Tt,Yt)},P.attachOriginToPatched(A[I],pt)}const Uu=function dn(){const P=globalThis,A=!0===P[An("forceDuplicateZoneCheck")];if(P.Zone&&(A||"function"!=typeof P.Zone.__symbol__))throw new Error("Zone already loaded.");return P.Zone??=function nn(){const P=Oe.performance;function A(R){P&&P.mark&&P.mark(R)}function oe(R,ct){P&&P.measure&&P.measure(R,ct)}A("Zone");let I=(()=>{class R{static __symbol__=An;static assertZonePatched(){if(Oe.Promise!==mn.ZoneAwarePromise)throw new Error("Zone.js has detected that ZoneAwarePromise `(window|global).Promise` has been overwritten.\nMost likely cause is that a Promise polyfill has been loaded after Zone.js (Polyfilling Promise api is not necessary when zone.js is loaded. If you must load one, do so before loading zone.js.)")}static get root(){let E=R.current;for(;E.parent;)E=E.parent;return E}static get current(){return Pt.zone}static get currentTask(){return ln}static __load_patch(E,M,At=!1){if(mn.hasOwnProperty(E)){const Xt=!0===Oe[An("forceDuplicateZoneCheck")];if(!At&&Xt)throw Error("Already loaded patch: "+E)}else if(!Oe["__Zone_disable_"+E]){const Xt="Zone:"+E;A(Xt),mn[E]=M(Oe,R,lt),oe(Xt,Xt)}}get parent(){return this._parent}get name(){return this._name}_parent;_name;_properties;_zoneDelegate;constructor(E,M){this._parent=E,this._name=M?M.name||"unnamed":"<root>",this._properties=M&&M.properties||{},this._zoneDelegate=new ke(this,this._parent&&this._parent._zoneDelegate,M)}get(E){const M=this.getZoneWith(E);if(M)return M._properties[E]}getZoneWith(E){let M=this;for(;M;){if(M._properties.hasOwnProperty(E))return M;M=M._parent}return null}fork(E){if(!E)throw new Error("ZoneSpec required!");return this._zoneDelegate.fork(this,E)}wrap(E,M){if("function"!=typeof E)throw new Error("Expecting function got: "+E);const At=this._zoneDelegate.intercept(this,E,M),Xt=this;return function(){return Xt.runGuarded(At,this,arguments,M)}}run(E,M,At,Xt){Pt={parent:Pt,zone:this};try{return this._zoneDelegate.invoke(this,E,M,At,Xt)}finally{Pt=Pt.parent}}runGuarded(E,M=null,At,Xt){Pt={parent:Pt,zone:this};try{try{return this._zoneDelegate.invoke(this,E,M,At,Xt)}catch(Rt){if(this._zoneDelegate.handleError(this,Rt))throw Rt}}finally{Pt=Pt.parent}}runTask(E,M,At){if(E.zone!=this)throw new Error("A task can only be run in the zone of creation! (Creation: "+(E.zone||Ai).name+"; Execution: "+this.name+")");const Xt=E,{type:Rt,data:{isPeriodic:Rn=!1,isRefreshable:si=!1}={}}=E;if(E.state===ys&&(Rt===xn||Rt===_t))return;const Ro=E.state!=Lt;Ro&&Xt._transitionTo(Lt,Ue);const ll=ln;ln=Xt,Pt={parent:Pt,zone:this};try{Rt==_t&&E.data&&!Rn&&!si&&(E.cancelFn=void 0);try{return this._zoneDelegate.invokeTask(this,Xt,M,At)}catch(Fo){if(this._zoneDelegate.handleError(this,Fo))throw Fo}}finally{const Fo=E.state;if(Fo!==ys&&Fo!==ni)if(Rt==xn||Rn||si&&Fo===Mt)Ro&&Xt._transitionTo(Ue,Lt,Mt);else{const ae=Xt._zoneDelegates;this._updateTaskCount(Xt,-1),Ro&&Xt._transitionTo(ys,Lt,ys),si&&(Xt._zoneDelegates=ae)}Pt=Pt.parent,ln=ll}}scheduleTask(E){if(E.zone&&E.zone!==this){let At=this;for(;At;){if(At===E.zone)throw Error(`can not reschedule task to ${this.name} which is descendants of the original zone ${E.zone.name}`);At=At.parent}}E._transitionTo(Mt,ys);const M=[];E._zoneDelegates=M,E._zone=this;try{E=this._zoneDelegate.scheduleTask(this,E)}catch(At){throw E._transitionTo(ni,Mt,ys),this._zoneDelegate.handleError(this,At),At}return E._zoneDelegates===M&&this._updateTaskCount(E,1),E.state==Mt&&E._transitionTo(Ue,Mt),E}scheduleMicroTask(E,M,At,Xt){return this.scheduleTask(new pt(Ds,E,M,At,Xt,void 0))}scheduleMacroTask(E,M,At,Xt,Rt){return this.scheduleTask(new pt(_t,E,M,At,Xt,Rt))}scheduleEventTask(E,M,At,Xt,Rt){return this.scheduleTask(new pt(xn,E,M,At,Xt,Rt))}cancelTask(E){if(E.zone!=this)throw new Error("A task can only be cancelled in the zone of creation! (Creation: "+(E.zone||Ai).name+"; Execution: "+this.name+")");if(E.state===Ue||E.state===Lt){E._transitionTo(is,Ue,Lt);try{this._zoneDelegate.cancelTask(this,E)}catch(M){throw E._transitionTo(ni,is),this._zoneDelegate.handleError(this,M),M}return this._updateTaskCount(E,-1),E._transitionTo(ys,is),E.runCount=-1,E}}_updateTaskCount(E,M){const At=E._zoneDelegates;-1==M&&(E._zoneDelegates=null);for(let Xt=0;Xt<At.length;Xt++)At[Xt]._updateTaskCount(E.type,M)}}return R})();const Y={name:"",onHasTask:(R,ct,E,M)=>R.hasTask(E,M),onScheduleTask:(R,ct,E,M)=>R.scheduleTask(E,M),onInvokeTask:(R,ct,E,M,At,Xt)=>R.invokeTask(E,M,At,Xt),onCancelTask:(R,ct,E,M)=>R.cancelTask(E,M)};class ke{get zone(){return this._zone}_zone;_taskCounts={microTask:0,macroTask:0,eventTask:0};_parentDelegate;_forkDlgt;_forkZS;_forkCurrZone;_interceptDlgt;_interceptZS;_interceptCurrZone;_invokeDlgt;_invokeZS;_invokeCurrZone;_handleErrorDlgt;_handleErrorZS;_handleErrorCurrZone;_scheduleTaskDlgt;_scheduleTaskZS;_scheduleTaskCurrZone;_invokeTaskDlgt;_invokeTaskZS;_invokeTaskCurrZone;_cancelTaskDlgt;_cancelTaskZS;_cancelTaskCurrZone;_hasTaskDlgt;_hasTaskDlgtOwner;_hasTaskZS;_hasTaskCurrZone;constructor(ct,E,M){this._zone=ct,this._parentDelegate=E,this._forkZS=M&&(M&&M.onFork?M:E._forkZS),this._forkDlgt=M&&(M.onFork?E:E._forkDlgt),this._forkCurrZone=M&&(M.onFork?this._zone:E._forkCurrZone),this._interceptZS=M&&(M.onIntercept?M:E._interceptZS),this._interceptDlgt=M&&(M.onIntercept?E:E._interceptDlgt),this._interceptCurrZone=M&&(M.onIntercept?this._zone:E._interceptCurrZone),this._invokeZS=M&&(M.onInvoke?M:E._invokeZS),this._invokeDlgt=M&&(M.onInvoke?E:E._invokeDlgt),this._invokeCurrZone=M&&(M.onInvoke?this._zone:E._invokeCurrZone),this._handleErrorZS=M&&(M.onHandleError?M:E._handleErrorZS),this._handleErrorDlgt=M&&(M.onHandleError?E:E._handleErrorDlgt),this._handleErrorCurrZone=M&&(M.onHandleError?this._zone:E._handleErrorCurrZone),this._scheduleTaskZS=M&&(M.onScheduleTask?M:E._scheduleTaskZS),this._scheduleTaskDlgt=M&&(M.onScheduleTask?E:E._scheduleTaskDlgt),this._scheduleTaskCurrZone=M&&(M.onScheduleTask?this._zone:E._scheduleTaskCurrZone),this._invokeTaskZS=M&&(M.onInvokeTask?M:E._invokeTaskZS),this._invokeTaskDlgt=M&&(M.onInvokeTask?E:E._invokeTaskDlgt),this._invokeTaskCurrZone=M&&(M.onInvokeTask?this._zone:E._invokeTaskCurrZone),this._cancelTaskZS=M&&(M.onCancelTask?M:E._cancelTaskZS),this._cancelTaskDlgt=M&&(M.onCancelTask?E:E._cancelTaskDlgt),this._cancelTaskCurrZone=M&&(M.onCancelTask?this._zone:E._cancelTaskCurrZone),this._hasTaskZS=null,this._hasTaskDlgt=null,this._hasTaskDlgtOwner=null,this._hasTaskCurrZone=null;const At=M&&M.onHasTask;(At||E&&E._hasTaskZS)&&(this._hasTaskZS=At?M:Y,this._hasTaskDlgt=E,this._hasTaskDlgtOwner=this,this._hasTaskCurrZone=this._zone,M.onScheduleTask||(this._scheduleTaskZS=Y,this._scheduleTaskDlgt=E,this._scheduleTaskCurrZone=this._zone),M.onInvokeTask||(this._invokeTaskZS=Y,this._invokeTaskDlgt=E,this._invokeTaskCurrZone=this._zone),M.onCancelTask||(this._cancelTaskZS=Y,this._cancelTaskDlgt=E,this._cancelTaskCurrZone=this._zone))}fork(ct,E){return this._forkZS?this._forkZS.onFork(this._forkDlgt,this.zone,ct,E):new I(ct,E)}intercept(ct,E,M){return this._interceptZS?this._interceptZS.onIntercept(this._interceptDlgt,this._interceptCurrZone,ct,E,M):E}invoke(ct,E,M,At,Xt){return this._invokeZS?this._invokeZS.onInvoke(this._invokeDlgt,this._invokeCurrZone,ct,E,M,At,Xt):E.apply(M,At)}handleError(ct,E){return!this._handleErrorZS||this._handleErrorZS.onHandleError(this._handleErrorDlgt,this._handleErrorCurrZone,ct,E)}scheduleTask(ct,E){let M=E;if(this._scheduleTaskZS)this._hasTaskZS&&M._zoneDelegates.push(this._hasTaskDlgtOwner),M=this._scheduleTaskZS.onScheduleTask(this._scheduleTaskDlgt,this._scheduleTaskCurrZone,ct,E),M||(M=E);else if(E.scheduleFn)E.scheduleFn(E);else{if(E.type!=Ds)throw new Error("Task is missing scheduleFn.");Cs(E)}return M}invokeTask(ct,E,M,At){return this._invokeTaskZS?this._invokeTaskZS.onInvokeTask(this._invokeTaskDlgt,this._invokeTaskCurrZone,ct,E,M,At):E.callback.apply(M,At)}cancelTask(ct,E){let M;if(this._cancelTaskZS)M=this._cancelTaskZS.onCancelTask(this._cancelTaskDlgt,this._cancelTaskCurrZone,ct,E);else{if(!E.cancelFn)throw Error("Task is not cancelable");M=E.cancelFn(E)}return M}hasTask(ct,E){try{this._hasTaskZS&&this._hasTaskZS.onHasTask(this._hasTaskDlgt,this._hasTaskCurrZone,ct,E)}catch(M){this.handleError(ct,M)}}_updateTaskCount(ct,E){const M=this._taskCounts,At=M[ct],Xt=M[ct]=At+E;if(Xt<0)throw new Error("More tasks executed then were scheduled.");0!=At&&0!=Xt||this.hasTask(this._zone,{microTask:M.microTask>0,macroTask:M.macroTask>0,eventTask:M.eventTask>0,change:ct})}}class pt{type;source;invoke;callback;data;scheduleFn;cancelFn;_zone=null;runCount=0;_zoneDelegates=null;_state="notScheduled";constructor(ct,E,M,At,Xt,Rt){if(this.type=ct,this.source=E,this.data=At,this.scheduleFn=Xt,this.cancelFn=Rt,!M)throw new Error("callback is not defined");this.callback=M;const Rn=this;this.invoke=ct===xn&&At&&At.useG?pt.invokeTask:function(){return pt.invokeTask.call(Oe,Rn,this,arguments)}}static invokeTask(ct,E,M){ct||(ct=this),Dr++;try{return ct.runCount++,ct.zone.runTask(ct,E,M)}finally{1==Dr&&or(),Dr--}}get zone(){return this._zone}get state(){return this._state}cancelScheduleRequest(){this._transitionTo(ys,Mt)}_transitionTo(ct,E,M){if(this._state!==E&&this._state!==M)throw new Error(`${this.type} '${this.source}': can not transition to '${ct}', expecting state '${E}'${M?" or '"+M+"'":""}, was '${this._state}'.`);this._state=ct,ct==ys&&(this._zoneDelegates=null)}toString(){return this.data&&typeof this.data.handleId<"u"?this.data.handleId.toString():Object.prototype.toString.call(this)}toJSON(){return{type:this.type,state:this.state,source:this.source,zone:this.zone.name,runCount:this.runCount}}}const rt=An("setTimeout"),Tt=An("Promise"),Yt=An("then");let gn,ot=[],zt=!1;function us(R){if(gn||Oe[Tt]&&(gn=Oe[Tt].resolve(0)),gn){let ct=gn[Yt];ct||(ct=gn.then),ct.call(gn,R)}else Oe[rt](R,0)}function Cs(R){0===Dr&&0===ot.length&&us(or),R&&ot.push(R)}function or(){if(!zt){for(zt=!0;ot.length;){const R=ot;ot=[];for(let ct=0;ct<R.length;ct++){const E=R[ct];try{E.zone.runTask(E,null,null)}catch(M){lt.onUnhandledError(M)}}}lt.microtaskDrainDone(),zt=!1}}const Ai={name:"NO ZONE"},ys="notScheduled",Mt="scheduling",Ue="scheduled",Lt="running",is="canceling",ni="unknown",Ds="microTask",_t="macroTask",xn="eventTask",mn={},lt={symbol:An,currentZoneFrame:()=>Pt,onUnhandledError:qs,microtaskDrainDone:qs,scheduleMicroTask:Cs,showUncaughtError:()=>!I[An("ignoreConsoleErrorUncaughtError")],patchEventTarget:()=>[],patchOnProperties:qs,patchMethod:()=>qs,bindArguments:()=>[],patchThen:()=>qs,patchMacroTask:()=>qs,patchEventPrototype:()=>qs,isIEOrEdge:()=>!1,getGlobalObjects:()=>{},ObjectDefineProperty:()=>qs,ObjectGetOwnPropertyDescriptor:()=>{},ObjectCreate:()=>{},ArraySlice:()=>[],patchClass:()=>qs,wrapWithCurrentZone:()=>qs,filterProperties:()=>[],attachOriginToPatched:()=>qs,_redefineProperty:()=>qs,patchCallbacks:()=>qs,nativeScheduleMicroTask:us};let Pt={parent:null,zone:new I(null,null)},ln=null,Dr=0;function qs(){}return oe("Zone","Zone"),I}(),P.Zone}();(function jm(P){(function qm(P){P.__load_patch("ZoneAwarePromise",(A,oe,I)=>{const Y=Object.getOwnPropertyDescriptor,ke=Object.defineProperty,rt=I.symbol,Tt=[],Yt=!1!==A[rt("DISABLE_WRAPPING_UNCAUGHT_PROMISE_REJECTION")],ot=rt("Promise"),zt=rt("then");I.onUnhandledError=ae=>{if(I.showUncaughtError()){const X=ae&&ae.rejection;X?console.error("Unhandled Promise rejection:",X instanceof Error?X.message:X,"; Zone:",ae.zone.name,"; Task:",ae.task&&ae.task.source,"; Value:",X,X instanceof Error?X.stack:void 0):console.error(ae)}},I.microtaskDrainDone=()=>{for(;Tt.length;){const ae=Tt.shift();try{ae.zone.runGuarded(()=>{throw ae.throwOriginal?ae.rejection:ae})}catch(X){Cs(X)}}};const us=rt("unhandledPromiseRejectionHandler");function Cs(ae){I.onUnhandledError(ae);try{const X=oe[us];"function"==typeof X&&X.call(this,ae)}catch{}}function or(ae){return ae&&"function"==typeof ae.then}function Ai(ae){return ae}function ys(ae){return Rn.reject(ae)}const Mt=rt("state"),Ue=rt("value"),Lt=rt("finally"),is=rt("parentPromiseValue"),ni=rt("parentPromiseState"),_t=null,mn=!1;function Pt(ae,X){return U=>{try{R(ae,X,U)}catch(pe){R(ae,!1,pe)}}}const ln=function(){let ae=!1;return function(U){return function(){ae||(ae=!0,U.apply(null,arguments))}}},Dr="Promise resolved with itself",qs=rt("currentTaskTrace");function R(ae,X,U){const pe=ln();if(ae===U)throw new TypeError(Dr);if(ae[Mt]===_t){let Ot=null;try{("object"==typeof U||"function"==typeof U)&&(Ot=U&&U.then)}catch(Jt){return pe(()=>{R(ae,!1,Jt)})(),ae}if(X!==mn&&U instanceof Rn&&U.hasOwnProperty(Mt)&&U.hasOwnProperty(Ue)&&U[Mt]!==_t)E(U),R(ae,U[Mt],U[Ue]);else if(X!==mn&&"function"==typeof Ot)try{Ot.call(U,pe(Pt(ae,X)),pe(Pt(ae,!1)))}catch(Jt){pe(()=>{R(ae,!1,Jt)})()}else{ae[Mt]=X;const Jt=ae[Ue];if(ae[Ue]=U,ae[Lt]===Lt&&!0===X&&(ae[Mt]=ae[ni],ae[Ue]=ae[is]),X===mn&&U instanceof Error){const kt=oe.currentTask&&oe.currentTask.data&&oe.currentTask.data.__creationTrace__;kt&&ke(U,qs,{configurable:!0,enumerable:!1,writable:!0,value:kt})}for(let kt=0;kt<Jt.length;)M(ae,Jt[kt++],Jt[kt++],Jt[kt++],Jt[kt++]);if(0==Jt.length&&X==mn){ae[Mt]=0;let kt=U;try{throw new Error("Uncaught (in promise): "+function pt(ae){return ae&&ae.toString===Object.prototype.toString?(ae.constructor&&ae.constructor.name||"")+": "+JSON.stringify(ae):ae?ae.toString():Object.prototype.toString.call(ae)}(U)+(U&&U.stack?"\n"+U.stack:""))}catch(qt){kt=qt}Yt&&(kt.throwOriginal=!0),kt.rejection=U,kt.promise=ae,kt.zone=oe.current,kt.task=oe.currentTask,Tt.push(kt),I.scheduleMicroTask()}}}return ae}const ct=rt("rejectionHandledHandler");function E(ae){if(0===ae[Mt]){try{const X=oe[ct];X&&"function"==typeof X&&X.call(this,{rejection:ae[Ue],promise:ae})}catch{}ae[Mt]=mn;for(let X=0;X<Tt.length;X++)ae===Tt[X].promise&&Tt.splice(X,1)}}function M(ae,X,U,pe,Ot){E(ae);const Jt=ae[Mt],kt=Jt?"function"==typeof pe?pe:Ai:"function"==typeof Ot?Ot:ys;X.scheduleMicroTask("Promise.then",()=>{try{const qt=ae[Ue],Tn=!!U&&Lt===U[Lt];Tn&&(U[is]=qt,U[ni]=Jt);const kn=X.run(kt,void 0,Tn&&kt!==ys&&kt!==Ai?[]:[qt]);R(U,!0,kn)}catch(qt){R(U,!1,qt)}},U)}const Xt=function(){},Rt=A.AggregateError;class Rn{static toString(){return"function ZoneAwarePromise() { [native code] }"}static resolve(X){return X instanceof Rn?X:R(new this(null),!0,X)}static reject(X){return R(new this(null),mn,X)}static withResolvers(){const X={};return X.promise=new Rn((U,pe)=>{X.resolve=U,X.reject=pe}),X}static any(X){if(!X||"function"!=typeof X[Symbol.iterator])return Promise.reject(new Rt([],"All promises were rejected"));const U=[];let pe=0;try{for(let kt of X)pe++,U.push(Rn.resolve(kt))}catch{return Promise.reject(new Rt([],"All promises were rejected"))}if(0===pe)return Promise.reject(new Rt([],"All promises were rejected"));let Ot=!1;const Jt=[];return new Rn((kt,qt)=>{for(let Tn=0;Tn<U.length;Tn++)U[Tn].then(kn=>{Ot||(Ot=!0,kt(kn))},kn=>{Jt.push(kn),pe--,0===pe&&(Ot=!0,qt(new Rt(Jt,"All promises were rejected")))})})}static race(X){let U,pe,Ot=new this((qt,Tn)=>{U=qt,pe=Tn});function Jt(qt){U(qt)}function kt(qt){pe(qt)}for(let qt of X)or(qt)||(qt=this.resolve(qt)),qt.then(Jt,kt);return Ot}static all(X){return Rn.allWithCallback(X)}static allSettled(X){return(this&&this.prototype instanceof Rn?this:Rn).allWithCallback(X,{thenCallback:pe=>({status:"fulfilled",value:pe}),errorCallback:pe=>({status:"rejected",reason:pe})})}static allWithCallback(X,U){let pe,Ot,Jt=new this((kn,Rs)=>{pe=kn,Ot=Rs}),kt=2,qt=0;const Tn=[];for(let kn of X){or(kn)||(kn=this.resolve(kn));const Rs=qt;try{kn.then(xs=>{Tn[Rs]=U?U.thenCallback(xs):xs,kt--,0===kt&&pe(Tn)},xs=>{U?(Tn[Rs]=U.errorCallback(xs),kt--,0===kt&&pe(Tn)):Ot(xs)})}catch(xs){Ot(xs)}kt++,qt++}return kt-=2,0===kt&&pe(Tn),Jt}constructor(X){const U=this;if(!(U instanceof Rn))throw new Error("Must be an instanceof Promise.");U[Mt]=_t,U[Ue]=[];try{const pe=ln();X&&X(pe(Pt(U,!0)),pe(Pt(U,mn)))}catch(pe){R(U,!1,pe)}}get[Symbol.toStringTag](){return"Promise"}get[Symbol.species](){return Rn}then(X,U){let pe=this.constructor?.[Symbol.species];(!pe||"function"!=typeof pe)&&(pe=this.constructor||Rn);const Ot=new pe(Xt),Jt=oe.current;return this[Mt]==_t?this[Ue].push(Jt,Ot,X,U):M(this,Jt,Ot,X,U),Ot}catch(X){return this.then(null,X)}finally(X){let U=this.constructor?.[Symbol.species];(!U||"function"!=typeof U)&&(U=Rn);const pe=new U(Xt);pe[Lt]=Lt;const Ot=oe.current;return this[Mt]==_t?this[Ue].push(Ot,pe,X,X):M(this,Ot,pe,X,X),pe}}Rn.resolve=Rn.resolve,Rn.reject=Rn.reject,Rn.race=Rn.race,Rn.all=Rn.all;const si=A[ot]=A.Promise;A.Promise=Rn;const Ro=rt("thenPatched");function ll(ae){const X=ae.prototype,U=Y(X,"then");if(U&&(!1===U.writable||!U.configurable))return;const pe=X.then;X[zt]=pe,ae.prototype.then=function(Ot,Jt){return new Rn((qt,Tn)=>{pe.call(this,qt,Tn)}).then(Ot,Jt)},ae[Ro]=!0}return I.patchThen=ll,si&&(ll(si),it(A,"fetch",ae=>function Fo(ae){return function(X,U){let pe=ae.apply(X,U);if(pe instanceof Rn)return pe;let Ot=pe.constructor;return Ot[Ro]||ll(Ot),pe}}(ae))),Promise[oe.__symbol__("uncaughtPromiseErrors")]=Tt,Rn})})(P),function $m(P){P.__load_patch("toString",A=>{const oe=Function.prototype.toString,I=Mn("OriginalDelegate"),Y=Mn("Promise"),ke=Mn("Error"),pt=function(){if("function"==typeof this){const ot=this[I];if(ot)return"function"==typeof ot?oe.call(ot):Object.prototype.toString.call(ot);if(this===Promise){const zt=A[Y];if(zt)return oe.call(zt)}if(this===Error){const zt=A[ke];if(zt)return oe.call(zt)}}return oe.call(this)};pt[I]=oe,Function.prototype.toString=pt;const rt=Object.prototype.toString;Object.prototype.toString=function(){return"function"==typeof Promise&&this instanceof Promise?"[object Promise]":rt.call(this)}})}(P),function ld(P){P.__load_patch("util",(A,oe,I)=>{const Y=Lc(A);I.patchOnProperties=Le,I.patchMethod=it,I.bindArguments=Ac,I.patchMacroTask=an;const ke=oe.__symbol__("BLACK_LISTED_EVENTS"),pt=oe.__symbol__("UNPATCHED_EVENTS");A[pt]&&(A[ke]=A[pt]),A[ke]&&(oe[ke]=oe[pt]=A[ke]),I.patchEventPrototype=rd,I.patchEventTarget=jl,I.isIEOrEdge=fo,I.ObjectDefineProperty=Bn,I.ObjectGetOwnPropertyDescriptor=Dn,I.ObjectCreate=cs,I.ArraySlice=Zs,I.patchClass=Me,I.wrapWithCurrentZone=Zn,I.filterProperties=od,I.attachOriginToPatched=He,I._redefineProperty=Object.defineProperty,I.patchCallbacks=Yl,I.getGlobalObjects=()=>({globalSources:rl,zoneSymbolEventNames:Pi,eventNames:Y,isBrowser:il,isMix:Ta,isNode:Rc,TRUE_STR:Mi,FALSE_STR:di,ZONE_SYMBOL_PREFIX:Mo,ADD_EVENT_LISTENER_STR:ti,REMOVE_EVENT_LISTENER_STR:zr})})}(P)})(Uu),function zm(P){P.__load_patch("legacy",A=>{const oe=A[P.__symbol__("legacyPatch")];oe&&oe()}),P.__load_patch("timers",A=>{const I="clear";Gu(A,"set",I,"Timeout"),Gu(A,"set",I,"Interval"),Gu(A,"set",I,"Immediate")}),P.__load_patch("requestAnimationFrame",A=>{Gu(A,"request","cancel","AnimationFrame"),Gu(A,"mozRequest","mozCancel","AnimationFrame"),Gu(A,"webkitRequest","webkitCancel","AnimationFrame")}),P.__load_patch("blocking",(A,oe)=>{const I=["alert","prompt","confirm"];for(let Y=0;Y<I.length;Y++)it(A,I[Y],(pt,rt,Tt)=>function(Yt,ot){return oe.current.run(pt,A,ot,Tt)})}),P.__load_patch("EventTarget",(A,oe,I)=>{(function As(P,A){A.patchEventPrototype(P,A)})(A,I),function eS(P,A){if(Zone[A.symbol("patchEventTarget")])return;const{eventNames:oe,zoneSymbolEventNames:I,TRUE_STR:Y,FALSE_STR:ke,ZONE_SYMBOL_PREFIX:pt}=A.getGlobalObjects();for(let Tt=0;Tt<oe.length;Tt++){const Yt=oe[Tt],gn=pt+(Yt+ke),us=pt+(Yt+Y);I[Yt]={},I[Yt][ke]=gn,I[Yt][Y]=us}const rt=P.EventTarget;rt&&rt.prototype&&A.patchEventTarget(P,A,[rt&&rt.prototype])}(A,I);const Y=A.XMLHttpRequestEventTarget;Y&&Y.prototype&&I.patchEventTarget(A,I,[Y.prototype])}),P.__load_patch("MutationObserver",(A,oe,I)=>{Me("MutationObserver"),Me("WebKitMutationObserver")}),P.__load_patch("IntersectionObserver",(A,oe,I)=>{Me("IntersectionObserver")}),P.__load_patch("FileReader",(A,oe,I)=>{Me("FileReader")}),P.__load_patch("on_property",(A,oe,I)=>{!function rr(P,A){if(Rc&&!Ta||Zone[P.symbol("patchEvents")])return;const oe=A.__Zone_ignore_on_properties;let I=[];if(il){const Y=window;I=I.concat(["Document","SVGElement","Element","HTMLElement","HTMLBodyElement","HTMLMediaElement","HTMLFrameSetElement","HTMLFrameElement","HTMLIFrameElement","HTMLMarqueeElement","Worker"]);const ke=[];ad(Y,Lc(Y),oe&&oe.concat(ke),zn(Y))}I=I.concat(["XMLHttpRequest","XMLHttpRequestEventTarget","IDBIndex","IDBRequest","IDBOpenDBRequest","IDBDatabase","IDBTransaction","IDBCursor","WebSocket"]);for(let Y=0;Y<I.length;Y++){const ke=A[I[Y]];ke?.prototype&&ad(ke.prototype,Lc(ke.prototype),oe)}}(I,A)}),P.__load_patch("customElements",(A,oe,I)=>{!function np(P,A){const{isBrowser:oe,isMix:I}=A.getGlobalObjects();(oe||I)&&P.customElements&&"customElements"in P&&A.patchCallbacks(A,P.customElements,"customElements","define",["connectedCallback","disconnectedCallback","adoptedCallback","attributeChangedCallback","formAssociatedCallback","formDisabledCallback","formResetCallback","formStateRestoreCallback"])}(A,I)}),P.__load_patch("XHR",(A,oe)=>{!function Yt(ot){const zt=ot.XMLHttpRequest;if(!zt)return;const gn=zt.prototype;let Cs=gn[Bo],or=gn[ms];if(!Cs){const lt=ot.XMLHttpRequestEventTarget;if(lt){const Pt=lt.prototype;Cs=Pt[Bo],or=Pt[ms]}}const Ai="readystatechange",ys="scheduled";function Mt(lt){const Pt=lt.data,ln=Pt.target;ln[pt]=!1,ln[Tt]=!1;const Dr=ln[ke];Cs||(Cs=ln[Bo],or=ln[ms]),Dr&&or.call(ln,Ai,Dr);const qs=ln[ke]=()=>{if(ln.readyState===ln.DONE)if(!Pt.aborted&&ln[pt]&&lt.state===ys){const ct=ln[oe.__symbol__("loadfalse")];if(0!==ln.status&&ct&&ct.length>0){const E=lt.invoke;lt.invoke=function(){const M=ln[oe.__symbol__("loadfalse")];for(let At=0;At<M.length;At++)M[At]===lt&&M.splice(At,1);!Pt.aborted&&lt.state===ys&&E.call(lt)},ct.push(lt)}else lt.invoke()}else!Pt.aborted&&!1===ln[pt]&&(ln[Tt]=!0)};return Cs.call(ln,Ai,qs),ln[I]||(ln[I]=lt),xn.apply(ln,Pt.args),ln[pt]=!0,lt}function Ue(){}function Lt(lt){const Pt=lt.data;return Pt.aborted=!0,mn.apply(Pt.target,Pt.args)}const is=it(gn,"open",()=>function(lt,Pt){return lt[Y]=0==Pt[2],lt[rt]=Pt[1],is.apply(lt,Pt)}),Ds=Mn("fetchTaskAborting"),_t=Mn("fetchTaskScheduling"),xn=it(gn,"send",()=>function(lt,Pt){if(!0===oe.current[_t]||lt[Y])return xn.apply(lt,Pt);{const ln={target:lt,url:lt[rt],isPeriodic:!1,args:Pt,aborted:!1},Dr=vt("XMLHttpRequest.send",Ue,ln,Mt,Lt);lt&&!0===lt[Tt]&&!ln.aborted&&Dr.state===ys&&Dr.invoke()}}),mn=it(gn,"abort",()=>function(lt,Pt){const ln=function us(lt){return lt[I]}(lt);if(ln&&"string"==typeof ln.type){if(null==ln.cancelFn||ln.data&&ln.data.aborted)return;ln.zone.cancelTask(ln)}else if(!0===oe.current[Ds])return mn.apply(lt,Pt)})}(A);const I=Mn("xhrTask"),Y=Mn("xhrSync"),ke=Mn("xhrListener"),pt=Mn("xhrScheduled"),rt=Mn("xhrURL"),Tt=Mn("xhrErrorBeforeScheduled")}),P.__load_patch("geolocation",A=>{A.navigator&&A.navigator.geolocation&&function Ul(P,A){const oe=P.constructor.name;for(let I=0;I<A.length;I++){const Y=A[I],ke=P[Y];if(ke){if(!Hu(Dn(P,Y)))continue;P[Y]=(rt=>{const Tt=function(){return rt.apply(this,Ac(arguments,oe+"."+Y))};return He(Tt,rt),Tt})(ke)}}}(A.navigator.geolocation,["getCurrentPosition","watchPosition"])}),P.__load_patch("PromiseRejectionEvent",(A,oe)=>{function I(Y){return function(ke){Oc(A,Y).forEach(rt=>{const Tt=A.PromiseRejectionEvent;if(Tt){const Yt=new Tt(Y,{promise:ke.promise,reason:ke.rejection});rt.invoke(Yt)}})}}A.PromiseRejectionEvent&&(oe[Mn("unhandledPromiseRejectionHandler")]=I("unhandledrejection"),oe[Mn("rejectionHandledHandler")]=I("rejectionhandled"))}),P.__load_patch("queueMicrotask",(A,oe,I)=>{!function Ao(P,A){A.patchMethod(P,"queueMicrotask",oe=>function(I,Y){Zone.current.scheduleMicroTask("queueMicrotask",Y[0])})}(A,I)})}(Uu)},987:Oe=>{Oe.exports=function An(nn){if(Array.isArray(nn))return nn},Oe.exports.__esModule=!0,Oe.exports.default=Oe.exports}},Oe=>{Oe(Oe.s=815)}]);